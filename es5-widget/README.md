<p align="center">
<img src="https://muyao1987.gitee.io/cdn/mars3d.cn/logo.png" width="300px" />
</p>

<p align="center">åŸºäº åŸç”ŸJSä¸‹widgetæ¨¡å— çš„ Mars3DğŸŒåŸºç¡€é¡¹ç›®æ¨¡æ¿ï¼ˆES5ç‰ˆï¼‰</p>

<p align="center">
<a target="_black" href="https://github.com/marsgis/mars3d">
<img alt="GitHub stars" src="https://img.shields.io/github/stars/marsgis/mars3d?style=flat&logo=github">
</a>
<a target="_black" href="https://www.npmjs.com/package/mars3d">
<img alt="Npm downloads" src="https://img.shields.io/npm/dt/mars3d?style=flat&logo=npm">
</a>
<a target="_black" href="https://www.npmjs.com/package/mars3d">
<img alt="Npm version" src="https://img.shields.io/npm/v/mars3d.svg?style=flat&logo=npm&label=version"/>
</a>
</p>

 
 
## é¡¹ç›®ä»‹ç»

Mars3DåŸºç¡€é¡¹ç›® æ˜¯åŸºäº[Mars3Då¹³å°](http://mars3d.cn)åšçš„ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿï¼Œæä¾›çš„ä¸€ä¸ªåŸºç¡€é¡¹ç›®æ¨¡ç‰ˆï¼ŒåŒ…å«å¸¸ç”¨åŸºç¡€åœ°å›¾åŠŸèƒ½ï¼Œå¯åœ¨è¯¥åŸºç¡€é¡¹ç›®ä¸Šå¿«é€Ÿå¼€å‘æ­å»ºæ–°é¡¹ç›®ã€‚æ–¹ä¾¿å¿«é€Ÿæ­å»ºä¸‰ç»´åœ°å›¾äº§å“ï¼Œæ•æ·å¼€å‘ï¼Œå¯å¤ç”¨ï¼Œæ”¯æŒå„ç§é…ç½®ï¼Œé€‚åˆå„ç§åœºæ™¯ä½¿ç”¨ã€‚

åŸç”ŸJSç‰ˆ (widgetæ–¹å¼) çš„ç‰¹ç‚¹ï¼š
1. åŸºäº**ä¼ ç»Ÿæ¨¡å¼åŸç”ŸJS**æŠ€æœ¯æ ˆä¸‹å¼€å‘çš„
2. ä½¿ç”¨[mars3d-widget](https://gitee.com/marsgis/mars3d-plugin/tree/master/mars3d-plugin-widget)æ’ä»¶è¿›è¡Œæ¨¡å—åŒ–å°è£…è°ƒç”¨å„åŠŸèƒ½
3. ç«æ˜Ÿç§‘æŠ€åœ¨ä¼ ç»ŸæŠ€æœ¯æ ˆæ—¶(vueè¿˜æ²¡æˆç†Ÿæµè¡Œæ—¶)å¤šå¹´æ¥åº”ç”¨äºæ— æ•°é¡¹ç›®ï¼Œå½’çº³æ€»ç»“çš„ä¸€ä¸ªåŸºç¡€çš„é¡¹ç›®æ¨¡ç‰ˆ




## è¿è¡Œæ•ˆæœ 
 [åœ¨çº¿ä½“éªŒ](http://marsgis.gitee.io/mars3d-es5-project/)  

ä¹Ÿå¯ä»¥è®¿é—®[åŸºç¡€é¡¹ç›®åœ¨çº¿](http://mars3d.cn/project/jcxm/index.html)ä½“éªŒæ•ˆæœå’ŒåŠŸèƒ½

 ![image](https://cdn.jsdelivr.net/gh/muyao1987/cdn/mars3d.cn/xm/jcxm/1.jpg)





## 1. widgetæ¨¡å—åŒ–æ¶æ„è¯´æ˜
widgetæ¨¡å—åŒ–è®¾è®¡æ–¹å¼æ˜¯æˆ‘ä»¬åœ¨2016å¹´è®¾è®¡çš„ä¸€ç§åŸºäºä¼ ç»ŸJSçš„æ¨¡å—åŒ–è®¾è®¡æ¶æ„ã€‚è®¾è®¡æ€æƒ³ä¸»è¦æ˜¯å€Ÿé‰´äº†gisè¡Œä¸šçš„arcgis flexviewerå’Œjsviewerï¼Œä¹Ÿå€Ÿé‰´äº†å‰ç«¯è¡Œä¸šçš„Reactå’ŒVueã€‚å½“å‰æœ€æµè¡Œå’Œé€šç”¨çš„æ–¹å¼æ˜¯æ•´ä¸ªé¡¹ç›®ç”¨Vueã€Reactæˆ–angularä¸‹å¼€å‘æœ€ä½³ï¼Œç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆæ¥åšå¼€å‘ã€‚ 

### 1.1 ä½¿ç”¨widgetçš„ç†ç”±
ç›®å‰è¿˜ä¿ç•™widgetæ¨¡å—åŒ–çš„æ–¹å¼ï¼Œæ˜¯å› ä¸ºï¼š
- å®ç”¨æ€§ï¼Œä¸»è¦è€ƒè™‘åˆ°è¯¥æ–¹å¼ä½¿ç”¨å¤šå¹´ï¼Œå·²åœ¨å¤§é‡é¡¹ç›®ä¸­ä½¿ç”¨, ç§¯ç´¯æ¯”è¾ƒå¤šï¼Œå¹¶ä¸”æˆç†Ÿç¨³å®šï¼›
- å¹¶ä¸”å½“å‰è¿˜æ˜¯æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å…¬å¸é¡¹ç›®è¿˜æ˜¯ä¼ ç»Ÿæ–¹å¼å¼€å‘çš„ï¼›
- widgetæ¨¡å—ä¹Ÿå…¼å®¹vueã€reactã€ angularä¸‹é€šè¿‡é™æ€èµ„æºæ–¹å¼æ¥ä½¿ç”¨ã€‚


### 1.2 widgetçš„ç‰¹ç‚¹
- å°†æ¯ä¸ªä¸šåŠ¡æ¨¡å—è®¾è®¡ä¸ºç‹¬ç«‹çš„widgetæ¨¡å—ï¼Œäº’ç›¸éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ç›¸è§£è€¦ï¼Œç±»ä¼¼vueç»„ä»¶ã€‚
- widgetæ˜¯æŒ‰éœ€åŠ è½½å’Œåˆå§‹åŒ–ï¼Œé»˜è®¤æ˜¯ä¸åŠ è½½çš„ï¼Œå•å‡»æ¿€æ´»åæ‰ä¼šåŠ è½½å…¶ç›¸å…³jså’Œhtmlç­‰èµ„æºã€‚ 
- æœ‰å¾ˆå¤šå¯é…ç½®çš„å‚æ•°ï¼Œæ— éœ€ä»£ç å³å¯æŒ‰éœ€é…ç½®è‡ªåŠ¨é‡Šæ”¾æ¿€æ´»ã€ç•Œé¢ä½ç½®ã€å¤§å°ç­‰ã€‚


> ä¿ç•™ä½¿ç”¨ widgetæ¨¡å—åŒ– æ–¹å¼ï¼Œå¹¶ä¸æ˜¯æŒ‡æˆ‘ä»¬ä¸ç”¨vueç­‰ç°ä»£åŒ–æŠ€æœ¯æ ˆï¼Œè€Œæ˜¯å…·ä½“æŒ‰å…¬å¸äººå‘˜ç ”å‘æ°´å¹³å’ŒæŠ€æœ¯æ ˆæƒ…å†µæŒ‰éœ€é€‰æ‹©ï¼Œé€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ã€‚




## 2. åŸºç¡€é¡¹ç›®
 æˆ‘ä»¬é€šè¿‡vscodeæ‰“å¼€è¯¥é¡¹ç›®ï¼Œé¡¹ç›®ä¸­æœ€é‡è¦çš„æ˜¯2ä¸ªç‚¹æ˜¯ï¼Œ`jsoné…ç½®æ–‡ä»¶` å’Œ `widgetæ¨¡å—åŒ–`å¼€å‘ï¼Œä¸€èˆ¬å¼€å‘é¡¹ç›®åªç”¨ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œå¼€å‘æ–°çš„widgetå³å¯ã€‚

- `config/config.json`æ˜¯åœ°å›¾åˆå§‹åŒ–æ„é€ å‚æ•°é…ç½®æ–‡ä»¶
- `config/widget.json`ä¸ºé¡¹ç›®widgetçš„æ¨¡å—é…ç½®ä¿¡æ¯æ–‡ä»¶
- `widgetsç›®å½•`ä¸ºæ¨¡å—åŠŸèƒ½ç›®å½•ï¼Œä¹Ÿå¯ä»¥æŒ‰ä¸šåŠ¡åˆ†åœ¨å¤šä¸ªç›®å½•ä¸­ï¼Œæ¯”å¦‚`widgetsTSç›®å½•`


 ![image](https://cdn.jsdelivr.net/gh/muyao1987/cdn/mars3d.cn/xm/jcxm/1.jpg) 

### 2.1 ä¸‹è½½ä»£ç 
ç›®å‰æˆ‘ä»¬å·²ç»å¼€æºäº†åŸºç¡€é¡¹ç›®çš„åŸºç¡€æ¡†æ¶å’Œä¸€äº›éƒ¨åˆ†widgetã€‚å¯ä»¥ä»ä¸‹é¢é“¾æ¥ä¸‹è½½ä»£ç ï¼š
 
1. å›½å¤–Github:[https://github.com/marsgis/mars3d-es5-project](https://github.com/marsgis/mars3d-es5-project)
2. å›½å†…Gitee [https://gitee.com/marsgis/mars3d-es5-project](https://gitee.com/marsgis/mars3d-es5-project)


åœ¨ä»»æ„å¼€å‘ç¼–è¾‘å™¨ï¼ˆå¦‚vscodeç­‰ï¼‰æˆ–httpæœåŠ¡å™¨(å¦‚nodeã€nginxã€tomcatã€IISç­‰)ä¸‹ç›´æ¥è¿è¡Œæµè§ˆindex.htmlå³å¯
  
>ç”µå­æ²™ç›˜ã€ç»¼åˆæ€åŠ¿ç­‰ç³»ç»Ÿä»£ç å†…éƒ¨ç»“æ„å’ŒåŸºç¡€é¡¹ç›®ç±»åŒï¼Œåªæ˜¯åœ¨widgetåŠŸèƒ½æ•°é‡å’Œæ ·å¼ä¸Šæœ‰æ‰€ä¸åŒã€‚


::: danger 
å¦‚æœéœ€è¦æ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„widgetå’Œå…¶ä»–ä¸€äº›é¡¹ç›®æ¨¡æ¿ï¼Œéœ€è¦è”ç³»æˆ‘ä»¬ä»˜è´¹è´­ä¹° é¡¹ç›®æºä»£ç ã€‚
::: 




### è¿è¡Œæ–¹å¼1ï¼šä½¿ç”¨vscodeåŠå…¶æ’ä»¶

åœ¨ä»»æ„å¼€å‘ç¼–è¾‘å™¨ï¼ˆå¦‚vscodeç­‰ï¼‰æˆ–httpæœåŠ¡å™¨(å¦‚nodeã€nginxã€tomcatã€IISç­‰)ä¸‹ç›´æ¥è¿è¡Œæµè§ˆ`index.html`æˆ–å¯¹åº”ç¤ºä¾‹é¡µé¢å³å¯ ï¼Œ

å»ºè®®ä½¿ç”¨VScodeå·¥å…·æ‰“å¼€ä»£ç ç›®å½•ï¼ˆè¯·å‚è€ƒä¸Šä¸€ç« èŠ‚å®‰è£…å¥½VScode åŠ Live Serveræ’ä»¶ï¼‰ã€‚

- æ¨èä½¿ç”¨ vscodeï¼Œå®‰è£…å‚è€ƒ[å¼€å‘ç¯å¢ƒæ­å»ºæ•™ç¨‹](guide/start/env.html)
- å®‰è£… vscode æ’ä»¶ï¼Œæ¨èå®‰è£… Live Server

 å‚è€ƒä¸‹å›¾é€šè¿‡Live Serverè®¿é—®å„é¡µé¢

 ![image](http://mars3d.cn/dev/img/guide/start-example-run.jpg) 


### è¿è¡Œæ–¹å¼2ï¼šè¿è¡Œnpmå‘½ä»¤

#### é¦–æ¬¡è¿è¡Œå‰å®‰è£…ä¾èµ–
```
npm install

//æˆ–ä½¿ç”¨ä»£ç†
npm i --registry=http://registry.taobao.org
```

#### å¯åŠ¨å¼€å‘ç¯å¢ƒ
```
npm run serve
```

#### ç¼–è¯‘æ„å»º
```
npm run build //ç¼–è¯‘åç”Ÿæˆåœ¨distç›®å½•ï¼Œæ‹·è´å‡ºå»å‘å¸ƒå³å¯
npm run serve:dist  //æµ‹è¯•distè¿è¡ŒçŠ¶æ€
```




#### mars3d-widgetæ’ä»¶
 ä¸ºäº†æ›´å®¹æ˜“ç†è§£å†…éƒ¨é€»è¾‘ï¼Œæ‚¨å¯ä»¥ä¸‹è½½[mars3d-widgetæ’ä»¶æºç ](https://gitee.com/marsgis/mars3d-plugin) è¿›è¡ŒæŸ¥é˜…ã€‚

#### ä¸‹è½½æœ€æ–°lib
 å»ºè®®ä»[http://mars3d.cn/download](http://mars3d.cn/download)ä¸‹è½½æœ€æ–°mars3dç±»åº“åè¦†ç›–è‡³`lib/`ç›®å½•ä¸‹å³å¯ã€‚




### 2.2 include-lib.jsæ–‡ä»¶è¯´æ˜ 

æˆ‘ä»¬å½“å‰é¡¹ç›®å†…çš„ç¬¬ä¸‰æ–¹ç±»åº“åŠæˆ‘ä»¬çš„sdkç±»åº“éƒ½å­˜æ”¾åœ¨libç›®å½•ä¸‹ï¼Œæ¯ä¸ªç›®å½•å‡æœ‰`README.md`æ–‡ä»¶è¯´æ˜è¯¥ç±»åº“çš„githubåœ°å€ã€å®˜ç½‘å’Œç”¨é€”ç­‰ä¿¡æ¯ã€‚

 ![image](/dev/img/guide/start-includeLib-ml.jpg) 

ä¸ºäº†æ–¹ä¾¿åˆ‡æ¢å’Œå¼•å…¥ç¬¬3æ–¹libï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªç‹¬ç«‹çš„jsæ–‡ä»¶[include-lib.js](https://unpkg.com/marsgis-lib/lib//include-lib.js)æ¥ç»Ÿä¸€è°ƒç”¨ä½¿ç”¨ç¬¬3æ–¹lib,åœ¨éœ€è¦çš„é¡µé¢æŒ‰ä¸‹é¢æ–¹å¼å¼•å…¥libï¼š
```html
<!--ç¬¬ä¸‰æ–¹lib-->
<script type="text/javascript" src="../lib/include-lib.js" libpath="../lib/"
    include="font-awesome,turf,mars3d"></script>
```
è¯¥æ–¹å¼ç­‰ä»·äºï¼ˆå¦‚ä¸ä¹ æƒ¯include-lib.jsï¼Œä¹Ÿå¯ä»¥æ”¹ä¸ºä¸‹é¢æ¼”ç¤ºçš„ç›´æ¥å¼•å…¥æ–¹å¼ï¼‰ï¼š 

```html
<!--å¯¹åº”font-awesome-->
<link rel="stylesheet" href="../lib/fonts/font-awesome/css/font-awesome.min.css">

<!--å¯¹åº”turf-->
<script type="text/javascript" src="../lib/turf/turf.min.js"></script>

<!--å¯¹åº”mars3d-->
<link rel="stylesheet" href="../lib/Cesium/Widgets/widgets.css">
<script type="text/javascript" src="../lib/Cesium/Cesium.js"></script>
<link rel="stylesheet" href="../lib/mars3d/mars3d.css">
<script type="text/javascript" src="../lib/mars3d/mars3d.js"></script>
```
 
 
 

## 3. widgetåˆå§‹åŒ–åŠç®¡ç†

 ç›®å‰å¹³å°ç¤ºä¾‹å’Œé¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„[widget.json](http://mars3d.cn/project/jcxm/config/widget.json) æ˜¯é™æ€jsonæ–‡ä»¶æ–¹å¼
 æ–‡ä»¶ä¸­é…ç½®å‚æ•°ä¸[mars3d.widget.initæ–¹æ³•API](http://mars3d.cn/api/widget.html#.init)çš„æ–¹æ³•å‚æ•°æ˜¯å®Œæˆç›¸åŒä¸€è‡´çš„ï¼Œä»£ç ä¸­åŠ è½½jsonåä¼ å…¥åˆ°initæ–¹æ³•ä¸­ã€‚
 
 widgetåˆå§‹åŒ–æ–¹æ³•ï¼š
 ```js
//åˆå§‹åŒ–widgetç®¡ç†å™¨
mars3d.widget.init(map, widgetCfg, './') //tip: ç¬¬3ä¸ªå‚æ•°æ”¯æŒå®šä¹‰widgetç›®å½•çš„ç›¸å¯¹è·¯å¾„ã€‚
```

### 3.1 widgetçš„ç®¡ç†
åœ¨å¤–éƒ¨è°ƒç”¨widgetåŠŸèƒ½ï¼Œéƒ½æ˜¯é€šè¿‡[mars3d.widgeté™æ€ç±»](http://mars3d.cn/api/widget.html)æ¥ç»Ÿä¸€ç®¡ç†çš„ï¼Œæ›´å¤šæ–¹æ³•å¯ä»¥å‚é˜…è¯¥ç±»çš„APIæ–‡æ¡£ã€‚
 
æ¯”å¦‚æ¿€æ´»widetï¼šåœ¨éœ€è¦å¤–éƒ¨ä½¿ç”¨çš„åœ°æ–¹é€šè¿‡ mars3d.widget.activate([å‚æ•°](http://mars3d.cn/api/widget.html#.WidgetOptions)) æ¥æ¿€æ´»widgetæ¨¡å—, å‚æ•°æ”¯æŒå¤šç§æ¨¡å¼å¯å¤šæ ·åŒ–å…¼å®¹ä½¿ç”¨, æ¯”å¦‚ï¼š
 ```js
//å¸¸ç”¨ï¼Œç›´æ¥ä½¿ç”¨uri
mars3d.widget.activate("widgets/bookmark/widget.js"); 

//æ”¯æŒæ‰€æœ‰å¯é…å‚æ•°å’Œè‡ªå®šä¹‰å‚æ•°ï¼Œåœ¨widget.jså†…éƒ¨é€šè¿‡this.configå¯è·å–ä¼ å…¥çš„å‚æ•°
mars3d.widget.activate({name:"ä¹¦ç­¾", uri: "widgets/bookmark/widget.js "}); 
```


### 4. å•ä¸ªwidgetæ¨¡å—ç»„æˆ

æ¯ä¸ªwidgetæ¨¡å—å¿…é¡»å­˜åœ¨ widget.js æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿äº† [BaseWidgetç±»](http://mars3d.cn/api/BaseWidget.html)çš„å­ç±»ã€‚

ç±»å†…æœ€é‡è¦çš„å‡ ä¸ªå±æ€§å’Œæ–¹æ³•å¦‚ä¸‹ï¼š
|  åˆ†ç±»  |åç§°  | åŠŸèƒ½| 
| ----| ----  | ---- | 
| getå±æ€§ | resources   |éœ€è¦é¢„å…ˆåŠ è½½åˆ°ä¸»é¡µé¢çš„jsã€cssèµ„æºæ–‡ä»¶ | 
| getå±æ€§ | view   |å­˜åœ¨å¼¹çª—æˆ–ç•Œé¢æ—¶é…ç½®ï¼Œå…·ä½“è¯¦è§åèŠ‚è¯´æ˜ | 
| å†…éƒ¨å˜é‡ | config   |å¯¹åº”widgetå®šä¹‰çš„æˆ–ä¼ å…¥çš„é…ç½®ä¿¡æ¯  |   
| å†…éƒ¨å˜é‡ | path   |å½“å‰widgetæ‰€åœ¨ç›®å½•çš„ç›¸å¯¹äºç½‘é¡µçš„è·¯å¾„  |   
| å†…éƒ¨å˜é‡ | map   |å½“å‰Mapåœ°å›¾å¯¹è±¡  |   
| æ–¹æ³• | create   |æ’ä»¶åˆå§‹åŒ–è§¦å‘ï¼Œä»…æ‰§è¡Œ1æ¬¡   |   
| æ–¹æ³• | winCreateOK   |viewå±æ€§å®šä¹‰çš„ç•Œé¢æ¯æ¬¡åˆå§‹åŒ–åè°ƒç”¨   |   
| æ–¹æ³• | activate   | æ‰“å¼€æ¿€æ´»æ’ä»¶ è§¦å‘   |   
| æ–¹æ³• | disable   | å…³é—­é‡Šæ”¾æ’ä»¶ è§¦å‘   |   

### 4.1 viewå±æ€§
 é»˜è®¤æ¯ä¸ªæ’ä»¶æ˜¯æ— ç•Œé¢æˆ–å¼¹çª—çš„, å¦‚æœéœ€è¦æœ‰å¯¹åº”çš„å¼¹çª—æˆ–ç•Œé¢(å¦‚å¼¹çª—ã€è¾“å…¥æ ã€èœå•ç­‰)è¯·å®šä¹‰`view`å±æ€§ã€‚

è¯·å‚è€ƒè´`widgets\_example* `å‘½åçš„ç¤ºä¾‹widgetæ¥æ–°å»ºwidgetæ¨¡å—ï¼Œå»ºè®®ç›´æ¥å¤åˆ¶åæ”¹ä¸‹ç›®å½•åç§°å³å¯ã€‚


viewé…ç½®ä¸­å¿…é¡»å­˜åœ¨2ä¸ªå±æ€§ï¼štypeæ ‡è¯†ç±»å‹ï¼Œurlä¸ºhtmlåœ°å€ã€‚ ç›®å‰viewæœ‰ä¸‹é¢3ç§æ¨¡å¼ä¾›ä½¿ç”¨ï¼š

|  typeå±æ€§  | åŠŸèƒ½| å¯¹åº”çš„ç¤ºä¾‹ |  è¯´æ˜  | 
| ----  | ---- | ----   |----  | 
| window  |iframeæ¨¡å¼å¼¹çª— |_example | ç‹¬ç«‹çš„htmlå­é¡µé¢ï¼Œæ¯”è¾ƒè‡ªç”±ï¼Œç®€å•ç²—æš´ã€æ— ä»»ä½•é™åˆ¶ï¼›å¯ä»¥æ¯ä¸ªé¡µé¢ç”¨ä¸åŒçš„UIå’Œç¬¬ä¸‰æ–¹æ’ä»¶ä¸ç”¨è€ƒè™‘å†²çªé—®é¢˜ï¼›ä»»ä½•æ°´å¹³çš„å¼€å‘äººå‘˜å‡å®¹æ˜“å¿«é€Ÿå¼€å‘ã€‚|
| divwindow  |divå…ƒç´ æ¨¡å¼å¼¹çª— |_example_divwin | å¯ç›´æ¥äº’ç›¸è®¿é—®ï¼Œè¿™ç§æ¨¡å¼å¼Šç«¯æ˜¯æ˜“å¼•èµ·æ¨¡å—é—´idå‘½åå†²çªï¼Œåœ¨csså’Œhtmlä¸­å‘½åæ—¶éœ€æ³¨æ„ã€‚|
| append  |ä»»æ„htmlå…ƒç´  |_example_append | ä»»æ„divèŠ‚ç‚¹ï¼Œæ¯”è¾ƒè‡ªç”±. |

 
#### windowæ—¶ï¼š
view.htmlé¡µé¢ï¼ˆæˆ–å¼•å…¥çš„view.jsä¸­ï¼‰å¿…é¡»å®šä¹‰ä¸€ä¸ªinitWidgetViewæ–¹æ³•ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨è°ƒç”¨è¿›è¡Œä¼ å…¥å½“å‰widgetå¯¹è±¡ï¼Œç”¨äºé¡µé¢ä¸­è°ƒç”¨widgetä¸­çš„æ–¹æ³•å±æ€§ã€‚
å¯ä»¥é…ç½®windowOptionså‚æ•°æ¥å®šä¹‰å¼¹çª—çš„å¤§å°ã€ä½ç½®ç­‰ã€‚
 ```js 
get view() {
   return {
      type: 'window',
      url: 'view.html',
      windowOptions: { width: 250 },
   }
}
 ```

#### divwindowæ—¶ï¼š
æ­¤æ¨¡å¼ä¸ç”¨å•ç‹¬çš„jsï¼Œ viewç•Œé¢ç›¸å…³jsé€»è¾‘å…¨éƒ¨å†™åœ¨widget.jsä¸­
åŒæ ·æ”¯æŒwindowOptionså‚æ•°é…ç½®ã€‚
 ```js 
get view() {
   return {
      type: 'divwindow',
      url: 'view.html',
      windowOptions: { width: 210, height: 210 },
   }
}
 ```

#### appendæ—¶ï¼š
å°†viewçš„htmlç›´æ¥æ·»åŠ è‡³ä¸»é¡µé¢ä¸­æŒ‡å®šidçš„DOMèŠ‚ç‚¹ä¸‹ï¼Œé€šè¿‡`parent`å±æ€§é…ç½®æŒ‡å®šï¼Œé»˜è®¤æ˜¯`body`ã€‚
 ```js 
get view() {
   return { type: 'append', url: 'view.html', parent: '#centerDiv' }
}
 ```




 
### 4.2 widgetè¢«æ¿€æ´»åæ‰§è¡Œæµç¨‹
widgetæ¿€æ´»åé¡µé¢æ‰§è¡Œæµç¨‹:
- 1. å¼•å…¥åŠ è½½widget.jsåˆ°index.htmlé¡µé¢ä¸Š
- 2. ï¼ˆå¦‚æœæœ‰resourcesé…ç½®ï¼‰å¼•å…¥åŠ è½½resourcesèµ„æºåˆ°index.htmlé¡µé¢ä¸Š
- 3. ï¼ˆå¦‚æœæœ‰viewé…ç½®ï¼‰æ‰“å¼€viewå¼¹çª—æˆ–æ„é€ viewç•Œé¢

> widgetæ¿€æ´»åæ‰§è¡Œæ–¹æ³•é¡ºåºï¼š
   create   =>      winCreateOK       =>    activate     =>       viewä¸­çš„ initWidgetView 


### 4.3 æµ‹è¯•å¼€å‘å¥½çš„widget
 å½“è¿˜æ²¡æœ‰èœå•æ—¶ï¼Œéœ€è¦æµ‹è¯•widgetåŠŸèƒ½ï¼Œå¯ä»¥2ç§æ–¹å¼ï¼š

 ä¸€æ˜¯åœ¨urlä¸­ä¼ å…¥widgetå‚æ•°æ–¹å¼æ¿€æ´»å¯¹åº”widgetæ¥æµ‹è¯•.æ¯”å¦‚ï¼š
 > [http://mars3d.cn/project/jcxm/index.html?widget=widgets/plot/widget.js](http://mars3d.cn/project/jcxm/index.html?widget=widgets/plot/widget.js)
 
 äºŒæ˜¯åœ¨widget.jsonä¸­å¯ä»¥åŠ é…ç½®` "debugger": true,`  æ‰“å¼€ widgetæµ‹è¯•æ  åŠŸèƒ½ï¼Œæ–¹ä¾¿æµ‹è¯•åŠè§¦å‘æ¿€æ´»widgetï¼Œå‘å¸ƒçš„æ­£å¼ç‰ˆæœ¬è®°å¾—æ”¹å› false æˆ–åˆ é™¤ã€‚
```json
{
  "debugger":true,
  "version": "20220120",
  "defaultOptions": {
    "style": "dark",
    "windowOptions": {
      "skin": "layer-mars-dialog animation-scale-up",
      "position": { "top": 50,  "right": 10 },
      "maxmin": true,
      "resize": true
    },
    "autoReset": false,
    "autoDisable": true,
    "disableOther": true
  },
  "openAtStart": [],
  "widgets": []
}
```
è¿è¡Œåæ•ˆæœï¼š
![image](/dev/img/guide/project-widget-testbar.jpg) 


## 4.4 å‘widgetä¼ å€¼ç¤ºä¾‹
 
åœ¨qyPointæ¨¡å—ä¸­(widgetsTS\qyPoint\widget.js)å•å‡»åœ°å›¾ä¸Šçš„ç‚¹åï¼Œæ¿€æ´»å¼¹å‡ºè¯¦æƒ…çª—å£qyDetailsViewæ¨¡å—

  ```js  
showDetails(item) { 
      mars3d.widget.activate({
         uri: 'widgetsTS/qyDetailsView/widget.js',
         dataQy: item,
      })
}
```

qyDetailsViewæ¨¡å—(widgetsTS\qyDetailsView\widget.js)ä¸­é€šè¿‡this.configè·å–ä¼ è¿‡æ¥çš„å€¼

```js  
getData() {
   var item = this.config.dataQy //ä¼ å…¥è¿‡æ¥çš„å‚æ•°
   return item
}
```


## 4.5 ä¸åŒwidgetä¹‹é—´çš„é€šä¿¡äº¤äº’ç¤ºä¾‹
 
å¯ä»¥åˆ©ç”¨mars3d.widgetä½œä¸ºæ¡¥æ¢ï¼Œé€šè¿‡äº‹ä»¶çš„æ–¹å¼äº¤äº’ï¼Œè¿™ç§æ¯”è¾ƒè‡ªç”±æ–¹ä¾¿ï¼Œæ³¨æ„é¡¹ç›®å†…**äº‹ä»¶åç§°å”¯ä¸€**å³å¯ã€‚

```js  
//æ¼”ç¤ºï¼šæŠ›å‡ºäº‹ä»¶ï¼Œåœ¨å…¶ä»–widgetæˆ–vueä¸­ç›‘å¬ä½¿ç”¨  widgets\centerXY\widget.js
mars3d.widget.fire("centerXY",{position:position })

//æ¼”ç¤ºï¼šæ¥æ”¶çš„widgetå†…æŠ›å‡ºçš„äº‹ä»¶  jsã€vueæˆ–å…¶ä»–widget.jsä¸­
mars3d.widget.on('centerXY', function (event) {
   console.log('åœ¨widgetè¿›è¡Œäº†åæ ‡å®šä½1', event)
})

//å¦‚æœåœ¨å¼¹çª—çš„view.jsä¸­
parent.mars3d.widget.on('centerXY', function (event) {
   console.log('åœ¨widgetè¿›è¡Œäº†åæ ‡å®šä½2', event)
})

```

### Aæ¨¡å— æŒç»­æ›´æ–°Bæ¨¡å—
åœ¨roamFlyæ¨¡å—ä¸­ï¼ŒåŠ¨æ€å»æ›´æ–°å·²æ‰“å¼€çš„roamCharsæ¨¡å—ï¼Œæ›´æ–°æ˜¾ç¤ºæ•°æ®
```js 
//æŒç»­æ›´æ–°
updateCharsWidgeFlyOk(alllen) { 
   //æŠ›å‡ºäº‹ä»¶
   mars3d.widget.fire("updateRoamChars",{ data:alllen })
}
```
roamCharsæ¨¡å—ä¸­ç›‘å¬äº‹ä»¶
```js 
create() {
   //æ¥æ”¶roamFlyçš„widgetå†…æŠ›å‡ºçš„äº‹ä»¶
   mars3d.widget.on('updateRoamChars', function (event) {
      console.log('æ¥æ”¶åˆ°äº†æ•°æ®', data)
   })
}
```


### 2ä¸ªiframeå¼¹çª—æ—¶ï¼ŒAçš„viewå†…è°ƒç”¨Bçš„viewå†… 
Aã€Bä¸¤ä¸ªéƒ½æ˜¯iframeå¼¹çª—æ¨¡å¼çš„widgetæ¨¡å—æ—¶ï¼Œåœ¨Aæ¨¡å—ä¸­çš„view.htmlä¸­éœ€è¦è°ƒç”¨Bæ¨¡å—çš„view.html

> ã€ä¸»é¡µé¢ã€‘widget.jséƒ½åœ¨index.htmlä¸»é¡µé¢; ã€iframeå­é¡µé¢ã€‘ 2ä¸ªview.htmlï¼ˆå«view.jsï¼‰æ˜¯iframeå­é¡µé¢ã€‚
 
å¦‚æœä¸ç”¨äº‹ä»¶æ—¶ï¼Œå…¶è°ƒç”¨æµç¨‹æ˜¯ä¸‹å›¾è¿‡ç¨‹ï¼š
 ![image](/dev/img/guide/project-widget-2view.jpg) 
 

å¦‚æœé€šè¿‡äº‹ä»¶æ–¹å¼å¯ä»¥ä¸‹é¢çš„æ–¹å¼ï¼š
```js  
//æ¼”ç¤ºï¼šåœ¨Aæ¨¡å—ä¸­çš„view.htmlä¸­æŠ›å‡ºäº‹ä»¶
parent.mars3d.widget.fire("widget2widget",{ data: position })

//æ¼”ç¤ºï¼šå¦‚æœåœ¨å¼¹çª—çš„view.jsä¸­
parent.mars3d.widget.on('widget2widget', function (event) {
   console.log('æ¥æ”¶åˆ°äº†Aæ¨¡å—æŠ›å‡ºçš„äº‹ä»¶', event)
})

```




## 5. å­¦ä¹ è·¯çº¿
ä»¥ä¸Šä»‹ç»çš„è¿™ä¹ˆåªæ˜¯è®©å¤§å®¶å¯¹Mars3DåŸºç¡€é¡¹ç›®çš„åŸºæœ¬æƒ…å†µå’Œæ¶æ„åšäº†æ¦‚è§ˆäº†è§£ã€‚ä¸‹ä¸€æ­¥å°±éœ€è¦å¤§å®¶é™ä¸‹å¿ƒæ¥é˜…è¯»ä»£ç äº†ï¼Œå­¦ä¹ æ²¡æœ‰æ·å¾„ï¼Œå¯ä»¥æŒ‰ä¸‹é¢è·¯çº¿ä¸€æ­¥æ­¥æ¥å­¦ä¹ ã€‚

æŸ¥çœ‹å·²æœ‰çš„3ä¸ª â€œexampleç¤ºä¾‹â€ç©ºç™½æ¨¡ç‰ˆçš„ä»£ç ã€é…ç½®ä¿¡æ¯ã€è¿è¡Œæ•ˆæœã€‚ç†Ÿæ‚‰widgetæœºåˆ¶ã€‚


> _exampleæ¨¡å— => å·²æœ‰çš„widgetsæ¨¡å— => ç¼–å†™å…¨æ–°çš„widget
 

 ![image](/dev/img/guide/project-widget-example.jpg) 
 
 

## Mars3D æ˜¯ä»€ä¹ˆ 
>  `Mars3Då¹³å°` æ˜¯[ç«æ˜Ÿç§‘æŠ€](http://marsgis.cn/)ç ”å‘çš„ä¸€æ¬¾åŸºäº WebGL æŠ€æœ¯å®ç°çš„ä¸‰ç»´å®¢æˆ·ç«¯å¼€å‘å¹³å°ï¼ŒåŸºäº[Cesium](https://cesium.com/cesiumjs/)ä¼˜åŒ–æå‡ä¸B/Sæ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šè¡Œä¸šæ‰©å±•çš„è½»é‡çº§é«˜æ•ˆèƒ½GISå¼€å‘å¹³å°ï¼Œèƒ½å¤Ÿå…å®‰è£…ã€æ— æ’ä»¶åœ°åœ¨æµè§ˆå™¨ä¸­é«˜æ•ˆè¿è¡Œï¼Œå¹¶å¯å¿«é€Ÿæ¥å…¥ä¸ä½¿ç”¨å¤šç§GISæ•°æ®å’Œä¸‰ç»´æ¨¡å‹ï¼Œå‘ˆç°ä¸‰ç»´ç©ºé—´çš„å¯è§†åŒ–ï¼Œå®Œæˆå¹³å°åœ¨ä¸åŒè¡Œä¸šçš„çµæ´»åº”ç”¨ã€‚

 > Mars3Då¹³å°å¯ç”¨äºæ„å»ºæ— æ’ä»¶ã€è·¨æ“ä½œç³»ç»Ÿã€ è·¨æµè§ˆå™¨çš„ä¸‰ç»´ GIS åº”ç”¨ç¨‹åºã€‚å¹³å°ä½¿ç”¨ WebGL æ¥è¿›è¡Œç¡¬ä»¶åŠ é€Ÿå›¾å½¢åŒ–ï¼Œè·¨å¹³å°ã€è·¨æµè§ˆå™¨æ¥å®ç°çœŸæ­£çš„åŠ¨æ€å¤§æ•°æ®ä¸‰ç»´å¯è§†åŒ–ã€‚é€šè¿‡ Mars3Däº§å“å¯å¿«é€Ÿå®ç°æµè§ˆå™¨å’Œç§»åŠ¨ç«¯ä¸Šç¾è§‚ã€æµç•…çš„ä¸‰ç»´åœ°å›¾å‘ˆç°ä¸ç©ºé—´åˆ†æã€‚

### ç›¸å…³ç½‘ç«™ 
- Mars3Då®˜ç½‘ï¼š[http://mars3d.cn](http://mars3d.cn)  

- Mars3Då¼€æºé¡¹ç›®åˆ—è¡¨ï¼š[https://github.com/marsgis/mars3d](https://github.com/marsgis/mars3d)


## ç‰ˆæƒè¯´æ˜
1. Mars3Då¹³å°ç”±[ç«æ˜Ÿç§‘æŠ€](http://marsgis.cn/)è‡ªä¸»ç ”å‘ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒåˆ©ã€‚
2. ä»»ä½•ä¸ªäººæˆ–ç»„ç»‡å¯ä»¥åœ¨éµå®ˆç›¸å…³è¦æ±‚ä¸‹å¯ä»¥å…è´¹æ— é™åˆ¶ä½¿ç”¨ã€‚
