!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es.number.constructor.js"),require("core-js/modules/es.array.is-array.js"),window.mars3d||require("mars3d"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.parse-float.js")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es.number.constructor.js","core-js/modules/es.array.is-array.js","mars3d","core-js/modules/es.array.reduce.js","core-js/modules/es.object.to-string.js","core-js/modules/es.parse-float.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["mars3d-supermap"]={},null,null,e.mars3d)}(this,(function(e,t,r,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,t}var i=n(o);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=f(e);if(t){var n=f(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return d(this,r)}}function v(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function _(){return _="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=v(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},_.apply(this,arguments)}var g=i.Cesium,b=function(e){y(r,e);var t=m(r);function r(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l(this,r),(e=t.call(this,o))._readyPromise=g.when.defer(),e}return c(r,[{key:"layer",get:function(){return this._layerArr}},{key:"readyPromise",get:function(){return this._readyPromise.promise}},{key:"s3mOptions",get:function(){return this.options.s3mOptions},set:function(e){for(var t in e){var r=e[t];this.options.s3mOptions[t]=r,"transparentBackColor"===t?r=g.Color.fromCssColorString(r):"transparentBackColorTolerance"===t&&(r=Number(r));for(var o=0;o<this._layerArr.length;o++){var n=this._layerArr[o];null!=n&&(n[t]=r)}}}},{key:"_mountedHook",value:function(){var e=this;(this.options.layername?this._map.scene.addS3MTilesLayerByScp(this.options.url,{name:this.options.layername,autoSetVie:this.options.flyTo,cullEnabled:this.options.cullEnabled}):this._map.scene.open(this.options.url,this.options.sceneName,{autoSetVie:this.options.flyTo})).then((function(t){Array.isArray(t)?e._layerArr=t:e._layerArr=[t];for(var r=0;r<e._layerArr.length;r++){var o=e._layerArr[r];if(o)try{e._initModelItem(o)}catch(e){i.Log.logError("s3m图层初始化出错",e)}}e.options.flyTo&&e.flyToByAnimationEnd(),e._readyPromise.resolve(e),e.fire(i.EventType.load,{layers:e._layerArr})}),(function(t){e._readyPromise.reject(t)}))}},{key:"_initModelItem",value:function(e){var t,r;if(this.options.s3mOptions)for(var o in this.options.s3mOptions){var n=this.options.s3mOptions[o];e[o]="transparentBackColor"===o?g.Color.fromCssColorString(n):"transparentBackColorTolerance"===o?Number(n):n}this.options.highlight&&(e.selectedColor=i.Util.getColorByStyle(this.options.highlight)),null!==(t=this.options)&&void 0!==t&&null!==(r=t.position)&&void 0!==r&&r.alt&&(e.style3D.altitudeMode=g.HeightReference.NONE,e.style3D.bottomAltitude=this.options.position.alt,e.refresh&&e.refresh())}},{key:"_addedHook",value:function(){for(var e in this._layerArr)this._layerArr[e].visible=!0,this._layerArr[e].show=!0}},{key:"_removedHook",value:function(){if(this._layerArr)for(var e in this._layerArr)this._layerArr[e].visible=!1,this._layerArr[e].show=!1}},{key:"setOpacity",value:function(e){if(this._layerArr)for(var t=0;t<this._layerArr.length;t++){var r=this._layerArr[t];null!=r&&(r.style3D.fillForeColor.alpha=e)}}},{key:"flyTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options.center?this._map.setCameraView(this.options.center,e):this.options.extent&&this._map.flyToExtent(this.options.extent,e)}}]),r}(i.layer.BaseLayer);i.layer.S3MLayer=b,i.LayerUtil.register("supermap_s3m",b);var j=i.Cesium,O=function(e){y(r,e);var t=m(r);function r(){return l(this,r),t.apply(this,arguments)}return c(r,[{key:"_createImageryProvider",value:function(e){return k(e)}},{key:"_addedHook",value:function(){_(f(r.prototype),"_addedHook",this).call(this),j.defined(this.options.transparentBackColor)&&(this._imageryLayer.transparentBackColor=i.Util.getCesiumColor(this.options.transparentBackColor),this._imageryLayer.transparentBackColorTolerance=this.options.transparentBackColorTolerance)}}]),r}(i.layer.BaseTileLayer);function k(e){return(e=i.LayerUtil.converOptions(e)).url instanceof j.Resource&&(e.url=e.url.url),j.defined(e.transparentBackColor)&&(delete e.transparentBackColor,delete e.transparentBackColorTolerance),new j.SuperMapImageryProvider(e)}O.createImageryProvider=k,i.layer.SmImgLayer=O;var P="supermap_img";i.LayerUtil.register(P,O),i.LayerUtil.registerImageryProvider(P,k);var w=i.Cesium,C=function(e){y(r,e);var t=m(r);function r(){return l(this,r),t.apply(this,arguments)}return c(r,[{key:"layer",get:function(){return this._mvtLayer}},{key:"_mountedHook",value:function(){var e=this;this._mvtLayer=this._map.scene.addVectorTilesMap(this.options),this._mvtLayer.readyPromise.then((function(e){}));var t=this._map.scene,r=new w.ScreenSpaceEventHandler(t.canvas);r.setInputAction((function(r){if(e.show){var o=i.PointUtil.getCurrentMousePosition(t,r.position);e._mvtLayer.queryRenderedFeatures([o],{}).reduce((function(t,n){var a=n.feature.properties;if(a){var s=i.Util.getPopupForConfig(e.options,a),l={data:a,event:r};e._map.openPopup(o,s,l)}}))}}),w.ScreenSpaceEventType.LEFT_CLICK),this.handler=r}},{key:"_addedHook",value:function(){this._mvtLayer.show=!0}},{key:"_removedHook",value:function(){this._mvtLayer&&(this._mvtLayer.show=!1)}},{key:"setOpacity",value:function(e){this._mvtLayer&&(this._mvtLayer.alpha=parseFloat(e))}},{key:"flyTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options.center?this._map.setCameraView(this.options.center,e):this.options.extent?this._map.flyToExtent(this.options.extent,e):this._mvtLayer&&this._map.camera.flyTo(s(s({},e),{},{destination:this._mvtLayer.rectangle}))}}]),r}(i.layer.BaseLayer);i.layer.SmMvtLayer=C,i.LayerUtil.register("supermap_mvt",C),e.S3MLayer=b,e.SmImgLayer=O,e.SmMvtLayer=C,Object.defineProperty(e,"__esModule",{value:!0})}));
