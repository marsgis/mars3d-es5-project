!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,window.mars3d||require("mars3d"),require("core-js/modules/es.date.to-string.js"),require("core-js/modules/es.function.name.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.index-of.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.is-array.js"),require("core-js/modules/es.array.splice.js"),require("core-js/modules/es.string.ends-with.js"),require("core-js/modules/es.array.last-index-of.js"),require("core-js/modules/es.regexp.constructor.js"),require("core-js/modules/es.string.replace.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.string.starts-with.js"),require("core-js/modules/es.number.constructor.js")):"function"==typeof define&&define.amd?define(["exports","mars3d","core-js/modules/es.date.to-string.js","core-js/modules/es.function.name.js","core-js/modules/es.object.to-string.js","core-js/modules/es.regexp.to-string.js","core-js/modules/es.array.index-of.js","core-js/modules/es.regexp.exec.js","core-js/modules/es.string.split.js","core-js/modules/es.array.map.js","core-js/modules/es.array.is-array.js","core-js/modules/es.array.splice.js","core-js/modules/es.string.ends-with.js","core-js/modules/es.array.last-index-of.js","core-js/modules/es.regexp.constructor.js","core-js/modules/es.string.replace.js","core-js/modules/es.array.slice.js","core-js/modules/es.array.concat.js","core-js/modules/es.array.find.js","core-js/modules/es.string.starts-with.js","core-js/modules/es.number.constructor.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["mars3d-widget"]={},e.mars3d)}(this,(function(e,t){"use strict";function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,t}var i=r(t);function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=u(e);if(t){var n=u(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return f(this,r)}}var p={exports:{}},h=p.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=h);var y={exports:{}},v=y.exports={version:"2.6.12"};"number"==typeof __e&&(__e=v);var g={},w=function(e){return"object"==typeof e?null!==e:"function"==typeof e},m=w,b=function(e){try{return!!e()}catch(e){return!0}},_=!b((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),j=w,x=p.exports.document,O=j(x)&&j(x.createElement),k=!_&&!b((function(){return 7!=Object.defineProperty((e="div",O?x.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),A=w,P=function(e){if(!m(e))throw TypeError(e+" is not an object!");return e},I=k,C=function(e,t){if(!A(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!A(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!A(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!A(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},W=Object.defineProperty;g.f=_?Object.defineProperty:function(e,t,r){if(P(e),t=C(t,!0),P(r),I)try{return W(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e};var T=g,E=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},V=_?function(e,t,r){return T.f(e,t,E(1,r))}:function(e,t,r){return e[t]=r,e},B={exports:{}},S={}.hasOwnProperty,D=0,q=Math.random(),z={exports:{}},H=y.exports,N=p.exports,R="__core-js_shared__",F=N[R]||(N[R]={});(z.exports=function(e,t){return F[e]||(F[e]=void 0!==t?t:{})})("versions",[]).push({version:H.version,mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"});var M,U=z.exports("native-function-to-string",Function.toString),K=p.exports,G=V,L=function(e,t){return S.call(e,t)},Q="Symbol(".concat(void 0===(M="src")?"":M,")_",(++D+q).toString(36)),$=U,J="toString",X=(""+$).split(J);y.exports.inspectSource=function(e){return $.call(e)},(B.exports=function(e,t,r,i){var n="function"==typeof r;n&&(L(r,"name")||G(r,"name",t)),e[t]!==r&&(n&&(L(r,Q)||G(r,Q,e[t]?""+e[t]:X.join(String(t)))),e===K?e[t]=r:i?e[t]?e[t]=r:G(e,t,r):(delete e[t],G(e,t,r)))})(Function.prototype,J,(function(){return"function"==typeof this&&this[Q]||$.call(this)}));var Y=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},Z=p.exports,ee=y.exports,te=V,re=B.exports,ie=function(e,t,r){if(Y(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}},ne=function(e,t,r){var i,n,o,s,a=e&ne.F,c=e&ne.G,u=e&ne.S,l=e&ne.P,f=e&ne.B,d=c?Z:u?Z[t]||(Z[t]={}):(Z[t]||{}).prototype,p=c?ee:ee[t]||(ee[t]={}),h=p.prototype||(p.prototype={});for(i in c&&(r=t),r)o=((n=!a&&d&&void 0!==d[i])?d:r)[i],s=f&&n?ie(o,Z):l&&"function"==typeof o?ie(Function.call,o):o,d&&re(d,i,o,e&ne.U),p[i]!=o&&te(p,i,s),l&&h[i]!=o&&(h[i]=o)};Z.core=ee,ne.F=1,ne.G=2,ne.S=4,ne.P=8,ne.B=16,ne.W=32,ne.U=64,ne.R=128;var oe=ne,se=p.exports.navigator,ae=se&&se.userAgent||"",ce=p.exports,ue=oe,le=[].slice,fe=/MSIE .\./.test(ae),de=function(e){return function(t,r){var i=arguments.length>2,n=!!i&&le.call(arguments,2);return e(i?function(){("function"==typeof t?t:Function(t)).apply(this,n)}:t,r)}};ue(ue.G+ue.B+ue.F*fe,{setTimeout:de(ce.setTimeout),setInterval:de(ce.setInterval)});var pe=new RegExp("\\.css"),he=document.head||document.getElementsByTagName("head")[0],ye=+navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/?(\d+).*/i,"$1")<536;function ve(e){return"complete"===e.readyState||"loaded"===e.readyState}function ge(e,t){var r;e.sheet&&(r=!0),setTimeout((function(){r?t():ge(e,t)}),20)}function we(e,t,r){var i="onload"in e;function n(){e.onload=e.onreadystatechange=null,e=null,t()}"css"===r&&(ye||!i)?setTimeout((function(){ge(e,t)}),1):i?(e.onload=n,e.onerror=function(t){e.onerror=null,"css"===r?console.error("该css文件不存在："+e.href,t):console.error("该js文件不存在："+e.src,t),n()}):e.onreadystatechange=function(){ve(e)&&n()}}function me(e,t,r,i){function n(){var r=t.indexOf(e);r>-1&&t.splice(r,1),0===t.length&&i()}e?pe.test(e)?function(e,t,r){var i=document.createElement("link");i.rel="stylesheet",we(i,r,"css"),i.async=!0,i.href=e,he.appendChild(i)}(e,0,n):function(e,t,r){var i=document.createElement("script");i.charset="utf-8",we(i,r,"js"),i.async=!t.sync,i.src=e,he.appendChild(i)}(e,r,n):setTimeout((function(){n()}))}function be(e,t,r){var i=function(){r&&r()};if(0!==(e=Array.prototype.slice.call(e||[])).length)for(var n=0,o=e.length;n<o;n++)me(e[n],e,t,i);else i()}function _e(e,t){if(ve(e))t();else{var r=!1;window.addEventListener("load",(function(){r||(t(),r=!0)})),setTimeout((function(){r||(t(),r=!0)}),1500)}}var je,xe,Oe,ke,Ae,Pe=function(e,t){_e(document,(function(){be(e,{},t)}))},Ie={beforeCreate:"beforeCreate",created:"created",beforeActivate:"beforeActivate",activated:"activated",openView:"openView",beforeDisable:"beforeDisable",disabled:"disabled",loadBefore:"loadBefore",load:"load"},Ce=window.jQuery,We=[],Te=["_class"];function Ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je=e,We=[],xe=i.Util.merge({windowOptions:{position:"rt",maxmin:!1,resize:!0},autoDisable:!0,disableOther:!0},t.defaultOptions),"time"===(Oe=t.version)&&(Oe=(new Date).getTime());var r=t.openAtStart;if(r&&r.length>0)for(var n=0;n<r.length;n++){var s=r[n];s.hasOwnProperty("uri")&&""!==s.uri?s.hasOwnProperty("visible")&&!s.visible||(s.autoDisable=!1,s.openAtStart=!0,s._nodebug=!0,Se(s),s._firstConfigBak=o({},s),We.push(s)):console.error("widget未配置uri",s)}if(ke=t.debugger){var a='<div id="widget-testbar" class="mars3d-widgetbar animation-slide-bottom no-print-view" >      <div style="height: 30px; line-height:30px;"><b style="color: #4db3ff;">widget测试栏</b>&nbsp;&nbsp;<button  id="widget-testbar-remove"  type="button" class="btn btn-link btn-xs">关闭</button> </div>     <button id="widget-testbar-disableAll" type="button" class="btn btn-info" ><i class="fa fa-globe"></i>漫游</button></div>';Ce("body").append(a),Ce("#widget-testbar-remove").click((function(e){Le()})),Ce("#widget-testbar-disableAll").click((function(e){Re()}))}if((r=t.widgets)&&r.length>0){for(var c=0;c<r.length;c++){var u=r[c];if("group"===u.type){for(var l=' <div class="btn-group dropup">  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-align-justify"></i>'+u.name+' <span class="caret"></span></button> <ul class="dropdown-menu">',f=0;f<u.children.length;f++){var d=u.children[f];d.hasOwnProperty("uri")&&""!==d.uri?(l+=' <li data-widget="'+d.uri+'" class="widget-btn" ><a href="#"><i class="fa fa-star"></i>'+d.name+"</a></li>",Se(d),d._firstConfigBak=o({},d),We.push(d)):console.error("widget未配置uri",d)}l+="</ul></div>",ke&&!u._nodebug&&Ce("#widget-testbar").append(l)}else{if(!u.hasOwnProperty("uri")||""===u.uri){console.error("widget未配置uri",u);continue}if(ke&&!u._nodebug){var p='<button type="button" class="btn btn-primary widget-btn" data-widget="'+u.uri+'"  > <i class="fa fa-globe"></i>'+u.name+" </button>";Ce("#widget-testbar").append(p)}Se(u),u._firstConfigBak=o({},u),We.push(u)}}ke&&Ce("#widget-testbar .widget-btn").each((function(){Ce(this).click((function(e){var t=Ce(this).attr("data-widget");t&&""!==t&&(He(t)?Ne(t):De(t))}))}))}for(var h=0;h<We.length;h++){var y=We[h];(y.openAtStart||y.createAtStart)&&Ke.push(y)}if(Ce(window).resize((function(){for(var e=0;e<We.length;e++){var t=We[e];t._class&&t._class.indexResize()}})),ke){var v=Be();v&&De(v)}Ge()}function Ve(){return i.Util.clone(xe.windowOptions,Te)}function Be(){var e=window.location.toString();return-1===e.indexOf("#")?"":(e=e.split("#"))&&e.length>0?e[1]:void 0}function Se(e){if(xe)for(var t in xe)"windowOptions"===t||e.hasOwnProperty(t)||(e[t]=xe[t]);var r,i;e.path=(r=""+e.uri,i=r.lastIndexOf("/"),r.substring(0,i+1)),e.name=e.name||e.label}function De(e,t){var r;!je&&e.map&&Ee(e.map,{},e.basePath),"string"==typeof e?(e={uri:e},null!=t&&(e.disableOther=!t)):e.uri||console.error("activate激活widget时需要uri参数！",e);for(var i=0;i<We.length;i++){var n=We[i];if(e.uri===n.uri||n.id&&e.uri===n.id){if((r=n).isloading)return r;for(var s in e)"uri"!==s&&(r[s]=e[s]);break}}if(r||(Se(e),r=e,e._firstConfigBak||(e._firstConfigBak=o({},e)),We.push(e)),ke&&(console.log("开始激活widget："+r.uri),window.location.hash="#"+r.uri),r.disableOther&&(Array.isArray(r.disableOther)?Ne(r.disableOther):Re(r.uri,r.group)),r.group&&Fe(r.group,r.uri),r._class)r._class.isActivate?r._class.update?r._class.update():function(e){clearInterval(Ae),e._class.disableBase(),Ae=setInterval((function(){e._class.isActivate||(e._class.activateBase(),clearInterval(Ae))}),200)}(r):r._class.activateBase();else{for(var a=0;a<Ke.length;a++)if(Ke[a].uri===r.uri)return Ke[a];Ke.push(r),1===Ke.length&&Ge()}return r}function qe(e){for(var t=0;t<We.length;t++){var r=We[t];if(e===r.uri||e===r.id)return r}}function ze(e){var t=qe(e);return t?t._class:null}function He(e){var t=ze(e);return!!t&&t.isActivate}function Ne(e){if(!e)return!1;if(Array.isArray(e))for(var t=e,r=0;r<We.length;r++)for(var i=We[r],n=0;n<t.length;n++){var o=t[n];if(i._class&&(o===i.uri||o===i.id)){i._class.disableBase(),t.splice(n,1);break}}else{"object"===s(e)&&(e=e.uri);for(var a=0;a<We.length;a++){var c=We[a];if(c._class&&(e===c.uri||e===c.id))return c._class.disableBase(),!0}}return!1}function Re(e,t){for(var r=0;r<We.length;r++){var i=We[r];if(t&&i.group===t);else if(!0!==e&&!i.autoDisable)continue;(!e||e!==i.uri&&e!==i.id)&&(i._class&&i._class.disableBase())}}function Fe(e,t){if(e)for(var r=0;r<We.length;r++){var i=We[r];if(i.group===e){if(t&&(t===i.uri||t===i.id))continue;i._class&&i._class.disableBase()}}}var Me,Ue,Ke=[];function Ge(){if(0!==Ke.length)if(Ue)setTimeout(Ge,500);else{Ue=!0,(Me=Ke[0]).isloading=!0;var e=Me.uri;Oe&&(-1===e.indexOf("?")?e+="?cache="+Oe:e+="&cache="+Oe),window.NProgress&&window.NProgress.start(),Je(Ie.loadBefore,{sourceTarget:Me}),Pe([""+e],(function(){Ue=!1,Me.isloading=!1,window.NProgress&&window.NProgress.done(!0),Ke.shift(),Ge()}))}}function Le(){Ce("#widget-testbar").remove()}function Qe(){return Oe}var $e=new i.BaseClass;function Je(e,t,r){return $e.fire(e,t,r)}var Xe={__proto__:null,init:Ee,getDefWindowOptions:Ve,activate:De,getWidget:qe,getClass:ze,isActivate:He,disable:Ne,disableAll:Re,disableGroup:Fe,eachWidget:function(e){for(var t=0;t<We.length;t++){e(We[t])}},bindClass:function(e){if(Je(Ie.load,{sourceTarget:e}),Me)return Me.isloading=!1,Me._class=new e(je,Me),Me._class.activateBase(),Me._class;for(var t=function(){for(var e,t=document.scripts,r=t.length-1;r>=0;r--)if((e=t[r].src)&&-1!==e.indexOf("widgets"))return e;return""}(),r=0;r<We.length;r++){var i=We[r];if(t.endsWith(i.uri))return i.isloading=!1,i._class=new e(je,i),i._class.activateBase(),i._class}},removeDebugeBar:Le,getCacheVersion:Qe,getBasePath:function(){return""},destroy:function(){for(var e=0;e<We.length;e++){var t=We[e];t._class&&(t._class.disableBase(),t._class.destroy&&t._class.destroy(),delete t._class)}je=null},eventTarget:$e,on:function(e,t,r){return $e.on(e,t,r)},off:function(e,t,r){return $e.off(e,t,r)},fire:Je,once:function(e,t,r){return $e.once(e,t,r)},listens:function(e,t){return $e.listens(e,t)}},Ye=window.jQuery,Ze=window.layer,et=i.BaseClass,tt=[],rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(u,e);var t,r,n,c=d(u);function u(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(r=c.call(this,t)).map=e,r.options=t,r.config=t,r.path=t.path||"",r.isActivate=!1,r.isCreate=!1,r._viewcreate_allcount=0,r._viewcreate_okcount=0,r._viewConfig=r.view,r.init(),r}return t=u,r=[{key:"resources",get:function(){return null}},{key:"view",get:function(){return null}},{key:"activateBase",value:function(){var e=this;if(this.isActivate)this.eachView((function(e){e._dom&&(Ye(".layui-layer").each((function(){Ye(this).css("z-index",19891e3)})),Ye(e._dom).css("z-index",19891014))}));else{if($e.fire(Ie.beforeActivate,{sourceTarget:this}),this.beforeActivate(),this.isActivate=!0,!this.isCreate){if($e.fire(Ie.beforeCreate,{sourceTarget:this}),this.resources&&this.resources.length>0){for(var t=[],r=0;r<this.resources.length;r++){var i=this.resources[r];i=this._getUrl(i),-1===tt.indexOf(i)&&t.push(i)}return tt=tt.concat(t),void Pe(t,(function(){var t=e.create((function(){e._createWidgetView(),e.isCreate=!0}));if($e.fire(Ie.created,{sourceTarget:e}),!t){if(e.options.createAtStart)return e.options.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);e._createWidgetView(),e.isCreate=!0}}))}var n=this.create((function(){e._createWidgetView(),this.isCreate=!0}));if($e.fire(Ie.created,{sourceTarget:this}),n)return;if(e.options.createAtStart)return e.options.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);this.isCreate=!0}this._createWidgetView()}}},{key:"init",value:function(){}},{key:"create",value:function(){}},{key:"_createWidgetView",value:function(){var e=this._viewConfig;if(void 0===e||null==e)this._startActivate();else if(Array.isArray(e)){this._viewcreate_allcount=e.length,this._viewcreate_okcount=0;for(var t=0;t<e.length;t++)this.createItemView(e[t])}else this._viewcreate_allcount=1,this._viewcreate_okcount=0,this.createItemView(e)}},{key:"eachView",value:function(e,t){var r=this._viewConfig;if(void 0===r||null==r)return!1;if(Array.isArray(r)){var i=!1;if(null!=t)return e(r[t]);for(var n=0;n<r.length;n++)i=e(r[n]);return i}return e(r)}},{key:"createItemView",value:function(e){var t=this;switch(e.type){case"divwindow":this._openDivWindow(e);break;case"append":t.getHtml(this._getUrl(e.url),(function(r){t._appendView(e,r)}));break;case"custom":e.open(this._getUrl(e.url),(function(r){t.winCreateOK(e,r),$e.fire(Ie.openView,{sourceTarget:t,view:e,dom:r}),t._viewcreate_okcount++,t._viewcreate_okcount>=t._viewcreate_allcount&&t._startActivate(r)}),this);break;default:this._openWindow(e)}}},{key:"_openWindow",value:function(e){var t=this,r=this._getUrl(e.url),n={type:2,content:[r,"no"],success:function(n,o){if(t.isActivate){e._layerIdx!==o&&(Ze.close(e._layerIdx),e._layerIdx=o),e._layerOpening=!1,e._dom=n;var s,a=window[n.find("iframe")[0].name];a.map=t.map,a.mars3d=i,a.Cesium=i.Cesium,t.options.css&&Ye("#layui-layer"+e._layerIdx).css(t.options.css),e.windowOptions.hasOwnProperty("show")&&!e.windowOptions.show&&Ye(n).hide(),Ze.setTop(n),t.winCreateOK(e,a),$e.fire(Ie.openView,{sourceTarget:t,view:e,dom:n}),t._viewcreate_okcount++,t._viewcreate_okcount>=t._viewcreate_allcount&&t._startActivate(n),a&&a.initWidgetView?(null!==(s=t.config)&&void 0!==s&&s.style&&Ye(a.document.body).addClass(t.config.style),a.initWidgetView(t)):i.Log.logError(r+"页面没有定义function initWidgetView(widget)方法，无法初始化widget页面!")}else Ze.close(o)}};e._layerIdx&&e._layerIdx>0&&(Ze.close(e._layerIdx),e._layerIdx=-1),e._layerOpening=!0,e._layerIdx=Ze.open(this._getWinOpt(e,n))}},{key:"_openDivWindow",value:function(e){var t=this,r=this._getUrl(e.url);this.getHtml(r,(function(r){var i={type:1,content:r,success:function(r,i){t.isActivate?(e._layerIdx!==i&&(Ze.close(e._layerIdx),e._layerIdx=i),e._layerOpening=!1,e._dom=r,e.windowOptions.hasOwnProperty("show")&&!e.windowOptions.show&&Ye(r).hide(),Ze.setTop(r),t.winCreateOK(e,r),$e.fire(Ie.openView,{sourceTarget:t,view:e,dom:r}),t._viewcreate_okcount++,t._viewcreate_okcount>=t._viewcreate_allcount&&t._startActivate(r)):Ze.close(i)}};e._layerOpening=!0,e._layerIdx=Ze.open(t._getWinOpt(e,i))}))}},{key:"_getUrl",value:function(e){return(e=this.addCacheVersion(e)).startsWith("/")||e.startsWith(".")||e.startsWith("http")?e:this.path+e}},{key:"_getWinOpt",value:function(e,t){var r=o(o(o({},Ve()),e.windowOptions),this.options.windowOptions);e.windowOptions=r;var i=this,n=this._getWinSize(r),s=!1;return r.noTitle||(s=this.options.name||" ",this.options.icon&&(s='<i class="'+this.options.icon+'" ></i>&nbsp;'+s)),o(o(o({},{title:s,area:n.area,offset:n.offset,shade:0,maxmin:!1,beforeEnd:function(){i.beforeDisable()},end:function(){e._layerIdx=-1,e._dom=null,i.disableBase()},full:function(e){i.winFull(e)},min:function(e){i.winMin(e)},restore:function(e){i.winRestore(e)}}),r),t)}},{key:"_getWinSize",value:function(e){var t=this.bfb2Number(e.width,document.documentElement.clientWidth,e),r=this.bfb2Number(e.height,document.documentElement.clientHeight,e),i="",n=e.position;if(n)if("string"==typeof n)i=n;else if("object"===s(n)){var o,a;if(n.hasOwnProperty("top")&&null!=n.top&&(o=this.bfb2Number(n.top,document.documentElement.clientHeight,e)),n.hasOwnProperty("bottom")&&null!=n.bottom){e._hasresize=!0;var c=this.bfb2Number(n.bottom,document.documentElement.clientHeight,e);null!=o?r=document.documentElement.clientHeight-o-c:o=document.documentElement.clientHeight-r-c}if(n.hasOwnProperty("left")&&null!=n.left&&(a=this.bfb2Number(n.left,document.documentElement.clientWidth,e)),n.hasOwnProperty("right")&&null!=n.right){e._hasresize=!0;var u=this.bfb2Number(n.right,document.documentElement.clientWidth,e);null!=a?t=document.documentElement.clientWidth-a-u:a=document.documentElement.clientWidth-t-u}null!=o&&void 0!==o||(o=(document.documentElement.clientHeight-r)/2),null!=a&&void 0!==a||(a=(document.documentElement.clientWidth-t)/2),i=[o+"px",a+"px"]}return e.hasOwnProperty("minHeight")&&r<e.minHeight&&(e._hasresize=!0,r=e.minHeight),e.hasOwnProperty("maxHeight")&&r>e.maxHeight&&(e._hasresize=!0,r=e.maxHeight),e.hasOwnProperty("minWidth")&&t<e.minWidth&&(e._hasresize=!0,t=e.minWidth),e.hasOwnProperty("maxWidth")&&t>e.maxWidth&&(e._hasresize=!0,t=e.maxWidth),{area:t&&r?[t+"px",r+"px"]:t+"px",offset:i}}},{key:"indexResize",value:function(){if(this.isActivate){var e=this;this.eachView((function(t){if(t._layerIdx&&-1!==t._layerIdx&&t.windowOptions&&t.windowOptions._hasresize){var r=e._getWinSize(t.windowOptions),i={};Array.isArray(r.area)&&(r.area[0]&&(i.width=r.area[0]),r.area[1]&&(i.height=r.area[1])),Array.isArray(r.offset)&&(r.offset[1]&&(i.top=r.offset[0]),r.offset[1]&&(i.left=r.offset[1])),Ye(t._dom).attr("myTopLeft",!0),Ze.style(t._layerIdx,i),"divwindow"===t.type&&Ze.iframeAuto(t._layerIdx)}}))}}},{key:"_appendView",value:function(e,t){e._dom=Ye(t).appendTo(e.parent||"body"),this.options.css&&Ye(e._dom).css(this.options.css),this.winCreateOK(e,t),this._viewcreate_okcount++,this._viewcreate_okcount>=this._viewcreate_allcount&&this._startActivate(t)}},{key:"winCreateOK",value:function(e,t){}},{key:"winFull",value:function(){}},{key:"winMin",value:function(){}},{key:"minView",value:function(){this.eachView((function(e){e._layerIdx&&Ze.min(e._layerIdx,e)}))}},{key:"restoreView",value:function(){this.eachView((function(e){e._layerIdx&&Ze.restore(e._layerIdx)}))}},{key:"fullView",value:function(){this.eachView((function(e){e._layerIdx&&Ze.full(e._layerIdx,e)}))}},{key:"winRestore",value:function(){}},{key:"_startActivate",value:function(e){this.activate(e),$e.fire(Ie.activated,{sourceTarget:this}),this.options.success&&(this.options.success(this),delete this.options.success),this.isActivate||this.disableBase()}},{key:"beforeActivate",value:function(){}},{key:"activate",value:function(){}},{key:"disableBase",value:function(){this.isActivate&&(this.isActivate=!1,this.beforeDisable(),$e.fire(Ie.beforeDisable,{sourceTarget:this}),this.eachView((function(e){return e._layerIdx&&e._layerIdx>0?(Ze.close(e._layerIdx),e._layerOpening||(e._layerIdx=-1),!0):("append"===e.type&&e._dom&&(e._dom.remove(),e._dom=null),"custom"===e.type&&e.close&&e.close(),!1)})),this.disable(),this.options.autoReset&&this.resetConfig(),$e.fire(Ie.disabled,{sourceTarget:this}))}},{key:"beforeDisable",value:function(){}},{key:"disable",value:function(){}},{key:"bfb2Number",value:function(e,t,r){return"string"==typeof e&&-1!==e.indexOf("%")?(r._hasresize=!0,t*Number(e.replace("%",""))/100):e}},{key:"addCacheVersion",value:function(e){if(!e)return e;var t=Qe();return t&&(-1===e.indexOf("?")?e+="?cache="+t:-1===e.indexOf("cache="+t)&&(e+="&cache="+t)),e}},{key:"resetConfig",value:function(){if(this.options._firstConfigBak){var e=this.options._firstConfigBak;for(var t in e)"uri"!==t&&(this.options[t]=e[t])}}},{key:"setViewShow",value:function(e,t){this.eachView((function(t){t._layerIdx&&t._layerIdx>0?e?Ye("#layui-layer"+t._layerIdx).show():Ye("#layui-layer"+t._layerIdx).hide():"append"===t.type&&t._dom&&(e?Ye(t._dom).show():Ye(t._dom).hide())}),t)}},{key:"setViewCss",value:function(e,t){this.eachView((function(t){null!=t._layerIdx&&t._layerIdx>0?Ze.style(t._layerIdx,e):"append"===t.type&&t._dom&&Ye(t._dom).css(e)}),t)}},{key:"setTitle",value:function(e,t){this.eachView((function(t){t._dom&&t._dom.find(".layui-layer-title").html(e)}),t)}},{key:"getHtml",value:function(e,t){Ye.ajax({url:e,type:"GET",dataType:"html",timeout:0,success:function(e){t(e)}})}}],r&&a(t.prototype,r),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(et);i.widget=Xe,i.widget.BaseWidget=rt,i.widget.WidgetEventType=Ie,i.widget.EventType=Ie,e.widget=Xe,Object.defineProperty(e,"__esModule",{value:!0})}));
