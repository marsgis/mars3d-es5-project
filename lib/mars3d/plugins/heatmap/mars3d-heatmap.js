/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.4.26
 * 编译日期：2023-03-09 16:01:20
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2022-06-01
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';function _0x6f67(){var _0x2bc985=['488bbqxQb','1105270GTPHJX','defineProperty','8910LKJQXX','container','_mountedHook','addGraphic','DomUtil','min','_graphic','3459600GFcPts','maxCanvasSize','1672184kVxVnE','setPositions','PolyUtil','create','xmin','push','85141iEQnqb','_createGraphic','PointTrans','max','height','heatStyle','_removedHook','arcBlurScale','blur','prototype','getValueAt','width:','_scale','uniforms','_graphic2','options','xmax','arc','KEEP','fromCache','BlendingState','clear','radius','rgb(140,140,140)','image','rectangle','minCanvasSize','REPLACE','StencilOperation','this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called','LngLatPoint','3039234bOmquw','_addedHook','concat','_positions','graphic','lat','round','configure','function','_rectangle','394DyKCKe','Util','fromDegrees','arcDirection','flyTo','canvas','body','keys','granularity','style','length','mercator2lonlat','5107PasHpf','_last_mBounds','isFormat','enumerable','642opIYlk','3USKkVm','copyCanvas','_map','lng','ymax','positions','diffHeight','ymin','register','RectanglePrimitive','_layer','bumpMap','abs','_last_heatData','forEach','_heat','ALWAYS'];_0x6f67=function(){return _0x2bc985;};return _0x6f67();}var _0x12d109=_0x3206;(function(_0x3cd88e,_0x162379){var _0x4827f5={_0xc2fc27:0x1a1,_0x6b3e68:0x1b2,_0xd373c1:0x1c4},_0x3c5fd7=_0x3206,_0x4d0149=_0x3cd88e();while(!![]){try{var _0x107e75=-parseInt(_0x3c5fd7(0x1ad))/0x1*(parseInt(_0x3c5fd7(_0x4827f5._0xc2fc27))/0x2)+-parseInt(_0x3c5fd7(_0x4827f5._0x6b3e68))/0x3*(parseInt(_0x3c5fd7(0x1cf))/0x4)+parseInt(_0x3c5fd7(0x1cd))/0x5+parseInt(_0x3c5fd7(0x1b1))/0x6*(parseInt(_0x3c5fd7(0x1d5))/0x7)+-parseInt(_0x3c5fd7(0x1c3))/0x8*(-parseInt(_0x3c5fd7(0x1c6))/0x9)+-parseInt(_0x3c5fd7(_0x4827f5._0xd373c1))/0xa+parseInt(_0x3c5fd7(0x197))/0xb;if(_0x107e75===_0x162379)break;else _0x4d0149['push'](_0x4d0149['shift']());}catch(_0x3ac052){_0x4d0149['push'](_0x4d0149['shift']());}}}(_0x6f67,0xc2301));function _interopNamespace(_0xae5ddc){var _0x19d331={_0x2298ef:0x1a8},_0x30d405=_0x3206;if(_0xae5ddc&&_0xae5ddc['__esModule'])return _0xae5ddc;var _0x3dd95b=Object['create'](null);return _0xae5ddc&&Object[_0x30d405(_0x19d331._0x2298ef)](_0xae5ddc)['forEach'](function(_0x219a01){if(_0x219a01!=='default'){var _0x4c56ca=Object['getOwnPropertyDescriptor'](_0xae5ddc,_0x219a01);Object['defineProperty'](_0x3dd95b,_0x219a01,_0x4c56ca['get']?_0x4c56ca:{'enumerable':!![],'get':function(){return _0xae5ddc[_0x219a01];}});}}),_0x3dd95b['default']=_0xae5ddc,_0x3dd95b;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337);function ownKeys(_0x28c340,_0x1d1c1d){var _0x1591ed={_0xa81a65:0x1d4},_0x3e8ee7=_0x3206,_0x310bad=Object['keys'](_0x28c340);if(Object['getOwnPropertySymbols']){var _0x9ac21d=Object['getOwnPropertySymbols'](_0x28c340);_0x1d1c1d&&(_0x9ac21d=_0x9ac21d['filter'](function(_0x1222d0){return Object['getOwnPropertyDescriptor'](_0x28c340,_0x1222d0)['enumerable'];})),_0x310bad[_0x3e8ee7(_0x1591ed._0xa81a65)]['apply'](_0x310bad,_0x9ac21d);}return _0x310bad;}function _objectSpread2(_0x4bb3fb){var _0x2d3856=_0x3206;for(var _0x28745b=0x1;_0x28745b<arguments[_0x2d3856(0x1ab)];_0x28745b++){var _0x3e6712=null!=arguments[_0x28745b]?arguments[_0x28745b]:{};_0x28745b%0x2?ownKeys(Object(_0x3e6712),!0x0)['forEach'](function(_0x33f5fe){_defineProperty(_0x4bb3fb,_0x33f5fe,_0x3e6712[_0x33f5fe]);}):Object['getOwnPropertyDescriptors']?Object['defineProperties'](_0x4bb3fb,Object['getOwnPropertyDescriptors'](_0x3e6712)):ownKeys(Object(_0x3e6712))['forEach'](function(_0x39b20f){Object['defineProperty'](_0x4bb3fb,_0x39b20f,Object['getOwnPropertyDescriptor'](_0x3e6712,_0x39b20f));});}return _0x4bb3fb;}function _classCallCheck(_0x21cdbf,_0x2829ad){if(!(_0x21cdbf instanceof _0x2829ad))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x458a2d,_0x2362d6){var _0x11d3d2={_0x5b13a1:0x1ab,_0x1576a8:0x1c5},_0x2a6185=_0x3206;for(var _0x3ea5c9=0x0;_0x3ea5c9<_0x2362d6[_0x2a6185(_0x11d3d2._0x5b13a1)];_0x3ea5c9++){var _0x1c0e9f=_0x2362d6[_0x3ea5c9];_0x1c0e9f[_0x2a6185(0x1b0)]=_0x1c0e9f['enumerable']||![],_0x1c0e9f['configurable']=!![];if('value'in _0x1c0e9f)_0x1c0e9f['writable']=!![];Object[_0x2a6185(_0x11d3d2._0x1576a8)](_0x458a2d,_0x1c0e9f['key'],_0x1c0e9f);}}function _createClass(_0x41aca4,_0x4254be,_0x25fd06){var _0x38f726=_0x3206;if(_0x4254be)_defineProperties(_0x41aca4[_0x38f726(0x181)],_0x4254be);if(_0x25fd06)_defineProperties(_0x41aca4,_0x25fd06);return Object['defineProperty'](_0x41aca4,'prototype',{'writable':![]}),_0x41aca4;}function _defineProperty(_0x29ab4b,_0xcc905a,_0x3b8295){return _0xcc905a in _0x29ab4b?Object['defineProperty'](_0x29ab4b,_0xcc905a,{'value':_0x3b8295,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x29ab4b[_0xcc905a]=_0x3b8295,_0x29ab4b;}function _inherits(_0x13b401,_0x358569){var _0x52c9ea={_0xb4ec16:0x19f,_0x579eba:0x181},_0x2d521e=_0x3206;if(typeof _0x358569!==_0x2d521e(_0x52c9ea._0xb4ec16)&&_0x358569!==null)throw new TypeError('Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function');_0x13b401[_0x2d521e(_0x52c9ea._0x579eba)]=Object[_0x2d521e(0x1d2)](_0x358569&&_0x358569[_0x2d521e(0x181)],{'constructor':{'value':_0x13b401,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x13b401,'prototype',{'writable':![]});if(_0x358569)_setPrototypeOf(_0x13b401,_0x358569);}function _getPrototypeOf(_0xee6e9c){return _getPrototypeOf=Object['setPrototypeOf']?Object['getPrototypeOf']['bind']():function _0x12dd1c(_0x17544c){return _0x17544c['__proto__']||Object['getPrototypeOf'](_0x17544c);},_getPrototypeOf(_0xee6e9c);}function _setPrototypeOf(_0x3e7193,_0x57fd4b){return _setPrototypeOf=Object['setPrototypeOf']?Object['setPrototypeOf']['bind']():function _0x3c0702(_0x5381c4,_0x3704fe){return _0x5381c4['__proto__']=_0x3704fe,_0x5381c4;},_setPrototypeOf(_0x3e7193,_0x57fd4b);}function _isNativeReflectConstruct(){if(typeof Reflect==='undefined'||!Reflect['construct'])return![];if(Reflect['construct']['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype']['valueOf']['call'](Reflect['construct'](Boolean,[],function(){})),!![];}catch(_0x298aeb){return![];}}function _assertThisInitialized(_0x4fb4bd){var _0x3b25ab={_0x3eb0a4:0x195},_0x2bf798=_0x3206;if(_0x4fb4bd===void 0x0)throw new ReferenceError(_0x2bf798(_0x3b25ab._0x3eb0a4));return _0x4fb4bd;}function _possibleConstructorReturn(_0x3152fb,_0x2fbdd2){if(_0x2fbdd2&&(typeof _0x2fbdd2==='object'||typeof _0x2fbdd2==='function'))return _0x2fbdd2;else{if(_0x2fbdd2!==void 0x0)throw new TypeError('Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined');}return _assertThisInitialized(_0x3152fb);}function _createSuper(_0x18004f){var _0x19ab4a=_isNativeReflectConstruct();return function _0x5674c0(){var _0x38beae=_getPrototypeOf(_0x18004f),_0x3cf4bc;if(_0x19ab4a){var _0x15d6f7=_getPrototypeOf(this)['constructor'];_0x3cf4bc=Reflect['construct'](_0x38beae,arguments,_0x15d6f7);}else _0x3cf4bc=_0x38beae['apply'](this,arguments);return _possibleConstructorReturn(this,_0x3cf4bc);};}var HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture2D(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';function _0x3206(_0x12f6d4,_0x4a13f1){var _0x6f67b4=_0x6f67();return _0x3206=function(_0x320693,_0x354da2){_0x320693=_0x320693-0x180;var _0x1cd22e=_0x6f67b4[_0x320693];return _0x1cd22e;},_0x3206(_0x12f6d4,_0x4a13f1);}if(!h337__namespace['create'])throw new Error('请引入\x20heatmap.js\x20库\x20');var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:'blue',0.6:'green',0.8:'yellow',0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']},HeatLayer=function(_0x5951f7){var _0x17ebee={_0x104a4f:0x1aa,_0x106ea6:0x1c8,_0x152626:0x198,_0x4875f1:0x1db,_0x2dd1e4:0x1d0,_0x3cd6ac:0x18d},_0x417c6b={_0x5153f0:0x196,_0x3f982b:0x182},_0x3273a3={_0x1a450d:0x1c1,_0x4d592b:0x18e,_0x375656:0x18f,_0x1f8efa:0x1c1,_0x156b66:0x19e},_0x19a648={_0x55408c:0x1b6,_0x1b1bd1:0x1b9,_0xf53409:0x1cb,_0x23297a:0x187,_0x3f3faa:0x1da,_0xc8898d:0x1a0,_0x2bb852:0x1b9,_0x2b98ea:0x1ae,_0x5e4472:0x188,_0x3899ab:0x1ae,_0x3a1f84:0x1da,_0x424a30:0x183,_0x50ea5c:0x1c1},_0xb293fc={_0x26f253:0x19d,_0x21a097:0x1d3,_0x19c7ec:0x19d},_0x51f8ef={_0x720c40:0x1af,_0x2d5575:0x1a0,_0x2b343a:0x1d1},_0x55e974={_0x6eae38:0x194,_0x17ce68:0x18c,_0x3f0c95:0x1b8,_0x2623cf:0x1d9,_0x30f8bc:0x1a0,_0x36a0d0:0x19b,_0x462647:0x1bc,_0x571a3c:0x1c9,_0x31d719:0x1a4},_0x5c04b4={_0x42c753:0x1b4,_0x3a769e:0x189,_0x5e3a7c:0x1cc,_0x194124:0x190,_0x466dd9:0x186,_0x496239:0x185,_0x221734:0x185},_0x4dffd9={_0x3717f2:0x1cc},_0x5d96fa={_0x52ee84:0x1c7},_0x514c89={_0x2a8b13:0x1c0},_0x5b633b={_0x3e8e1f:0x1d0},_0x1a5de3={_0x3971c1:0x187},_0x1e91a5={_0x19b0e4:0x1da},_0x6350fa={_0x5094fd:0x1a7,_0x3dd989:0x1a7,_0x348092:0x192,_0xdf4323:0x187},_0x4e0393=_0x3206;_inherits(_0x1ab6b6,_0x5951f7);var _0x4f4dd5=_createSuper(_0x1ab6b6);function _0x1ab6b6(){var _0x91a46=_0x3206,_0x5e717a,_0x2ec436,_0x1d6f01,_0x546f9a=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x1ab6b6),_0x1d6f01=_0x4f4dd5['call'](this,_0x546f9a),_0x1d6f01['options']['maxCanvasSize']=(_0x5e717a=_0x1d6f01['options']['maxCanvasSize'])!==null&&_0x5e717a!==void 0x0?_0x5e717a:document[_0x91a46(_0x6350fa._0x5094fd)]['clientWidth'],_0x1d6f01['options'][_0x91a46(0x1ce)]=Math['min'](_0x1d6f01[_0x91a46(0x187)]['maxCanvasSize'],0x1388),_0x1d6f01['options']['minCanvasSize']=(_0x2ec436=_0x1d6f01['options']['minCanvasSize'])!==null&&_0x2ec436!==void 0x0?_0x2ec436:document[_0x91a46(_0x6350fa._0x3dd989)]['clientHeight'],_0x1d6f01[_0x91a46(0x187)][_0x91a46(0x192)]=Math['max'](_0x1d6f01[_0x91a46(0x187)][_0x91a46(_0x6350fa._0x348092)],0x2bc),_0x1d6f01['options']['heatStyle']=_objectSpread2(_objectSpread2({},DEF_HEATSTYLE),_0x1d6f01[_0x91a46(_0x6350fa._0xdf4323)]['heatStyle']||{}),_0x1d6f01['options'][_0x91a46(0x1aa)]=_objectSpread2(_objectSpread2({},DEF_STYLE),_0x1d6f01[_0x91a46(_0x6350fa._0xdf4323)]['style']||{}),_0x1d6f01;}return _createClass(_0x1ab6b6,[{'key':'layer','get':function _0x2911dc(){return this['_layer'];}},{'key':_0x4e0393(0x1da),'get':function _0x56da05(){return this['options']['heatStyle'];},'set':function _0x44e5d2(_0x10c30a){var _0x4ca45a=_0x4e0393;this[_0x4ca45a(0x187)]['heatStyle']=mars3d__namespace['Util']['merge'](this['options']['heatStyle'],_0x10c30a),this['_heat']&&(this['_heat']['configure'](this[_0x4ca45a(0x187)][_0x4ca45a(_0x1e91a5._0x19b0e4)]),this['_updatePositionsHook'](!![]));}},{'key':_0x4e0393(_0x17ebee._0x104a4f),'get':function _0x27ac14(){var _0x122c0e=_0x4e0393;return this['options'][_0x122c0e(0x1aa)];},'set':function _0x44a88a(_0x3c04bc){var _0x7a6348=_0x4e0393;this[_0x7a6348(_0x1a5de3._0x3971c1)]['style']=mars3d__namespace[_0x7a6348(0x1a2)]['merge'](this['options'][_0x7a6348(0x1aa)],_0x3c04bc);}},{'key':'positions','get':function _0x39c88c(){var _0x164789=_0x4e0393;return this[_0x164789(0x19a)];},'set':function _0x364776(_0x3fdfba){var _0x49dc97=_0x4e0393;this[_0x49dc97(_0x5b633b._0x3e8e1f)](_0x3fdfba);}},{'key':'coordinates','get':function _0x5ddccf(){var _0x191557=_0x4e0393,_0x31db9b=[];return this['points'][_0x191557(_0x514c89._0x2a8b13)](function(_0x5b8d38){_0x31db9b['push'](_0x5b8d38['toArray']());}),_0x31db9b;}},{'key':'rectangle','get':function _0x5b7aa0(){return this['_rectangle'];}},{'key':'_setOptionsHook','value':function _0x20ef70(_0x358da2,_0x5e18bf){var _0x99dad4=_0x4e0393;_0x358da2['positions']&&(this['positions']=_0x358da2[_0x99dad4(0x1b7)]);}},{'key':_0x4e0393(_0x17ebee._0x106ea6),'value':function _0x28c439(){var _0x4f4150=_0x4e0393;this['style']['type']===_0x4f4150(0x190)?this['_layer']=new mars3d__namespace['layer']['ImageLayer']({'crs':'EPSG:3857','private':!![]}):this['_layer']=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}},{'key':_0x4e0393(_0x17ebee._0x152626),'value':function _0x3e8010(){var _0x1af929=_0x4e0393;this['_map']['addLayer'](this['_layer']),this[_0x1af929(0x187)]['positions']&&(this['positions']=this[_0x1af929(0x187)]['positions']),this['options'][_0x1af929(0x1a5)]&&this['flyToByAnimationEnd']();}},{'key':_0x4e0393(_0x17ebee._0x4875f1),'value':function _0x275d81(){var _0x52ab12=_0x4e0393;this[_0x52ab12(0x1da)][_0x52ab12(_0x5d96fa._0x52ee84)]&&(mars3d__namespace[_0x52ab12(0x1ca)]['remove'](this['heatStyle']['container']),delete this['heatStyle']['container']),this['clear'](),this['_map']['removeLayer'](this['_layer']);}},{'key':'addPosition','value':function _0x19c374(_0x268c9c,_0x2f84e7){this['_positions']=this['_positions']||[],this['_positions']['push'](_0x268c9c),this['_updatePositionsHook'](_0x2f84e7);}},{'key':_0x4e0393(_0x17ebee._0x2dd1e4),'value':function _0x5e0e3c(_0x211cd5,_0xcda8a3){this['_positions']=_0x211cd5,this['_updatePositionsHook'](_0xcda8a3);}},{'key':_0x4e0393(_0x17ebee._0x3cd6ac),'value':function _0x125dfa(){var _0x359d14=_0x4e0393;this['_graphic']&&(this['_layer']['removeGraphic'](this[_0x359d14(0x1cc)],!![]),delete this[_0x359d14(_0x4dffd9._0x3717f2)]),this['_graphic2']&&(this['_layer']['removeGraphic'](this['_graphic2'],!![]),delete this['_graphic2']);}},{'key':'_updatePositionsHook','value':function _0x1ec1ba(_0x2e0ae7){var _0x5a44a0=_0x4e0393;if(!this['show']||!this[_0x5a44a0(_0x5c04b4._0x42c753)]||!this[_0x5a44a0(0x1b7)]||this['positions'][_0x5a44a0(0x1ab)]===0x0)return this;var _0x348bde=this['_getHeatCanvas']();if(this['style']['type']==='image')this['_layer']['setOptions']({'url':_0x348bde['toDataURL']('image/png'),'rectangle':this[_0x5a44a0(0x1a0)],'opacity':this[_0x5a44a0(0x1aa)]['opacity']});else this[_0x5a44a0(0x1aa)][_0x5a44a0(_0x5c04b4._0x3a769e)]?this[_0x5a44a0(_0x5c04b4._0x5e3a7c)]&&_0x2e0ae7?(this['_graphic']['uniforms'][_0x5a44a0(_0x5c04b4._0x194124)]=_0x348bde,this[_0x5a44a0(0x1cc)]['uniforms']['bumpMap']=this['_getArcHeatCanvas'](),this['_graphic2']&&(this[_0x5a44a0(_0x5c04b4._0x466dd9)][_0x5a44a0(_0x5c04b4._0x496239)]['image']=_0x348bde,this['_graphic2']['uniforms']['bumpMap']=this[_0x5a44a0(_0x5c04b4._0x5e3a7c)][_0x5a44a0(_0x5c04b4._0x221734)][_0x5a44a0(0x1bd)])):this['_createArcGraphic'](_0x348bde):this['_graphic']&&_0x2e0ae7?this['_graphic']['uniforms']['image']=_0x348bde:this['_createGraphic'](_0x348bde);return this;}},{'key':_0x4e0393(0x1d6),'value':function _0x3cd674(_0x357ecc){this['clear'](),this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'material':new Cesium['Material']({'fabric':{'uniforms':{'image':_0x357ecc},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})})),this['_layer']['addGraphic'](this['_graphic']);}},{'key':'_createArcGraphic','value':function _0x495823(_0x3dc3db){var _0x53c0fc=_0x4e0393,_0x244d38;this['clear']();var _0x1f5eab=Cesium['RenderState'][_0x53c0fc(0x18b)]({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation'][_0x53c0fc(0x193)]},'backFunction':Cesium['StencilFunction'][_0x53c0fc(0x1c2)],'backOperation':{'fail':Cesium['StencilOperation'][_0x53c0fc(0x18a)],'zFail':Cesium[_0x53c0fc(_0x55e974._0x6eae38)]['KEEP'],'zPass':Cesium['StencilOperation'][_0x53c0fc(0x193)]},'reference':0x2,'mask':0x2},'blending':Cesium[_0x53c0fc(_0x55e974._0x17ce68)]['ALPHA_BLEND']}),_0xfea61c=Math['floor']((_0x244d38=this['style']['diffHeight'])!==null&&_0x244d38!==void 0x0?_0x244d38:this['_mBoundsMax']*0.02)+0.1;this['style']['diffHeight']&&delete this['style'][_0x53c0fc(_0x55e974._0x3f0c95)];var _0x2f474c=(this[_0x53c0fc(0x1aa)]['splitNum'],0x64),_0x2a9780=Math['max'](this['_rectangle'][_0x53c0fc(_0x55e974._0x2623cf)],this[_0x53c0fc(_0x55e974._0x30f8bc)]['width']);this['style'][_0x53c0fc(0x1a9)]=_0x2a9780/=_0x2f474c;var _0x231b3c=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x3dc3db,'repeat':new Cesium['Cartesian2'](0x1,0x1),'color':new Cesium['Color'](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0x5b7c18=this['style']['arcDirection']||0x1;this['_graphic']=new mars3d__namespace[(_0x53c0fc(_0x55e974._0x36a0d0))]['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this[_0x53c0fc(0x187)]),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x1f5eab,'material':_0x231b3c,'vertexShaderSource':getVertexShaderSource(_0xfea61c*_0x5b7c18)})})),this[_0x53c0fc(_0x55e974._0x462647)][_0x53c0fc(_0x55e974._0x571a3c)](this['_graphic']),this[_0x53c0fc(0x1aa)][_0x53c0fc(_0x55e974._0x31d719)]===0x0&&(this['_graphic2']=new mars3d__namespace['graphic'][(_0x53c0fc(0x1bb))](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this[_0x53c0fc(0x1a0)],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x1f5eab,'material':_0x231b3c,'vertexShaderSource':getVertexShaderSource(-_0xfea61c)})})),this['_layer']['addGraphic'](this['_graphic2']));}},{'key':'getRectangle','value':function _0x50e37e(_0x9d2903){var _0x16e7f9=_0x4e0393;return _0x9d2903!==null&&_0x9d2903!==void 0x0&&_0x9d2903[_0x16e7f9(_0x51f8ef._0x720c40)]&&this[_0x16e7f9(_0x51f8ef._0x2d5575)]?mars3d__namespace[_0x16e7f9(_0x51f8ef._0x2b343a)]['formatRectangle'](this[_0x16e7f9(0x1a0)]):this['_rectangle'];}},{'key':'_getHeatCanvas','value':function _0x1c43e3(){var _0x400501={_0x207a4c:0x196,_0x1fb43f:0x1b5,_0x4c4167:0x19c},_0x20270a=_0x4e0393,_0x2428ac=this,_0x2d7148,_0x31283e,_0x4d2633,_0x4bc87f,_0x37cefd=this[_0x20270a(0x19a)],_0x4b251c=[],_0x253b8f,_0x2c1635,_0x237c8a,_0x564713;_0x37cefd['forEach'](function(_0x2a4256){var _0x37ea65=_0x20270a,_0x7e68a7=mars3d__namespace[_0x37ea65(_0x400501._0x207a4c)]['parse'](_0x2a4256);if(!_0x7e68a7)return;_0x7e68a7['value']=_0x2a4256['value']||0x1,!_0x2428ac['options'][_0x37ea65(0x191)]&&(_0x253b8f===undefined?(_0x253b8f=_0x7e68a7['lng'],_0x2c1635=_0x7e68a7['lng'],_0x237c8a=_0x7e68a7['lat'],_0x564713=_0x7e68a7['lat']):(_0x253b8f=Math['min'](_0x253b8f,_0x7e68a7['lng']),_0x2c1635=Math['max'](_0x2c1635,_0x7e68a7[_0x37ea65(_0x400501._0x1fb43f)]),_0x237c8a=Math['min'](_0x237c8a,_0x7e68a7[_0x37ea65(_0x400501._0x4c4167)]),_0x564713=Math['max'](_0x564713,_0x7e68a7[_0x37ea65(0x19c)]))),_0x4b251c['push'](_0x7e68a7);});var _0x3f3eb6=this[_0x20270a(0x187)]['rectangle']||{'xmin':_0x253b8f,'xmax':_0x2c1635,'ymin':_0x237c8a,'ymax':_0x564713},_0x5bdd1f=getMercatorBounds(_0x3f3eb6),_0x300ca5=Math['abs'](_0x5bdd1f['xmax']-_0x5bdd1f['xmin']),_0x22ea62=Math[_0x20270a(0x1be)](_0x5bdd1f[_0x20270a(_0x19a648._0x55408c)]-_0x5bdd1f[_0x20270a(_0x19a648._0x1b1bd1)]),_0xa31bd2=Math['max'](_0x300ca5,_0x22ea62),_0x4a0767=Math[_0x20270a(_0x19a648._0xf53409)](_0x300ca5,_0x22ea62);this['_mBoundsMax']=_0xa31bd2;var _0xd633dd=0x1;if(_0xa31bd2>this['options']['maxCanvasSize'])_0xd633dd=_0xa31bd2/this['options']['maxCanvasSize'],_0x4a0767/_0xd633dd<this['options']['minCanvasSize']&&(_0xd633dd=_0x4a0767/this['options'][_0x20270a(0x192)]);else _0x4a0767<this[_0x20270a(_0x19a648._0x23297a)]['minCanvasSize']&&(_0xd633dd=_0x4a0767/this['options']['minCanvasSize'],_0xa31bd2/_0xd633dd>this['options']['maxCanvasSize']&&(_0xd633dd=_0xa31bd2/this[_0x20270a(0x187)]['maxCanvasSize']));var _0x2270c4=this[_0x20270a(_0x19a648._0x3f3faa)]['radius']*1.5,_0x2178d1=_0x300ca5/_0xd633dd+_0x2270c4*0x2,_0x4dd051=_0x22ea62/_0xd633dd+_0x2270c4*0x2,_0x2d6d01=_0x2270c4*_0xd633dd;_0x5bdd1f['xmin']-=_0x2d6d01,_0x5bdd1f['ymin']-=_0x2d6d01,_0x5bdd1f['xmax']+=_0x2d6d01,_0x5bdd1f[_0x20270a(_0x19a648._0x55408c)]+=_0x2d6d01,this['_scale']=_0xd633dd,_0x3f3eb6=geLatLngBounds(_0x5bdd1f),this[_0x20270a(_0x19a648._0xc8898d)]=Cesium['Rectangle'][_0x20270a(0x1a3)](_0x3f3eb6['xmin'],_0x3f3eb6[_0x20270a(_0x19a648._0x2bb852)],_0x3f3eb6['xmax'],_0x3f3eb6['ymax']);var _0x225433=(_0x2d7148=_0x4b251c[0x0]['value'])!==null&&_0x2d7148!==void 0x0?_0x2d7148:0x1,_0x2161c9=(_0x31283e=_0x4b251c[0x0]['value'])!==null&&_0x31283e!==void 0x0?_0x31283e:0x0,_0x1dfe86=[];_0x4b251c['forEach'](function(_0x43dcae){var _0x10af10=_0x20270a,_0x20c71c=mars3d__namespace[_0x10af10(0x1d7)]['lonlat2mercator']([_0x43dcae['lng'],_0x43dcae[_0x10af10(0x19c)]]),_0x3dfc70=_0x43dcae['value']||0x1,_0x169b21=Math[_0x10af10(_0xb293fc._0x26f253)]((_0x20c71c[0x0]-_0x5bdd1f[_0x10af10(_0xb293fc._0x21a097)])/_0xd633dd),_0x3ce403=Math[_0x10af10(_0xb293fc._0x19c7ec)]((_0x5bdd1f['ymax']-_0x20c71c[0x1])/_0xd633dd);_0x225433=Math['max'](_0x225433,_0x3dfc70),_0x2161c9=Math['min'](_0x2161c9,_0x3dfc70),_0x1dfe86[_0x10af10(0x1d4)]({'x':_0x169b21,'y':_0x3ce403,'value':_0x3dfc70});});var _0x10655d={'min':(_0x4d2633=this[_0x20270a(0x187)][_0x20270a(0x1cb)])!==null&&_0x4d2633!==void 0x0?_0x4d2633:_0x2161c9,'max':(_0x4bc87f=this['options'][_0x20270a(0x1d8)])!==null&&_0x4bc87f!==void 0x0?_0x4bc87f:_0x225433,'data':_0x1dfe86};this[_0x20270a(0x1bf)]=_0x10655d;(!this[_0x20270a(_0x19a648._0x2b98ea)]||_0x5bdd1f['xmin']!==this['_last_mBounds']['xmin']||_0x5bdd1f['ymin']!==this[_0x20270a(0x1ae)]['ymin']||_0x5bdd1f[_0x20270a(_0x19a648._0x5e4472)]!==this[_0x20270a(0x1ae)]['xmax']||_0x5bdd1f[_0x20270a(0x1b6)]!==this[_0x20270a(_0x19a648._0x3899ab)]['ymax'])&&(this[_0x20270a(0x1ae)]=_0x5bdd1f,!this['heatStyle'][_0x20270a(0x1c7)]&&(this[_0x20270a(_0x19a648._0x3f3faa)]['container']=mars3d__namespace['DomUtil']['create']('div','mars3d-heatmap\x20mars3d-hideDiv',this['_map']['container'])),this[_0x20270a(_0x19a648._0x3a1f84)]['container']['style']['cssText']=_0x20270a(_0x19a648._0x424a30)['concat'](_0x2178d1,'px;height:')['concat'](_0x4dd051,'px;'),!this['_heat']?this['_heat']=h337__namespace['create'](this['heatStyle']):this[_0x20270a(_0x19a648._0x50ea5c)][_0x20270a(0x19e)](this['heatStyle']));this['_heat']['setData'](_0x10655d);var _0x3a75b0=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat']['_renderer']['canvas']);return _0x3a75b0;}},{'key':'_getArcHeatCanvas','value':function _0x43d495(){var _0x133af5=_0x4e0393;this[_0x133af5(_0x3273a3._0x1a450d)]['configure']({'radius':this[_0x133af5(0x1da)][_0x133af5(_0x3273a3._0x4d592b)]*this['style']['arcRadiusScale'],'blur':this['heatStyle'][_0x133af5(0x180)]*this[_0x133af5(0x1aa)][_0x133af5(0x1dc)],'gradient':this[_0x133af5(0x1da)]['gradientArc']||{0.25:'rgb(0,0,0)',0.55:_0x133af5(_0x3273a3._0x375656),0.85:'rgb(216,216,216)',0x1:'rgb(255,255,255)'}});var _0x56f909=mars3d__namespace['DomUtil'][_0x133af5(0x1b3)](this[_0x133af5(_0x3273a3._0x1f8efa)]['_renderer'][_0x133af5(0x1a6)]);return this['_heat'][_0x133af5(_0x3273a3._0x156b66)](this['options'][_0x133af5(0x1da)]),_0x56f909;}},{'key':'getPointData','value':function _0x200416(_0x483b98){var _0x105477=_0x4e0393,_0x4f7ba5=mars3d__namespace[_0x105477(_0x417c6b._0x5153f0)]['parse'](_0x483b98);if(!_0x4f7ba5)return{};var _0x5ad4af=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x4f7ba5[_0x105477(0x1b5)],_0x4f7ba5['lat']]),_0x8ed68a=this[_0x105477(0x1ae)],_0x427ab9=Math['round']((_0x5ad4af[0x0]-_0x8ed68a['xmin'])/this['_scale']),_0x45492a=Math['round']((_0x8ed68a['ymax']-_0x5ad4af[0x1])/this[_0x105477(0x184)]),_0x114714=this['_heat'][_0x105477(_0x417c6b._0x3f982b)]({'x':_0x427ab9,'y':_0x45492a}),_0x558591=this['_heat']['_renderer']['ctx']['getImageData'](_0x427ab9-0x1,_0x45492a-0x1,0x1,0x1)['data'];return{'x':_0x427ab9,'y':_0x45492a,'value':_0x114714,'color':'rgba('+_0x558591[0x0]+','+_0x558591[0x1]+','+_0x558591[0x2]+','+_0x558591[0x3]+')'};}}]),_0x1ab6b6;}(BaseLayer);mars3d__namespace['layer']['HeatLayer']=HeatLayer,mars3d__namespace['LayerUtil'][_0x12d109(0x1ba)]('heat',HeatLayer);function getMercatorBounds(_0x5a2a18){var _0xe00659={_0x593a1f:0x1b9},_0x3b4fa5=_0x12d109,_0x1bf343=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x5a2a18['xmin'],_0x5a2a18[_0x3b4fa5(_0xe00659._0x593a1f)]]),_0x3209b0=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x5a2a18[_0x3b4fa5(0x188)],_0x5a2a18['ymax']]);return{'xmin':_0x1bf343[0x0],'ymin':_0x1bf343[0x1],'xmax':_0x3209b0[0x0],'ymax':_0x3209b0[0x1]};}function geLatLngBounds(_0x3471e7){var _0x4001cd={_0x49bc92:0x1ac},_0x388593=_0x12d109,_0x6f7f77=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x3471e7['xmin'],_0x3471e7['ymin']]),_0x117ebd=mars3d__namespace['PointTrans'][_0x388593(_0x4001cd._0x49bc92)]([_0x3471e7[_0x388593(0x188)],_0x3471e7['ymax']]);return{'xmin':_0x6f7f77[0x0],'ymin':_0x6f7f77[0x1],'xmax':_0x117ebd[0x0],'ymax':_0x117ebd[0x1]};}function getVertexShaderSource(_0x5c40e7){var _0x393b2e={_0xaa599d:0x199},_0x4b1a60=_0x12d109;return'attribute\x20vec3\x20position3DHigh;\x0a\x20\x20attribute\x20vec3\x20position3DLow;\x0a\x20\x20attribute\x20vec2\x20st;\x0a\x20\x20attribute\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20varying\x20vec3\x20v_positionMC;\x0a\x20\x20varying\x20vec3\x20v_positionEC;\x0a\x20\x20varying\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture2D(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'[_0x4b1a60(_0x393b2e._0xaa599d)](_0x5c40e7,';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a');}exports['HeatLayer']=HeatLayer,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
