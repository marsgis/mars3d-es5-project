/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.4.20
 * 编译日期：2023-01-10 12:56:07
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2022-06-01
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';var _0x173331=_0x5139;(function(_0x404613,_0x229a26){var _0x511c4b={_0x4ef09d:0x15b,_0x31a5e5:0x170,_0x8705e4:0x15c,_0x21923c:0x178,_0x51e163:0x115,_0x38eeba:0x116,_0x5ba1d3:0x120},_0x821fd4=_0x5139,_0x26a691=_0x404613();while(!![]){try{var _0x2eb441=-parseInt(_0x821fd4(0x171))/0x1*(-parseInt(_0x821fd4(_0x511c4b._0x4ef09d))/0x2)+-parseInt(_0x821fd4(0x14d))/0x3*(parseInt(_0x821fd4(_0x511c4b._0x31a5e5))/0x4)+parseInt(_0x821fd4(_0x511c4b._0x8705e4))/0x5*(parseInt(_0x821fd4(_0x511c4b._0x21923c))/0x6)+-parseInt(_0x821fd4(_0x511c4b._0x51e163))/0x7*(-parseInt(_0x821fd4(_0x511c4b._0x38eeba))/0x8)+parseInt(_0x821fd4(_0x511c4b._0x5ba1d3))/0x9+-parseInt(_0x821fd4(0x177))/0xa*(-parseInt(_0x821fd4(0x148))/0xb)+-parseInt(_0x821fd4(0x11e))/0xc;if(_0x2eb441===_0x229a26)break;else _0x26a691['push'](_0x26a691['shift']());}catch(_0x2a069f){_0x26a691['push'](_0x26a691['shift']());}}}(_0x386f,0xe41b3));function _interopNamespace(_0x3516be){var _0x547eb1=_0x5139;if(_0x3516be&&_0x3516be['__esModule'])return _0x3516be;var _0x34cc92=Object['create'](null);return _0x3516be&&Object[_0x547eb1(0x140)](_0x3516be)[_0x547eb1(0x144)](function(_0x2f7d93){var _0x5e33cf=_0x547eb1;if(_0x2f7d93!=='default'){var _0x5a4f22=Object[_0x5e33cf(0x13b)](_0x3516be,_0x2f7d93);Object['defineProperty'](_0x34cc92,_0x2f7d93,_0x5a4f22['get']?_0x5a4f22:{'enumerable':!![],'get':function(){return _0x3516be[_0x2f7d93];}});}}),_0x34cc92['default']=_0x3516be,_0x34cc92;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337);function ownKeys(_0x3a7af1,_0x392fb7){var _0x155026={_0x497f0c:0x154},_0x2bab94={_0x2e8700:0x128},_0x2749ba=_0x5139,_0x17b44f=Object[_0x2749ba(0x140)](_0x3a7af1);if(Object['getOwnPropertySymbols']){var _0x442cdc=Object['getOwnPropertySymbols'](_0x3a7af1);_0x392fb7&&(_0x442cdc=_0x442cdc['filter'](function(_0x3b3249){var _0x429d67=_0x2749ba;return Object['getOwnPropertyDescriptor'](_0x3a7af1,_0x3b3249)[_0x429d67(_0x2bab94._0x2e8700)];})),_0x17b44f['push'][_0x2749ba(_0x155026._0x497f0c)](_0x17b44f,_0x442cdc);}return _0x17b44f;}function _objectSpread2(_0x2dcb8f){var _0x3d9dc7={_0x11c422:0x16d},_0x4607fd=_0x5139;for(var _0x439007=0x1;_0x439007<arguments['length'];_0x439007++){var _0x1685ee=null!=arguments[_0x439007]?arguments[_0x439007]:{};_0x439007%0x2?ownKeys(Object(_0x1685ee),!0x0)[_0x4607fd(0x144)](function(_0x58ca36){_defineProperty(_0x2dcb8f,_0x58ca36,_0x1685ee[_0x58ca36]);}):Object['getOwnPropertyDescriptors']?Object['defineProperties'](_0x2dcb8f,Object[_0x4607fd(_0x3d9dc7._0x11c422)](_0x1685ee)):ownKeys(Object(_0x1685ee))['forEach'](function(_0x21d89b){var _0x416961=_0x4607fd;Object[_0x416961(0x143)](_0x2dcb8f,_0x21d89b,Object['getOwnPropertyDescriptor'](_0x1685ee,_0x21d89b));});}return _0x2dcb8f;}function _classCallCheck(_0xae6ec8,_0x3e871f){if(!(_0xae6ec8 instanceof _0x3e871f))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x434220,_0xe47ff){var _0x3293b5={_0x20fba7:0x123},_0x544049=_0x5139;for(var _0x4305d3=0x0;_0x4305d3<_0xe47ff['length'];_0x4305d3++){var _0x2ba530=_0xe47ff[_0x4305d3];_0x2ba530[_0x544049(0x128)]=_0x2ba530['enumerable']||![],_0x2ba530['configurable']=!![];if('value'in _0x2ba530)_0x2ba530[_0x544049(0x146)]=!![];Object['defineProperty'](_0x434220,_0x2ba530[_0x544049(_0x3293b5._0x20fba7)],_0x2ba530);}}function _createClass(_0x2bbad5,_0x5e09d0,_0x483acd){if(_0x5e09d0)_defineProperties(_0x2bbad5['prototype'],_0x5e09d0);if(_0x483acd)_defineProperties(_0x2bbad5,_0x483acd);return Object['defineProperty'](_0x2bbad5,'prototype',{'writable':![]}),_0x2bbad5;}function _defineProperty(_0x382f70,_0x44a280,_0x572130){return _0x44a280 in _0x382f70?Object['defineProperty'](_0x382f70,_0x44a280,{'value':_0x572130,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x382f70[_0x44a280]=_0x572130,_0x382f70;}function _inherits(_0x1c4622,_0x3f0cd7){var _0x340302=_0x5139;if(typeof _0x3f0cd7!=='function'&&_0x3f0cd7!==null)throw new TypeError(_0x340302(0x159));_0x1c4622['prototype']=Object['create'](_0x3f0cd7&&_0x3f0cd7['prototype'],{'constructor':{'value':_0x1c4622,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x1c4622,'prototype',{'writable':![]});if(_0x3f0cd7)_setPrototypeOf(_0x1c4622,_0x3f0cd7);}function _getPrototypeOf(_0x527b68){return _getPrototypeOf=Object['setPrototypeOf']?Object['getPrototypeOf']['bind']():function _0x3d4c66(_0x5cd5ce){return _0x5cd5ce['__proto__']||Object['getPrototypeOf'](_0x5cd5ce);},_getPrototypeOf(_0x527b68);}function _0x5139(_0x100bda,_0x32fb05){var _0x386f0e=_0x386f();return _0x5139=function(_0x513981,_0x3b2809){_0x513981=_0x513981-0x115;var _0x40a73f=_0x386f0e[_0x513981];return _0x40a73f;},_0x5139(_0x100bda,_0x32fb05);}function _setPrototypeOf(_0x388564,_0x2acf7e){var _0x14799f={_0x5014b8:0x179},_0x3d75ea=_0x5139;return _setPrototypeOf=Object[_0x3d75ea(_0x14799f._0x5014b8)]?Object[_0x3d75ea(_0x14799f._0x5014b8)]['bind']():function _0x58c62c(_0x26f3d0,_0x314363){var _0x2dec71=_0x3d75ea;return _0x26f3d0[_0x2dec71(0x127)]=_0x314363,_0x26f3d0;},_setPrototypeOf(_0x388564,_0x2acf7e);}function _0x386f(){var _0x3d1394=['__proto__','enumerable','addGraphic','uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture2D(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a','width','register','_scale','green','removeGraphic','uniforms','function','style','ymax','Cartesian2','gradientArc','_layer','push','rgb(216,216,216)','EllipsoidSurfaceAppearance','arcDirection','getOwnPropertyDescriptor','radius','clientHeight','blue','rectangle','keys','_last_mBounds','formatRectangle','defineProperty','forEach','minCanvasSize','writable','REPLACE','178739etwvFU','_mountedHook','graphic','StencilOperation','lonlat2mercator','50136Hywbex','addLayer','_graphic','min','canvas','lat','constructor','apply','attribute\x20vec3\x20position3DHigh;\x0a\x20\x20attribute\x20vec3\x20position3DLow;\x0a\x20\x20attribute\x20vec2\x20st;\x0a\x20\x20attribute\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20varying\x20vec3\x20v_positionMC;\x0a\x20\x20varying\x20vec3\x20v_positionEC;\x0a\x20\x20varying\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture2D(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20','KEEP','body','xmin','Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function','data','73642TUYnwv','4221320SoZBqE','image','construct','maxCanvasSize','_renderer','heatStyle','blur','rgba(','type','arcRadiusScale','object','xmax','_graphic2','container','ymin','points','diffHeight','getOwnPropertyDescriptors','lng','configure','292tkFjVJ','8RkfSZW','clear','_heat','RectanglePrimitive','rgb(140,140,140)','PointTrans','1090sRCIdb','12jKjOVB','setPrototypeOf','value','length','_positions','4962909zvPrGn','8OKoXGT','mercator2lonlat','DomUtil','StencilFunction','_updatePositionsHook','floor','concat','options','32286408adalcY','_getArcHeatCanvas','3434481ISfxdX','_rectangle','layer','key','Cesium','positions','max'];_0x386f=function(){return _0x3d1394;};return _0x386f();}function _isNativeReflectConstruct(){var _0x58e94d=_0x5139;if(typeof Reflect==='undefined'||!Reflect['construct'])return![];if(Reflect[_0x58e94d(0x15e)]['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype']['valueOf']['call'](Reflect[_0x58e94d(0x15e)](Boolean,[],function(){})),!![];}catch(_0xea122b){return![];}}function _assertThisInitialized(_0x1bb42e){if(_0x1bb42e===void 0x0)throw new ReferenceError('this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called');return _0x1bb42e;}function _possibleConstructorReturn(_0x4dba7c,_0x2e1ad3){var _0x23f9d2=_0x5139;if(_0x2e1ad3&&(typeof _0x2e1ad3===_0x23f9d2(0x166)||typeof _0x2e1ad3===_0x23f9d2(0x131)))return _0x2e1ad3;else{if(_0x2e1ad3!==void 0x0)throw new TypeError('Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined');}return _assertThisInitialized(_0x4dba7c);}function _createSuper(_0x33cb74){var _0x30507a={_0x4e25d8:0x153,_0x4c09b3:0x154},_0x3a5010=_isNativeReflectConstruct();return function _0x5b64fa(){var _0x586061=_0x5139,_0x1d8179=_getPrototypeOf(_0x33cb74),_0x5a1b6c;if(_0x3a5010){var _0x410e49=_getPrototypeOf(this)[_0x586061(_0x30507a._0x4e25d8)];_0x5a1b6c=Reflect['construct'](_0x1d8179,arguments,_0x410e49);}else _0x5a1b6c=_0x1d8179[_0x586061(_0x30507a._0x4c09b3)](this,arguments);return _possibleConstructorReturn(this,_0x5a1b6c);};}var HeatMaterial=_0x173331(0x12a);if(!h337__namespace['create'])throw new Error('请引入\x20heatmap.js\x20库\x20');var Cesium=mars3d__namespace[_0x173331(0x124)],BaseLayer=mars3d__namespace[_0x173331(0x122)]['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:_0x173331(0x13e),0.6:_0x173331(0x12e),0.8:'yellow',0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']},HeatLayer=function(_0x13c7d6){var _0x5e7f07={_0x44dada:0x13f},_0x58f1bf={_0x206a7b:0x12d,_0x599b1d:0x15a},_0x25f3f9={_0xcb57f5:0x13c,_0x57c963:0x162,_0x47c702:0x135,_0x50d0a5:0x175,_0x40d40b:0x138},_0x333c4b={_0x48e95d:0x126,_0x1efb8d:0x11d,_0x1d0d9f:0x145,_0x3c01f7:0x12d,_0xe018e9:0x17a,_0x137a2b:0x11d,_0x510d1f:0x126,_0x3f44fc:0x141,_0x1411d1:0x158,_0x16c076:0x133,_0x41257e:0x169,_0x4939fb:0x11c,_0x19a845:0x160},_0x50ea5b={_0x1b7855:0x14b,_0x17463d:0x147,_0x592c5b:0x132,_0x549e31:0x16c,_0x3e0df9:0x121,_0x15ca06:0x132,_0x14f790:0x134,_0x38b429:0x11f,_0x46dac5:0x14a,_0x3e7e5a:0x14f,_0x488fc5:0x129},_0x5f0d52={_0x4e86ce:0x14f,_0x27eaa3:0x121,_0x30efe1:0x139,_0x3c25ad:0x129},_0x4c1a71={_0x485084:0x125,_0x5043f1:0x15d,_0x10be38:0x130,_0x568598:0x168,_0x370633:0x14f},_0x5cd759={_0x446829:0x14f},_0x52ca3e={_0x5ca195:0x17c},_0x1bdf75={_0x35a4a8:0x169,_0x4ef893:0x161},_0x53d006={_0x5bf5b6:0x14e,_0xfc9c:0x125,_0x4932d3:0x11d},_0x5cf4bc={_0x4853a3:0x164,_0x39dcd4:0x136},_0x53b377={_0x5a7dbe:0x16b},_0x3c65f0={_0x11cb51:0x173},_0xb55ba0={_0x5ec9d0:0x15f,_0x3bed66:0x157,_0x3352ef:0x11d,_0x3d68c7:0x11d},_0x4eaf8e=_0x173331;_inherits(_0x29e328,_0x13c7d6);var _0x179468=_createSuper(_0x29e328);function _0x29e328(){var _0x22e621=_0x5139,_0x181f13,_0x226963,_0x3f8d25,_0x5a0351=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x29e328),_0x3f8d25=_0x179468['call'](this,_0x5a0351),_0x3f8d25['options']['maxCanvasSize']=(_0x181f13=_0x3f8d25['options']['maxCanvasSize'])!==null&&_0x181f13!==void 0x0?_0x181f13:document['body']['clientWidth'],_0x3f8d25['options'][_0x22e621(_0xb55ba0._0x5ec9d0)]=Math['min'](_0x3f8d25['options'][_0x22e621(0x15f)],0x1388),_0x3f8d25['options']['minCanvasSize']=(_0x226963=_0x3f8d25['options']['minCanvasSize'])!==null&&_0x226963!==void 0x0?_0x226963:document[_0x22e621(_0xb55ba0._0x3bed66)][_0x22e621(0x13d)],_0x3f8d25[_0x22e621(_0xb55ba0._0x3352ef)]['minCanvasSize']=Math['max'](_0x3f8d25['options']['minCanvasSize'],0x2bc),_0x3f8d25['options']['heatStyle']=_objectSpread2(_objectSpread2({},DEF_HEATSTYLE),_0x3f8d25[_0x22e621(_0xb55ba0._0x3d68c7)]['heatStyle']||{}),_0x3f8d25['options']['style']=_objectSpread2(_objectSpread2({},DEF_STYLE),_0x3f8d25['options']['style']||{}),_0x3f8d25;}return _createClass(_0x29e328,[{'key':'layer','get':function _0x16254a(){return this['_layer'];}},{'key':'heatStyle','get':function _0x119256(){return this['options']['heatStyle'];},'set':function _0x369e9f(_0x41c87b){var _0x1d314c=_0x5139;this[_0x1d314c(0x11d)]['heatStyle']=mars3d__namespace['Util']['merge'](this['options']['heatStyle'],_0x41c87b),this['_heat']&&(this[_0x1d314c(_0x3c65f0._0x11cb51)]['configure'](this['options']['heatStyle']),this['_updatePositionsHook'](!![]));}},{'key':'style','get':function _0x4c6459(){return this['options']['style'];},'set':function _0x1df546(_0x5904cd){var _0xf1e6a0=_0x5139;this['options'][_0xf1e6a0(0x132)]=mars3d__namespace['Util']['merge'](this['options']['style'],_0x5904cd);}},{'key':'positions','get':function _0x508f8a(){return this['_positions'];},'set':function _0x4adc2e(_0x3749cf){this['setPositions'](_0x3749cf);}},{'key':'coordinates','get':function _0x354aa3(){var _0x589c71=_0x5139,_0x1a8d5c=[];return this[_0x589c71(_0x53b377._0x5a7dbe)]['forEach'](function(_0x5bd958){var _0x8fe480=_0x589c71;_0x1a8d5c[_0x8fe480(0x137)](_0x5bd958['toArray']());}),_0x1a8d5c;}},{'key':_0x4eaf8e(_0x5e7f07._0x44dada),'get':function _0x989222(){return this['_rectangle'];}},{'key':'_setOptionsHook','value':function _0x21d9d3(_0x5ac839,_0x453f2c){_0x5ac839['positions']&&(this['positions']=_0x5ac839['positions']);}},{'key':_0x4eaf8e(0x149),'value':function _0x59ada3(){var _0x2e8342=_0x4eaf8e;this['style'][_0x2e8342(_0x5cf4bc._0x4853a3)]==='image'?this['_layer']=new mars3d__namespace[(_0x2e8342(0x122))]['ImageLayer']({'crs':'EPSG:3857','private':!![]}):this[_0x2e8342(_0x5cf4bc._0x39dcd4)]=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}},{'key':'_addedHook','value':function _0x252431(){var _0x5345c0=_0x4eaf8e;this['_map'][_0x5345c0(_0x53d006._0x5bf5b6)](this['_layer']),this['options'][_0x5345c0(_0x53d006._0xfc9c)]&&(this['positions']=this[_0x5345c0(_0x53d006._0x4932d3)][_0x5345c0(_0x53d006._0xfc9c)]),this[_0x5345c0(0x11d)]['flyTo']&&this['flyToByAnimationEnd']();}},{'key':'_removedHook','value':function _0x294661(){var _0x54e3e5=_0x4eaf8e;this['heatStyle'][_0x54e3e5(_0x1bdf75._0x35a4a8)]&&(mars3d__namespace['DomUtil']['remove'](this['heatStyle']['container']),delete this[_0x54e3e5(_0x1bdf75._0x4ef893)]['container']),this['clear'](),this['_map']['removeLayer'](this['_layer']);}},{'key':'addPosition','value':function _0x2effd0(_0x16b912,_0x1ad784){var _0x15bf9e=_0x4eaf8e;this[_0x15bf9e(_0x52ca3e._0x5ca195)]=this['_positions']||[],this['_positions']['push'](_0x16b912),this['_updatePositionsHook'](_0x1ad784);}},{'key':'setPositions','value':function _0x144bb7(_0x465ebd,_0x4a3532){var _0x25abf6=_0x4eaf8e;this['_positions']=_0x465ebd,this[_0x25abf6(0x11a)](_0x4a3532);}},{'key':_0x4eaf8e(0x172),'value':function _0x57dde2(){var _0x1d3699=_0x4eaf8e;this['_graphic']&&(this['_layer']['removeGraphic'](this['_graphic'],!![]),delete this[_0x1d3699(_0x5cd759._0x446829)]),this['_graphic2']&&(this['_layer'][_0x1d3699(0x12f)](this['_graphic2'],!![]),delete this[_0x1d3699(0x168)]);}},{'key':_0x4eaf8e(0x11a),'value':function _0x27b6ea(_0x490f79){var _0x34ace3=_0x4eaf8e;if(!this['show']||!this['_map']||!this[_0x34ace3(_0x4c1a71._0x485084)]||this['positions'][_0x34ace3(0x17b)]===0x0)return this;var _0x3483d5=this['_getHeatCanvas']();if(this['style']['type']==='image')this['_layer']['setOptions']({'url':_0x3483d5['toDataURL']('image/png'),'rectangle':this['_rectangle'],'opacity':this['style']['opacity']});else this['style']['arc']?this[_0x34ace3(0x14f)]&&_0x490f79?(this['_graphic']['uniforms'][_0x34ace3(_0x4c1a71._0x5043f1)]=_0x3483d5,this['_graphic'][_0x34ace3(_0x4c1a71._0x10be38)]['bumpMap']=this['_getArcHeatCanvas'](),this['_graphic2']&&(this[_0x34ace3(_0x4c1a71._0x568598)]['uniforms']['image']=_0x3483d5,this['_graphic2']['uniforms']['bumpMap']=this[_0x34ace3(0x14f)]['uniforms']['bumpMap'])):this['_createArcGraphic'](_0x3483d5):this[_0x34ace3(0x14f)]&&_0x490f79?this[_0x34ace3(_0x4c1a71._0x370633)][_0x34ace3(_0x4c1a71._0x10be38)]['image']=_0x3483d5:this['_createGraphic'](_0x3483d5);return this;}},{'key':'_createGraphic','value':function _0x5c4cc2(_0x8e4d65){var _0x27d758=_0x4eaf8e;this['clear'](),this[_0x27d758(_0x5f0d52._0x4e86ce)]=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this[_0x27d758(_0x5f0d52._0x27eaa3)],'appearance':new Cesium[(_0x27d758(_0x5f0d52._0x30efe1))]({'material':new Cesium['Material']({'fabric':{'uniforms':{'image':_0x8e4d65},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})})),this['_layer'][_0x27d758(_0x5f0d52._0x3c25ad)](this['_graphic']);}},{'key':'_createArcGraphic','value':function _0x1ce4b2(_0x1b118e){var _0x31b751=_0x4eaf8e,_0x4809aa;this['clear']();var _0x91015b=Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation'][_0x31b751(0x156)],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium[_0x31b751(0x14b)]['REPLACE']},'backFunction':Cesium[_0x31b751(0x119)]['ALWAYS'],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium[_0x31b751(_0x50ea5b._0x1b7855)][_0x31b751(_0x50ea5b._0x17463d)]},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState']['ALPHA_BLEND']}),_0x2532c8=Math[_0x31b751(0x11b)]((_0x4809aa=this[_0x31b751(_0x50ea5b._0x592c5b)][_0x31b751(0x16c)])!==null&&_0x4809aa!==void 0x0?_0x4809aa:this['_mBoundsMax']*0.02)+0.1;this['style']['diffHeight']&&delete this['style'][_0x31b751(_0x50ea5b._0x549e31)];var _0x1dfafb=(this['style']['splitNum'],0x64),_0x325587=Math[_0x31b751(0x126)](this['_rectangle']['height'],this[_0x31b751(_0x50ea5b._0x3e0df9)][_0x31b751(0x12b)]);this[_0x31b751(_0x50ea5b._0x15ca06)]['granularity']=_0x325587/=_0x1dfafb;var _0x2ba9e4=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x1b118e,'repeat':new Cesium[(_0x31b751(_0x50ea5b._0x14f790))](0x1,0x1),'color':new Cesium['Color'](0x1,0x1,0x1,0x0),'bumpMap':this[_0x31b751(_0x50ea5b._0x38b429)]()},'source':HeatMaterial},'translucent':!![]}),_0x235f82=this['style'][_0x31b751(0x13a)]||0x1;this['_graphic']=new mars3d__namespace[(_0x31b751(_0x50ea5b._0x46dac5))]['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this[_0x31b751(0x11d)]),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x91015b,'material':_0x2ba9e4,'vertexShaderSource':getVertexShaderSource(_0x2532c8*_0x235f82)})})),this['_layer']['addGraphic'](this[_0x31b751(_0x50ea5b._0x3e7e5a)]),this['style'][_0x31b751(0x13a)]===0x0&&(this['_graphic2']=new mars3d__namespace[(_0x31b751(0x14a))][(_0x31b751(0x174))](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x91015b,'material':_0x2ba9e4,'vertexShaderSource':getVertexShaderSource(-_0x2532c8)})})),this[_0x31b751(0x136)][_0x31b751(_0x50ea5b._0x488fc5)](this['_graphic2']));}},{'key':'getRectangle','value':function _0x5c9b76(_0x4013b0){var _0xc2ffdd=_0x4eaf8e;return _0x4013b0!==null&&_0x4013b0!==void 0x0&&_0x4013b0['isFormat']&&this['_rectangle']?mars3d__namespace['PolyUtil'][_0xc2ffdd(0x142)](this['_rectangle']):this['_rectangle'];}},{'key':'_getHeatCanvas','value':function _0x4cf577(){var _0x26a910={_0x234f61:0x16e},_0x12516e={_0xf28c9e:0x16e},_0x2880ef=_0x4eaf8e,_0x5b7ba3=this,_0x442a89,_0x43a1d8,_0x55c4b6,_0x2021bc,_0x59b6b1=this['_positions'],_0x4933ed=[],_0x54074f,_0x1994f9,_0x3599eb,_0x100204;_0x59b6b1['forEach'](function(_0x3b2393){var _0x2a3129=_0x5139,_0x18e36a=mars3d__namespace['LngLatPoint']['parse'](_0x3b2393);if(!_0x18e36a)return;_0x18e36a['value']=_0x3b2393['value']||0x1,!_0x5b7ba3['options']['rectangle']&&(_0x54074f===undefined?(_0x54074f=_0x18e36a[_0x2a3129(_0x12516e._0xf28c9e)],_0x1994f9=_0x18e36a['lng'],_0x3599eb=_0x18e36a[_0x2a3129(0x152)],_0x100204=_0x18e36a['lat']):(_0x54074f=Math['min'](_0x54074f,_0x18e36a['lng']),_0x1994f9=Math['max'](_0x1994f9,_0x18e36a['lng']),_0x3599eb=Math['min'](_0x3599eb,_0x18e36a['lat']),_0x100204=Math['max'](_0x100204,_0x18e36a[_0x2a3129(0x152)]))),_0x4933ed[_0x2a3129(0x137)](_0x18e36a);});var _0x18075f=this['options'][_0x2880ef(0x13f)]||{'xmin':_0x54074f,'xmax':_0x1994f9,'ymin':_0x3599eb,'ymax':_0x100204},_0x29d7a8=getMercatorBounds(_0x18075f),_0x48eb41=Math['abs'](_0x29d7a8['xmax']-_0x29d7a8['xmin']),_0x2ee9e4=Math['abs'](_0x29d7a8['ymax']-_0x29d7a8[_0x2880ef(0x16a)]),_0x39c797=Math[_0x2880ef(_0x333c4b._0x48e95d)](_0x48eb41,_0x2ee9e4),_0x389c95=Math['min'](_0x48eb41,_0x2ee9e4);this['_mBoundsMax']=_0x39c797;var _0x10218b=0x1;if(_0x39c797>this['options']['maxCanvasSize'])_0x10218b=_0x39c797/this[_0x2880ef(_0x333c4b._0x1efb8d)]['maxCanvasSize'],_0x389c95/_0x10218b<this['options']['minCanvasSize']&&(_0x10218b=_0x389c95/this[_0x2880ef(0x11d)][_0x2880ef(_0x333c4b._0x1d0d9f)]);else _0x389c95<this[_0x2880ef(0x11d)]['minCanvasSize']&&(_0x10218b=_0x389c95/this[_0x2880ef(0x11d)][_0x2880ef(0x145)],_0x39c797/_0x10218b>this['options']['maxCanvasSize']&&(_0x10218b=_0x39c797/this[_0x2880ef(0x11d)][_0x2880ef(0x15f)]));var _0x182236=this['heatStyle']['radius']*1.5,_0x33aabb=_0x48eb41/_0x10218b+_0x182236*0x2,_0x26c6c5=_0x2ee9e4/_0x10218b+_0x182236*0x2,_0xa46e5f=_0x182236*_0x10218b;_0x29d7a8['xmin']-=_0xa46e5f,_0x29d7a8['ymin']-=_0xa46e5f,_0x29d7a8[_0x2880ef(0x167)]+=_0xa46e5f,_0x29d7a8['ymax']+=_0xa46e5f,this[_0x2880ef(_0x333c4b._0x3c01f7)]=_0x10218b,_0x18075f=geLatLngBounds(_0x29d7a8),this['_rectangle']=Cesium['Rectangle']['fromDegrees'](_0x18075f['xmin'],_0x18075f['ymin'],_0x18075f['xmax'],_0x18075f['ymax']);var _0x498f7a=(_0x442a89=_0x4933ed[0x0]['value'])!==null&&_0x442a89!==void 0x0?_0x442a89:0x1,_0x16d3a5=(_0x43a1d8=_0x4933ed[0x0][_0x2880ef(_0x333c4b._0xe018e9)])!==null&&_0x43a1d8!==void 0x0?_0x43a1d8:0x0,_0x454dd0=[];_0x4933ed[_0x2880ef(0x144)](function(_0x4eda37){var _0x371f89=_0x2880ef,_0x3154dc=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x4eda37[_0x371f89(_0x26a910._0x234f61)],_0x4eda37['lat']]),_0x29ec54=_0x4eda37[_0x371f89(0x17a)]||0x1,_0x172236=Math['round']((_0x3154dc[0x0]-_0x29d7a8['xmin'])/_0x10218b),_0x4b2558=Math['round']((_0x29d7a8['ymax']-_0x3154dc[0x1])/_0x10218b);_0x498f7a=Math['max'](_0x498f7a,_0x29ec54),_0x16d3a5=Math[_0x371f89(0x150)](_0x16d3a5,_0x29ec54),_0x454dd0['push']({'x':_0x172236,'y':_0x4b2558,'value':_0x29ec54});});var _0x1ff5fe={'min':(_0x55c4b6=this[_0x2880ef(_0x333c4b._0x137a2b)]['min'])!==null&&_0x55c4b6!==void 0x0?_0x55c4b6:_0x16d3a5,'max':(_0x2021bc=this['options'][_0x2880ef(_0x333c4b._0x510d1f)])!==null&&_0x2021bc!==void 0x0?_0x2021bc:_0x498f7a,'data':_0x454dd0};this['_last_heatData']=_0x1ff5fe;(!this[_0x2880ef(_0x333c4b._0x3f44fc)]||_0x29d7a8['xmin']!==this['_last_mBounds'][_0x2880ef(_0x333c4b._0x1411d1)]||_0x29d7a8[_0x2880ef(0x16a)]!==this['_last_mBounds']['ymin']||_0x29d7a8['xmax']!==this['_last_mBounds']['xmax']||_0x29d7a8['ymax']!==this[_0x2880ef(_0x333c4b._0x3f44fc)][_0x2880ef(_0x333c4b._0x16c076)])&&(this['_last_mBounds']=_0x29d7a8,!this['heatStyle'][_0x2880ef(0x169)]&&(this['heatStyle']['container']=mars3d__namespace['DomUtil']['create']('div','mars3d-heatmap\x20mars3d-hideDiv',this['_map']['container'])),this['heatStyle'][_0x2880ef(_0x333c4b._0x41257e)]['style']['cssText']='width:'[_0x2880ef(0x11c)](_0x33aabb,'px;height:')[_0x2880ef(_0x333c4b._0x4939fb)](_0x26c6c5,'px;'),!this['_heat']?this['_heat']=h337__namespace['create'](this['heatStyle']):this['_heat']['configure'](this['heatStyle']));this['_heat']['setData'](_0x1ff5fe);var _0x148a0e=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat'][_0x2880ef(_0x333c4b._0x19a845)][_0x2880ef(0x151)]);return _0x148a0e;}},{'key':'_getArcHeatCanvas','value':function _0x39117d(){var _0x1b4cb6=_0x4eaf8e;this['_heat'][_0x1b4cb6(0x16f)]({'radius':this['heatStyle'][_0x1b4cb6(_0x25f3f9._0xcb57f5)]*this['style'][_0x1b4cb6(0x165)],'blur':this['heatStyle'][_0x1b4cb6(_0x25f3f9._0x57c963)]*this['style']['arcBlurScale'],'gradient':this['heatStyle'][_0x1b4cb6(_0x25f3f9._0x47c702)]||{0.25:'rgb(0,0,0)',0.55:_0x1b4cb6(_0x25f3f9._0x50d0a5),0.85:_0x1b4cb6(_0x25f3f9._0x40d40b),0x1:'rgb(255,255,255)'}});var _0x21178d=mars3d__namespace[_0x1b4cb6(0x118)]['copyCanvas'](this['_heat']['_renderer']['canvas']);return this['_heat']['configure'](this['options'][_0x1b4cb6(0x161)]),_0x21178d;}},{'key':'getPointData','value':function _0x524dbf(_0x16cca5){var _0x589f89=_0x4eaf8e,_0x35da1b=mars3d__namespace['LngLatPoint']['parse'](_0x16cca5);if(!_0x35da1b)return{};var _0x6497e1=mars3d__namespace[_0x589f89(0x176)][_0x589f89(0x14c)]([_0x35da1b['lng'],_0x35da1b['lat']]),_0x484b54=this['_last_mBounds'],_0x2745cc=Math['round']((_0x6497e1[0x0]-_0x484b54['xmin'])/this[_0x589f89(_0x58f1bf._0x206a7b)]),_0x118906=Math['round']((_0x484b54['ymax']-_0x6497e1[0x1])/this['_scale']),_0x430751=this['_heat']['getValueAt']({'x':_0x2745cc,'y':_0x118906}),_0x81a3fe=this['_heat']['_renderer']['ctx']['getImageData'](_0x2745cc-0x1,_0x118906-0x1,0x1,0x1)[_0x589f89(_0x58f1bf._0x599b1d)];return{'x':_0x2745cc,'y':_0x118906,'value':_0x430751,'color':_0x589f89(0x163)+_0x81a3fe[0x0]+','+_0x81a3fe[0x1]+','+_0x81a3fe[0x2]+','+_0x81a3fe[0x3]+')'};}}]),_0x29e328;}(BaseLayer);mars3d__namespace['layer']['HeatLayer']=HeatLayer,mars3d__namespace['LayerUtil'][_0x173331(0x12c)]('heat',HeatLayer);function getMercatorBounds(_0x2d5c0c){var _0x323a35={_0x550fed:0x14c},_0x232cd9=_0x173331,_0x4780e3=mars3d__namespace['PointTrans'][_0x232cd9(_0x323a35._0x550fed)]([_0x2d5c0c['xmin'],_0x2d5c0c['ymin']]),_0x51430e=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x2d5c0c['xmax'],_0x2d5c0c['ymax']]);return{'xmin':_0x4780e3[0x0],'ymin':_0x4780e3[0x1],'xmax':_0x51430e[0x0],'ymax':_0x51430e[0x1]};}function geLatLngBounds(_0xb2b5f8){var _0x6fc59={_0x557c45:0x176,_0x1abe04:0x167},_0x229884=_0x173331,_0x4d0bd0=mars3d__namespace[_0x229884(_0x6fc59._0x557c45)][_0x229884(0x117)]([_0xb2b5f8['xmin'],_0xb2b5f8[_0x229884(0x16a)]]),_0x402c32=mars3d__namespace[_0x229884(_0x6fc59._0x557c45)]['mercator2lonlat']([_0xb2b5f8[_0x229884(_0x6fc59._0x1abe04)],_0xb2b5f8[_0x229884(0x133)]]);return{'xmin':_0x4d0bd0[0x0],'ymin':_0x4d0bd0[0x1],'xmax':_0x402c32[0x0],'ymax':_0x402c32[0x1]};}function getVertexShaderSource(_0x33e909){var _0x11041f={_0x19d3e5:0x155},_0x28d894=_0x173331;return _0x28d894(_0x11041f._0x19d3e5)['concat'](_0x33e909,';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a');}exports['HeatLayer']=HeatLayer,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
