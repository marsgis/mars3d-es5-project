/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.5.12
 * 编译日期：2023-06-19 10:11:04
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';const _0x315cc2=_0x3b6e;function _0x3b6e(_0x57a322,_0x32978d){const _0x47b43e=_0x47b4();return _0x3b6e=function(_0x3b6e00,_0x431b9c){_0x3b6e00=_0x3b6e00-0x1cb;let _0x490a7d=_0x47b43e[_0x3b6e00];return _0x490a7d;},_0x3b6e(_0x57a322,_0x32978d);}(function(_0x4e02d7,_0x133da8){const _0xe14f5c={_0x50f48e:0x20d,_0x498ac7:0x1db,_0x5740ae:0x1ff,_0x46a8b0:0x1f4,_0x411229:0x1df,_0x58fe75:0x200},_0x53b643=_0x3b6e,_0x3fc047=_0x4e02d7();while(!![]){try{const _0x4e7b77=-parseInt(_0x53b643(_0xe14f5c._0x50f48e))/0x1*(parseInt(_0x53b643(_0xe14f5c._0x498ac7))/0x2)+parseInt(_0x53b643(0x20e))/0x3+parseInt(_0x53b643(_0xe14f5c._0x5740ae))/0x4*(-parseInt(_0x53b643(0x1f7))/0x5)+parseInt(_0x53b643(0x1e2))/0x6*(parseInt(_0x53b643(_0xe14f5c._0x46a8b0))/0x7)+parseInt(_0x53b643(_0xe14f5c._0x411229))/0x8+-parseInt(_0x53b643(0x1ed))/0x9*(parseInt(_0x53b643(0x20f))/0xa)+parseInt(_0x53b643(_0xe14f5c._0x58fe75))/0xb;if(_0x4e7b77===_0x133da8)break;else _0x3fc047['push'](_0x3fc047['shift']());}catch(_0x303217){_0x3fc047['push'](_0x3fc047['shift']());}}}(_0x47b4,0xa4282));function _interopNamespace(_0x40a8e3){const _0x2a6752={_0x3cd191:0x213},_0x4c5822=_0x3b6e;if(_0x40a8e3&&_0x40a8e3['__esModule'])return _0x40a8e3;var _0x66c728=Object['create'](null);return _0x40a8e3&&Object['keys'](_0x40a8e3)['forEach'](function(_0xeafd84){if(_0xeafd84!=='default'){var _0x56f997=Object['getOwnPropertyDescriptor'](_0x40a8e3,_0xeafd84);Object['defineProperty'](_0x66c728,_0xeafd84,_0x56f997['get']?_0x56f997:{'enumerable':!![],'get':function(){return _0x40a8e3[_0xeafd84];}});}}),_0x66c728[_0x4c5822(_0x2a6752._0x3cd191)]=_0x40a8e3,_0x66c728;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337),HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace['create'])throw new Error('请引入\x20heatmap.js\x20库\x20');const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:'blue',0.6:_0x315cc2(0x1f0),0.8:'yellow',0.9:_0x315cc2(0x1fa)}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']};function _0x47b4(){const _0x25f1ec=['116188dMOVWs','11952809eFVBAQ','cssText','show','type','register','arcBlurScale','xmin','arcDirection','canvas','lat','style','ymax','_graphic','490868vClcia','2037741xSTwwH','4050140SWCfLU','StencilFunction','heatStyle','EllipsoidSurfaceAppearance','default','rgba(','bumpMap','toArray','_scale','_createGraphic','gradientArc','body','ymin','diffHeight','ALWAYS','setData','DomUtil','_container','options','min','_map','Material','_heat','removeLayer','__esModule','_layer','_renderer','arc','flyTo','_graphic2','_updatePositionsHook','2yRxgHB','floor','maxCanvasSize','graphic','320360IoXPCU','_positions','StencilOperation','18KMUOiQ','splitNum','merge','rgb(216,216,216)','isFormat','image','minCanvasSize','addPosition','forEach','positions','uniforms','9TOrBIf','clear','max','green','_getArcHeatCanvas','remove','image/png','123263ONkYKr','_rectangle','fromDegrees','50XZVTmI','_removedHook','Util','red','RectanglePrimitive','_last_heatData','push','coordinates'];_0x47b4=function(){return _0x25f1ec;};return _0x47b4();}class HeatLayer extends BaseLayer{constructor(_0x4153b9={}){const _0x198d7f={_0x9efc42:0x1dd,_0x4c3932:0x21a},_0x790d81=_0x315cc2;super(_0x4153b9),this['options'][_0x790d81(_0x198d7f._0x9efc42)]=this[_0x790d81(0x1ce)]['maxCanvasSize']??document['body']['clientWidth'],this['options'][_0x790d81(0x1dd)]=Math[_0x790d81(0x1cf)](this['options']['maxCanvasSize'],0x1388),this['options']['minCanvasSize']=this[_0x790d81(0x1ce)]['minCanvasSize']??document[_0x790d81(_0x198d7f._0x4c3932)]['clientHeight'],this['options'][_0x790d81(0x1e8)]=Math['max'](this['options'][_0x790d81(0x1e8)],0x2bc),this[_0x790d81(0x1ce)]['heatStyle']={...DEF_HEATSTYLE,...this[_0x790d81(0x1ce)]['heatStyle']||{}},this['options']['style']={...DEF_STYLE,...this['options']['style']||{}};}get['layer'](){const _0xb5498b={_0x127259:0x1d5},_0x442663=_0x315cc2;return this[_0x442663(_0xb5498b._0x127259)];}get[_0x315cc2(0x211)](){return this['options']['heatStyle'];}set['heatStyle'](_0x216fed){const _0x1b343a={_0x480177:0x211,_0xeb6db3:0x1d2,_0x11bec4:0x211},_0x141571=_0x315cc2;this['options'][_0x141571(_0x1b343a._0x480177)]=mars3d__namespace['Util']['merge'](this[_0x141571(0x1ce)][_0x141571(0x211)],_0x216fed),this[_0x141571(_0x1b343a._0xeb6db3)]&&(this['_heat']['configure'](this['options'][_0x141571(_0x1b343a._0x11bec4)]),this['_updatePositionsHook'](!![]));}get['style'](){const _0x1a50e1=_0x315cc2;return this['options'][_0x1a50e1(0x20a)];}set['style'](_0x2af985){const _0xdad0ab={_0x35ab2d:0x1e4},_0xba32db=_0x315cc2;this['options'][_0xba32db(0x20a)]=mars3d__namespace[_0xba32db(0x1f9)][_0xba32db(_0xdad0ab._0x35ab2d)](this['options']['style'],_0x2af985);}get['positions'](){return this['_positions'];}set[_0x315cc2(0x1eb)](_0xb961aa){this['setPositions'](_0xb961aa);}get[_0x315cc2(0x1fe)](){const _0x1738da=[];return this['points']['forEach'](_0x458071=>{const _0x982bf1=_0x3b6e;_0x1738da['push'](_0x458071[_0x982bf1(0x216)]());}),_0x1738da;}get['rectangle'](){return this['_rectangle'];}['_setOptionsHook'](_0x1da4bb,_0x35aa78){_0x1da4bb['positions']&&(this['positions']=_0x1da4bb['positions']);}['_mountedHook'](){const _0x36bc85=_0x315cc2;this[_0x36bc85(0x20a)][_0x36bc85(0x203)]==='image'?this['_layer']=new mars3d__namespace['layer']['ImageLayer']({'crs':'EPSG:3857','private':!![]}):this['_layer']=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}['_addedHook'](){const _0x437c41={_0x479659:0x1d0,_0xa43b14:0x1d5},_0x291319=_0x315cc2;this[_0x291319(_0x437c41._0x479659)]['addLayer'](this[_0x291319(_0x437c41._0xa43b14)]),this['_container']=mars3d__namespace['DomUtil']['create']('div','mars3d-heatmap\x20mars3d-hideDiv',this[_0x291319(0x1d0)]['container']),this[_0x291319(0x1ce)]['positions']&&(this['positions']=this['options']['positions']),this['options'][_0x291319(0x1d8)]&&this['flyToByAnimationEnd']();}[_0x315cc2(0x1f8)](){const _0x29cd93={_0x55bb74:0x1d3},_0x482399=_0x315cc2;this['_container']&&(mars3d__namespace[_0x482399(0x1cc)][_0x482399(0x1f2)](this['_container']),delete this[_0x482399(0x1cd)]),this['clear'](),this['_map'][_0x482399(_0x29cd93._0x55bb74)](this['_layer']);}[_0x315cc2(0x1e9)](_0x48afb8,_0x5cdd9c){const _0x3afd95=_0x315cc2;this['_positions']=this[_0x3afd95(0x1e0)]||[],this['_positions'][_0x3afd95(0x1fd)](_0x48afb8),this['_updatePositionsHook'](_0x5cdd9c);}['setPositions'](_0x31dd95,_0x1d1f7a){const _0x1a3d0c=_0x315cc2;this['_positions']=_0x31dd95,this[_0x1a3d0c(0x1da)](_0x1d1f7a);}['clear'](){const _0x45f17a={_0x1e2163:0x1d9},_0x2e3979=_0x315cc2;this['_graphic']&&(this[_0x2e3979(0x1d5)]['removeGraphic'](this['_graphic'],!![]),delete this['_graphic']),this[_0x2e3979(_0x45f17a._0x1e2163)]&&(this['_layer']['removeGraphic'](this['_graphic2'],!![]),delete this[_0x2e3979(0x1d9)]);}[_0x315cc2(0x1da)](_0x105cda){const _0x460c41={_0x4e8d1f:0x202,_0x50b01a:0x1d0,_0x5a7069:0x203,_0x4629e8:0x1f3,_0x2440c8:0x1d7,_0x39b302:0x1ec,_0x4f460b:0x1ec},_0x3647ac=_0x315cc2;if(!this[_0x3647ac(_0x460c41._0x4e8d1f)]||!this[_0x3647ac(_0x460c41._0x50b01a)]||!this['positions']||this['positions']['length']===0x0)return this;const _0x34b020=this['_getHeatCanvas']();if(this['style'][_0x3647ac(_0x460c41._0x5a7069)]==='image')this['_layer']['setOptions']({'url':_0x34b020['toDataURL'](_0x3647ac(_0x460c41._0x4629e8)),'rectangle':this['_rectangle'],'opacity':this['style']['opacity']});else this['style'][_0x3647ac(_0x460c41._0x2440c8)]?this['_graphic']&&_0x105cda?(this['_graphic'][_0x3647ac(_0x460c41._0x39b302)][_0x3647ac(0x1e7)]=_0x34b020,this['_graphic']['uniforms'][_0x3647ac(0x215)]=this[_0x3647ac(0x1f1)](),this['_graphic2']&&(this[_0x3647ac(0x1d9)][_0x3647ac(_0x460c41._0x4f460b)]['image']=_0x34b020,this[_0x3647ac(0x1d9)]['uniforms'][_0x3647ac(0x215)]=this[_0x3647ac(0x20c)][_0x3647ac(0x1ec)]['bumpMap'])):this['_createArcGraphic'](_0x34b020):this[_0x3647ac(0x20c)]&&_0x105cda?this['_graphic']['uniforms'][_0x3647ac(0x1e7)]=_0x34b020:this[_0x3647ac(0x218)](_0x34b020);return this;}[_0x315cc2(0x218)](_0x34331a){const _0x326b09={_0x40b44f:0x1ce,_0x5d18d9:0x1d1,_0x1411f1:0x20c},_0x155b84=_0x315cc2;this['clear'](),this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive']({...this[_0x155b84(_0x326b09._0x40b44f)],'rectangle':this[_0x155b84(0x1f5)],'appearance':new Cesium[(_0x155b84(0x212))]({'material':new Cesium[(_0x155b84(_0x326b09._0x5d18d9))]({'fabric':{'uniforms':{'image':_0x34331a},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})}),this[_0x155b84(0x1d5)]['addGraphic'](this[_0x155b84(_0x326b09._0x1411f1)]);}['_createArcGraphic'](_0x213e6d){const _0xb31f1e={_0x1aa459:0x1ee,_0x4cb04b:0x210,_0x435f95:0x21d,_0xec9823:0x1dc,_0x173e73:0x21c,_0x57d411:0x20a,_0x53ba86:0x1e3,_0x362566:0x1f5,_0x5a35f3:0x1f5,_0x3b9a7b:0x1de,_0x348477:0x212,_0x125adb:0x1d5,_0x3f61da:0x1de,_0x172c4e:0x1fb},_0x539e2d=_0x315cc2;this[_0x539e2d(_0xb31f1e._0x1aa459)]();const _0xd82958=Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium['StencilFunction'][_0x539e2d(0x21d)],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium[_0x539e2d(0x1e1)]['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'backFunction':Cesium[_0x539e2d(_0xb31f1e._0x4cb04b)][_0x539e2d(_0xb31f1e._0x435f95)],'backOperation':{'fail':Cesium[_0x539e2d(0x1e1)]['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState']['ALPHA_BLEND']}),_0x52f549=Math[_0x539e2d(_0xb31f1e._0xec9823)](this['style'][_0x539e2d(_0xb31f1e._0x173e73)]??this['_mBoundsMax']*0.02)+0.1;this['style']['diffHeight']&&delete this['style']['diffHeight'];const _0x2348cd=(this[_0x539e2d(_0xb31f1e._0x57d411)][_0x539e2d(_0xb31f1e._0x53ba86)],0x64);let _0x4891f9=Math['max'](this[_0x539e2d(_0xb31f1e._0x362566)]['height'],this[_0x539e2d(_0xb31f1e._0x5a35f3)]['width']);this[_0x539e2d(0x20a)]['granularity']=_0x4891f9/=_0x2348cd;const _0xd9b6a7=new Cesium[(_0x539e2d(0x1d1))]({'fabric':{'uniforms':{'image':_0x213e6d,'repeat':new Cesium['Cartesian2'](0x1,0x1),'color':new Cesium['Color'](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0x18ad22=this['style'][_0x539e2d(0x207)]||0x1;this['_graphic']=new mars3d__namespace[(_0x539e2d(_0xb31f1e._0x3b9a7b))]['RectanglePrimitive']({...this[_0x539e2d(0x1ce)],'rectangle':this['_rectangle'],'appearance':new Cesium[(_0x539e2d(_0xb31f1e._0x348477))]({'flat':!![],'aboveGround':!![],'renderState':_0xd82958,'material':_0xd9b6a7,'vertexShaderSource':getVertexShaderSource(_0x52f549*_0x18ad22)})}),this[_0x539e2d(_0xb31f1e._0x125adb)]['addGraphic'](this[_0x539e2d(0x20c)]),this['style']['arcDirection']===0x0&&(this['_graphic2']=new mars3d__namespace[(_0x539e2d(_0xb31f1e._0x3f61da))][(_0x539e2d(_0xb31f1e._0x172c4e))]({...this[_0x539e2d(0x1ce)],'rectangle':this['_rectangle'],'appearance':new Cesium[(_0x539e2d(_0xb31f1e._0x348477))]({'flat':!![],'aboveGround':!![],'renderState':_0xd82958,'material':_0xd9b6a7,'vertexShaderSource':getVertexShaderSource(-_0x52f549)})}),this['_layer']['addGraphic'](this['_graphic2']));}['getRectangle'](_0x28042e){const _0x2f72f9={_0x1a8e90:0x1f5,_0x2fb574:0x1f5},_0x2de36b=_0x315cc2;return _0x28042e!==null&&_0x28042e!==void 0x0&&_0x28042e[_0x2de36b(0x1e6)]&&this['_rectangle']?mars3d__namespace['PolyUtil']['formatRectangle'](this[_0x2de36b(_0x2f72f9._0x1a8e90)]):this[_0x2de36b(_0x2f72f9._0x2fb574)];}['_getHeatCanvas'](){const _0x238838={_0x28b84a:0x1ea,_0x17fb67:0x1dd,_0x4e4f2f:0x1ef,_0x3ae104:0x1cd,_0x35f79a:0x1d2,_0x48cf73:0x1cb},_0x2f5a41={_0x3789ff:0x209,_0x4f2958:0x1cf},_0x376e94=_0x315cc2,_0x4507a0=this['_positions'],_0x505f32=[];let _0x1712a3,_0x1d39f1,_0x1a0e18,_0x6dc857;_0x4507a0[_0x376e94(_0x238838._0x28b84a)](_0x42cc17=>{const _0x12a926=_0x376e94,_0x26c949=mars3d__namespace['LngLatPoint']['parse'](_0x42cc17);if(!_0x26c949)return;_0x26c949['value']=_0x42cc17['value']||0x1,!this['options']['rectangle']&&(_0x1712a3===undefined?(_0x1712a3=_0x26c949['lng'],_0x1d39f1=_0x26c949['lng'],_0x1a0e18=_0x26c949['lat'],_0x6dc857=_0x26c949['lat']):(_0x1712a3=Math['min'](_0x1712a3,_0x26c949['lng']),_0x1d39f1=Math[_0x12a926(0x1ef)](_0x1d39f1,_0x26c949['lng']),_0x1a0e18=Math[_0x12a926(0x1cf)](_0x1a0e18,_0x26c949['lat']),_0x6dc857=Math['max'](_0x6dc857,_0x26c949['lat']))),_0x505f32['push'](_0x26c949);});_0x1712a3===_0x1d39f1&&(_0x1712a3-=0.000001,_0x1d39f1+=0.000001);_0x1a0e18===_0x6dc857&&(_0x1a0e18-=0.000001,_0x6dc857+=0.000001);let _0x51acd3=this['options']['rectangle']||{'xmin':_0x1712a3,'xmax':_0x1d39f1,'ymin':_0x1a0e18,'ymax':_0x6dc857};const _0x4d7e95=getMercatorBounds(_0x51acd3),_0x5ac0a1=Math['abs'](_0x4d7e95['xmax']-_0x4d7e95['xmin']),_0x236580=Math['abs'](_0x4d7e95['ymax']-_0x4d7e95[_0x376e94(0x21b)]),_0x51b77a=Math['max'](_0x5ac0a1,_0x236580),_0x4ac774=Math['min'](_0x5ac0a1,_0x236580);this['_mBoundsMax']=_0x51b77a;let _0xb35178=0x1;if(_0x51b77a>this['options'][_0x376e94(0x1dd)])_0xb35178=_0x51b77a/this[_0x376e94(0x1ce)][_0x376e94(0x1dd)],_0x4ac774/_0xb35178<this[_0x376e94(0x1ce)]['minCanvasSize']&&(_0xb35178=_0x4ac774/this['options']['minCanvasSize']);else _0x4ac774<this['options']['minCanvasSize']&&(_0xb35178=_0x4ac774/this['options']['minCanvasSize'],_0x51b77a/_0xb35178>this['options']['maxCanvasSize']&&(_0xb35178=_0x51b77a/this['options'][_0x376e94(_0x238838._0x17fb67)]));const _0x5837b7=this['heatStyle']['radius']*1.5,_0xdc1697=_0x5ac0a1/_0xb35178+_0x5837b7*0x2,_0x382d8c=_0x236580/_0xb35178+_0x5837b7*0x2,_0x3611a7=_0x5837b7*_0xb35178;_0x4d7e95['xmin']-=_0x3611a7,_0x4d7e95['ymin']-=_0x3611a7,_0x4d7e95['xmax']+=_0x3611a7,_0x4d7e95['ymax']+=_0x3611a7,this['_scale']=_0xb35178,_0x51acd3=geLatLngBounds(_0x4d7e95),this['_rectangle']=Cesium['Rectangle'][_0x376e94(0x1f6)](_0x51acd3['xmin'],_0x51acd3['ymin'],_0x51acd3['xmax'],_0x51acd3['ymax']);let _0x243df9=_0x505f32[0x0]['value']??0x1,_0x2c0e65=_0x505f32[0x0]['value']??0x0;const _0x4d5dc7=[];_0x505f32[_0x376e94(_0x238838._0x28b84a)](_0x14c4bb=>{const _0x594a2e=_0x376e94,_0x50de46=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x14c4bb['lng'],_0x14c4bb[_0x594a2e(_0x2f5a41._0x3789ff)]]),_0x2b4791=_0x14c4bb['value']||0x1,_0x2f0160=Math['round']((_0x50de46[0x0]-_0x4d7e95['xmin'])/_0xb35178),_0x3b1c90=Math['round']((_0x4d7e95['ymax']-_0x50de46[0x1])/_0xb35178);_0x243df9=Math['max'](_0x243df9,_0x2b4791),_0x2c0e65=Math[_0x594a2e(_0x2f5a41._0x4f2958)](_0x2c0e65,_0x2b4791),_0x4d5dc7['push']({'x':_0x2f0160,'y':_0x3b1c90,'value':_0x2b4791});});const _0x3d4fc3={'min':this['options']['min']??_0x2c0e65,'max':this[_0x376e94(0x1ce)][_0x376e94(_0x238838._0x4e4f2f)]??_0x243df9,'data':_0x4d5dc7};this[_0x376e94(0x1fc)]=_0x3d4fc3;if(!this['_last_mBounds']||_0x4d7e95['xmin']!==this['_last_mBounds']['xmin']||_0x4d7e95['ymin']!==this['_last_mBounds'][_0x376e94(0x21b)]||_0x4d7e95['xmax']!==this['_last_mBounds']['xmax']||_0x4d7e95['ymax']!==this['_last_mBounds']['ymax']){this['_last_mBounds']=_0x4d7e95,this['_container']['style'][_0x376e94(0x201)]='width:'+_0xdc1697+'px;height:'+_0x382d8c+'px;';const _0x403afb={...this['heatStyle'],'container':this[_0x376e94(_0x238838._0x3ae104)]};!this['_heat']?this['_heat']=h337__namespace['create'](_0x403afb):this[_0x376e94(_0x238838._0x35f79a)]['configure'](_0x403afb);}this[_0x376e94(0x1d2)][_0x376e94(_0x238838._0x48cf73)](_0x3d4fc3);const _0x22433b=mars3d__namespace['DomUtil']['copyCanvas'](this[_0x376e94(0x1d2)]['_renderer']['canvas']);return _0x22433b;}[_0x315cc2(0x1f1)](){const _0x5356e7={_0x457b94:0x219,_0x58f6b6:0x1d2},_0x16467d=_0x315cc2;this['_heat']['configure']({'radius':this['heatStyle']['radius']*this['style']['arcRadiusScale'],'blur':this['heatStyle']['blur']*this['style'][_0x16467d(0x205)],'gradient':this['heatStyle'][_0x16467d(_0x5356e7._0x457b94)]||{0.25:'rgb(0,0,0)',0.55:'rgb(140,140,140)',0.85:_0x16467d(0x1e5),0x1:'rgb(255,255,255)'}});const _0x399f04=mars3d__namespace['DomUtil']['copyCanvas'](this[_0x16467d(_0x5356e7._0x58f6b6)][_0x16467d(0x1d6)][_0x16467d(0x208)]);return this['_heat']['configure'](this['options']['heatStyle']),_0x399f04;}['getPointData'](_0x3f46a3){const _0x3e9945={_0x1feaef:0x217,_0x213ea8:0x1d6,_0x17c582:0x214},_0x2a30dd=_0x315cc2,_0x50b955=mars3d__namespace['LngLatPoint']['parse'](_0x3f46a3);if(!_0x50b955)return{};const _0x50d6dc=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x50b955['lng'],_0x50b955['lat']]),_0xfaebb2=this['_last_mBounds'],_0x59e20d=Math['round']((_0x50d6dc[0x0]-_0xfaebb2['xmin'])/this[_0x2a30dd(_0x3e9945._0x1feaef)]),_0x2319cc=Math['round']((_0xfaebb2['ymax']-_0x50d6dc[0x1])/this[_0x2a30dd(_0x3e9945._0x1feaef)]),_0x49055b=this[_0x2a30dd(0x1d2)]['getValueAt']({'x':_0x59e20d,'y':_0x2319cc}),_0x394cfd=this['_heat'][_0x2a30dd(_0x3e9945._0x213ea8)]['ctx']['getImageData'](_0x59e20d-0x1,_0x2319cc-0x1,0x1,0x1)['data'];return{'x':_0x59e20d,'y':_0x2319cc,'value':_0x49055b,'color':_0x2a30dd(_0x3e9945._0x17c582)+_0x394cfd[0x0]+','+_0x394cfd[0x1]+','+_0x394cfd[0x2]+','+_0x394cfd[0x3]+')'};}}mars3d__namespace['LayerUtil'][_0x315cc2(0x204)]('heat',HeatLayer),mars3d__namespace['layer']['HeatLayer']=HeatLayer,mars3d__namespace['h337']=h337__namespace;function getMercatorBounds(_0x285356){const _0x3485d0={_0x22d5c4:0x206,_0x1771bb:0x20b},_0x43cf10=_0x315cc2,_0x1fb37c=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x285356[_0x43cf10(_0x3485d0._0x22d5c4)],_0x285356[_0x43cf10(0x21b)]]),_0x34bdab=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x285356['xmax'],_0x285356[_0x43cf10(_0x3485d0._0x1771bb)]]);return{'xmin':_0x1fb37c[0x0],'ymin':_0x1fb37c[0x1],'xmax':_0x34bdab[0x0],'ymax':_0x34bdab[0x1]};}function geLatLngBounds(_0x21e4a1){const _0x51f623=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x21e4a1['xmin'],_0x21e4a1['ymin']]),_0x2f8a66=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x21e4a1['xmax'],_0x21e4a1['ymax']]);return{'xmin':_0x51f623[0x0],'ymin':_0x51f623[0x1],'xmax':_0x2f8a66[0x0],'ymax':_0x2f8a66[0x1]};}function getVertexShaderSource(_0x572bc8){return'in\x20vec3\x20position3DHigh;\x0a\x20\x20in\x20vec3\x20position3DLow;\x0a\x20\x20in\x20vec2\x20st;\x0a\x20\x20in\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20out\x20vec3\x20v_positionMC;\x0a\x20\x20out\x20vec3\x20v_positionEC;\x0a\x20\x20out\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'+_0x572bc8+';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a';}exports['HeatLayer']=HeatLayer,Object['defineProperty'](exports,_0x315cc2(0x1d4),{'value':!![]});
}));
