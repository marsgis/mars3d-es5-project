/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.5.3
 * 编译日期：2023-04-18 09:46:04
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';var _0x100049=_0x542a;(function(_0x19026f,_0x5d4f50){var _0x48b516={_0x31086e:0x1c5,_0x516aa5:0x223,_0x17d056:0x1fd,_0x56af9b:0x1c1,_0xf10aac:0x1dc},_0x193f44=_0x542a,_0x342c9e=_0x19026f();while(!![]){try{var _0x37567a=-parseInt(_0x193f44(_0x48b516._0x31086e))/0x1+-parseInt(_0x193f44(0x1d9))/0x2+parseInt(_0x193f44(0x213))/0x3*(-parseInt(_0x193f44(_0x48b516._0x516aa5))/0x4)+parseInt(_0x193f44(0x204))/0x5+-parseInt(_0x193f44(0x1e2))/0x6*(parseInt(_0x193f44(_0x48b516._0x17d056))/0x7)+-parseInt(_0x193f44(0x201))/0x8*(-parseInt(_0x193f44(_0x48b516._0x56af9b))/0x9)+parseInt(_0x193f44(_0x48b516._0xf10aac))/0xa;if(_0x37567a===_0x5d4f50)break;else _0x342c9e['push'](_0x342c9e['shift']());}catch(_0x367a44){_0x342c9e['push'](_0x342c9e['shift']());}}}(_0x41cf,0x5a56d));function _interopNamespace(_0x54b2e2){var _0x2bbb73={_0x1dd707:0x211,_0x28e901:0x1d3},_0x3d083f={_0x146332:0x21a,_0x3398d7:0x1e9},_0x37e4f8=_0x542a;if(_0x54b2e2&&_0x54b2e2['__esModule'])return _0x54b2e2;var _0x3b6de7=Object[_0x37e4f8(_0x2bbb73._0x1dd707)](null);return _0x54b2e2&&Object['keys'](_0x54b2e2)[_0x37e4f8(_0x2bbb73._0x28e901)](function(_0x1f92af){var _0x2394ed=_0x37e4f8;if(_0x1f92af!==_0x2394ed(_0x3d083f._0x146332)){var _0x372719=Object[_0x2394ed(0x212)](_0x54b2e2,_0x1f92af);Object['defineProperty'](_0x3b6de7,_0x1f92af,_0x372719[_0x2394ed(_0x3d083f._0x3398d7)]?_0x372719:{'enumerable':!![],'get':function(){return _0x54b2e2[_0x1f92af];}});}}),_0x3b6de7['default']=_0x54b2e2,_0x3b6de7;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337);function ownKeys(_0xaf185e,_0x250aa0){var _0x20783a={_0x566aa3:0x1ff},_0x2abfb3=_0x542a,_0x4e4979=Object[_0x2abfb3(_0x20783a._0x566aa3)](_0xaf185e);if(Object['getOwnPropertySymbols']){var _0x2e1751=Object['getOwnPropertySymbols'](_0xaf185e);_0x250aa0&&(_0x2e1751=_0x2e1751['filter'](function(_0x53569c){return Object['getOwnPropertyDescriptor'](_0xaf185e,_0x53569c)['enumerable'];})),_0x4e4979[_0x2abfb3(0x1bf)]['apply'](_0x4e4979,_0x2e1751);}return _0x4e4979;}function _objectSpread2(_0x9ec774){var _0x506642=_0x542a;for(var _0x658566=0x1;_0x658566<arguments['length'];_0x658566++){var _0x43dbde=null!=arguments[_0x658566]?arguments[_0x658566]:{};_0x658566%0x2?ownKeys(Object(_0x43dbde),!0x0)[_0x506642(0x1d3)](function(_0x32ebbf){_defineProperty(_0x9ec774,_0x32ebbf,_0x43dbde[_0x32ebbf]);}):Object[_0x506642(0x1cd)]?Object['defineProperties'](_0x9ec774,Object[_0x506642(0x1cd)](_0x43dbde)):ownKeys(Object(_0x43dbde))['forEach'](function(_0x4fb288){Object['defineProperty'](_0x9ec774,_0x4fb288,Object['getOwnPropertyDescriptor'](_0x43dbde,_0x4fb288));});}return _0x9ec774;}function _classCallCheck(_0x17b537,_0x4a7700){if(!(_0x17b537 instanceof _0x4a7700))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x32aa32,_0x29e3ce){var _0x5ebed4={_0x1ae565:0x224,_0x33181e:0x220},_0x533df9=_0x542a;for(var _0x585b07=0x0;_0x585b07<_0x29e3ce['length'];_0x585b07++){var _0x36172c=_0x29e3ce[_0x585b07];_0x36172c[_0x533df9(_0x5ebed4._0x1ae565)]=_0x36172c['enumerable']||![],_0x36172c[_0x533df9(_0x5ebed4._0x33181e)]=!![];if('value'in _0x36172c)_0x36172c[_0x533df9(0x205)]=!![];Object['defineProperty'](_0x32aa32,_0x36172c[_0x533df9(0x1c0)],_0x36172c);}}function _createClass(_0x2ca788,_0xab919e,_0x1fe283){var _0x42bd2f={_0x50907c:0x20e},_0x4a0aff=_0x542a;if(_0xab919e)_defineProperties(_0x2ca788[_0x4a0aff(_0x42bd2f._0x50907c)],_0xab919e);if(_0x1fe283)_defineProperties(_0x2ca788,_0x1fe283);return Object['defineProperty'](_0x2ca788,_0x4a0aff(0x20e),{'writable':![]}),_0x2ca788;}function _0x41cf(){var _0x3e5a63=[';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a','DomUtil','minCanvasSize','merge','gradientArc','424704rfhmko','max','PointTrans','21393930dZJFRK','_graphic2','ymin','rgb(0,0,0)','_createGraphic','_last_mBounds','371058BPWroh','valueOf','lng','construct','rgb(255,255,255)','_renderer','_positions','get','this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called','_removedHook','xmax','_last_heatData','_graphic','_layer','clear','ALWAYS','layer','fromCache','PolyUtil','_heat','lat','xmin','addGraphic','function','arcRadiusScale','ImageLayer','lonlat2mercator','77tjClNy','rgba(','keys','Cartesian2','2912824ZGedal','copyCanvas','image','332150VYnhfS','writable','RenderState','coordinates','KEEP','container','arcDirection','configure','StencilOperation','canvas','prototype','LngLatPoint','RectanglePrimitive','create','getOwnPropertyDescriptor','9lrVPuL','blur','bumpMap','getPointData','__proto__','diffHeight','_scale','default','clientHeight','positions','Util','defineProperty','round','configurable','_addedHook','options','977396udNbju','enumerable','_updatePositionsHook','heatStyle','green','_mBoundsMax','image/png','push','key','9zZXgId','abs','ctx','Color','574225tZAufT','clientWidth','blue','body','maxCanvasSize','style','value','ymax','getOwnPropertyDescriptors','_rectangle','uniforms','min','请引入\x20heatmap.js\x20库\x20','sham','forEach'];_0x41cf=function(){return _0x3e5a63;};return _0x41cf();}function _defineProperty(_0x54895d,_0x5b71f1,_0x39fbe3){var _0x334b2e=_0x542a;return _0x5b71f1 in _0x54895d?Object[_0x334b2e(0x21e)](_0x54895d,_0x5b71f1,{'value':_0x39fbe3,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x54895d[_0x5b71f1]=_0x39fbe3,_0x54895d;}function _inherits(_0x57244a,_0x34b482){var _0xc06c34={_0x52342c:0x211,_0xe2ca6f:0x20e},_0x1b0850=_0x542a;if(typeof _0x34b482!=='function'&&_0x34b482!==null)throw new TypeError('Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function');_0x57244a['prototype']=Object[_0x1b0850(_0xc06c34._0x52342c)](_0x34b482&&_0x34b482['prototype'],{'constructor':{'value':_0x57244a,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x57244a,_0x1b0850(_0xc06c34._0xe2ca6f),{'writable':![]});if(_0x34b482)_setPrototypeOf(_0x57244a,_0x34b482);}function _getPrototypeOf(_0x4a6fad){return _getPrototypeOf=Object['setPrototypeOf']?Object['getPrototypeOf']:function _0x5e0569(_0x46e6a0){var _0x574251=_0x542a;return _0x46e6a0[_0x574251(0x217)]||Object['getPrototypeOf'](_0x46e6a0);},_getPrototypeOf(_0x4a6fad);}function _setPrototypeOf(_0x5016f5,_0x3991f7){return _setPrototypeOf=Object['setPrototypeOf']||function _0x509319(_0x2ef616,_0x127663){var _0x5f9fa6=_0x542a;return _0x2ef616[_0x5f9fa6(0x217)]=_0x127663,_0x2ef616;},_setPrototypeOf(_0x5016f5,_0x3991f7);}function _isNativeReflectConstruct(){var _0x25ef5a=_0x542a;if(typeof Reflect==='undefined'||!Reflect[_0x25ef5a(0x1e5)])return![];if(Reflect['construct'][_0x25ef5a(0x1d2)])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype'][_0x25ef5a(0x1e3)]['call'](Reflect['construct'](Boolean,[],function(){})),!![];}catch(_0x1517d5){return![];}}function _assertThisInitialized(_0x276646){var _0x13fa01={_0x7213cb:0x1ea},_0x27553b=_0x542a;if(_0x276646===void 0x0)throw new ReferenceError(_0x27553b(_0x13fa01._0x7213cb));return _0x276646;}function _possibleConstructorReturn(_0x2013e1,_0x31b8de){var _0x10886b={_0x31efdd:0x1f9},_0x448108=_0x542a;if(_0x31b8de&&(typeof _0x31b8de==='object'||typeof _0x31b8de===_0x448108(_0x10886b._0x31efdd)))return _0x31b8de;else{if(_0x31b8de!==void 0x0)throw new TypeError('Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined');}return _assertThisInitialized(_0x2013e1);}function _createSuper(_0x33faac){var _0x2a5a4f=_isNativeReflectConstruct();return function _0x1bcce6(){var _0x3bd910=_getPrototypeOf(_0x33faac),_0x595337;if(_0x2a5a4f){var _0x5093=_getPrototypeOf(this)['constructor'];_0x595337=Reflect['construct'](_0x3bd910,arguments,_0x5093);}else _0x595337=_0x3bd910['apply'](this,arguments);return _possibleConstructorReturn(this,_0x595337);};}var HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace['create'])throw new Error(_0x100049(0x1d1));var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:_0x100049(0x1c7),0.6:_0x100049(0x1bc),0.8:'yellow',0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']},HeatLayer=function(_0x17a1eb){var _0x33ec09={_0x22d1dd:0x21c,_0x46ea3a:0x221},_0x1a5cf6={_0x2e86e3:0x21f,_0x298554:0x219,_0xd47e86:0x1f5,_0x2f257b:0x1fe},_0x5a6e48={_0x19d7a1:0x20b,_0x1be2c9:0x1ca,_0x14a4b8:0x1fa,_0x4ce0e4:0x226,_0x54eb25:0x214,_0x3ab178:0x1d8,_0xa43872:0x1e7,_0x442870:0x20d},_0x39e052={_0x30124e:0x1d3,_0x1bd76e:0x1d6,_0x2b6349:0x1de,_0xd500b2:0x1ec,_0x1e5c3b:0x1d0,_0x1c5309:0x1f7,_0x35fe23:0x1e1,_0x5b053c:0x209,_0x124a94:0x20b},_0x3a68fb={_0x26735d:0x1f4,_0x10d7aa:0x1ce},_0x46e83e={_0x3c96b1:0x206,_0x55654c:0x1f1,_0x2aed6f:0x1ca,_0x4b231f:0x1bd,_0x310ba3:0x218,_0x36f996:0x1ca,_0x3e8c2e:0x200,_0x4b1b15:0x1c4,_0x22e385:0x20a,_0x28bc24:0x210},_0x253675={_0x606431:0x222},_0x402117={_0x2fdfc1:0x203,_0x5f0d40:0x1be,_0x4f0aa6:0x1ee,_0x50899a:0x215,_0xe41798:0x1cf},_0x4e57b5={_0xaf7e1:0x1dd,_0x2d7ae3:0x1dd},_0x474545={_0x1ad14d:0x209},_0x4da080={_0x44927f:0x1fb},_0x42d7fd={_0x4b267d:0x1ce},_0x24b0a5={_0xf001bd:0x1d3},_0x576c5a={_0x16ba2f:0x222,_0x1319df:0x21d,_0x266861:0x1d7},_0x26f0d3={_0x35fdd7:0x222,_0x2d5a72:0x226,_0x13cb45:0x225},_0x4feb4b={_0x394d08:0x222,_0x4123d1:0x226},_0x325d54={_0x167360:0x222,_0x100687:0x1c6,_0x3c27f7:0x222,_0x13428d:0x1d0,_0x52197f:0x1c9,_0x3a240f:0x222,_0x5e6eb1:0x1ca},_0xa73c61=_0x100049;_inherits(_0x52b990,_0x17a1eb);var _0x5ef399=_createSuper(_0x52b990);function _0x52b990(){var _0x12ccd2=_0x542a,_0x7cc7eb,_0xaa2767,_0x5d5dd4,_0x392bde=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x52b990),_0x5d5dd4=_0x5ef399['call'](this,_0x392bde),_0x5d5dd4[_0x12ccd2(_0x325d54._0x167360)]['maxCanvasSize']=(_0x7cc7eb=_0x5d5dd4[_0x12ccd2(_0x325d54._0x167360)]['maxCanvasSize'])!==null&&_0x7cc7eb!==void 0x0?_0x7cc7eb:document[_0x12ccd2(0x1c8)][_0x12ccd2(_0x325d54._0x100687)],_0x5d5dd4[_0x12ccd2(_0x325d54._0x3c27f7)]['maxCanvasSize']=Math[_0x12ccd2(_0x325d54._0x13428d)](_0x5d5dd4['options'][_0x12ccd2(_0x325d54._0x52197f)],0x1388),_0x5d5dd4[_0x12ccd2(_0x325d54._0x3a240f)]['minCanvasSize']=(_0xaa2767=_0x5d5dd4['options'][_0x12ccd2(0x1d6)])!==null&&_0xaa2767!==void 0x0?_0xaa2767:document[_0x12ccd2(0x1c8)][_0x12ccd2(0x21b)],_0x5d5dd4['options']['minCanvasSize']=Math['max'](_0x5d5dd4['options']['minCanvasSize'],0x2bc),_0x5d5dd4['options']['heatStyle']=_objectSpread2(_objectSpread2({},DEF_HEATSTYLE),_0x5d5dd4['options'][_0x12ccd2(0x226)]||{}),_0x5d5dd4['options'][_0x12ccd2(_0x325d54._0x5e6eb1)]=_objectSpread2(_objectSpread2({},DEF_STYLE),_0x5d5dd4['options']['style']||{}),_0x5d5dd4;}return _createClass(_0x52b990,[{'key':'layer','get':function _0x431838(){return this['_layer'];}},{'key':'heatStyle','get':function _0x496f85(){var _0x54582f=_0x542a;return this[_0x54582f(_0x4feb4b._0x394d08)][_0x54582f(_0x4feb4b._0x4123d1)];},'set':function _0x24dc50(_0x30f1b5){var _0x5f4896=_0x542a;this[_0x5f4896(_0x26f0d3._0x35fdd7)][_0x5f4896(_0x26f0d3._0x2d5a72)]=mars3d__namespace[_0x5f4896(0x21d)][_0x5f4896(0x1d7)](this[_0x5f4896(_0x26f0d3._0x35fdd7)][_0x5f4896(0x226)],_0x30f1b5),this['_heat']&&(this['_heat']['configure'](this['options']['heatStyle']),this[_0x5f4896(_0x26f0d3._0x13cb45)](!![]));}},{'key':_0xa73c61(0x1ca),'get':function _0x1fbac4(){return this['options']['style'];},'set':function _0x1cb321(_0x34b0d3){var _0x5c66af=_0xa73c61;this[_0x5c66af(_0x576c5a._0x16ba2f)]['style']=mars3d__namespace[_0x5c66af(_0x576c5a._0x1319df)][_0x5c66af(_0x576c5a._0x266861)](this['options']['style'],_0x34b0d3);}},{'key':_0xa73c61(_0x33ec09._0x22d1dd),'get':function _0x4a0519(){return this['_positions'];},'set':function _0x5d6034(_0x3844a7){this['setPositions'](_0x3844a7);}},{'key':_0xa73c61(0x207),'get':function _0x4fb630(){var _0x3ced3e=_0xa73c61,_0x541273=[];return this['points'][_0x3ced3e(_0x24b0a5._0xf001bd)](function(_0x6375a0){_0x541273['push'](_0x6375a0['toArray']());}),_0x541273;}},{'key':'rectangle','get':function _0x10af59(){var _0x39aca5=_0xa73c61;return this[_0x39aca5(_0x42d7fd._0x4b267d)];}},{'key':'_setOptionsHook','value':function _0x48e5f0(_0x4ff421,_0x78ef05){_0x4ff421['positions']&&(this['positions']=_0x4ff421['positions']);}},{'key':'_mountedHook','value':function _0x2c67c7(){var _0x14ec3b=_0xa73c61;this['style']['type']==='image'?this['_layer']=new mars3d__namespace['layer'][(_0x14ec3b(_0x4da080._0x44927f))]({'crs':'EPSG:3857','private':!![]}):this['_layer']=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}},{'key':_0xa73c61(_0x33ec09._0x46ea3a),'value':function _0x3927a9(){var _0x226278=_0xa73c61;this['_map']['addLayer'](this['_layer']),this['options']['positions']&&(this[_0x226278(0x21c)]=this['options']['positions']),this['options']['flyTo']&&this['flyToByAnimationEnd']();}},{'key':_0xa73c61(0x1eb),'value':function _0xe2c36(){var _0x2f251e=_0xa73c61;this['heatStyle'][_0x2f251e(_0x474545._0x1ad14d)]&&(mars3d__namespace['DomUtil']['remove'](this['heatStyle']['container']),delete this['heatStyle'][_0x2f251e(0x209)]),this[_0x2f251e(0x1f0)](),this['_map']['removeLayer'](this['_layer']);}},{'key':'addPosition','value':function _0x3dad50(_0xbb3039,_0x59906d){this['_positions']=this['_positions']||[],this['_positions']['push'](_0xbb3039),this['_updatePositionsHook'](_0x59906d);}},{'key':'setPositions','value':function _0x3ccae8(_0x10ccdf,_0x522d78){var _0x47c940=_0xa73c61;this[_0x47c940(0x1e8)]=_0x10ccdf,this[_0x47c940(0x225)](_0x522d78);}},{'key':'clear','value':function _0x233bb5(){var _0x55c6cc=_0xa73c61;this['_graphic']&&(this['_layer']['removeGraphic'](this['_graphic'],!![]),delete this['_graphic']),this[_0x55c6cc(_0x4e57b5._0xaf7e1)]&&(this['_layer']['removeGraphic'](this['_graphic2'],!![]),delete this[_0x55c6cc(_0x4e57b5._0x2d7ae3)]);}},{'key':'_updatePositionsHook','value':function _0x27afba(_0x571231){var _0x3ae531=_0xa73c61;if(!this['show']||!this['_map']||!this['positions']||this[_0x3ae531(0x21c)]['length']===0x0)return this;var _0x105e5d=this['_getHeatCanvas']();if(this['style']['type']===_0x3ae531(_0x402117._0x2fdfc1))this[_0x3ae531(0x1ef)]['setOptions']({'url':_0x105e5d['toDataURL'](_0x3ae531(_0x402117._0x5f0d40)),'rectangle':this[_0x3ae531(0x1ce)],'opacity':this[_0x3ae531(0x1ca)]['opacity']});else this['style']['arc']?this['_graphic']&&_0x571231?(this['_graphic'][_0x3ae531(0x1cf)]['image']=_0x105e5d,this[_0x3ae531(_0x402117._0x4f0aa6)]['uniforms'][_0x3ae531(0x215)]=this['_getArcHeatCanvas'](),this['_graphic2']&&(this['_graphic2']['uniforms']['image']=_0x105e5d,this['_graphic2']['uniforms'][_0x3ae531(_0x402117._0x50899a)]=this['_graphic']['uniforms'][_0x3ae531(_0x402117._0x50899a)])):this['_createArcGraphic'](_0x105e5d):this['_graphic']&&_0x571231?this['_graphic'][_0x3ae531(_0x402117._0xe41798)][_0x3ae531(0x203)]=_0x105e5d:this['_createGraphic'](_0x105e5d);return this;}},{'key':_0xa73c61(0x1e0),'value':function _0x5b4f13(_0x31d8d1){var _0x33774=_0xa73c61;this['clear'](),this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this[_0x33774(_0x253675._0x606431)]),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'material':new Cesium['Material']({'fabric':{'uniforms':{'image':_0x31d8d1},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})})),this['_layer'][_0x33774(0x1f8)](this['_graphic']);}},{'key':'_createArcGraphic','value':function _0x11fbd7(_0x32ed34){var _0x534cb0=_0xa73c61,_0x2ed34c;this['clear']();var _0x551cc3=Cesium[_0x534cb0(_0x46e83e._0x3c96b1)][_0x534cb0(0x1f3)]({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium['StencilFunction'][_0x534cb0(0x1f1)],'frontOperation':{'fail':Cesium[_0x534cb0(0x20c)]['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'backFunction':Cesium['StencilFunction'][_0x534cb0(_0x46e83e._0x55654c)],'backOperation':{'fail':Cesium['StencilOperation'][_0x534cb0(0x208)],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium[_0x534cb0(0x20c)]['REPLACE']},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState']['ALPHA_BLEND']}),_0x29fd63=Math['floor']((_0x2ed34c=this[_0x534cb0(_0x46e83e._0x2aed6f)]['diffHeight'])!==null&&_0x2ed34c!==void 0x0?_0x2ed34c:this[_0x534cb0(_0x46e83e._0x4b231f)]*0.02)+0.1;this['style'][_0x534cb0(_0x46e83e._0x310ba3)]&&delete this[_0x534cb0(0x1ca)]['diffHeight'];var _0x54bec6=(this['style']['splitNum'],0x64),_0x53bad5=Math['max'](this[_0x534cb0(0x1ce)]['height'],this['_rectangle']['width']);this[_0x534cb0(_0x46e83e._0x36f996)]['granularity']=_0x53bad5/=_0x54bec6;var _0x195e23=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x32ed34,'repeat':new Cesium[(_0x534cb0(_0x46e83e._0x3e8c2e))](0x1,0x1),'color':new Cesium[(_0x534cb0(_0x46e83e._0x4b1b15))](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0x51177d=this['style']['arcDirection']||0x1;this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this[_0x534cb0(0x1ce)],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x551cc3,'material':_0x195e23,'vertexShaderSource':getVertexShaderSource(_0x29fd63*_0x51177d)})})),this['_layer']['addGraphic'](this['_graphic']),this['style'][_0x534cb0(_0x46e83e._0x22e385)]===0x0&&(this['_graphic2']=new mars3d__namespace['graphic'][(_0x534cb0(_0x46e83e._0x28bc24))](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x551cc3,'material':_0x195e23,'vertexShaderSource':getVertexShaderSource(-_0x29fd63)})})),this['_layer']['addGraphic'](this[_0x534cb0(0x1dd)]));}},{'key':'getRectangle','value':function _0x338522(_0x1d1e82){var _0x1031c4=_0xa73c61;return _0x1d1e82!==null&&_0x1d1e82!==void 0x0&&_0x1d1e82['isFormat']&&this['_rectangle']?mars3d__namespace[_0x1031c4(_0x3a68fb._0x26735d)]['formatRectangle'](this[_0x1031c4(_0x3a68fb._0x10d7aa)]):this['_rectangle'];}},{'key':'_getHeatCanvas','value':function _0x4e3d85(){var _0xe4f139={_0x2e1dbb:0x222,_0x2c9d09:0x1f6,_0x4ef652:0x1d0,_0x4347e4:0x1da,_0x4533e9:0x1bf},_0x716403=_0xa73c61,_0x37801a=this,_0x596607,_0x1bee12,_0x572d08,_0x1887a8,_0x56c14e=this['_positions'],_0xa273b5=[],_0x4de64b,_0x111df1,_0x562bb1,_0x479ff5;_0x56c14e[_0x716403(_0x39e052._0x30124e)](function(_0x4a6455){var _0x381621=_0x716403,_0x47889a=mars3d__namespace[_0x381621(0x20f)]['parse'](_0x4a6455);if(!_0x47889a)return;_0x47889a['value']=_0x4a6455['value']||0x1,!_0x37801a[_0x381621(_0xe4f139._0x2e1dbb)]['rectangle']&&(_0x4de64b===undefined?(_0x4de64b=_0x47889a[_0x381621(0x1e4)],_0x111df1=_0x47889a['lng'],_0x562bb1=_0x47889a[_0x381621(_0xe4f139._0x2c9d09)],_0x479ff5=_0x47889a['lat']):(_0x4de64b=Math[_0x381621(_0xe4f139._0x4ef652)](_0x4de64b,_0x47889a['lng']),_0x111df1=Math[_0x381621(_0xe4f139._0x4347e4)](_0x111df1,_0x47889a['lng']),_0x562bb1=Math['min'](_0x562bb1,_0x47889a['lat']),_0x479ff5=Math['max'](_0x479ff5,_0x47889a['lat']))),_0xa273b5[_0x381621(_0xe4f139._0x4533e9)](_0x47889a);});var _0x5b663f=this[_0x716403(0x222)]['rectangle']||{'xmin':_0x4de64b,'xmax':_0x111df1,'ymin':_0x562bb1,'ymax':_0x479ff5},_0x459e97=getMercatorBounds(_0x5b663f),_0x5789d5=Math['abs'](_0x459e97['xmax']-_0x459e97['xmin']),_0x201661=Math[_0x716403(0x1c2)](_0x459e97['ymax']-_0x459e97['ymin']),_0x30f733=Math['max'](_0x5789d5,_0x201661),_0x4ca1ed=Math['min'](_0x5789d5,_0x201661);this['_mBoundsMax']=_0x30f733;var _0x5c51e0=0x1;if(_0x30f733>this['options']['maxCanvasSize'])_0x5c51e0=_0x30f733/this['options']['maxCanvasSize'],_0x4ca1ed/_0x5c51e0<this['options']['minCanvasSize']&&(_0x5c51e0=_0x4ca1ed/this['options'][_0x716403(0x1d6)]);else _0x4ca1ed<this['options']['minCanvasSize']&&(_0x5c51e0=_0x4ca1ed/this['options'][_0x716403(_0x39e052._0x1bd76e)],_0x30f733/_0x5c51e0>this['options']['maxCanvasSize']&&(_0x5c51e0=_0x30f733/this['options']['maxCanvasSize']));var _0x1b460f=this[_0x716403(0x226)]['radius']*1.5,_0x15134e=_0x5789d5/_0x5c51e0+_0x1b460f*0x2,_0x36ff82=_0x201661/_0x5c51e0+_0x1b460f*0x2,_0x57d758=_0x1b460f*_0x5c51e0;_0x459e97['xmin']-=_0x57d758,_0x459e97['ymin']-=_0x57d758,_0x459e97['xmax']+=_0x57d758,_0x459e97['ymax']+=_0x57d758,this['_scale']=_0x5c51e0,_0x5b663f=geLatLngBounds(_0x459e97),this['_rectangle']=Cesium['Rectangle']['fromDegrees'](_0x5b663f[_0x716403(0x1f7)],_0x5b663f[_0x716403(_0x39e052._0x2b6349)],_0x5b663f[_0x716403(_0x39e052._0xd500b2)],_0x5b663f[_0x716403(0x1cc)]);var _0x3cdb09=(_0x596607=_0xa273b5[0x0]['value'])!==null&&_0x596607!==void 0x0?_0x596607:0x1,_0x16203d=(_0x1bee12=_0xa273b5[0x0][_0x716403(0x1cb)])!==null&&_0x1bee12!==void 0x0?_0x1bee12:0x0,_0x29319f=[];_0xa273b5['forEach'](function(_0x3eb42c){var _0x4ee519=_0x716403,_0x3f4f9a=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x3eb42c['lng'],_0x3eb42c['lat']]),_0x8b5962=_0x3eb42c['value']||0x1,_0x361a2a=Math['round']((_0x3f4f9a[0x0]-_0x459e97['xmin'])/_0x5c51e0),_0x361530=Math['round']((_0x459e97['ymax']-_0x3f4f9a[0x1])/_0x5c51e0);_0x3cdb09=Math['max'](_0x3cdb09,_0x8b5962),_0x16203d=Math[_0x4ee519(0x1d0)](_0x16203d,_0x8b5962),_0x29319f['push']({'x':_0x361a2a,'y':_0x361530,'value':_0x8b5962});});var _0x16a53f={'min':(_0x572d08=this['options'][_0x716403(_0x39e052._0x1e5c3b)])!==null&&_0x572d08!==void 0x0?_0x572d08:_0x16203d,'max':(_0x1887a8=this[_0x716403(0x222)]['max'])!==null&&_0x1887a8!==void 0x0?_0x1887a8:_0x3cdb09,'data':_0x29319f};this[_0x716403(0x1ed)]=_0x16a53f;(!this['_last_mBounds']||_0x459e97[_0x716403(_0x39e052._0x1c5309)]!==this[_0x716403(_0x39e052._0x35fe23)]['xmin']||_0x459e97['ymin']!==this['_last_mBounds']['ymin']||_0x459e97['xmax']!==this['_last_mBounds']['xmax']||_0x459e97['ymax']!==this['_last_mBounds']['ymax'])&&(this['_last_mBounds']=_0x459e97,!this[_0x716403(0x226)][_0x716403(_0x39e052._0x5b053c)]&&(this['heatStyle']['container']=mars3d__namespace['DomUtil']['create']('div','mars3d-heatmap\x20mars3d-hideDiv',this['_map'][_0x716403(_0x39e052._0x5b053c)])),this[_0x716403(0x226)]['container']['style']['cssText']='width:'['concat'](_0x15134e,'px;height:')['concat'](_0x36ff82,'px;'),!this[_0x716403(0x1f5)]?this['_heat']=h337__namespace['create'](this['heatStyle']):this['_heat'][_0x716403(_0x39e052._0x124a94)](this['heatStyle']));this[_0x716403(0x1f5)]['setData'](_0x16a53f);var _0x362233=mars3d__namespace['DomUtil'][_0x716403(0x202)](this['_heat']['_renderer']['canvas']);return _0x362233;}},{'key':'_getArcHeatCanvas','value':function _0x4a650c(){var _0x5e8977=_0xa73c61;this['_heat'][_0x5e8977(_0x5a6e48._0x19d7a1)]({'radius':this['heatStyle']['radius']*this[_0x5e8977(_0x5a6e48._0x1be2c9)][_0x5e8977(_0x5a6e48._0x14a4b8)],'blur':this[_0x5e8977(_0x5a6e48._0x4ce0e4)][_0x5e8977(_0x5a6e48._0x54eb25)]*this['style']['arcBlurScale'],'gradient':this['heatStyle'][_0x5e8977(_0x5a6e48._0x3ab178)]||{0.25:_0x5e8977(0x1df),0.55:'rgb(140,140,140)',0.85:'rgb(216,216,216)',0x1:_0x5e8977(0x1e6)}});var _0x3a3834=mars3d__namespace[_0x5e8977(0x1d5)]['copyCanvas'](this['_heat'][_0x5e8977(_0x5a6e48._0xa43872)][_0x5e8977(_0x5a6e48._0x442870)]);return this['_heat']['configure'](this['options'][_0x5e8977(0x226)]),_0x3a3834;}},{'key':_0xa73c61(0x216),'value':function _0x1ac142(_0x636862){var _0x79a12a=_0xa73c61,_0x4d5422=mars3d__namespace['LngLatPoint']['parse'](_0x636862);if(!_0x4d5422)return{};var _0x14e793=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x4d5422[_0x79a12a(0x1e4)],_0x4d5422['lat']]),_0x42269e=this['_last_mBounds'],_0x5d8e30=Math[_0x79a12a(_0x1a5cf6._0x2e86e3)]((_0x14e793[0x0]-_0x42269e['xmin'])/this[_0x79a12a(_0x1a5cf6._0x298554)]),_0x4144e=Math['round']((_0x42269e['ymax']-_0x14e793[0x1])/this['_scale']),_0xadf85c=this[_0x79a12a(_0x1a5cf6._0xd47e86)]['getValueAt']({'x':_0x5d8e30,'y':_0x4144e}),_0x396e1e=this['_heat']['_renderer'][_0x79a12a(0x1c3)]['getImageData'](_0x5d8e30-0x1,_0x4144e-0x1,0x1,0x1)['data'];return{'x':_0x5d8e30,'y':_0x4144e,'value':_0xadf85c,'color':_0x79a12a(_0x1a5cf6._0x2f257b)+_0x396e1e[0x0]+','+_0x396e1e[0x1]+','+_0x396e1e[0x2]+','+_0x396e1e[0x3]+')'};}}]),_0x52b990;}(BaseLayer);mars3d__namespace[_0x100049(0x1f2)]['HeatLayer']=HeatLayer,mars3d__namespace['LayerUtil']['register']('heat',HeatLayer);function getMercatorBounds(_0x32cfb7){var _0x3fd293={_0x5205c8:0x1fc,_0x43768a:0x1f7},_0x38978d=_0x100049,_0x572109=mars3d__namespace[_0x38978d(0x1db)][_0x38978d(_0x3fd293._0x5205c8)]([_0x32cfb7[_0x38978d(_0x3fd293._0x43768a)],_0x32cfb7['ymin']]),_0x11ed25=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x32cfb7[_0x38978d(0x1ec)],_0x32cfb7['ymax']]);return{'xmin':_0x572109[0x0],'ymin':_0x572109[0x1],'xmax':_0x11ed25[0x0],'ymax':_0x11ed25[0x1]};}function _0x542a(_0x1f0fc8,_0x2a2ec0){var _0x41cfb8=_0x41cf();return _0x542a=function(_0x542a18,_0x350339){_0x542a18=_0x542a18-0x1bc;var _0x1f73ae=_0x41cfb8[_0x542a18];return _0x1f73ae;},_0x542a(_0x1f0fc8,_0x2a2ec0);}function geLatLngBounds(_0x5128a1){var _0x5ba1fb={_0x5d592d:0x1f7},_0x143299=_0x100049,_0x39c860=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x5128a1[_0x143299(_0x5ba1fb._0x5d592d)],_0x5128a1[_0x143299(0x1de)]]),_0x30460c=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x5128a1['xmax'],_0x5128a1['ymax']]);return{'xmin':_0x39c860[0x0],'ymin':_0x39c860[0x1],'xmax':_0x30460c[0x0],'ymax':_0x30460c[0x1]};}function getVertexShaderSource(_0x205fd7){var _0x5d9400={_0x3489a0:0x1d4},_0x2c4f28=_0x100049;return'in\x20vec3\x20position3DHigh;\x0a\x20\x20in\x20vec3\x20position3DLow;\x0a\x20\x20in\x20vec2\x20st;\x0a\x20\x20in\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20out\x20vec3\x20v_positionMC;\x0a\x20\x20out\x20vec3\x20v_positionEC;\x0a\x20\x20out\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'['concat'](_0x205fd7,_0x2c4f28(_0x5d9400._0x3489a0));}exports['HeatLayer']=HeatLayer,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
