/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.6.3
 * 编译日期：2023-08-27 22:06:50
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';const _0x228e8b=_0x1469;(function(_0x5b2c23,_0x20bf81){const _0x31b35f={_0x1cb58d:0x1a5,_0x5c5240:0x1ba,_0xdd569c:0x1cf,_0x2955ad:0x1b3,_0x52eef5:0x1bc},_0x14a846=_0x1469,_0x1cf95a=_0x5b2c23();while(!![]){try{const _0xd0114f=-parseInt(_0x14a846(0x1b4))/0x1+-parseInt(_0x14a846(_0x31b35f._0x1cb58d))/0x2*(-parseInt(_0x14a846(0x18a))/0x3)+parseInt(_0x14a846(0x19c))/0x4*(-parseInt(_0x14a846(_0x31b35f._0x5c5240))/0x5)+parseInt(_0x14a846(_0x31b35f._0xdd569c))/0x6+parseInt(_0x14a846(_0x31b35f._0x2955ad))/0x7+-parseInt(_0x14a846(_0x31b35f._0x52eef5))/0x8*(parseInt(_0x14a846(0x1da))/0x9)+-parseInt(_0x14a846(0x19f))/0xa*(-parseInt(_0x14a846(0x1b9))/0xb);if(_0xd0114f===_0x20bf81)break;else _0x1cf95a['push'](_0x1cf95a['shift']());}catch(_0x1a0286){_0x1cf95a['push'](_0x1cf95a['shift']());}}}(_0x4b67,0xa4d8e));function _interopNamespace(_0x1bb87e){const _0x1332a7={_0xb406a3:0x1c6,_0x13c00f:0x197},_0x20e647={_0x300e74:0x197},_0x185bfc=_0x1469;if(_0x1bb87e&&_0x1bb87e['__esModule'])return _0x1bb87e;var _0x37b184=Object[_0x185bfc(_0x1332a7._0xb406a3)](null);return _0x1bb87e&&Object[_0x185bfc(0x1d8)](_0x1bb87e)['forEach'](function(_0x554dd9){const _0x10f10d=_0x185bfc;if(_0x554dd9!==_0x10f10d(_0x20e647._0x300e74)){var _0x1e67ca=Object['getOwnPropertyDescriptor'](_0x1bb87e,_0x554dd9);Object[_0x10f10d(0x1d7)](_0x37b184,_0x554dd9,_0x1e67ca['get']?_0x1e67ca:{'enumerable':!![],'get':function(){return _0x1bb87e[_0x554dd9];}});}}),_0x37b184[_0x185bfc(_0x1332a7._0x13c00f)]=_0x1bb87e,_0x37b184;}function _0x1469(_0x505612,_0x2c723d){const _0x4b67a5=_0x4b67();return _0x1469=function(_0x1469b8,_0x3dafa0){_0x1469b8=_0x1469b8-0x18a;let _0x54ff07=_0x4b67a5[_0x1469b8];return _0x54ff07;},_0x1469(_0x505612,_0x2c723d);}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337),HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace['create'])throw new Error('请引入\x20heatmap.js\x20库\x20');function _0x4b67(){const _0x45e14a=['lat','_getHeatCanvas','663396VUvxoJ','gradientArc','data','LngLatPoint','clear','lonlat2mercator','ymax','_rectangle','defineProperty','keys','style','8425926qpDccR','setData','LayerUtil','_positions','image/png','_container','options','clientHeight','_last_mBounds','ImageLayer','getValueAt','_getArcHeatCanvas','StencilFunction','lng','726207olCWoz','xmin','parse','_graphic','_removedHook','rgb(140,140,140)','configure','px;','_updatePositionsHook','KEEP','PointTrans','ALPHA_BLEND','opacity','default','maxCanvasSize','_layer','rgb(216,216,216)','EllipsoidSurfaceAppearance','84hxgvxN','removeGraphic','_renderer','10mEMALu','positions','uniforms','_mountedHook','ALWAYS','ctx','2rQkSqR','StencilOperation','arcDirection','graphic','_graphic2','layer','cssText','push','isFormat','flyToByAnimationEnd','image','_map','EPSG:3857','__esModule','4540249lPKVqY','299676VYqznl','value','body','_heat','heatStyle','20192579VLGeyO','220435SNKNhj','bumpMap','8SFcoDV','getImageData','addPosition','div','round','minCanvasSize','Rectangle','ymin','clientWidth','_scale','create','diffHeight','max','fromDegrees','radius','remove','min'];_0x4b67=function(){return _0x45e14a;};return _0x4b67();}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:'blue',0.6:'green',0.8:'yellow',0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium[_0x228e8b(0x19b)]['VERTEX_FORMAT']};class HeatLayer extends BaseLayer{constructor(_0x2a08a1={}){const _0x389665={_0x507bce:0x1e0,_0x21719d:0x1c4,_0x2f17db:0x198,_0x29fa0f:0x1b8,_0x2d6e4e:0x1e0,_0xebf562:0x1d9,_0x46cbd2:0x1e0},_0x1bfcf9=_0x228e8b;super(_0x2a08a1),this[_0x1bfcf9(_0x389665._0x507bce)]['maxCanvasSize']=this['options']['maxCanvasSize']??document['body'][_0x1bfcf9(_0x389665._0x21719d)],this['options'][_0x1bfcf9(_0x389665._0x2f17db)]=Math['min'](this['options']['maxCanvasSize'],0x1388),this['options']['minCanvasSize']=this['options']['minCanvasSize']??document[_0x1bfcf9(0x1b6)][_0x1bfcf9(0x1e1)],this['options'][_0x1bfcf9(0x1c1)]=Math[_0x1bfcf9(0x1c8)](this[_0x1bfcf9(_0x389665._0x507bce)]['minCanvasSize'],0x2bc),this['options'][_0x1bfcf9(_0x389665._0x29fa0f)]={...DEF_HEATSTYLE,...this[_0x1bfcf9(_0x389665._0x2d6e4e)]['heatStyle']},this['options'][_0x1bfcf9(_0x389665._0xebf562)]={...DEF_STYLE,...this[_0x1bfcf9(_0x389665._0x46cbd2)][_0x1bfcf9(_0x389665._0xebf562)]};}get['layer'](){return this['_layer'];}get['heatStyle'](){return this['options']['heatStyle'];}set['heatStyle'](_0x20568a){const _0x3d9fce={_0x4e728e:0x1b8,_0x151a86:0x192},_0x39f38d=_0x228e8b;this['options']['heatStyle']=mars3d__namespace['Util']['merge'](this[_0x39f38d(0x1e0)]['heatStyle'],_0x20568a),this['_heat']&&(this['_heat']['configure'](this['options'][_0x39f38d(_0x3d9fce._0x4e728e)]),this[_0x39f38d(_0x3d9fce._0x151a86)](!![]));}get[_0x228e8b(0x1d9)](){const _0x2d4019=_0x228e8b;return this[_0x2d4019(0x1e0)]['style'];}set[_0x228e8b(0x1d9)](_0x293f74){const _0x1f6d79={_0x5365e5:0x1e0,_0x58da39:0x1d9},_0x46519f=_0x228e8b;this[_0x46519f(_0x1f6d79._0x5365e5)][_0x46519f(0x1d9)]=mars3d__namespace['Util']['merge'](this[_0x46519f(0x1e0)][_0x46519f(_0x1f6d79._0x58da39)],_0x293f74);}get[_0x228e8b(0x1a0)](){return this['_positions'];}set[_0x228e8b(0x1a0)](_0x2e481d){this['setPositions'](_0x2e481d);}get['coordinates'](){const _0x121ce1=[];return this['points']['forEach'](_0x42b124=>{_0x121ce1['push'](_0x42b124['toArray']());}),_0x121ce1;}get['rectangle'](){const _0x479826=_0x228e8b;return this[_0x479826(0x1d6)];}['_setOptionsHook'](_0x9c69dc,_0x39d83e){const _0xf53e79={_0x5b6745:0x1a0},_0xa27311=_0x228e8b;_0x9c69dc['positions']&&(this[_0xa27311(_0xf53e79._0x5b6745)]=_0x9c69dc['positions']);}[_0x228e8b(0x1a2)](){const _0x4d1408={_0x19436b:0x1b1},_0x5e2966=_0x228e8b;this['style']['type']==='image'?this['_layer']=new mars3d__namespace[(_0x5e2966(0x1aa))][(_0x5e2966(0x1e3))]({'crs':_0x5e2966(_0x4d1408._0x19436b),'private':!![]}):this['_layer']=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}['_addedHook'](){const _0x1405ee={_0x5ae2f2:0x1df,_0x5adcc6:0x1a0,_0x1f9196:0x1ae},_0x285754=_0x228e8b;this['_map']['addLayer'](this['_layer']),this[_0x285754(_0x1405ee._0x5ae2f2)]=mars3d__namespace['DomUtil']['create'](_0x285754(0x1bf),'mars3d-heatmap\x20mars3d-hideDiv',this['_map']['container']),this['options']['positions']&&(this['positions']=this['options'][_0x285754(_0x1405ee._0x5adcc6)]),this['options']['flyTo']&&this[_0x285754(_0x1405ee._0x1f9196)]();}[_0x228e8b(0x18e)](){const _0x1b4d76={_0x2a7629:0x1cb,_0x5968de:0x1df},_0x5b1d4e=_0x228e8b;this['_container']&&(mars3d__namespace['DomUtil'][_0x5b1d4e(_0x1b4d76._0x2a7629)](this[_0x5b1d4e(0x1df)]),delete this[_0x5b1d4e(_0x1b4d76._0x5968de)]),this['clear'](),this[_0x5b1d4e(0x1b0)]['removeLayer'](this['_layer']);}[_0x228e8b(0x1be)](_0x4b3170,_0x574c12){const _0x5aaf8f=_0x228e8b;this['_positions']=this['_positions']||[],this[_0x5aaf8f(0x1dd)]['push'](_0x4b3170),this['_updatePositionsHook'](_0x574c12);}['setPositions'](_0x4b792b,_0x428fb5){this['_positions']=_0x4b792b,this['_updatePositionsHook'](_0x428fb5);}[_0x228e8b(0x1d3)](){const _0x3e0be2={_0x275580:0x18d,_0x4c369c:0x19d},_0x681d6e=_0x228e8b;this[_0x681d6e(_0x3e0be2._0x275580)]&&(this['_layer'][_0x681d6e(_0x3e0be2._0x4c369c)](this['_graphic'],!![]),delete this[_0x681d6e(0x18d)]),this['_graphic2']&&(this['_layer']['removeGraphic'](this['_graphic2'],!![]),delete this['_graphic2']);}['_updatePositionsHook'](_0x30a885){const _0x4151c6={_0x58cc30:0x1a0,_0x20c64d:0x1ce,_0x5a6d8f:0x1d9,_0x19f45d:0x196,_0x583b0c:0x18d,_0x1c36e0:0x1a9,_0x2fa7a3:0x1bb,_0x4703e5:0x18d},_0x399037=_0x228e8b;if(!this['show']||!this['_map']||!this['positions']||this[_0x399037(_0x4151c6._0x58cc30)]['length']===0x0)return this;const _0x3a9d09=this[_0x399037(_0x4151c6._0x20c64d)]();if(this['style']['type']==='image')this[_0x399037(0x199)]['setOptions']({'url':_0x3a9d09['toDataURL'](_0x399037(0x1de)),'rectangle':this['_rectangle'],'opacity':this[_0x399037(_0x4151c6._0x5a6d8f)][_0x399037(_0x4151c6._0x19f45d)]});else this[_0x399037(0x1d9)]['arc']?this[_0x399037(_0x4151c6._0x583b0c)]&&_0x30a885?(this['_graphic'][_0x399037(0x1a1)]['image']=_0x3a9d09,this[_0x399037(0x18d)][_0x399037(0x1a1)][_0x399037(0x1bb)]=this['_getArcHeatCanvas'](),this['_graphic2']&&(this[_0x399037(_0x4151c6._0x1c36e0)]['uniforms'][_0x399037(0x1af)]=_0x3a9d09,this[_0x399037(0x1a9)]['uniforms'][_0x399037(_0x4151c6._0x2fa7a3)]=this[_0x399037(_0x4151c6._0x583b0c)]['uniforms'][_0x399037(_0x4151c6._0x2fa7a3)])):this['_createArcGraphic'](_0x3a9d09):this['_graphic']&&_0x30a885?this[_0x399037(_0x4151c6._0x4703e5)]['uniforms']['image']=_0x3a9d09:this['_createGraphic'](_0x3a9d09);return this;}['_createGraphic'](_0x656f3d){const _0x40a1a3={_0x2e53c1:0x18d,_0x11743a:0x1e0},_0x53cd55=_0x228e8b;this['clear'](),this[_0x53cd55(_0x40a1a3._0x2e53c1)]=new mars3d__namespace[(_0x53cd55(0x1a8))]['RectanglePrimitive']({...this[_0x53cd55(_0x40a1a3._0x11743a)],'rectangle':this['_rectangle'],'appearance':new Cesium[(_0x53cd55(0x19b))]({'material':new Cesium['Material']({'fabric':{'uniforms':{'image':_0x656f3d},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})}),this['_layer']['addGraphic'](this['_graphic']);}['_createArcGraphic'](_0x1493b6){const _0x407765={_0x810f4a:0x193,_0x5ad9b0:0x1a6,_0xc28fea:0x1e6,_0x44a6ae:0x1a3,_0x44d821:0x1c7,_0x523ba4:0x1e0,_0xb8d759:0x19b,_0x458759:0x1a7,_0x38f21d:0x199},_0xd368e=_0x228e8b;this['clear']();const _0x3888e6=Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium['StencilFunction'][_0xd368e(0x1a3)],'frontOperation':{'fail':Cesium['StencilOperation'][_0xd368e(_0x407765._0x810f4a)],'zFail':Cesium[_0xd368e(_0x407765._0x5ad9b0)]['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'backFunction':Cesium[_0xd368e(_0x407765._0xc28fea)][_0xd368e(_0x407765._0x44a6ae)],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium[_0xd368e(0x1a6)]['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState'][_0xd368e(0x195)]}),_0x4e4f2c=Math['floor'](this['style'][_0xd368e(0x1c7)]??this['_mBoundsMax']*0.02)+0.1;this['style']['diffHeight']&&delete this['style'][_0xd368e(_0x407765._0x44d821)];const _0x5232b6=(this['style']['splitNum'],0x64);let _0x17eb68=Math['max'](this['_rectangle']['height'],this['_rectangle']['width']);this['style']['granularity']=_0x17eb68/=_0x5232b6;const _0x4d5616=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x1493b6,'repeat':new Cesium['Cartesian2'](0x1,0x1),'color':new Cesium['Color'](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0x345808=this['style']['arcDirection']||0x1;this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive']({...this[_0xd368e(_0x407765._0x523ba4)],'rectangle':this['_rectangle'],'appearance':new Cesium[(_0xd368e(_0x407765._0xb8d759))]({'flat':!![],'aboveGround':!![],'renderState':_0x3888e6,'material':_0x4d5616,'vertexShaderSource':getVertexShaderSource(_0x4e4f2c*_0x345808)})}),this[_0xd368e(0x199)]['addGraphic'](this['_graphic']),this['style'][_0xd368e(_0x407765._0x458759)]===0x0&&(this['_graphic2']=new mars3d__namespace[(_0xd368e(0x1a8))]['RectanglePrimitive']({...this['options'],'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x3888e6,'material':_0x4d5616,'vertexShaderSource':getVertexShaderSource(-_0x4e4f2c)})}),this[_0xd368e(_0x407765._0x38f21d)]['addGraphic'](this[_0xd368e(0x1a9)]));}['getRectangle'](_0x252c32){const _0x405cb1={_0xed6a07:0x1ad},_0x30c0da=_0x228e8b;return _0x252c32!==null&&_0x252c32!==void 0x0&&_0x252c32[_0x30c0da(_0x405cb1._0xed6a07)]&&this['_rectangle']?mars3d__namespace['PolyUtil']['formatRectangle'](this[_0x30c0da(0x1d6)]):this['_rectangle'];}['_getHeatCanvas'](){const _0x57bfe5={_0x28915e:0x1c3,_0x3270de:0x1cc,_0x79d7ef:0x1e0,_0x1f1590:0x198,_0x5d6e0e:0x1c1,_0x1715d1:0x198,_0x370f18:0x1c5,_0x3d7c7c:0x1c2,_0x23c2cc:0x1c9,_0xdd7736:0x18b,_0xdb7bfb:0x18b,_0x1552a1:0x1df,_0x28d2c5:0x191,_0x2f2cd1:0x1db,_0x1f93be:0x19e},_0x3e8d70={_0x3dbfbd:0x1ac},_0x510306={_0xac7417:0x18c,_0x5125bc:0x1b5,_0x29b719:0x1c8},_0x110eb5=_0x228e8b,_0x988729=this['_positions'],_0x4b4951=[];let _0x1ce0ce,_0x1322bb,_0x4a4396,_0x1ba818;_0x988729['forEach'](_0x13742e=>{const _0x407b31=_0x1469,_0x5c7add=mars3d__namespace['LngLatPoint'][_0x407b31(_0x510306._0xac7417)](_0x13742e);if(!_0x5c7add)return;_0x5c7add[_0x407b31(0x1b5)]=_0x13742e[_0x407b31(_0x510306._0x5125bc)]||0x1,!this['options']['rectangle']&&(_0x1ce0ce===undefined?(_0x1ce0ce=_0x5c7add['lng'],_0x1322bb=_0x5c7add['lng'],_0x4a4396=_0x5c7add['lat'],_0x1ba818=_0x5c7add['lat']):(_0x1ce0ce=Math['min'](_0x1ce0ce,_0x5c7add['lng']),_0x1322bb=Math['max'](_0x1322bb,_0x5c7add[_0x407b31(0x1e7)]),_0x4a4396=Math['min'](_0x4a4396,_0x5c7add['lat']),_0x1ba818=Math[_0x407b31(_0x510306._0x29b719)](_0x1ba818,_0x5c7add['lat']))),_0x4b4951[_0x407b31(0x1ac)](_0x5c7add);});_0x1ce0ce===_0x1322bb&&(_0x1ce0ce-=0.000001,_0x1322bb+=0.000001);_0x4a4396===_0x1ba818&&(_0x4a4396-=0.000001,_0x1ba818+=0.000001);let _0x25da12=this[_0x110eb5(0x1e0)]['rectangle']||{'xmin':_0x1ce0ce,'xmax':_0x1322bb,'ymin':_0x4a4396,'ymax':_0x1ba818};const _0x5c1195=getMercatorBounds(_0x25da12),_0x2b5bc3=Math['abs'](_0x5c1195['xmax']-_0x5c1195[_0x110eb5(0x18b)]),_0x6a6e9c=Math['abs'](_0x5c1195['ymax']-_0x5c1195[_0x110eb5(_0x57bfe5._0x28915e)]),_0x481ce5=Math['max'](_0x2b5bc3,_0x6a6e9c),_0x3bf768=Math[_0x110eb5(_0x57bfe5._0x3270de)](_0x2b5bc3,_0x6a6e9c);this['_mBoundsMax']=_0x481ce5;let _0x4237f2=0x1;if(_0x481ce5>this[_0x110eb5(_0x57bfe5._0x79d7ef)][_0x110eb5(_0x57bfe5._0x1f1590)])_0x4237f2=_0x481ce5/this[_0x110eb5(_0x57bfe5._0x79d7ef)]['maxCanvasSize'],_0x3bf768/_0x4237f2<this['options']['minCanvasSize']&&(_0x4237f2=_0x3bf768/this[_0x110eb5(_0x57bfe5._0x79d7ef)][_0x110eb5(_0x57bfe5._0x5d6e0e)]);else _0x3bf768<this['options']['minCanvasSize']&&(_0x4237f2=_0x3bf768/this['options'][_0x110eb5(0x1c1)],_0x481ce5/_0x4237f2>this[_0x110eb5(_0x57bfe5._0x79d7ef)]['maxCanvasSize']&&(_0x4237f2=_0x481ce5/this['options'][_0x110eb5(_0x57bfe5._0x1715d1)]));const _0x5c95a7=this['heatStyle']['radius']*1.5,_0x8c6679=_0x2b5bc3/_0x4237f2+_0x5c95a7*0x2,_0x35e829=_0x6a6e9c/_0x4237f2+_0x5c95a7*0x2,_0x5e507c=_0x5c95a7*_0x4237f2;_0x5c1195['xmin']-=_0x5e507c,_0x5c1195['ymin']-=_0x5e507c,_0x5c1195['xmax']+=_0x5e507c,_0x5c1195['ymax']+=_0x5e507c,this[_0x110eb5(_0x57bfe5._0x370f18)]=_0x4237f2,_0x25da12=geLatLngBounds(_0x5c1195),this['_rectangle']=Cesium[_0x110eb5(_0x57bfe5._0x3d7c7c)][_0x110eb5(_0x57bfe5._0x23c2cc)](_0x25da12[_0x110eb5(_0x57bfe5._0xdd7736)],_0x25da12['ymin'],_0x25da12['xmax'],_0x25da12[_0x110eb5(0x1d5)]);let _0x1aa439=_0x4b4951[0x0]['value']??0x1,_0x248579=_0x4b4951[0x0]['value']??0x0;const _0x5b454e=[];_0x4b4951['forEach'](_0x29fe01=>{const _0x10d01f=_0x110eb5,_0x45333a=mars3d__namespace['PointTrans'][_0x10d01f(0x1d4)]([_0x29fe01['lng'],_0x29fe01[_0x10d01f(0x1cd)]]),_0x45f0fe=_0x29fe01['value']||0x1,_0x480b26=Math['round']((_0x45333a[0x0]-_0x5c1195[_0x10d01f(0x18b)])/_0x4237f2),_0x41579f=Math['round']((_0x5c1195['ymax']-_0x45333a[0x1])/_0x4237f2);_0x1aa439=Math['max'](_0x1aa439,_0x45f0fe),_0x248579=Math['min'](_0x248579,_0x45f0fe),_0x5b454e[_0x10d01f(_0x3e8d70._0x3dbfbd)]({'x':_0x480b26,'y':_0x41579f,'value':_0x45f0fe});});const _0x52fbe9={'min':this['options']['min']??_0x248579,'max':this['options']['max']??_0x1aa439,'data':_0x5b454e};this['_last_heatData']=_0x52fbe9;if(!this['_last_mBounds']||_0x5c1195[_0x110eb5(_0x57bfe5._0xdb7bfb)]!==this['_last_mBounds']['xmin']||_0x5c1195['ymin']!==this['_last_mBounds']['ymin']||_0x5c1195['xmax']!==this['_last_mBounds']['xmax']||_0x5c1195['ymax']!==this[_0x110eb5(0x1e2)]['ymax']){this['_last_mBounds']=_0x5c1195,this[_0x110eb5(_0x57bfe5._0x1552a1)]['style'][_0x110eb5(0x1ab)]='width:'+_0x8c6679+'px;height:'+_0x35e829+_0x110eb5(_0x57bfe5._0x28d2c5);const _0x337830={...this['heatStyle'],'container':this['_container']};!this['_heat']?this[_0x110eb5(0x1b7)]=h337__namespace['create'](_0x337830):this[_0x110eb5(0x1b7)][_0x110eb5(0x190)](_0x337830);}this[_0x110eb5(0x1b7)][_0x110eb5(_0x57bfe5._0x2f2cd1)](_0x52fbe9);const _0x17afd9=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat'][_0x110eb5(_0x57bfe5._0x1f93be)]['canvas']);return _0x17afd9;}[_0x228e8b(0x1e5)](){const _0x1426f8={_0x1296df:0x1ca},_0x37a556=_0x228e8b;this['_heat']['configure']({'radius':this[_0x37a556(0x1b8)][_0x37a556(_0x1426f8._0x1296df)]*this['style']['arcRadiusScale'],'blur':this['heatStyle']['blur']*this['style']['arcBlurScale'],'gradient':this[_0x37a556(0x1b8)][_0x37a556(0x1d0)]||{0.25:'rgb(0,0,0)',0.55:_0x37a556(0x18f),0.85:_0x37a556(0x19a),0x1:'rgb(255,255,255)'}});const _0x51b84b=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat'][_0x37a556(0x19e)]['canvas']);return this['_heat']['configure'](this['options']['heatStyle']),_0x51b84b;}['getPointData'](_0x37d943){const _0x5bf190={_0x56a393:0x1d2,_0x32d10c:0x1a4},_0x55c1ed=_0x228e8b,_0x441344=mars3d__namespace[_0x55c1ed(_0x5bf190._0x56a393)]['parse'](_0x37d943);if(!_0x441344)return{};const _0x3231c1=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x441344['lng'],_0x441344[_0x55c1ed(0x1cd)]]),_0x3f9650=this[_0x55c1ed(0x1e2)],_0x4b5f98=Math['round']((_0x3231c1[0x0]-_0x3f9650['xmin'])/this['_scale']),_0xe16a9d=Math[_0x55c1ed(0x1c0)]((_0x3f9650['ymax']-_0x3231c1[0x1])/this['_scale']),_0x3d10d0=this['_heat'][_0x55c1ed(0x1e4)]({'x':_0x4b5f98,'y':_0xe16a9d}),_0x3f4446=this['_heat']['_renderer'][_0x55c1ed(_0x5bf190._0x32d10c)][_0x55c1ed(0x1bd)](_0x4b5f98-0x1,_0xe16a9d-0x1,0x1,0x1)[_0x55c1ed(0x1d1)];return{'x':_0x4b5f98,'y':_0xe16a9d,'value':_0x3d10d0,'color':'rgba('+_0x3f4446[0x0]+','+_0x3f4446[0x1]+','+_0x3f4446[0x2]+','+_0x3f4446[0x3]+')'};}}mars3d__namespace[_0x228e8b(0x1dc)]['register']('heat',HeatLayer),mars3d__namespace['layer']['HeatLayer']=HeatLayer,mars3d__namespace['h337']=h337__namespace;function getMercatorBounds(_0x98c44b){const _0x3c1d4c={_0xeaf02c:0x194},_0x4e65ee=_0x228e8b,_0x483065=mars3d__namespace[_0x4e65ee(_0x3c1d4c._0xeaf02c)]['lonlat2mercator']([_0x98c44b['xmin'],_0x98c44b[_0x4e65ee(0x1c3)]]),_0x3fbf09=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x98c44b['xmax'],_0x98c44b['ymax']]);return{'xmin':_0x483065[0x0],'ymin':_0x483065[0x1],'xmax':_0x3fbf09[0x0],'ymax':_0x3fbf09[0x1]};}function geLatLngBounds(_0x354bc1){const _0x1e9726={_0x34f230:0x1d5},_0x4cf437=_0x228e8b,_0x1dcb81=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x354bc1['xmin'],_0x354bc1['ymin']]),_0x289fb0=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x354bc1['xmax'],_0x354bc1[_0x4cf437(_0x1e9726._0x34f230)]]);return{'xmin':_0x1dcb81[0x0],'ymin':_0x1dcb81[0x1],'xmax':_0x289fb0[0x0],'ymax':_0x289fb0[0x1]};}function getVertexShaderSource(_0x42de8f){return'in\x20vec3\x20position3DHigh;\x0a\x20\x20in\x20vec3\x20position3DLow;\x0a\x20\x20in\x20vec2\x20st;\x0a\x20\x20in\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20out\x20vec3\x20v_positionMC;\x0a\x20\x20out\x20vec3\x20v_positionEC;\x0a\x20\x20out\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'+_0x42de8f+';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a';}exports['HeatLayer']=HeatLayer,Object[_0x228e8b(0x1d7)](exports,_0x228e8b(0x1b2),{'value':!![]});
}));
