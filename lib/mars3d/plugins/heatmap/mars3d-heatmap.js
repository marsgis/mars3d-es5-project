/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.6.6
 * 编译日期：2023-09-18 16:30:52
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';function _0x43a4(_0x417400,_0x3d7883){const _0xffc3b3=_0xffc3();return _0x43a4=function(_0x43a452,_0x5f50b4){_0x43a452=_0x43a452-0x1c7;let _0x1ce78d=_0xffc3b3[_0x43a452];return _0x1ce78d;},_0x43a4(_0x417400,_0x3d7883);}const _0x26be8a=_0x43a4;(function(_0x7a6624,_0x3ec8e2){const _0x404d04={_0x371cd4:0x1d5,_0x15805c:0x1f4,_0x5b2b2d:0x1fb,_0x3e29db:0x206,_0x2c68bb:0x1df},_0x2502d3=_0x43a4,_0x4e5d92=_0x7a6624();while(!![]){try{const _0x578ec5=parseInt(_0x2502d3(_0x404d04._0x371cd4))/0x1+-parseInt(_0x2502d3(_0x404d04._0x15805c))/0x2*(parseInt(_0x2502d3(_0x404d04._0x5b2b2d))/0x3)+parseInt(_0x2502d3(0x1cb))/0x4*(parseInt(_0x2502d3(0x1d9))/0x5)+parseInt(_0x2502d3(0x215))/0x6+parseInt(_0x2502d3(_0x404d04._0x3e29db))/0x7+parseInt(_0x2502d3(0x1f1))/0x8*(parseInt(_0x2502d3(_0x404d04._0x2c68bb))/0x9)+parseInt(_0x2502d3(0x1da))/0xa*(-parseInt(_0x2502d3(0x200))/0xb);if(_0x578ec5===_0x3ec8e2)break;else _0x4e5d92['push'](_0x4e5d92['shift']());}catch(_0x5a034e){_0x4e5d92['push'](_0x4e5d92['shift']());}}}(_0xffc3,0xb8d2d));function _interopNamespace(_0x5e2b01){const _0x360c3f=_0x43a4;if(_0x5e2b01&&_0x5e2b01['__esModule'])return _0x5e2b01;var _0x6ddb76=Object['create'](null);return _0x5e2b01&&Object['keys'](_0x5e2b01)['forEach'](function(_0x455c72){const _0x52c94e=_0x43a4;if(_0x455c72!==_0x52c94e(0x201)){var _0x20a17b=Object[_0x52c94e(0x221)](_0x5e2b01,_0x455c72);Object['defineProperty'](_0x6ddb76,_0x455c72,_0x20a17b['get']?_0x20a17b:{'enumerable':!![],'get':function(){return _0x5e2b01[_0x455c72];}});}}),_0x6ddb76[_0x360c3f(0x201)]=_0x5e2b01,_0x6ddb76;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337),HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace['create'])throw new Error(_0x26be8a(0x211));const Cesium=mars3d__namespace[_0x26be8a(0x214)],BaseLayer=mars3d__namespace['layer'][_0x26be8a(0x220)],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:_0x26be8a(0x1ee),0.6:'green',0.8:_0x26be8a(0x1e7),0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']};class HeatLayer extends BaseLayer{constructor(_0xb186e={}){const _0x27fa14={_0x444b8e:0x21d,_0x362253:0x212,_0x214913:0x204,_0xcaa05e:0x20f,_0x3ae1cc:0x1cc,_0x4ee964:0x1c9,_0x3bc8bf:0x1c9},_0x27b9a6=_0x26be8a;super(_0xb186e),this['options']['maxCanvasSize']=this['options']['maxCanvasSize']??document[_0x27b9a6(_0x27fa14._0x444b8e)][_0x27b9a6(0x1fc)],this['options']['maxCanvasSize']=Math['min'](this['options'][_0x27b9a6(_0x27fa14._0x362253)],0x1388),this['options']['minCanvasSize']=this[_0x27b9a6(0x1c9)]['minCanvasSize']??document['body'][_0x27b9a6(_0x27fa14._0x214913)],this['options'][_0x27b9a6(_0x27fa14._0xcaa05e)]=Math[_0x27b9a6(_0x27fa14._0x3ae1cc)](this[_0x27b9a6(_0x27fa14._0x4ee964)]['minCanvasSize'],0x2bc),this[_0x27b9a6(_0x27fa14._0x3bc8bf)]['heatStyle']={...DEF_HEATSTYLE,...this['options']['heatStyle']},this['options']['style']={...DEF_STYLE,...this['options']['style']};}get['layer'](){return this['_layer'];}get['heatStyle'](){const _0x3f3b93=_0x26be8a;return this[_0x3f3b93(0x1c9)]['heatStyle'];}set[_0x26be8a(0x21f)](_0x47f315){const _0x148161={_0x305b59:0x1f0,_0x17c152:0x21f,_0x51155d:0x1f7,_0x225187:0x1f3},_0x242454=_0x26be8a;this['options']['heatStyle']=mars3d__namespace[_0x242454(0x1f6)][_0x242454(_0x148161._0x305b59)](this['options'][_0x242454(_0x148161._0x17c152)],_0x47f315),this[_0x242454(_0x148161._0x51155d)]&&(this[_0x242454(_0x148161._0x51155d)]['configure'](this[_0x242454(0x1c9)][_0x242454(0x21f)]),this[_0x242454(_0x148161._0x225187)](!![]));}get['style'](){return this['options']['style'];}set['style'](_0x1c41b2){const _0x59019b={_0x37be55:0x1ef,_0x46a1f1:0x1c9},_0x4bd7f9=_0x26be8a;this['options'][_0x4bd7f9(_0x59019b._0x37be55)]=mars3d__namespace['Util'][_0x4bd7f9(0x1f0)](this[_0x4bd7f9(_0x59019b._0x46a1f1)][_0x4bd7f9(0x1ef)],_0x1c41b2);}get['positions'](){const _0x33c46c=_0x26be8a;return this[_0x33c46c(0x1e8)];}set['positions'](_0x39f5de){const _0x1bd1c8={_0x2c7be3:0x1dc},_0x5338ca=_0x26be8a;this[_0x5338ca(_0x1bd1c8._0x2c7be3)](_0x39f5de);}get[_0x26be8a(0x1e2)](){const _0x4c340b={_0x207af6:0x1eb},_0x360e6a=_0x26be8a,_0x30ba42=[];return this[_0x360e6a(_0x4c340b._0x207af6)][_0x360e6a(0x1ff)](_0x2bd021=>{const _0x393136=_0x360e6a;_0x30ba42['push'](_0x2bd021[_0x393136(0x218)]());}),_0x30ba42;}get['rectangle'](){const _0x2247b0=_0x26be8a;return this[_0x2247b0(0x208)];}['_setOptionsHook'](_0x48e85e,_0x38bfa2){_0x48e85e['positions']&&(this['positions']=_0x48e85e['positions']);}['_mountedHook'](){const _0x2d2c45={_0x35f218:0x1d1,_0x256b76:0x1d1},_0x1d123c=_0x26be8a;this['style']['type']===_0x1d123c(0x1e4)?this[_0x1d123c(_0x2d2c45._0x35f218)]=new mars3d__namespace['layer']['ImageLayer']({'crs':'EPSG:3857','private':!![]}):this[_0x1d123c(_0x2d2c45._0x256b76)]=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}['_addedHook'](){const _0x4e2370={_0x50d2e4:0x1d2,_0x163cfa:0x1c9},_0x2a8126=_0x26be8a;this['_map']['addLayer'](this['_layer']),this['_container']=mars3d__namespace['DomUtil']['create']('div',_0x2a8126(0x21e),this[_0x2a8126(_0x4e2370._0x50d2e4)]['container']),this[_0x2a8126(_0x4e2370._0x163cfa)]['positions']&&(this[_0x2a8126(0x1fd)]=this['options']['positions']),this['options']['flyTo']&&this[_0x2a8126(0x1cd)]();}[_0x26be8a(0x207)](){const _0x22ae8e={_0x57d3ae:0x224},_0x140859=_0x26be8a;this['_container']&&(mars3d__namespace['DomUtil']['remove'](this[_0x140859(_0x22ae8e._0x57d3ae)]),delete this[_0x140859(0x224)]),this['clear'](),this['_map']['removeLayer'](this['_layer']);}['addPosition'](_0x2fa474,_0x20b0aa){const _0x30809f={_0x586a5d:0x1e8,_0x52a092:0x1f3},_0x42b952=_0x26be8a;this[_0x42b952(_0x30809f._0x586a5d)]=this[_0x42b952(_0x30809f._0x586a5d)]||[],this['_positions']['push'](_0x2fa474),this[_0x42b952(_0x30809f._0x52a092)](_0x20b0aa);}['setPositions'](_0x2b1cc3,_0x59d68e){this['_positions']=_0x2b1cc3,this['_updatePositionsHook'](_0x59d68e);}['clear'](){const _0x1c1da3={_0xf61976:0x1f2},_0x481761=_0x26be8a;this['_graphic']&&(this['_layer']['removeGraphic'](this['_graphic'],!![]),delete this[_0x481761(_0x1c1da3._0xf61976)]),this['_graphic2']&&(this['_layer'][_0x481761(0x1f5)](this['_graphic2'],!![]),delete this[_0x481761(0x1d4)]);}['_updatePositionsHook'](_0x1734ff){const _0x20869a={_0x8fce5c:0x1ef,_0x581aed:0x1e4,_0x2db9a3:0x1d6,_0x394a77:0x21c,_0x3d4fe1:0x1e5},_0x5150d8=_0x26be8a;if(!this['show']||!this['_map']||!this['positions']||this['positions']['length']===0x0)return this;const _0x471339=this['_getHeatCanvas']();if(this[_0x5150d8(_0x20869a._0x8fce5c)]['type']===_0x5150d8(_0x20869a._0x581aed))this['_layer']['setOptions']({'url':_0x471339[_0x5150d8(_0x20869a._0x2db9a3)]('image/png'),'rectangle':this['_rectangle'],'opacity':this['style']['opacity']});else this['style']['arc']?this['_graphic']&&_0x1734ff?(this['_graphic']['uniforms'][_0x5150d8(0x1e4)]=_0x471339,this['_graphic']['uniforms'][_0x5150d8(_0x20869a._0x394a77)]=this['_getArcHeatCanvas'](),this['_graphic2']&&(this['_graphic2'][_0x5150d8(0x1e5)][_0x5150d8(_0x20869a._0x581aed)]=_0x471339,this['_graphic2']['uniforms'][_0x5150d8(0x21c)]=this['_graphic'][_0x5150d8(0x1e5)]['bumpMap'])):this['_createArcGraphic'](_0x471339):this['_graphic']&&_0x1734ff?this['_graphic'][_0x5150d8(_0x20869a._0x3d4fe1)]['image']=_0x471339:this[_0x5150d8(0x1d0)](_0x471339);return this;}['_createGraphic'](_0x42aeaf){const _0x2ce048={_0x395340:0x208,_0x26d19c:0x21a},_0x28cb91=_0x26be8a;this['clear'](),this['_graphic']=new mars3d__namespace[(_0x28cb91(0x1ca))]['RectanglePrimitive']({...this['options'],'rectangle':this[_0x28cb91(_0x2ce048._0x395340)],'appearance':new Cesium[(_0x28cb91(_0x2ce048._0x26d19c))]({'material':new Cesium['Material']({'fabric':{'uniforms':{'image':_0x42aeaf},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})}),this['_layer']['addGraphic'](this['_graphic']);}[_0x26be8a(0x20a)](_0x5178c5){const _0x26ebc3={_0x301dbc:0x216,_0x1e20ba:0x213,_0xf2e8d2:0x217,_0xea9ffb:0x213,_0xd31a35:0x1fa,_0xa83a25:0x1ea,_0x3bd672:0x1ef,_0x2b6ad6:0x1d1,_0x2baa63:0x208,_0x52a682:0x21a},_0x5cd6c8=_0x26be8a;this['clear']();const _0xb2656a=Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium[_0x5cd6c8(_0x26ebc3._0x301dbc)][_0x5cd6c8(_0x26ebc3._0x1e20ba)]},'backFunction':Cesium[_0x5cd6c8(_0x26ebc3._0xf2e8d2)]['ALWAYS'],'backOperation':{'fail':Cesium['StencilOperation'][_0x5cd6c8(0x1e9)],'zFail':Cesium[_0x5cd6c8(0x216)]['KEEP'],'zPass':Cesium['StencilOperation'][_0x5cd6c8(_0x26ebc3._0xea9ffb)]},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState']['ALPHA_BLEND']}),_0x4bc039=Math[_0x5cd6c8(0x223)](this[_0x5cd6c8(0x1ef)][_0x5cd6c8(_0x26ebc3._0xd31a35)]??this['_mBoundsMax']*0.02)+0.1;this[_0x5cd6c8(0x1ef)][_0x5cd6c8(_0x26ebc3._0xd31a35)]&&delete this['style']['diffHeight'];const _0x62d8a9=(this['style']['splitNum'],0x64);let _0x563145=Math['max'](this['_rectangle'][_0x5cd6c8(_0x26ebc3._0xa83a25)],this[_0x5cd6c8(0x208)]['width']);this['style']['granularity']=_0x563145/=_0x62d8a9;const _0x41362c=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x5178c5,'repeat':new Cesium[(_0x5cd6c8(0x1e6))](0x1,0x1),'color':new Cesium['Color'](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0x436ebd=this[_0x5cd6c8(_0x26ebc3._0x3bd672)]['arcDirection']||0x1;this['_graphic']=new mars3d__namespace[(_0x5cd6c8(0x1ca))]['RectanglePrimitive']({...this['options'],'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0xb2656a,'material':_0x41362c,'vertexShaderSource':getVertexShaderSource(_0x4bc039*_0x436ebd)})}),this[_0x5cd6c8(_0x26ebc3._0x2b6ad6)]['addGraphic'](this['_graphic']),this['style']['arcDirection']===0x0&&(this['_graphic2']=new mars3d__namespace['graphic']['RectanglePrimitive']({...this['options'],'rectangle':this[_0x5cd6c8(_0x26ebc3._0x2baa63)],'appearance':new Cesium[(_0x5cd6c8(_0x26ebc3._0x52a682))]({'flat':!![],'aboveGround':!![],'renderState':_0xb2656a,'material':_0x41362c,'vertexShaderSource':getVertexShaderSource(-_0x4bc039)})}),this['_layer']['addGraphic'](this['_graphic2']));}[_0x26be8a(0x1db)](_0x327445){const _0x352317=_0x26be8a;return _0x327445!==null&&_0x327445!==void 0x0&&_0x327445['isFormat']&&this['_rectangle']?mars3d__namespace['PolyUtil']['formatRectangle'](this[_0x352317(0x208)]):this[_0x352317(0x208)];}['_getHeatCanvas'](){const _0x145251={_0xdcd0ab:0x1ce,_0x47e0f8:0x1cc,_0x39e128:0x212,_0x59af91:0x1c9,_0x3b0b94:0x219,_0x10b18e:0x205,_0x18b728:0x1ec,_0x152802:0x20d,_0x5aeb2b:0x224,_0x3575f7:0x21b,_0x3b0da4:0x1f7,_0x115210:0x1e3,_0x31fc4f:0x1dd},_0x1122ca={_0x7abe4c:0x1fe,_0x523c28:0x20c},_0x44d3f2={_0x2662fb:0x1c9,_0x21d3a3:0x209,_0x50b053:0x1d7,_0x15c6bb:0x20c},_0x4b8570=_0x26be8a,_0x3da74c=this['_positions'],_0x1da4e9=[];let _0xa8ea83,_0x1e64ad,_0x572d60,_0x303120;_0x3da74c['forEach'](_0xcf5676=>{const _0x1d460f=_0x43a4,_0xd16e40=mars3d__namespace['LngLatPoint']['parse'](_0xcf5676);if(!_0xd16e40)return;_0xd16e40['value']=_0xcf5676[_0x1d460f(0x1fe)]||0x1,!this[_0x1d460f(_0x44d3f2._0x2662fb)]['rectangle']&&(_0xa8ea83===undefined?(_0xa8ea83=_0xd16e40[_0x1d460f(_0x44d3f2._0x21d3a3)],_0x1e64ad=_0xd16e40['lng'],_0x572d60=_0xd16e40[_0x1d460f(_0x44d3f2._0x50b053)],_0x303120=_0xd16e40[_0x1d460f(0x1d7)]):(_0xa8ea83=Math['min'](_0xa8ea83,_0xd16e40['lng']),_0x1e64ad=Math['max'](_0x1e64ad,_0xd16e40['lng']),_0x572d60=Math['min'](_0x572d60,_0xd16e40['lat']),_0x303120=Math['max'](_0x303120,_0xd16e40['lat']))),_0x1da4e9[_0x1d460f(_0x44d3f2._0x15c6bb)](_0xd16e40);});_0xa8ea83===_0x1e64ad&&(_0xa8ea83-=0.000001,_0x1e64ad+=0.000001);_0x572d60===_0x303120&&(_0x572d60-=0.000001,_0x303120+=0.000001);let _0x3cb2b6=this['options']['rectangle']||{'xmin':_0xa8ea83,'xmax':_0x1e64ad,'ymin':_0x572d60,'ymax':_0x303120};const _0x29c1ae=getMercatorBounds(_0x3cb2b6),_0x1f1a1a=Math['abs'](_0x29c1ae[_0x4b8570(_0x145251._0xdcd0ab)]-_0x29c1ae['xmin']),_0x4a8cb8=Math['abs'](_0x29c1ae['ymax']-_0x29c1ae['ymin']),_0x4d3723=Math[_0x4b8570(_0x145251._0x47e0f8)](_0x1f1a1a,_0x4a8cb8),_0x4a7e00=Math['min'](_0x1f1a1a,_0x4a8cb8);this['_mBoundsMax']=_0x4d3723;let _0x5c5d6f=0x1;if(_0x4d3723>this['options']['maxCanvasSize'])_0x5c5d6f=_0x4d3723/this['options'][_0x4b8570(_0x145251._0x39e128)],_0x4a7e00/_0x5c5d6f<this['options']['minCanvasSize']&&(_0x5c5d6f=_0x4a7e00/this[_0x4b8570(_0x145251._0x59af91)]['minCanvasSize']);else _0x4a7e00<this['options']['minCanvasSize']&&(_0x5c5d6f=_0x4a7e00/this['options']['minCanvasSize'],_0x4d3723/_0x5c5d6f>this['options']['maxCanvasSize']&&(_0x5c5d6f=_0x4d3723/this['options']['maxCanvasSize']));const _0x3e2a02=this['heatStyle']['radius']*1.5,_0x599409=_0x1f1a1a/_0x5c5d6f+_0x3e2a02*0x2,_0x5f51e7=_0x4a8cb8/_0x5c5d6f+_0x3e2a02*0x2,_0x1fdd21=_0x3e2a02*_0x5c5d6f;_0x29c1ae[_0x4b8570(0x210)]-=_0x1fdd21,_0x29c1ae['ymin']-=_0x1fdd21,_0x29c1ae['xmax']+=_0x1fdd21,_0x29c1ae['ymax']+=_0x1fdd21,this[_0x4b8570(0x222)]=_0x5c5d6f,_0x3cb2b6=geLatLngBounds(_0x29c1ae),this['_rectangle']=Cesium[_0x4b8570(_0x145251._0x3b0b94)][_0x4b8570(_0x145251._0x10b18e)](_0x3cb2b6[_0x4b8570(0x210)],_0x3cb2b6['ymin'],_0x3cb2b6['xmax'],_0x3cb2b6['ymax']);let _0x5136e6=_0x1da4e9[0x0]['value']??0x1,_0x106ef9=_0x1da4e9[0x0]['value']??0x0;const _0x1ee848=[];_0x1da4e9['forEach'](_0x231b83=>{const _0x3c00e3=_0x4b8570,_0x1065f4=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x231b83['lng'],_0x231b83['lat']]),_0x3c508d=_0x231b83[_0x3c00e3(_0x1122ca._0x7abe4c)]||0x1,_0x218887=Math['round']((_0x1065f4[0x0]-_0x29c1ae['xmin'])/_0x5c5d6f),_0x42bc74=Math['round']((_0x29c1ae['ymax']-_0x1065f4[0x1])/_0x5c5d6f);_0x5136e6=Math['max'](_0x5136e6,_0x3c508d),_0x106ef9=Math['min'](_0x106ef9,_0x3c508d),_0x1ee848[_0x3c00e3(_0x1122ca._0x523c28)]({'x':_0x218887,'y':_0x42bc74,'value':_0x3c508d});});const _0x271276={'min':this['options']['min']??_0x106ef9,'max':this['options']['max']??_0x5136e6,'data':_0x1ee848};this[_0x4b8570(0x1e1)]=_0x271276;if(!this[_0x4b8570(_0x145251._0x18b728)]||_0x29c1ae['xmin']!==this['_last_mBounds']['xmin']||_0x29c1ae['ymin']!==this[_0x4b8570(0x1ec)][_0x4b8570(_0x145251._0x152802)]||_0x29c1ae['xmax']!==this['_last_mBounds']['xmax']||_0x29c1ae['ymax']!==this['_last_mBounds'][_0x4b8570(0x20b)]){this['_last_mBounds']=_0x29c1ae,this[_0x4b8570(_0x145251._0x5aeb2b)]['style']['cssText']='width:'+_0x599409+'px;height:'+_0x5f51e7+'px;';const _0x1b41af={...this['heatStyle'],'container':this[_0x4b8570(0x224)]};!this['_heat']?this['_heat']=h337__namespace[_0x4b8570(_0x145251._0x3575f7)](_0x1b41af):this[_0x4b8570(_0x145251._0x3b0da4)]['configure'](_0x1b41af);}this['_heat']['setData'](_0x271276);const _0x54a608=mars3d__namespace['DomUtil'][_0x4b8570(_0x145251._0x115210)](this['_heat'][_0x4b8570(_0x145251._0x31fc4f)]['canvas']);return _0x54a608;}['_getArcHeatCanvas'](){const _0x120663={_0x4468f2:0x1f7,_0x4966e8:0x1ef,_0x28e570:0x1c8},_0x4154f=_0x26be8a;this[_0x4154f(_0x120663._0x4468f2)]['configure']({'radius':this['heatStyle']['radius']*this[_0x4154f(_0x120663._0x4966e8)]['arcRadiusScale'],'blur':this['heatStyle']['blur']*this['style']['arcBlurScale'],'gradient':this['heatStyle']['gradientArc']||{0.25:_0x4154f(0x1e0),0.55:'rgb(140,140,140)',0.85:'rgb(216,216,216)',0x1:_0x4154f(0x1c7)}});const _0x20d4e7=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat']['_renderer'][_0x4154f(_0x120663._0x28e570)]);return this['_heat'][_0x4154f(0x1f9)](this['options'][_0x4154f(0x21f)]),_0x20d4e7;}[_0x26be8a(0x1cf)](_0x58bbe9){const _0x2e0b16={_0x56f1ba:0x1ed,_0x181d3f:0x1f7,_0x3dbbe7:0x20e},_0x34ca55=_0x26be8a,_0x2f8cab=mars3d__namespace['LngLatPoint'][_0x34ca55(_0x2e0b16._0x56f1ba)](_0x58bbe9);if(!_0x2f8cab)return{};const _0x1e9dcb=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x2f8cab[_0x34ca55(0x209)],_0x2f8cab['lat']]),_0x436d7a=this['_last_mBounds'],_0x4cfb46=Math['round']((_0x1e9dcb[0x0]-_0x436d7a['xmin'])/this['_scale']),_0x5dd6f3=Math['round']((_0x436d7a['ymax']-_0x1e9dcb[0x1])/this['_scale']),_0xc0d708=this[_0x34ca55(0x1f7)]['getValueAt']({'x':_0x4cfb46,'y':_0x5dd6f3}),_0x570901=this[_0x34ca55(_0x2e0b16._0x181d3f)]['_renderer'][_0x34ca55(_0x2e0b16._0x3dbbe7)]['getImageData'](_0x4cfb46-0x1,_0x5dd6f3-0x1,0x1,0x1)['data'];return{'x':_0x4cfb46,'y':_0x5dd6f3,'value':_0xc0d708,'color':_0x34ca55(0x203)+_0x570901[0x0]+','+_0x570901[0x1]+','+_0x570901[0x2]+','+_0x570901[0x3]+')'};}}function _0xffc3(){const _0x4da635=['_rectangle','lng','_createArcGraphic','ymax','push','ymin','ctx','minCanvasSize','xmin','请引入\x20heatmap.js\x20库\x20','maxCanvasSize','REPLACE','Cesium','4913004PewFKE','StencilOperation','StencilFunction','toArray','Rectangle','EllipsoidSurfaceAppearance','create','bumpMap','body','mars3d-heatmap\x20mars3d-hideDiv','heatStyle','BaseLayer','getOwnPropertyDescriptor','_scale','floor','_container','rgb(255,255,255)','canvas','options','graphic','496wzhqbD','max','flyToByAnimationEnd','xmax','getPointData','_createGraphic','_layer','_map','heat','_graphic2','209718bdKmLp','toDataURL','lat','HeatLayer','4610xbYcup','14957210kxFNtf','getRectangle','setPositions','_renderer','mercator2lonlat','9925857xZrTcs','rgb(0,0,0)','_last_heatData','coordinates','copyCanvas','image','uniforms','Cartesian2','yellow','_positions','KEEP','height','points','_last_mBounds','parse','blue','style','merge','8syjuOf','_graphic','_updatePositionsHook','200tFKKUU','removeGraphic','Util','_heat','lonlat2mercator','configure','diffHeight','14607sNMEMU','clientWidth','positions','value','forEach','11CezXNw','default','PointTrans','rgba(','clientHeight','fromDegrees','3457335gfBFMg','_removedHook'];_0xffc3=function(){return _0x4da635;};return _0xffc3();}mars3d__namespace['LayerUtil']['register'](_0x26be8a(0x1d3),HeatLayer),mars3d__namespace['layer']['HeatLayer']=HeatLayer,mars3d__namespace['h337']=h337__namespace;function getMercatorBounds(_0x58dc86){const _0x34670e={_0x3026f2:0x202},_0x4c74fc=_0x26be8a,_0x13c136=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x58dc86['xmin'],_0x58dc86['ymin']]),_0x1566f1=mars3d__namespace[_0x4c74fc(_0x34670e._0x3026f2)][_0x4c74fc(0x1f8)]([_0x58dc86['xmax'],_0x58dc86[_0x4c74fc(0x20b)]]);return{'xmin':_0x13c136[0x0],'ymin':_0x13c136[0x1],'xmax':_0x1566f1[0x0],'ymax':_0x1566f1[0x1]};}function geLatLngBounds(_0x2674d1){const _0x4f2a50={_0x4efcc3:0x20d,_0x4f436f:0x20b},_0x506316=_0x26be8a,_0x1257c1=mars3d__namespace['PointTrans'][_0x506316(0x1de)]([_0x2674d1['xmin'],_0x2674d1[_0x506316(_0x4f2a50._0x4efcc3)]]),_0x1d03b7=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x2674d1['xmax'],_0x2674d1[_0x506316(_0x4f2a50._0x4f436f)]]);return{'xmin':_0x1257c1[0x0],'ymin':_0x1257c1[0x1],'xmax':_0x1d03b7[0x0],'ymax':_0x1d03b7[0x1]};}function getVertexShaderSource(_0x399492){return'in\x20vec3\x20position3DHigh;\x0a\x20\x20in\x20vec3\x20position3DLow;\x0a\x20\x20in\x20vec2\x20st;\x0a\x20\x20in\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20out\x20vec3\x20v_positionMC;\x0a\x20\x20out\x20vec3\x20v_positionEC;\x0a\x20\x20out\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'+_0x399492+';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a';}exports[_0x26be8a(0x1d8)]=HeatLayer,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
