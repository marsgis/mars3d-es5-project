/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.5.5
 * 编译日期：2023-05-04 19:17:29
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';var _0x5bf460=_0x3844;(function(_0x4425a6,_0x2f6896){var _0x288c70={_0x2c5b0b:0x1a9,_0x4bc02a:0x18a,_0xa5812d:0x17c,_0x5cca97:0x1a2},_0x3b8bab=_0x3844,_0x11d80b=_0x4425a6();while(!![]){try{var _0x8cdafb=parseInt(_0x3b8bab(_0x288c70._0x2c5b0b))/0x1+parseInt(_0x3b8bab(0x1ac))/0x2+-parseInt(_0x3b8bab(_0x288c70._0x4bc02a))/0x3*(parseInt(_0x3b8bab(0x18d))/0x4)+-parseInt(_0x3b8bab(0x193))/0x5*(parseInt(_0x3b8bab(_0x288c70._0xa5812d))/0x6)+parseInt(_0x3b8bab(_0x288c70._0x5cca97))/0x7*(-parseInt(_0x3b8bab(0x1b3))/0x8)+parseInt(_0x3b8bab(0x1d8))/0x9+-parseInt(_0x3b8bab(0x189))/0xa;if(_0x8cdafb===_0x2f6896)break;else _0x11d80b['push'](_0x11d80b['shift']());}catch(_0x7b62ac){_0x11d80b['push'](_0x11d80b['shift']());}}}(_0x9912,0x7a9ad));function _0x3844(_0x1eb906,_0x2ba3fe){var _0x991287=_0x9912();return _0x3844=function(_0x38447a,_0x318421){_0x38447a=_0x38447a-0x17a;var _0x2715d2=_0x991287[_0x38447a];return _0x2715d2;},_0x3844(_0x1eb906,_0x2ba3fe);}function _interopNamespace(_0x472495){var _0x4a5f1b={_0x2fa78a:0x1a5},_0x1810fd=_0x3844;if(_0x472495&&_0x472495['__esModule'])return _0x472495;var _0x2f34de=Object['create'](null);return _0x472495&&Object['keys'](_0x472495)['forEach'](function(_0x13e5a0){if(_0x13e5a0!=='default'){var _0x5bbeb8=Object['getOwnPropertyDescriptor'](_0x472495,_0x13e5a0);Object['defineProperty'](_0x2f34de,_0x13e5a0,_0x5bbeb8['get']?_0x5bbeb8:{'enumerable':!![],'get':function(){return _0x472495[_0x13e5a0];}});}}),_0x2f34de[_0x1810fd(_0x4a5f1b._0x2fa78a)]=_0x472495,_0x2f34de;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337);function ownKeys(_0x31db52,_0x477134){var _0x25155c={_0x4eb771:0x1ce},_0x316a72=_0x3844,_0x1821e3=Object['keys'](_0x31db52);if(Object['getOwnPropertySymbols']){var _0x6374bb=Object[_0x316a72(0x1c9)](_0x31db52);_0x477134&&(_0x6374bb=_0x6374bb['filter'](function(_0x5c1edb){return Object['getOwnPropertyDescriptor'](_0x31db52,_0x5c1edb)['enumerable'];})),_0x1821e3[_0x316a72(_0x25155c._0x4eb771)]['apply'](_0x1821e3,_0x6374bb);}return _0x1821e3;}function _objectSpread2(_0x55d216){var _0x10af82={_0x20de3c:0x1cb},_0x22d42d=_0x3844;for(var _0x5d3c65=0x1;_0x5d3c65<arguments[_0x22d42d(_0x10af82._0x20de3c)];_0x5d3c65++){var _0x29c239=null!=arguments[_0x5d3c65]?arguments[_0x5d3c65]:{};_0x5d3c65%0x2?ownKeys(Object(_0x29c239),!0x0)['forEach'](function(_0x2abf24){_defineProperty(_0x55d216,_0x2abf24,_0x29c239[_0x2abf24]);}):Object['getOwnPropertyDescriptors']?Object[_0x22d42d(0x192)](_0x55d216,Object['getOwnPropertyDescriptors'](_0x29c239)):ownKeys(Object(_0x29c239))['forEach'](function(_0x490c8f){Object['defineProperty'](_0x55d216,_0x490c8f,Object['getOwnPropertyDescriptor'](_0x29c239,_0x490c8f));});}return _0x55d216;}function _classCallCheck(_0x55cef8,_0x19e0bb){if(!(_0x55cef8 instanceof _0x19e0bb))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x3c2299,_0x49ead5){var _0x56e8de={_0x5c80bb:0x180},_0x288262=_0x3844;for(var _0x4b1301=0x0;_0x4b1301<_0x49ead5['length'];_0x4b1301++){var _0x3a94e1=_0x49ead5[_0x4b1301];_0x3a94e1['enumerable']=_0x3a94e1['enumerable']||![],_0x3a94e1[_0x288262(_0x56e8de._0x5c80bb)]=!![];if('value'in _0x3a94e1)_0x3a94e1['writable']=!![];Object['defineProperty'](_0x3c2299,_0x3a94e1['key'],_0x3a94e1);}}function _createClass(_0x1d74a1,_0x554bd9,_0x548586){var _0x4593e7={_0x10492a:0x1c7},_0x47f219=_0x3844;if(_0x554bd9)_defineProperties(_0x1d74a1[_0x47f219(_0x4593e7._0x10492a)],_0x554bd9);if(_0x548586)_defineProperties(_0x1d74a1,_0x548586);return Object['defineProperty'](_0x1d74a1,_0x47f219(0x1c7),{'writable':![]}),_0x1d74a1;}function _defineProperty(_0x751346,_0x525584,_0x3907df){return _0x525584 in _0x751346?Object['defineProperty'](_0x751346,_0x525584,{'value':_0x3907df,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x751346[_0x525584]=_0x3907df,_0x751346;}function _0x9912(){var _0x2d33ec=['concat','EllipsoidSurfaceAppearance','_rectangle','body','_layer','_graphic','StencilOperation','DomUtil','arc','prototype','mars3d-heatmap\x20mars3d-hideDiv','getOwnPropertySymbols','PolyUtil','length','setPrototypeOf','xmin','push','diffHeight','px;','RectanglePrimitive','div','addPosition','_heat','clientHeight','blue','ymin','5223798ifEBxg','forEach','HeatLayer','StencilFunction','value','blur','1741128KEavkT','radius','Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined','mercator2lonlat','configurable','_getHeatCanvas','abs','_graphic2','canvas','layer','positions','fromCache','toDataURL','7975060fYFiBl','62085HtqvZN','heatStyle','valueOf','4fKeJId','xmax','clear','options','setPositions','defineProperties','5xXXwHt','rgb(216,216,216)','container','ALPHA_BLEND','rgb(255,255,255)','granularity','minCanvasSize','removeGraphic','max','_map','_updatePositionsHook','type','_scale','_removedHook','maxCanvasSize','119YFqmtj','configure','_positions','default','create','merge','_addedHook','551901pdvHRr','lng','style','986124BgdyxT','round','LngLatPoint','addGraphic','remove','ymax','graphic','6968JFyWpe','__proto__','EPSG:3857','lat','clientWidth','image','_last_mBounds','construct','coordinates','arcDirection','cssText'];_0x9912=function(){return _0x2d33ec;};return _0x9912();}function _inherits(_0x50cee8,_0xa5af6f){var _0x18c9e6=_0x3844;if(typeof _0xa5af6f!=='function'&&_0xa5af6f!==null)throw new TypeError('Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function');_0x50cee8['prototype']=Object['create'](_0xa5af6f&&_0xa5af6f[_0x18c9e6(0x1c7)],{'constructor':{'value':_0x50cee8,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x50cee8,'prototype',{'writable':![]});if(_0xa5af6f)_setPrototypeOf(_0x50cee8,_0xa5af6f);}function _getPrototypeOf(_0x216612){return _getPrototypeOf=Object['setPrototypeOf']?Object['getPrototypeOf']:function _0x17c6c6(_0x459c08){var _0x13b942=_0x3844;return _0x459c08[_0x13b942(0x1b4)]||Object['getPrototypeOf'](_0x459c08);},_getPrototypeOf(_0x216612);}function _setPrototypeOf(_0x13f2ce,_0x3aef43){var _0x7840fe=_0x3844;return _setPrototypeOf=Object[_0x7840fe(0x1cc)]||function _0x50d092(_0x1f6e5b,_0x52221f){return _0x1f6e5b['__proto__']=_0x52221f,_0x1f6e5b;},_setPrototypeOf(_0x13f2ce,_0x3aef43);}function _isNativeReflectConstruct(){var _0x393e0e={_0x417d35:0x1ba,_0x513b7b:0x1ba},_0x39af3a=_0x3844;if(typeof Reflect==='undefined'||!Reflect[_0x39af3a(_0x393e0e._0x417d35)])return![];if(Reflect['construct']['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype'][_0x39af3a(0x18c)]['call'](Reflect[_0x39af3a(_0x393e0e._0x513b7b)](Boolean,[],function(){})),!![];}catch(_0x2e2782){return![];}}function _assertThisInitialized(_0x4038fe){if(_0x4038fe===void 0x0)throw new ReferenceError('this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called');return _0x4038fe;}function _possibleConstructorReturn(_0x2d92bc,_0x20a511){var _0x224c54=_0x3844;if(_0x20a511&&(typeof _0x20a511==='object'||typeof _0x20a511==='function'))return _0x20a511;else{if(_0x20a511!==void 0x0)throw new TypeError(_0x224c54(0x17e));}return _assertThisInitialized(_0x2d92bc);}function _createSuper(_0x1fa636){var _0x21813e=_isNativeReflectConstruct();return function _0x4b01cf(){var _0x15431d=_0x3844,_0x5f1064=_getPrototypeOf(_0x1fa636),_0x2c3b94;if(_0x21813e){var _0x273ec1=_getPrototypeOf(this)['constructor'];_0x2c3b94=Reflect[_0x15431d(0x1ba)](_0x5f1064,arguments,_0x273ec1);}else _0x2c3b94=_0x5f1064['apply'](this,arguments);return _possibleConstructorReturn(this,_0x2c3b94);};}var HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace['create'])throw new Error('请引入\x20heatmap.js\x20库\x20');var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:_0x5bf460(0x1d6),0.6:'green',0.8:'yellow',0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']},HeatLayer=function(_0x293265){var _0x498b80={_0x2ab0fe:0x185,_0xcafe5a:0x19d},_0x54944a={_0x138b00:0x1ad},_0x2e51ca={_0x155a73:0x194,_0x468644:0x1a3},_0xc82c83={_0x19eec3:0x182,_0x3f495d:0x18e,_0x5da20c:0x199,_0x2faf1c:0x1a1,_0x465d08:0x17d,_0x1db70d:0x19f,_0x258746:0x17a,_0x58bcd5:0x1d9,_0x36e795:0x1b9,_0x3f7806:0x1d2,_0x50e1ae:0x19c,_0x4bee96:0x1bd,_0xa27e87:0x1d4,_0x147795:0x1d4,_0x328ab0:0x184},_0x1ec98c={_0x54e74e:0x1aa,_0x5d2420:0x1aa,_0x579087:0x1b6,_0xaee902:0x19b},_0x18f626={_0x339e1d:0x187,_0x47b055:0x1db,_0x1b8197:0x1c4,_0x1fa7d6:0x1c4,_0x36ad73:0x1cf,_0x336aec:0x198,_0x250255:0x1ab},_0x2535d7={_0x154384:0x1d1,_0x408e84:0x1c2},_0x1e6d3={_0x4abc4b:0x1cb,_0x359618:0x1ab,_0x1432d7:0x1c3,_0x563bad:0x183,_0xacc92:0x1c3},_0x1ff76f={_0x40f885:0x19a},_0x556e56={_0x20a705:0x1ce},_0x6be9d7={_0x5320bf:0x195,_0x4098e1:0x1c5,_0x2b0aee:0x1b0,_0x158afc:0x195},_0x52dbde={_0x435099:0x19e,_0x5174d8:0x1b5},_0x2b8ecb={_0x5dbbee:0x186},_0x1afe89={_0x1cc11a:0x1d9},_0x47eac7={_0x6863a6:0x1ce},_0x200aae={_0x403d86:0x1a4},_0x55d8e1={_0x4c9852:0x190},_0x213b19={_0x3bd425:0x18b,_0x192081:0x190},_0x2bc0a2={_0x712285:0x1a1,_0x4bc9c2:0x1b7,_0x145a89:0x190,_0x4b0e50:0x18b,_0x171f57:0x1ab},_0x3a2aea=_0x5bf460;_inherits(_0x24e33b,_0x293265);var _0x3f0dcb=_createSuper(_0x24e33b);function _0x24e33b(){var _0xb80f08=_0x3844,_0x27128a,_0x2fe8c4,_0x1eb6b9,_0x1a52c9=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x24e33b),_0x1eb6b9=_0x3f0dcb['call'](this,_0x1a52c9),_0x1eb6b9[_0xb80f08(0x190)][_0xb80f08(_0x2bc0a2._0x712285)]=(_0x27128a=_0x1eb6b9['options'][_0xb80f08(_0x2bc0a2._0x712285)])!==null&&_0x27128a!==void 0x0?_0x27128a:document[_0xb80f08(0x1c1)][_0xb80f08(_0x2bc0a2._0x4bc9c2)],_0x1eb6b9[_0xb80f08(_0x2bc0a2._0x145a89)]['maxCanvasSize']=Math['min'](_0x1eb6b9['options']['maxCanvasSize'],0x1388),_0x1eb6b9['options']['minCanvasSize']=(_0x2fe8c4=_0x1eb6b9['options']['minCanvasSize'])!==null&&_0x2fe8c4!==void 0x0?_0x2fe8c4:document['body'][_0xb80f08(0x1d5)],_0x1eb6b9['options'][_0xb80f08(0x199)]=Math[_0xb80f08(0x19b)](_0x1eb6b9['options']['minCanvasSize'],0x2bc),_0x1eb6b9['options'][_0xb80f08(_0x2bc0a2._0x4b0e50)]=_objectSpread2(_objectSpread2({},DEF_HEATSTYLE),_0x1eb6b9[_0xb80f08(0x190)]['heatStyle']||{}),_0x1eb6b9['options'][_0xb80f08(_0x2bc0a2._0x171f57)]=_objectSpread2(_objectSpread2({},DEF_STYLE),_0x1eb6b9['options']['style']||{}),_0x1eb6b9;}return _createClass(_0x24e33b,[{'key':_0x3a2aea(_0x498b80._0x2ab0fe),'get':function _0x547465(){var _0x13aeb6=_0x3a2aea;return this[_0x13aeb6(0x1c2)];}},{'key':'heatStyle','get':function _0x1683d1(){return this['options']['heatStyle'];},'set':function _0x262154(_0x3e2edd){var _0x1a6d51=_0x3a2aea;this['options'][_0x1a6d51(_0x213b19._0x3bd425)]=mars3d__namespace['Util'][_0x1a6d51(0x1a7)](this[_0x1a6d51(_0x213b19._0x192081)]['heatStyle'],_0x3e2edd),this['_heat']&&(this['_heat'][_0x1a6d51(0x1a3)](this['options'][_0x1a6d51(_0x213b19._0x3bd425)]),this['_updatePositionsHook'](!![]));}},{'key':'style','get':function _0x1869de(){return this['options']['style'];},'set':function _0x283b3c(_0x43af54){var _0x12636e=_0x3a2aea;this[_0x12636e(_0x55d8e1._0x4c9852)][_0x12636e(0x1ab)]=mars3d__namespace['Util']['merge'](this['options'][_0x12636e(0x1ab)],_0x43af54);}},{'key':'positions','get':function _0x134618(){var _0x3724ac=_0x3a2aea;return this[_0x3724ac(_0x200aae._0x403d86)];},'set':function _0x557442(_0x4ec1d6){var _0x4d08fa=_0x3a2aea;this[_0x4d08fa(0x191)](_0x4ec1d6);}},{'key':_0x3a2aea(0x1bb),'get':function _0x39d774(){var _0x5dcac0=_0x3a2aea,_0x5d9893=[];return this['points'][_0x5dcac0(_0x1afe89._0x1cc11a)](function(_0x56fc4d){var _0x2304a3=_0x5dcac0;_0x5d9893[_0x2304a3(_0x47eac7._0x6863a6)](_0x56fc4d['toArray']());}),_0x5d9893;}},{'key':'rectangle','get':function _0x30a168(){return this['_rectangle'];}},{'key':'_setOptionsHook','value':function _0x216e35(_0x302682,_0x1307df){var _0x2b72bf=_0x3a2aea;_0x302682[_0x2b72bf(_0x2b8ecb._0x5dbbee)]&&(this['positions']=_0x302682['positions']);}},{'key':'_mountedHook','value':function _0x4794f4(){var _0x3a69ea=_0x3a2aea;this[_0x3a69ea(0x1ab)][_0x3a69ea(_0x52dbde._0x435099)]==='image'?this['_layer']=new mars3d__namespace['layer']['ImageLayer']({'crs':_0x3a69ea(_0x52dbde._0x5174d8),'private':!![]}):this['_layer']=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}},{'key':_0x3a2aea(0x1a8),'value':function _0x567b96(){this['_map']['addLayer'](this['_layer']),this['options']['positions']&&(this['positions']=this['options']['positions']),this['options']['flyTo']&&this['flyToByAnimationEnd']();}},{'key':_0x3a2aea(0x1a0),'value':function _0xe2522e(){var _0x4b40d7=_0x3a2aea;this['heatStyle'][_0x4b40d7(_0x6be9d7._0x5320bf)]&&(mars3d__namespace[_0x4b40d7(_0x6be9d7._0x4098e1)][_0x4b40d7(_0x6be9d7._0x2b0aee)](this['heatStyle']['container']),delete this['heatStyle'][_0x4b40d7(_0x6be9d7._0x158afc)]),this['clear'](),this['_map']['removeLayer'](this[_0x4b40d7(0x1c2)]);}},{'key':_0x3a2aea(0x1d3),'value':function _0x491a3c(_0x5d16fd,_0x38a4d2){var _0x1bca54=_0x3a2aea;this['_positions']=this['_positions']||[],this['_positions'][_0x1bca54(_0x556e56._0x20a705)](_0x5d16fd),this['_updatePositionsHook'](_0x38a4d2);}},{'key':'setPositions','value':function _0x452580(_0x2b5eb2,_0xea5096){this['_positions']=_0x2b5eb2,this['_updatePositionsHook'](_0xea5096);}},{'key':'clear','value':function _0x4501d9(){var _0x38399c=_0x3a2aea;this[_0x38399c(0x1c3)]&&(this['_layer']['removeGraphic'](this['_graphic'],!![]),delete this['_graphic']),this['_graphic2']&&(this['_layer'][_0x38399c(_0x1ff76f._0x40f885)](this['_graphic2'],!![]),delete this['_graphic2']);}},{'key':_0x3a2aea(_0x498b80._0xcafe5a),'value':function _0x4f1d81(_0x4383fd){var _0xa8694d=_0x3a2aea;if(!this['show']||!this['_map']||!this['positions']||this['positions'][_0xa8694d(_0x1e6d3._0x4abc4b)]===0x0)return this;var _0x30e3a6=this[_0xa8694d(0x181)]();if(this[_0xa8694d(0x1ab)]['type']==='image')this['_layer']['setOptions']({'url':_0x30e3a6[_0xa8694d(0x188)]('image/png'),'rectangle':this['_rectangle'],'opacity':this[_0xa8694d(_0x1e6d3._0x359618)]['opacity']});else this[_0xa8694d(0x1ab)][_0xa8694d(0x1c6)]?this['_graphic']&&_0x4383fd?(this[_0xa8694d(_0x1e6d3._0x1432d7)]['uniforms']['image']=_0x30e3a6,this['_graphic']['uniforms']['bumpMap']=this['_getArcHeatCanvas'](),this['_graphic2']&&(this[_0xa8694d(_0x1e6d3._0x563bad)]['uniforms']['image']=_0x30e3a6,this[_0xa8694d(0x183)]['uniforms']['bumpMap']=this[_0xa8694d(_0x1e6d3._0xacc92)]['uniforms']['bumpMap'])):this['_createArcGraphic'](_0x30e3a6):this['_graphic']&&_0x4383fd?this[_0xa8694d(_0x1e6d3._0x1432d7)]['uniforms'][_0xa8694d(0x1b8)]=_0x30e3a6:this['_createGraphic'](_0x30e3a6);return this;}},{'key':'_createGraphic','value':function _0x21beb3(_0xd72b77){var _0x273c6=_0x3a2aea;this['clear'](),this['_graphic']=new mars3d__namespace[(_0x273c6(0x1b2))][(_0x273c6(_0x2535d7._0x154384))](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this['_rectangle'],'appearance':new Cesium[(_0x273c6(0x1bf))]({'material':new Cesium['Material']({'fabric':{'uniforms':{'image':_0xd72b77},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})})),this[_0x273c6(_0x2535d7._0x408e84)]['addGraphic'](this['_graphic']);}},{'key':'_createArcGraphic','value':function _0x5daa80(_0x5c5a49){var _0x461b76=_0x3a2aea,_0x39ddaa;this[_0x461b76(0x18f)]();var _0x2206f2=Cesium['RenderState'][_0x461b76(_0x18f626._0x339e1d)]({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium[_0x461b76(_0x18f626._0x47b055)]['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium[_0x461b76(0x1c4)]['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'backFunction':Cesium['StencilFunction']['ALWAYS'],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium[_0x461b76(_0x18f626._0x1b8197)]['KEEP'],'zPass':Cesium[_0x461b76(_0x18f626._0x1fa7d6)]['REPLACE']},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState'][_0x461b76(0x196)]}),_0x25327a=Math['floor']((_0x39ddaa=this['style']['diffHeight'])!==null&&_0x39ddaa!==void 0x0?_0x39ddaa:this['_mBoundsMax']*0.02)+0.1;this['style']['diffHeight']&&delete this['style'][_0x461b76(_0x18f626._0x36ad73)];var _0xafd43e=(this['style']['splitNum'],0x64),_0x5d0040=Math['max'](this['_rectangle']['height'],this[_0x461b76(0x1c0)]['width']);this['style'][_0x461b76(_0x18f626._0x336aec)]=_0x5d0040/=_0xafd43e;var _0x31690b=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x5c5a49,'repeat':new Cesium['Cartesian2'](0x1,0x1),'color':new Cesium['Color'](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0x4153c3=this['style']['arcDirection']||0x1;this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this[_0x461b76(0x1c0)],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x2206f2,'material':_0x31690b,'vertexShaderSource':getVertexShaderSource(_0x25327a*_0x4153c3)})})),this[_0x461b76(0x1c2)][_0x461b76(0x1af)](this['_graphic']),this[_0x461b76(_0x18f626._0x250255)][_0x461b76(0x1bc)]===0x0&&(this['_graphic2']=new mars3d__namespace['graphic'][(_0x461b76(0x1d1))](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x2206f2,'material':_0x31690b,'vertexShaderSource':getVertexShaderSource(-_0x25327a)})})),this['_layer']['addGraphic'](this['_graphic2']));}},{'key':'getRectangle','value':function _0x36b8ae(_0x4b88cb){var _0x178fab=_0x3a2aea;return _0x4b88cb!==null&&_0x4b88cb!==void 0x0&&_0x4b88cb['isFormat']&&this[_0x178fab(0x1c0)]?mars3d__namespace[_0x178fab(0x1ca)]['formatRectangle'](this[_0x178fab(0x1c0)]):this['_rectangle'];}},{'key':'_getHeatCanvas','value':function _0x27902a(){var _0x1d6888={_0xf85aad:0x1ad,_0x179d38:0x1cd,_0x434460:0x19b},_0x4e34d6=_0x3a2aea,_0x54f7b2=this,_0x3e1618,_0x218444,_0x3820bf,_0xbb77bc,_0x34a9bd=this['_positions'],_0x93c350=[],_0x43b307,_0x413421,_0x4169d2,_0x244c5d;_0x34a9bd[_0x4e34d6(0x1d9)](function(_0x4f3e9a){var _0x46ec54=_0x4e34d6,_0x251f59=mars3d__namespace['LngLatPoint']['parse'](_0x4f3e9a);if(!_0x251f59)return;_0x251f59['value']=_0x4f3e9a['value']||0x1,!_0x54f7b2[_0x46ec54(0x190)]['rectangle']&&(_0x43b307===undefined?(_0x43b307=_0x251f59[_0x46ec54(_0x1ec98c._0x54e74e)],_0x413421=_0x251f59[_0x46ec54(_0x1ec98c._0x5d2420)],_0x4169d2=_0x251f59['lat'],_0x244c5d=_0x251f59[_0x46ec54(_0x1ec98c._0x579087)]):(_0x43b307=Math['min'](_0x43b307,_0x251f59['lng']),_0x413421=Math[_0x46ec54(_0x1ec98c._0xaee902)](_0x413421,_0x251f59['lng']),_0x4169d2=Math['min'](_0x4169d2,_0x251f59['lat']),_0x244c5d=Math['max'](_0x244c5d,_0x251f59['lat']))),_0x93c350['push'](_0x251f59);});var _0xbdbd3d=this['options']['rectangle']||{'xmin':_0x43b307,'xmax':_0x413421,'ymin':_0x4169d2,'ymax':_0x244c5d},_0x3652c6=getMercatorBounds(_0xbdbd3d),_0x453ea9=Math[_0x4e34d6(_0xc82c83._0x19eec3)](_0x3652c6[_0x4e34d6(_0xc82c83._0x3f495d)]-_0x3652c6['xmin']),_0x3252a5=Math[_0x4e34d6(0x182)](_0x3652c6[_0x4e34d6(0x1b1)]-_0x3652c6['ymin']),_0xa2e0=Math['max'](_0x453ea9,_0x3252a5),_0x5ba920=Math['min'](_0x453ea9,_0x3252a5);this['_mBoundsMax']=_0xa2e0;var _0x484cf7=0x1;if(_0xa2e0>this['options'][_0x4e34d6(0x1a1)])_0x484cf7=_0xa2e0/this['options']['maxCanvasSize'],_0x5ba920/_0x484cf7<this[_0x4e34d6(0x190)][_0x4e34d6(0x199)]&&(_0x484cf7=_0x5ba920/this['options']['minCanvasSize']);else _0x5ba920<this[_0x4e34d6(0x190)][_0x4e34d6(_0xc82c83._0x5da20c)]&&(_0x484cf7=_0x5ba920/this['options']['minCanvasSize'],_0xa2e0/_0x484cf7>this['options']['maxCanvasSize']&&(_0x484cf7=_0xa2e0/this['options'][_0x4e34d6(_0xc82c83._0x2faf1c)]));var _0xbfaccf=this['heatStyle'][_0x4e34d6(_0xc82c83._0x465d08)]*1.5,_0x18b065=_0x453ea9/_0x484cf7+_0xbfaccf*0x2,_0x23e5a8=_0x3252a5/_0x484cf7+_0xbfaccf*0x2,_0x33bb3e=_0xbfaccf*_0x484cf7;_0x3652c6['xmin']-=_0x33bb3e,_0x3652c6['ymin']-=_0x33bb3e,_0x3652c6[_0x4e34d6(_0xc82c83._0x3f495d)]+=_0x33bb3e,_0x3652c6['ymax']+=_0x33bb3e,this[_0x4e34d6(_0xc82c83._0x1db70d)]=_0x484cf7,_0xbdbd3d=geLatLngBounds(_0x3652c6),this['_rectangle']=Cesium['Rectangle']['fromDegrees'](_0xbdbd3d['xmin'],_0xbdbd3d[_0x4e34d6(0x1d7)],_0xbdbd3d['xmax'],_0xbdbd3d['ymax']);var _0x38fec9=(_0x3e1618=_0x93c350[0x0][_0x4e34d6(_0xc82c83._0x258746)])!==null&&_0x3e1618!==void 0x0?_0x3e1618:0x1,_0x3cd59d=(_0x218444=_0x93c350[0x0]['value'])!==null&&_0x218444!==void 0x0?_0x218444:0x0,_0x21f70c=[];_0x93c350[_0x4e34d6(_0xc82c83._0x58bcd5)](function(_0x5ea16d){var _0x4cb319=_0x4e34d6,_0x2e84da=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x5ea16d['lng'],_0x5ea16d['lat']]),_0x3ac628=_0x5ea16d['value']||0x1,_0x1049a9=Math[_0x4cb319(_0x1d6888._0xf85aad)]((_0x2e84da[0x0]-_0x3652c6[_0x4cb319(_0x1d6888._0x179d38)])/_0x484cf7),_0x1df334=Math['round']((_0x3652c6[_0x4cb319(0x1b1)]-_0x2e84da[0x1])/_0x484cf7);_0x38fec9=Math[_0x4cb319(_0x1d6888._0x434460)](_0x38fec9,_0x3ac628),_0x3cd59d=Math['min'](_0x3cd59d,_0x3ac628),_0x21f70c['push']({'x':_0x1049a9,'y':_0x1df334,'value':_0x3ac628});});var _0x56738b={'min':(_0x3820bf=this['options']['min'])!==null&&_0x3820bf!==void 0x0?_0x3820bf:_0x3cd59d,'max':(_0xbb77bc=this['options']['max'])!==null&&_0xbb77bc!==void 0x0?_0xbb77bc:_0x38fec9,'data':_0x21f70c};this['_last_heatData']=_0x56738b;(!this['_last_mBounds']||_0x3652c6['xmin']!==this['_last_mBounds']['xmin']||_0x3652c6['ymin']!==this['_last_mBounds'][_0x4e34d6(0x1d7)]||_0x3652c6['xmax']!==this['_last_mBounds']['xmax']||_0x3652c6['ymax']!==this['_last_mBounds']['ymax'])&&(this[_0x4e34d6(_0xc82c83._0x36e795)]=_0x3652c6,!this['heatStyle']['container']&&(this['heatStyle']['container']=mars3d__namespace['DomUtil'][_0x4e34d6(0x1a6)](_0x4e34d6(_0xc82c83._0x3f7806),_0x4e34d6(0x1c8),this[_0x4e34d6(_0xc82c83._0x50e1ae)]['container'])),this[_0x4e34d6(0x18b)]['container']['style'][_0x4e34d6(_0xc82c83._0x4bee96)]='width:'['concat'](_0x18b065,'px;height:')['concat'](_0x23e5a8,_0x4e34d6(0x1d0)),!this[_0x4e34d6(_0xc82c83._0xa27e87)]?this['_heat']=h337__namespace['create'](this['heatStyle']):this['_heat']['configure'](this['heatStyle']));this[_0x4e34d6(_0xc82c83._0x147795)]['setData'](_0x56738b);var _0x55447b=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat']['_renderer'][_0x4e34d6(_0xc82c83._0x328ab0)]);return _0x55447b;}},{'key':'_getArcHeatCanvas','value':function _0x12e59d(){var _0x37d975=_0x3a2aea;this['_heat']['configure']({'radius':this[_0x37d975(0x18b)]['radius']*this['style']['arcRadiusScale'],'blur':this['heatStyle'][_0x37d975(0x17b)]*this[_0x37d975(0x1ab)]['arcBlurScale'],'gradient':this[_0x37d975(0x18b)]['gradientArc']||{0.25:'rgb(0,0,0)',0.55:'rgb(140,140,140)',0.85:_0x37d975(_0x2e51ca._0x155a73),0x1:_0x37d975(0x197)}});var _0xd3daed=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat']['_renderer'][_0x37d975(0x184)]);return this['_heat'][_0x37d975(_0x2e51ca._0x468644)](this[_0x37d975(0x190)]['heatStyle']),_0xd3daed;}},{'key':'getPointData','value':function _0x1f75d8(_0x497f80){var _0x8a0918=_0x3a2aea,_0x5cfca8=mars3d__namespace[_0x8a0918(0x1ae)]['parse'](_0x497f80);if(!_0x5cfca8)return{};var _0x2380f5=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x5cfca8['lng'],_0x5cfca8[_0x8a0918(0x1b6)]]),_0x46201c=this['_last_mBounds'],_0x56e2c1=Math['round']((_0x2380f5[0x0]-_0x46201c[_0x8a0918(0x1cd)])/this['_scale']),_0x22e4b8=Math[_0x8a0918(_0x54944a._0x138b00)]((_0x46201c['ymax']-_0x2380f5[0x1])/this['_scale']),_0x1d903c=this['_heat']['getValueAt']({'x':_0x56e2c1,'y':_0x22e4b8}),_0x3c98e4=this['_heat']['_renderer']['ctx']['getImageData'](_0x56e2c1-0x1,_0x22e4b8-0x1,0x1,0x1)['data'];return{'x':_0x56e2c1,'y':_0x22e4b8,'value':_0x1d903c,'color':'rgba('+_0x3c98e4[0x0]+','+_0x3c98e4[0x1]+','+_0x3c98e4[0x2]+','+_0x3c98e4[0x3]+')'};}}]),_0x24e33b;}(BaseLayer);mars3d__namespace[_0x5bf460(0x185)]['HeatLayer']=HeatLayer,mars3d__namespace['LayerUtil']['register']('heat',HeatLayer);function getMercatorBounds(_0x24a64e){var _0x5e991d={_0x66fe4d:0x1b1},_0x523ec9=_0x5bf460,_0x37eade=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x24a64e['xmin'],_0x24a64e[_0x523ec9(0x1d7)]]),_0x5c2766=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x24a64e['xmax'],_0x24a64e[_0x523ec9(_0x5e991d._0x66fe4d)]]);return{'xmin':_0x37eade[0x0],'ymin':_0x37eade[0x1],'xmax':_0x5c2766[0x0],'ymax':_0x5c2766[0x1]};}function geLatLngBounds(_0x5df566){var _0x45e604={_0x17a193:0x17f,_0x587953:0x1d7},_0x356afd=_0x5bf460,_0x4fb1ac=mars3d__namespace['PointTrans'][_0x356afd(_0x45e604._0x17a193)]([_0x5df566['xmin'],_0x5df566[_0x356afd(_0x45e604._0x587953)]]),_0x4f7b5d=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x5df566['xmax'],_0x5df566['ymax']]);return{'xmin':_0x4fb1ac[0x0],'ymin':_0x4fb1ac[0x1],'xmax':_0x4f7b5d[0x0],'ymax':_0x4f7b5d[0x1]};}function getVertexShaderSource(_0x360124){var _0x13ce44=_0x5bf460;return'in\x20vec3\x20position3DHigh;\x0a\x20\x20in\x20vec3\x20position3DLow;\x0a\x20\x20in\x20vec2\x20st;\x0a\x20\x20in\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20out\x20vec3\x20v_positionMC;\x0a\x20\x20out\x20vec3\x20v_positionEC;\x0a\x20\x20out\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'[_0x13ce44(0x1be)](_0x360124,';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a');}exports[_0x5bf460(0x1da)]=HeatLayer,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
