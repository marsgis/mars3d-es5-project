/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.5.2
 * 编译日期：2023-04-03 18:07:12
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';var _0x3253f7=_0x3bd1;(function(_0x43dd7c,_0x52d519){var _0x562b76={_0x3783f6:0x240,_0xf1b15:0x20a},_0x119973=_0x3bd1,_0x580fd2=_0x43dd7c();while(!![]){try{var _0x1ab85f=-parseInt(_0x119973(0x1f9))/0x1+parseInt(_0x119973(0x1f6))/0x2+-parseInt(_0x119973(_0x562b76._0x3783f6))/0x3*(-parseInt(_0x119973(_0x562b76._0xf1b15))/0x4)+parseInt(_0x119973(0x245))/0x5+-parseInt(_0x119973(0x239))/0x6+-parseInt(_0x119973(0x24c))/0x7+parseInt(_0x119973(0x1ee))/0x8;if(_0x1ab85f===_0x52d519)break;else _0x580fd2['push'](_0x580fd2['shift']());}catch(_0x4ee615){_0x580fd2['push'](_0x580fd2['shift']());}}}(_0x45ff,0xa4205));function _interopNamespace(_0x33f8db){var _0x151699={_0x3b3c00:0x227},_0x5870aa=_0x3bd1;if(_0x33f8db&&_0x33f8db[_0x5870aa(0x213)])return _0x33f8db;var _0x30a428=Object['create'](null);return _0x33f8db&&Object['keys'](_0x33f8db)['forEach'](function(_0x2592b3){var _0x224f97=_0x5870aa;if(_0x2592b3!=='default'){var _0xe543a6=Object[_0x224f97(_0x151699._0x3b3c00)](_0x33f8db,_0x2592b3);Object['defineProperty'](_0x30a428,_0x2592b3,_0xe543a6[_0x224f97(0x238)]?_0xe543a6:{'enumerable':!![],'get':function(){return _0x33f8db[_0x2592b3];}});}}),_0x30a428[_0x5870aa(0x1fe)]=_0x33f8db,_0x30a428;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337);function ownKeys(_0x24219f,_0x2a39fb){var _0x1e5547={_0x19b6e5:0x23a,_0x399a92:0x21c},_0xb4f98c={_0x59289a:0x215},_0x650f87=_0x3bd1,_0x5d1e48=Object['keys'](_0x24219f);if(Object[_0x650f87(_0x1e5547._0x19b6e5)]){var _0x454eb7=Object['getOwnPropertySymbols'](_0x24219f);_0x2a39fb&&(_0x454eb7=_0x454eb7['filter'](function(_0x4d9d1c){var _0x37e3bc=_0x650f87;return Object['getOwnPropertyDescriptor'](_0x24219f,_0x4d9d1c)[_0x37e3bc(_0xb4f98c._0x59289a)];})),_0x5d1e48[_0x650f87(_0x1e5547._0x399a92)]['apply'](_0x5d1e48,_0x454eb7);}return _0x5d1e48;}function _objectSpread2(_0x516f07){var _0x2b689d={_0x432093:0x24d},_0x5d823c={_0x3c1a8f:0x202},_0x5b995a=_0x3bd1;for(var _0xeb083a=0x1;_0xeb083a<arguments['length'];_0xeb083a++){var _0x32af75=null!=arguments[_0xeb083a]?arguments[_0xeb083a]:{};_0xeb083a%0x2?ownKeys(Object(_0x32af75),!0x0)[_0x5b995a(_0x2b689d._0x432093)](function(_0x62fa84){_defineProperty(_0x516f07,_0x62fa84,_0x32af75[_0x62fa84]);}):Object['getOwnPropertyDescriptors']?Object['defineProperties'](_0x516f07,Object['getOwnPropertyDescriptors'](_0x32af75)):ownKeys(Object(_0x32af75))['forEach'](function(_0x13f892){var _0x30289e=_0x5b995a;Object[_0x30289e(_0x5d823c._0x3c1a8f)](_0x516f07,_0x13f892,Object['getOwnPropertyDescriptor'](_0x32af75,_0x13f892));});}return _0x516f07;}function _classCallCheck(_0x2e42ec,_0x3a025d){if(!(_0x2e42ec instanceof _0x3a025d))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x42daba,_0x1fecf){var _0x5e22dc={_0x5e3988:0x215},_0x412138=_0x3bd1;for(var _0x280dd2=0x0;_0x280dd2<_0x1fecf['length'];_0x280dd2++){var _0x185ab7=_0x1fecf[_0x280dd2];_0x185ab7['enumerable']=_0x185ab7[_0x412138(_0x5e22dc._0x5e3988)]||![],_0x185ab7['configurable']=!![];if('value'in _0x185ab7)_0x185ab7['writable']=!![];Object['defineProperty'](_0x42daba,_0x185ab7['key'],_0x185ab7);}}function _createClass(_0x142e7a,_0x161e34,_0xe15fbc){if(_0x161e34)_defineProperties(_0x142e7a['prototype'],_0x161e34);if(_0xe15fbc)_defineProperties(_0x142e7a,_0xe15fbc);return Object['defineProperty'](_0x142e7a,'prototype',{'writable':![]}),_0x142e7a;}function _defineProperty(_0x19194,_0x36ab99,_0x48172b){return _0x36ab99 in _0x19194?Object['defineProperty'](_0x19194,_0x36ab99,{'value':_0x48172b,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x19194[_0x36ab99]=_0x48172b,_0x19194;}function _inherits(_0x4d1fa9,_0x521e8c){var _0x3a2ae8=_0x3bd1;if(typeof _0x521e8c!==_0x3a2ae8(0x225)&&_0x521e8c!==null)throw new TypeError('Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function');_0x4d1fa9['prototype']=Object['create'](_0x521e8c&&_0x521e8c[_0x3a2ae8(0x1f2)],{'constructor':{'value':_0x4d1fa9,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x4d1fa9,'prototype',{'writable':![]});if(_0x521e8c)_setPrototypeOf(_0x4d1fa9,_0x521e8c);}function _getPrototypeOf(_0x306743){var _0x2e8a71={_0x53c411:0x229},_0x6e8369=_0x3bd1;return _getPrototypeOf=Object[_0x6e8369(_0x2e8a71._0x53c411)]?Object['getPrototypeOf']:function _0x45e184(_0x1887a6){return _0x1887a6['__proto__']||Object['getPrototypeOf'](_0x1887a6);},_getPrototypeOf(_0x306743);}function _setPrototypeOf(_0x2614ed,_0x1baeaa){return _setPrototypeOf=Object['setPrototypeOf']||function _0x598041(_0x39e7ea,_0x1b38a4){return _0x39e7ea['__proto__']=_0x1b38a4,_0x39e7ea;},_setPrototypeOf(_0x2614ed,_0x1baeaa);}function _isNativeReflectConstruct(){var _0x3d31e7={_0x14b24a:0x211,_0x4f33df:0x1f2},_0x5881c5=_0x3bd1;if(typeof Reflect===_0x5881c5(_0x3d31e7._0x14b24a)||!Reflect['construct'])return![];if(Reflect['construct']['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean[_0x5881c5(_0x3d31e7._0x4f33df)]['valueOf'][_0x5881c5(0x1ef)](Reflect['construct'](Boolean,[],function(){})),!![];}catch(_0x32560a){return![];}}function _assertThisInitialized(_0x20c5a2){var _0x47aab8=_0x3bd1;if(_0x20c5a2===void 0x0)throw new ReferenceError(_0x47aab8(0x20c));return _0x20c5a2;}function _possibleConstructorReturn(_0x35d8c7,_0x4761e5){var _0x1b6d02={_0xa6f970:0x226},_0x5c3ea9=_0x3bd1;if(_0x4761e5&&(typeof _0x4761e5==='object'||typeof _0x4761e5==='function'))return _0x4761e5;else{if(_0x4761e5!==void 0x0)throw new TypeError(_0x5c3ea9(_0x1b6d02._0xa6f970));}return _assertThisInitialized(_0x35d8c7);}function _createSuper(_0x379805){var _0x170185=_isNativeReflectConstruct();return function _0x555090(){var _0x19de32=_0x3bd1,_0x5ef409=_getPrototypeOf(_0x379805),_0x3e2934;if(_0x170185){var _0x329e2a=_getPrototypeOf(this)['constructor'];_0x3e2934=Reflect[_0x19de32(0x1fa)](_0x5ef409,arguments,_0x329e2a);}else _0x3e2934=_0x5ef409['apply'](this,arguments);return _possibleConstructorReturn(this,_0x3e2934);};}function _0x45ff(){var _0x307b96=['toArray','StencilOperation','2691cUToBw','RenderState','_positions','Cartesian2','abs','1719785GkMBDx','heatStyle','radius','_rectangle','xmax','clientHeight','ALWAYS','6541696SmJIUz','forEach','HeatLayer','uniforms','value','concat','_graphic2','create','17360888LsQYas','call','arcDirection','isFormat','prototype','_renderer','options','graphic','731310OWgKYw','round','yellow','732494ggpAkx','construct','GraphicLayer','cssText','image','default','ymax','width:','fromCache','defineProperty','gradientArc','opacity','width','min','_mBoundsMax','clientWidth','_layer','548Amcwig','_updatePositionsHook','this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called','addPosition','KEEP','body','blue','undefined','PointTrans','__esModule','_last_heatData','enumerable','lng','rectangle','granularity','rgb(255,255,255)','Color','LngLatPoint','push','_graphic','style','lat','Rectangle','type','ymin','max','floor','function','Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined','getOwnPropertyDescriptor','BlendingState','setPrototypeOf','addGraphic','minCanvasSize','xmin','_createArcGraphic','positions','_last_mBounds','canvas','getValueAt','_map','_heat','_getArcHeatCanvas','getImageData','mars3d-heatmap\x20mars3d-hideDiv','EllipsoidSurfaceAppearance','get','3979974wwOtXN','getOwnPropertySymbols','clear','StencilFunction','data'];_0x45ff=function(){return _0x307b96;};return _0x45ff();}var HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace['create'])throw new Error('请引入\x20heatmap.js\x20库\x20');var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:_0x3253f7(0x210),0.6:'green',0.8:_0x3253f7(0x1f8),0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']},HeatLayer=function(_0x538f3c){var _0x567d75={_0x1c79b2:0x217,_0x1f8951:0x20b},_0x18e941={_0x322095:0x21b},_0x3151={_0x1ed054:0x219,_0x534ad5:0x233},_0x4837e9={_0x1f7f7e:0x244,_0x51535c:0x1ff,_0x227368:0x207,_0x337ba6:0x1f4,_0x103eba:0x1f4,_0x7d5d79:0x22b,_0x56464a:0x1f4,_0x24c50a:0x22c,_0x3f8de9:0x250,_0x325fe2:0x22f,_0x4775d1:0x200,_0x356b68:0x251,_0x433b76:0x1ed},_0x50657b={_0x17dd0f:0x1ff},_0x531c56={_0x134c5f:0x216,_0x47167b:0x21f,_0x237eab:0x206},_0x31dfe5={_0x4d45a6:0x201,_0x1e703a:0x23f,_0x57513f:0x24b,_0x492cb:0x228,_0x4d9480:0x218,_0x196927:0x1f4,_0x5c020d:0x22a,_0x4f85d5:0x237},_0x18b4c8={_0x2a14a0:0x21e,_0xb3911d:0x1fd,_0x1ea563:0x204,_0x210ce3:0x24f,_0x463ef4:0x21d},_0x769d51={_0x4e2db7:0x242,_0x2daaf7:0x21c},_0xa0943f={_0x2856a6:0x246},_0x439e28={_0x531f12:0x221,_0x33330e:0x1fb},_0x113e41={_0x8a712f:0x24d},_0x36ab7c={_0x45cac5:0x242},_0x243398={_0x200919:0x246,_0x2539c0:0x233},_0x236634={_0x4a96e2:0x20f,_0x2c50e2:0x1f4,_0x36c839:0x20f,_0x124132:0x21e},_0x3838f3=_0x3253f7;_inherits(_0x16e593,_0x538f3c);var _0x15c261=_createSuper(_0x16e593);function _0x16e593(){var _0x5d8954=_0x3bd1,_0x2b0011,_0x3370bf,_0x23698a,_0xf65d04=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x16e593),_0x23698a=_0x15c261['call'](this,_0xf65d04),_0x23698a['options']['maxCanvasSize']=(_0x2b0011=_0x23698a['options']['maxCanvasSize'])!==null&&_0x2b0011!==void 0x0?_0x2b0011:document[_0x5d8954(_0x236634._0x4a96e2)][_0x5d8954(0x208)],_0x23698a[_0x5d8954(_0x236634._0x2c50e2)]['maxCanvasSize']=Math['min'](_0x23698a['options']['maxCanvasSize'],0x1388),_0x23698a['options']['minCanvasSize']=(_0x3370bf=_0x23698a['options']['minCanvasSize'])!==null&&_0x3370bf!==void 0x0?_0x3370bf:document[_0x5d8954(_0x236634._0x36c839)][_0x5d8954(0x24a)],_0x23698a[_0x5d8954(0x1f4)]['minCanvasSize']=Math['max'](_0x23698a[_0x5d8954(_0x236634._0x2c50e2)]['minCanvasSize'],0x2bc),_0x23698a['options']['heatStyle']=_objectSpread2(_objectSpread2({},DEF_HEATSTYLE),_0x23698a['options']['heatStyle']||{}),_0x23698a['options'][_0x5d8954(0x21e)]=_objectSpread2(_objectSpread2({},DEF_STYLE),_0x23698a['options'][_0x5d8954(_0x236634._0x124132)]||{}),_0x23698a;}return _createClass(_0x16e593,[{'key':'layer','get':function _0xb7fd03(){return this['_layer'];}},{'key':_0x3838f3(0x246),'get':function _0x4f4845(){var _0x560877=_0x3838f3;return this['options'][_0x560877(0x246)];},'set':function _0x3f6df1(_0x3797be){var _0x2253bb=_0x3838f3;this['options'][_0x2253bb(_0x243398._0x200919)]=mars3d__namespace['Util']['merge'](this['options']['heatStyle'],_0x3797be),this['_heat']&&(this[_0x2253bb(_0x243398._0x2539c0)]['configure'](this['options']['heatStyle']),this['_updatePositionsHook'](!![]));}},{'key':'style','get':function _0x48c333(){return this['options']['style'];},'set':function _0x1ba475(_0x4ac040){this['options']['style']=mars3d__namespace['Util']['merge'](this['options']['style'],_0x4ac040);}},{'key':'positions','get':function _0x6f248f(){var _0x561aa3=_0x3838f3;return this[_0x561aa3(_0x36ab7c._0x45cac5)];},'set':function _0x25de6c(_0xddb386){this['setPositions'](_0xddb386);}},{'key':'coordinates','get':function _0x243dbf(){var _0x17e6a8={_0xf53518:0x23e},_0xd761d0=_0x3838f3,_0x5528c7=[];return this['points'][_0xd761d0(_0x113e41._0x8a712f)](function(_0x1d9145){var _0x2b1fa3=_0xd761d0;_0x5528c7['push'](_0x1d9145[_0x2b1fa3(_0x17e6a8._0xf53518)]());}),_0x5528c7;}},{'key':_0x3838f3(_0x567d75._0x1c79b2),'get':function _0x41b885(){var _0x5a54b6=_0x3838f3;return this[_0x5a54b6(0x248)];}},{'key':'_setOptionsHook','value':function _0xd10054(_0x4d2436,_0x434677){var _0x4d4ee8=_0x3838f3;_0x4d2436[_0x4d4ee8(0x22e)]&&(this[_0x4d4ee8(0x22e)]=_0x4d2436['positions']);}},{'key':'_mountedHook','value':function _0x4a94be(){var _0x79b28c=_0x3838f3;this['style'][_0x79b28c(_0x439e28._0x531f12)]==='image'?this['_layer']=new mars3d__namespace['layer']['ImageLayer']({'crs':'EPSG:3857','private':!![]}):this['_layer']=new mars3d__namespace['layer'][(_0x79b28c(_0x439e28._0x33330e))]({'private':!![]});}},{'key':'_addedHook','value':function _0x194079(){var _0x5e7db6=_0x3838f3;this['_map']['addLayer'](this['_layer']),this['options']['positions']&&(this['positions']=this['options']['positions']),this[_0x5e7db6(0x1f4)]['flyTo']&&this['flyToByAnimationEnd']();}},{'key':'_removedHook','value':function _0x2ec8c2(){var _0x3ae3d6=_0x3838f3;this['heatStyle']['container']&&(mars3d__namespace['DomUtil']['remove'](this[_0x3ae3d6(_0xa0943f._0x2856a6)]['container']),delete this[_0x3ae3d6(_0xa0943f._0x2856a6)]['container']),this['clear'](),this['_map']['removeLayer'](this[_0x3ae3d6(0x209)]);}},{'key':_0x3838f3(0x20d),'value':function _0x110c15(_0x341792,_0x46bd46){var _0x4cc215=_0x3838f3;this['_positions']=this[_0x4cc215(0x242)]||[],this[_0x4cc215(_0x769d51._0x4e2db7)][_0x4cc215(_0x769d51._0x2daaf7)](_0x341792),this['_updatePositionsHook'](_0x46bd46);}},{'key':'setPositions','value':function _0x2b971f(_0x4841bb,_0x11283f){this['_positions']=_0x4841bb,this['_updatePositionsHook'](_0x11283f);}},{'key':_0x3838f3(0x23b),'value':function _0x3bf4b6(){var _0x12d6a7=_0x3838f3;this[_0x12d6a7(0x21d)]&&(this['_layer']['removeGraphic'](this['_graphic'],!![]),delete this['_graphic']),this[_0x12d6a7(0x252)]&&(this[_0x12d6a7(0x209)]['removeGraphic'](this['_graphic2'],!![]),delete this['_graphic2']);}},{'key':_0x3838f3(_0x567d75._0x1f8951),'value':function _0x23a2aa(_0x20e05b){var _0x516c73=_0x3838f3;if(!this['show']||!this['_map']||!this['positions']||this['positions']['length']===0x0)return this;var _0x1247f8=this['_getHeatCanvas']();if(this[_0x516c73(_0x18b4c8._0x2a14a0)]['type']===_0x516c73(_0x18b4c8._0xb3911d))this['_layer']['setOptions']({'url':_0x1247f8['toDataURL']('image/png'),'rectangle':this['_rectangle'],'opacity':this['style'][_0x516c73(_0x18b4c8._0x1ea563)]});else this[_0x516c73(_0x18b4c8._0x2a14a0)]['arc']?this['_graphic']&&_0x20e05b?(this['_graphic'][_0x516c73(_0x18b4c8._0x210ce3)]['image']=_0x1247f8,this['_graphic']['uniforms']['bumpMap']=this['_getArcHeatCanvas'](),this['_graphic2']&&(this['_graphic2'][_0x516c73(0x24f)]['image']=_0x1247f8,this['_graphic2'][_0x516c73(0x24f)]['bumpMap']=this[_0x516c73(0x21d)]['uniforms']['bumpMap'])):this['_createArcGraphic'](_0x1247f8):this[_0x516c73(_0x18b4c8._0x463ef4)]&&_0x20e05b?this[_0x516c73(0x21d)]['uniforms']['image']=_0x1247f8:this['_createGraphic'](_0x1247f8);return this;}},{'key':'_createGraphic','value':function _0x2d85a1(_0x2788e2){this['clear'](),this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'material':new Cesium['Material']({'fabric':{'uniforms':{'image':_0x2788e2},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})})),this['_layer']['addGraphic'](this['_graphic']);}},{'key':_0x3838f3(0x22d),'value':function _0x897519(_0x3f82aa){var _0x4f832a=_0x3838f3,_0x490156;this['clear']();var _0x9c1c56=Cesium[_0x4f832a(0x241)][_0x4f832a(_0x31dfe5._0x4d45a6)]({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium[_0x4f832a(0x23c)]['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation'][_0x4f832a(0x20e)],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium[_0x4f832a(_0x31dfe5._0x1e703a)]['REPLACE']},'backFunction':Cesium['StencilFunction'][_0x4f832a(_0x31dfe5._0x57513f)],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation'][_0x4f832a(0x20e)],'zPass':Cesium[_0x4f832a(_0x31dfe5._0x1e703a)]['REPLACE']},'reference':0x2,'mask':0x2},'blending':Cesium[_0x4f832a(_0x31dfe5._0x492cb)]['ALPHA_BLEND']}),_0x52254a=Math[_0x4f832a(0x224)]((_0x490156=this['style']['diffHeight'])!==null&&_0x490156!==void 0x0?_0x490156:this['_mBoundsMax']*0.02)+0.1;this['style']['diffHeight']&&delete this['style']['diffHeight'];var _0x318f06=(this['style']['splitNum'],0x64),_0x29f5a2=Math[_0x4f832a(0x223)](this['_rectangle']['height'],this['_rectangle'][_0x4f832a(0x205)]);this['style'][_0x4f832a(_0x31dfe5._0x4d9480)]=_0x29f5a2/=_0x318f06;var _0x2bc587=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x3f82aa,'repeat':new Cesium[(_0x4f832a(0x243))](0x1,0x1),'color':new Cesium[(_0x4f832a(0x21a))](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0xd24bd7=this[_0x4f832a(0x21e)]['arcDirection']||0x1;this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this[_0x4f832a(_0x31dfe5._0x196927)]),{},{'rectangle':this[_0x4f832a(0x248)],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x9c1c56,'material':_0x2bc587,'vertexShaderSource':getVertexShaderSource(_0x52254a*_0xd24bd7)})})),this['_layer'][_0x4f832a(_0x31dfe5._0x5c020d)](this['_graphic']),this[_0x4f832a(0x21e)][_0x4f832a(0x1f0)]===0x0&&(this['_graphic2']=new mars3d__namespace[(_0x4f832a(0x1f5))]['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this['_rectangle'],'appearance':new Cesium[(_0x4f832a(_0x31dfe5._0x4f85d5))]({'flat':!![],'aboveGround':!![],'renderState':_0x9c1c56,'material':_0x2bc587,'vertexShaderSource':getVertexShaderSource(-_0x52254a)})})),this['_layer']['addGraphic'](this['_graphic2']));}},{'key':'getRectangle','value':function _0x4c49f3(_0x4ac4d2){var _0x231c6d=_0x3838f3;return _0x4ac4d2!==null&&_0x4ac4d2!==void 0x0&&_0x4ac4d2[_0x231c6d(0x1f1)]&&this[_0x231c6d(0x248)]?mars3d__namespace['PolyUtil']['formatRectangle'](this['_rectangle']):this['_rectangle'];}},{'key':'_getHeatCanvas','value':function _0x115266(){var _0x37ddb2=_0x3838f3,_0x306e0c=this,_0x520aa4,_0x22d2c4,_0x3db7e8,_0x304504,_0x4431ad=this['_positions'],_0x401d0c=[],_0x43dbce,_0xdb2db4,_0x2ebac2,_0x21f18c;_0x4431ad[_0x37ddb2(0x24d)](function(_0x3718ac){var _0x406ab5=_0x37ddb2,_0x1c6007=mars3d__namespace['LngLatPoint']['parse'](_0x3718ac);if(!_0x1c6007)return;_0x1c6007['value']=_0x3718ac['value']||0x1,!_0x306e0c['options']['rectangle']&&(_0x43dbce===undefined?(_0x43dbce=_0x1c6007['lng'],_0xdb2db4=_0x1c6007[_0x406ab5(_0x531c56._0x134c5f)],_0x2ebac2=_0x1c6007[_0x406ab5(_0x531c56._0x47167b)],_0x21f18c=_0x1c6007['lat']):(_0x43dbce=Math['min'](_0x43dbce,_0x1c6007['lng']),_0xdb2db4=Math[_0x406ab5(0x223)](_0xdb2db4,_0x1c6007['lng']),_0x2ebac2=Math[_0x406ab5(_0x531c56._0x237eab)](_0x2ebac2,_0x1c6007['lat']),_0x21f18c=Math['max'](_0x21f18c,_0x1c6007['lat']))),_0x401d0c[_0x406ab5(0x21c)](_0x1c6007);});var _0x179a24=this['options'][_0x37ddb2(0x217)]||{'xmin':_0x43dbce,'xmax':_0xdb2db4,'ymin':_0x2ebac2,'ymax':_0x21f18c},_0x9e5830=getMercatorBounds(_0x179a24),_0x1f9c94=Math[_0x37ddb2(_0x4837e9._0x1f7f7e)](_0x9e5830['xmax']-_0x9e5830[_0x37ddb2(0x22c)]),_0x410162=Math['abs'](_0x9e5830[_0x37ddb2(_0x4837e9._0x51535c)]-_0x9e5830['ymin']),_0x535b16=Math['max'](_0x1f9c94,_0x410162),_0x5aa9fc=Math['min'](_0x1f9c94,_0x410162);this[_0x37ddb2(_0x4837e9._0x227368)]=_0x535b16;var _0x11e2e7=0x1;if(_0x535b16>this[_0x37ddb2(_0x4837e9._0x337ba6)]['maxCanvasSize'])_0x11e2e7=_0x535b16/this[_0x37ddb2(_0x4837e9._0x337ba6)]['maxCanvasSize'],_0x5aa9fc/_0x11e2e7<this['options'][_0x37ddb2(0x22b)]&&(_0x11e2e7=_0x5aa9fc/this['options']['minCanvasSize']);else _0x5aa9fc<this[_0x37ddb2(_0x4837e9._0x103eba)][_0x37ddb2(_0x4837e9._0x7d5d79)]&&(_0x11e2e7=_0x5aa9fc/this[_0x37ddb2(0x1f4)]['minCanvasSize'],_0x535b16/_0x11e2e7>this[_0x37ddb2(_0x4837e9._0x56464a)]['maxCanvasSize']&&(_0x11e2e7=_0x535b16/this[_0x37ddb2(0x1f4)]['maxCanvasSize']));var _0x1276aa=this['heatStyle']['radius']*1.5,_0x3864a1=_0x1f9c94/_0x11e2e7+_0x1276aa*0x2,_0x4b068d=_0x410162/_0x11e2e7+_0x1276aa*0x2,_0x3544b6=_0x1276aa*_0x11e2e7;_0x9e5830[_0x37ddb2(_0x4837e9._0x24c50a)]-=_0x3544b6,_0x9e5830['ymin']-=_0x3544b6,_0x9e5830['xmax']+=_0x3544b6,_0x9e5830['ymax']+=_0x3544b6,this['_scale']=_0x11e2e7,_0x179a24=geLatLngBounds(_0x9e5830),this['_rectangle']=Cesium[_0x37ddb2(0x220)]['fromDegrees'](_0x179a24[_0x37ddb2(0x22c)],_0x179a24[_0x37ddb2(0x222)],_0x179a24['xmax'],_0x179a24['ymax']);var _0x4a1cdc=(_0x520aa4=_0x401d0c[0x0][_0x37ddb2(_0x4837e9._0x3f8de9)])!==null&&_0x520aa4!==void 0x0?_0x520aa4:0x1,_0x24ed13=(_0x22d2c4=_0x401d0c[0x0]['value'])!==null&&_0x22d2c4!==void 0x0?_0x22d2c4:0x0,_0x5f1aa9=[];_0x401d0c[_0x37ddb2(0x24d)](function(_0x18e136){var _0x5f51c1=_0x37ddb2,_0x201831=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x18e136['lng'],_0x18e136['lat']]),_0x1ef10e=_0x18e136['value']||0x1,_0x79e1f2=Math['round']((_0x201831[0x0]-_0x9e5830[_0x5f51c1(0x22c)])/_0x11e2e7),_0x118f13=Math['round']((_0x9e5830[_0x5f51c1(_0x50657b._0x17dd0f)]-_0x201831[0x1])/_0x11e2e7);_0x4a1cdc=Math['max'](_0x4a1cdc,_0x1ef10e),_0x24ed13=Math['min'](_0x24ed13,_0x1ef10e),_0x5f1aa9['push']({'x':_0x79e1f2,'y':_0x118f13,'value':_0x1ef10e});});var _0x2e15c6={'min':(_0x3db7e8=this['options']['min'])!==null&&_0x3db7e8!==void 0x0?_0x3db7e8:_0x24ed13,'max':(_0x304504=this['options']['max'])!==null&&_0x304504!==void 0x0?_0x304504:_0x4a1cdc,'data':_0x5f1aa9};this[_0x37ddb2(0x214)]=_0x2e15c6;(!this['_last_mBounds']||_0x9e5830['xmin']!==this['_last_mBounds']['xmin']||_0x9e5830[_0x37ddb2(0x222)]!==this['_last_mBounds']['ymin']||_0x9e5830[_0x37ddb2(0x249)]!==this['_last_mBounds'][_0x37ddb2(0x249)]||_0x9e5830['ymax']!==this[_0x37ddb2(_0x4837e9._0x325fe2)]['ymax'])&&(this[_0x37ddb2(0x22f)]=_0x9e5830,!this['heatStyle']['container']&&(this['heatStyle']['container']=mars3d__namespace['DomUtil']['create']('div',_0x37ddb2(0x236),this[_0x37ddb2(0x232)]['container'])),this['heatStyle']['container'][_0x37ddb2(0x21e)][_0x37ddb2(0x1fc)]=_0x37ddb2(_0x4837e9._0x4775d1)[_0x37ddb2(_0x4837e9._0x356b68)](_0x3864a1,'px;height:')['concat'](_0x4b068d,'px;'),!this['_heat']?this[_0x37ddb2(0x233)]=h337__namespace[_0x37ddb2(_0x4837e9._0x433b76)](this['heatStyle']):this['_heat']['configure'](this['heatStyle']));this['_heat']['setData'](_0x2e15c6);var _0x48c37f=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat'][_0x37ddb2(0x1f3)][_0x37ddb2(0x230)]);return _0x48c37f;}},{'key':_0x3838f3(0x234),'value':function _0x346630(){var _0xa199d7=_0x3838f3;this['_heat']['configure']({'radius':this[_0xa199d7(0x246)][_0xa199d7(0x247)]*this['style']['arcRadiusScale'],'blur':this['heatStyle']['blur']*this['style']['arcBlurScale'],'gradient':this['heatStyle'][_0xa199d7(0x203)]||{0.25:'rgb(0,0,0)',0.55:'rgb(140,140,140)',0.85:'rgb(216,216,216)',0x1:_0xa199d7(_0x3151._0x1ed054)}});var _0x167cc4=mars3d__namespace['DomUtil']['copyCanvas'](this[_0xa199d7(_0x3151._0x534ad5)]['_renderer']['canvas']);return this[_0xa199d7(0x233)]['configure'](this['options'][_0xa199d7(0x246)]),_0x167cc4;}},{'key':'getPointData','value':function _0x3993e7(_0xe5edc2){var _0x15ad09=_0x3838f3,_0x30b927=mars3d__namespace[_0x15ad09(_0x18e941._0x322095)]['parse'](_0xe5edc2);if(!_0x30b927)return{};var _0x2e9a43=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x30b927['lng'],_0x30b927['lat']]),_0xfbac4b=this['_last_mBounds'],_0x5760ee=Math[_0x15ad09(0x1f7)]((_0x2e9a43[0x0]-_0xfbac4b['xmin'])/this['_scale']),_0x297f2f=Math['round']((_0xfbac4b['ymax']-_0x2e9a43[0x1])/this['_scale']),_0x55d497=this['_heat'][_0x15ad09(0x231)]({'x':_0x5760ee,'y':_0x297f2f}),_0x11e41e=this[_0x15ad09(0x233)]['_renderer']['ctx'][_0x15ad09(0x235)](_0x5760ee-0x1,_0x297f2f-0x1,0x1,0x1)[_0x15ad09(0x23d)];return{'x':_0x5760ee,'y':_0x297f2f,'value':_0x55d497,'color':'rgba('+_0x11e41e[0x0]+','+_0x11e41e[0x1]+','+_0x11e41e[0x2]+','+_0x11e41e[0x3]+')'};}}]),_0x16e593;}(BaseLayer);function _0x3bd1(_0x57dda0,_0x1a987e){var _0x45ff37=_0x45ff();return _0x3bd1=function(_0x3bd1e7,_0xeed898){_0x3bd1e7=_0x3bd1e7-0x1ed;var _0x2ba9f4=_0x45ff37[_0x3bd1e7];return _0x2ba9f4;},_0x3bd1(_0x57dda0,_0x1a987e);}mars3d__namespace['layer'][_0x3253f7(0x24e)]=HeatLayer,mars3d__namespace['LayerUtil']['register']('heat',HeatLayer);function getMercatorBounds(_0x57703e){var _0x15b8fc=_0x3253f7,_0x1dba0b=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x57703e['xmin'],_0x57703e['ymin']]),_0x2359b9=mars3d__namespace[_0x15b8fc(0x212)]['lonlat2mercator']([_0x57703e['xmax'],_0x57703e['ymax']]);return{'xmin':_0x1dba0b[0x0],'ymin':_0x1dba0b[0x1],'xmax':_0x2359b9[0x0],'ymax':_0x2359b9[0x1]};}function geLatLngBounds(_0x455b61){var _0x4f6aee={_0x4b56e2:0x212},_0x2dab1c=_0x3253f7,_0x35e5b2=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x455b61['xmin'],_0x455b61[_0x2dab1c(0x222)]]),_0xba6563=mars3d__namespace[_0x2dab1c(_0x4f6aee._0x4b56e2)]['mercator2lonlat']([_0x455b61['xmax'],_0x455b61[_0x2dab1c(0x1ff)]]);return{'xmin':_0x35e5b2[0x0],'ymin':_0x35e5b2[0x1],'xmax':_0xba6563[0x0],'ymax':_0xba6563[0x1]};}function getVertexShaderSource(_0x1905d2){return'in\x20vec3\x20position3DHigh;\x0a\x20\x20in\x20vec3\x20position3DLow;\x0a\x20\x20in\x20vec2\x20st;\x0a\x20\x20in\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20out\x20vec3\x20v_positionMC;\x0a\x20\x20out\x20vec3\x20v_positionEC;\x0a\x20\x20out\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'['concat'](_0x1905d2,';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a');}exports['HeatLayer']=HeatLayer,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
