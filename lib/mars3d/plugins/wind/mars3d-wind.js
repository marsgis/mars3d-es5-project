/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.8
 * 编译日期：2023-05-23 19:43:38
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x1a1f03=_0x5c87;(function(_0x47965c,_0x3a4a68){const _0x130a51=_0x5c87,_0x3a5a85=_0x47965c();while(!![]){try{const _0x4bd662=-parseInt(_0x130a51(0x1f7))/0x1*(parseInt(_0x130a51(0x29a))/0x2)+-parseInt(_0x130a51(0x298))/0x3+parseInt(_0x130a51(0x295))/0x4+-parseInt(_0x130a51(0x2c0))/0x5+-parseInt(_0x130a51(0x2a6))/0x6*(parseInt(_0x130a51(0x1fe))/0x7)+-parseInt(_0x130a51(0x2ab))/0x8+parseInt(_0x130a51(0x214))/0x9;if(_0x4bd662===_0x3a4a68)break;else _0x3a5a85['push'](_0x3a5a85['shift']());}catch(_0x20c30b){_0x3a5a85['push'](_0x3a5a85['shift']());}}}(_0x4cc9,0xcd081));function _interopNamespace(_0x5419b8){const _0x56d4fc=_0x5c87;if(_0x5419b8&&_0x5419b8['__esModule'])return _0x5419b8;var _0x243995=Object['create'](null);return _0x5419b8&&Object['keys'](_0x5419b8)[_0x56d4fc(0x2bd)](function(_0x35e510){const _0x44f147=_0x56d4fc;if(_0x35e510!==_0x44f147(0x237)){var _0x5d838c=Object['getOwnPropertyDescriptor'](_0x5419b8,_0x35e510);Object[_0x44f147(0x27d)](_0x243995,_0x35e510,_0x5d838c['get']?_0x5d838c:{'enumerable':!![],'get':function(){return _0x5419b8[_0x35e510];}});}}),_0x243995['default']=_0x5419b8,_0x243995;}var mars3d__namespace=_interopNamespace(mars3d);function _0x5c87(_0x305f5e,_0x5a23e1){const _0x4cc947=_0x4cc9();return _0x5c87=function(_0x5c8770,_0x2b9efc){_0x5c8770=_0x5c8770-0x1e3;let _0x451bdf=_0x4cc947[_0x5c8770];return _0x451bdf;},_0x5c87(_0x305f5e,_0x5a23e1);}const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x3f8fde,_0x15a31f){const _0x1b3dda=_0x5c87,_0x3d6a3e=_0x3f8fde*Math['cos'](Cesium$7['Math'][_0x1b3dda(0x275)](_0x15a31f));return _0x3d6a3e;}function getV(_0x4c00ce,_0x1df534){const _0x1e8448=_0x5c87,_0x4169fe=_0x4c00ce*Math[_0x1e8448(0x283)](Cesium$7['Math']['toRadians'](_0x1df534));return _0x4169fe;}function getSpeed(_0x557eed,_0x1d9873){const _0x1d9df1=_0x5c87,_0x552b5a=Math['sqrt'](Math[_0x1d9df1(0x22c)](_0x557eed,0x2)+Math[_0x1d9df1(0x22c)](_0x1d9873,0x2));return _0x552b5a;}function getDirection(_0xd3721c,_0x1bd71c){const _0x5d07ff=_0x5c87;let _0x3300c2=Cesium$7['Math']['toDegrees'](Math[_0x5d07ff(0x271)](_0x1bd71c,_0xd3721c));return _0x3300c2+=_0x3300c2<0x0?0x168:0x0,_0x3300c2;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x1a1f03(0x213)];class CustomPrimitive{constructor(_0x171c1b){const _0x46e70d=_0x1a1f03;this['commandType']=_0x171c1b['commandType'],this[_0x46e70d(0x250)]=_0x171c1b['geometry'],this['attributeLocations']=_0x171c1b['attributeLocations'],this['primitiveType']=_0x171c1b[_0x46e70d(0x21f)],this['uniformMap']=_0x171c1b['uniformMap'],this['vertexShaderSource']=_0x171c1b['vertexShaderSource'],this['fragmentShaderSource']=_0x171c1b['fragmentShaderSource'],this['rawRenderState']=_0x171c1b['rawRenderState'],this['framebuffer']=_0x171c1b['framebuffer'],this['outputTexture']=_0x171c1b['outputTexture'],this['autoClear']=_0x171c1b['autoClear']??![],this['preExecute']=_0x171c1b['preExecute'],this[_0x46e70d(0x235)]=!![],this[_0x46e70d(0x204)]=undefined,this['clearCommand']=undefined,this[_0x46e70d(0x289)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x46e70d(0x203)]['OPAQUE']}));}[_0x1a1f03(0x1f1)](_0x48b0ba){const _0x53a5dc=_0x1a1f03;switch(this['commandType']){case'Draw':{const _0x40bae1=Cesium$6['VertexArray'][_0x53a5dc(0x25b)]({'context':_0x48b0ba,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x53a5dc(0x257)]}),_0x3cc277=Cesium$6['ShaderProgram']['fromCache']({'context':_0x48b0ba,'attributeLocations':this[_0x53a5dc(0x222)],'vertexShaderSource':this[_0x53a5dc(0x253)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x2eac81=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6[(_0x53a5dc(0x255))]({'primitiveType':this[_0x53a5dc(0x21f)],'shaderProgram':_0x3cc277,'vertexArray':_0x40bae1,'modelMatrix':Cesium$6['Matrix4'][_0x53a5dc(0x241)],'renderState':_0x2eac81,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x53a5dc(0x2a5)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x242a2f,_0x4b1bab){const _0xb048d5=_0x1a1f03;this['geometry']=_0x4b1bab;const _0x6b321=Cesium$6['VertexArray']['fromGeometry']({'context':_0x242a2f,'geometry':this['geometry'],'attributeLocations':this[_0xb048d5(0x222)],'bufferUsage':Cesium$6[_0xb048d5(0x290)][_0xb048d5(0x257)]});this['commandToExecute'][_0xb048d5(0x2be)]=_0x6b321;}[_0x1a1f03(0x1e9)](_0x2757ab){const _0x56b1be=_0x1a1f03;if(!this['show'])return;if(_0x2757ab['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x2757ab['context'])),Cesium$6[_0x56b1be(0x208)](this['preExecute'])&&this[_0x56b1be(0x2af)](),Cesium$6['defined'](this['clearCommand'])&&_0x2757ab[_0x56b1be(0x29c)]['push'](this[_0x56b1be(0x27a)]),_0x2757ab['commandList']['push'](this[_0x56b1be(0x204)]);}['isDestroyed'](){return![];}['destroy'](){const _0x1b47cf=_0x1a1f03;if(this[_0x1b47cf(0x27a)]){var _0x5d810d,_0x24b1cf;(_0x5d810d=this['clearCommand'])!==null&&_0x5d810d!==void 0x0&&_0x5d810d['vertexArray']&&this['clearCommand']['vertexArray'][_0x1b47cf(0x251)](),(_0x24b1cf=this['clearCommand'])!==null&&_0x24b1cf!==void 0x0&&_0x24b1cf['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x1b47cf(0x251)](),delete this[_0x1b47cf(0x27a)];}return this['commandToExecute']&&(this[_0x1b47cf(0x204)][_0x1b47cf(0x2be)]&&this[_0x1b47cf(0x204)]['vertexArray']['destroy'](),this[_0x1b47cf(0x204)][_0x1b47cf(0x2b9)]&&this['commandToExecute'][_0x1b47cf(0x2b9)][_0x1b47cf(0x251)](),delete this['commandToExecute']),Cesium$6[_0x1b47cf(0x2a2)](this);}}const Cesium$5=mars3d__namespace[_0x1a1f03(0x213)],Util=(function(){const _0x459121=function(){const _0x22c44d=_0x5c87,_0x3f6cb2=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x22c44d(0x242))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x22c44d(0x245)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x3f6cb2;},_0x52f888=function(_0x4ebe82,_0x1df57e){const _0x23236d=_0x5c87;if(Cesium$5['defined'](_0x1df57e)){const _0x59d7b8={};_0x59d7b8[_0x23236d(0x224)]=_0x1df57e,_0x4ebe82['source']=_0x59d7b8;}const _0x1bdd92=new Cesium$5[(_0x23236d(0x2b0))](_0x4ebe82);return _0x1bdd92;},_0x482215=function(_0x23b76d,_0x40f773,_0x2c19ef){const _0x4313e2=_0x5c87,_0x1569f9=new Cesium$5[(_0x4313e2(0x272))]({'context':_0x23b76d,'colorTextures':[_0x40f773],'depthTexture':_0x2c19ef});return _0x1569f9;},_0x27be24=function(_0x21233f){const _0x52c2ef=_0x5c87,_0x2ed788=!![],_0x15bb18=![],_0x5beb11={'viewport':_0x21233f['viewport'],'depthTest':_0x21233f['depthTest'],'depthMask':_0x21233f['depthMask'],'blending':_0x21233f[_0x52c2ef(0x1f2)]},_0x3319da=Cesium$5['Appearance']['getDefaultRenderState'](_0x2ed788,_0x15bb18,_0x5beb11);return _0x3319da;},_0x5bc6ee=function(_0x5f1567){const _0xcd2da9=_0x5c87,_0x5fe1f2={},_0x11da49=Cesium$5[_0xcd2da9(0x212)][_0xcd2da9(0x218)](_0x5f1567['west'],Cesium$5['Math']['TWO_PI']),_0x41cbd6=Cesium$5['Math'][_0xcd2da9(0x218)](_0x5f1567['east'],Cesium$5['Math']['TWO_PI']),_0x38b75d=_0x5f1567[_0xcd2da9(0x26d)];let _0x3e2606,_0x2da5bd;_0x38b75d>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x3e2606=0x0,_0x2da5bd=Cesium$5['Math']['TWO_PI']):_0x41cbd6-_0x11da49<_0x38b75d?(_0x3e2606=_0x11da49,_0x2da5bd=_0x11da49+_0x38b75d):(_0x3e2606=_0x11da49,_0x2da5bd=_0x41cbd6);_0x5fe1f2[_0xcd2da9(0x221)]={'min':Cesium$5['Math']['toDegrees'](_0x3e2606),'max':Cesium$5['Math']['toDegrees'](_0x2da5bd)};const _0x1da918=_0x5f1567['south'],_0x18ae25=_0x5f1567['north'],_0x9dad9a=_0x5f1567['height'],_0x347d44=_0x9dad9a>Cesium$5['Math']['PI']/0xc?_0x9dad9a/0x2:0x0;let _0x301b3b=Cesium$5['Math']['clampToLatitudeRange'](_0x1da918-_0x347d44),_0x1f4ceb=Cesium$5[_0xcd2da9(0x212)]['clampToLatitudeRange'](_0x18ae25+_0x347d44);return _0x301b3b<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x301b3b=-Cesium$5['Math']['PI_OVER_TWO']),_0x1f4ceb>Cesium$5['Math']['PI_OVER_THREE']&&(_0x1f4ceb=Cesium$5['Math']['PI_OVER_TWO']),_0x5fe1f2['lat']={'min':Cesium$5['Math']['toDegrees'](_0x301b3b),'max':Cesium$5['Math']['toDegrees'](_0x1f4ceb)},_0x5fe1f2;};return{'getFullscreenQuad':_0x459121,'createTexture':_0x52f888,'createFramebuffer':_0x482215,'createRawRenderState':_0x27be24,'viewRectangleToLonLatRange':_0x5bc6ee};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag=_0x1a1f03(0x2a9),fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x2cb233,_0x1009af,_0x1926fe,_0x1f078c,_0x6a6ed7){const _0x28165f=_0x1a1f03;this['createRenderingTextures'](_0x2cb233,_0x1009af,_0x1926fe[_0x28165f(0x288)]),this[_0x28165f(0x2a0)](_0x2cb233),this['createRenderingPrimitives'](_0x2cb233,_0x1926fe,_0x1f078c,_0x6a6ed7);}[_0x1a1f03(0x22d)](_0x1281f5,_0x592bcd,_0x496d32){const _0x4bb9ea=_0x1a1f03,_0x6e152a={'context':_0x1281f5,'width':_0x1281f5['drawingBufferWidth'],'height':_0x1281f5['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0xc74242={'context':_0x1281f5,'width':_0x1281f5['drawingBufferWidth'],'height':_0x1281f5['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x58e94e=_0x496d32[_0x4bb9ea(0x248)],_0x23e94f=new Float32Array(_0x58e94e*0x3);for(let _0x25c11d=0x0;_0x25c11d<_0x58e94e;_0x25c11d++){const _0x316580=Cesium$4['Color']['fromCssColorString'](_0x496d32[_0x25c11d]);_0x23e94f[0x3*_0x25c11d]=_0x316580['red'],_0x23e94f[0x3*_0x25c11d+0x1]=_0x316580['green'],_0x23e94f[0x3*_0x25c11d+0x2]=_0x316580['blue'];}const _0xee3034={'context':_0x1281f5,'width':_0x58e94e,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x4bb9ea(0x25e))]({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x4bb9ea(0x258)]})};this['textures']={'segmentsColor':Util['createTexture'](_0x6e152a),'segmentsDepth':Util['createTexture'](_0xc74242),'currentTrailsColor':Util['createTexture'](_0x6e152a),'currentTrailsDepth':Util['createTexture'](_0xc74242),'nextTrailsColor':Util['createTexture'](_0x6e152a),'nextTrailsDepth':Util['createTexture'](_0xc74242),'colorTable':Util['createTexture'](_0xee3034,_0x23e94f)};}[_0x1a1f03(0x2a0)](_0x7ba0d8){const _0x417b8c=_0x1a1f03;this['framebuffers']={'segments':Util['createFramebuffer'](_0x7ba0d8,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x7ba0d8,this['textures']['currentTrailsColor'],this[_0x417b8c(0x210)]['currentTrailsDepth']),'nextTrails':Util[_0x417b8c(0x1fc)](_0x7ba0d8,this['textures'][_0x417b8c(0x270)],this['textures'][_0x417b8c(0x2b4)])};}[_0x1a1f03(0x299)](_0x2e69b0){const _0x1bbef8=_0x1a1f03,_0x3f2315=0x4;let _0x4c3ef0=[];for(let _0x3aa0e3=0x0;_0x3aa0e3<_0x2e69b0['particlesTextureSize'];_0x3aa0e3++){for(let _0x4635e9=0x0;_0x4635e9<_0x2e69b0['particlesTextureSize'];_0x4635e9++){for(let _0x4c0364=0x0;_0x4c0364<_0x3f2315;_0x4c0364++){_0x4c3ef0[_0x1bbef8(0x1f9)](_0x3aa0e3/_0x2e69b0['particlesTextureSize']),_0x4c3ef0['push'](_0x4635e9/_0x2e69b0['particlesTextureSize']);}}}_0x4c3ef0=new Float32Array(_0x4c3ef0);let _0x134575=[];const _0x4af164=[-0x1,0x1],_0x1c60f1=[-0x1,0x1];for(let _0x1bd5e7=0x0;_0x1bd5e7<_0x2e69b0['maxParticles'];_0x1bd5e7++){for(let _0x411ca9=0x0;_0x411ca9<_0x3f2315/0x2;_0x411ca9++){for(let _0x4b6ce3=0x0;_0x4b6ce3<_0x3f2315/0x2;_0x4b6ce3++){_0x134575['push'](_0x4af164[_0x411ca9]),_0x134575['push'](_0x1c60f1[_0x4b6ce3]),_0x134575['push'](0x0);}}}_0x134575=new Float32Array(_0x134575);const _0x18614b=0x6*_0x2e69b0[_0x1bbef8(0x2a8)],_0x370bb0=new Uint32Array(_0x18614b);for(let _0xdcd469=0x0,_0xb35867=0x0,_0x1896a8=0x0;_0xdcd469<_0x2e69b0[_0x1bbef8(0x2a8)];_0xdcd469++){_0x370bb0[_0xb35867++]=_0x1896a8+0x0,_0x370bb0[_0xb35867++]=_0x1896a8+0x1,_0x370bb0[_0xb35867++]=_0x1896a8+0x2,_0x370bb0[_0xb35867++]=_0x1896a8+0x2,_0x370bb0[_0xb35867++]=_0x1896a8+0x1,_0x370bb0[_0xb35867++]=_0x1896a8+0x3,_0x1896a8+=0x4;}const _0x228f9c=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x1bbef8(0x25a))]({'componentDatatype':Cesium$4[_0x1bbef8(0x245)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x4c3ef0}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x134575})}),'indices':_0x370bb0});return _0x228f9c;}['createRenderingPrimitives'](_0x643cba,_0x1e3a3d,_0x3b95c6,_0x33e1a5){const _0x1ca090=_0x1a1f03,_0x1b13d7=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x1e3a3d),'primitiveType':Cesium$4[_0x1ca090(0x229)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x1260ea=_0x1ca090;return _0x33e1a5[_0x1260ea(0x2ae)]['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x4146dd=_0x1ca090;return _0x33e1a5[_0x4146dd(0x2ae)]['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x33e1a5['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x1b13d7['textures']['colorTable'];},'aspect':function(){const _0x6db55b=_0x1ca090;return _0x643cba[_0x6db55b(0x1e7)]/_0x643cba[_0x6db55b(0x28a)];},'pixelSize':function(){return _0x3b95c6['pixelSize'];},'lineWidth':function(){return _0x1e3a3d['lineWidth'];},'particleHeight':function(){return _0x1e3a3d['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x1ca090(0x22f))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x1ca090(0x1f4)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x1ca090(0x29b)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x1ca090(0x229)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0xf2830e=_0x1ca090;return _0x1b13d7['textures'][_0xf2830e(0x1eb)];},'segmentsDepthTexture':function(){return _0x1b13d7['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x1b13d7['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x69895c=_0x1ca090;return _0x1b13d7['framebuffers'][_0x69895c(0x24b)][_0x69895c(0x228)];},'fadeOpacity':function(){const _0x5953c8=_0x1ca090;return _0x1e3a3d[_0x5953c8(0x1ea)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x2a62e4=_0x1ca090,_0x35397b=_0x1b13d7[_0x2a62e4(0x1e8)]['currentTrails'];_0x1b13d7[_0x2a62e4(0x1e8)][_0x2a62e4(0x24b)]=_0x1b13d7['framebuffers']['nextTrails'],_0x1b13d7['framebuffers']['nextTrails']=_0x35397b,_0x1b13d7[_0x2a62e4(0x1f0)]['trails']['commandToExecute']['framebuffer']=_0x1b13d7['framebuffers']['nextTrails'],_0x1b13d7['primitives']['trails'][_0x2a62e4(0x27a)][_0x2a62e4(0x233)]=_0x1b13d7['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x1ca090(0x229)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x248b2b=_0x1ca090;return _0x1b13d7[_0x248b2b(0x1e8)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x1b13d7['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x1ca090(0x1f4)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x1a1f03(0x279),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x27381d,_0x8b0884,_0x1b123d,_0x27c0bf){const _0x5f13b3=_0x1a1f03;this[_0x5f13b3(0x281)]=_0x8b0884,this['createWindTextures'](_0x27381d,_0x8b0884),this[_0x5f13b3(0x263)](_0x27381d,_0x1b123d,_0x27c0bf),this['createComputingPrimitives'](_0x8b0884,_0x1b123d,_0x27c0bf);}['createWindTextures'](_0x535918,_0x1c6dd6){const _0x3bbdc5=_0x1a1f03,_0x4187a6={'context':_0x535918,'width':_0x1c6dd6['dimensions']['lon'],'height':_0x1c6dd6[_0x3bbdc5(0x2a7)][_0x3bbdc5(0x22b)]*(_0x1c6dd6[_0x3bbdc5(0x2a7)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x3bbdc5(0x244)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x4187a6,_0x1c6dd6['U']['array']),'V':Util['createTexture'](_0x4187a6,_0x1c6dd6['V']['array'])};}['createParticlesTextures'](_0xaf9964,_0x408e6f,_0x302170){const _0x35de2b=_0x1a1f03,_0x4a471b={'context':_0xaf9964,'width':_0x408e6f[_0x35de2b(0x225)],'height':_0x408e6f['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x35de2b(0x2b5)],'pixelDatatype':Cesium$3['PixelDatatype'][_0x35de2b(0x2b7)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x4c8641=this[_0x35de2b(0x27c)](_0x408e6f['maxParticles'],_0x302170),_0x3ca3e9=new Float32Array(0x4*_0x408e6f['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x4a471b),'currentParticlesPosition':Util['createTexture'](_0x4a471b,_0x4c8641),'nextParticlesPosition':Util['createTexture'](_0x4a471b,_0x4c8641),'currentParticlesSpeed':Util['createTexture'](_0x4a471b,_0x3ca3e9),'nextParticlesSpeed':Util[_0x35de2b(0x29d)](_0x4a471b,_0x3ca3e9),'postProcessingPosition':Util[_0x35de2b(0x29d)](_0x4a471b,_0x4c8641),'postProcessingSpeed':Util['createTexture'](_0x4a471b,_0x3ca3e9)};}[_0x1a1f03(0x27c)](_0x104f4f,_0x1361b8){const _0x395efc=_0x1a1f03,_0x2bdf9b=new Float32Array(0x4*_0x104f4f);for(let _0x1f2953=0x0;_0x1f2953<_0x104f4f;_0x1f2953++){_0x2bdf9b[0x4*_0x1f2953]=Cesium$3['Math']['randomBetween'](_0x1361b8['lonRange']['x'],_0x1361b8['lonRange']['y']),_0x2bdf9b[0x4*_0x1f2953+0x1]=Cesium$3['Math']['randomBetween'](_0x1361b8['latRange']['x'],_0x1361b8['latRange']['y']),_0x2bdf9b[0x4*_0x1f2953+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this['data']['lev'][_0x395efc(0x2bf)]),_0x2bdf9b[0x4*_0x1f2953+0x3]=0x0;}return _0x2bdf9b;}['destroyParticlesTextures'](){const _0x388bd0=_0x1a1f03;Object['keys'](this['particlesTextures'])[_0x388bd0(0x2bd)](_0x19ca3a=>{this['particlesTextures'][_0x19ca3a]['destroy']();});}['createComputingPrimitives'](_0xd2eb4,_0x3dc428,_0x54433d){const _0xecfd2a=_0x1a1f03,_0x202c1a=new Cesium$3[(_0xecfd2a(0x1f5))](_0xd2eb4['dimensions']['lon'],_0xd2eb4['dimensions'][_0xecfd2a(0x22b)],_0xd2eb4[_0xecfd2a(0x2a7)][_0xecfd2a(0x27e)]),_0x11e2a6=new Cesium$3['Cartesian3'](_0xd2eb4['lon']['min'],_0xd2eb4['lat']['min'],_0xd2eb4[_0xecfd2a(0x27e)]['min']),_0x50b4da=new Cesium$3[(_0xecfd2a(0x1f5))](_0xd2eb4['lon']['max'],_0xd2eb4[_0xecfd2a(0x22b)][_0xecfd2a(0x2bf)],_0xd2eb4['lev']['max']),_0x1ef75d=new Cesium$3['Cartesian3']((_0x50b4da['x']-_0x11e2a6['x'])/(_0x202c1a['x']-0x1),(_0x50b4da['y']-_0x11e2a6['y'])/(_0x202c1a['y']-0x1),_0x202c1a['z']>0x1?(_0x50b4da['z']-_0x11e2a6['z'])/(_0x202c1a['z']-0x1):0x1),_0x47c6ba=new Cesium$3['Cartesian2'](_0xd2eb4['U']['min'],_0xd2eb4['U']['max']),_0x1761e6=new Cesium$3['Cartesian2'](_0xd2eb4['V']['min'],_0xd2eb4['V']['max']),_0x27ba7d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0xecfd2a(0x217),'uniformMap':{'U':function(){return _0x27ba7d['windTextures']['U'];},'V':function(){return _0x27ba7d['windTextures']['V'];},'currentParticlesPosition':function(){const _0x17c061=_0xecfd2a;return _0x27ba7d['particlesTextures'][_0x17c061(0x1ff)];},'dimension':function(){return _0x202c1a;},'minimum':function(){return _0x11e2a6;},'maximum':function(){return _0x50b4da;},'interval':function(){return _0x1ef75d;}},'fragmentShaderSource':new Cesium$3[(_0xecfd2a(0x22f))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x271978=_0xecfd2a;_0x27ba7d[_0x271978(0x1f0)]['getWind'][_0x271978(0x204)]['outputTexture']=_0x27ba7d[_0x271978(0x2ae)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x27ba7d['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x4035ef=_0xecfd2a;return _0x27ba7d['particlesTextures'][_0x4035ef(0x1ee)];},'uSpeedRange':function(){return _0x47c6ba;},'vSpeedRange':function(){return _0x1761e6;},'pixelSize':function(){const _0x4742ef=_0xecfd2a;return _0x54433d[_0x4742ef(0x282)];},'speedFactor':function(){return _0x3dc428['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0xecfd2a(0x2ae)]['nextParticlesSpeed'],'preExecute':function(){const _0x32b94d=_0xecfd2a,_0x58f4bf=_0x27ba7d['particlesTextures'][_0x32b94d(0x1e6)];_0x27ba7d['particlesTextures'][_0x32b94d(0x1e6)]=_0x27ba7d['particlesTextures']['postProcessingSpeed'],_0x27ba7d['particlesTextures']['postProcessingSpeed']=_0x58f4bf,_0x27ba7d['primitives'][_0x32b94d(0x23d)][_0x32b94d(0x204)]['outputTexture']=_0x27ba7d['particlesTextures'][_0x32b94d(0x26f)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x27ba7d['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x27ba7d['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0xecfd2a(0x2ae)][_0xecfd2a(0x26a)],'preExecute':function(){const _0x188454=_0xecfd2a,_0xbb8e9d=_0x27ba7d[_0x188454(0x2ae)][_0x188454(0x1ff)];_0x27ba7d['particlesTextures'][_0x188454(0x1ff)]=_0x27ba7d['particlesTextures']['postProcessingPosition'],_0x27ba7d[_0x188454(0x2ae)]['postProcessingPosition']=_0xbb8e9d,_0x27ba7d[_0x188454(0x1f0)]['updatePosition']['commandToExecute'][_0x188454(0x266)]=_0x27ba7d[_0x188454(0x2ae)][_0x188454(0x26a)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x33a81e=_0xecfd2a;return _0x27ba7d[_0x33a81e(0x2ae)]['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x27ba7d['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x54433d['lonRange'];},'latRange':function(){return _0x54433d['latRange'];},'randomCoefficient':function(){const _0x33c201=_0xecfd2a,_0x2eaa97=Math[_0x33c201(0x1ed)]();return _0x2eaa97;},'dropRate':function(){return _0x3dc428['dropRate'];},'dropRateBump':function(){return _0x3dc428['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0xecfd2a(0x22f))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x19b951=_0xecfd2a;_0x27ba7d['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x27ba7d['particlesTextures'][_0x19b951(0x2ac)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x2ec085=_0xecfd2a;return _0x27ba7d['particlesTextures'][_0x2ec085(0x2ac)];},'nextParticlesSpeed':function(){const _0x2454e3=_0xecfd2a;return _0x27ba7d[_0x2454e3(0x2ae)][_0x2454e3(0x26f)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0xecfd2a(0x25c)],'preExecute':function(){const _0x3c6b69=_0xecfd2a;_0x27ba7d['primitives'][_0x3c6b69(0x25c)]['commandToExecute']['outputTexture']=_0x27ba7d[_0x3c6b69(0x2ae)]['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x1a1f03(0x213)];class ParticleSystem{constructor(_0x50bd28,_0x158727,_0x1a0aa0,_0x2fa73c){const _0x3be239=_0x1a1f03;this[_0x3be239(0x206)]=_0x50bd28,_0x158727={..._0x158727},_0x158727['udata']&&_0x158727['vdata']&&(_0x158727['dimensions']={},_0x158727['dimensions']['lon']=_0x158727['cols'],_0x158727[_0x3be239(0x2a7)][_0x3be239(0x22b)]=_0x158727[_0x3be239(0x25f)],_0x158727['dimensions']['lev']=_0x158727['lev']||0x1,_0x158727['lon']={},_0x158727['lon'][_0x3be239(0x238)]=_0x158727['xmin'],_0x158727['lon']['max']=_0x158727['xmax'],_0x158727['lat']={},_0x158727['lat'][_0x3be239(0x238)]=_0x158727['ymin'],_0x158727['lat']['max']=_0x158727['ymax'],_0x158727['lev']={},_0x158727['lev'][_0x3be239(0x238)]=_0x158727['levmin']??0x1,_0x158727['lev'][_0x3be239(0x2bf)]=_0x158727[_0x3be239(0x278)]??0x1,_0x158727['U']={},_0x158727['U']['array']=new Float32Array(_0x158727['udata']),_0x158727['U']['min']=_0x158727['umin']??Math['min'](..._0x158727['udata']),_0x158727['U'][_0x3be239(0x2bf)]=_0x158727['umax']??Math[_0x3be239(0x2bf)](..._0x158727['udata']),_0x158727['V']={},_0x158727['V']['array']=new Float32Array(_0x158727['vdata']),_0x158727['V']['min']=_0x158727['vmin']??Math['min'](..._0x158727['vdata']),_0x158727['V']['max']=_0x158727['vmax']??Math['max'](..._0x158727['vdata'])),this['data']=_0x158727,this[_0x3be239(0x231)]=_0x1a0aa0,this['viewerParameters']=_0x2fa73c,this['particlesComputing']=new ParticlesComputing(this[_0x3be239(0x206)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x3be239(0x231)],this['viewerParameters'],this['particlesComputing']);}[_0x1a1f03(0x1fa)](_0x473bd7){const _0xb8a3e0=_0x1a1f03;this['particlesComputing']['destroyParticlesTextures'](),Object[_0xb8a3e0(0x2bb)](this[_0xb8a3e0(0x26b)]['windTextures'])[_0xb8a3e0(0x2bd)](_0x327276=>{const _0x37b318=_0xb8a3e0;this[_0x37b318(0x26b)]['windTextures'][_0x327276][_0x37b318(0x251)]();}),this['particlesRendering'][_0xb8a3e0(0x210)][_0xb8a3e0(0x24c)][_0xb8a3e0(0x251)](),Object['keys'](this[_0xb8a3e0(0x280)]['framebuffers'])['forEach'](_0x5de7ed=>{const _0x546693=_0xb8a3e0;this[_0x546693(0x280)]['framebuffers'][_0x5de7ed]['destroy']();}),this[_0xb8a3e0(0x206)]=_0x473bd7,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0xb8a3e0(0x281)],this['options'],this['viewerParameters']),this[_0xb8a3e0(0x280)]=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0xb8a3e0(0x236)],this[_0xb8a3e0(0x26b)]);}['clearFramebuffers'](){const _0x367dc1=_0x1a1f03,_0x287f71=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x367dc1(0x203)]['OPAQUE']});Object[_0x367dc1(0x2bb)](this[_0x367dc1(0x280)]['framebuffers'])[_0x367dc1(0x2bd)](_0x3cceba=>{const _0x2454bd=_0x367dc1;_0x287f71[_0x2454bd(0x233)]=this['particlesRendering']['framebuffers'][_0x3cceba],_0x287f71['execute'](this['context']);});}['refreshParticles'](_0x260742){const _0xaf961a=_0x1a1f03;this[_0xaf961a(0x2b1)](),this['particlesComputing']['destroyParticlesTextures'](),this[_0xaf961a(0x26b)]['createParticlesTextures'](this['context'],this[_0xaf961a(0x231)],this['viewerParameters']);if(_0x260742){const _0x49fd94=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives'][_0xaf961a(0x29b)]['geometry']=_0x49fd94;const _0xd9275d=Cesium$2['VertexArray'][_0xaf961a(0x25b)]({'context':this[_0xaf961a(0x206)],'geometry':_0x49fd94,'attributeLocations':this['particlesRendering'][_0xaf961a(0x1f0)][_0xaf961a(0x29b)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0xaf961a(0x257)]});this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0xd9275d;}}[_0x1a1f03(0x2aa)](_0x437acf){const _0xa3156e=_0x1a1f03;let _0x16d22c=![];this['options']['maxParticles']!==_0x437acf[_0xa3156e(0x2a8)]&&(_0x16d22c=!![]),Object[_0xa3156e(0x2bb)](_0x437acf)['forEach'](_0xf41d5d=>{this['options'][_0xf41d5d]=_0x437acf[_0xf41d5d];}),this['refreshParticles'](_0x16d22c);}['applyViewerParameters'](_0x383b1b){const _0x2b0962=_0x1a1f03;Object['keys'](_0x383b1b)[_0x2b0962(0x2bd)](_0x45b5ac=>{this['viewerParameters'][_0x45b5ac]=_0x383b1b[_0x45b5ac];}),this['refreshParticles'](![]);}['destroy'](){const _0xe2d155=_0x1a1f03;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0xe2d155(0x26b)]['windTextures'])['forEach'](_0x566df3=>{const _0xc6b902=_0xe2d155;this[_0xc6b902(0x26b)][_0xc6b902(0x226)][_0x566df3]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0xe2d155(0x1e8)])['forEach'](_0x1516f3=>{const _0x377daa=_0xe2d155;this['particlesRendering'][_0x377daa(0x1e8)][_0x1516f3]['destroy']();});for(const _0x5d9694 in this){delete this[_0x5d9694];}}}function _0x4cc9(){const _0x217495=['createTexture','preRender','xmin','createRenderingFramebuffers','layer','destroyObject','bindEvent','_onMouseMoveEvent','fragmentShaderSource','8430PODygN','dimensions','maxParticles','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','setOptions','10948232JsEByq','postProcessingPosition','_pointerEvents','particlesTextures','preExecute','Texture','clearFramebuffers','LayerUtil','onmessage','nextTrailsDepth','RGBA','clientHeight','FLOAT','mouseMove','shaderProgram','_canrefresh','keys','screen','forEach','vertexArray','max','5834155bjhXXz','_createCanvas','cancelAnimationFrame','getUVByXY','floor','currentParticlesSpeed','drawingBufferWidth','framebuffers','update','fadeOpacity','segmentsColor','round','random','particlesWind','_calc_speedRate','primitives','createCommand','blending','canvasWind','createRawRenderState','Cartesian3','setData','530459uFbKMD','_drawLines','push','canvasResize','getUVByPoint','createFramebuffer','canvasContext','133jSNXVr','currentParticlesPosition','mouseUp','unbindEvent','off','Pass','commandToExecute','_calcUV','context','#ffffff','defined','toGridXY','udata','mouseHidden','removeAll','_tomap','_onMouseUpEvent','grid','textures','redraw','Math','Cesium','44618463PCTJYu','beginPath','__esModule','Compute','mod','canvas','ellipsoid','lng','cols','_addedHook','ymax','primitiveType','_setOptionsHook','lon','attributeLocations','WindLayer','arrayBufferView','particlesTextureSize','windTextures','_onMouseDownEvent','depthTexture','PrimitiveType','add','lat','pow','createRenderingTextures','style','ShaderSource','xmax','options','pointer-events','framebuffer','pointerEvents','show','viewerParameters','default','min','_onMap_preRenderEvent','globeBoundingSphere','worker','canvasWidth','updateSpeed','speedRate','getOptions','remove','IDENTITY','GeometryAttributes','resize','LUMINANCE','ComponentDatatype','updateViewerParameters','age','length','ymin','getContext','currentTrails','colorTable','mouse_move','zIndex','windField','geometry','destroy','particles','vertexShaderSource','rgb(206,255,255)','DrawCommand','Cartesian2','STATIC_DRAW','LINEAR','particleSystem','GeometryAttribute','fromGeometry','postProcessingSpeed','_speedRate','Sampler','rows','clientWidth','BaseLayer','_showHook','createParticlesTextures','_onMapWhellEvent','tlat','outputTexture','once','_map','wheel','nextParticlesPosition','particlesComputing','maxAge','width','camera','nextParticlesSpeed','nextTrailsColor','atan2','Framebuffer','color','sqrt','toRadians','clear','setDate','levmax','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','clearCommand','removeChild','randomizeParticles','defineProperty','lev','positionWC','particlesRendering','data','pixelSize','sin','visibility','mouse_down','mars3d-canvasWind','fromDegrees','colors','autoClear','drawingBufferHeight','EventType','globalCompositeOperation','tlng','_bilinearInterpolation','isInExtent','BufferUsage','mode','particlesNumber','destination-in','_randomParticle','5649132gVGmij','scene','_data','4129947oeXFVK','createSegmentsGeometry','6FCvrfa','segments','commandList'];_0x4cc9=function(){return _0x217495;};return _0x4cc9();}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x1a1f03(0x261)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x1a1f03(0x254)]};class WindLayer extends BaseLayer$1{constructor(_0x42c465={}){_0x42c465={...DEF_OPTIONS,..._0x42c465},super(_0x42c465),this['_setOptionsHook'](_0x42c465);}get[_0x1a1f03(0x2a1)](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x349abe){this['setData'](_0x349abe);}get[_0x1a1f03(0x288)](){const _0x4c982c=_0x1a1f03;return this[_0x4c982c(0x231)]['colors'];}set[_0x1a1f03(0x288)](_0x49f0e2){const _0x4d3e4b=_0x1a1f03;this['options']['colors']=_0x49f0e2,this[_0x4d3e4b(0x259)]&&this['particleSystem'][_0x4d3e4b(0x2aa)]({'colors':_0x49f0e2}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x2e87f7=_0x1a1f03;this['scene']=this[_0x2e87f7(0x268)]['scene'],this[_0x2e87f7(0x26e)]=this[_0x2e87f7(0x268)][_0x2e87f7(0x26e)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this[_0x2e87f7(0x1f0)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x2e87f7(0x256))](),'pixelSize':0x0},this[_0x2e87f7(0x23a)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x2e87f7(0x24d)]=![],this[_0x2e87f7(0x268)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x2e87f7(0x268)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x2e87f7(0x227)],this),this[_0x2e87f7(0x268)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x2e87f7(0x268)]['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x2e87f7(0x2a4)],this),this[_0x2e87f7(0x297)]&&this[_0x2e87f7(0x1f6)](this['_data']);}['_removedHook'](){const _0x8a562f=_0x1a1f03;window['removeEventListener']('resize',this[_0x8a562f(0x243)]),this['_map']['off'](mars3d__namespace[_0x8a562f(0x28b)][_0x8a562f(0x29e)],this['_onMap_preRenderEvent'],this),this['_map'][_0x8a562f(0x202)](mars3d__namespace['EventType'][_0x8a562f(0x269)],this['_onMapWhellEvent'],this),this[_0x8a562f(0x268)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x8a562f(0x202)](mars3d__namespace['EventType'][_0x8a562f(0x200)],this[_0x8a562f(0x20e)],this),this['_map']['off'](mars3d__namespace[_0x8a562f(0x28b)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x8a562f(0x1f0)]['removeAll'](),this[_0x8a562f(0x268)][_0x8a562f(0x296)]['primitives'][_0x8a562f(0x240)](this['primitives']);}['resize'](){const _0x1ab42e=_0x1a1f03;if(!this[_0x1ab42e(0x235)]||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x1ab42e(0x1f0)][_0x1ab42e(0x20c)](),this['_map'][_0x1ab42e(0x267)](mars3d__namespace[_0x1ab42e(0x28b)][_0x1ab42e(0x29e)],this['_onMap_preRenderEvent'],this);}[_0x1a1f03(0x239)](_0x1f82bc){const _0x5ceaae=_0x1a1f03;this[_0x5ceaae(0x259)]['canvasResize'](this['scene']['context']),this['addPrimitives'](),this[_0x5ceaae(0x1f0)]['show']=!![];}['_onMapWhellEvent'](_0x2b256a){const _0x3355fc=_0x1a1f03;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x3355fc(0x259)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x339d0c=_0x3355fc;if(!this[_0x339d0c(0x235)])return;this[_0x339d0c(0x211)]();},0xc8);}['_onMouseDownEvent'](_0x1eaf0f){const _0x41796f=_0x1a1f03;this[_0x41796f(0x285)]=!![];}[_0x1a1f03(0x2a4)](_0x58d6ab){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x54667d){const _0x352942=_0x1a1f03;if(!this[_0x352942(0x235)]||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x352942(0x24d)]=![];}['redraw'](){const _0xca0bf5=_0x1a1f03;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0xca0bf5(0x259)]['applyViewerParameters'](this[_0xca0bf5(0x236)]),this['primitives']['show']=!![];}[_0x1a1f03(0x1f6)](_0x397861){const _0x21a6b8=_0x1a1f03;this['_data']=_0x397861,this[_0x21a6b8(0x259)]&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x397861,this['getOptions'](),this[_0x21a6b8(0x236)]),this['addPrimitives']();}['_setOptionsHook'](_0x4924d0,_0x389f68){const _0x154c1f=_0x1a1f03;if(_0x4924d0)for(const _0x4734ba in _0x4924d0){this[_0x4734ba]=_0x4924d0[_0x4734ba];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x154c1f(0x23f)]());}['getOptions'](){const _0x2634fb=_0x1a1f03,_0xab2fd=Math['ceil'](Math[_0x2634fb(0x274)](this['particlesNumber']));return this['particlesNumber']=_0xab2fd*_0xab2fd,{'particlesTextureSize':_0xab2fd,'maxParticles':this[_0x2634fb(0x292)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x13c951=_0x1a1f03;this[_0x13c951(0x1f0)]['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives'][_0x13c951(0x22a)](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this['primitives'][_0x13c951(0x22a)](this['particleSystem']['particlesComputing']['primitives']['updatePosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem'][_0x13c951(0x280)][_0x13c951(0x1f0)]['segments']),this[_0x13c951(0x1f0)][_0x13c951(0x22a)](this[_0x13c951(0x259)]['particlesRendering'][_0x13c951(0x1f0)]['trails']),this[_0x13c951(0x1f0)]['add'](this['particleSystem']['particlesRendering']['primitives'][_0x13c951(0x2bc)]);}[_0x1a1f03(0x246)](){const _0x9dec28=_0x1a1f03;let _0xf294d0=this['camera']['computeViewRectangle'](this[_0x9dec28(0x296)]['globe'][_0x9dec28(0x21a)]);if(!_0xf294d0){const _0x3cf718=this['_map']['getExtent']();_0xf294d0=Cesium$1['Rectangle'][_0x9dec28(0x287)](_0x3cf718['xmin'],_0x3cf718[_0x9dec28(0x249)],_0x3cf718['xmax'],_0x3cf718['ymax']);}const _0x23b659=Util['viewRectangleToLonLatRange'](_0xf294d0);this[_0x9dec28(0x236)]['lonRange']['x']=_0x23b659[_0x9dec28(0x221)][_0x9dec28(0x238)],this['viewerParameters']['lonRange']['y']=_0x23b659['lon'][_0x9dec28(0x2bf)],this[_0x9dec28(0x236)]['latRange']['x']=_0x23b659[_0x9dec28(0x22b)][_0x9dec28(0x238)],this['viewerParameters']['latRange']['y']=_0x23b659['lat']['max'];const _0x1b9269=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene'][_0x9dec28(0x1e7)],this[_0x9dec28(0x296)][_0x9dec28(0x28a)]);_0x1b9269>0x0&&(this['viewerParameters']['pixelSize']=_0x1b9269);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace[_0x1a1f03(0x2a1)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x14df0a=_0x1a1f03;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x14df0a(0x265)]=null,this['age']=null;}['destroy'](){for(const _0x22163a in this){delete this[_0x22163a];}}}class CanvasWindField{constructor(_0x432178){this['setOptions'](_0x432178);}get['speedRate'](){const _0x460ec0=_0x1a1f03;return this[_0x460ec0(0x25d)];}set['speedRate'](_0x40926f){const _0x4f0251=_0x1a1f03;this['_speedRate']=(0x64-(_0x40926f>0x63?0x63:_0x40926f))*0x64,this[_0x4f0251(0x1ef)]=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get[_0x1a1f03(0x26c)](){return this['_maxAge'];}set['maxAge'](_0x1e8a4a){this['_maxAge']=_0x1e8a4a;}['setOptions'](_0x344860){const _0x1c7a74=_0x1a1f03;this['options']=_0x344860,this['maxAge']=_0x344860['maxAge']||0x78,this['speedRate']=_0x344860[_0x1c7a74(0x23e)]||0x32,this[_0x1c7a74(0x252)]=[];const _0x3d3b8e=_0x344860['particlesNumber']||0x1000;for(let _0x2baf6f=0x0;_0x2baf6f<_0x3d3b8e;_0x2baf6f++){const _0x250b2e=this['_randomParticle'](new CanvasParticle());this['particles'][_0x1c7a74(0x1f9)](_0x250b2e);}}['setDate'](_0x467093){const _0x470635=_0x1a1f03;this['rows']=_0x467093[_0x470635(0x25f)],this['cols']=_0x467093['cols'],this[_0x470635(0x29f)]=_0x467093['xmin'],this['xmax']=_0x467093[_0x470635(0x230)],this['ymin']=_0x467093[_0x470635(0x249)],this['ymax']=_0x467093[_0x470635(0x21e)],this['grid']=[];const _0x41aab5=_0x467093[_0x470635(0x20a)],_0x55a197=_0x467093['vdata'];let _0x1aa22a=![];_0x41aab5['length']===this['rows']&&_0x41aab5[0x0]['length']===this[_0x470635(0x21c)]&&(_0x1aa22a=!![]);let _0x51bb39=0x0,_0x288109=null,_0x3ed4eb=null;for(let _0x5d7fcd=0x0;_0x5d7fcd<this['rows'];_0x5d7fcd++){_0x288109=[];for(let _0x3970d1=0x0;_0x3970d1<this['cols'];_0x3970d1++,_0x51bb39++){_0x1aa22a?_0x3ed4eb=this['_calcUV'](_0x41aab5[_0x5d7fcd][_0x3970d1],_0x55a197[_0x5d7fcd][_0x3970d1]):_0x3ed4eb=this['_calcUV'](_0x41aab5[_0x51bb39],_0x55a197[_0x51bb39]),_0x288109['push'](_0x3ed4eb);}this['grid'][_0x470635(0x1f9)](_0x288109);}this['options']['reverseY']&&this[_0x470635(0x20f)]['reverse']();}['clear'](){const _0x2d0fc1=_0x1a1f03;delete this['rows'],delete this['cols'],delete this['xmin'],delete this[_0x2d0fc1(0x230)],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0x2d0fc1(0x252)];}[_0x1a1f03(0x209)](_0x4fe4cb,_0x19175c){const _0x3bd5fa=_0x1a1f03,_0x1dd232=(_0x4fe4cb-this[_0x3bd5fa(0x29f)])/(this[_0x3bd5fa(0x230)]-this['xmin'])*(this[_0x3bd5fa(0x21c)]-0x1),_0x10a42e=(this['ymax']-_0x19175c)/(this['ymax']-this[_0x3bd5fa(0x249)])*(this['rows']-0x1);return[_0x1dd232,_0x10a42e];}['getUVByXY'](_0x419ef2,_0x184cbe){const _0x12d4ab=_0x1a1f03;if(_0x419ef2<0x0||_0x419ef2>=this[_0x12d4ab(0x21c)]||_0x184cbe>=this['rows'])return[0x0,0x0,0x0];const _0x564778=Math[_0x12d4ab(0x1e5)](_0x419ef2),_0x3c4c73=Math['floor'](_0x184cbe);if(_0x564778===_0x419ef2&&_0x3c4c73===_0x184cbe)return this['grid'][_0x184cbe][_0x419ef2];const _0x122fc0=_0x564778+0x1,_0x5e083d=_0x3c4c73+0x1,_0x14e2a6=this['getUVByXY'](_0x564778,_0x3c4c73),_0x306cc1=this['getUVByXY'](_0x122fc0,_0x3c4c73),_0x595f97=this['getUVByXY'](_0x564778,_0x5e083d),_0x1f5b51=this['getUVByXY'](_0x122fc0,_0x5e083d);let _0x21c3f3=null;try{_0x21c3f3=this[_0x12d4ab(0x28e)](_0x419ef2-_0x564778,_0x184cbe-_0x3c4c73,_0x14e2a6,_0x306cc1,_0x595f97,_0x1f5b51);}catch(_0x967530){console['log'](_0x419ef2,_0x184cbe);}return _0x21c3f3;}[_0x1a1f03(0x28e)](_0x51e517,_0x3dbbaf,_0x98af2e,_0x29af13,_0x1d6dd8,_0x532eb1){const _0x3f647c=0x1-_0x51e517,_0x11cf7c=0x1-_0x3dbbaf,_0x484761=_0x3f647c*_0x11cf7c,_0x4d8520=_0x51e517*_0x11cf7c,_0x5d3e8e=_0x3f647c*_0x3dbbaf,_0x338f73=_0x51e517*_0x3dbbaf,_0x4589ff=_0x98af2e[0x0]*_0x484761+_0x29af13[0x0]*_0x4d8520+_0x1d6dd8[0x0]*_0x5d3e8e+_0x532eb1[0x0]*_0x338f73,_0x11784d=_0x98af2e[0x1]*_0x484761+_0x29af13[0x1]*_0x4d8520+_0x1d6dd8[0x1]*_0x5d3e8e+_0x532eb1[0x1]*_0x338f73;return this['_calcUV'](_0x4589ff,_0x11784d);}[_0x1a1f03(0x205)](_0x4363a9,_0x2f90dd){return[+_0x4363a9,+_0x2f90dd,Math['sqrt'](_0x4363a9*_0x4363a9+_0x2f90dd*_0x2f90dd)];}['getUVByPoint'](_0x201b7a,_0x5dbfb4){const _0x1ccfec=_0x1a1f03;if(!this['isInExtent'](_0x201b7a,_0x5dbfb4))return null;const _0x4f41f6=this[_0x1ccfec(0x209)](_0x201b7a,_0x5dbfb4),_0x36bc23=this[_0x1ccfec(0x1e4)](_0x4f41f6[0x0],_0x4f41f6[0x1]);return _0x36bc23;}[_0x1a1f03(0x28f)](_0x3bce9c,_0x26c5cc){return _0x3bce9c>=this['xmin']&&_0x3bce9c<=this['xmax']&&_0x26c5cc>=this['ymin']&&_0x26c5cc<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x409fe2=_0x1a1f03,_0xf9dced=fRandomByfloat(this[_0x409fe2(0x29f)],this['xmax']),_0x11b348=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x11b348,'lng':_0xf9dced};}['getParticles'](){const _0x85cbb3=_0x1a1f03;let _0x332d7a,_0x523b86,_0x167dae;for(let _0x3c7dde=0x0,_0x504360=this['particles']['length'];_0x3c7dde<_0x504360;_0x3c7dde++){let _0x5eb595=this['particles'][_0x3c7dde];_0x5eb595['age']<=0x0&&(_0x5eb595=this[_0x85cbb3(0x294)](_0x5eb595));if(_0x5eb595['age']>0x0){const _0x2e5ebe=_0x5eb595['tlng'],_0x135843=_0x5eb595['tlat'];_0x167dae=this['getUVByPoint'](_0x2e5ebe,_0x135843),_0x167dae?(_0x332d7a=_0x2e5ebe+this['_calc_speedRate'][0x0]*_0x167dae[0x0],_0x523b86=_0x135843+this[_0x85cbb3(0x1ef)][0x1]*_0x167dae[0x1],_0x5eb595[_0x85cbb3(0x21b)]=_0x2e5ebe,_0x5eb595['lat']=_0x135843,_0x5eb595['tlng']=_0x332d7a,_0x5eb595['tlat']=_0x523b86,_0x5eb595['age']--):_0x5eb595['age']=0x0;}}return this[_0x85cbb3(0x252)];}['_randomParticle'](_0x3d87c1){const _0x44c926=_0x1a1f03;let _0x4cb193,_0x52a3d6;for(let _0x30302f=0x0;_0x30302f<0x1e;_0x30302f++){_0x4cb193=this['getRandomLatLng'](),_0x52a3d6=this[_0x44c926(0x1fb)](_0x4cb193['lng'],_0x4cb193[_0x44c926(0x22b)]);if(_0x52a3d6&&_0x52a3d6[0x2]>0x0)break;}if(!_0x52a3d6)return _0x3d87c1;const _0x276bd1=_0x4cb193['lng']+this['_calc_speedRate'][0x0]*_0x52a3d6[0x0],_0x2d9fcd=_0x4cb193[_0x44c926(0x22b)]+this['_calc_speedRate'][0x1]*_0x52a3d6[0x1];return _0x3d87c1[_0x44c926(0x21b)]=_0x4cb193['lng'],_0x3d87c1[_0x44c926(0x22b)]=_0x4cb193['lat'],_0x3d87c1[_0x44c926(0x28d)]=_0x276bd1,_0x3d87c1['tlat']=_0x2d9fcd,_0x3d87c1['age']=Math[_0x44c926(0x1ec)](Math['random']()*this['maxAge']),_0x3d87c1;}['destroy'](){for(const _0x23b93e in this){delete this[_0x23b93e];}}}function fRandomByfloat(_0x3f0749,_0x451a59){return _0x3f0749+Math['random']()*(_0x451a59-_0x3f0749);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x1a1f03(0x2a1)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x389e98={}){const _0xed98b0=_0x1a1f03;super(_0x389e98),this[_0xed98b0(0x220)](_0x389e98),this['canvas']=null;}['_setOptionsHook'](_0x1812a5,_0x420263){const _0x34e188=_0x1a1f03;this['frameTime']=0x3e8/(_0x1812a5['frameRate']||0xa),this['_pointerEvents']=this['options'][_0x34e188(0x234)]??![],this['color']=_0x1812a5[_0x34e188(0x273)]||_0x34e188(0x207),this['lineWidth']=_0x1812a5['lineWidth']||0x1,this['fixedHeight']=_0x1812a5['fixedHeight']??0x0,this['reverseY']=_0x1812a5['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x1812a5);}get['layer'](){const _0x27d6a7=_0x1a1f03;return this[_0x27d6a7(0x219)];}get['canvasWidth'](){const _0x5efba9=_0x1a1f03;return this['_map'][_0x5efba9(0x296)][_0x5efba9(0x219)]['clientWidth'];}get['canvasHeight'](){const _0x4d5fce=_0x1a1f03;return this[_0x4d5fce(0x268)]['scene'][_0x4d5fce(0x219)]['clientHeight'];}get['pointerEvents'](){const _0xed569=_0x1a1f03;return this[_0xed569(0x2ad)];}set['pointerEvents'](_0xd87fc6){const _0xb5fac5=_0x1a1f03;this['_pointerEvents']=_0xd87fc6;if(!this['canvas'])return;_0xd87fc6?this['canvas']['style']['pointer-events']='all':this[_0xb5fac5(0x219)]['style'][_0xb5fac5(0x232)]='none';}get['particlesNumber'](){const _0x20c992=_0x1a1f03;return this['options'][_0x20c992(0x292)];}set['particlesNumber'](_0x46f403){const _0x4be1b7=_0x1a1f03;this['options']['particlesNumber']=_0x46f403,clearTimeout(this['_canrefresh']),this[_0x4be1b7(0x2ba)]=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set[_0x1a1f03(0x23e)](_0x429db3){const _0x5afda9=_0x1a1f03;this[_0x5afda9(0x231)]['speedRate']=_0x429db3,this[_0x5afda9(0x24f)]&&(this[_0x5afda9(0x24f)][_0x5afda9(0x23e)]=_0x429db3);}get[_0x1a1f03(0x26c)](){const _0x3b47df=_0x1a1f03;return this[_0x3b47df(0x231)][_0x3b47df(0x26c)];}set['maxAge'](_0x4e461c){const _0x59031c=_0x1a1f03;this[_0x59031c(0x231)][_0x59031c(0x26c)]=_0x4e461c,this[_0x59031c(0x24f)]&&(this[_0x59031c(0x24f)]['maxAge']=_0x4e461c);}get['data'](){return this['windData'];}set['data'](_0xa180e9){this['setData'](_0xa180e9);}[_0x1a1f03(0x262)](_0x3c1173){const _0x2501ae=_0x1a1f03;_0x3c1173?this[_0x2501ae(0x21d)]():(this['windData']&&(this['options'][_0x2501ae(0x281)]=this['windData']),this['_removedHook']());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x2a5716=_0x1a1f03;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas'][_0x2a5716(0x24a)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x2a5716(0x1f6)](this[_0x2a5716(0x231)]['data']);}['_removedHook'](){const _0x1df9a3=_0x1a1f03;this['clear'](),this[_0x1df9a3(0x201)](),this[_0x1df9a3(0x219)]&&(this['_map']['container'][_0x1df9a3(0x27b)](this['canvas']),delete this['canvas']);}[_0x1a1f03(0x2c1)](){const _0x5a295e=_0x1a1f03,_0x23e55a=mars3d__namespace['DomUtil']['create'](_0x5a295e(0x219),_0x5a295e(0x286),this['_map']['container']);return _0x23e55a[_0x5a295e(0x22e)]['position']='absolute',_0x23e55a['style']['top']='0px',_0x23e55a['style']['left']='0px',_0x23e55a[_0x5a295e(0x22e)]['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x23e55a['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x23e55a['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x23e55a['style'][_0x5a295e(0x24e)]=this['options']['zIndex']??0x9,_0x23e55a['width']=this['_map'][_0x5a295e(0x296)]['canvas'][_0x5a295e(0x260)],_0x23e55a['height']=this['_map'][_0x5a295e(0x296)]['canvas'][_0x5a295e(0x2b6)],_0x23e55a;}['resize'](){const _0x2de11c=_0x1a1f03;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas'][_0x2de11c(0x22e)]['height']=this['_map']['scene']['canvas'][_0x2de11c(0x2b6)]+'px',this['canvas']['width']=this['_map'][_0x2de11c(0x296)]['canvas']['clientWidth'],this['canvas']['height']=this['_map']['scene'][_0x2de11c(0x219)]['clientHeight']);}[_0x1a1f03(0x2a3)](){const _0x1eaa10=_0x1a1f03,_0x35ce67=this;let _0x1a6d2f=Date['now']();(function _0x7aaf69(){const _0x2b7cf3=_0x5c87;_0x35ce67['animateFrame']=window['requestAnimationFrame'](_0x7aaf69);if(_0x35ce67[_0x2b7cf3(0x235)]&&_0x35ce67['windField']){const _0x2e905a=Date['now'](),_0x2db17b=_0x2e905a-_0x1a6d2f;_0x2db17b>_0x35ce67['frameTime']&&(_0x1a6d2f=_0x2e905a-_0x2db17b%_0x35ce67['frameTime'],_0x35ce67['update']());}}(),window['addEventListener'](_0x1eaa10(0x243),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this[_0x1eaa10(0x268)]['on'](mars3d__namespace['EventType']['wheel'],this[_0x1eaa10(0x264)],this),this[_0x1eaa10(0x268)]['on'](mars3d__namespace[_0x1eaa10(0x28b)]['mouseDown'],this[_0x1eaa10(0x227)],this),this[_0x1eaa10(0x268)]['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x1eaa10(0x20e)],this)));}['unbindEvent'](){const _0x41b07b=_0x1a1f03;window[_0x41b07b(0x1e3)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener'](_0x41b07b(0x243),this['resize']),this['options'][_0x41b07b(0x20b)]&&(this['_map']['off'](mars3d__namespace[_0x41b07b(0x28b)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x41b07b(0x227)],this),this[_0x41b07b(0x268)][_0x41b07b(0x202)](mars3d__namespace['EventType']['mouseUp'],this[_0x41b07b(0x20e)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x41b07b(0x2b8)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x1c1f95){const _0x36733e=_0x1a1f03;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x36733e(0x219)])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0x1a1f03(0x227)](_0x5d0d1f){const _0x17ca1f=_0x1a1f03;this[_0x17ca1f(0x285)]=!![],this[_0x17ca1f(0x268)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x1a1f03(0x2a4)](_0xd376d9){const _0x5c32d9=_0x1a1f03;if(!this[_0x5c32d9(0x235)]||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style'][_0x5c32d9(0x284)]='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x1cc6aa){const _0xb8d0e9=_0x1a1f03;if(!this[_0xb8d0e9(0x235)]||!this[_0xb8d0e9(0x219)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0xb8d0e9(0x24d)]&&this[_0xb8d0e9(0x211)](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0xcb12cd){const _0x8f85bf=_0x1a1f03;this[_0x8f85bf(0x276)](),this['windData']=_0xcb12cd,this['windField'][_0x8f85bf(0x277)](_0xcb12cd),this[_0x8f85bf(0x211)]();}['redraw'](){const _0x5e5626=_0x1a1f03;if(!this['show'])return;this[_0x5e5626(0x24f)]['setOptions'](this[_0x5e5626(0x231)]),this[_0x5e5626(0x1e9)]();}['update'](){const _0x3017e4=_0x1a1f03;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this[_0x3017e4(0x24f)]['update']();else{const _0x3c457e=this['windField']['getParticles']();this[_0x3017e4(0x1f8)](_0x3c457e);}this['_updateIng']=![];}['_drawLines'](_0x422150){const _0x7a652b=_0x1a1f03;this['canvasContext']['globalCompositeOperation']=_0x7a652b(0x293),this['canvasContext']['fillRect'](0x0,0x0,this[_0x7a652b(0x23c)],this['canvasHeight']),this[_0x7a652b(0x1fd)][_0x7a652b(0x28c)]='lighter',this['canvasContext']['globalAlpha']=0.9,this['canvasContext'][_0x7a652b(0x215)](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['color'];const _0x7cdde5=this['_map']['scene'][_0x7a652b(0x291)]!==Cesium['SceneMode']['SCENE3D'],_0x189f67=this['canvasWidth']*0.25;for(let _0x3371aa=0x0,_0x1fab7e=_0x422150['length'];_0x3371aa<_0x1fab7e;_0x3371aa++){const _0x501963=_0x422150[_0x3371aa],_0x5bddb3=this[_0x7a652b(0x20d)](_0x501963['lng'],_0x501963['lat'],_0x501963),_0x32b906=this['_tomap'](_0x501963['tlng'],_0x501963['tlat'],_0x501963);if(!_0x5bddb3||!_0x32b906)continue;if(_0x7cdde5&&Math['abs'](_0x5bddb3[0x0]-_0x32b906[0x0])>=_0x189f67)continue;this[_0x7a652b(0x1fd)]['moveTo'](_0x5bddb3[0x0],_0x5bddb3[0x1]),this['canvasContext']['lineTo'](_0x32b906[0x0],_0x32b906[0x1]);}this['canvasContext']['stroke']();}['_tomap'](_0x370fd2,_0x10cf12,_0x12bdfe){const _0x5a2f9b=_0x1a1f03,_0x101fb6=Cesium[_0x5a2f9b(0x1f5)]['fromDegrees'](_0x370fd2,_0x10cf12,this['fixedHeight']),_0x3ace3e=this['_map']['scene'];if(_0x3ace3e['mode']===Cesium['SceneMode']['SCENE3D']){const _0x96d801=new Cesium['EllipsoidalOccluder'](_0x3ace3e['globe']['ellipsoid'],_0x3ace3e[_0x5a2f9b(0x26e)][_0x5a2f9b(0x27f)]),_0x4f0012=_0x96d801['isPointVisible'](_0x101fb6);if(!_0x4f0012)return _0x12bdfe[_0x5a2f9b(0x247)]=0x0,null;}const _0x5e14a4=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x101fb6);return _0x5e14a4?[_0x5e14a4['x'],_0x5e14a4['y']]:null;}['clear'](){const _0x481bac=_0x1a1f03;this[_0x481bac(0x24f)]['clear'](),delete this['windData'];}['initWorker'](){const _0xa10812=_0x1a1f03;this[_0xa10812(0x23b)]=new Worker(this[_0xa10812(0x231)]['worker']),this['worker'][_0xa10812(0x2b3)]=_0x4aac5f=>{const _0x231ee7=_0xa10812;this[_0x231ee7(0x1f8)](_0x4aac5f['data']['particles']),this['_updateIng2']=![];},this[_0xa10812(0x24f)]={'init':_0x75652a=>{const _0x54c98e=_0xa10812;this[_0x54c98e(0x23b)]['postMessage']({'type':'init','options':_0x75652a});},'setOptions':_0x3e846c=>{const _0xcc8583=_0xa10812;this[_0xcc8583(0x23b)]['postMessage']({'type':_0xcc8583(0x2aa),'options':_0x3e846c});},'setDate':_0x18e003=>{const _0x17e4c7=_0xa10812;this[_0x17e4c7(0x23b)]['postMessage']({'type':_0x17e4c7(0x277),'data':_0x18e003});},'update':()=>{if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x2fe71f=_0xa10812;this['worker']['postMessage']({'type':_0x2fe71f(0x276)});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x1a1f03(0x2b2)]['register'](_0x1a1f03(0x1f3),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports[_0x1a1f03(0x223)]=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x1a1f03(0x216),{'value':!![]});
}));
