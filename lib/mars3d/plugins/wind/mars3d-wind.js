/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.13
 * 编译日期：2023-06-26 22:27:02
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x1e071f=_0x4105;function _0x4b7b(){const _0x22156f=['isInExtent','mouse_down','pointer-events','clearCommand','primitives','RGBA','VertexArray','red','framebuffer','height','_onMapWhellEvent','maxParticles','bindEvent','EventType','_calcUV','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','lon','particlesTextures','mouseMove','_map','addPrimitives','createRawRenderState','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','attributeLocations','drawingBufferWidth','particleSystem','speedRate','grid','random','getDefaultRenderState','_pointerEvents','Cartesian2','nextParticlesSpeed','globalAlpha','particlesNumber','SCENE3D','textures','frameTime','ellipsoid','options','_updateIng2','fragmentShaderSource','mouse_move','createTexture','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','min','now','ShaderProgram','register','globeBoundingSphere','depthTest','_randomParticle','context','west','LayerUtil','clientWidth','east','ClearCommand','ymin','keys','layer','lonRange','18sQymoO','geometry','postProcessingSpeed','drawingBufferHeight','camera','mode','createSegmentsGeometry','vertexShaderSource','Sampler','default','clientHeight','_data','BufferUsage','canvasHeight','Cartesian3','forEach','refreshParticles','zIndex','currentTrailsDepth','visibility','_removedHook','TRIANGLES','mouseDown','worker','setData','TWO_PI','positionWC','mouseUp','UNSIGNED_BYTE','toDegrees','Math','depthMask','push','DISABLE_GL_POSITION_LOG_DEPTH','vertexArray','4088THJFTG','_bilinearInterpolation','colors','Rectangle','LINEAR','canvasWidth','createFramebuffer','currentParticlesPosition','umin','destroyParticlesTextures','1420CBKxur','tlng','udata','currentParticlesSpeed','3328808fsvZdM','getExtent','clear','getWind','defined','3990393FYksWj','visible','createComputingPrimitives','dimensions','levmax','lng','_onMouseUpEvent','bind','pointerEvents','wheel','ShaderSource','GeometryAttribute','103866sPpYyD','SceneMode','scene','ymax','destroy','Cesium','createCommand','absolute','updateViewerParameters','pow','commandToExecute','particles','lev','removeChild','container','framebuffers','lat','style','2393412icvxcR','windTextures','DrawCommand','setOptions','commandType','getUVByXY','resize','destination-in','segments','shaderProgram','defineProperty','getOptions','PixelFormat','currentTrails','maxAge','outputTexture','particlesTextureSize','BaseLayer','south','_onMouseDownEvent','max','_drawLines','execute','fromCache','preExecute','rows','setDate','_onMouseMoveEvent','tlat','canvasResize','show','canvasContext','trails','PI_OVER_TWO','age','toRadians','Pass','create','fillRect','clearFramebuffers','xmin','PixelDatatype','particlesRendering','primitiveType','particlesComputing','blending','getParticles','NEAREST','Color','xmax','levmin','CanvasWindField','lineWidth','width','segmentsDepth','add','canvas','CanvasWindLayer','Draw','off','windField','green','createRenderingTextures','EllipsoidalOccluder','color','postMessage','ComputeCommand','vdata','423090cydNJT','21711seUdmc','Compute','mouseHidden','frameRate','_tomap','FLOAT','vmin','wind','redraw','update','GeometryAttributes','getUVByPoint','refreshTimer','_addedHook','viewerParameters','position','cols','data','nextParticlesPosition','_createCanvas'];_0x4b7b=function(){return _0x22156f;};return _0x4b7b();}(function(_0x42c596,_0x12ebf3){const _0x3b3981=_0x4105,_0x27ef9f=_0x42c596();while(!![]){try{const _0x537e03=parseInt(_0x3b3981(0xd8))/0x1+parseInt(_0x3b3981(0x12b))/0x2*(-parseInt(_0x3b3981(0xd9))/0x3)+-parseInt(_0x3b3981(0x14e))/0x4*(-parseInt(_0x3b3981(0x158))/0x5)+-parseInt(_0x3b3981(0x17f))/0x6+parseInt(_0x3b3981(0x16d))/0x7+parseInt(_0x3b3981(0x15c))/0x8+-parseInt(_0x3b3981(0x161))/0x9;if(_0x537e03===_0x12ebf3)break;else _0x27ef9f['push'](_0x27ef9f['shift']());}catch(_0x15947c){_0x27ef9f['push'](_0x27ef9f['shift']());}}}(_0x4b7b,0x39d41));function _interopNamespace(_0x27ab8d){const _0x5030f4=_0x4105;if(_0x27ab8d&&_0x27ab8d['__esModule'])return _0x27ab8d;var _0x253df6=Object[_0x5030f4(0x1a4)](null);return _0x27ab8d&&Object['keys'](_0x27ab8d)[_0x5030f4(0x13a)](function(_0x513dda){const _0x504cd1=_0x5030f4;if(_0x513dda!==_0x504cd1(0x134)){var _0x3cca60=Object['getOwnPropertyDescriptor'](_0x27ab8d,_0x513dda);Object['defineProperty'](_0x253df6,_0x513dda,_0x3cca60['get']?_0x3cca60:{'enumerable':!![],'get':function(){return _0x27ab8d[_0x513dda];}});}}),_0x253df6[_0x5030f4(0x134)]=_0x27ab8d,_0x253df6;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x1e071f(0x172)];function getU(_0xfa9a4f,_0x3f6db4){const _0x3c6733=_0x1e071f,_0x39bb8e=_0xfa9a4f*Math['cos'](Cesium$7[_0x3c6733(0x149)][_0x3c6733(0x1a2)](_0x3f6db4));return _0x39bb8e;}function getV(_0x8cdaa,_0x11cc47){const _0x2cfa2d=_0x8cdaa*Math['sin'](Cesium$7['Math']['toRadians'](_0x11cc47));return _0x2cfa2d;}function getSpeed(_0x194703,_0x499ce0){const _0x120436=_0x1e071f,_0x4261bc=Math['sqrt'](Math['pow'](_0x194703,0x2)+Math[_0x120436(0x176)](_0x499ce0,0x2));return _0x4261bc;}function getDirection(_0x5c71a2,_0x4f5823){let _0x1bcb51=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x4f5823,_0x5c71a2));return _0x1bcb51+=_0x1bcb51<0x0?0x168:0x0,_0x1bcb51;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x1e071f(0x172)];class CustomPrimitive{constructor(_0x342614){const _0x1fc62b=_0x1e071f;this[_0x1fc62b(0x183)]=_0x342614['commandType'],this[_0x1fc62b(0x12c)]=_0x342614[_0x1fc62b(0x12c)],this[_0x1fc62b(0x104)]=_0x342614['attributeLocations'],this['primitiveType']=_0x342614['primitiveType'],this['uniformMap']=_0x342614['uniformMap'],this[_0x1fc62b(0x132)]=_0x342614['vertexShaderSource'],this[_0x1fc62b(0x116)]=_0x342614['fragmentShaderSource'],this['rawRenderState']=_0x342614['rawRenderState'],this['framebuffer']=_0x342614[_0x1fc62b(0xf5)],this['outputTexture']=_0x342614['outputTexture'],this['autoClear']=_0x342614['autoClear']??![],this['preExecute']=_0x342614[_0x1fc62b(0x197)],this[_0x1fc62b(0x19d)]=!![],this['commandToExecute']=undefined,this[_0x1fc62b(0xf0)]=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6[(_0x1fc62b(0x126))]({'color':new Cesium$6[(_0x1fc62b(0x1af))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x1fc62b(0x1a3)]['OPAQUE']}));}[_0x1e071f(0x173)](_0x28e829){const _0x36fa3c=_0x1e071f;switch(this['commandType']){case'Draw':{const _0x2f13f8=Cesium$6[_0x36fa3c(0xf3)]['fromGeometry']({'context':_0x28e829,'geometry':this[_0x36fa3c(0x12c)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x36fa3c(0x137)]['STATIC_DRAW']}),_0x1adc28=Cesium$6[_0x36fa3c(0x11c)][_0x36fa3c(0x196)]({'context':_0x28e829,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x36fa3c(0x132)],'fragmentShaderSource':this[_0x36fa3c(0x116)]}),_0x2f77e6=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6[(_0x36fa3c(0x181))]({'primitiveType':this[_0x36fa3c(0x1aa)],'shaderProgram':_0x1adc28,'vertexArray':_0x2f13f8,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x2f77e6,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x36fa3c(0xf5)],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x36fa3c(0x1c1))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x31925c,_0x2531d3){const _0x5c0ddb=_0x1e071f;this['geometry']=_0x2531d3;const _0xe3f490=Cesium$6['VertexArray']['fromGeometry']({'context':_0x31925c,'geometry':this[_0x5c0ddb(0x12c)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x5c0ddb(0x137)]['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0xe3f490;}['update'](_0x32058e){const _0x4a6c47=_0x1e071f;if(!this['show'])return;if(_0x32058e['mode']!==Cesium$6[_0x4a6c47(0x16e)]['SCENE3D'])return;!Cesium$6[_0x4a6c47(0x160)](this['commandToExecute'])&&(this['commandToExecute']=this[_0x4a6c47(0x173)](_0x32058e[_0x4a6c47(0x121)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0x4a6c47(0x160)](this['clearCommand'])&&_0x32058e['commandList']['push'](this['clearCommand']),_0x32058e['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x2c83ff=_0x1e071f;if(this[_0x2c83ff(0xf0)]){var _0x4f1a50,_0x3c3ca1;(_0x4f1a50=this['clearCommand'])!==null&&_0x4f1a50!==void 0x0&&_0x4f1a50['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x3c3ca1=this['clearCommand'])!==null&&_0x3c3ca1!==void 0x0&&_0x3c3ca1['shaderProgram']&&this['clearCommand'][_0x2c83ff(0x188)]['destroy'](),delete this['clearCommand'];}return this[_0x2c83ff(0x177)]&&(this[_0x2c83ff(0x177)]['vertexArray']&&this[_0x2c83ff(0x177)]['vertexArray']['destroy'](),this[_0x2c83ff(0x177)][_0x2c83ff(0x188)]&&this[_0x2c83ff(0x177)]['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x5915b4=function(){const _0xd2aa7d=_0x4105,_0x431868=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0xd2aa7d(0xe3))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x431868;},_0x18fcf2=function(_0x4c3a8f,_0x412553){if(Cesium$5['defined'](_0x412553)){const _0x2e7510={};_0x2e7510['arrayBufferView']=_0x412553,_0x4c3a8f['source']=_0x2e7510;}const _0x364202=new Cesium$5['Texture'](_0x4c3a8f);return _0x364202;},_0x2dcd29=function(_0xd20126,_0x352188,_0x1acd7e){const _0x5cedca=new Cesium$5['Framebuffer']({'context':_0xd20126,'colorTextures':[_0x352188],'depthTexture':_0x1acd7e});return _0x5cedca;},_0x11fd39=function(_0x36687f){const _0x28f33e=_0x4105,_0x3110a3=!![],_0x204992=![],_0x1d10d2={'viewport':_0x36687f['viewport'],'depthTest':_0x36687f[_0x28f33e(0x11f)],'depthMask':_0x36687f[_0x28f33e(0x14a)],'blending':_0x36687f[_0x28f33e(0x1ac)]},_0x595748=Cesium$5['Appearance'][_0x28f33e(0x10a)](_0x3110a3,_0x204992,_0x1d10d2);return _0x595748;},_0x2a420d=function(_0x563a96){const _0x286a1e=_0x4105,_0x50e9d1={},_0x2bbbfe=Cesium$5[_0x286a1e(0x149)]['mod'](_0x563a96[_0x286a1e(0x122)],Cesium$5[_0x286a1e(0x149)]['TWO_PI']),_0x324eec=Cesium$5['Math']['mod'](_0x563a96[_0x286a1e(0x125)],Cesium$5['Math']['TWO_PI']),_0x1130cc=_0x563a96[_0x286a1e(0x1b4)];let _0x5a162d,_0x2c0544;_0x1130cc>Cesium$5[_0x286a1e(0x149)]['THREE_PI_OVER_TWO']?(_0x5a162d=0x0,_0x2c0544=Cesium$5[_0x286a1e(0x149)][_0x286a1e(0x144)]):_0x324eec-_0x2bbbfe<_0x1130cc?(_0x5a162d=_0x2bbbfe,_0x2c0544=_0x2bbbfe+_0x1130cc):(_0x5a162d=_0x2bbbfe,_0x2c0544=_0x324eec);_0x50e9d1[_0x286a1e(0xfd)]={'min':Cesium$5['Math']['toDegrees'](_0x5a162d),'max':Cesium$5['Math']['toDegrees'](_0x2c0544)};const _0xb69c33=_0x563a96[_0x286a1e(0x191)],_0x107298=_0x563a96['north'],_0x57a774=_0x563a96['height'],_0x220e79=_0x57a774>Cesium$5['Math']['PI']/0xc?_0x57a774/0x2:0x0;let _0x51ac51=Cesium$5['Math']['clampToLatitudeRange'](_0xb69c33-_0x220e79),_0x34685d=Cesium$5[_0x286a1e(0x149)]['clampToLatitudeRange'](_0x107298+_0x220e79);return _0x51ac51<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x51ac51=-Cesium$5['Math']['PI_OVER_TWO']),_0x34685d>Cesium$5[_0x286a1e(0x149)]['PI_OVER_THREE']&&(_0x34685d=Cesium$5[_0x286a1e(0x149)][_0x286a1e(0x1a0)]),_0x50e9d1['lat']={'min':Cesium$5[_0x286a1e(0x149)][_0x286a1e(0x148)](_0x51ac51),'max':Cesium$5[_0x286a1e(0x149)]['toDegrees'](_0x34685d)},_0x50e9d1;};return{'getFullscreenQuad':_0x5915b4,'createTexture':_0x18fcf2,'createFramebuffer':_0x2dcd29,'createRawRenderState':_0x11fd39,'viewRectangleToLonLatRange':_0x2a420d};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x1e071f(0x103),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x1e071f(0x172)];class ParticlesRendering{constructor(_0x5c554d,_0x52e947,_0x29dcbe,_0x2cd6cd,_0x3b2548){const _0x5614d2=_0x1e071f;this[_0x5614d2(0x1bd)](_0x5c554d,_0x52e947,_0x29dcbe['colors']),this['createRenderingFramebuffers'](_0x5c554d),this['createRenderingPrimitives'](_0x5c554d,_0x29dcbe,_0x2cd6cd,_0x3b2548);}['createRenderingTextures'](_0xe11cca,_0x890938,_0x514277){const _0x46c57c=_0x1e071f,_0x27b691={'context':_0xe11cca,'width':_0xe11cca[_0x46c57c(0x105)],'height':_0xe11cca['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x46c57c(0xf2)],'pixelDatatype':Cesium$4[_0x46c57c(0x1a8)][_0x46c57c(0x147)]},_0x314190={'context':_0xe11cca,'width':_0xe11cca['drawingBufferWidth'],'height':_0xe11cca[_0x46c57c(0x12e)],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x17cf5d=_0x514277['length'],_0x56e822=new Float32Array(_0x17cf5d*0x3);for(let _0x5f5740=0x0;_0x5f5740<_0x17cf5d;_0x5f5740++){const _0x296dc9=Cesium$4['Color']['fromCssColorString'](_0x514277[_0x5f5740]);_0x56e822[0x3*_0x5f5740]=_0x296dc9[_0x46c57c(0xf4)],_0x56e822[0x3*_0x5f5740+0x1]=_0x296dc9[_0x46c57c(0x1bc)],_0x56e822[0x3*_0x5f5740+0x2]=_0x296dc9['blue'];}const _0x1c314a={'context':_0xe11cca,'width':_0x17cf5d,'height':0x1,'pixelFormat':Cesium$4[_0x46c57c(0x18b)]['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x46c57c(0x152)],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x27b691),'segmentsDepth':Util['createTexture'](_0x314190),'currentTrailsColor':Util['createTexture'](_0x27b691),'currentTrailsDepth':Util['createTexture'](_0x314190),'nextTrailsColor':Util['createTexture'](_0x27b691),'nextTrailsDepth':Util[_0x46c57c(0x118)](_0x314190),'colorTable':Util[_0x46c57c(0x118)](_0x1c314a,_0x56e822)};}['createRenderingFramebuffers'](_0x283f43){const _0x5c0954=_0x1e071f;this[_0x5c0954(0x17c)]={'segments':Util['createFramebuffer'](_0x283f43,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util[_0x5c0954(0x154)](_0x283f43,this['textures']['currentTrailsColor'],this['textures'][_0x5c0954(0x13d)]),'nextTrails':Util['createFramebuffer'](_0x283f43,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x3a0da8){const _0x1214ae=_0x1e071f,_0x18d4ed=0x4;let _0x2802e5=[];for(let _0x25a290=0x0;_0x25a290<_0x3a0da8['particlesTextureSize'];_0x25a290++){for(let _0x30c21f=0x0;_0x30c21f<_0x3a0da8[_0x1214ae(0x18f)];_0x30c21f++){for(let _0x272bf9=0x0;_0x272bf9<_0x18d4ed;_0x272bf9++){_0x2802e5['push'](_0x25a290/_0x3a0da8['particlesTextureSize']),_0x2802e5[_0x1214ae(0x14b)](_0x30c21f/_0x3a0da8['particlesTextureSize']);}}}_0x2802e5=new Float32Array(_0x2802e5);let _0x36bb4e=[];const _0x20a20d=[-0x1,0x1],_0x3800be=[-0x1,0x1];for(let _0x265492=0x0;_0x265492<_0x3a0da8[_0x1214ae(0xf8)];_0x265492++){for(let _0x14b10b=0x0;_0x14b10b<_0x18d4ed/0x2;_0x14b10b++){for(let _0x1792a2=0x0;_0x1792a2<_0x18d4ed/0x2;_0x1792a2++){_0x36bb4e['push'](_0x20a20d[_0x14b10b]),_0x36bb4e[_0x1214ae(0x14b)](_0x3800be[_0x1792a2]),_0x36bb4e[_0x1214ae(0x14b)](0x0);}}}_0x36bb4e=new Float32Array(_0x36bb4e);const _0x12776c=0x6*_0x3a0da8['maxParticles'],_0x304ed8=new Uint32Array(_0x12776c);for(let _0x2ff7b2=0x0,_0x338441=0x0,_0x18c7a6=0x0;_0x2ff7b2<_0x3a0da8['maxParticles'];_0x2ff7b2++){_0x304ed8[_0x338441++]=_0x18c7a6+0x0,_0x304ed8[_0x338441++]=_0x18c7a6+0x1,_0x304ed8[_0x338441++]=_0x18c7a6+0x2,_0x304ed8[_0x338441++]=_0x18c7a6+0x2,_0x304ed8[_0x338441++]=_0x18c7a6+0x1,_0x304ed8[_0x338441++]=_0x18c7a6+0x3,_0x18c7a6+=0x4;}const _0x2317c4=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x1214ae(0x16c))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x2802e5}),'normal':new Cesium$4[(_0x1214ae(0x16c))]({'componentDatatype':Cesium$4['ComponentDatatype'][_0x1214ae(0xde)],'componentsPerAttribute':0x3,'values':_0x36bb4e})}),'indices':_0x304ed8});return _0x2317c4;}['createRenderingPrimitives'](_0x5842dd,_0x5191e2,_0x1331c5,_0x546528){const _0x44dfd9=_0x1e071f,_0x9b651a=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x44dfd9(0x131)](_0x5191e2),'primitiveType':Cesium$4['PrimitiveType'][_0x44dfd9(0x140)],'uniformMap':{'currentParticlesPosition':function(){const _0xd7d31=_0x44dfd9;return _0x546528[_0xd7d31(0xfe)]['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x49e04e=_0x44dfd9;return _0x546528[_0x49e04e(0xfe)]['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x5bf8ea=_0x44dfd9;return _0x546528['particlesTextures'][_0x5bf8ea(0x12d)];},'colorTable':function(){const _0x95a3d=_0x44dfd9;return _0x9b651a[_0x95a3d(0x111)]['colorTable'];},'aspect':function(){const _0x3f8407=_0x44dfd9;return _0x5842dd['drawingBufferWidth']/_0x5842dd[_0x3f8407(0x12e)];},'pixelSize':function(){return _0x1331c5['pixelSize'];},'lineWidth':function(){const _0xae82da=_0x44dfd9;return _0x5191e2[_0xae82da(0x1b3)];},'particleHeight':function(){return _0x5191e2['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x44dfd9(0x102)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x44dfd9(0x1b9),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x17919b=_0x44dfd9;return _0x9b651a[_0x17919b(0x111)]['segmentsColor'];},'segmentsDepthTexture':function(){const _0xbfa6e2=_0x44dfd9;return _0x9b651a[_0xbfa6e2(0x111)][_0xbfa6e2(0x1b5)];},'currentTrailsColor':function(){const _0x2d59a3=_0x44dfd9;return _0x9b651a[_0x2d59a3(0x17c)][_0x2d59a3(0x18c)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x9b651a['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x5191e2['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x44dfd9(0x14c)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x44dfd9(0xfc)],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x44dfd9(0x102)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x44dfd9(0x17c)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x1c235e=_0x44dfd9,_0x56b437=_0x9b651a['framebuffers']['currentTrails'];_0x9b651a['framebuffers']['currentTrails']=_0x9b651a['framebuffers']['nextTrails'],_0x9b651a['framebuffers']['nextTrails']=_0x56b437,_0x9b651a[_0x1c235e(0xf1)][_0x1c235e(0x19f)][_0x1c235e(0x177)][_0x1c235e(0xf5)]=_0x9b651a['framebuffers']['nextTrails'],_0x9b651a['primitives']['trails']['clearCommand']['framebuffer']=_0x9b651a['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x44dfd9(0x1b9),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){return _0x9b651a['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x24196c=_0x44dfd9;return _0x9b651a[_0x24196c(0x17c)]['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x1e071f(0x119),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x5bfb23,_0x8cfe42,_0x148e6b,_0x32005a){const _0x41087a=_0x1e071f;this['data']=_0x8cfe42,this['createWindTextures'](_0x5bfb23,_0x8cfe42),this['createParticlesTextures'](_0x5bfb23,_0x148e6b,_0x32005a),this[_0x41087a(0x163)](_0x8cfe42,_0x148e6b,_0x32005a);}['createWindTextures'](_0x5f494d,_0x30cade){const _0x4e7e19=_0x1e071f,_0x4a8f42={'context':_0x5f494d,'width':_0x30cade['dimensions']['lon'],'height':_0x30cade['dimensions']['lat']*(_0x30cade['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x4e7e19(0xde)],'flipY':![],'sampler':new Cesium$3[(_0x4e7e19(0x133))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this[_0x4e7e19(0x180)]={'U':Util['createTexture'](_0x4a8f42,_0x30cade['U']['array']),'V':Util['createTexture'](_0x4a8f42,_0x30cade['V']['array'])};}['createParticlesTextures'](_0x3933d6,_0x276ccf,_0x32668b){const _0xb6069a=_0x1e071f,_0x21079f={'context':_0x3933d6,'width':_0x276ccf['particlesTextureSize'],'height':_0x276ccf['particlesTextureSize'],'pixelFormat':Cesium$3[_0xb6069a(0x18b)]['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0xb6069a(0x1ae)]})},_0x459759=this['randomizeParticles'](_0x276ccf[_0xb6069a(0xf8)],_0x32668b),_0x14b744=new Float32Array(0x4*_0x276ccf['maxParticles'])['fill'](0x0);this[_0xb6069a(0xfe)]={'particlesWind':Util['createTexture'](_0x21079f),'currentParticlesPosition':Util['createTexture'](_0x21079f,_0x459759),'nextParticlesPosition':Util['createTexture'](_0x21079f,_0x459759),'currentParticlesSpeed':Util[_0xb6069a(0x118)](_0x21079f,_0x14b744),'nextParticlesSpeed':Util['createTexture'](_0x21079f,_0x14b744),'postProcessingPosition':Util['createTexture'](_0x21079f,_0x459759),'postProcessingSpeed':Util['createTexture'](_0x21079f,_0x14b744)};}['randomizeParticles'](_0x1d6ad2,_0x7744fa){const _0x4ab79f=_0x1e071f,_0x5bf39d=new Float32Array(0x4*_0x1d6ad2);for(let _0xbcc488=0x0;_0xbcc488<_0x1d6ad2;_0xbcc488++){_0x5bf39d[0x4*_0xbcc488]=Cesium$3['Math']['randomBetween'](_0x7744fa['lonRange']['x'],_0x7744fa[_0x4ab79f(0x12a)]['y']),_0x5bf39d[0x4*_0xbcc488+0x1]=Cesium$3['Math']['randomBetween'](_0x7744fa['latRange']['x'],_0x7744fa['latRange']['y']),_0x5bf39d[0x4*_0xbcc488+0x2]=Cesium$3[_0x4ab79f(0x149)]['randomBetween'](this['data']['lev']['min'],this['data']['lev'][_0x4ab79f(0x193)]),_0x5bf39d[0x4*_0xbcc488+0x3]=0x0;}return _0x5bf39d;}[_0x1e071f(0x157)](){Object['keys'](this['particlesTextures'])['forEach'](_0xb2e63f=>{const _0x247dd0=_0x4105;this[_0x247dd0(0xfe)][_0xb2e63f]['destroy']();});}['createComputingPrimitives'](_0x1def53,_0x1be781,_0x3712ab){const _0x1c630a=_0x1e071f,_0x26bb68=new Cesium$3['Cartesian3'](_0x1def53[_0x1c630a(0x164)]['lon'],_0x1def53['dimensions']['lat'],_0x1def53[_0x1c630a(0x164)]['lev']),_0x122e8f=new Cesium$3['Cartesian3'](_0x1def53['lon']['min'],_0x1def53['lat'][_0x1c630a(0x11a)],_0x1def53[_0x1c630a(0x179)]['min']),_0x3cf43c=new Cesium$3['Cartesian3'](_0x1def53['lon']['max'],_0x1def53[_0x1c630a(0x17d)]['max'],_0x1def53['lev']['max']),_0xfa1a2f=new Cesium$3['Cartesian3']((_0x3cf43c['x']-_0x122e8f['x'])/(_0x26bb68['x']-0x1),(_0x3cf43c['y']-_0x122e8f['y'])/(_0x26bb68['y']-0x1),_0x26bb68['z']>0x1?(_0x3cf43c['z']-_0x122e8f['z'])/(_0x26bb68['z']-0x1):0x1),_0x215622=new Cesium$3[(_0x1c630a(0x10c))](_0x1def53['U']['min'],_0x1def53['U'][_0x1c630a(0x193)]),_0x2ee401=new Cesium$3['Cartesian2'](_0x1def53['V']['min'],_0x1def53['V']['max']),_0x64d24f=this;this[_0x1c630a(0xf1)]={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x64d24f['windTextures']['U'];},'V':function(){const _0x33d9bd=_0x1c630a;return _0x64d24f[_0x33d9bd(0x180)]['V'];},'currentParticlesPosition':function(){const _0x40a081=_0x1c630a;return _0x64d24f['particlesTextures'][_0x40a081(0x155)];},'dimension':function(){return _0x26bb68;},'minimum':function(){return _0x122e8f;},'maximum':function(){return _0x3cf43c;},'interval':function(){return _0xfa1a2f;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x562efa=_0x1c630a;_0x64d24f['primitives'][_0x562efa(0x15f)][_0x562efa(0x177)]['outputTexture']=_0x64d24f['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x1c630a(0xda),'uniformMap':{'currentParticlesSpeed':function(){const _0x952db1=_0x1c630a;return _0x64d24f[_0x952db1(0xfe)][_0x952db1(0x15b)];},'particlesWind':function(){return _0x64d24f['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x215622;},'vSpeedRange':function(){return _0x2ee401;},'pixelSize':function(){return _0x3712ab['pixelSize'];},'speedFactor':function(){return _0x1be781['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x193761=_0x1c630a,_0x13732d=_0x64d24f['particlesTextures']['currentParticlesSpeed'];_0x64d24f['particlesTextures'][_0x193761(0x15b)]=_0x64d24f[_0x193761(0xfe)]['postProcessingSpeed'],_0x64d24f['particlesTextures']['postProcessingSpeed']=_0x13732d,_0x64d24f['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x64d24f['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x3332e3=_0x1c630a;return _0x64d24f[_0x3332e3(0xfe)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x64d24f['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x23325c=_0x1c630a,_0x4285c2=_0x64d24f['particlesTextures']['currentParticlesPosition'];_0x64d24f[_0x23325c(0xfe)]['currentParticlesPosition']=_0x64d24f[_0x23325c(0xfe)]['postProcessingPosition'],_0x64d24f['particlesTextures']['postProcessingPosition']=_0x4285c2,_0x64d24f[_0x23325c(0xf1)]['updatePosition']['commandToExecute']['outputTexture']=_0x64d24f['particlesTextures'][_0x23325c(0xeb)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x64d24f['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0xe15dc8=_0x1c630a;return _0x64d24f['particlesTextures'][_0xe15dc8(0x10d)];},'lonRange':function(){return _0x3712ab['lonRange'];},'latRange':function(){return _0x3712ab['latRange'];},'randomCoefficient':function(){const _0x5d8d28=Math['random']();return _0x5d8d28;},'dropRate':function(){return _0x1be781['dropRate'];},'dropRateBump':function(){return _0x1be781['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x1c630a(0x16b))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x1c630a(0xfe)]['postProcessingPosition'],'preExecute':function(){_0x64d24f['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x64d24f['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x1c630a(0xda),'uniformMap':{'postProcessingPosition':function(){const _0x37f29f=_0x1c630a;return _0x64d24f[_0x37f29f(0xfe)]['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x64d24f['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x3045aa=_0x1c630a;_0x64d24f['primitives'][_0x3045aa(0x12d)][_0x3045aa(0x177)][_0x3045aa(0x18e)]=_0x64d24f['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];function _0x4105(_0x22b394,_0x4848a3){const _0x4b7bcb=_0x4b7b();return _0x4105=function(_0x41054d,_0x1521a){_0x41054d=_0x41054d-0xd7;let _0x432cca=_0x4b7bcb[_0x41054d];return _0x432cca;},_0x4105(_0x22b394,_0x4848a3);}class ParticleSystem{constructor(_0x5ebbd7,_0x359400,_0xec79c1,_0x2e3078){const _0x5eb072=_0x1e071f;this['context']=_0x5ebbd7,_0x359400={..._0x359400},_0x359400[_0x5eb072(0x15a)]&&_0x359400['vdata']&&(_0x359400[_0x5eb072(0x164)]={},_0x359400['dimensions']['lon']=_0x359400[_0x5eb072(0xe9)],_0x359400['dimensions']['lat']=_0x359400['rows'],_0x359400[_0x5eb072(0x164)][_0x5eb072(0x179)]=_0x359400['lev']||0x1,_0x359400['lon']={},_0x359400[_0x5eb072(0xfd)][_0x5eb072(0x11a)]=_0x359400['xmin'],_0x359400[_0x5eb072(0xfd)]['max']=_0x359400[_0x5eb072(0x1b0)],_0x359400['lat']={},_0x359400['lat'][_0x5eb072(0x11a)]=_0x359400[_0x5eb072(0x127)],_0x359400['lat']['max']=_0x359400['ymax'],_0x359400[_0x5eb072(0x179)]={},_0x359400[_0x5eb072(0x179)]['min']=_0x359400[_0x5eb072(0x1b1)]??0x1,_0x359400[_0x5eb072(0x179)][_0x5eb072(0x193)]=_0x359400[_0x5eb072(0x165)]??0x1,_0x359400['U']={},_0x359400['U']['array']=new Float32Array(_0x359400['udata']),_0x359400['U'][_0x5eb072(0x11a)]=_0x359400[_0x5eb072(0x156)]??Math['min'](..._0x359400['udata']),_0x359400['U']['max']=_0x359400['umax']??Math['max'](..._0x359400['udata']),_0x359400['V']={},_0x359400['V']['array']=new Float32Array(_0x359400['vdata']),_0x359400['V']['min']=_0x359400[_0x5eb072(0xdf)]??Math['min'](..._0x359400['vdata']),_0x359400['V']['max']=_0x359400['vmax']??Math[_0x5eb072(0x193)](..._0x359400['vdata'])),this[_0x5eb072(0xea)]=_0x359400,this[_0x5eb072(0x114)]=_0xec79c1,this['viewerParameters']=_0x2e3078,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x5eb072(0x114)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x5eb072(0x114)],this['viewerParameters'],this['particlesComputing']);}[_0x1e071f(0x19c)](_0x1055b9){const _0x2a2315=_0x1e071f;this[_0x2a2315(0x1ab)]['destroyParticlesTextures'](),Object['keys'](this[_0x2a2315(0x1ab)][_0x2a2315(0x180)])['forEach'](_0x2ec985=>{const _0x27ec65=_0x2a2315;this[_0x27ec65(0x1ab)][_0x27ec65(0x180)][_0x2ec985]['destroy']();}),this[_0x2a2315(0x1a9)][_0x2a2315(0x111)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x6b10fe=>{this['particlesRendering']['framebuffers'][_0x6b10fe]['destroy']();}),this['context']=_0x1055b9,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x2a2315(0xea)],this[_0x2a2315(0x114)],this[_0x2a2315(0xe7)]),this[_0x2a2315(0x1a9)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x45b024=_0x1e071f,_0xb00e26=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x45b024(0x1af))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x45b024(0x128)](this['particlesRendering']['framebuffers'])['forEach'](_0x2285d1=>{const _0x4f4893=_0x45b024;_0xb00e26['framebuffer']=this['particlesRendering']['framebuffers'][_0x2285d1],_0xb00e26[_0x4f4893(0x195)](this['context']);});}[_0x1e071f(0x13b)](_0x31bc4c){const _0x47a255=_0x1e071f;this[_0x47a255(0x1a6)](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x47a255(0x1ab)]['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x31bc4c){const _0xd14e9d=this[_0x47a255(0x1a9)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0xd14e9d;const _0x2c94b1=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0xd14e9d,'attributeLocations':this[_0x47a255(0x1a9)]['primitives'][_0x47a255(0x187)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this[_0x47a255(0x1a9)]['primitives']['segments']['commandToExecute'][_0x47a255(0x14d)]=_0x2c94b1;}}['setOptions'](_0xe0178d){const _0x2df935=_0x1e071f;let _0x26367a=![];this['options'][_0x2df935(0xf8)]!==_0xe0178d['maxParticles']&&(_0x26367a=!![]),Object[_0x2df935(0x128)](_0xe0178d)[_0x2df935(0x13a)](_0x3f7ae4=>{const _0xd275b=_0x2df935;this[_0xd275b(0x114)][_0x3f7ae4]=_0xe0178d[_0x3f7ae4];}),this['refreshParticles'](_0x26367a);}['applyViewerParameters'](_0x1d4940){const _0x33ea5b=_0x1e071f;Object[_0x33ea5b(0x128)](_0x1d4940)['forEach'](_0x356e7d=>{this['viewerParameters'][_0x356e7d]=_0x1d4940[_0x356e7d];}),this['refreshParticles'](![]);}['destroy'](){const _0x4dbdf4=_0x1e071f;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x4dbdf4(0x1ab)]['windTextures'])[_0x4dbdf4(0x13a)](_0x4960ba=>{const _0x3376c7=_0x4dbdf4;this['particlesComputing']['windTextures'][_0x4960ba][_0x3376c7(0x171)]();}),this['particlesRendering']['textures']['colorTable'][_0x4dbdf4(0x171)](),Object[_0x4dbdf4(0x128)](this[_0x4dbdf4(0x1a9)][_0x4dbdf4(0x17c)])['forEach'](_0x4b270a=>{this['particlesRendering']['framebuffers'][_0x4b270a]['destroy']();});for(const _0x1ad525 in this){delete this[_0x1ad525];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x1e071f(0x129)][_0x1e071f(0x190)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x56d22c={}){_0x56d22c={...DEF_OPTIONS,..._0x56d22c},super(_0x56d22c),this['_setOptionsHook'](_0x56d22c);}get['layer'](){const _0x12f48e=_0x1e071f;return this[_0x12f48e(0xf1)];}get[_0x1e071f(0xea)](){return this['_data'];}set['data'](_0x535d0e){const _0x3220ad=_0x1e071f;this[_0x3220ad(0x143)](_0x535d0e);}get[_0x1e071f(0x150)](){return this['options']['colors'];}set['colors'](_0x415ed3){const _0x49a525=_0x1e071f;this['options']['colors']=_0x415ed3,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x415ed3}),this[_0x49a525(0x185)]();}['_mountedHook'](){}['_addedHook'](){const _0x58c2a3=_0x1e071f;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this['primitives']),this[_0x58c2a3(0xe7)]={'lonRange':new Cesium$1[(_0x58c2a3(0x10c))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x58c2a3(0x11e)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this[_0x58c2a3(0x185)][_0x58c2a3(0x168)](this),![]),this['mouse_down']=![],this[_0x58c2a3(0x117)]=![],this[_0x58c2a3(0x100)]['on'](mars3d__namespace[_0x58c2a3(0xfa)][_0x58c2a3(0x16a)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x58c2a3(0xfa)]['mouseDown'],this[_0x58c2a3(0x192)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x58c2a3(0x146)],this['_onMouseUpEvent'],this),this[_0x58c2a3(0x100)]['on'](mars3d__namespace[_0x58c2a3(0xfa)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x58c2a3(0x136)]&&this['setData'](this[_0x58c2a3(0x136)]);}['_removedHook'](){const _0x1f6008=_0x1e071f;window['removeEventListener']('resize',this['resize']),this[_0x1f6008(0x100)][_0x1f6008(0x1ba)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x1f6008(0x1ba)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x1f6008(0x100)][_0x1f6008(0x1ba)](mars3d__namespace['EventType']['mouseDown'],this[_0x1f6008(0x192)],this),this[_0x1f6008(0x100)]['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x1f6008(0xfa)]['mouseMove'],this[_0x1f6008(0x19a)],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this[_0x1f6008(0xf1)]);}['resize'](){const _0x398400=_0x1e071f;if(!this[_0x398400(0x19d)]||!this[_0x398400(0x106)])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x48fac1){const _0x24637c=_0x1e071f;this['particleSystem'][_0x24637c(0x19c)](this['scene'][_0x24637c(0x121)]),this[_0x24637c(0x101)](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x7afd5c){const _0x1837a7=_0x1e071f;clearTimeout(this[_0x1837a7(0xe5)]);if(!this['show']||!this['particleSystem'])return;this[_0x1837a7(0xf1)]['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x1e071f(0x192)](_0xaedb1){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x1deafc){const _0x51881e=_0x1e071f;if(!this['show']||!this[_0x51881e(0x106)])return;this['mouse_down']&&(this['primitives'][_0x51881e(0x19d)]=![],this['mouse_move']=!![]);}[_0x1e071f(0x167)](_0x927027){const _0x4d5828=_0x1e071f;if(!this['show']||!this[_0x4d5828(0x106)])return;this[_0x4d5828(0xee)]&&this[_0x4d5828(0x117)]&&this['redraw'](),this['primitives']['show']=!![],this[_0x4d5828(0xee)]=![],this['mouse_move']=![];}[_0x1e071f(0xe1)](){const _0x453144=_0x1e071f;if(!this['_map']||!this[_0x453144(0x19d)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x453144(0xf1)]['show']=!![];}['setData'](_0x2a7b1d){const _0x4b23b5=_0x1e071f;this['_data']=_0x2a7b1d,this['particleSystem']&&this['particleSystem'][_0x4b23b5(0x171)](),this['particleSystem']=new ParticleSystem(this[_0x4b23b5(0x16f)]['context'],_0x2a7b1d,this['getOptions'](),this[_0x4b23b5(0xe7)]),this['addPrimitives']();}['_setOptionsHook'](_0x540605,_0x56df6a){if(_0x540605)for(const _0x283ff3 in _0x540605){this[_0x283ff3]=_0x540605[_0x283ff3];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x1e071f(0x18a)](){const _0xb1d486=_0x1e071f,_0x3522f7=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x3522f7*_0x3522f7,{'particlesTextureSize':_0x3522f7,'maxParticles':this[_0xb1d486(0x10f)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}[_0x1e071f(0x101)](){const _0x1df369=_0x1e071f;this[_0x1df369(0xf1)]['add'](this['particleSystem'][_0x1df369(0x1ab)]['primitives'][_0x1df369(0x15f)]),this[_0x1df369(0xf1)][_0x1df369(0x1b6)](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this[_0x1df369(0xf1)]['add'](this[_0x1df369(0x106)]['particlesComputing'][_0x1df369(0xf1)]['updatePosition']),this['primitives']['add'](this['particleSystem'][_0x1df369(0x1ab)][_0x1df369(0xf1)]['postProcessingPosition']),this['primitives']['add'](this[_0x1df369(0x106)]['particlesComputing'][_0x1df369(0xf1)]['postProcessingSpeed']),this[_0x1df369(0xf1)]['add'](this['particleSystem']['particlesRendering']['primitives'][_0x1df369(0x187)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}[_0x1e071f(0x175)](){const _0x4828bb=_0x1e071f;let _0x1ed32d=this[_0x4828bb(0x12f)]['computeViewRectangle'](this['scene']['globe'][_0x4828bb(0x113)]);if(!_0x1ed32d){const _0x1c803e=this[_0x4828bb(0x100)][_0x4828bb(0x15d)]();_0x1ed32d=Cesium$1[_0x4828bb(0x151)]['fromDegrees'](_0x1c803e['xmin'],_0x1c803e['ymin'],_0x1c803e['xmax'],_0x1c803e['ymax']);}const _0x235c88=Util['viewRectangleToLonLatRange'](_0x1ed32d);this['viewerParameters']['lonRange']['x']=_0x235c88['lon']['min'],this[_0x4828bb(0xe7)]['lonRange']['y']=_0x235c88['lon']['max'],this['viewerParameters']['latRange']['x']=_0x235c88['lat']['min'],this['viewerParameters']['latRange']['y']=_0x235c88['lat']['max'];const _0x5ddbcb=this['camera']['getPixelSize'](this[_0x4828bb(0x11e)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x5ddbcb>0x0&&(this[_0x4828bb(0xe7)]['pixelSize']=_0x5ddbcb);}}mars3d__namespace[_0x1e071f(0x123)][_0x1e071f(0x11d)](_0x1e071f(0xe0),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null;}['destroy'](){for(const _0x5e2187 in this){delete this[_0x5e2187];}}}class CanvasWindField{constructor(_0x39afc8){this['setOptions'](_0x39afc8);}get['speedRate'](){return this['_speedRate'];}set[_0x1e071f(0x107)](_0xfb7371){const _0x572f34=_0x1e071f;this['_speedRate']=(0x64-(_0xfb7371>0x63?0x63:_0xfb7371))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x572f34(0x127)])/this['_speedRate']];}get[_0x1e071f(0x18d)](){return this['_maxAge'];}set['maxAge'](_0x18b988){this['_maxAge']=_0x18b988;}[_0x1e071f(0x182)](_0x4c8aa5){const _0x1a5487=_0x1e071f;this['options']=_0x4c8aa5,this[_0x1a5487(0x18d)]=_0x4c8aa5[_0x1a5487(0x18d)]||0x78,this['speedRate']=_0x4c8aa5['speedRate']||0x32,this[_0x1a5487(0x178)]=[];const _0x10415b=_0x4c8aa5['particlesNumber']||0x1000;for(let _0x1cb19a=0x0;_0x1cb19a<_0x10415b;_0x1cb19a++){const _0x2d913a=this[_0x1a5487(0x120)](new CanvasParticle());this['particles']['push'](_0x2d913a);}}[_0x1e071f(0x199)](_0x4c7317){const _0x1e4783=_0x1e071f;this['rows']=_0x4c7317['rows'],this['cols']=_0x4c7317['cols'],this[_0x1e4783(0x1a7)]=_0x4c7317['xmin'],this['xmax']=_0x4c7317['xmax'],this['ymin']=_0x4c7317[_0x1e4783(0x127)],this[_0x1e4783(0x170)]=_0x4c7317['ymax'],this['grid']=[];const _0x249c19=_0x4c7317['udata'],_0x1eb0e1=_0x4c7317[_0x1e4783(0xd7)];let _0x5413fd=![];_0x249c19['length']===this[_0x1e4783(0x198)]&&_0x249c19[0x0]['length']===this['cols']&&(_0x5413fd=!![]);let _0x57eab6=0x0,_0x22a00a=null,_0x548707=null;for(let _0x1d7d2e=0x0;_0x1d7d2e<this[_0x1e4783(0x198)];_0x1d7d2e++){_0x22a00a=[];for(let _0x66105b=0x0;_0x66105b<this[_0x1e4783(0xe9)];_0x66105b++,_0x57eab6++){_0x5413fd?_0x548707=this['_calcUV'](_0x249c19[_0x1d7d2e][_0x66105b],_0x1eb0e1[_0x1d7d2e][_0x66105b]):_0x548707=this['_calcUV'](_0x249c19[_0x57eab6],_0x1eb0e1[_0x57eab6]),_0x22a00a['push'](_0x548707);}this['grid']['push'](_0x22a00a);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x550f4e=_0x1e071f;delete this['rows'],delete this[_0x550f4e(0xe9)],delete this['xmin'],delete this['xmax'],delete this[_0x550f4e(0x127)],delete this['ymax'],delete this[_0x550f4e(0x108)],delete this['particles'];}['toGridXY'](_0x51d09c,_0x270d07){const _0x44656f=_0x1e071f,_0xe28e96=(_0x51d09c-this['xmin'])/(this['xmax']-this['xmin'])*(this[_0x44656f(0xe9)]-0x1),_0x10c9f6=(this['ymax']-_0x270d07)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0xe28e96,_0x10c9f6];}['getUVByXY'](_0x1b5bae,_0x2d8454){const _0x56b5a6=_0x1e071f;if(_0x1b5bae<0x0||_0x1b5bae>=this[_0x56b5a6(0xe9)]||_0x2d8454>=this['rows'])return[0x0,0x0,0x0];const _0x3cd90e=Math['floor'](_0x1b5bae),_0x2be5b=Math['floor'](_0x2d8454);if(_0x3cd90e===_0x1b5bae&&_0x2be5b===_0x2d8454)return this[_0x56b5a6(0x108)][_0x2d8454][_0x1b5bae];const _0x17c84a=_0x3cd90e+0x1,_0x102f4d=_0x2be5b+0x1,_0x1bb674=this[_0x56b5a6(0x184)](_0x3cd90e,_0x2be5b),_0x212bdf=this[_0x56b5a6(0x184)](_0x17c84a,_0x2be5b),_0x2a5bee=this[_0x56b5a6(0x184)](_0x3cd90e,_0x102f4d),_0x54cb52=this['getUVByXY'](_0x17c84a,_0x102f4d);let _0x1d794b=null;try{_0x1d794b=this[_0x56b5a6(0x14f)](_0x1b5bae-_0x3cd90e,_0x2d8454-_0x2be5b,_0x1bb674,_0x212bdf,_0x2a5bee,_0x54cb52);}catch(_0xc9ba76){console['log'](_0x1b5bae,_0x2d8454);}return _0x1d794b;}['_bilinearInterpolation'](_0x283732,_0x1940c7,_0x93f908,_0x2ccff1,_0x20cd1d,_0x4323de){const _0x1865ad=_0x1e071f,_0x5a4b3b=0x1-_0x283732,_0x114a08=0x1-_0x1940c7,_0x475a03=_0x5a4b3b*_0x114a08,_0x5c4d9c=_0x283732*_0x114a08,_0xca7c89=_0x5a4b3b*_0x1940c7,_0x1f7748=_0x283732*_0x1940c7,_0x26077a=_0x93f908[0x0]*_0x475a03+_0x2ccff1[0x0]*_0x5c4d9c+_0x20cd1d[0x0]*_0xca7c89+_0x4323de[0x0]*_0x1f7748,_0x283485=_0x93f908[0x1]*_0x475a03+_0x2ccff1[0x1]*_0x5c4d9c+_0x20cd1d[0x1]*_0xca7c89+_0x4323de[0x1]*_0x1f7748;return this[_0x1865ad(0xfb)](_0x26077a,_0x283485);}['_calcUV'](_0x123bc7,_0x1d108c){return[+_0x123bc7,+_0x1d108c,Math['sqrt'](_0x123bc7*_0x123bc7+_0x1d108c*_0x1d108c)];}[_0x1e071f(0xe4)](_0x575637,_0x2a1b19){if(!this['isInExtent'](_0x575637,_0x2a1b19))return null;const _0xff52ba=this['toGridXY'](_0x575637,_0x2a1b19),_0x403dc5=this['getUVByXY'](_0xff52ba[0x0],_0xff52ba[0x1]);return _0x403dc5;}[_0x1e071f(0xed)](_0x346cd6,_0x3822bb){const _0x4cb99c=_0x1e071f;return _0x346cd6>=this['xmin']&&_0x346cd6<=this[_0x4cb99c(0x1b0)]&&_0x3822bb>=this['ymin']&&_0x3822bb<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x10cd7f=_0x1e071f,_0x393a60=fRandomByfloat(this['xmin'],this[_0x10cd7f(0x1b0)]),_0x4f3b5e=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x4f3b5e,'lng':_0x393a60};}[_0x1e071f(0x1ad)](){const _0x13718e=_0x1e071f;let _0x206842,_0x211f6c,_0x113783;for(let _0x436ceb=0x0,_0x4b3f99=this[_0x13718e(0x178)]['length'];_0x436ceb<_0x4b3f99;_0x436ceb++){let _0x3a86d5=this['particles'][_0x436ceb];_0x3a86d5['age']<=0x0&&(_0x3a86d5=this['_randomParticle'](_0x3a86d5));if(_0x3a86d5[_0x13718e(0x1a1)]>0x0){const _0x21efa6=_0x3a86d5['tlng'],_0x329b98=_0x3a86d5[_0x13718e(0x19b)];_0x113783=this['getUVByPoint'](_0x21efa6,_0x329b98),_0x113783?(_0x206842=_0x21efa6+this['_calc_speedRate'][0x0]*_0x113783[0x0],_0x211f6c=_0x329b98+this['_calc_speedRate'][0x1]*_0x113783[0x1],_0x3a86d5[_0x13718e(0x166)]=_0x21efa6,_0x3a86d5['lat']=_0x329b98,_0x3a86d5['tlng']=_0x206842,_0x3a86d5['tlat']=_0x211f6c,_0x3a86d5['age']--):_0x3a86d5[_0x13718e(0x1a1)]=0x0;}}return this['particles'];}['_randomParticle'](_0xa3acd0){const _0x19b629=_0x1e071f;let _0x11ec5b,_0x207d20;for(let _0x175f96=0x0;_0x175f96<0x1e;_0x175f96++){_0x11ec5b=this['getRandomLatLng'](),_0x207d20=this[_0x19b629(0xe4)](_0x11ec5b['lng'],_0x11ec5b['lat']);if(_0x207d20&&_0x207d20[0x2]>0x0)break;}if(!_0x207d20)return _0xa3acd0;const _0x58d6ce=_0x11ec5b['lng']+this['_calc_speedRate'][0x0]*_0x207d20[0x0],_0x556cfd=_0x11ec5b['lat']+this['_calc_speedRate'][0x1]*_0x207d20[0x1];return _0xa3acd0[_0x19b629(0x166)]=_0x11ec5b['lng'],_0xa3acd0[_0x19b629(0x17d)]=_0x11ec5b['lat'],_0xa3acd0[_0x19b629(0x159)]=_0x58d6ce,_0xa3acd0['tlat']=_0x556cfd,_0xa3acd0['age']=Math['round'](Math['random']()*this['maxAge']),_0xa3acd0;}['destroy'](){for(const _0x555610 in this){delete this[_0x555610];}}}function fRandomByfloat(_0x1ab53b,_0x26c6d9){const _0x29e917=_0x1e071f;return _0x1ab53b+Math[_0x29e917(0x109)]()*(_0x26c6d9-_0x1ab53b);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x1a0370={}){const _0x2c54e7=_0x1e071f;super(_0x1a0370),this['_setOptionsHook'](_0x1a0370),this[_0x2c54e7(0x1b7)]=null;}['_setOptionsHook'](_0x5c7dd2,_0x373a19){const _0x145faf=_0x1e071f;this[_0x145faf(0x112)]=0x3e8/(_0x5c7dd2[_0x145faf(0xdc)]||0xa),this[_0x145faf(0x10b)]=this['options']['pointerEvents']??![],this['color']=_0x5c7dd2[_0x145faf(0x1bf)]||'#ffffff',this['lineWidth']=_0x5c7dd2[_0x145faf(0x1b3)]||0x1,this['fixedHeight']=_0x5c7dd2['fixedHeight']??0x0,this['reverseY']=_0x5c7dd2['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x5c7dd2);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x1837f1=_0x1e071f;return this['_map']['scene'][_0x1837f1(0x1b7)][_0x1837f1(0x124)];}get[_0x1e071f(0x138)](){return this['_map']['scene']['canvas']['clientHeight'];}get[_0x1e071f(0x169)](){return this['_pointerEvents'];}set['pointerEvents'](_0x51b5c4){const _0x50a6fc=_0x1e071f;this['_pointerEvents']=_0x51b5c4;if(!this[_0x50a6fc(0x1b7)])return;_0x51b5c4?this['canvas']['style'][_0x50a6fc(0xef)]='all':this['canvas']['style'][_0x50a6fc(0xef)]='none';}get[_0x1e071f(0x10f)](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x3d34fa){const _0x648079=_0x1e071f;this['options'][_0x648079(0x10f)]=_0x3d34fa,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x1e071f(0x107)](){return this['options']['speedRate'];}set[_0x1e071f(0x107)](_0x10fc68){const _0x5f1255=_0x1e071f;this['options']['speedRate']=_0x10fc68,this[_0x5f1255(0x1bb)]&&(this[_0x5f1255(0x1bb)]['speedRate']=_0x10fc68);}get['maxAge'](){return this['options']['maxAge'];}set[_0x1e071f(0x18d)](_0x57a0e6){const _0x2455f5=_0x1e071f;this['options']['maxAge']=_0x57a0e6,this[_0x2455f5(0x1bb)]&&(this['windField'][_0x2455f5(0x18d)]=_0x57a0e6);}get[_0x1e071f(0xea)](){return this['windData'];}set['data'](_0xf649e2){this['setData'](_0xf649e2);}['_showHook'](_0x263b76){const _0xd2a76e=_0x1e071f;_0x263b76?this['_addedHook']():(this['windData']&&(this['options'][_0xd2a76e(0xea)]=this['windData']),this[_0xd2a76e(0x13f)]());}['_mountedHook'](){const _0x50ad6d=_0x1e071f;this[_0x50ad6d(0x114)][_0x50ad6d(0x142)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x1e071f(0xe6)](){const _0x36b034=_0x1e071f;this[_0x36b034(0x1b7)]=this[_0x36b034(0xec)](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x36b034(0xf9)](),this['options']['data']&&this['setData'](this[_0x36b034(0x114)]['data']);}['_removedHook'](){const _0x4e8eed=_0x1e071f;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container'][_0x4e8eed(0x17a)](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x2af9e6=_0x1e071f,_0x410740=mars3d__namespace['DomUtil']['create'](_0x2af9e6(0x1b7),'mars3d-canvasWind',this['_map'][_0x2af9e6(0x17b)]);return _0x410740['style'][_0x2af9e6(0xe8)]=_0x2af9e6(0x174),_0x410740[_0x2af9e6(0x17e)]['top']='0px',_0x410740[_0x2af9e6(0x17e)]['left']='0px',_0x410740[_0x2af9e6(0x17e)][_0x2af9e6(0x1b4)]=this[_0x2af9e6(0x100)]['scene']['canvas']['clientWidth']+'px',_0x410740['style'][_0x2af9e6(0xf6)]=this['_map'][_0x2af9e6(0x16f)]['canvas']['clientHeight']+'px',_0x410740[_0x2af9e6(0x17e)]['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x410740['style']['zIndex']=this['options'][_0x2af9e6(0x13c)]??0x9,_0x410740[_0x2af9e6(0x1b4)]=this['_map']['scene']['canvas']['clientWidth'],_0x410740[_0x2af9e6(0xf6)]=this['_map']['scene']['canvas'][_0x2af9e6(0x135)],_0x410740;}['resize'](){const _0x17f0f0=_0x1e071f;this['canvas']&&(this['canvas']['style']['width']=this[_0x17f0f0(0x100)]['scene']['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene'][_0x17f0f0(0x1b7)][_0x17f0f0(0x124)],this['canvas'][_0x17f0f0(0xf6)]=this[_0x17f0f0(0x100)]['scene'][_0x17f0f0(0x1b7)]['clientHeight']);}['bindEvent'](){const _0x3e5795=_0x1e071f,_0x4d651f=this;let _0x28e519=Date['now']();(function _0x3cc437(){const _0x8eda6d=_0x4105;_0x4d651f['animateFrame']=window['requestAnimationFrame'](_0x3cc437);if(_0x4d651f[_0x8eda6d(0x19d)]&&_0x4d651f[_0x8eda6d(0x1bb)]){const _0x113dad=Date[_0x8eda6d(0x11b)](),_0x2b2fcf=_0x113dad-_0x28e519;_0x2b2fcf>_0x4d651f[_0x8eda6d(0x112)]&&(_0x28e519=_0x113dad-_0x2b2fcf%_0x4d651f['frameTime'],_0x4d651f['update']());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace[_0x3e5795(0xfa)]['wheel'],this[_0x3e5795(0xf7)],this),this[_0x3e5795(0x100)]['on'](mars3d__namespace[_0x3e5795(0xfa)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x3e5795(0x146)],this[_0x3e5795(0x167)],this)));}['unbindEvent'](){const _0x379393=_0x1e071f;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x379393(0x185)]),this[_0x379393(0x114)][_0x379393(0xdb)]&&(this[_0x379393(0x100)][_0x379393(0x1ba)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x379393(0x141)],this['_onMouseDownEvent'],this),this[_0x379393(0x100)]['off'](mars3d__namespace['EventType'][_0x379393(0x146)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}[_0x1e071f(0xf7)](_0x3bef75){const _0x1b2dde=_0x1e071f;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x1b2dde(0x1b7)])return;this['canvas'][_0x1b2dde(0x17e)]['visibility']='hidden',this[_0x1b2dde(0xe5)]=setTimeout(()=>{const _0x22e85d=_0x1b2dde;if(!this['show'])return;this[_0x22e85d(0xe1)](),this['canvas'][_0x22e85d(0x17e)]['visibility']='visible';},0xc8);}[_0x1e071f(0x192)](_0x2b111d){const _0x9121e5=_0x1e071f;this[_0x9121e5(0xee)]=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x9121e5(0xff)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x1e071f(0x19a)](_0x3aa161){const _0x18e9ad=_0x1e071f;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this['canvas'][_0x18e9ad(0x17e)]['visibility']='hidden',this[_0x18e9ad(0x117)]=!![]);}['_onMouseUpEvent'](_0x533d48){const _0x7ee52f=_0x1e071f;if(!this['show']||!this['canvas'])return;this['_map'][_0x7ee52f(0x1ba)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x7ee52f(0x1b7)]['style'][_0x7ee52f(0x13e)]=_0x7ee52f(0x162),this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x53346b){this['clear'](),this['windData']=_0x53346b,this['windField']['setDate'](_0x53346b),this['redraw']();}['redraw'](){const _0x4273d0=_0x1e071f;if(!this[_0x4273d0(0x19d)])return;this['windField'][_0x4273d0(0x182)](this[_0x4273d0(0x114)]),this['update']();}['update'](){const _0x30a79e=_0x1e071f;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this[_0x30a79e(0x1bb)][_0x30a79e(0xe2)]();else{const _0x5ea3b9=this['windField']['getParticles']();this['_drawLines'](_0x5ea3b9);}this['_updateIng']=![];}['_drawLines'](_0x4ee7b){const _0x2cae7d=_0x1e071f;this[_0x2cae7d(0x19e)]['globalCompositeOperation']=_0x2cae7d(0x186),this['canvasContext'][_0x2cae7d(0x1a5)](0x0,0x0,this[_0x2cae7d(0x153)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext'][_0x2cae7d(0x10e)]=0.9,this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['color'];const _0x46b85e=this[_0x2cae7d(0x100)]['scene']['mode']!==Cesium['SceneMode'][_0x2cae7d(0x110)],_0x2a9c90=this['canvasWidth']*0.25;for(let _0x2da9f=0x0,_0x1a3f9d=_0x4ee7b['length'];_0x2da9f<_0x1a3f9d;_0x2da9f++){const _0xe7c814=_0x4ee7b[_0x2da9f],_0x3af57b=this[_0x2cae7d(0xdd)](_0xe7c814['lng'],_0xe7c814['lat'],_0xe7c814),_0x475c53=this['_tomap'](_0xe7c814[_0x2cae7d(0x159)],_0xe7c814['tlat'],_0xe7c814);if(!_0x3af57b||!_0x475c53)continue;if(_0x46b85e&&Math['abs'](_0x3af57b[0x0]-_0x475c53[0x0])>=_0x2a9c90)continue;this['canvasContext']['moveTo'](_0x3af57b[0x0],_0x3af57b[0x1]),this[_0x2cae7d(0x19e)]['lineTo'](_0x475c53[0x0],_0x475c53[0x1]);}this['canvasContext']['stroke']();}['_tomap'](_0x3a4e16,_0x4ca29a,_0x4d9c16){const _0x36b132=_0x1e071f,_0x820906=Cesium[_0x36b132(0x139)]['fromDegrees'](_0x3a4e16,_0x4ca29a,this['fixedHeight']),_0x19c075=this['_map']['scene'];if(_0x19c075[_0x36b132(0x130)]===Cesium[_0x36b132(0x16e)]['SCENE3D']){const _0x547641=new Cesium[(_0x36b132(0x1be))](_0x19c075['globe']['ellipsoid'],_0x19c075[_0x36b132(0x12f)][_0x36b132(0x145)]),_0x26e611=_0x547641['isPointVisible'](_0x820906);if(!_0x26e611)return _0x4d9c16[_0x36b132(0x1a1)]=0x0,null;}const _0x265061=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x820906);return _0x265061?[_0x265061['x'],_0x265061['y']]:null;}['clear'](){const _0x291f60=_0x1e071f;this['windField'][_0x291f60(0x15e)](),delete this['windData'];}['initWorker'](){const _0x534ceb=_0x1e071f;this[_0x534ceb(0x142)]=new Worker(this[_0x534ceb(0x114)][_0x534ceb(0x142)]),this['worker']['onmessage']=_0x16fe86=>{const _0x653cb8=_0x534ceb;this[_0x653cb8(0x194)](_0x16fe86['data'][_0x653cb8(0x178)]),this['_updateIng2']=![];},this['windField']={'init':_0x38a3f3=>{const _0x43a0a7=_0x534ceb;this['worker'][_0x43a0a7(0x1c0)]({'type':'init','options':_0x38a3f3});},'setOptions':_0x21b699=>{this['worker']['postMessage']({'type':'setOptions','options':_0x21b699});},'setDate':_0x428c39=>{const _0x239eb4=_0x534ceb;this['worker'][_0x239eb4(0x1c0)]({'type':'setDate','data':_0x428c39});},'update':()=>{const _0x5bfdd6=_0x534ceb;if(this[_0x5bfdd6(0x115)])return;this[_0x5bfdd6(0x115)]=!![],this['worker'][_0x5bfdd6(0x1c0)]({'type':_0x5bfdd6(0xe2)});},'clear':()=>{const _0x3a913b=_0x534ceb;this[_0x3a913b(0x142)]['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer'][_0x1e071f(0x1b8)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x1e071f(0x1b2)]=CanvasWindField,exports[_0x1e071f(0x1b8)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x1e071f(0x189)](exports,'__esModule',{'value':!![]});
}));
