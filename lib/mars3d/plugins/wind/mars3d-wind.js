/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.10
 * 编译日期：2023-06-05 18:30:50
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x5be5a1=_0x3f55;(function(_0x2d2a75,_0x4e673f){const _0x35f3b7=_0x3f55,_0x523f19=_0x2d2a75();while(!![]){try{const _0x16b819=parseInt(_0x35f3b7(0xc9))/0x1+parseInt(_0x35f3b7(0x17f))/0x2*(-parseInt(_0x35f3b7(0x189))/0x3)+parseInt(_0x35f3b7(0x11e))/0x4*(parseInt(_0x35f3b7(0x136))/0x5)+parseInt(_0x35f3b7(0x12b))/0x6+-parseInt(_0x35f3b7(0xb0))/0x7+parseInt(_0x35f3b7(0x187))/0x8*(-parseInt(_0x35f3b7(0x12e))/0x9)+parseInt(_0x35f3b7(0x10f))/0xa;if(_0x16b819===_0x4e673f)break;else _0x523f19['push'](_0x523f19['shift']());}catch(_0x7dd1b1){_0x523f19['push'](_0x523f19['shift']());}}}(_0x5057,0xcba3b));function _interopNamespace(_0x1a70c4){const _0x9c5f27=_0x3f55;if(_0x1a70c4&&_0x1a70c4['__esModule'])return _0x1a70c4;var _0x572b61=Object['create'](null);return _0x1a70c4&&Object[_0x9c5f27(0xfb)](_0x1a70c4)[_0x9c5f27(0xab)](function(_0x58ffca){const _0x16fa29=_0x9c5f27;if(_0x58ffca!==_0x16fa29(0x105)){var _0x395924=Object['getOwnPropertyDescriptor'](_0x1a70c4,_0x58ffca);Object[_0x16fa29(0x108)](_0x572b61,_0x58ffca,_0x395924['get']?_0x395924:{'enumerable':!![],'get':function(){return _0x1a70c4[_0x58ffca];}});}}),_0x572b61['default']=_0x1a70c4,_0x572b61;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x3ed9ae,_0x3bfcb1){const _0x1eb0f0=_0x3f55,_0xcc1891=_0x3ed9ae*Math['cos'](Cesium$7[_0x1eb0f0(0x17e)][_0x1eb0f0(0x194)](_0x3bfcb1));return _0xcc1891;}function getV(_0x33e5b3,_0x4431ad){const _0x5ac429=_0x3f55,_0xfe0cdc=_0x33e5b3*Math['sin'](Cesium$7[_0x5ac429(0x17e)]['toRadians'](_0x4431ad));return _0xfe0cdc;}function getSpeed(_0x46cccd,_0x1e8388){const _0x21faf8=_0x3f55,_0x1d8376=Math['sqrt'](Math[_0x21faf8(0x114)](_0x46cccd,0x2)+Math['pow'](_0x1e8388,0x2));return _0x1d8376;}function getDirection(_0x5f507f,_0x47b392){const _0x7435ed=_0x3f55;let _0xb95526=Cesium$7[_0x7435ed(0x17e)]['toDegrees'](Math['atan2'](_0x47b392,_0x5f507f));return _0xb95526+=_0xb95526<0x0?0x168:0x0,_0xb95526;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x5b3c34){const _0x133a9e=_0x3f55;this[_0x133a9e(0x135)]=_0x5b3c34['commandType'],this['geometry']=_0x5b3c34[_0x133a9e(0x149)],this['attributeLocations']=_0x5b3c34['attributeLocations'],this[_0x133a9e(0xd3)]=_0x5b3c34[_0x133a9e(0xd3)],this['uniformMap']=_0x5b3c34[_0x133a9e(0x11c)],this['vertexShaderSource']=_0x5b3c34['vertexShaderSource'],this['fragmentShaderSource']=_0x5b3c34['fragmentShaderSource'],this[_0x133a9e(0xa5)]=_0x5b3c34['rawRenderState'],this['framebuffer']=_0x5b3c34['framebuffer'],this['outputTexture']=_0x5b3c34[_0x133a9e(0x14d)],this['autoClear']=_0x5b3c34[_0x133a9e(0xd8)]??![],this['preExecute']=_0x5b3c34['preExecute'],this[_0x133a9e(0x182)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x133a9e(0xcd)],'pass':Cesium$6[_0x133a9e(0x117)]['OPAQUE']}));}['createCommand'](_0x1a6320){const _0x41ddab=_0x3f55;switch(this['commandType']){case'Draw':{const _0x5008ae=Cesium$6['VertexArray'][_0x41ddab(0x138)]({'context':_0x1a6320,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x41ddab(0x195)]['STATIC_DRAW']}),_0x19c563=Cesium$6['ShaderProgram'][_0x41ddab(0x15f)]({'context':_0x1a6320,'attributeLocations':this[_0x41ddab(0xe4)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x41ddab(0x155)]}),_0x1890be=Cesium$6['RenderState'][_0x41ddab(0x15f)](this[_0x41ddab(0xa5)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x19c563,'vertexArray':_0x5008ae,'modelMatrix':Cesium$6['Matrix4'][_0x41ddab(0x15a)],'renderState':_0x1890be,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x41ddab(0x117)]['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x41ddab(0x146):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0x5be5a1(0xd7)](_0x3cffbd,_0x383d41){this['geometry']=_0x383d41;const _0x4fc6df=Cesium$6['VertexArray']['fromGeometry']({'context':_0x3cffbd,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x4fc6df;}['update'](_0x318892){const _0x3356c9=_0x5be5a1;if(!this['show'])return;if(_0x318892['mode']!==Cesium$6['SceneMode'][_0x3356c9(0x12c)])return;!Cesium$6[_0x3356c9(0x16c)](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x318892[_0x3356c9(0x123)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0x3356c9(0x16c)](this[_0x3356c9(0xee)])&&_0x318892['commandList']['push'](this['clearCommand']),_0x318892[_0x3356c9(0xbe)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x1fde12=_0x5be5a1;if(this['clearCommand']){var _0x4cb4c9,_0x4552e9;(_0x4cb4c9=this[_0x1fde12(0xee)])!==null&&_0x4cb4c9!==void 0x0&&_0x4cb4c9['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x4552e9=this['clearCommand'])!==null&&_0x4552e9!==void 0x0&&_0x4552e9['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x1fde12(0xba)](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute'][_0x1fde12(0x11a)]&&this['commandToExecute']['vertexArray'][_0x1fde12(0xba)](),this[_0x1fde12(0x147)]['shaderProgram']&&this['commandToExecute']['shaderProgram'][_0x1fde12(0xba)](),delete this[_0x1fde12(0x147)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x12d380=function(){const _0x1e173d=_0x3f55,_0xf6bd0a=new Cesium$5[(_0x1e173d(0x116))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0xf6bd0a;},_0x4a9ee0=function(_0x2533da,_0x2d214c){if(Cesium$5['defined'](_0x2d214c)){const _0x4bae48={};_0x4bae48['arrayBufferView']=_0x2d214c,_0x2533da['source']=_0x4bae48;}const _0xae0603=new Cesium$5['Texture'](_0x2533da);return _0xae0603;},_0x27f47e=function(_0x41b2b4,_0x4ac017,_0x501288){const _0x56a379=new Cesium$5['Framebuffer']({'context':_0x41b2b4,'colorTextures':[_0x4ac017],'depthTexture':_0x501288});return _0x56a379;},_0x1d98e7=function(_0x5ab391){const _0x50573d=_0x3f55,_0x1896d2=!![],_0x38e720=![],_0x1c922f={'viewport':_0x5ab391[_0x50573d(0x127)],'depthTest':_0x5ab391[_0x50573d(0x17a)],'depthMask':_0x5ab391['depthMask'],'blending':_0x5ab391['blending']},_0x26af5d=Cesium$5[_0x50573d(0xd5)]['getDefaultRenderState'](_0x1896d2,_0x38e720,_0x1c922f);return _0x26af5d;},_0x3a93b4=function(_0xed380a){const _0x51714c=_0x3f55,_0x4337e2={},_0x288544=Cesium$5['Math']['mod'](_0xed380a['west'],Cesium$5[_0x51714c(0x17e)][_0x51714c(0x150)]),_0x3b73fb=Cesium$5['Math']['mod'](_0xed380a[_0x51714c(0x145)],Cesium$5['Math']['TWO_PI']),_0x291029=_0xed380a[_0x51714c(0x172)];let _0x3f1f19,_0x763804;_0x291029>Cesium$5[_0x51714c(0x17e)]['THREE_PI_OVER_TWO']?(_0x3f1f19=0x0,_0x763804=Cesium$5['Math']['TWO_PI']):_0x3b73fb-_0x288544<_0x291029?(_0x3f1f19=_0x288544,_0x763804=_0x288544+_0x291029):(_0x3f1f19=_0x288544,_0x763804=_0x3b73fb);_0x4337e2['lon']={'min':Cesium$5['Math']['toDegrees'](_0x3f1f19),'max':Cesium$5['Math'][_0x51714c(0x115)](_0x763804)};const _0x9eaa75=_0xed380a['south'],_0x587ecb=_0xed380a['north'],_0x41f3a5=_0xed380a['height'],_0x275659=_0x41f3a5>Cesium$5[_0x51714c(0x17e)]['PI']/0xc?_0x41f3a5/0x2:0x0;let _0x3570a5=Cesium$5[_0x51714c(0x17e)]['clampToLatitudeRange'](_0x9eaa75-_0x275659),_0x564fcd=Cesium$5['Math']['clampToLatitudeRange'](_0x587ecb+_0x275659);return _0x3570a5<-Cesium$5[_0x51714c(0x17e)]['PI_OVER_THREE']&&(_0x3570a5=-Cesium$5['Math']['PI_OVER_TWO']),_0x564fcd>Cesium$5['Math']['PI_OVER_THREE']&&(_0x564fcd=Cesium$5['Math']['PI_OVER_TWO']),_0x4337e2[_0x51714c(0x137)]={'min':Cesium$5['Math']['toDegrees'](_0x3570a5),'max':Cesium$5['Math'][_0x51714c(0x115)](_0x564fcd)},_0x4337e2;};return{'getFullscreenQuad':_0x12d380,'createTexture':_0x4a9ee0,'createFramebuffer':_0x27f47e,'createRawRenderState':_0x1d98e7,'viewRectangleToLonLatRange':_0x3a93b4};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag=_0x5be5a1(0x100),fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x5be5a1(0xe8),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x4e9df4,_0x48fb86,_0xdbd6d8,_0x41b6f2,_0x56db18){this['createRenderingTextures'](_0x4e9df4,_0x48fb86,_0xdbd6d8['colors']),this['createRenderingFramebuffers'](_0x4e9df4),this['createRenderingPrimitives'](_0x4e9df4,_0xdbd6d8,_0x41b6f2,_0x56db18);}['createRenderingTextures'](_0x5129b2,_0x1acf52,_0x2f4c55){const _0x29856b=_0x5be5a1,_0x431afa={'context':_0x5129b2,'width':_0x5129b2['drawingBufferWidth'],'height':_0x5129b2['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x29856b(0x110)][_0x29856b(0xaf)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x29856b(0xdb)]},_0x34ed3={'context':_0x5129b2,'width':_0x5129b2['drawingBufferWidth'],'height':_0x5129b2[_0x29856b(0x16e)],'pixelFormat':Cesium$4[_0x29856b(0x110)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x3f79e1=_0x2f4c55[_0x29856b(0xa7)],_0x469e02=new Float32Array(_0x3f79e1*0x3);for(let _0x591ae9=0x0;_0x591ae9<_0x3f79e1;_0x591ae9++){const _0x562507=Cesium$4['Color'][_0x29856b(0xc0)](_0x2f4c55[_0x591ae9]);_0x469e02[0x3*_0x591ae9]=_0x562507['red'],_0x469e02[0x3*_0x591ae9+0x1]=_0x562507[_0x29856b(0xf7)],_0x469e02[0x3*_0x591ae9+0x2]=_0x562507['blue'];}const _0x57f8f6={'context':_0x5129b2,'width':_0x3f79e1,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x29856b(0xdd)],'pixelDatatype':Cesium$4[_0x29856b(0xd9)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x29856b(0x18c)]['LINEAR']})};this[_0x29856b(0xe2)]={'segmentsColor':Util['createTexture'](_0x431afa),'segmentsDepth':Util['createTexture'](_0x34ed3),'currentTrailsColor':Util[_0x29856b(0x19d)](_0x431afa),'currentTrailsDepth':Util['createTexture'](_0x34ed3),'nextTrailsColor':Util[_0x29856b(0x19d)](_0x431afa),'nextTrailsDepth':Util[_0x29856b(0x19d)](_0x34ed3),'colorTable':Util['createTexture'](_0x57f8f6,_0x469e02)};}['createRenderingFramebuffers'](_0x2d180b){const _0x40ef7d=_0x5be5a1;this['framebuffers']={'segments':Util['createFramebuffer'](_0x2d180b,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x2d180b,this['textures']['currentTrailsColor'],this['textures'][_0x40ef7d(0xfe)]),'nextTrails':Util['createFramebuffer'](_0x2d180b,this['textures']['nextTrailsColor'],this[_0x40ef7d(0xe2)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x440553){const _0x24a8e7=_0x5be5a1,_0x4f204e=0x4;let _0x14ff12=[];for(let _0x361f6c=0x0;_0x361f6c<_0x440553[_0x24a8e7(0x19c)];_0x361f6c++){for(let _0x2fc11b=0x0;_0x2fc11b<_0x440553['particlesTextureSize'];_0x2fc11b++){for(let _0x3ede89=0x0;_0x3ede89<_0x4f204e;_0x3ede89++){_0x14ff12['push'](_0x361f6c/_0x440553['particlesTextureSize']),_0x14ff12[_0x24a8e7(0xf0)](_0x2fc11b/_0x440553[_0x24a8e7(0x19c)]);}}}_0x14ff12=new Float32Array(_0x14ff12);let _0x40c284=[];const _0x2dc5f8=[-0x1,0x1],_0x18d66d=[-0x1,0x1];for(let _0x491902=0x0;_0x491902<_0x440553['maxParticles'];_0x491902++){for(let _0x3a04f4=0x0;_0x3a04f4<_0x4f204e/0x2;_0x3a04f4++){for(let _0x131a0b=0x0;_0x131a0b<_0x4f204e/0x2;_0x131a0b++){_0x40c284['push'](_0x2dc5f8[_0x3a04f4]),_0x40c284['push'](_0x18d66d[_0x131a0b]),_0x40c284['push'](0x0);}}}_0x40c284=new Float32Array(_0x40c284);const _0x56dbfb=0x6*_0x440553['maxParticles'],_0x3b8d24=new Uint32Array(_0x56dbfb);for(let _0x4956e3=0x0,_0x4e64e6=0x0,_0x5707f2=0x0;_0x4956e3<_0x440553[_0x24a8e7(0x140)];_0x4956e3++){_0x3b8d24[_0x4e64e6++]=_0x5707f2+0x0,_0x3b8d24[_0x4e64e6++]=_0x5707f2+0x1,_0x3b8d24[_0x4e64e6++]=_0x5707f2+0x2,_0x3b8d24[_0x4e64e6++]=_0x5707f2+0x2,_0x3b8d24[_0x4e64e6++]=_0x5707f2+0x1,_0x3b8d24[_0x4e64e6++]=_0x5707f2+0x3,_0x5707f2+=0x4;}const _0x57047e=new Cesium$4[(_0x24a8e7(0x116))]({'attributes':new Cesium$4[(_0x24a8e7(0x160))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x24a8e7(0x104)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x14ff12}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x24a8e7(0x104)][_0x24a8e7(0xfa)],'componentsPerAttribute':0x3,'values':_0x40c284})}),'indices':_0x3b8d24});return _0x57047e;}[_0x5be5a1(0xed)](_0x3fbeeb,_0x10239a,_0x585e45,_0x121d59){const _0x39678a=_0x5be5a1,_0x350375=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x10239a),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x1a8b4b=_0x3f55;return _0x121d59['particlesTextures'][_0x1a8b4b(0x181)];},'postProcessingPosition':function(){return _0x121d59['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0xc2cd8f=_0x3f55;return _0x121d59[_0xc2cd8f(0x10d)]['postProcessingSpeed'];},'colorTable':function(){return _0x350375['textures']['colorTable'];},'aspect':function(){const _0x258be4=_0x3f55;return _0x3fbeeb['drawingBufferWidth']/_0x3fbeeb[_0x258be4(0x16e)];},'pixelSize':function(){return _0x585e45['pixelSize'];},'lineWidth':function(){const _0x196df5=_0x3f55;return _0x10239a[_0x196df5(0x179)];},'particleHeight':function(){const _0x4a524a=_0x3f55;return _0x10239a[_0x4a524a(0x177)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x39678a(0x13c)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x39678a(0x10a)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x39678a(0x125)](),'primitiveType':Cesium$4['PrimitiveType'][_0x39678a(0x159)],'uniformMap':{'segmentsColorTexture':function(){return _0x350375['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x6e3c90=_0x39678a;return _0x350375['textures'][_0x6e3c90(0x190)];},'currentTrailsColor':function(){const _0x3dc62f=_0x39678a;return _0x350375['framebuffers'][_0x3dc62f(0x139)][_0x3dc62f(0x156)](0x0);},'trailsDepthTexture':function(){const _0x1a808d=_0x39678a;return _0x350375['framebuffers'][_0x1a808d(0x139)]['depthTexture'];},'fadeOpacity':function(){return _0x10239a['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x39678a(0xec))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x39678a(0xc2)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x39678a(0xf8)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x39678a(0x10a)][_0x39678a(0x158)],'autoClear':!![],'preExecute':function(){const _0x2e7975=_0x39678a,_0x232089=_0x350375['framebuffers']['currentTrails'];_0x350375[_0x2e7975(0x10a)][_0x2e7975(0x139)]=_0x350375['framebuffers']['nextTrails'],_0x350375['framebuffers']['nextTrails']=_0x232089,_0x350375['primitives']['trails']['commandToExecute']['framebuffer']=_0x350375['framebuffers']['nextTrails'],_0x350375['primitives']['trails']['clearCommand']['framebuffer']=_0x350375['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x39678a(0xb4),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x39678a(0xbb)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x1782f0=_0x39678a;return _0x350375[_0x1782f0(0x10a)][_0x1782f0(0x158)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x350375['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x39678a(0xec))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x39678a(0xc2)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x5be5a1(0xe0);const Cesium$3=mars3d__namespace[_0x5be5a1(0x122)];class ParticlesComputing{constructor(_0x33bf35,_0xa790be,_0x435531,_0x8702b){this['data']=_0xa790be,this['createWindTextures'](_0x33bf35,_0xa790be),this['createParticlesTextures'](_0x33bf35,_0x435531,_0x8702b),this['createComputingPrimitives'](_0xa790be,_0x435531,_0x8702b);}['createWindTextures'](_0x28073c,_0x53d2fd){const _0x3a79a5=_0x5be5a1,_0x22303b={'context':_0x28073c,'width':_0x53d2fd['dimensions']['lon'],'height':_0x53d2fd[_0x3a79a5(0x14b)][_0x3a79a5(0x137)]*(_0x53d2fd['dimensions']['lev']||0x1),'pixelFormat':Cesium$3[_0x3a79a5(0x110)]['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x3a79a5(0xfa)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x3a79a5(0x15c)]['NEAREST'],'magnificationFilter':Cesium$3[_0x3a79a5(0x18c)]['NEAREST']})};this[_0x3a79a5(0x184)]={'U':Util[_0x3a79a5(0x19d)](_0x22303b,_0x53d2fd['U']['array']),'V':Util['createTexture'](_0x22303b,_0x53d2fd['V']['array'])};}['createParticlesTextures'](_0x8c84e1,_0x23a822,_0x2869a1){const _0x5ecaea=_0x5be5a1,_0x59f6e4={'context':_0x8c84e1,'width':_0x23a822['particlesTextureSize'],'height':_0x23a822['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x5ecaea(0xaf)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x5ecaea(0x15c)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x13b87a=this['randomizeParticles'](_0x23a822['maxParticles'],_0x2869a1),_0x3a84fa=new Float32Array(0x4*_0x23a822['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x59f6e4),'currentParticlesPosition':Util['createTexture'](_0x59f6e4,_0x13b87a),'nextParticlesPosition':Util[_0x5ecaea(0x19d)](_0x59f6e4,_0x13b87a),'currentParticlesSpeed':Util['createTexture'](_0x59f6e4,_0x3a84fa),'nextParticlesSpeed':Util['createTexture'](_0x59f6e4,_0x3a84fa),'postProcessingPosition':Util['createTexture'](_0x59f6e4,_0x13b87a),'postProcessingSpeed':Util[_0x5ecaea(0x19d)](_0x59f6e4,_0x3a84fa)};}['randomizeParticles'](_0x3d1d15,_0x31568b){const _0x7f92ec=_0x5be5a1,_0x3d36ff=new Float32Array(0x4*_0x3d1d15);for(let _0x2a5822=0x0;_0x2a5822<_0x3d1d15;_0x2a5822++){_0x3d36ff[0x4*_0x2a5822]=Cesium$3[_0x7f92ec(0x17e)]['randomBetween'](_0x31568b[_0x7f92ec(0x148)]['x'],_0x31568b[_0x7f92ec(0x148)]['y']),_0x3d36ff[0x4*_0x2a5822+0x1]=Cesium$3['Math'][_0x7f92ec(0x153)](_0x31568b['latRange']['x'],_0x31568b['latRange']['y']),_0x3d36ff[0x4*_0x2a5822+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this[_0x7f92ec(0x13d)][_0x7f92ec(0x143)]['max']),_0x3d36ff[0x4*_0x2a5822+0x3]=0x0;}return _0x3d36ff;}['destroyParticlesTextures'](){const _0x1593e8=_0x5be5a1;Object['keys'](this[_0x1593e8(0x10d)])['forEach'](_0x43f57e=>{this['particlesTextures'][_0x43f57e]['destroy']();});}['createComputingPrimitives'](_0x592e57,_0xa47db2,_0x37a3a2){const _0x1676ce=_0x5be5a1,_0x1f9a9c=new Cesium$3[(_0x1676ce(0xb8))](_0x592e57['dimensions'][_0x1676ce(0x175)],_0x592e57['dimensions']['lat'],_0x592e57[_0x1676ce(0x14b)]['lev']),_0x90d3d7=new Cesium$3[(_0x1676ce(0xb8))](_0x592e57[_0x1676ce(0x175)]['min'],_0x592e57['lat'][_0x1676ce(0x186)],_0x592e57[_0x1676ce(0x143)]['min']),_0x5745a4=new Cesium$3['Cartesian3'](_0x592e57[_0x1676ce(0x175)][_0x1676ce(0x151)],_0x592e57[_0x1676ce(0x137)]['max'],_0x592e57['lev']['max']),_0x3ef678=new Cesium$3[(_0x1676ce(0xb8))]((_0x5745a4['x']-_0x90d3d7['x'])/(_0x1f9a9c['x']-0x1),(_0x5745a4['y']-_0x90d3d7['y'])/(_0x1f9a9c['y']-0x1),_0x1f9a9c['z']>0x1?(_0x5745a4['z']-_0x90d3d7['z'])/(_0x1f9a9c['z']-0x1):0x1),_0x1f371f=new Cesium$3['Cartesian2'](_0x592e57['U'][_0x1676ce(0x186)],_0x592e57['U']['max']),_0x16a195=new Cesium$3['Cartesian2'](_0x592e57['V']['min'],_0x592e57['V']['max']),_0x46b733=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x42688e=_0x1676ce;return _0x46b733[_0x42688e(0x184)]['U'];},'V':function(){return _0x46b733['windTextures']['V'];},'currentParticlesPosition':function(){const _0x444287=_0x1676ce;return _0x46b733['particlesTextures'][_0x444287(0x181)];},'dimension':function(){return _0x1f9a9c;},'minimum':function(){return _0x90d3d7;},'maximum':function(){return _0x5745a4;},'interval':function(){return _0x3ef678;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x1676ce(0x10d)]['particlesWind'],'preExecute':function(){const _0x5b5354=_0x1676ce;_0x46b733[_0x5b5354(0x12a)]['getWind']['commandToExecute']['outputTexture']=_0x46b733[_0x5b5354(0x10d)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x46b733['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x997397=_0x1676ce;return _0x46b733[_0x997397(0x10d)]['particlesWind'];},'uSpeedRange':function(){return _0x1f371f;},'vSpeedRange':function(){return _0x16a195;},'pixelSize':function(){return _0x37a3a2['pixelSize'];},'speedFactor':function(){return _0xa47db2['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x1676ce(0xec))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x3adb2c=_0x1676ce,_0x185c5b=_0x46b733['particlesTextures']['currentParticlesSpeed'];_0x46b733['particlesTextures']['currentParticlesSpeed']=_0x46b733['particlesTextures']['postProcessingSpeed'],_0x46b733['particlesTextures']['postProcessingSpeed']=_0x185c5b,_0x46b733['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x46b733[_0x3adb2c(0x10d)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x5c0487=_0x1676ce;return _0x46b733['particlesTextures'][_0x5c0487(0x181)];},'currentParticlesSpeed':function(){return _0x46b733['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x2f1be8=_0x1676ce,_0x5a55fb=_0x46b733['particlesTextures']['currentParticlesPosition'];_0x46b733['particlesTextures'][_0x2f1be8(0x181)]=_0x46b733['particlesTextures']['postProcessingPosition'],_0x46b733['particlesTextures']['postProcessingPosition']=_0x5a55fb,_0x46b733['primitives'][_0x2f1be8(0x17c)]['commandToExecute']['outputTexture']=_0x46b733[_0x2f1be8(0x10d)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x46b733['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x46b733['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x37a3a2['lonRange'];},'latRange':function(){return _0x37a3a2['latRange'];},'randomCoefficient':function(){const _0x46c050=_0x1676ce,_0x2f7dba=Math[_0x46c050(0xd1)]();return _0x2f7dba;},'dropRate':function(){const _0x5950d9=_0x1676ce;return _0xa47db2[_0x5950d9(0xe3)];},'dropRateBump':function(){return _0xa47db2['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0xf3ca08=_0x1676ce;_0x46b733[_0xf3ca08(0x12a)][_0xf3ca08(0xb5)]['commandToExecute']['outputTexture']=_0x46b733['particlesTextures'][_0xf3ca08(0xb5)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x1676ce(0x146),'uniformMap':{'postProcessingPosition':function(){return _0x46b733['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x5ecbb0=_0x1676ce;return _0x46b733['particlesTextures'][_0x5ecbb0(0x18e)];}},'fragmentShaderSource':new Cesium$3[(_0x1676ce(0xec))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x1a5498=_0x1676ce;_0x46b733['primitives'][_0x1a5498(0x134)]['commandToExecute']['outputTexture']=_0x46b733[_0x1a5498(0x10d)][_0x1a5498(0x134)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x189835,_0x5d56a5,_0x4fb856,_0x2caa97){const _0x5e2f72=_0x5be5a1;this[_0x5e2f72(0x123)]=_0x189835,_0x5d56a5={..._0x5d56a5},_0x5d56a5['udata']&&_0x5d56a5['vdata']&&(_0x5d56a5['dimensions']={},_0x5d56a5['dimensions']['lon']=_0x5d56a5[_0x5e2f72(0x129)],_0x5d56a5[_0x5e2f72(0x14b)]['lat']=_0x5d56a5['rows'],_0x5d56a5['dimensions']['lev']=_0x5d56a5[_0x5e2f72(0x143)]||0x1,_0x5d56a5['lon']={},_0x5d56a5['lon']['min']=_0x5d56a5[_0x5e2f72(0xbd)],_0x5d56a5['lon']['max']=_0x5d56a5['xmax'],_0x5d56a5[_0x5e2f72(0x137)]={},_0x5d56a5['lat']['min']=_0x5d56a5['ymin'],_0x5d56a5['lat'][_0x5e2f72(0x151)]=_0x5d56a5['ymax'],_0x5d56a5['lev']={},_0x5d56a5[_0x5e2f72(0x143)]['min']=_0x5d56a5[_0x5e2f72(0x165)]??0x1,_0x5d56a5['lev']['max']=_0x5d56a5[_0x5e2f72(0xc4)]??0x1,_0x5d56a5['U']={},_0x5d56a5['U'][_0x5e2f72(0xa8)]=new Float32Array(_0x5d56a5[_0x5e2f72(0x152)]),_0x5d56a5['U'][_0x5e2f72(0x186)]=_0x5d56a5[_0x5e2f72(0x121)]??Math['min'](..._0x5d56a5['udata']),_0x5d56a5['U']['max']=_0x5d56a5['umax']??Math['max'](..._0x5d56a5['udata']),_0x5d56a5['V']={},_0x5d56a5['V'][_0x5e2f72(0xa8)]=new Float32Array(_0x5d56a5['vdata']),_0x5d56a5['V'][_0x5e2f72(0x186)]=_0x5d56a5[_0x5e2f72(0x18a)]??Math['min'](..._0x5d56a5[_0x5e2f72(0x185)]),_0x5d56a5['V']['max']=_0x5d56a5['vmax']??Math[_0x5e2f72(0x151)](..._0x5d56a5[_0x5e2f72(0x185)])),this['data']=_0x5d56a5,this['options']=_0x4fb856,this['viewerParameters']=_0x2caa97,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x5e2f72(0x170)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x5e2f72(0x170)],this[_0x5e2f72(0x13f)],this['particlesComputing']);}['canvasResize'](_0x234eaa){const _0x486220=_0x5be5a1;this[_0x486220(0x14e)]['destroyParticlesTextures'](),Object['keys'](this[_0x486220(0x14e)]['windTextures'])['forEach'](_0x571533=>{this['particlesComputing']['windTextures'][_0x571533]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x486220(0xba)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x1cad85=>{this['particlesRendering']['framebuffers'][_0x1cad85]['destroy']();}),this['context']=_0x234eaa,this[_0x486220(0x14e)]=new ParticlesComputing(this[_0x486220(0x123)],this[_0x486220(0x13d)],this[_0x486220(0x170)],this['viewerParameters']),this[_0x486220(0x15d)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x5be5a1(0xe6)](){const _0x32dc6d=_0x5be5a1,_0x168560=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x32dc6d(0x117)][_0x32dc6d(0x113)]});Object['keys'](this[_0x32dc6d(0x15d)]['framebuffers'])['forEach'](_0x20e70a=>{_0x168560['framebuffer']=this['particlesRendering']['framebuffers'][_0x20e70a],_0x168560['execute'](this['context']);});}[_0x5be5a1(0x17b)](_0x4cc537){const _0x20cf6a=_0x5be5a1;this[_0x20cf6a(0xe6)](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this[_0x20cf6a(0x123)],this['options'],this[_0x20cf6a(0x13f)]);if(_0x4cc537){const _0x50beb0=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering'][_0x20cf6a(0x12a)]['segments'][_0x20cf6a(0x149)]=_0x50beb0;const _0x34f5b3=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x20cf6a(0x123)],'geometry':_0x50beb0,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x20cf6a(0x15b)]});this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x34f5b3;}}[_0x5be5a1(0xfc)](_0x9f9e71){const _0x3134ba=_0x5be5a1;let _0x4d6690=![];this[_0x3134ba(0x170)]['maxParticles']!==_0x9f9e71['maxParticles']&&(_0x4d6690=!![]),Object['keys'](_0x9f9e71)[_0x3134ba(0xab)](_0x1ca576=>{this['options'][_0x1ca576]=_0x9f9e71[_0x1ca576];}),this[_0x3134ba(0x17b)](_0x4d6690);}['applyViewerParameters'](_0x362d21){const _0x348af2=_0x5be5a1;Object[_0x348af2(0xfb)](_0x362d21)['forEach'](_0x1ad15e=>{this['viewerParameters'][_0x1ad15e]=_0x362d21[_0x1ad15e];}),this['refreshParticles'](![]);}[_0x5be5a1(0xba)](){const _0x16fe41=_0x5be5a1;clearTimeout(this[_0x16fe41(0x10c)]),this[_0x16fe41(0x14e)][_0x16fe41(0xf5)](),Object[_0x16fe41(0xfb)](this['particlesComputing'][_0x16fe41(0x184)])['forEach'](_0x341d06=>{const _0x5d2e8f=_0x16fe41;this['particlesComputing']['windTextures'][_0x341d06][_0x5d2e8f(0xba)]();}),this['particlesRendering'][_0x16fe41(0xe2)]['colorTable']['destroy'](),Object[_0x16fe41(0xfb)](this['particlesRendering']['framebuffers'])[_0x16fe41(0xab)](_0x1483a7=>{this['particlesRendering']['framebuffers'][_0x1483a7]['destroy']();});for(const _0x38c630 in this){delete this[_0x38c630];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x5be5a1(0x15e)][_0x5be5a1(0xc3)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};function _0x3f55(_0x522572,_0x574180){const _0x50576e=_0x5057();return _0x3f55=function(_0x3f55b8,_0x5438e8){_0x3f55b8=_0x3f55b8-0xa5;let _0x171b63=_0x50576e[_0x3f55b8];return _0x171b63;},_0x3f55(_0x522572,_0x574180);}class WindLayer extends BaseLayer$1{constructor(_0x8ecbd7={}){const _0x4f27b6=_0x5be5a1;_0x8ecbd7={...DEF_OPTIONS,..._0x8ecbd7},super(_0x8ecbd7),this[_0x4f27b6(0x10e)](_0x8ecbd7);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x2b84b3){const _0x59b116=_0x5be5a1;this[_0x59b116(0x101)](_0x2b84b3);}get['colors'](){return this['options']['colors'];}set['colors'](_0x1c9370){const _0x35125a=_0x5be5a1;this['options'][_0x35125a(0x169)]=_0x1c9370,this[_0x35125a(0x107)]&&this['particleSystem'][_0x35125a(0xfc)]({'colors':_0x1c9370}),this['resize']();}[_0x5be5a1(0x167)](){}['_addedHook'](){const _0x3bb198=_0x5be5a1;this['scene']=this['_map'][_0x3bb198(0xf1)],this[_0x3bb198(0xc8)]=this['_map']['camera'],this[_0x3bb198(0x12a)]=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x3bb198(0xf1)]['primitives'][_0x3bb198(0x173)](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x3bb198(0x183))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1[_0x3bb198(0xb8)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize'][_0x3bb198(0xac)](this),![]),this[_0x3bb198(0x13b)]=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x3bb198(0xb3)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x3bb198(0x106)],this),this[_0x3bb198(0xb3)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x3bb198(0x101)](this[_0x3bb198(0x14a)]);}[_0x5be5a1(0x164)](){const _0x555e5a=_0x5be5a1;window['removeEventListener']('resize',this['resize']),this['_map']['off'](mars3d__namespace[_0x555e5a(0xc6)]['preRender'],this['_onMap_preRenderEvent'],this),this[_0x555e5a(0xb3)]['off'](mars3d__namespace['EventType']['wheel'],this[_0x555e5a(0xd2)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x555e5a(0xda)](mars3d__namespace['EventType']['mouseUp'],this[_0x555e5a(0x106)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x555e5a(0x12a)][_0x555e5a(0x197)](),this['_map']['scene']['primitives']['remove'](this['primitives']);}[_0x5be5a1(0xbc)](){const _0x2f690f=_0x5be5a1;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this[_0x2f690f(0xe7)],this);}['_onMap_preRenderEvent'](_0x36ba92){const _0x41f364=_0x5be5a1;this[_0x41f364(0x107)]['canvasResize'](this['scene']['context']),this[_0x41f364(0x176)](),this['primitives']['show']=!![];}[_0x5be5a1(0xd2)](_0x5c9761){const _0x33ee57=_0x5be5a1;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this[_0x33ee57(0x12a)][_0x33ee57(0x182)]=![],this[_0x33ee57(0x19b)]=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x5be5a1(0x14c)](_0x53c306){const _0x24aabd=_0x5be5a1;this[_0x24aabd(0x13b)]=!![];}['_onMouseMoveEvent'](_0x211b84){const _0xc9e9e3=_0x5be5a1;if(!this['show']||!this['particleSystem'])return;this[_0xc9e9e3(0x13b)]&&(this['primitives']['show']=![],this[_0xc9e9e3(0x19a)]=!![]);}['_onMouseUpEvent'](_0x3df520){const _0x55008b=_0x5be5a1;if(!this['show']||!this['particleSystem'])return;this[_0x55008b(0x13b)]&&this[_0x55008b(0x19a)]&&this[_0x55008b(0xea)](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x38a838=_0x5be5a1;if(!this['_map']||!this['show'])return;this[_0x38a838(0xb6)](),this['particleSystem']['applyViewerParameters'](this[_0x38a838(0x13f)]),this[_0x38a838(0x12a)]['show']=!![];}['setData'](_0x36f0cf){const _0x21001f=_0x5be5a1;this['_data']=_0x36f0cf,this['particleSystem']&&this['particleSystem'][_0x21001f(0xba)](),this['particleSystem']=new ParticleSystem(this['scene'][_0x21001f(0x123)],_0x36f0cf,this[_0x21001f(0x192)](),this[_0x21001f(0x13f)]),this['addPrimitives']();}['_setOptionsHook'](_0x2a9e1a,_0x5d17b0){if(_0x2a9e1a)for(const _0x229133 in _0x2a9e1a){this[_0x229133]=_0x2a9e1a[_0x229133];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x5be5a1(0x192)](){const _0x524258=_0x5be5a1,_0x3c0dd9=Math['ceil'](Math[_0x524258(0x13a)](this['particlesNumber']));return this[_0x524258(0xc7)]=_0x3c0dd9*_0x3c0dd9,{'particlesTextureSize':_0x3c0dd9,'maxParticles':this[_0x524258(0xc7)],'particleHeight':this[_0x524258(0x120)],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this[_0x524258(0xa6)],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x524258(0x169)]};}['addPrimitives'](){const _0x4d9490=_0x5be5a1;this['primitives']['add'](this['particleSystem'][_0x4d9490(0x14e)][_0x4d9490(0x12a)]['getWind']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x4d9490(0xf6)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x4d9490(0x12a)]['updatePosition']),this['primitives'][_0x4d9490(0x173)](this['particleSystem']['particlesComputing']['primitives'][_0x4d9490(0xb5)]),this['primitives'][_0x4d9490(0x173)](this[_0x4d9490(0x107)][_0x4d9490(0x14e)]['primitives'][_0x4d9490(0x134)]),this[_0x4d9490(0x12a)]['add'](this[_0x4d9490(0x107)]['particlesRendering']['primitives'][_0x4d9490(0xd0)]),this['primitives'][_0x4d9490(0x173)](this['particleSystem']['particlesRendering'][_0x4d9490(0x12a)][_0x4d9490(0x133)]),this[_0x4d9490(0x12a)][_0x4d9490(0x173)](this[_0x4d9490(0x107)][_0x4d9490(0x15d)]['primitives']['screen']);}['updateViewerParameters'](){const _0x24cda9=_0x5be5a1;let _0x4f8378=this['camera']['computeViewRectangle'](this['scene']['globe'][_0x24cda9(0x128)]);if(!_0x4f8378){const _0x44c7a1=this[_0x24cda9(0xb3)]['getExtent']();_0x4f8378=Cesium$1[_0x24cda9(0x16f)]['fromDegrees'](_0x44c7a1['xmin'],_0x44c7a1[_0x24cda9(0xcc)],_0x44c7a1['xmax'],_0x44c7a1['ymax']);}const _0x4fd130=Util['viewRectangleToLonLatRange'](_0x4f8378);this['viewerParameters']['lonRange']['x']=_0x4fd130['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x4fd130['lon']['max'],this['viewerParameters']['latRange']['x']=_0x4fd130['lat'][_0x24cda9(0x186)],this['viewerParameters'][_0x24cda9(0x174)]['y']=_0x4fd130['lat']['max'];const _0x2f929a=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x2f929a>0x0&&(this['viewerParameters'][_0x24cda9(0x132)]=_0x2f929a);}}mars3d__namespace['LayerUtil']['register'](_0x5be5a1(0x171),WindLayer),mars3d__namespace['layer'][_0x5be5a1(0xcf)]=WindLayer;function _0x5057(){const _0x4d4c49=['Rectangle','options','wind','width','add','latRange','lon','addPrimitives','particleHeight','lng','lineWidth','depthTest','refreshParticles','updatePosition','DomUtil','Math','236818nooJJZ','grid','currentParticlesPosition','show','Cartesian2','windTextures','vdata','min','16cXLKSO','positionWC','42HSCTxk','vmin','clientHeight','TextureMagnificationFilter','_tomap','nextParticlesSpeed','_speedRate','segmentsDepth','setDate','getOptions','_canrefresh','toRadians','BufferUsage','maxAge','removeAll','pointerEvents','requestAnimationFrame','mouse_move','refreshTimer','particlesTextureSize','createTexture','rawRenderState','dropRateBump','length','array','style','mars3d-canvasWind','forEach','bind','_updateIng2','_updateIng','RGBA','3782352RdsxXm','_pointerEvents','round','_map','Draw','postProcessingPosition','updateViewerParameters','getContext','Cartesian3','pointer-events','destroy','PrimitiveType','resize','xmin','commandList','reverseY','fromCssColorString','worker','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','BaseLayer','levmax','beginPath','EventType','particlesNumber','camera','1040140wEkySh','speedRate','canvas','ymin','framebuffer','clear','WindLayer','segments','random','_onMapWhellEvent','primitiveType','zIndex','Appearance','getUVByXY','setGeometry','autoClear','PixelDatatype','off','UNSIGNED_BYTE','mouseMove','RGB','0px','init','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','_drawLines','textures','dropRate','attributeLocations','CanvasWindField','clearFramebuffers','_onMap_preRenderEvent','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','strokeStyle','redraw','wgs84ToWindowCoordinates','ShaderSource','createRenderingPrimitives','clearCommand','isInExtent','push','scene','color','unbindEvent','hidden','destroyParticlesTextures','updateSpeed','green','DepthFunction','__esModule','FLOAT','keys','setOptions','ymax','currentTrailsDepth','_calc_speedRate','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','setData','none','particles','ComponentDatatype','default','_onMouseUpEvent','particleSystem','defineProperty','cancelAnimationFrame','framebuffers','lighter','canrefresh','particlesTextures','_setOptionsHook','18246250rrgXDQ','PixelFormat','rows','postMessage','OPAQUE','pow','toDegrees','Geometry','Pass','frameRate','_createCanvas','vertexArray','_onMouseMoveEvent','uniformMap','clientWidth','4KVqzxA','globalAlpha','fixedHeight','umin','Cesium','context','canvasContext','getFullscreenQuad','getUVByPoint','viewport','ellipsoid','cols','primitives','8035134pzAbFK','SCENE3D','_bilinearInterpolation','5309973kIUPPd','tlat','getParticles','windField','pixelSize','trails','postProcessingSpeed','commandType','41045qcRKJM','lat','fromGeometry','currentTrails','sqrt','mouse_down','createRawRenderState','data','tlng','viewerParameters','maxParticles','xmax','globalCompositeOperation','lev','now','east','Compute','commandToExecute','lonRange','geometry','_data','dimensions','_onMouseDownEvent','outputTexture','particlesComputing','height','TWO_PI','max','udata','randomBetween','wheel','fragmentShaderSource','getColorTexture','visible','nextTrails','TRIANGLES','IDENTITY','STATIC_DRAW','TextureMinificationFilter','particlesRendering','layer','fromCache','GeometryAttributes','visibility','age','initWorker','_removedHook','levmin','WindUtil','_mountedHook','SceneMode','colors','_maxAge','windData','defined','canvasHeight','drawingBufferHeight'];_0x5057=function(){return _0x4d4c49;};return _0x5057();}class CanvasParticle{constructor(){const _0x1d8536=_0x5be5a1;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x1d8536(0x12f)]=null,this['age']=null;}[_0x5be5a1(0xba)](){for(const _0x3abd29 in this){delete this[_0x3abd29];}}}class CanvasWindField{constructor(_0x4debf2){this['setOptions'](_0x4debf2);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x12768a){const _0x1ea608=_0x5be5a1;this['_speedRate']=(0x64-(_0x12768a>0x63?0x63:_0x12768a))*0x64,this[_0x1ea608(0xff)]=[(this[_0x1ea608(0x141)]-this[_0x1ea608(0xbd)])/this[_0x1ea608(0x18f)],(this['ymax']-this[_0x1ea608(0xcc)])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x29f9cf){const _0x1e023b=_0x5be5a1;this[_0x1e023b(0x16a)]=_0x29f9cf;}[_0x5be5a1(0xfc)](_0x2649c8){const _0x20a240=_0x5be5a1;this['options']=_0x2649c8,this[_0x20a240(0x196)]=_0x2649c8[_0x20a240(0x196)]||0x78,this[_0x20a240(0xca)]=_0x2649c8['speedRate']||0x32,this['particles']=[];const _0x352326=_0x2649c8[_0x20a240(0xc7)]||0x1000;for(let _0x32276a=0x0;_0x32276a<_0x352326;_0x32276a++){const _0x4471e1=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x4471e1);}}['setDate'](_0x5152b9){const _0x3089bb=_0x5be5a1;this[_0x3089bb(0x111)]=_0x5152b9['rows'],this[_0x3089bb(0x129)]=_0x5152b9['cols'],this['xmin']=_0x5152b9['xmin'],this[_0x3089bb(0x141)]=_0x5152b9['xmax'],this[_0x3089bb(0xcc)]=_0x5152b9['ymin'],this['ymax']=_0x5152b9[_0x3089bb(0xfd)],this['grid']=[];const _0x2152cc=_0x5152b9['udata'],_0x2cbf8d=_0x5152b9['vdata'];let _0x2df60d=![];_0x2152cc[_0x3089bb(0xa7)]===this[_0x3089bb(0x111)]&&_0x2152cc[0x0][_0x3089bb(0xa7)]===this['cols']&&(_0x2df60d=!![]);let _0xaee819=0x0,_0x597b15=null,_0x40bab0=null;for(let _0x33bb9c=0x0;_0x33bb9c<this['rows'];_0x33bb9c++){_0x597b15=[];for(let _0x353745=0x0;_0x353745<this['cols'];_0x353745++,_0xaee819++){_0x2df60d?_0x40bab0=this['_calcUV'](_0x2152cc[_0x33bb9c][_0x353745],_0x2cbf8d[_0x33bb9c][_0x353745]):_0x40bab0=this['_calcUV'](_0x2152cc[_0xaee819],_0x2cbf8d[_0xaee819]),_0x597b15['push'](_0x40bab0);}this['grid']['push'](_0x597b15);}this['options'][_0x3089bb(0xbf)]&&this['grid']['reverse']();}['clear'](){const _0xdb0d32=_0x5be5a1;delete this[_0xdb0d32(0x111)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this[_0xdb0d32(0xfd)],delete this[_0xdb0d32(0x180)],delete this[_0xdb0d32(0x103)];}['toGridXY'](_0x50331e,_0x99b64e){const _0x33cfa2=_0x5be5a1,_0x1b446c=(_0x50331e-this[_0x33cfa2(0xbd)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x111ca6=(this[_0x33cfa2(0xfd)]-_0x99b64e)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x1b446c,_0x111ca6];}['getUVByXY'](_0x4dbfbc,_0x2eb6c9){const _0x1bbc8e=_0x5be5a1;if(_0x4dbfbc<0x0||_0x4dbfbc>=this['cols']||_0x2eb6c9>=this['rows'])return[0x0,0x0,0x0];const _0x20cdf8=Math['floor'](_0x4dbfbc),_0x243716=Math['floor'](_0x2eb6c9);if(_0x20cdf8===_0x4dbfbc&&_0x243716===_0x2eb6c9)return this[_0x1bbc8e(0x180)][_0x2eb6c9][_0x4dbfbc];const _0x2fe5fe=_0x20cdf8+0x1,_0x1785a7=_0x243716+0x1,_0x58afe9=this['getUVByXY'](_0x20cdf8,_0x243716),_0x1b9784=this['getUVByXY'](_0x2fe5fe,_0x243716),_0x45c655=this[_0x1bbc8e(0xd6)](_0x20cdf8,_0x1785a7),_0x328de1=this[_0x1bbc8e(0xd6)](_0x2fe5fe,_0x1785a7);let _0x4b3abf=null;try{_0x4b3abf=this['_bilinearInterpolation'](_0x4dbfbc-_0x20cdf8,_0x2eb6c9-_0x243716,_0x58afe9,_0x1b9784,_0x45c655,_0x328de1);}catch(_0x3c0b09){console['log'](_0x4dbfbc,_0x2eb6c9);}return _0x4b3abf;}[_0x5be5a1(0x12d)](_0x51ad76,_0x33169f,_0xdb8b1a,_0x2f2710,_0x358978,_0x334feb){const _0x68bf1d=0x1-_0x51ad76,_0x5a2790=0x1-_0x33169f,_0x1667a2=_0x68bf1d*_0x5a2790,_0x3d2a35=_0x51ad76*_0x5a2790,_0x299e31=_0x68bf1d*_0x33169f,_0xb2494a=_0x51ad76*_0x33169f,_0x1cacb4=_0xdb8b1a[0x0]*_0x1667a2+_0x2f2710[0x0]*_0x3d2a35+_0x358978[0x0]*_0x299e31+_0x334feb[0x0]*_0xb2494a,_0x16bc0c=_0xdb8b1a[0x1]*_0x1667a2+_0x2f2710[0x1]*_0x3d2a35+_0x358978[0x1]*_0x299e31+_0x334feb[0x1]*_0xb2494a;return this['_calcUV'](_0x1cacb4,_0x16bc0c);}['_calcUV'](_0x2c882a,_0x255ea8){return[+_0x2c882a,+_0x255ea8,Math['sqrt'](_0x2c882a*_0x2c882a+_0x255ea8*_0x255ea8)];}[_0x5be5a1(0x126)](_0x3eda2f,_0x4fe837){if(!this['isInExtent'](_0x3eda2f,_0x4fe837))return null;const _0x154921=this['toGridXY'](_0x3eda2f,_0x4fe837),_0x10c39a=this['getUVByXY'](_0x154921[0x0],_0x154921[0x1]);return _0x10c39a;}[_0x5be5a1(0xef)](_0x5aedbc,_0x379efe){const _0x36245a=_0x5be5a1;return _0x5aedbc>=this[_0x36245a(0xbd)]&&_0x5aedbc<=this[_0x36245a(0x141)]&&_0x379efe>=this['ymin']&&_0x379efe<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x39a240=fRandomByfloat(this['xmin'],this['xmax']),_0x3db0fa=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x3db0fa,'lng':_0x39a240};}['getParticles'](){const _0x37278b=_0x5be5a1;let _0xd66bd9,_0x543369,_0x2ffe63;for(let _0xf6cb39=0x0,_0x38a309=this['particles'][_0x37278b(0xa7)];_0xf6cb39<_0x38a309;_0xf6cb39++){let _0x5fee28=this[_0x37278b(0x103)][_0xf6cb39];_0x5fee28['age']<=0x0&&(_0x5fee28=this['_randomParticle'](_0x5fee28));if(_0x5fee28['age']>0x0){const _0x405551=_0x5fee28['tlng'],_0x575ae1=_0x5fee28['tlat'];_0x2ffe63=this[_0x37278b(0x126)](_0x405551,_0x575ae1),_0x2ffe63?(_0xd66bd9=_0x405551+this['_calc_speedRate'][0x0]*_0x2ffe63[0x0],_0x543369=_0x575ae1+this['_calc_speedRate'][0x1]*_0x2ffe63[0x1],_0x5fee28[_0x37278b(0x178)]=_0x405551,_0x5fee28['lat']=_0x575ae1,_0x5fee28['tlng']=_0xd66bd9,_0x5fee28['tlat']=_0x543369,_0x5fee28['age']--):_0x5fee28[_0x37278b(0x162)]=0x0;}}return this['particles'];}['_randomParticle'](_0xd1fc47){const _0x3ee112=_0x5be5a1;let _0x13c7e2,_0x2ca7f5;for(let _0x541773=0x0;_0x541773<0x1e;_0x541773++){_0x13c7e2=this['getRandomLatLng'](),_0x2ca7f5=this['getUVByPoint'](_0x13c7e2['lng'],_0x13c7e2['lat']);if(_0x2ca7f5&&_0x2ca7f5[0x2]>0x0)break;}if(!_0x2ca7f5)return _0xd1fc47;const _0x5561a4=_0x13c7e2['lng']+this['_calc_speedRate'][0x0]*_0x2ca7f5[0x0],_0x2f2287=_0x13c7e2['lat']+this[_0x3ee112(0xff)][0x1]*_0x2ca7f5[0x1];return _0xd1fc47['lng']=_0x13c7e2['lng'],_0xd1fc47[_0x3ee112(0x137)]=_0x13c7e2['lat'],_0xd1fc47['tlng']=_0x5561a4,_0xd1fc47['tlat']=_0x2f2287,_0xd1fc47['age']=Math[_0x3ee112(0xb2)](Math['random']()*this['maxAge']),_0xd1fc47;}['destroy'](){for(const _0x21c2a4 in this){delete this[_0x21c2a4];}}}function fRandomByfloat(_0x4c9c8c,_0x566a6c){const _0x122681=_0x5be5a1;return _0x4c9c8c+Math[_0x122681(0xd1)]()*(_0x566a6c-_0x4c9c8c);}const Cesium=mars3d__namespace[_0x5be5a1(0x122)],BaseLayer=mars3d__namespace[_0x5be5a1(0x15e)][_0x5be5a1(0xc3)];class CanvasWindLayer extends BaseLayer{constructor(_0x29c52f={}){const _0x491640=_0x5be5a1;super(_0x29c52f),this['_setOptionsHook'](_0x29c52f),this[_0x491640(0xcb)]=null;}['_setOptionsHook'](_0x3cfd0a,_0x52fb9d){const _0x2caa2b=_0x5be5a1;this['frameTime']=0x3e8/(_0x3cfd0a[_0x2caa2b(0x118)]||0xa),this[_0x2caa2b(0xb1)]=this['options']['pointerEvents']??![],this[_0x2caa2b(0xf2)]=_0x3cfd0a['color']||'#ffffff',this['lineWidth']=_0x3cfd0a['lineWidth']||0x1,this['fixedHeight']=_0x3cfd0a['fixedHeight']??0x0,this['reverseY']=_0x3cfd0a['reverseY']??![],this['windField']&&this['windField'][_0x2caa2b(0xfc)](_0x3cfd0a);}get['layer'](){const _0x53c5bf=_0x5be5a1;return this[_0x53c5bf(0xcb)];}get['canvasWidth'](){const _0x3e5e70=_0x5be5a1;return this['_map'][_0x3e5e70(0xf1)][_0x3e5e70(0xcb)]['clientWidth'];}get['canvasHeight'](){const _0x44c3c7=_0x5be5a1;return this[_0x44c3c7(0xb3)]['scene'][_0x44c3c7(0xcb)][_0x44c3c7(0x18b)];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x5ae7cf){const _0x29765f=_0x5be5a1;this['_pointerEvents']=_0x5ae7cf;if(!this['canvas'])return;_0x5ae7cf?this[_0x29765f(0xcb)][_0x29765f(0xa9)][_0x29765f(0xb9)]='all':this[_0x29765f(0xcb)]['style']['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set[_0x5be5a1(0xc7)](_0x2f14cc){const _0xd14c9f=_0x5be5a1;this['options'][_0xd14c9f(0xc7)]=_0x2f14cc,clearTimeout(this[_0xd14c9f(0x193)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x5be5a1(0xca)](){const _0x5f2cbc=_0x5be5a1;return this[_0x5f2cbc(0x170)]['speedRate'];}set['speedRate'](_0x1cf1cf){this['options']['speedRate']=_0x1cf1cf,this['windField']&&(this['windField']['speedRate']=_0x1cf1cf);}get['maxAge'](){const _0x58638c=_0x5be5a1;return this['options'][_0x58638c(0x196)];}set[_0x5be5a1(0x196)](_0xe23cc1){this['options']['maxAge']=_0xe23cc1,this['windField']&&(this['windField']['maxAge']=_0xe23cc1);}get['data'](){return this['windData'];}set['data'](_0xc5769d){this['setData'](_0xc5769d);}['_showHook'](_0x57f4f9){const _0x557c9c=_0x5be5a1;_0x57f4f9?this['_addedHook']():(this['windData']&&(this['options'][_0x557c9c(0x13d)]=this[_0x557c9c(0x16b)]),this[_0x557c9c(0x164)]());}['_mountedHook'](){const _0x1aaab1=_0x5be5a1;this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this[_0x1aaab1(0x170)]);}['_addedHook'](){const _0x5f540f=_0x5be5a1;this['canvas']=this[_0x5f540f(0x119)](),this[_0x5f540f(0x124)]=this[_0x5f540f(0xcb)][_0x5f540f(0xb7)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0x5f540f(0x170)]['data']&&this[_0x5f540f(0x101)](this['options']['data']);}[_0x5be5a1(0x164)](){const _0x376e53=_0x5be5a1;this[_0x376e53(0xce)](),this[_0x376e53(0xf3)](),this[_0x376e53(0xcb)]&&(this['_map']['container']['removeChild'](this[_0x376e53(0xcb)]),delete this['canvas']);}['_createCanvas'](){const _0x2e263b=_0x5be5a1,_0x5a8644=mars3d__namespace[_0x2e263b(0x17d)]['create']('canvas',_0x2e263b(0xaa),this['_map']['container']);return _0x5a8644[_0x2e263b(0xa9)]['position']='absolute',_0x5a8644[_0x2e263b(0xa9)]['top']='0px',_0x5a8644['style']['left']=_0x2e263b(0xde),_0x5a8644[_0x2e263b(0xa9)]['width']=this[_0x2e263b(0xb3)]['scene']['canvas']['clientWidth']+'px',_0x5a8644['style'][_0x2e263b(0x14f)]=this['_map']['scene']['canvas']['clientHeight']+'px',_0x5a8644[_0x2e263b(0xa9)][_0x2e263b(0x198)]=this['_pointerEvents']?'auto':_0x2e263b(0x102),_0x5a8644[_0x2e263b(0xa9)][_0x2e263b(0xd4)]=this['options']['zIndex']??0x9,_0x5a8644[_0x2e263b(0x172)]=this['_map']['scene']['canvas']['clientWidth'],_0x5a8644['height']=this[_0x2e263b(0xb3)]['scene']['canvas']['clientHeight'],_0x5a8644;}['resize'](){const _0x364191=_0x5be5a1;this['canvas']&&(this['canvas']['style'][_0x364191(0x172)]=this['_map']['scene']['canvas'][_0x364191(0x11d)]+'px',this['canvas']['style'][_0x364191(0x14f)]=this['_map'][_0x364191(0xf1)]['canvas']['clientHeight']+'px',this[_0x364191(0xcb)]['width']=this['_map'][_0x364191(0xf1)]['canvas']['clientWidth'],this['canvas']['height']=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x2fbc6b=_0x5be5a1,_0x41cba0=this;let _0x4ae8b8=Date[_0x2fbc6b(0x144)]();(function _0x5e2c69(){const _0x4f695e=_0x2fbc6b;_0x41cba0['animateFrame']=window[_0x4f695e(0x199)](_0x5e2c69);if(_0x41cba0[_0x4f695e(0x182)]&&_0x41cba0['windField']){const _0x395ec1=Date['now'](),_0x3cb7c4=_0x395ec1-_0x4ae8b8;_0x3cb7c4>_0x41cba0['frameTime']&&(_0x4ae8b8=_0x395ec1-_0x3cb7c4%_0x41cba0['frameTime'],_0x41cba0['update']());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x2fbc6b(0x19a)]=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType'][_0x2fbc6b(0x154)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x2fbc6b(0x14c)],this),this[_0x2fbc6b(0xb3)]['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x2fbc6b(0x106)],this)));}['unbindEvent'](){const _0x35525c=_0x5be5a1;window[_0x35525c(0x109)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this[_0x35525c(0x170)]['mouseHidden']&&(this[_0x35525c(0xb3)]['off'](mars3d__namespace['EventType'][_0x35525c(0x154)],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x35525c(0xc6)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x35525c(0xda)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x35525c(0xb3)]['off'](mars3d__namespace['EventType'][_0x35525c(0xdc)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x235472){const _0x52891c=_0x5be5a1;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x52891c(0xcb)])return;this['canvas']['style'][_0x52891c(0x161)]=_0x52891c(0xf4),this['refreshTimer']=setTimeout(()=>{const _0x2cfb73=_0x52891c;if(!this[_0x2cfb73(0x182)])return;this[_0x2cfb73(0xea)](),this['canvas']['style']['visibility']=_0x2cfb73(0x157);},0xc8);}['_onMouseDownEvent'](_0x478826){const _0x349217=_0x5be5a1;this[_0x349217(0x13b)]=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x349217(0xdc)],this[_0x349217(0x11b)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x1e84ed){const _0x36791f=_0x5be5a1;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this['canvas'][_0x36791f(0xa9)]['visibility']='hidden',this[_0x36791f(0x19a)]=!![]);}[_0x5be5a1(0x106)](_0x2a0b99){const _0x2945f2=_0x5be5a1;if(!this[_0x2945f2(0x182)]||!this[_0x2945f2(0xcb)])return;this['_map']['off'](mars3d__namespace[_0x2945f2(0xc6)]['mouseMove'],this[_0x2945f2(0x11b)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x2945f2(0xcb)][_0x2945f2(0xa9)]['visibility']='visible',this[_0x2945f2(0x13b)]=![],this[_0x2945f2(0x19a)]=![];}['setData'](_0x542009){const _0x4ef2cf=_0x5be5a1;this['clear'](),this['windData']=_0x542009,this[_0x4ef2cf(0x131)]['setDate'](_0x542009),this['redraw']();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}['update'](){const _0x19dd71=_0x5be5a1;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this[_0x19dd71(0x131)]['update']();else{const _0x58a4f4=this['windField'][_0x19dd71(0x130)]();this[_0x19dd71(0xe1)](_0x58a4f4);}this[_0x19dd71(0xae)]=![];}['_drawLines'](_0x178229){const _0x11c217=_0x5be5a1;this[_0x11c217(0x124)]['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x11c217(0x16d)]),this[_0x11c217(0x124)][_0x11c217(0x142)]=_0x11c217(0x10b),this[_0x11c217(0x124)][_0x11c217(0x11f)]=0.9,this[_0x11c217(0x124)][_0x11c217(0xc5)](),this['canvasContext']['lineWidth']=this[_0x11c217(0x179)],this['canvasContext'][_0x11c217(0xe9)]=this[_0x11c217(0xf2)];const _0x755394=this[_0x11c217(0xb3)]['scene']['mode']!==Cesium['SceneMode'][_0x11c217(0x12c)],_0x4c7be3=this['canvasWidth']*0.25;for(let _0x462cc5=0x0,_0x30504e=_0x178229[_0x11c217(0xa7)];_0x462cc5<_0x30504e;_0x462cc5++){const _0x2d4e3c=_0x178229[_0x462cc5],_0x512f8d=this[_0x11c217(0x18d)](_0x2d4e3c[_0x11c217(0x178)],_0x2d4e3c['lat'],_0x2d4e3c),_0x382054=this['_tomap'](_0x2d4e3c[_0x11c217(0x13e)],_0x2d4e3c['tlat'],_0x2d4e3c);if(!_0x512f8d||!_0x382054)continue;if(_0x755394&&Math['abs'](_0x512f8d[0x0]-_0x382054[0x0])>=_0x4c7be3)continue;this['canvasContext']['moveTo'](_0x512f8d[0x0],_0x512f8d[0x1]),this['canvasContext']['lineTo'](_0x382054[0x0],_0x382054[0x1]);}this[_0x11c217(0x124)]['stroke']();}[_0x5be5a1(0x18d)](_0x2d5a7a,_0x4c8ef4,_0x51a09f){const _0x2f6dee=_0x5be5a1,_0xc7d2e5=Cesium['Cartesian3']['fromDegrees'](_0x2d5a7a,_0x4c8ef4,this['fixedHeight']),_0x185c87=this['_map'][_0x2f6dee(0xf1)];if(_0x185c87['mode']===Cesium[_0x2f6dee(0x168)]['SCENE3D']){const _0x59228f=new Cesium['EllipsoidalOccluder'](_0x185c87['globe'][_0x2f6dee(0x128)],_0x185c87['camera'][_0x2f6dee(0x188)]),_0x4b74a1=_0x59228f['isPointVisible'](_0xc7d2e5);if(!_0x4b74a1)return _0x51a09f['age']=0x0,null;}const _0x1d9770=Cesium['SceneTransforms'][_0x2f6dee(0xeb)](this[_0x2f6dee(0xb3)][_0x2f6dee(0xf1)],_0xc7d2e5);return _0x1d9770?[_0x1d9770['x'],_0x1d9770['y']]:null;}['clear'](){const _0x4e365a=_0x5be5a1;this['windField'][_0x4e365a(0xce)](),delete this[_0x4e365a(0x16b)];}[_0x5be5a1(0x163)](){const _0x347a6f=_0x5be5a1;this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=_0x3d07d6=>{const _0x96fb5c=_0x3f55;this['_drawLines'](_0x3d07d6['data'][_0x96fb5c(0x103)]),this[_0x96fb5c(0xad)]=![];},this['windField']={'init':_0x276ede=>{const _0x179db6=_0x3f55;this['worker'][_0x179db6(0x112)]({'type':_0x179db6(0xdf),'options':_0x276ede});},'setOptions':_0x2a7456=>{this['worker']['postMessage']({'type':'setOptions','options':_0x2a7456});},'setDate':_0xffede6=>{const _0x1a709b=_0x3f55;this['worker']['postMessage']({'type':_0x1a709b(0x191),'data':_0xffede6});},'update':()=>{const _0x43e483=_0x3f55;if(this['_updateIng2'])return;this[_0x43e483(0xad)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x1daab6=_0x3f55;this[_0x1daab6(0xc1)][_0x1daab6(0x112)]({'type':'clear'});}},this['windField'][_0x347a6f(0xdf)](this[_0x347a6f(0x170)]);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x5be5a1(0x15e)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x5be5a1(0xe5)]=CanvasWindField,mars3d__namespace[_0x5be5a1(0x166)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x5be5a1(0x166)]=WindUtil,Object['defineProperty'](exports,_0x5be5a1(0xf9),{'value':!![]});
}));
