/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.5
 * 编译日期：2023-09-08 17:15:37
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x5e1b93=_0x47cb;(function(_0xfe2d61,_0x21d839){const _0x215848=_0x47cb,_0x674eb=_0xfe2d61();while(!![]){try{const _0x24c7e0=-parseInt(_0x215848(0x17b))/0x1+-parseInt(_0x215848(0x1c5))/0x2+-parseInt(_0x215848(0x18e))/0x3+-parseInt(_0x215848(0x1bd))/0x4*(-parseInt(_0x215848(0x15d))/0x5)+parseInt(_0x215848(0x1b8))/0x6*(-parseInt(_0x215848(0x1f8))/0x7)+-parseInt(_0x215848(0x1f9))/0x8+parseInt(_0x215848(0x1d6))/0x9;if(_0x24c7e0===_0x21d839)break;else _0x674eb['push'](_0x674eb['shift']());}catch(_0x37ef7d){_0x674eb['push'](_0x674eb['shift']());}}}(_0x3979,0x9dfb4));function _interopNamespace(_0x44ec97){const _0x1c0b18=_0x47cb;if(_0x44ec97&&_0x44ec97[_0x1c0b18(0x19c)])return _0x44ec97;var _0x4a2856=Object[_0x1c0b18(0x1a0)](null);return _0x44ec97&&Object['keys'](_0x44ec97)['forEach'](function(_0x4f42d6){if(_0x4f42d6!=='default'){var _0x244e48=Object['getOwnPropertyDescriptor'](_0x44ec97,_0x4f42d6);Object['defineProperty'](_0x4a2856,_0x4f42d6,_0x244e48['get']?_0x244e48:{'enumerable':!![],'get':function(){return _0x44ec97[_0x4f42d6];}});}}),_0x4a2856[_0x1c0b18(0x1ce)]=_0x44ec97,_0x4a2856;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x23f06f,_0x172127){const _0x1f5929=_0x23f06f*Math['cos'](Cesium$7['Math']['toRadians'](_0x172127));return _0x1f5929;}function getV(_0x2dc5ea,_0x2d3137){const _0x4697e8=_0x47cb,_0x33e3e3=_0x2dc5ea*Math[_0x4697e8(0x1de)](Cesium$7[_0x4697e8(0x172)]['toRadians'](_0x2d3137));return _0x33e3e3;}function getSpeed(_0x78b55,_0x17fdf8){const _0x430384=_0x47cb,_0x1140d7=Math['sqrt'](Math['pow'](_0x78b55,0x2)+Math[_0x430384(0x1df)](_0x17fdf8,0x2));return _0x1140d7;}function getDirection(_0x542541,_0x33ce5c){const _0xf65a9f=_0x47cb;let _0x5a0090=Cesium$7[_0xf65a9f(0x172)]['toDegrees'](Math['atan2'](_0x33ce5c,_0x542541));return _0x5a0090+=_0x5a0090<0x0?0x168:0x0,_0x5a0090;}function _0x3979(){const _0x555f23=['Geometry','updatePosition','execute','BaseLayer','scene','Cartesian2','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','width','zIndex','vdata','Color','forEach','5ZALCER','grid','createRawRenderState','height','particlesRendering','latRange','colorTable','globeBoundingSphere','wgs84ToWindowCoordinates','Cesium','geometry','viewerParameters','mouseUp','wind','_setOptionsHook','segments','_onMap_preRenderEvent','postProcessingPosition','commandToExecute','ComponentDatatype','postProcessingSpeed','Math','windData','keys','camera','reverseY','blending','tlng','getUVByPoint','currentTrailsColor','861861Ibknko','canvasResize','lonRange','TextureMinificationFilter','maxAge','postMessage','pointerEvents','vmin','BoundingSphere','mod','pointer-events','PI_OVER_TWO','Compute','colors','vertexShaderSource','SCENE3D','xmax','removeEventListener','_showHook','330057dkfmqZ','_removedHook','rows','windField','ellipsoid','particlesTextures','ceil','textures','mode','particlesWind','SceneMode','add','defineProperty','FLOAT','__esModule','mouse_down','dimensions','currentTrails','create','destroyParticlesTextures','createParticlesTextures','frameTime','tlat','length','_speedRate','EventType','dropRate','clear','drawingBufferWidth','xmin','umax','createTexture','_onMouseUpEvent','nextParticlesSpeed','round','preRender','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','autoClear','speedRate','max','fromCache','fromDegrees','4873890ZrLnFi','_calcUV','particles','lev','fixedHeight','1394924HxcjcR','udata','primitiveType','RenderState','visibility','createSegmentsGeometry','ymax','depthTexture','344182QrkiZU','destroy','show','initWorker','randomizeParticles','wheel','mouseHidden','windTextures','ComputeCommand','default','worker','PixelDatatype','mouse_move','maxParticles','register','PixelFormat','addPrimitives','20707101yEzZSO','setOptions','updateSpeed','Sampler','sqrt','clearCommand','ClearCommand','canvas','sin','pow','framebuffers','TRIANGLES','lng','vmax','lat','particlesComputing','_calc_speedRate','removeChild','preExecute','particlesNumber','Framebuffer','OPAQUE','top','_createCanvas','outputTexture','fillRect','particlesTextureSize','nextTrails','attributeLocations','_pointerEvents','getOptions','destroyObject','strokeStyle','RGBA','7ooTmSx','369136iQlltp','currentTrailsDepth','push','nextTrailsDepth','TWO_PI','abs','canvasContext','min','update','_mountedHook','red','getUVByXY','array','layer','resize','createFramebuffer','WindLayer','removeAll','currentParticlesPosition','_map','options','_colorRamp','mouseMove','random','NEAREST','refreshTimer','mars3d-canvasWind','framebuffer','ymin','_tomap','LayerUtil','clientHeight','off','ShaderSource','WindUtil','shaderProgram','currentParticlesSpeed','defined','hidden','_onMouseMoveEvent','viewRectangleToLonLatRange','_onMouseDownEvent','_canrefresh','speedFactor','UNSIGNED_INT','toGridXY','_maxAge','PrimitiveType','data','none','vertexArray','south','setData','primitives','GeometryAttribute','addEventListener','_onMapWhellEvent','style','particleSystem','DomUtil','context','uniformMap','lineWidth','VertexArray','age','redraw','DISABLE_GL_POSITION_LOG_DEPTH','isInExtent','lon','fragmentShaderSource','Cartesian3','moveTo','all','commandType'];_0x3979=function(){return _0x555f23;};return _0x3979();}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x5245c6){const _0x43695a=_0x47cb;this['commandType']=_0x5245c6[_0x43695a(0x242)],this['geometry']=_0x5245c6['geometry'],this[_0x43695a(0x1f2)]=_0x5245c6['attributeLocations'],this['primitiveType']=_0x5245c6['primitiveType'],this[_0x43695a(0x236)]=_0x5245c6['uniformMap'],this[_0x43695a(0x189)]=_0x5245c6['vertexShaderSource'],this[_0x43695a(0x23e)]=_0x5245c6['fragmentShaderSource'],this['rawRenderState']=_0x5245c6['rawRenderState'],this['framebuffer']=_0x5245c6[_0x43695a(0x214)],this['outputTexture']=_0x5245c6[_0x43695a(0x1ee)],this[_0x43695a(0x1b3)]=_0x5245c6['autoClear']??![],this['preExecute']=_0x5245c6['preExecute'],this['show']=!![],this[_0x43695a(0x16f)]=undefined,this['clearCommand']=undefined,this[_0x43695a(0x1b3)]&&(this['clearCommand']=new Cesium$6[(_0x43695a(0x1dc))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x43695a(0x214)],'pass':Cesium$6['Pass'][_0x43695a(0x1eb)]}));}['createCommand'](_0x42b6f1){const _0xbd90c7=_0x47cb;switch(this['commandType']){case'Draw':{const _0xc800cb=Cesium$6[_0xbd90c7(0x238)]['fromGeometry']({'context':_0x42b6f1,'geometry':this[_0xbd90c7(0x167)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x79e9d8=Cesium$6['ShaderProgram'][_0xbd90c7(0x1b6)]({'context':_0x42b6f1,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x52a73f=Cesium$6[_0xbd90c7(0x1c0)][_0xbd90c7(0x1b6)](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0xbd90c7(0x1bf)],'shaderProgram':_0x79e9d8,'vertexArray':_0xc800cb,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x52a73f,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0xbd90c7(0x1eb)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0xbd90c7(0x1cd))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x5f1995,_0x249b2f){const _0x395080=_0x47cb;this['geometry']=_0x249b2f;const _0x149920=Cesium$6['VertexArray']['fromGeometry']({'context':_0x5f1995,'geometry':this['geometry'],'attributeLocations':this[_0x395080(0x1f2)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute'][_0x395080(0x22b)]=_0x149920;}['update'](_0x3c3b5f){const _0x4da276=_0x47cb;if(!this[_0x4da276(0x1c7)])return;if(_0x3c3b5f['mode']!==Cesium$6['SceneMode'][_0x4da276(0x18a)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x3c3b5f['context'])),Cesium$6[_0x4da276(0x21e)](this['preExecute'])&&this[_0x4da276(0x1e8)](),Cesium$6[_0x4da276(0x21e)](this[_0x4da276(0x1db)])&&_0x3c3b5f['commandList']['push'](this['clearCommand']),_0x3c3b5f['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x37729b=_0x47cb;if(this['clearCommand']){var _0x5e1a3d,_0x11e936;(_0x5e1a3d=this['clearCommand'])!==null&&_0x5e1a3d!==void 0x0&&_0x5e1a3d['vertexArray']&&this['clearCommand'][_0x37729b(0x22b)]['destroy'](),(_0x11e936=this['clearCommand'])!==null&&_0x11e936!==void 0x0&&_0x11e936['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute'][_0x37729b(0x22b)]['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute'][_0x37729b(0x21c)][_0x37729b(0x1c6)](),delete this['commandToExecute']),Cesium$6[_0x37729b(0x1f5)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x50a358=function(){const _0x2800b1=_0x47cb,_0x2f3856=new Cesium$5[(_0x2800b1(0x151))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x2800b1(0x19b)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x2800b1(0x22f))]({'componentDatatype':Cesium$5['ComponentDatatype'][_0x2800b1(0x19b)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x2f3856;},_0x740eee=function(_0x1b3045,_0x3ba9b7){const _0x5e0a2d=_0x47cb;if(Cesium$5[_0x5e0a2d(0x21e)](_0x3ba9b7)){const _0x1ff454={};_0x1ff454['arrayBufferView']=_0x3ba9b7,_0x1b3045['source']=_0x1ff454;}const _0x282001=new Cesium$5['Texture'](_0x1b3045);return _0x282001;},_0x15a40a=function(_0x54e8c3,_0x2989c9,_0x562d20){const _0x1133f2=_0x47cb,_0x54efe8=new Cesium$5[(_0x1133f2(0x1ea))]({'context':_0x54e8c3,'colorTextures':[_0x2989c9],'depthTexture':_0x562d20});return _0x54efe8;},_0x526c6b=function(_0x3ff58e){const _0x385a76=_0x47cb,_0x191a26=!![],_0x2f6272=![],_0x5701a0={'viewport':_0x3ff58e['viewport'],'depthTest':_0x3ff58e['depthTest'],'depthMask':_0x3ff58e['depthMask'],'blending':_0x3ff58e[_0x385a76(0x177)]},_0x5e813c=Cesium$5['Appearance']['getDefaultRenderState'](_0x191a26,_0x2f6272,_0x5701a0);return _0x5e813c;},_0x2ee23a=function(_0x43449d){const _0x127442=_0x47cb,_0x29d7b9={},_0x1f70e2=Cesium$5['Math'][_0x127442(0x184)](_0x43449d['west'],Cesium$5[_0x127442(0x172)][_0x127442(0x1fd)]),_0x103ef2=Cesium$5[_0x127442(0x172)]['mod'](_0x43449d['east'],Cesium$5['Math']['TWO_PI']),_0x1d1507=_0x43449d['width'];let _0x38fde3,_0x1a358f;_0x1d1507>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x38fde3=0x0,_0x1a358f=Cesium$5[_0x127442(0x172)]['TWO_PI']):_0x103ef2-_0x1f70e2<_0x1d1507?(_0x38fde3=_0x1f70e2,_0x1a358f=_0x1f70e2+_0x1d1507):(_0x38fde3=_0x1f70e2,_0x1a358f=_0x103ef2);_0x29d7b9[_0x127442(0x23d)]={'min':Cesium$5['Math']['toDegrees'](_0x38fde3),'max':Cesium$5['Math']['toDegrees'](_0x1a358f)};const _0x4b204a=_0x43449d[_0x127442(0x22c)],_0xe7f7d=_0x43449d['north'],_0x54ed93=_0x43449d[_0x127442(0x160)],_0x1cbdc3=_0x54ed93>Cesium$5['Math']['PI']/0xc?_0x54ed93/0x2:0x0;let _0x306c96=Cesium$5['Math']['clampToLatitudeRange'](_0x4b204a-_0x1cbdc3),_0x1a2d65=Cesium$5[_0x127442(0x172)]['clampToLatitudeRange'](_0xe7f7d+_0x1cbdc3);return _0x306c96<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x306c96=-Cesium$5['Math'][_0x127442(0x186)]),_0x1a2d65>Cesium$5['Math']['PI_OVER_THREE']&&(_0x1a2d65=Cesium$5[_0x127442(0x172)]['PI_OVER_TWO']),_0x29d7b9['lat']={'min':Cesium$5['Math']['toDegrees'](_0x306c96),'max':Cesium$5[_0x127442(0x172)]['toDegrees'](_0x1a2d65)},_0x29d7b9;};return{'getFullscreenQuad':_0x50a358,'createTexture':_0x740eee,'createFramebuffer':_0x15a40a,'createRawRenderState':_0x526c6b,'viewRectangleToLonLatRange':_0x2ee23a};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x5e1b93(0x157);const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x52370d,_0x14af9c,_0x1bb219,_0x43b328,_0x43e888){this['createRenderingTextures'](_0x52370d,_0x14af9c,_0x1bb219['colors']),this['createRenderingFramebuffers'](_0x52370d),this['createRenderingPrimitives'](_0x52370d,_0x1bb219,_0x43b328,_0x43e888);}['createRenderingTextures'](_0x254278,_0x5de3d0,_0x55f86a){const _0x20ea18=_0x5e1b93,_0x3b4f2c={'context':_0x254278,'width':_0x254278['drawingBufferWidth'],'height':_0x254278['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x20ea18(0x1f7)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x73c9df={'context':_0x254278,'width':_0x254278[_0x20ea18(0x1aa)],'height':_0x254278['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x20ea18(0x1d4)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x20ea18(0x225)]},_0x2749f7=_0x55f86a[_0x20ea18(0x1a5)],_0x1a6082=new Float32Array(_0x2749f7*0x3);for(let _0x55dac7=0x0;_0x55dac7<_0x2749f7;_0x55dac7++){const _0x5a0957=Cesium$4[_0x20ea18(0x15b)]['fromCssColorString'](_0x55f86a[_0x55dac7]);_0x1a6082[0x3*_0x55dac7]=_0x5a0957[_0x20ea18(0x203)],_0x1a6082[0x3*_0x55dac7+0x1]=_0x5a0957['green'],_0x1a6082[0x3*_0x55dac7+0x2]=_0x5a0957['blue'];}const _0x3cacd7={'context':_0x254278,'width':_0x2749f7,'height':0x1,'pixelFormat':Cesium$4[_0x20ea18(0x1d4)]['RGB'],'pixelDatatype':Cesium$4[_0x20ea18(0x1d0)][_0x20ea18(0x19b)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x20ea18(0x17e)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x3b4f2c),'segmentsDepth':Util['createTexture'](_0x73c9df),'currentTrailsColor':Util['createTexture'](_0x3b4f2c),'currentTrailsDepth':Util[_0x20ea18(0x1ad)](_0x73c9df),'nextTrailsColor':Util['createTexture'](_0x3b4f2c),'nextTrailsDepth':Util[_0x20ea18(0x1ad)](_0x73c9df),'colorTable':Util['createTexture'](_0x3cacd7,_0x1a6082)};}['createRenderingFramebuffers'](_0x3603f1){const _0x225415=_0x5e1b93;this['framebuffers']={'segments':Util['createFramebuffer'](_0x3603f1,this[_0x225415(0x195)]['segmentsColor'],this[_0x225415(0x195)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x3603f1,this['textures'][_0x225415(0x17a)],this[_0x225415(0x195)][_0x225415(0x1fa)]),'nextTrails':Util[_0x225415(0x208)](_0x3603f1,this['textures']['nextTrailsColor'],this['textures'][_0x225415(0x1fc)])};}['createSegmentsGeometry'](_0x1a5f7b){const _0x3a4a2a=_0x5e1b93,_0x20bb90=0x4;let _0x42298f=[];for(let _0x5803ea=0x0;_0x5803ea<_0x1a5f7b[_0x3a4a2a(0x1f0)];_0x5803ea++){for(let _0x50fa9e=0x0;_0x50fa9e<_0x1a5f7b['particlesTextureSize'];_0x50fa9e++){for(let _0x33862d=0x0;_0x33862d<_0x20bb90;_0x33862d++){_0x42298f['push'](_0x5803ea/_0x1a5f7b[_0x3a4a2a(0x1f0)]),_0x42298f['push'](_0x50fa9e/_0x1a5f7b['particlesTextureSize']);}}}_0x42298f=new Float32Array(_0x42298f);let _0x43c689=[];const _0x5daee3=[-0x1,0x1],_0x4bc372=[-0x1,0x1];for(let _0x43f5c4=0x0;_0x43f5c4<_0x1a5f7b['maxParticles'];_0x43f5c4++){for(let _0x2b646f=0x0;_0x2b646f<_0x20bb90/0x2;_0x2b646f++){for(let _0x1982d7=0x0;_0x1982d7<_0x20bb90/0x2;_0x1982d7++){_0x43c689['push'](_0x5daee3[_0x2b646f]),_0x43c689[_0x3a4a2a(0x1fb)](_0x4bc372[_0x1982d7]),_0x43c689['push'](0x0);}}}_0x43c689=new Float32Array(_0x43c689);const _0x225cfa=0x6*_0x1a5f7b['maxParticles'],_0x5ab99b=new Uint32Array(_0x225cfa);for(let _0xd90c8c=0x0,_0x255855=0x0,_0x2a4850=0x0;_0xd90c8c<_0x1a5f7b['maxParticles'];_0xd90c8c++){_0x5ab99b[_0x255855++]=_0x2a4850+0x0,_0x5ab99b[_0x255855++]=_0x2a4850+0x1,_0x5ab99b[_0x255855++]=_0x2a4850+0x2,_0x5ab99b[_0x255855++]=_0x2a4850+0x2,_0x5ab99b[_0x255855++]=_0x2a4850+0x1,_0x5ab99b[_0x255855++]=_0x2a4850+0x3,_0x2a4850+=0x4;}const _0x3a3dc5=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x3a4a2a(0x170)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x42298f}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x43c689})}),'indices':_0x5ab99b});return _0x3a3dc5;}['createRenderingPrimitives'](_0x40db80,_0x41ecae,_0x53beda,_0x1b8d85){const _0xc77fcf=_0x5e1b93,_0x542a2f=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x41ecae),'primitiveType':Cesium$4[_0xc77fcf(0x228)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x1b8d85['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x1b8d85['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x363057=_0xc77fcf;return _0x1b8d85[_0x363057(0x193)]['postProcessingSpeed'];},'colorTable':function(){return _0x542a2f['textures']['colorTable'];},'aspect':function(){return _0x40db80['drawingBufferWidth']/_0x40db80['drawingBufferHeight'];},'pixelSize':function(){return _0x53beda['pixelSize'];},'lineWidth':function(){const _0x23fb64=_0xc77fcf;return _0x41ecae[_0x23fb64(0x237)];},'particleHeight':function(){return _0x41ecae['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0xc77fcf(0x21a))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0xc77fcf(0x21a))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0xc77fcf(0x1e1)],'uniformMap':{'segmentsColorTexture':function(){const _0x10de0d=_0xc77fcf;return _0x542a2f[_0x10de0d(0x195)]['segmentsColor'];},'segmentsDepthTexture':function(){return _0x542a2f['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x1dfd95=_0xc77fcf;return _0x542a2f['framebuffers'][_0x1dfd95(0x19f)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x542a2f['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x41ecae['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0xc77fcf(0x23b)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x1c6582=_0xc77fcf,_0x500acc=_0x542a2f['framebuffers'][_0x1c6582(0x19f)];_0x542a2f[_0x1c6582(0x1e0)]['currentTrails']=_0x542a2f['framebuffers']['nextTrails'],_0x542a2f['framebuffers']['nextTrails']=_0x500acc,_0x542a2f[_0x1c6582(0x22e)]['trails']['commandToExecute'][_0x1c6582(0x214)]=_0x542a2f['framebuffers']['nextTrails'],_0x542a2f['primitives']['trails']['clearCommand']['framebuffer']=_0x542a2f['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x4590a8=_0xc77fcf;return _0x542a2f[_0x4590a8(0x1e0)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x19fad5=_0xc77fcf;return _0x542a2f['framebuffers'][_0x19fad5(0x1f1)][_0x19fad5(0x1c4)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0xc77fcf(0x1b2)],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0xc77fcf(0x15f)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x5e1b93(0x166)];class ParticlesComputing{constructor(_0x3225cf,_0x5260b9,_0xc11b1b,_0x58d1af){const _0x13bd06=_0x5e1b93;this[_0x13bd06(0x229)]=_0x5260b9,this['createWindTextures'](_0x3225cf,_0x5260b9),this['createParticlesTextures'](_0x3225cf,_0xc11b1b,_0x58d1af),this['createComputingPrimitives'](_0x5260b9,_0xc11b1b,_0x58d1af);}['createWindTextures'](_0x2394e2,_0x4397fe){const _0x2ea9dd=_0x5e1b93,_0x5daca3={'context':_0x2394e2,'width':_0x4397fe['dimensions'][_0x2ea9dd(0x23d)],'height':_0x4397fe[_0x2ea9dd(0x19e)]['lat']*(_0x4397fe['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x2ea9dd(0x211)]})};this['windTextures']={'U':Util['createTexture'](_0x5daca3,_0x4397fe['U']['array']),'V':Util[_0x2ea9dd(0x1ad)](_0x5daca3,_0x4397fe['V'][_0x2ea9dd(0x205)])};}['createParticlesTextures'](_0x585318,_0x5dc4ba,_0x44b2e7){const _0x59d10b=_0x5e1b93,_0x4f48c9={'context':_0x585318,'width':_0x5dc4ba['particlesTextureSize'],'height':_0x5dc4ba[_0x59d10b(0x1f0)],'pixelFormat':Cesium$3[_0x59d10b(0x1d4)][_0x59d10b(0x1f7)],'pixelDatatype':Cesium$3['PixelDatatype'][_0x59d10b(0x19b)],'flipY':![],'sampler':new Cesium$3[(_0x59d10b(0x1d9))]({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x59d10b(0x211)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x5e655f=this['randomizeParticles'](_0x5dc4ba[_0x59d10b(0x1d2)],_0x44b2e7),_0xc34221=new Float32Array(0x4*_0x5dc4ba[_0x59d10b(0x1d2)])['fill'](0x0);this[_0x59d10b(0x193)]={'particlesWind':Util['createTexture'](_0x4f48c9),'currentParticlesPosition':Util['createTexture'](_0x4f48c9,_0x5e655f),'nextParticlesPosition':Util['createTexture'](_0x4f48c9,_0x5e655f),'currentParticlesSpeed':Util['createTexture'](_0x4f48c9,_0xc34221),'nextParticlesSpeed':Util['createTexture'](_0x4f48c9,_0xc34221),'postProcessingPosition':Util[_0x59d10b(0x1ad)](_0x4f48c9,_0x5e655f),'postProcessingSpeed':Util[_0x59d10b(0x1ad)](_0x4f48c9,_0xc34221)};}[_0x5e1b93(0x1c9)](_0x11e88a,_0x4fe45c){const _0x4583de=_0x5e1b93,_0x2edbd7=new Float32Array(0x4*_0x11e88a);for(let _0x3bcbd0=0x0;_0x3bcbd0<_0x11e88a;_0x3bcbd0++){_0x2edbd7[0x4*_0x3bcbd0]=Cesium$3['Math']['randomBetween'](_0x4fe45c['lonRange']['x'],_0x4fe45c[_0x4583de(0x17d)]['y']),_0x2edbd7[0x4*_0x3bcbd0+0x1]=Cesium$3['Math']['randomBetween'](_0x4fe45c['latRange']['x'],_0x4fe45c['latRange']['y']),_0x2edbd7[0x4*_0x3bcbd0+0x2]=Cesium$3[_0x4583de(0x172)]['randomBetween'](this['data']['lev']['min'],this[_0x4583de(0x229)][_0x4583de(0x1bb)]['max']),_0x2edbd7[0x4*_0x3bcbd0+0x3]=0x0;}return _0x2edbd7;}['destroyParticlesTextures'](){const _0x32d486=_0x5e1b93;Object[_0x32d486(0x174)](this[_0x32d486(0x193)])['forEach'](_0x3ea96b=>{this['particlesTextures'][_0x3ea96b]['destroy']();});}['createComputingPrimitives'](_0x549ea5,_0x2a1ea1,_0x1b7660){const _0x34636b=_0x5e1b93,_0x1459bf=new Cesium$3[(_0x34636b(0x23f))](_0x549ea5['dimensions']['lon'],_0x549ea5['dimensions']['lat'],_0x549ea5['dimensions'][_0x34636b(0x1bb)]),_0x4c2aab=new Cesium$3[(_0x34636b(0x23f))](_0x549ea5['lon'][_0x34636b(0x200)],_0x549ea5['lat']['min'],_0x549ea5['lev']['min']),_0xbe7457=new Cesium$3[(_0x34636b(0x23f))](_0x549ea5['lon']['max'],_0x549ea5['lat']['max'],_0x549ea5[_0x34636b(0x1bb)]['max']),_0x3f5753=new Cesium$3['Cartesian3']((_0xbe7457['x']-_0x4c2aab['x'])/(_0x1459bf['x']-0x1),(_0xbe7457['y']-_0x4c2aab['y'])/(_0x1459bf['y']-0x1),_0x1459bf['z']>0x1?(_0xbe7457['z']-_0x4c2aab['z'])/(_0x1459bf['z']-0x1):0x1),_0x181f63=new Cesium$3['Cartesian2'](_0x549ea5['U'][_0x34636b(0x200)],_0x549ea5['U']['max']),_0x388760=new Cesium$3[(_0x34636b(0x156))](_0x549ea5['V']['min'],_0x549ea5['V']['max']),_0x3bc3e1=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x34636b(0x187),'uniformMap':{'U':function(){return _0x3bc3e1['windTextures']['U'];},'V':function(){return _0x3bc3e1['windTextures']['V'];},'currentParticlesPosition':function(){const _0x2ae18f=_0x34636b;return _0x3bc3e1[_0x2ae18f(0x193)]['currentParticlesPosition'];},'dimension':function(){return _0x1459bf;},'minimum':function(){return _0x4c2aab;},'maximum':function(){return _0xbe7457;},'interval':function(){return _0x3f5753;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x34636b(0x193)][_0x34636b(0x197)],'preExecute':function(){const _0x4c8968=_0x34636b;_0x3bc3e1['primitives']['getWind']['commandToExecute'][_0x4c8968(0x1ee)]=_0x3bc3e1['particlesTextures'][_0x4c8968(0x197)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x3bc3e1['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x3bc3e1['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x181f63;},'vSpeedRange':function(){return _0x388760;},'pixelSize':function(){return _0x1b7660['pixelSize'];},'speedFactor':function(){const _0x2ba375=_0x34636b;return _0x2a1ea1[_0x2ba375(0x224)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x34636b(0x1af)],'preExecute':function(){const _0x17296c=_0x34636b,_0x5148d8=_0x3bc3e1['particlesTextures'][_0x17296c(0x21d)];_0x3bc3e1['particlesTextures']['currentParticlesSpeed']=_0x3bc3e1['particlesTextures'][_0x17296c(0x171)],_0x3bc3e1['particlesTextures']['postProcessingSpeed']=_0x5148d8,_0x3bc3e1['primitives'][_0x17296c(0x1d8)][_0x17296c(0x16f)]['outputTexture']=_0x3bc3e1['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x3bc3e1['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0xf44407=_0x34636b;return _0x3bc3e1['particlesTextures'][_0xf44407(0x21d)];}},'fragmentShaderSource':new Cesium$3[(_0x34636b(0x21a))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x5d940c=_0x34636b,_0x2bb148=_0x3bc3e1['particlesTextures']['currentParticlesPosition'];_0x3bc3e1['particlesTextures'][_0x5d940c(0x20b)]=_0x3bc3e1['particlesTextures'][_0x5d940c(0x16e)],_0x3bc3e1['particlesTextures']['postProcessingPosition']=_0x2bb148,_0x3bc3e1[_0x5d940c(0x22e)]['updatePosition']['commandToExecute']['outputTexture']=_0x3bc3e1[_0x5d940c(0x193)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x3bc3e1['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x3bc3e1['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){const _0x307d5e=_0x34636b;return _0x1b7660[_0x307d5e(0x17d)];},'latRange':function(){const _0x46123f=_0x34636b;return _0x1b7660[_0x46123f(0x162)];},'randomCoefficient':function(){const _0x54dc1b=Math['random']();return _0x54dc1b;},'dropRate':function(){return _0x2a1ea1['dropRate'];},'dropRateBump':function(){return _0x2a1ea1['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x34636b(0x193)]['postProcessingPosition'],'preExecute':function(){const _0x41ae8d=_0x34636b;_0x3bc3e1['primitives'][_0x41ae8d(0x16e)]['commandToExecute']['outputTexture']=_0x3bc3e1['particlesTextures'][_0x41ae8d(0x16e)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x10afd6=_0x34636b;return _0x3bc3e1[_0x10afd6(0x193)]['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x3bc3e1['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x3c94c2=_0x34636b;_0x3bc3e1[_0x3c94c2(0x22e)]['postProcessingSpeed'][_0x3c94c2(0x16f)]['outputTexture']=_0x3bc3e1['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x4c44c2,_0x5b98cd,_0x31d085,_0x3edbcf){const _0x4abd61=_0x5e1b93;this['context']=_0x4c44c2,_0x5b98cd={..._0x5b98cd},_0x5b98cd['udata']&&_0x5b98cd[_0x4abd61(0x15a)]&&(_0x5b98cd['dimensions']={},_0x5b98cd['dimensions']['lon']=_0x5b98cd['cols'],_0x5b98cd['dimensions']['lat']=_0x5b98cd['rows'],_0x5b98cd[_0x4abd61(0x19e)][_0x4abd61(0x1bb)]=_0x5b98cd['lev']||0x1,_0x5b98cd['lon']={},_0x5b98cd[_0x4abd61(0x23d)]['min']=_0x5b98cd['xmin'],_0x5b98cd['lon'][_0x4abd61(0x1b5)]=_0x5b98cd[_0x4abd61(0x18b)],_0x5b98cd['lat']={},_0x5b98cd[_0x4abd61(0x1e4)]['min']=_0x5b98cd['ymin'],_0x5b98cd['lat']['max']=_0x5b98cd[_0x4abd61(0x1c3)],_0x5b98cd['lev']={},_0x5b98cd['lev'][_0x4abd61(0x200)]=_0x5b98cd['levmin']??0x1,_0x5b98cd[_0x4abd61(0x1bb)][_0x4abd61(0x1b5)]=_0x5b98cd['levmax']??0x1,_0x5b98cd['U']={},_0x5b98cd['U'][_0x4abd61(0x205)]=new Float32Array(_0x5b98cd[_0x4abd61(0x1be)]),_0x5b98cd['U'][_0x4abd61(0x200)]=_0x5b98cd['umin']??Math['min'](..._0x5b98cd['udata']),_0x5b98cd['U'][_0x4abd61(0x1b5)]=_0x5b98cd[_0x4abd61(0x1ac)]??Math['max'](..._0x5b98cd['udata']),_0x5b98cd['V']={},_0x5b98cd['V']['array']=new Float32Array(_0x5b98cd['vdata']),_0x5b98cd['V'][_0x4abd61(0x200)]=_0x5b98cd[_0x4abd61(0x182)]??Math['min'](..._0x5b98cd[_0x4abd61(0x15a)]),_0x5b98cd['V']['max']=_0x5b98cd[_0x4abd61(0x1e3)]??Math[_0x4abd61(0x1b5)](..._0x5b98cd['vdata'])),this['data']=_0x5b98cd,this['options']=_0x31d085,this[_0x4abd61(0x168)]=_0x3edbcf,this[_0x4abd61(0x1e5)]=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x4abd61(0x168)]),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x4abd61(0x229)],this[_0x4abd61(0x20d)],this[_0x4abd61(0x168)],this['particlesComputing']);}[_0x5e1b93(0x17c)](_0x2f48b1){const _0x30dcdc=_0x5e1b93;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x30dcdc(0x1cc)])[_0x30dcdc(0x15c)](_0x5b7924=>{this['particlesComputing']['windTextures'][_0x5b7924]['destroy']();}),this[_0x30dcdc(0x161)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x30dcdc(0x1e0)])[_0x30dcdc(0x15c)](_0x5d23eb=>{this['particlesRendering']['framebuffers'][_0x5d23eb]['destroy']();}),this['context']=_0x2f48b1,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x30dcdc(0x168)],this[_0x30dcdc(0x1e5)]);}['clearFramebuffers'](){const _0x411daf=_0x5e1b93,_0x3f75f8=new Cesium$2[(_0x411daf(0x1dc))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering'][_0x411daf(0x1e0)])[_0x411daf(0x15c)](_0x232692=>{const _0x18a33b=_0x411daf;_0x3f75f8['framebuffer']=this['particlesRendering']['framebuffers'][_0x232692],_0x3f75f8[_0x18a33b(0x153)](this[_0x18a33b(0x235)]);});}['refreshParticles'](_0x1d08ae){const _0x2af8f5=_0x5e1b93;this['clearFramebuffers'](),this['particlesComputing'][_0x2af8f5(0x1a1)](),this[_0x2af8f5(0x1e5)][_0x2af8f5(0x1a2)](this['context'],this[_0x2af8f5(0x20d)],this['viewerParameters']);if(_0x1d08ae){var _0x74bb59,_0x59d5d2;const _0x4dea48=this['particlesRendering'][_0x2af8f5(0x1c2)](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x4dea48;const _0x12ef51=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x2af8f5(0x235)],'geometry':_0x4dea48,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x74bb59=this['particlesRendering'][_0x2af8f5(0x22e)])!==null&&_0x74bb59!==void 0x0&&(_0x59d5d2=_0x74bb59['segments'])!==null&&_0x59d5d2!==void 0x0&&_0x59d5d2[_0x2af8f5(0x16f)]&&(this['particlesRendering'][_0x2af8f5(0x22e)]['segments']['commandToExecute']['vertexArray']=_0x12ef51);}}[_0x5e1b93(0x1d7)](_0x2f08ee){let _0xe66e74=![];this['options']['maxParticles']!==_0x2f08ee['maxParticles']&&(_0xe66e74=!![]),Object['keys'](_0x2f08ee)['forEach'](_0x28cbed=>{this['options'][_0x28cbed]=_0x2f08ee[_0x28cbed];}),this['refreshParticles'](_0xe66e74);}['applyViewerParameters'](_0x15865b){const _0x6ccd29=_0x5e1b93;Object['keys'](_0x15865b)[_0x6ccd29(0x15c)](_0x3060be=>{this['viewerParameters'][_0x3060be]=_0x15865b[_0x3060be];}),this['refreshParticles'](![]);}['destroy'](){const _0x4f4f4b=_0x5e1b93;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x4f4f4b(0x1cc)])[_0x4f4f4b(0x15c)](_0x2366f8=>{const _0x4206af=_0x4f4f4b;this[_0x4206af(0x1e5)]['windTextures'][_0x2366f8][_0x4206af(0x1c6)]();}),this['particlesRendering'][_0x4f4f4b(0x195)][_0x4f4f4b(0x163)][_0x4f4f4b(0x1c6)](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x4f4f4b(0x15c)](_0x1a327d=>{const _0x236b2c=_0x4f4f4b;this[_0x236b2c(0x161)]['framebuffers'][_0x1a327d][_0x236b2c(0x1c6)]();});for(const _0x56fe79 in this){delete this[_0x56fe79];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x5e1b93(0x154)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x3b158c={}){_0x3b158c={...DEF_OPTIONS,..._0x3b158c},super(_0x3b158c),this['_setOptionsHook'](_0x3b158c);}get[_0x5e1b93(0x206)](){return this['primitives'];}get[_0x5e1b93(0x229)](){return this['_data'];}set['data'](_0x2f35a3){this['setData'](_0x2f35a3);}get[_0x5e1b93(0x188)](){const _0x262c9a=_0x5e1b93;return this['options'][_0x262c9a(0x188)];}set['colors'](_0xc944ef){const _0xfb9c0f=_0x5e1b93;this['options'][_0xfb9c0f(0x188)]=_0xc944ef,this[_0xfb9c0f(0x233)]&&this['particleSystem']['setOptions']({'colors':_0xc944ef}),this[_0xfb9c0f(0x207)]();}['_mountedHook'](){}['_addedHook'](){const _0x3d2c26=_0x5e1b93;this[_0x3d2c26(0x155)]=this['_map']['scene'],this[_0x3d2c26(0x175)]=this['_map']['camera'],this[_0x3d2c26(0x22e)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this[_0x3d2c26(0x22e)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x3d2c26(0x183))](Cesium$1[_0x3d2c26(0x23f)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x3d2c26(0x207),this[_0x3d2c26(0x207)]['bind'](this),![]),this[_0x3d2c26(0x19d)]=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType'][_0x3d2c26(0x1ca)],this[_0x3d2c26(0x231)],this),this['_map']['on'](mars3d__namespace[_0x3d2c26(0x1a7)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x3d2c26(0x1a7)][_0x3d2c26(0x169)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x3d2c26(0x22d)](this['_data']);}['_removedHook'](){const _0x1bb387=_0x5e1b93;window[_0x1bb387(0x18c)]('resize',this[_0x1bb387(0x207)]),this['_map']['off'](mars3d__namespace['EventType'][_0x1bb387(0x1b1)],this['_onMap_preRenderEvent'],this),this[_0x1bb387(0x20c)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x1bb387(0x219)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x1bb387(0x219)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x1bb387(0x220)],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x357632=_0x5e1b93;if(!this['show']||!this['particleSystem'])return;this[_0x357632(0x22e)]['show']=![],this[_0x357632(0x22e)][_0x357632(0x20a)](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this[_0x357632(0x16d)],this);}['_onMap_preRenderEvent'](_0x25c87f){const _0x46e081=_0x5e1b93;this[_0x46e081(0x233)]['canvasResize'](this['scene'][_0x46e081(0x235)]),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x535533){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0xc45d3e){const _0x14518b=_0x5e1b93;this[_0x14518b(0x19d)]=!![];}['_onMouseMoveEvent'](_0x4da5eb){const _0x10fd42=_0x5e1b93;if(!this[_0x10fd42(0x1c7)]||!this['particleSystem'])return;this['mouse_down']&&(this[_0x10fd42(0x22e)]['show']=![],this['mouse_move']=!![]);}[_0x5e1b93(0x1ae)](_0x2a6b94){const _0x5b1cd4=_0x5e1b93;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x5b1cd4(0x22e)]['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x587677=_0x5e1b93;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x587677(0x22e)]['show']=!![];}['setData'](_0x1c8859){const _0x37abcc=_0x5e1b93;this['_data']=_0x1c8859,this[_0x37abcc(0x233)]&&this[_0x37abcc(0x233)]['destroy'](),this['particleSystem']=new ParticleSystem(this['scene'][_0x37abcc(0x235)],_0x1c8859,this['getOptions'](),this['viewerParameters']),this[_0x37abcc(0x1d5)]();}[_0x5e1b93(0x16b)](_0x28b262,_0x2b2c8a){const _0x392028=_0x5e1b93;if(_0x28b262)for(const _0xd33f41 in _0x28b262){this[_0xd33f41]=_0x28b262[_0xd33f41];}this[_0x392028(0x233)]&&this[_0x392028(0x233)]['setOptions'](this[_0x392028(0x1f4)]());}['getOptions'](){const _0x563fdc=_0x5e1b93,_0x45cd86=Math[_0x563fdc(0x194)](Math[_0x563fdc(0x1da)](this['particlesNumber']));return this['particlesNumber']=_0x45cd86*_0x45cd86,{'particlesTextureSize':_0x45cd86,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x563fdc(0x1a8)],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x563fdc(0x224)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x5bbc3d=_0x5e1b93;this[_0x5bbc3d(0x22e)][_0x5bbc3d(0x199)](this[_0x5bbc3d(0x233)]['particlesComputing'][_0x5bbc3d(0x22e)]['getWind']),this[_0x5bbc3d(0x22e)]['add'](this[_0x5bbc3d(0x233)]['particlesComputing'][_0x5bbc3d(0x22e)][_0x5bbc3d(0x1d8)]),this[_0x5bbc3d(0x22e)][_0x5bbc3d(0x199)](this[_0x5bbc3d(0x233)]['particlesComputing']['primitives'][_0x5bbc3d(0x152)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this[_0x5bbc3d(0x233)]['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x5bbc3d(0x22e)][_0x5bbc3d(0x16c)]),this['primitives']['add'](this['particleSystem'][_0x5bbc3d(0x161)]['primitives']['trails']),this['primitives']['add'](this['particleSystem'][_0x5bbc3d(0x161)]['primitives']['screen']);}['updateViewerParameters'](){const _0x107f4f=_0x5e1b93;let _0xde3a2b=this[_0x107f4f(0x175)]['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0xde3a2b){const _0x467efb=this[_0x107f4f(0x20c)]['getExtent']();_0xde3a2b=Cesium$1['Rectangle'][_0x107f4f(0x1b7)](_0x467efb[_0x107f4f(0x1ab)],_0x467efb[_0x107f4f(0x215)],_0x467efb['xmax'],_0x467efb['ymax']);}const _0x1b9279=Util[_0x107f4f(0x221)](_0xde3a2b);this['viewerParameters']['lonRange']['x']=_0x1b9279['lon']['min'],this['viewerParameters'][_0x107f4f(0x17d)]['y']=_0x1b9279[_0x107f4f(0x23d)]['max'],this['viewerParameters'][_0x107f4f(0x162)]['x']=_0x1b9279['lat']['min'],this['viewerParameters']['latRange']['y']=_0x1b9279['lat']['max'];const _0x43ea7e=this['camera']['getPixelSize'](this[_0x107f4f(0x164)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x43ea7e>0x0&&(this['viewerParameters']['pixelSize']=_0x43ea7e);}}mars3d__namespace['LayerUtil'][_0x5e1b93(0x1d3)](_0x5e1b93(0x16a),WindLayer),mars3d__namespace['layer'][_0x5e1b93(0x209)]=WindLayer;class CanvasParticle{constructor(){const _0x41265d=_0x5e1b93;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x41265d(0x239)]=null,this['speed']=null;}[_0x5e1b93(0x1c6)](){for(const _0x3f48ab in this){delete this[_0x3f48ab];}}}class CanvasWindField{constructor(_0x1cb6a7){this['setOptions'](_0x1cb6a7);}get['speedRate'](){return this['_speedRate'];}set[_0x5e1b93(0x1b4)](_0x7d358e){const _0x115f76=_0x5e1b93;this['_speedRate']=(0x64-(_0x7d358e>0x63?0x63:_0x7d358e))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this[_0x115f76(0x1a6)],(this[_0x115f76(0x1c3)]-this[_0x115f76(0x215)])/this['_speedRate']];}get['maxAge'](){const _0x41bb7b=_0x5e1b93;return this[_0x41bb7b(0x227)];}set['maxAge'](_0x2eb47b){this['_maxAge']=_0x2eb47b;}['setOptions'](_0x1a4a51){const _0x3f2cbd=_0x5e1b93;this[_0x3f2cbd(0x20d)]=_0x1a4a51,this['maxAge']=_0x1a4a51['maxAge']||0x78,this[_0x3f2cbd(0x1b4)]=_0x1a4a51[_0x3f2cbd(0x1b4)]||0x32,this['particles']=[];const _0x569a54=_0x1a4a51['particlesNumber']||0x1000;for(let _0x29d017=0x0;_0x29d017<_0x569a54;_0x29d017++){const _0x295615=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x295615);}}['setDate'](_0x216336){const _0x2d7b60=_0x5e1b93;this['rows']=_0x216336['rows'],this['cols']=_0x216336['cols'],this['xmin']=_0x216336['xmin'],this[_0x2d7b60(0x18b)]=_0x216336[_0x2d7b60(0x18b)],this['ymin']=_0x216336['ymin'],this[_0x2d7b60(0x1c3)]=_0x216336['ymax'],this[_0x2d7b60(0x15e)]=[];const _0xfbedf8=_0x216336['udata'],_0x642d0=_0x216336['vdata'];let _0x1abba7=![];_0xfbedf8[_0x2d7b60(0x1a5)]===this['rows']&&_0xfbedf8[0x0]['length']===this['cols']&&(_0x1abba7=!![]);let _0x13324f=0x0,_0x1ff43b=null,_0x54c702=null;for(let _0x4efedc=0x0;_0x4efedc<this['rows'];_0x4efedc++){_0x1ff43b=[];for(let _0x2d26ed=0x0;_0x2d26ed<this['cols'];_0x2d26ed++,_0x13324f++){_0x1abba7?_0x54c702=this['_calcUV'](_0xfbedf8[_0x4efedc][_0x2d26ed],_0x642d0[_0x4efedc][_0x2d26ed]):_0x54c702=this['_calcUV'](_0xfbedf8[_0x13324f],_0x642d0[_0x13324f]),_0x1ff43b[_0x2d7b60(0x1fb)](_0x54c702);}this['grid']['push'](_0x1ff43b);}this['options']['reverseY']&&this[_0x2d7b60(0x15e)]['reverse']();}[_0x5e1b93(0x1a9)](){const _0x56440a=_0x5e1b93;delete this['rows'],delete this['cols'],delete this['xmin'],delete this[_0x56440a(0x18b)],delete this[_0x56440a(0x215)],delete this['ymax'],delete this['grid'],delete this[_0x56440a(0x1ba)];}[_0x5e1b93(0x226)](_0x50292f,_0x358cb8){const _0x41981a=_0x5e1b93,_0x4aee4b=(_0x50292f-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x151b99=(this['ymax']-_0x358cb8)/(this['ymax']-this[_0x41981a(0x215)])*(this['rows']-0x1);return[_0x4aee4b,_0x151b99];}['getUVByXY'](_0x5e67a0,_0x1eae7c){const _0x1da663=_0x5e1b93;if(_0x5e67a0<0x0||_0x5e67a0>=this['cols']||_0x1eae7c>=this[_0x1da663(0x190)])return[0x0,0x0,0x0];const _0x1a1672=Math['floor'](_0x5e67a0),_0xe48555=Math['floor'](_0x1eae7c);if(_0x1a1672===_0x5e67a0&&_0xe48555===_0x1eae7c)return this['grid'][_0x1eae7c][_0x5e67a0];const _0x2e7c11=_0x1a1672+0x1,_0x3b1e3d=_0xe48555+0x1,_0x3f52eb=this[_0x1da663(0x204)](_0x1a1672,_0xe48555),_0x40cd0e=this['getUVByXY'](_0x2e7c11,_0xe48555),_0x375a47=this['getUVByXY'](_0x1a1672,_0x3b1e3d),_0x54e7d4=this[_0x1da663(0x204)](_0x2e7c11,_0x3b1e3d);let _0x297475=null;try{_0x297475=this['_bilinearInterpolation'](_0x5e67a0-_0x1a1672,_0x1eae7c-_0xe48555,_0x3f52eb,_0x40cd0e,_0x375a47,_0x54e7d4);}catch(_0x32eb81){console['log'](_0x5e67a0,_0x1eae7c);}return _0x297475;}['_bilinearInterpolation'](_0x2f8934,_0x12f781,_0x17b45c,_0x501f18,_0x348002,_0x1b48a7){const _0x2956c3=_0x5e1b93,_0x3a72cc=0x1-_0x2f8934,_0x2c2284=0x1-_0x12f781,_0x8e11c9=_0x3a72cc*_0x2c2284,_0x54783d=_0x2f8934*_0x2c2284,_0x183cb0=_0x3a72cc*_0x12f781,_0x637cb3=_0x2f8934*_0x12f781,_0x2c1967=_0x17b45c[0x0]*_0x8e11c9+_0x501f18[0x0]*_0x54783d+_0x348002[0x0]*_0x183cb0+_0x1b48a7[0x0]*_0x637cb3,_0x233b9c=_0x17b45c[0x1]*_0x8e11c9+_0x501f18[0x1]*_0x54783d+_0x348002[0x1]*_0x183cb0+_0x1b48a7[0x1]*_0x637cb3;return this[_0x2956c3(0x1b9)](_0x2c1967,_0x233b9c);}['_calcUV'](_0x8bc865,_0x32ef0d){return[+_0x8bc865,+_0x32ef0d,Math['sqrt'](_0x8bc865*_0x8bc865+_0x32ef0d*_0x32ef0d)];}['getUVByPoint'](_0x425592,_0xde2764){const _0x19a6ad=_0x5e1b93;if(!this[_0x19a6ad(0x23c)](_0x425592,_0xde2764))return null;const _0x59ce54=this[_0x19a6ad(0x226)](_0x425592,_0xde2764),_0x581abc=this[_0x19a6ad(0x204)](_0x59ce54[0x0],_0x59ce54[0x1]);return _0x581abc;}['isInExtent'](_0x2838f0,_0x6ab4eb){return _0x2838f0>=this['xmin']&&_0x2838f0<=this['xmax']&&_0x6ab4eb>=this['ymin']&&_0x6ab4eb<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x52185a=_0x5e1b93,_0x5a0ac5=fRandomByfloat(this['xmin'],this[_0x52185a(0x18b)]),_0x325229=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x325229,'lng':_0x5a0ac5};}['getParticles'](){const _0x5c2ee6=_0x5e1b93;let _0x4e1938,_0x1dbeb0,_0x32a115;for(let _0x203ed2=0x0,_0x5592e7=this[_0x5c2ee6(0x1ba)][_0x5c2ee6(0x1a5)];_0x203ed2<_0x5592e7;_0x203ed2++){let _0x26c63f=this[_0x5c2ee6(0x1ba)][_0x203ed2];_0x26c63f['age']<=0x0&&(_0x26c63f=this['_randomParticle'](_0x26c63f));if(_0x26c63f['age']>0x0){const _0x5a3173=_0x26c63f['tlng'],_0xa67d20=_0x26c63f['tlat'];_0x32a115=this[_0x5c2ee6(0x179)](_0x5a3173,_0xa67d20),_0x32a115?(_0x4e1938=_0x5a3173+this['_calc_speedRate'][0x0]*_0x32a115[0x0],_0x1dbeb0=_0xa67d20+this['_calc_speedRate'][0x1]*_0x32a115[0x1],_0x26c63f['lng']=_0x5a3173,_0x26c63f['lat']=_0xa67d20,_0x26c63f['tlng']=_0x4e1938,_0x26c63f['tlat']=_0x1dbeb0,_0x26c63f['speed']=_0x32a115[0x2],_0x26c63f['age']--):_0x26c63f['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x89cb12){const _0x28664c=_0x5e1b93;let _0x44e2ea,_0x192d42;for(let _0x3ba45f=0x0;_0x3ba45f<0x1e;_0x3ba45f++){_0x44e2ea=this['getRandomLatLng'](),_0x192d42=this[_0x28664c(0x179)](_0x44e2ea['lng'],_0x44e2ea[_0x28664c(0x1e4)]);if(_0x192d42&&_0x192d42[0x2]>0x0)break;}if(!_0x192d42)return _0x89cb12;const _0x1b75c7=_0x44e2ea['lng']+this[_0x28664c(0x1e6)][0x0]*_0x192d42[0x0],_0x5c1330=_0x44e2ea['lat']+this[_0x28664c(0x1e6)][0x1]*_0x192d42[0x1];return _0x89cb12['lng']=_0x44e2ea[_0x28664c(0x1e2)],_0x89cb12['lat']=_0x44e2ea['lat'],_0x89cb12['tlng']=_0x1b75c7,_0x89cb12[_0x28664c(0x1a4)]=_0x5c1330,_0x89cb12['age']=Math[_0x28664c(0x1b0)](Math[_0x28664c(0x210)]()*this['maxAge']),_0x89cb12['speed']=_0x192d42[0x2],_0x89cb12;}['destroy'](){for(const _0x5bb114 in this){delete this[_0x5bb114];}}}function fRandomByfloat(_0x3236f8,_0xac2ce9){return _0x3236f8+Math['random']()*(_0xac2ce9-_0x3236f8);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x5e1b93(0x206)][_0x5e1b93(0x154)];function _0x47cb(_0x54052f,_0x4ca57a){const _0x3979d3=_0x3979();return _0x47cb=function(_0x47cb38,_0x277e7b){_0x47cb38=_0x47cb38-0x151;let _0x432131=_0x3979d3[_0x47cb38];return _0x432131;},_0x47cb(_0x54052f,_0x4ca57a);}class CanvasWindLayer extends BaseLayer{constructor(_0x5d1bb0={}){const _0x399aab=_0x5e1b93;super(_0x5d1bb0),this['_setOptionsHook'](_0x5d1bb0),this[_0x399aab(0x1dd)]=null,_0x5d1bb0['colors']&&_0x5d1bb0['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x5d1bb0));}['_setOptionsHook'](_0x2f5ea5,_0x5bfc4b){const _0x146625=_0x5e1b93;this[_0x146625(0x1a3)]=0x3e8/(_0x2f5ea5['frameRate']||0xa),this[_0x146625(0x1f3)]=this['options'][_0x146625(0x181)]??![],this['color']=_0x2f5ea5['color']||'#ffffff',this['lineWidth']=_0x2f5ea5[_0x146625(0x237)]||0x1,this['fixedHeight']=_0x2f5ea5[_0x146625(0x1bc)]??0x0,this[_0x146625(0x176)]=_0x2f5ea5[_0x146625(0x176)]??![],this['windField']&&this['windField']['setOptions'](_0x2f5ea5);}get['layer'](){const _0x38a2ea=_0x5e1b93;return this[_0x38a2ea(0x1dd)];}get['canvasWidth'](){const _0x55c32f=_0x5e1b93;return this[_0x55c32f(0x20c)]['scene']['canvas']['clientWidth'];}get['canvasHeight'](){const _0x1a8da1=_0x5e1b93;return this[_0x1a8da1(0x20c)]['scene'][_0x1a8da1(0x1dd)][_0x1a8da1(0x218)];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x2ff2a1){const _0x30f75e=_0x5e1b93;this['_pointerEvents']=_0x2ff2a1;if(!this['canvas'])return;_0x2ff2a1?this['canvas']['style'][_0x30f75e(0x185)]=_0x30f75e(0x241):this['canvas']['style']['pointer-events']='none';}get['particlesNumber'](){const _0x1953f0=_0x5e1b93;return this[_0x1953f0(0x20d)][_0x1953f0(0x1e9)];}set['particlesNumber'](_0x299ae3){const _0x4abbed=_0x5e1b93;this[_0x4abbed(0x20d)][_0x4abbed(0x1e9)]=_0x299ae3,clearTimeout(this[_0x4abbed(0x223)]),this[_0x4abbed(0x223)]=setTimeout(()=>{const _0x53a9f0=_0x4abbed;this[_0x53a9f0(0x23a)]();},0x1f4);}get['speedRate'](){const _0x392517=_0x5e1b93;return this['options'][_0x392517(0x1b4)];}set['speedRate'](_0x2a687f){const _0x3d8946=_0x5e1b93;this['options']['speedRate']=_0x2a687f,this[_0x3d8946(0x191)]&&(this[_0x3d8946(0x191)][_0x3d8946(0x1b4)]=_0x2a687f);}get['maxAge'](){const _0x4ff418=_0x5e1b93;return this['options'][_0x4ff418(0x17f)];}set[_0x5e1b93(0x17f)](_0x1b8e79){const _0x2d6bb1=_0x5e1b93;this['options']['maxAge']=_0x1b8e79,this['windField']&&(this['windField'][_0x2d6bb1(0x17f)]=_0x1b8e79);}get['data'](){return this['windData'];}set['data'](_0x51c9d9){this['setData'](_0x51c9d9);}[_0x5e1b93(0x18d)](_0x37807a){const _0x52d50c=_0x5e1b93;_0x37807a?this['_addedHook']():(this[_0x52d50c(0x173)]&&(this[_0x52d50c(0x20d)][_0x52d50c(0x229)]=this['windData']),this['_removedHook']());}[_0x5e1b93(0x202)](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0xf0ed8=_0x5e1b93;this[_0xf0ed8(0x1dd)]=this['_createCanvas'](),this['canvasContext']=this[_0xf0ed8(0x1dd)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0xf0ed8(0x20d)]['data']&&this['setData'](this['options'][_0xf0ed8(0x229)]);}[_0x5e1b93(0x18f)](){const _0x217381=_0x5e1b93;this[_0x217381(0x1a9)](),this['unbindEvent'](),this[_0x217381(0x1dd)]&&(this['_map']['container'][_0x217381(0x1e7)](this[_0x217381(0x1dd)]),delete this['canvas']);}[_0x5e1b93(0x1ed)](){const _0x35e9eb=_0x5e1b93,_0x335faf=mars3d__namespace[_0x35e9eb(0x234)]['create'](_0x35e9eb(0x1dd),_0x35e9eb(0x213),this['_map']['container']);return _0x335faf['style']['position']='absolute',_0x335faf[_0x35e9eb(0x232)][_0x35e9eb(0x1ec)]='0px',_0x335faf['style']['left']='0px',_0x335faf['style']['width']=this[_0x35e9eb(0x20c)]['scene']['canvas']['clientWidth']+'px',_0x335faf[_0x35e9eb(0x232)]['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x335faf['style']['pointerEvents']=this['_pointerEvents']?'auto':_0x35e9eb(0x22a),_0x335faf[_0x35e9eb(0x232)]['zIndex']=this['options'][_0x35e9eb(0x159)]??0x9,_0x335faf['width']=this['_map']['scene']['canvas']['clientWidth'],_0x335faf['height']=this['_map']['scene'][_0x35e9eb(0x1dd)]['clientHeight'],_0x335faf;}['resize'](){const _0x274baf=_0x5e1b93;this['canvas']&&(this[_0x274baf(0x1dd)]['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this['_map']['scene'][_0x274baf(0x1dd)][_0x274baf(0x218)]+'px',this[_0x274baf(0x1dd)][_0x274baf(0x158)]=this[_0x274baf(0x20c)]['scene']['canvas']['clientWidth'],this['canvas'][_0x274baf(0x160)]=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x103d8a=_0x5e1b93,_0x4d6567=this;let _0x5a8207=Date['now']();(function _0x5dfeba(){const _0x5936f3=_0x47cb;_0x4d6567['animateFrame']=window['requestAnimationFrame'](_0x5dfeba);if(_0x4d6567[_0x5936f3(0x1c7)]&&_0x4d6567['windField']){const _0x28ebc7=Date['now'](),_0x5d0ccc=_0x28ebc7-_0x5a8207;_0x5d0ccc>_0x4d6567[_0x5936f3(0x1a3)]&&(_0x5a8207=_0x28ebc7-_0x5d0ccc%_0x4d6567[_0x5936f3(0x1a3)],_0x4d6567['update']());}}(),window[_0x103d8a(0x230)]('resize',this[_0x103d8a(0x207)]['bind'](this),![]),this[_0x103d8a(0x19d)]=![],this['mouse_move']=![],this['options'][_0x103d8a(0x1cb)]&&(this[_0x103d8a(0x20c)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x1dccd5=_0x5e1b93;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window[_0x1dccd5(0x18c)](_0x1dccd5(0x207),this['resize']),this['options'][_0x1dccd5(0x1cb)]&&(this['_map']['off'](mars3d__namespace[_0x1dccd5(0x1a7)]['wheel'],this[_0x1dccd5(0x231)],this),this['_map'][_0x1dccd5(0x219)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x1dccd5(0x169)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x1dccd5(0x220)],this));}['_onMapWhellEvent'](_0x352099){const _0x177520=_0x5e1b93;clearTimeout(this[_0x177520(0x212)]);if(!this[_0x177520(0x1c7)]||!this[_0x177520(0x1dd)])return;this['canvas']['style']['visibility']=_0x177520(0x21f),this[_0x177520(0x212)]=setTimeout(()=>{const _0x45a95a=_0x177520;if(!this[_0x45a95a(0x1c7)])return;this['redraw'](),this['canvas'][_0x45a95a(0x232)]['visibility']='visible';},0xc8);}[_0x5e1b93(0x222)](_0x2f0974){const _0x29d893=_0x5e1b93;this[_0x29d893(0x19d)]=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x29d893(0x20f)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x29d893(0x20f)],this[_0x29d893(0x220)],this);}['_onMouseMoveEvent'](_0x107078){const _0x3ce146=_0x5e1b93;if(!this['show']||!this[_0x3ce146(0x1dd)])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this[_0x3ce146(0x1d1)]=!![]);}['_onMouseUpEvent'](_0x54809a){const _0x115cb1=_0x5e1b93;if(!this['show']||!this[_0x115cb1(0x1dd)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x115cb1(0x1c1)]='visible',this[_0x115cb1(0x19d)]=![],this[_0x115cb1(0x1d1)]=![];}[_0x5e1b93(0x22d)](_0x3fc960){const _0x1983b7=_0x5e1b93;this['clear'](),this[_0x1983b7(0x173)]=_0x3fc960,this['windField']['setDate'](_0x3fc960),this['redraw']();}['redraw'](){const _0x3f2862=_0x5e1b93;if(!this[_0x3f2862(0x1c7)])return;this['windField']['setOptions'](this['options']),this[_0x3f2862(0x201)]();}['update'](){const _0x38a23d=_0x5e1b93;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this[_0x38a23d(0x191)]['update']();else{const _0x280b4f=this[_0x38a23d(0x191)]['getParticles']();this['_drawLines'](_0x280b4f);}this['_updateIng']=![];}['_drawLines'](_0x5512ed){const _0x193ed0=_0x5e1b93;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext'][_0x193ed0(0x1ef)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this[_0x193ed0(0x1ff)]['globalAlpha']=0.9;const _0x1d6267=this[_0x193ed0(0x20c)][_0x193ed0(0x155)][_0x193ed0(0x196)]!==Cesium[_0x193ed0(0x198)]['SCENE3D'],_0x185fbd=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x4edcff=0x0,_0x4a2411=_0x5512ed[_0x193ed0(0x1a5)];_0x4edcff<_0x4a2411;_0x4edcff++){const _0x5924fb=_0x5512ed[_0x4edcff],_0x2bb43e=this['_tomap'](_0x5924fb['lng'],_0x5924fb['lat'],_0x5924fb),_0x380ca4=this['_tomap'](_0x5924fb['tlng'],_0x5924fb['tlat'],_0x5924fb);if(!_0x2bb43e||!_0x380ca4)continue;if(_0x1d6267&&Math[_0x193ed0(0x1fe)](_0x2bb43e[0x0]-_0x380ca4[0x0])>=_0x185fbd)continue;this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x193ed0(0x1ff)][_0x193ed0(0x1f6)]=this[_0x193ed0(0x20e)]['getColor'](_0x5924fb['speed']),this[_0x193ed0(0x1ff)]['moveTo'](_0x2bb43e[0x0],_0x2bb43e[0x1]),this['canvasContext']['lineTo'](_0x380ca4[0x0],_0x380ca4[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this[_0x193ed0(0x237)],this['canvasContext']['strokeStyle']=this['color'];for(let _0x9b2fb3=0x0,_0x74f988=_0x5512ed[_0x193ed0(0x1a5)];_0x9b2fb3<_0x74f988;_0x9b2fb3++){const _0x99c332=_0x5512ed[_0x9b2fb3],_0x19f533=this[_0x193ed0(0x216)](_0x99c332[_0x193ed0(0x1e2)],_0x99c332['lat'],_0x99c332),_0x4bf851=this['_tomap'](_0x99c332[_0x193ed0(0x178)],_0x99c332['tlat'],_0x99c332);if(!_0x19f533||!_0x4bf851)continue;if(_0x1d6267&&Math['abs'](_0x19f533[0x0]-_0x4bf851[0x0])>=_0x185fbd)continue;this[_0x193ed0(0x1ff)][_0x193ed0(0x240)](_0x19f533[0x0],_0x19f533[0x1]),this['canvasContext']['lineTo'](_0x4bf851[0x0],_0x4bf851[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x1a9b0f,_0x3617ae,_0xd49180){const _0x46d53c=_0x5e1b93,_0x4d0f2f=Cesium['Cartesian3']['fromDegrees'](_0x1a9b0f,_0x3617ae,this['fixedHeight']),_0x20bd2c=this['_map']['scene'];if(_0x20bd2c[_0x46d53c(0x196)]===Cesium[_0x46d53c(0x198)]['SCENE3D']){const _0x19ea66=new Cesium['EllipsoidalOccluder'](_0x20bd2c['globe'][_0x46d53c(0x192)],_0x20bd2c[_0x46d53c(0x175)]['positionWC']),_0x19cfd0=_0x19ea66['isPointVisible'](_0x4d0f2f);if(!_0x19cfd0)return _0xd49180[_0x46d53c(0x239)]=0x0,null;}const _0x33b5ef=Cesium['SceneTransforms'][_0x46d53c(0x165)](this['_map'][_0x46d53c(0x155)],_0x4d0f2f);return _0x33b5ef?[_0x33b5ef['x'],_0x33b5ef['y']]:null;}['clear'](){const _0x10eb17=_0x5e1b93;this[_0x10eb17(0x191)]['clear'](),delete this['windData'];}[_0x5e1b93(0x1c8)](){this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=_0xc03593=>{this['_drawLines'](_0xc03593['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x5c1a19=>{this['worker']['postMessage']({'type':'init','options':_0x5c1a19});},'setOptions':_0x2861c6=>{const _0x54e452=_0x47cb;this['worker']['postMessage']({'type':_0x54e452(0x1d7),'options':_0x2861c6});},'setDate':_0x21659f=>{const _0x4c7d8e=_0x47cb;this['worker'][_0x4c7d8e(0x180)]({'type':'setDate','data':_0x21659f});},'update':()=>{const _0x2686e6=_0x47cb;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x2686e6(0x1cf)]['postMessage']({'type':_0x2686e6(0x201)});},'clear':()=>{const _0x55fd81=_0x47cb;this['worker']['postMessage']({'type':_0x55fd81(0x1a9)});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x5e1b93(0x217)][_0x5e1b93(0x1d3)]('canvasWind',CanvasWindLayer),mars3d__namespace[_0x5e1b93(0x206)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x5e1b93(0x21b)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x5e1b93(0x21b)]=WindUtil,Object[_0x5e1b93(0x19a)](exports,_0x5e1b93(0x19c),{'value':!![]});
}));
