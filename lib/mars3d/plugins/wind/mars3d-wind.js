/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.4.26
 * 编译日期：2023-03-09 16:00:54
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2022-06-01
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';var _0x27700f=_0x4aac;(function(_0x305ac5,_0x33d044){var _0x340a51=_0x4aac,_0x4750cd=_0x305ac5();while(!![]){try{var _0x207094=-parseInt(_0x340a51(0x16d))/0x1*(parseInt(_0x340a51(0xec))/0x2)+-parseInt(_0x340a51(0x14c))/0x3+parseInt(_0x340a51(0x127))/0x4+-parseInt(_0x340a51(0xcd))/0x5+parseInt(_0x340a51(0xf0))/0x6*(-parseInt(_0x340a51(0x118))/0x7)+-parseInt(_0x340a51(0x113))/0x8*(parseInt(_0x340a51(0xe0))/0x9)+parseInt(_0x340a51(0x195))/0xa*(parseInt(_0x340a51(0x19d))/0xb);if(_0x207094===_0x33d044)break;else _0x4750cd['push'](_0x4750cd['shift']());}catch(_0x34e56c){_0x4750cd['push'](_0x4750cd['shift']());}}}(_0x9613,0xd6899));function _interopNamespace(_0x5a9770){var _0xaf035=_0x4aac;if(_0x5a9770&&_0x5a9770['__esModule'])return _0x5a9770;var _0x816b0c=Object[_0xaf035(0x138)](null);return _0x5a9770&&Object['keys'](_0x5a9770)['forEach'](function(_0x4e1854){var _0x38d318=_0xaf035;if(_0x4e1854!=='default'){var _0x2922f5=Object[_0x38d318(0xda)](_0x5a9770,_0x4e1854);Object[_0x38d318(0x189)](_0x816b0c,_0x4e1854,_0x2922f5['get']?_0x2922f5:{'enumerable':!![],'get':function(){return _0x5a9770[_0x4e1854];}});}}),_0x816b0c[_0xaf035(0x14b)]=_0x5a9770,_0x816b0c;}var mars3d__namespace=_interopNamespace(mars3d),Cesium$7=mars3d__namespace[_0x27700f(0xd2)];function getU(_0x1d4a1d,_0x46d2b5){var _0x531da4=_0x27700f,_0x3d8105=_0x1d4a1d*Math[_0x531da4(0x133)](Cesium$7[_0x531da4(0x152)]['toRadians'](_0x46d2b5));return _0x3d8105;}function getV(_0x36b268,_0xe8e5b9){var _0x3c21cb=_0x27700f,_0x54fc2f=_0x36b268*Math['sin'](Cesium$7[_0x3c21cb(0x152)]['toRadians'](_0xe8e5b9));return _0x54fc2f;}function getSpeed(_0x8263c7,_0x511c1){var _0x322971=Math['sqrt'](Math['pow'](_0x8263c7,0x2)+Math['pow'](_0x511c1,0x2));return _0x322971;}function getDirection(_0x218ad3,_0x482369){var _0x2b7a32=_0x27700f,_0x415586=Cesium$7[_0x2b7a32(0x152)]['toDegrees'](Math['atan2'](_0x482369,_0x218ad3));return _0x415586+=_0x415586<0x0?0x168:0x0,_0x415586;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};function ownKeys(_0x115dd6,_0x5adc83){var _0x3a083e=Object['keys'](_0x115dd6);if(Object['getOwnPropertySymbols']){var _0x1393ad=Object['getOwnPropertySymbols'](_0x115dd6);_0x5adc83&&(_0x1393ad=_0x1393ad['filter'](function(_0x186ee4){return Object['getOwnPropertyDescriptor'](_0x115dd6,_0x186ee4)['enumerable'];})),_0x3a083e['push']['apply'](_0x3a083e,_0x1393ad);}return _0x3a083e;}function _objectSpread2(_0x50a944){var _0x3e98a0=_0x27700f;for(var _0x27fe5e=0x1;_0x27fe5e<arguments[_0x3e98a0(0xdc)];_0x27fe5e++){var _0x5915fe=null!=arguments[_0x27fe5e]?arguments[_0x27fe5e]:{};_0x27fe5e%0x2?ownKeys(Object(_0x5915fe),!0x0)['forEach'](function(_0x2c6d8a){_defineProperty(_0x50a944,_0x2c6d8a,_0x5915fe[_0x2c6d8a]);}):Object['getOwnPropertyDescriptors']?Object['defineProperties'](_0x50a944,Object['getOwnPropertyDescriptors'](_0x5915fe)):ownKeys(Object(_0x5915fe))[_0x3e98a0(0xf4)](function(_0xda2763){var _0x24f32a=_0x3e98a0;Object[_0x24f32a(0x189)](_0x50a944,_0xda2763,Object[_0x24f32a(0xda)](_0x5915fe,_0xda2763));});}return _0x50a944;}function _classCallCheck(_0x1325f3,_0x498992){if(!(_0x1325f3 instanceof _0x498992))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x1939c9,_0x5db1d2){var _0x39156a=_0x27700f;for(var _0xc7fa99=0x0;_0xc7fa99<_0x5db1d2['length'];_0xc7fa99++){var _0x5b5e3c=_0x5db1d2[_0xc7fa99];_0x5b5e3c['enumerable']=_0x5b5e3c['enumerable']||![],_0x5b5e3c['configurable']=!![];if(_0x39156a(0x1bc)in _0x5b5e3c)_0x5b5e3c['writable']=!![];Object['defineProperty'](_0x1939c9,_0x5b5e3c['key'],_0x5b5e3c);}}function _createClass(_0x3c0264,_0x5332a1,_0x25b815){var _0x328f56=_0x27700f;if(_0x5332a1)_defineProperties(_0x3c0264['prototype'],_0x5332a1);if(_0x25b815)_defineProperties(_0x3c0264,_0x25b815);return Object[_0x328f56(0x189)](_0x3c0264,'prototype',{'writable':![]}),_0x3c0264;}function _defineProperty(_0x1e4e57,_0x14d92e,_0xe3cbf4){return _0x14d92e in _0x1e4e57?Object['defineProperty'](_0x1e4e57,_0x14d92e,{'value':_0xe3cbf4,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x1e4e57[_0x14d92e]=_0xe3cbf4,_0x1e4e57;}function _inherits(_0x2b1d13,_0x2da146){var _0xfd2324=_0x27700f;if(typeof _0x2da146!=='function'&&_0x2da146!==null)throw new TypeError(_0xfd2324(0x12b));_0x2b1d13['prototype']=Object[_0xfd2324(0x138)](_0x2da146&&_0x2da146[_0xfd2324(0x11a)],{'constructor':{'value':_0x2b1d13,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x2b1d13,_0xfd2324(0x11a),{'writable':![]});if(_0x2da146)_setPrototypeOf(_0x2b1d13,_0x2da146);}function _getPrototypeOf(_0x257e88){return _getPrototypeOf=Object['setPrototypeOf']?Object['getPrototypeOf']['bind']():function _0x25f417(_0x509d3c){var _0x2a6101=_0x4aac;return _0x509d3c[_0x2a6101(0x14d)]||Object[_0x2a6101(0x10f)](_0x509d3c);},_getPrototypeOf(_0x257e88);}function _setPrototypeOf(_0x254db9,_0x2cb3fe){var _0x5e6920=_0x27700f;return _setPrototypeOf=Object['setPrototypeOf']?Object[_0x5e6920(0xd8)]['bind']():function _0x5c179b(_0x1fe78b,_0x2b70dc){return _0x1fe78b['__proto__']=_0x2b70dc,_0x1fe78b;},_setPrototypeOf(_0x254db9,_0x2cb3fe);}function _isNativeReflectConstruct(){var _0x578cc6=_0x27700f;if(typeof Reflect===_0x578cc6(0xff)||!Reflect['construct'])return![];if(Reflect['construct']['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype']['valueOf']['call'](Reflect[_0x578cc6(0x128)](Boolean,[],function(){})),!![];}catch(_0xb75d54){return![];}}function _assertThisInitialized(_0x11be68){if(_0x11be68===void 0x0)throw new ReferenceError('this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called');return _0x11be68;}function _0x4aac(_0x411eab,_0x49193d){var _0x9613d1=_0x9613();return _0x4aac=function(_0x4aac8a,_0x512345){_0x4aac8a=_0x4aac8a-0xcc;var _0x583be6=_0x9613d1[_0x4aac8a];return _0x583be6;},_0x4aac(_0x411eab,_0x49193d);}function _possibleConstructorReturn(_0x17d3a9,_0x2fbf99){var _0x4a217f=_0x27700f;if(_0x2fbf99&&(typeof _0x2fbf99==='object'||typeof _0x2fbf99===_0x4a217f(0xeb)))return _0x2fbf99;else{if(_0x2fbf99!==void 0x0)throw new TypeError('Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined');}return _assertThisInitialized(_0x17d3a9);}function _createSuper(_0xe90d0a){var _0x582b55=_isNativeReflectConstruct();return function _0x484d52(){var _0x1c064a=_0x4aac,_0x4a911f=_getPrototypeOf(_0xe90d0a),_0x2d0fcb;if(_0x582b55){var _0x12b932=_getPrototypeOf(this)['constructor'];_0x2d0fcb=Reflect['construct'](_0x4a911f,arguments,_0x12b932);}else _0x2d0fcb=_0x4a911f[_0x1c064a(0xfc)](this,arguments);return _possibleConstructorReturn(this,_0x2d0fcb);};}function _toConsumableArray(_0x3eefa7){return _arrayWithoutHoles(_0x3eefa7)||_iterableToArray(_0x3eefa7)||_unsupportedIterableToArray(_0x3eefa7)||_nonIterableSpread();}function _arrayWithoutHoles(_0x3ebfb9){var _0x2a3e64=_0x27700f;if(Array[_0x2a3e64(0x165)](_0x3ebfb9))return _arrayLikeToArray(_0x3ebfb9);}function _iterableToArray(_0x2c38dc){var _0x54a1e6=_0x27700f;if(typeof Symbol!==_0x54a1e6(0xff)&&_0x2c38dc[Symbol['iterator']]!=null||_0x2c38dc['@@iterator']!=null)return Array['from'](_0x2c38dc);}function _unsupportedIterableToArray(_0x2b45c1,_0x5d2190){var _0x1cf579=_0x27700f;if(!_0x2b45c1)return;if(typeof _0x2b45c1===_0x1cf579(0xf2))return _arrayLikeToArray(_0x2b45c1,_0x5d2190);var _0x45e4cf=Object[_0x1cf579(0x11a)]['toString']['call'](_0x2b45c1)['slice'](0x8,-0x1);if(_0x45e4cf==='Object'&&_0x2b45c1['constructor'])_0x45e4cf=_0x2b45c1[_0x1cf579(0xf5)][_0x1cf579(0xf8)];if(_0x45e4cf==='Map'||_0x45e4cf==='Set')return Array['from'](_0x2b45c1);if(_0x45e4cf==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/[_0x1cf579(0x1cd)](_0x45e4cf))return _arrayLikeToArray(_0x2b45c1,_0x5d2190);}function _arrayLikeToArray(_0x19126e,_0x1b5e6a){if(_0x1b5e6a==null||_0x1b5e6a>_0x19126e['length'])_0x1b5e6a=_0x19126e['length'];for(var _0x424bba=0x0,_0x45b902=new Array(_0x1b5e6a);_0x424bba<_0x1b5e6a;_0x424bba++)_0x45b902[_0x424bba]=_0x19126e[_0x424bba];return _0x45b902;}function _nonIterableSpread(){throw new TypeError('Invalid\x20attempt\x20to\x20spread\x20non-iterable\x20instance.\x0aIn\x20order\x20to\x20be\x20iterable,\x20non-array\x20objects\x20must\x20have\x20a\x20[Symbol.iterator]()\x20method.');}var Cesium$6=mars3d__namespace['Cesium'],CustomPrimitive=(function(){var _0x26de56=_0x27700f;function _0x46c0b8(_0x2ded85){var _0x43ec0c=_0x4aac,_0x163f09;_classCallCheck(this,_0x46c0b8),this['commandType']=_0x2ded85['commandType'],this['geometry']=_0x2ded85['geometry'],this['attributeLocations']=_0x2ded85['attributeLocations'],this['primitiveType']=_0x2ded85['primitiveType'],this[_0x43ec0c(0x1c1)]=_0x2ded85[_0x43ec0c(0x1c1)],this['vertexShaderSource']=_0x2ded85['vertexShaderSource'],this['fragmentShaderSource']=_0x2ded85['fragmentShaderSource'],this[_0x43ec0c(0x12a)]=_0x2ded85['rawRenderState'],this['framebuffer']=_0x2ded85['framebuffer'],this[_0x43ec0c(0x1af)]=_0x2ded85['outputTexture'],this['autoClear']=(_0x163f09=_0x2ded85['autoClear'])!==null&&_0x163f09!==void 0x0?_0x163f09:![],this[_0x43ec0c(0x16e)]=_0x2ded85[_0x43ec0c(0x16e)],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}return _createClass(_0x46c0b8,[{'key':_0x26de56(0x137),'value':function _0x9f5cac(_0x79e837){var _0x30f5ce=_0x26de56;switch(this[_0x30f5ce(0xe2)]){case _0x30f5ce(0x1a0):{var _0x338ca4=Cesium$6['VertexArray']['fromGeometry']({'context':_0x79e837,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x43c372=Cesium$6[_0x30f5ce(0x1ab)][_0x30f5ce(0x150)]({'context':_0x79e837,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x33f572=Cesium$6[_0x30f5ce(0x177)]['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x30f5ce(0x19b)],'shaderProgram':_0x43c372,'vertexArray':_0x338ca4,'modelMatrix':Cesium$6['Matrix4'][_0x30f5ce(0x192)],'renderState':_0x33f572,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x30f5ce(0x1a5):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x30f5ce(0x167)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}},{'key':'setGeometry','value':function _0x35217e(_0x26d10c,_0x4d9514){var _0x4d5995=_0x26de56;this[_0x4d5995(0x109)]=_0x4d9514;var _0x4e9f0d=Cesium$6['VertexArray'][_0x4d5995(0x18c)]({'context':_0x26d10c,'geometry':this['geometry'],'attributeLocations':this[_0x4d5995(0x1ca)],'bufferUsage':Cesium$6[_0x4d5995(0x126)][_0x4d5995(0xe9)]});this[_0x4d5995(0x147)]['vertexArray']=_0x4e9f0d;}},{'key':_0x26de56(0x193),'value':function _0x1a4799(_0x3402b2){var _0xa64511=_0x26de56;if(!this['show'])return;if(_0x3402b2['mode']!==Cesium$6['SceneMode'][_0xa64511(0x142)])return;!Cesium$6[_0xa64511(0x1c5)](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x3402b2['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0xa64511(0x1c5)](this['clearCommand'])&&_0x3402b2['commandList']['push'](this['clearCommand']),_0x3402b2[_0xa64511(0x13c)]['push'](this['commandToExecute']);}},{'key':'isDestroyed','value':function _0x31d741(){return![];}},{'key':'destroy','value':function _0x5a8091(){var _0x3d212e=_0x26de56;if(this['clearCommand']){var _0x5af70e,_0x31d01b;(_0x5af70e=this[_0x3d212e(0x173)])!==null&&_0x5af70e!==void 0x0&&_0x5af70e['vertexArray']&&this['clearCommand']['vertexArray'][_0x3d212e(0xe8)](),(_0x31d01b=this['clearCommand'])!==null&&_0x31d01b!==void 0x0&&_0x31d01b[_0x3d212e(0x13b)]&&this[_0x3d212e(0x173)]['shaderProgram']['destroy'](),delete this[_0x3d212e(0x173)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x3d212e(0xe8)](),this[_0x3d212e(0x147)]['shaderProgram']&&this[_0x3d212e(0x147)][_0x3d212e(0x13b)]['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}]),_0x46c0b8;}()),Cesium$5=mars3d__namespace['Cesium'],Util=(function(){var _0x371421=function _0x253713(){var _0x5bafbc=_0x4aac,_0x80d6dd=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x5bafbc(0x1a2))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x5bafbc(0x182)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x80d6dd;},_0xa5fdbb=function _0x35da23(_0x53ff49,_0x2a0d56){if(Cesium$5['defined'](_0x2a0d56)){var _0x35b186={};_0x35b186['arrayBufferView']=_0x2a0d56,_0x53ff49['source']=_0x35b186;}var _0x4d5ae1=new Cesium$5['Texture'](_0x53ff49);return _0x4d5ae1;},_0x28ba18=function _0x57f512(_0x328ac4,_0x196f9c,_0x546a1a){var _0x2680cb=new Cesium$5['Framebuffer']({'context':_0x328ac4,'colorTextures':[_0x196f9c],'depthTexture':_0x546a1a});return _0x2680cb;},_0x116529=function _0x58109c(_0x5ed2e5){var _0x5eda73=_0x4aac,_0x3c53c1=!![],_0xe36005=![],_0x347956={'viewport':_0x5ed2e5['viewport'],'depthTest':_0x5ed2e5[_0x5eda73(0xfa)],'depthMask':_0x5ed2e5[_0x5eda73(0x1a7)],'blending':_0x5ed2e5['blending']},_0x2d8d5b=Cesium$5['Appearance']['getDefaultRenderState'](_0x3c53c1,_0xe36005,_0x347956);return _0x2d8d5b;},_0x1a707c=function _0x408dfb(_0xc49c62){var _0x48b4ad=_0x4aac,_0x223fe1={},_0x1390ee=Cesium$5[_0x48b4ad(0x152)][_0x48b4ad(0x1a6)](_0xc49c62['west'],Cesium$5['Math'][_0x48b4ad(0x15f)]),_0x428dcc=Cesium$5[_0x48b4ad(0x152)]['mod'](_0xc49c62['east'],Cesium$5['Math']['TWO_PI']),_0x5cf7fa=_0xc49c62['width'],_0x360c96,_0x33095a;_0x5cf7fa>Cesium$5[_0x48b4ad(0x152)]['THREE_PI_OVER_TWO']?(_0x360c96=0x0,_0x33095a=Cesium$5['Math']['TWO_PI']):_0x428dcc-_0x1390ee<_0x5cf7fa?(_0x360c96=_0x1390ee,_0x33095a=_0x1390ee+_0x5cf7fa):(_0x360c96=_0x1390ee,_0x33095a=_0x428dcc);_0x223fe1['lon']={'min':Cesium$5['Math'][_0x48b4ad(0xde)](_0x360c96),'max':Cesium$5['Math']['toDegrees'](_0x33095a)};var _0x42cba6=_0xc49c62['south'],_0x3a2870=_0xc49c62['north'],_0x58ca1a=_0xc49c62['height'],_0x2994a4=_0x58ca1a>Cesium$5['Math']['PI']/0xc?_0x58ca1a/0x2:0x0,_0x12fe3e=Cesium$5['Math']['clampToLatitudeRange'](_0x42cba6-_0x2994a4),_0x3f4578=Cesium$5[_0x48b4ad(0x152)]['clampToLatitudeRange'](_0x3a2870+_0x2994a4);return _0x12fe3e<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x12fe3e=-Cesium$5['Math'][_0x48b4ad(0xcf)]),_0x3f4578>Cesium$5['Math'][_0x48b4ad(0xed)]&&(_0x3f4578=Cesium$5['Math']['PI_OVER_TWO']),_0x223fe1['lat']={'min':Cesium$5['Math'][_0x48b4ad(0xde)](_0x12fe3e),'max':Cesium$5['Math']['toDegrees'](_0x3f4578)},_0x223fe1;};return{'getFullscreenQuad':_0x371421,'createTexture':_0xa5fdbb,'createFramebuffer':_0x28ba18,'createRawRenderState':_0x116529,'viewRectangleToLonLatRange':_0x1a707c};}()),segmentDraw_vert=_0x27700f(0x1a1),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0avarying\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20texture2D(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}',fullscreen_vert=_0x27700f(0x180),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0d\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0d\x0a\x0d\x0auniform\x20sampler2D\x20currentTrailsColor;\x0d\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0d\x0a\x0d\x0auniform\x20float\x20fadeOpacity;\x0d\x0a\x0d\x0avarying\x20vec2\x20textureCoordinate;\x0d\x0a\x0d\x0avoid\x20main()\x20{\x0d\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture2D(segmentsColorTexture,\x20textureCoordinate);\x0d\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture2D(currentTrailsColor,\x20textureCoordinate);\x0d\x0a\x0d\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0d\x0a\x0d\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture2D(segmentsDepthTexture,\x20textureCoordinate).r;\x0d\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture2D(trailsDepthTexture,\x20textureCoordinate).r;\x0d\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture2D(czm_globeDepthTexture,\x20textureCoordinate));\x0d\x0a\x0d\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0);\x0d\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20gl_FragColor\x20+\x20pointsColor;\x0d\x0a\x20\x20\x20\x20}\x0d\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20gl_FragColor\x20+\x20trailsColor;\x0d\x0a\x20\x20\x20\x20}\x0d\x0a\x20\x20\x20\x20gl_FragDepthEXT\x20=\x20min(pointsDepth,\x20trailsDepth);\x0d\x0a}',screenDraw_frag=_0x27700f(0x198),Cesium$4=mars3d__namespace['Cesium'],ParticlesRendering=(function(){var _0x54211b=_0x27700f;function _0x1b251b(_0x73bb9f,_0x31d6fb,_0x166cbf,_0x184f31,_0x40e51f){var _0x327830=_0x4aac;_classCallCheck(this,_0x1b251b),this['createRenderingTextures'](_0x73bb9f,_0x31d6fb,_0x166cbf[_0x327830(0x15d)]),this['createRenderingFramebuffers'](_0x73bb9f),this['createRenderingPrimitives'](_0x73bb9f,_0x166cbf,_0x184f31,_0x40e51f);}return _createClass(_0x1b251b,[{'key':_0x54211b(0x1b5),'value':function _0x24d81d(_0x3a4890,_0xc6d79d,_0x17cce8){var _0x5186ac=_0x54211b,_0x506eb4={'context':_0x3a4890,'width':_0x3a4890['drawingBufferWidth'],'height':_0x3a4890[_0x5186ac(0x141)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x5186ac(0x10e)]},_0x21854e={'context':_0x3a4890,'width':_0x3a4890['drawingBufferWidth'],'height':_0x3a4890[_0x5186ac(0x141)],'pixelFormat':Cesium$4[_0x5186ac(0x149)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x5186ac(0x14a)]['UNSIGNED_INT']},_0x3cbe16=_0x17cce8[_0x5186ac(0xdc)],_0x42b07a=new Float32Array(_0x3cbe16*0x3);for(var _0x5d907a=0x0;_0x5d907a<_0x3cbe16;_0x5d907a++){var _0x451cf7=Cesium$4['Color']['fromCssColorString'](_0x17cce8[_0x5d907a]);_0x42b07a[0x3*_0x5d907a]=_0x451cf7['red'],_0x42b07a[0x3*_0x5d907a+0x1]=_0x451cf7['green'],_0x42b07a[0x3*_0x5d907a+0x2]=_0x451cf7['blue'];}var _0x323aab={'context':_0x3a4890,'width':_0x3cbe16,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x5186ac(0x11b)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x5186ac(0x1b9))]({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x5186ac(0x16b)],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x5186ac(0x1a3)]={'segmentsColor':Util['createTexture'](_0x506eb4),'segmentsDepth':Util['createTexture'](_0x21854e),'currentTrailsColor':Util['createTexture'](_0x506eb4),'currentTrailsDepth':Util['createTexture'](_0x21854e),'nextTrailsColor':Util[_0x5186ac(0x125)](_0x506eb4),'nextTrailsDepth':Util[_0x5186ac(0x125)](_0x21854e),'colorTable':Util['createTexture'](_0x323aab,_0x42b07a)};}},{'key':_0x54211b(0x196),'value':function _0x54d47f(_0x4f2fa2){var _0xabc07f=_0x54211b;this['framebuffers']={'segments':Util[_0xabc07f(0x1cb)](_0x4f2fa2,this[_0xabc07f(0x1a3)]['segmentsColor'],this[_0xabc07f(0x1a3)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x4f2fa2,this['textures'][_0xabc07f(0x111)],this['textures']['currentTrailsDepth']),'nextTrails':Util[_0xabc07f(0x1cb)](_0x4f2fa2,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}},{'key':_0x54211b(0xdf),'value':function _0x34c3a9(_0x1b59a3){var _0x5d92ed=_0x54211b,_0x5aa39b=0x4,_0x2600ff=[];for(var _0x36de3f=0x0;_0x36de3f<_0x1b59a3['particlesTextureSize'];_0x36de3f++){for(var _0x15cf11=0x0;_0x15cf11<_0x1b59a3['particlesTextureSize'];_0x15cf11++){for(var _0x5c0d93=0x0;_0x5c0d93<_0x5aa39b;_0x5c0d93++){_0x2600ff['push'](_0x36de3f/_0x1b59a3[_0x5d92ed(0x155)]),_0x2600ff['push'](_0x15cf11/_0x1b59a3[_0x5d92ed(0x155)]);}}}_0x2600ff=new Float32Array(_0x2600ff);var _0x17faf1=[],_0x187451=[-0x1,0x1],_0x513616=[-0x1,0x1];for(var _0x376a3f=0x0;_0x376a3f<_0x1b59a3[_0x5d92ed(0x18a)];_0x376a3f++){for(var _0x3dc0cd=0x0;_0x3dc0cd<_0x5aa39b/0x2;_0x3dc0cd++){for(var _0x2e0b1a=0x0;_0x2e0b1a<_0x5aa39b/0x2;_0x2e0b1a++){_0x17faf1['push'](_0x187451[_0x3dc0cd]),_0x17faf1['push'](_0x513616[_0x2e0b1a]),_0x17faf1['push'](0x0);}}}_0x17faf1=new Float32Array(_0x17faf1);var _0x12f983=0x6*_0x1b59a3['maxParticles'],_0x5d1c74=new Uint32Array(_0x12f983);for(var _0x2f74aa=0x0,_0x24479f=0x0,_0x2bce88=0x0;_0x2f74aa<_0x1b59a3[_0x5d92ed(0x18a)];_0x2f74aa++){_0x5d1c74[_0x24479f++]=_0x2bce88+0x0,_0x5d1c74[_0x24479f++]=_0x2bce88+0x1,_0x5d1c74[_0x24479f++]=_0x2bce88+0x2,_0x5d1c74[_0x24479f++]=_0x2bce88+0x2,_0x5d1c74[_0x24479f++]=_0x2bce88+0x1,_0x5d1c74[_0x24479f++]=_0x2bce88+0x3,_0x2bce88+=0x4;}var _0x247dbe=new Cesium$4['Geometry']({'attributes':new Cesium$4[(_0x5d92ed(0x1a2))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x5d92ed(0x182)],'componentsPerAttribute':0x2,'values':_0x2600ff}),'normal':new Cesium$4[(_0x5d92ed(0xd3))]({'componentDatatype':Cesium$4[_0x5d92ed(0x1b8)][_0x5d92ed(0x182)],'componentsPerAttribute':0x3,'values':_0x17faf1})}),'indices':_0x5d1c74});return _0x247dbe;}},{'key':'createRenderingPrimitives','value':function _0x547a78(_0x26d424,_0xe292e2,_0xdbcb86,_0x128e11){var _0x3a70d5=_0x54211b,_0x55fb13=this;this[_0x3a70d5(0x176)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0xe292e2),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function _0x310094(){return _0x128e11['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function _0x8e1e77(){return _0x128e11['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function _0x5fe06c(){return _0x128e11['particlesTextures']['postProcessingSpeed'];},'colorTable':function _0xd4e297(){var _0x55fde0=_0x3a70d5;return _0x55fb13[_0x55fde0(0x1a3)]['colorTable'];},'aspect':function _0xc62254(){return _0x26d424['drawingBufferWidth']/_0x26d424['drawingBufferHeight'];},'pixelSize':function _0x2a4ae5(){return _0xdbcb86['pixelSize'];},'lineWidth':function _0x12d645(){return _0xe292e2['lineWidth'];},'particleHeight':function _0xf602e7(){var _0x4430cd=_0x3a70d5;return _0xe292e2[_0x4430cd(0x188)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x3a70d5(0x18e)][_0x3a70d5(0x112)],'uniformMap':{'segmentsColorTexture':function _0x3ac31e(){var _0x3256ca=_0x3a70d5;return _0x55fb13[_0x3256ca(0x1a3)]['segmentsColor'];},'segmentsDepthTexture':function _0x3b25fe(){var _0x58acc7=_0x3a70d5;return _0x55fb13[_0x58acc7(0x1a3)]['segmentsDepth'];},'currentTrailsColor':function _0x331ed7(){var _0x185171=_0x3a70d5;return _0x55fb13['framebuffers']['currentTrails'][_0x185171(0x107)](0x0);},'trailsDepthTexture':function _0x43d2df(){var _0x18a8fe=_0x3a70d5;return _0x55fb13['framebuffers'][_0x18a8fe(0x19e)]['depthTexture'];},'fadeOpacity':function _0x31acc2(){return _0xe292e2['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x3a70d5(0x18d)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function _0x631c91(){var _0x46330c=_0x3a70d5,_0x57fd2e=_0x55fb13[_0x46330c(0x13f)]['currentTrails'];_0x55fb13['framebuffers']['currentTrails']=_0x55fb13['framebuffers']['nextTrails'],_0x55fb13['framebuffers']['nextTrails']=_0x57fd2e,_0x55fb13['primitives'][_0x46330c(0x1b2)]['commandToExecute']['framebuffer']=_0x55fb13['framebuffers']['nextTrails'],_0x55fb13[_0x46330c(0x176)]['trails']['clearCommand']['framebuffer']=_0x55fb13[_0x46330c(0x13f)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x3a70d5(0x184)](),'primitiveType':Cesium$4['PrimitiveType'][_0x3a70d5(0x112)],'uniformMap':{'trailsColorTexture':function _0x4e91d5(){var _0x17fd1f=_0x3a70d5;return _0x55fb13['framebuffers']['nextTrails'][_0x17fd1f(0x107)](0x0);},'trailsDepthTexture':function _0x4c47e6(){var _0xafcec9=_0x3a70d5;return _0x55fb13['framebuffers'][_0xafcec9(0x101)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x3a70d5(0x166))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}]),_0x1b251b;}()),getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x20\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture2D(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture2D(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}',updateSpeed_frag=_0x27700f(0x170),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture2D(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture2D(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture2D(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture2D(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture2D(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture2D(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}',Cesium$3=mars3d__namespace['Cesium'],ParticlesComputing=(function(){var _0x11522b=_0x27700f;function _0x42d198(_0x53a59d,_0x3651c2,_0x387e85,_0x2a9e72){_classCallCheck(this,_0x42d198),this['data']=_0x3651c2,this['createWindTextures'](_0x53a59d,_0x3651c2),this['createParticlesTextures'](_0x53a59d,_0x387e85,_0x2a9e72),this['createComputingPrimitives'](_0x3651c2,_0x387e85,_0x2a9e72);}return _createClass(_0x42d198,[{'key':'createWindTextures','value':function _0x39cb18(_0x48af3e,_0xb572bd){var _0x57e5cc=_0x4aac,_0x1ec2cc={'context':_0x48af3e,'width':_0xb572bd['dimensions'][_0x57e5cc(0xe1)],'height':_0xb572bd[_0x57e5cc(0x175)]['lat']*(_0xb572bd[_0x57e5cc(0x175)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x57e5cc(0x1c0)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this[_0x57e5cc(0x1b1)]={'U':Util['createTexture'](_0x1ec2cc,_0xb572bd['U']['array']),'V':Util[_0x57e5cc(0x125)](_0x1ec2cc,_0xb572bd['V']['array'])};}},{'key':_0x11522b(0x161),'value':function _0x3c028d(_0x5de26e,_0x398a96,_0x4be317){var _0x423fe5=_0x11522b,_0x1a546a={'context':_0x5de26e,'width':_0x398a96[_0x423fe5(0x155)],'height':_0x398a96['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x423fe5(0x194)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x423fe5(0x16c)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x423fe5(0x1c0)]})},_0x11c2d7=this[_0x423fe5(0x119)](_0x398a96['maxParticles'],_0x4be317),_0x4744dd=new Float32Array(0x4*_0x398a96['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x1a546a),'currentParticlesPosition':Util[_0x423fe5(0x125)](_0x1a546a,_0x11c2d7),'nextParticlesPosition':Util['createTexture'](_0x1a546a,_0x11c2d7),'currentParticlesSpeed':Util['createTexture'](_0x1a546a,_0x4744dd),'nextParticlesSpeed':Util['createTexture'](_0x1a546a,_0x4744dd),'postProcessingPosition':Util['createTexture'](_0x1a546a,_0x11c2d7),'postProcessingSpeed':Util['createTexture'](_0x1a546a,_0x4744dd)};}},{'key':'randomizeParticles','value':function _0x4f71c1(_0x4ca9e0,_0x41424e){var _0x1dffc4=_0x11522b,_0x1cde18=new Float32Array(0x4*_0x4ca9e0);for(var _0x1c4a69=0x0;_0x1c4a69<_0x4ca9e0;_0x1c4a69++){_0x1cde18[0x4*_0x1c4a69]=Cesium$3[_0x1dffc4(0x152)]['randomBetween'](_0x41424e['lonRange']['x'],_0x41424e['lonRange']['y']),_0x1cde18[0x4*_0x1c4a69+0x1]=Cesium$3['Math'][_0x1dffc4(0x19a)](_0x41424e[_0x1dffc4(0x183)]['x'],_0x41424e['latRange']['y']),_0x1cde18[0x4*_0x1c4a69+0x2]=Cesium$3[_0x1dffc4(0x152)][_0x1dffc4(0x19a)](this['data']['lev']['min'],this['data'][_0x1dffc4(0x1ba)][_0x1dffc4(0x178)]),_0x1cde18[0x4*_0x1c4a69+0x3]=0x0;}return _0x1cde18;}},{'key':'destroyParticlesTextures','value':function _0x4812f8(){var _0x282436=this;Object['keys'](this['particlesTextures'])['forEach'](function(_0xd6f634){var _0x29b169=_0x4aac;_0x282436['particlesTextures'][_0xd6f634][_0x29b169(0xe8)]();});}},{'key':'createComputingPrimitives','value':function _0xd027e4(_0x7c4f34,_0x4cb616,_0x4bb43f){var _0x338217=_0x11522b,_0x42fa55=new Cesium$3['Cartesian3'](_0x7c4f34['dimensions']['lon'],_0x7c4f34['dimensions'][_0x338217(0xcc)],_0x7c4f34['dimensions']['lev']),_0x5eb44d=new Cesium$3['Cartesian3'](_0x7c4f34[_0x338217(0xe1)]['min'],_0x7c4f34['lat']['min'],_0x7c4f34[_0x338217(0x1ba)]['min']),_0x442cd0=new Cesium$3['Cartesian3'](_0x7c4f34[_0x338217(0xe1)]['max'],_0x7c4f34['lat']['max'],_0x7c4f34['lev']['max']),_0x17c9c1=new Cesium$3['Cartesian3']((_0x442cd0['x']-_0x5eb44d['x'])/(_0x42fa55['x']-0x1),(_0x442cd0['y']-_0x5eb44d['y'])/(_0x42fa55['y']-0x1),_0x42fa55['z']>0x1?(_0x442cd0['z']-_0x5eb44d['z'])/(_0x42fa55['z']-0x1):0x1),_0x3f03bd=new Cesium$3[(_0x338217(0x168))](_0x7c4f34['U'][_0x338217(0x134)],_0x7c4f34['U']['max']),_0x197905=new Cesium$3['Cartesian2'](_0x7c4f34['V']['min'],_0x7c4f34['V']['max']),_0x4b9396=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function _0x14d03a(){var _0x5a52ab=_0x338217;return _0x4b9396[_0x5a52ab(0x1b1)]['U'];},'V':function _0x537ae5(){return _0x4b9396['windTextures']['V'];},'currentParticlesPosition':function _0x5e812c(){var _0x5c9747=_0x338217;return _0x4b9396[_0x5c9747(0xf9)]['currentParticlesPosition'];},'dimension':function _0x4bcb07(){return _0x42fa55;},'minimum':function _0x54e37a(){return _0x5eb44d;},'maximum':function _0x7b498c(){return _0x442cd0;},'interval':function _0x420378(){return _0x17c9c1;}},'fragmentShaderSource':new Cesium$3[(_0x338217(0x166))]({'sources':[getWind_frag]}),'outputTexture':this[_0x338217(0xf9)]['particlesWind'],'preExecute':function _0x1e1347(){var _0x572ae5=_0x338217;_0x4b9396['primitives']['getWind']['commandToExecute']['outputTexture']=_0x4b9396[_0x572ae5(0xf9)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x338217(0x1a5),'uniformMap':{'currentParticlesSpeed':function _0x19100d(){var _0x5e9186=_0x338217;return _0x4b9396[_0x5e9186(0xf9)]['currentParticlesSpeed'];},'particlesWind':function _0x43d7f6(){return _0x4b9396['particlesTextures']['particlesWind'];},'uSpeedRange':function _0x2ba4ce(){return _0x3f03bd;},'vSpeedRange':function _0x5b0115(){return _0x197905;},'pixelSize':function _0x1bab47(){return _0x4bb43f['pixelSize'];},'speedFactor':function _0x348d67(){return _0x4cb616['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x338217(0x120)],'preExecute':function _0x2ac098(){var _0xe14c2f=_0x338217,_0x5eda4f=_0x4b9396['particlesTextures'][_0xe14c2f(0xd6)];_0x4b9396['particlesTextures'][_0xe14c2f(0xd6)]=_0x4b9396[_0xe14c2f(0xf9)]['postProcessingSpeed'],_0x4b9396['particlesTextures'][_0xe14c2f(0xea)]=_0x5eda4f,_0x4b9396[_0xe14c2f(0x176)]['updateSpeed']['commandToExecute']['outputTexture']=_0x4b9396['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x338217(0x1a5),'uniformMap':{'currentParticlesPosition':function _0x573297(){var _0x27c381=_0x338217;return _0x4b9396[_0x27c381(0xf9)]['currentParticlesPosition'];},'currentParticlesSpeed':function _0x311972(){var _0x38d146=_0x338217;return _0x4b9396[_0x38d146(0xf9)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x338217(0xf9)]['nextParticlesPosition'],'preExecute':function _0xcfb628(){var _0x3a50bd=_0x338217,_0x54ea8c=_0x4b9396['particlesTextures']['currentParticlesPosition'];_0x4b9396[_0x3a50bd(0xf9)][_0x3a50bd(0xe5)]=_0x4b9396['particlesTextures']['postProcessingPosition'],_0x4b9396['particlesTextures']['postProcessingPosition']=_0x54ea8c,_0x4b9396[_0x3a50bd(0x176)]['updatePosition']['commandToExecute']['outputTexture']=_0x4b9396[_0x3a50bd(0xf9)][_0x3a50bd(0x13a)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x338217(0x1a5),'uniformMap':{'nextParticlesPosition':function _0x1dfa7c(){return _0x4b9396['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function _0x47308b(){var _0x1f1dc4=_0x338217;return _0x4b9396[_0x1f1dc4(0xf9)]['nextParticlesSpeed'];},'lonRange':function _0x5d87be(){return _0x4bb43f['lonRange'];},'latRange':function _0x497444(){var _0x527ba3=_0x338217;return _0x4bb43f[_0x527ba3(0x183)];},'randomCoefficient':function _0xc79b1e(){var _0x22ea5b=Math['random']();return _0x22ea5b;},'dropRate':function _0x8a0ff5(){return _0x4cb616['dropRate'];},'dropRateBump':function _0x335c7d(){return _0x4cb616['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function _0x472ab8(){var _0x1aa287=_0x338217;_0x4b9396['primitives']['postProcessingPosition']['commandToExecute'][_0x1aa287(0x1af)]=_0x4b9396['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function _0x228b24(){var _0x52bd89=_0x338217;return _0x4b9396[_0x52bd89(0xf9)][_0x52bd89(0x148)];},'nextParticlesSpeed':function _0x4dd476(){return _0x4b9396['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function _0x5b80ad(){var _0x23216f=_0x338217;_0x4b9396['primitives']['postProcessingSpeed']['commandToExecute'][_0x23216f(0x1af)]=_0x4b9396[_0x23216f(0xf9)][_0x23216f(0xea)];}})};}}]),_0x42d198;}()),Cesium$2=mars3d__namespace['Cesium'],ParticleSystem=(function(){var _0x294fa8=_0x27700f;function _0x3744a2(_0x309b23,_0x387568,_0x1e842d,_0x129885){var _0x313da4=_0x4aac;_classCallCheck(this,_0x3744a2),this[_0x313da4(0xe6)]=_0x309b23,_0x387568=_objectSpread2({},_0x387568);if(_0x387568[_0x313da4(0x110)]&&_0x387568['vdata']){var _0x409562,_0x5730f9,_0x324ded,_0x664855,_0x20cb5a,_0x3ec553;_0x387568[_0x313da4(0x175)]={},_0x387568['dimensions']['lon']=_0x387568['cols'],_0x387568['dimensions']['lat']=_0x387568['rows'],_0x387568['dimensions']['lev']=_0x387568[_0x313da4(0x1ba)]||0x1,_0x387568['lon']={},_0x387568['lon']['min']=_0x387568['xmin'],_0x387568[_0x313da4(0xe1)]['max']=_0x387568['xmax'],_0x387568[_0x313da4(0xcc)]={},_0x387568['lat']['min']=_0x387568['ymin'],_0x387568[_0x313da4(0xcc)][_0x313da4(0x178)]=_0x387568[_0x313da4(0x199)],_0x387568['lev']={},_0x387568['lev']['min']=(_0x409562=_0x387568['levmin'])!==null&&_0x409562!==void 0x0?_0x409562:0x1,_0x387568['lev']['max']=(_0x5730f9=_0x387568[_0x313da4(0x1a8)])!==null&&_0x5730f9!==void 0x0?_0x5730f9:0x1,_0x387568['U']={},_0x387568['U']['array']=new Float32Array(_0x387568['udata']),_0x387568['U'][_0x313da4(0x134)]=(_0x324ded=_0x387568['umin'])!==null&&_0x324ded!==void 0x0?_0x324ded:Math['min']['apply'](Math,_toConsumableArray(_0x387568['udata'])),_0x387568['U']['max']=(_0x664855=_0x387568[_0x313da4(0x1bb)])!==null&&_0x664855!==void 0x0?_0x664855:Math[_0x313da4(0x178)]['apply'](Math,_toConsumableArray(_0x387568['udata'])),_0x387568['V']={},_0x387568['V'][_0x313da4(0x187)]=new Float32Array(_0x387568['vdata']),_0x387568['V']['min']=(_0x20cb5a=_0x387568['vmin'])!==null&&_0x20cb5a!==void 0x0?_0x20cb5a:Math[_0x313da4(0x134)][_0x313da4(0xfc)](Math,_toConsumableArray(_0x387568['vdata'])),_0x387568['V'][_0x313da4(0x178)]=(_0x3ec553=_0x387568[_0x313da4(0xd9)])!==null&&_0x3ec553!==void 0x0?_0x3ec553:Math['max']['apply'](Math,_toConsumableArray(_0x387568[_0x313da4(0x1aa)]));}this[_0x313da4(0x144)]=_0x387568,this['options']=_0x1e842d,this[_0x313da4(0xd1)]=_0x129885,this['particlesComputing']=new ParticlesComputing(this[_0x313da4(0xe6)],this[_0x313da4(0x144)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x313da4(0x108)],this['viewerParameters'],this['particlesComputing']);}return _createClass(_0x3744a2,[{'key':'canvasResize','value':function _0x114b64(_0x321862){var _0xb6be34=_0x4aac,_0x3f768c=this;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0xb6be34(0x14f)][_0xb6be34(0x1b1)])[_0xb6be34(0xf4)](function(_0xff45a3){var _0x83d3b1=_0xb6be34;_0x3f768c[_0x83d3b1(0x14f)]['windTextures'][_0xff45a3]['destroy']();}),this[_0xb6be34(0x17e)]['textures']['colorTable'][_0xb6be34(0xe8)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](function(_0x1a4ca4){_0x3f768c['particlesRendering']['framebuffers'][_0x1a4ca4]['destroy']();}),this['context']=_0x321862,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0xb6be34(0x144)],this['options'],this['viewerParameters'],this['particlesComputing']);}},{'key':'clearFramebuffers','value':function _0x5b7d02(){var _0x2b0891=_0x4aac,_0x2b7137=this,_0x161807=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x2b0891(0x17d)]});Object['keys'](this['particlesRendering']['framebuffers'])[_0x2b0891(0xf4)](function(_0x57c1a0){var _0x4fea0d=_0x2b0891;_0x161807['framebuffer']=_0x2b7137[_0x4fea0d(0x17e)]['framebuffers'][_0x57c1a0],_0x161807['execute'](_0x2b7137['context']);});}},{'key':'refreshParticles','value':function _0x5dc36b(_0x166998){var _0x53eb51=_0x4aac;this[_0x53eb51(0x1a4)](),this['particlesComputing'][_0x53eb51(0x157)](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x166998){var _0x4e532b=this[_0x53eb51(0x17e)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x4e532b;var _0x2cb174=Cesium$2['VertexArray'][_0x53eb51(0x18c)]({'context':this['context'],'geometry':_0x4e532b,'attributeLocations':this[_0x53eb51(0x17e)]['primitives']['segments'][_0x53eb51(0x1ca)],'bufferUsage':Cesium$2[_0x53eb51(0x126)][_0x53eb51(0xe9)]});this[_0x53eb51(0x17e)]['primitives']['segments'][_0x53eb51(0x147)]['vertexArray']=_0x2cb174;}}},{'key':_0x294fa8(0x135),'value':function _0x4e2245(_0x8105c){var _0x111351=_0x294fa8,_0x7b5b5f=this,_0x3d5691=![];this[_0x111351(0x108)][_0x111351(0x18a)]!==_0x8105c['maxParticles']&&(_0x3d5691=!![]),Object['keys'](_0x8105c)[_0x111351(0xf4)](function(_0x315234){_0x7b5b5f['options'][_0x315234]=_0x8105c[_0x315234];}),this['refreshParticles'](_0x3d5691);}},{'key':'applyViewerParameters','value':function _0x1b1f76(_0x31aff4){var _0xddb150=_0x294fa8,_0x56230e=this;Object['keys'](_0x31aff4)[_0xddb150(0xf4)](function(_0x4f73e7){_0x56230e['viewerParameters'][_0x4f73e7]=_0x31aff4[_0x4f73e7];}),this['refreshParticles'](![]);}},{'key':'destroy','value':function _0x2d4c64(){var _0x2cb01d=_0x294fa8,_0x450c02=this;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x2cb01d(0x157)](),Object[_0x2cb01d(0x100)](this['particlesComputing'][_0x2cb01d(0x1b1)])['forEach'](function(_0x4e8a27){var _0x127f6c=_0x2cb01d;_0x450c02['particlesComputing']['windTextures'][_0x4e8a27][_0x127f6c(0xe8)]();}),this[_0x2cb01d(0x17e)]['textures']['colorTable'][_0x2cb01d(0xe8)](),Object['keys'](this['particlesRendering'][_0x2cb01d(0x13f)])['forEach'](function(_0x4c5a4f){_0x450c02['particlesRendering']['framebuffers'][_0x4c5a4f]['destroy']();});for(var _0x1745ee in this){delete this[_0x1745ee];}}}]),_0x3744a2;}()),Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x27700f(0x1bd)]},WindLayer=function(_0xc92db3){var _0x59dd3a=_0x27700f;_inherits(_0xe8067,_0xc92db3);var _0xc2b80d=_createSuper(_0xe8067);function _0xe8067(){var _0x20406d=_0x4aac,_0x3fdac,_0x1c251d=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0xe8067),_0x1c251d=_objectSpread2(_objectSpread2({},DEF_OPTIONS),_0x1c251d),_0x3fdac=_0xc2b80d[_0x20406d(0x140)](this,_0x1c251d),_0x3fdac['_setOptionsHook'](_0x1c251d),_0x3fdac;}return _createClass(_0xe8067,[{'key':'layer','get':function _0x415a14(){return this['primitives'];}},{'key':'data','get':function _0x7a5fdd(){return this['_data'];},'set':function _0xbcce1b(_0x2fdc6){this['setData'](_0x2fdc6);}},{'key':_0x59dd3a(0x15d),'get':function _0x21fb4a(){return this['options']['colors'];},'set':function _0x5aa580(_0xe0b8ca){var _0x32671b=_0x59dd3a;this['options']['colors']=_0xe0b8ca,this['particleSystem']&&this[_0x32671b(0x131)][_0x32671b(0x135)]({'colors':_0xe0b8ca}),this['resize']();}},{'key':_0x59dd3a(0x169),'value':function _0x53ae1d(){}},{'key':'_addedHook','value':function _0x262f05(){var _0x483b9e=_0x59dd3a;this['scene']=this['_map'][_0x483b9e(0x10c)],this['camera']=this[_0x483b9e(0x12e)]['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x483b9e(0x10c)]['primitives'][_0x483b9e(0x190)](this[_0x483b9e(0x176)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x483b9e(0x163)],0.99*0x615299),this[_0x483b9e(0x15b)](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x483b9e(0x13d)],this),this[_0x483b9e(0x12e)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x483b9e(0x12e)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x483b9e(0x186)],this[_0x483b9e(0x174)],this),this['_data']&&this['setData'](this[_0x483b9e(0xee)]);}},{'key':'_removedHook','value':function _0x51667d(){var _0x39d76a=_0x59dd3a;window[_0x39d76a(0x115)](_0x39d76a(0xd5),this[_0x39d76a(0xd5)]),this[_0x39d76a(0x12e)][_0x39d76a(0x1cc)](mars3d__namespace['EventType']['preRender'],this[_0x39d76a(0x191)],this),this[_0x39d76a(0x12e)][_0x39d76a(0x1cc)](mars3d__namespace['EventType'][_0x39d76a(0x123)],this[_0x39d76a(0x13d)],this),this[_0x39d76a(0x12e)][_0x39d76a(0x1cc)](mars3d__namespace[_0x39d76a(0x1c4)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x39d76a(0x145)],this[_0x39d76a(0x154)],this),this['_map']['off'](mars3d__namespace[_0x39d76a(0x1c4)][_0x39d76a(0x186)],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x39d76a(0x12e)]['scene'][_0x39d76a(0x176)]['remove'](this[_0x39d76a(0x176)]);}},{'key':'resize','value':function _0x41551c(){var _0x13af41=_0x59dd3a;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this[_0x13af41(0x191)],this);}},{'key':'_onMap_preRenderEvent','value':function _0x244246(_0x519abc){var _0x286fbf=_0x59dd3a;this['particleSystem'][_0x286fbf(0x17b)](this['scene']['context']),this[_0x286fbf(0x10a)](),this['primitives']['show']=!![];}},{'key':'_onMapWhellEvent','value':function _0x5f180a(_0x52908a){var _0x527238=_0x59dd3a,_0x575275=this;clearTimeout(this[_0x527238(0x12d)]);if(!this['show']||!this[_0x527238(0x131)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(function(){if(!_0x575275['show'])return;_0x575275['redraw']();},0xc8);}},{'key':'_onMouseDownEvent','value':function _0x44130f(_0x39abe9){this['mouse_down']=!![];}},{'key':'_onMouseMoveEvent','value':function _0x4d59e8(_0x1b36ad){var _0x2a999a=_0x59dd3a;if(!this['show']||!this[_0x2a999a(0x131)])return;this[_0x2a999a(0x132)]&&(this['primitives']['show']=![],this[_0x2a999a(0x116)]=!![]);}},{'key':'_onMouseUpEvent','value':function _0x3a9b4c(_0x4608f8){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}},{'key':'redraw','value':function _0x6188c6(){var _0x21ade3=_0x59dd3a;if(!this['_map']||!this[_0x21ade3(0xfb)])return;this['updateViewerParameters'](),this[_0x21ade3(0x131)][_0x21ade3(0x104)](this['viewerParameters']),this['primitives']['show']=!![];}},{'key':'setData','value':function _0x447f26(_0x37ca60){var _0xa37d15=_0x59dd3a;this[_0xa37d15(0xee)]=_0x37ca60,this['particleSystem']&&this['particleSystem'][_0xa37d15(0xe8)](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x37ca60,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}},{'key':'_setOptionsHook','value':function _0x5a8adc(_0x14ba34,_0x4659bc){var _0x1f813c=_0x59dd3a;if(_0x14ba34)for(var _0x47dedd in _0x14ba34){this[_0x47dedd]=_0x14ba34[_0x47dedd];}this[_0x1f813c(0x131)]&&this['particleSystem']['setOptions'](this['getOptions']());}},{'key':_0x59dd3a(0x14e),'value':function _0x3b3e69(){var _0x45d305=_0x59dd3a,_0xc45d47=Math[_0x45d305(0x1c6)](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0xc45d47*_0xc45d47,{'particlesTextureSize':_0xc45d47,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x45d305(0x17c)],'lineWidth':this['lineWidth'],'colors':this['colors']};}},{'key':_0x59dd3a(0x10a),'value':function _0x48ef01(){var _0x44f8bb=_0x59dd3a;this['primitives'][_0x44f8bb(0x190)](this['particleSystem'][_0x44f8bb(0x14f)][_0x44f8bb(0x176)][_0x44f8bb(0x15e)]),this['primitives']['add'](this[_0x44f8bb(0x131)]['particlesComputing']['primitives'][_0x44f8bb(0x103)]),this['primitives'][_0x44f8bb(0x190)](this[_0x44f8bb(0x131)][_0x44f8bb(0x14f)]['primitives'][_0x44f8bb(0x1c9)]),this['primitives']['add'](this['particleSystem'][_0x44f8bb(0x14f)]['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem'][_0x44f8bb(0x14f)]['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives'][_0x44f8bb(0x190)](this[_0x44f8bb(0x131)]['particlesRendering'][_0x44f8bb(0x176)]['trails']),this[_0x44f8bb(0x176)][_0x44f8bb(0x190)](this[_0x44f8bb(0x131)]['particlesRendering'][_0x44f8bb(0x176)]['screen']);}},{'key':'updateViewerParameters','value':function _0x2d8d67(){var _0x17aec6=_0x59dd3a,_0x242566=this[_0x17aec6(0xfe)]['computeViewRectangle'](this['scene']['globe'][_0x17aec6(0x1c7)]);if(!_0x242566){var _0x574552=this[_0x17aec6(0x12e)]['getExtent']();_0x242566=Cesium$1['Rectangle'][_0x17aec6(0x16f)](_0x574552['xmin'],_0x574552['ymin'],_0x574552[_0x17aec6(0xef)],_0x574552[_0x17aec6(0x199)]);}var _0x5267b2=Util['viewRectangleToLonLatRange'](_0x242566);this['viewerParameters']['lonRange']['x']=_0x5267b2['lon'][_0x17aec6(0x134)],this['viewerParameters']['lonRange']['y']=_0x5267b2['lon']['max'],this[_0x17aec6(0xd1)]['latRange']['x']=_0x5267b2['lat'][_0x17aec6(0x134)],this['viewerParameters'][_0x17aec6(0x183)]['y']=_0x5267b2['lat'][_0x17aec6(0x178)];var _0xade568=this['camera'][_0x17aec6(0x129)](this['globeBoundingSphere'],this[_0x17aec6(0x10c)]['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0xade568>0x0&&(this[_0x17aec6(0xd1)]['pixelSize']=_0xade568);}}]),_0xe8067;}(BaseLayer$1);mars3d__namespace['LayerUtil'][_0x27700f(0x15a)]('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;function _0x9613(){var _0x1f99c6=['getOwnPropertyDescriptor','container','length','sqrt','toDegrees','createSegmentsGeometry','9mSnBxe','lon','commandType','getContext','age','currentParticlesPosition','context','canvasWind','destroy','STATIC_DRAW','postProcessingSpeed','function','1442ZozrkA','PI_OVER_THREE','_data','xmax','414798IcNmJV','LayerUtil','string','_calc_speedRate','forEach','constructor','pointerEvents','pointer-events','name','particlesTextures','depthTest','show','apply','windField','camera','undefined','keys','nextTrails','EllipsoidalOccluder','updateSpeed','applyViewerParameters','getParticles','globalCompositeOperation','getColorTexture','options','geometry','addPrimitives','_drawLines','scene','bindEvent','UNSIGNED_BYTE','getPrototypeOf','udata','currentTrailsColor','TRIANGLES','5132752GGLgGu','windData','removeEventListener','mouse_move','style','161lPYGOf','randomizeParticles','prototype','RGB','_tomap','mouseDown','_speedRate','canvas','nextParticlesSpeed','CanvasWindField','globe','wheel','fixedHeight','createTexture','BufferUsage','5546424BPROlD','construct','getPixelSize','rawRenderState','Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function','xmin','refreshTimer','_map','frameTime','_updateIng','particleSystem','mouse_down','cos','min','setOptions','lineWidth','createCommand','create','hidden','nextParticlesPosition','shaderProgram','commandList','_onMapWhellEvent','height','framebuffers','call','drawingBufferHeight','SCENE3D','clientHeight','data','mouseUp','particles','commandToExecute','postProcessingPosition','PixelFormat','PixelDatatype','default','1616196iUtoLz','__proto__','getOptions','particlesComputing','fromCache','redraw','Math','_removedHook','_onMouseUpEvent','particlesTextureSize','maxAge','destroyParticlesTextures','#ffffff','canvasHeight','register','updateViewerParameters','_calcUV','colors','getWind','TWO_PI','frameRate','createParticlesTextures','canvasWindy','ZERO','tlat','isArray','ShaderSource','fragmentShaderSource','Cartesian2','_mountedHook','tlng','LINEAR','TextureMinificationFilter','1163wIHHFz','preExecute','fromDegrees','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture2D(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture2D(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20nextSpeed;\x0a}','animateFrame','cols','clearCommand','_onMouseMoveEvent','dimensions','primitives','RenderState','max','layer','class','canvasResize','speedFactor','OPAQUE','particlesRendering','setAttribute','attribute\x20vec3\x20position;\x0d\x0aattribute\x20vec2\x20st;\x0d\x0a\x0d\x0avarying\x20vec2\x20textureCoordinate;\x0d\x0a\x0d\x0avoid\x20main()\x20{\x0d\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0d\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0d\x0a}','CanvasWindLayer','FLOAT','latRange','getFullscreenQuad','ymin','mouseMove','array','particleHeight','defineProperty','maxParticles','SceneTransforms','fromGeometry','createRawRenderState','PrimitiveType','fillRect','add','_onMap_preRenderEvent','IDENTITY','update','RGBA','2650pTcTCt','createRenderingFramebuffers','visibility','uniform\x20sampler2D\x20trailsColorTexture;\x0d\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0d\x0a\x0d\x0avarying\x20vec2\x20textureCoordinate;\x0d\x0a\x0d\x0avoid\x20main()\x20{\x0d\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture2D(trailsColorTexture,\x20textureCoordinate);\x0d\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture2D(trailsDepthTexture,\x20textureCoordinate).r;\x0d\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture2D(czm_globeDepthTexture,\x20textureCoordinate));\x0d\x0a\x0d\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20trailsColor;\x0d\x0a\x20\x20\x20\x20}\x20else\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0);\x0d\x0a\x20\x20\x20\x20}\x0d\x0a}','ymax','randomBetween','primitiveType','getUVByPoint','173074sQyPks','currentTrails','onmessage','Draw','attribute\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0aattribute\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0avarying\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x20\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x20\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x20\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture2D(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture2D(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture2D(postProcessingSpeed,\x20particleIndex).a;\x0a}','GeometryAttributes','textures','clearFramebuffers','Compute','mod','depthMask','levmax','grid','vdata','ShaderProgram','canvasContext','unbindEvent','WindUtil','outputTexture','postMessage','windTextures','trails','lng','clear','createRenderingTextures','_canrefresh','color','ComponentDatatype','Sampler','lev','umax','value','rgb(206,255,255)','100%','canvasWidth','NEAREST','uniformMap','speedRate','worker','EventType','defined','ceil','ellipsoid','rows','updatePosition','attributeLocations','createFramebuffer','off','test','lat','5342315qemQJb','none','PI_OVER_TWO','strokeStyle','viewerParameters','Cesium','GeometryAttribute','push','resize','currentParticlesSpeed','absolute','setPrototypeOf','vmax'];_0x9613=function(){return _0x1f99c6;};return _0x9613();}var CanvasParticle=(function(){var _0x2f0e87=_0x27700f;function _0x35b8b3(){var _0x519316=_0x4aac;_classCallCheck(this,_0x35b8b3),this[_0x519316(0x1b3)]=null,this[_0x519316(0xcc)]=null,this['tlng']=null,this['tlat']=null,this['age']=null;}return _createClass(_0x35b8b3,[{'key':_0x2f0e87(0xe8),'value':function _0x494ea7(){for(var _0x3f1b49 in this){delete this[_0x3f1b49];}}}]),_0x35b8b3;}()),CanvasWindField=(function(){function _0x1f79be(_0x14438f){_classCallCheck(this,_0x1f79be),this['setOptions'](_0x14438f);}return _createClass(_0x1f79be,[{'key':'speedRate','get':function _0x56784a(){return this['_speedRate'];},'set':function _0x168b2d(_0x5bd2d5){var _0xa1c38=_0x4aac;this[_0xa1c38(0x11e)]=(0x64-(_0x5bd2d5>0x63?0x63:_0x5bd2d5))*0x64,this[_0xa1c38(0xf3)]=[(this[_0xa1c38(0xef)]-this[_0xa1c38(0x12c)])/this['_speedRate'],(this[_0xa1c38(0x199)]-this[_0xa1c38(0x185)])/this['_speedRate']];}},{'key':'maxAge','get':function _0x4c6ede(){return this['_maxAge'];},'set':function _0x44f167(_0x5acea2){this['_maxAge']=_0x5acea2;}},{'key':'setOptions','value':function _0x520c79(_0x2011d6){var _0x5236d9=_0x4aac;this['options']=_0x2011d6,this['maxAge']=_0x2011d6['maxAge']||0x78,this[_0x5236d9(0x1c2)]=_0x2011d6['speedRate']||0x32,this['particles']=[];var _0x43c34e=_0x2011d6['particlesNumber']||0x1000;for(var _0x520ab7=0x0;_0x520ab7<_0x43c34e;_0x520ab7++){var _0x29f407=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x29f407);}}},{'key':'setDate','value':function _0x14458e(_0x283891){var _0x45bc85=_0x4aac;this[_0x45bc85(0x1c8)]=_0x283891['rows'],this['cols']=_0x283891[_0x45bc85(0x172)],this['xmin']=_0x283891['xmin'],this['xmax']=_0x283891[_0x45bc85(0xef)],this['ymin']=_0x283891['ymin'],this['ymax']=_0x283891[_0x45bc85(0x199)],this['grid']=[];var _0x1413c0=_0x283891[_0x45bc85(0x110)],_0x2769b5=_0x283891[_0x45bc85(0x1aa)],_0x25f7b1=![];_0x1413c0['length']===this['rows']&&_0x1413c0[0x0][_0x45bc85(0xdc)]===this['cols']&&(_0x25f7b1=!![]);var _0x24b3c3=0x0,_0x553afc=null,_0x15572f=null;for(var _0x2ce221=0x0;_0x2ce221<this['rows'];_0x2ce221++){_0x553afc=[];for(var _0x31c457=0x0;_0x31c457<this[_0x45bc85(0x172)];_0x31c457++,_0x24b3c3++){_0x25f7b1?_0x15572f=this['_calcUV'](_0x1413c0[_0x2ce221][_0x31c457],_0x2769b5[_0x2ce221][_0x31c457]):_0x15572f=this['_calcUV'](_0x1413c0[_0x24b3c3],_0x2769b5[_0x24b3c3]),_0x553afc[_0x45bc85(0xd4)](_0x15572f);}this['grid']['push'](_0x553afc);}this['options']['reverseY']&&this['grid']['reverse']();}},{'key':'clear','value':function _0x78c1a0(){var _0x454eed=_0x4aac;delete this['rows'],delete this[_0x454eed(0x172)],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this[_0x454eed(0x199)],delete this[_0x454eed(0x1a9)],delete this[_0x454eed(0x146)];}},{'key':'toGridXY','value':function _0x3ceb23(_0x3cc672,_0x3fcd5d){var _0x51dcba=_0x4aac,_0x714ed7=(_0x3cc672-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x5d4007=(this['ymax']-_0x3fcd5d)/(this['ymax']-this['ymin'])*(this[_0x51dcba(0x1c8)]-0x1);return[_0x714ed7,_0x5d4007];}},{'key':'getUVByXY','value':function _0x4a6b8b(_0x5827d5,_0x2327ea){if(_0x5827d5<0x0||_0x5827d5>=this['cols']||_0x2327ea>=this['rows'])return[0x0,0x0,0x0];var _0x477453=Math['floor'](_0x5827d5),_0x1cc1c7=Math['floor'](_0x2327ea);if(_0x477453===_0x5827d5&&_0x1cc1c7===_0x2327ea)return this['grid'][_0x2327ea][_0x5827d5];var _0x17ad10=_0x477453+0x1,_0x4464cd=_0x1cc1c7+0x1,_0x53aee9=this['getUVByXY'](_0x477453,_0x1cc1c7),_0x3ca489=this['getUVByXY'](_0x17ad10,_0x1cc1c7),_0x1b71b9=this['getUVByXY'](_0x477453,_0x4464cd),_0x1c856f=this['getUVByXY'](_0x17ad10,_0x4464cd),_0x2a6e10=null;try{_0x2a6e10=this['_bilinearInterpolation'](_0x5827d5-_0x477453,_0x2327ea-_0x1cc1c7,_0x53aee9,_0x3ca489,_0x1b71b9,_0x1c856f);}catch(_0x4d2724){console['log'](_0x5827d5,_0x2327ea);}return _0x2a6e10;}},{'key':'_bilinearInterpolation','value':function _0x1c930a(_0x515d6d,_0x9c954,_0x1d3b15,_0x3033ba,_0xb17456,_0x1461de){var _0x10963e=_0x4aac,_0x4b8f58=0x1-_0x515d6d,_0x651808=0x1-_0x9c954,_0x4f4a2e=_0x4b8f58*_0x651808,_0xe323b2=_0x515d6d*_0x651808,_0x5cab99=_0x4b8f58*_0x9c954,_0x4e2133=_0x515d6d*_0x9c954,_0x5daf63=_0x1d3b15[0x0]*_0x4f4a2e+_0x3033ba[0x0]*_0xe323b2+_0xb17456[0x0]*_0x5cab99+_0x1461de[0x0]*_0x4e2133,_0x455127=_0x1d3b15[0x1]*_0x4f4a2e+_0x3033ba[0x1]*_0xe323b2+_0xb17456[0x1]*_0x5cab99+_0x1461de[0x1]*_0x4e2133;return this[_0x10963e(0x15c)](_0x5daf63,_0x455127);}},{'key':'_calcUV','value':function _0x1d6234(_0x608e68,_0x457f7a){var _0x12d23c=_0x4aac;return[+_0x608e68,+_0x457f7a,Math[_0x12d23c(0xdd)](_0x608e68*_0x608e68+_0x457f7a*_0x457f7a)];}},{'key':'getUVByPoint','value':function _0x28f63c(_0x1ff858,_0x164605){if(!this['isInExtent'](_0x1ff858,_0x164605))return null;var _0x1b2ba4=this['toGridXY'](_0x1ff858,_0x164605),_0x519892=this['getUVByXY'](_0x1b2ba4[0x0],_0x1b2ba4[0x1]);return _0x519892;}},{'key':'isInExtent','value':function _0x4ef53a(_0xc6ee21,_0x2a3ab8){var _0x26a6b9=_0x4aac;return _0xc6ee21>=this['xmin']&&_0xc6ee21<=this[_0x26a6b9(0xef)]&&_0x2a3ab8>=this['ymin']&&_0x2a3ab8<=this['ymax']?!![]:![];}},{'key':'getRandomLatLng','value':function _0x1bd5a4(){var _0x3e543e=_0x4aac,_0x48a08b=fRandomByfloat(this['xmin'],this['xmax']),_0x331b00=fRandomByfloat(this[_0x3e543e(0x185)],this[_0x3e543e(0x199)]);return{'lat':_0x331b00,'lng':_0x48a08b};}},{'key':'getParticles','value':function _0x8cc7ad(){var _0x26d844=_0x4aac,_0x1e9d92,_0x1893b2,_0x43b682;for(var _0x478af0=0x0,_0xbdde3b=this['particles']['length'];_0x478af0<_0xbdde3b;_0x478af0++){var _0x281ba3=this[_0x26d844(0x146)][_0x478af0];_0x281ba3['age']<=0x0&&(_0x281ba3=this['_randomParticle'](_0x281ba3));if(_0x281ba3['age']>0x0){var _0x504510=_0x281ba3[_0x26d844(0x16a)],_0x5a8318=_0x281ba3['tlat'];_0x43b682=this[_0x26d844(0x19c)](_0x504510,_0x5a8318),_0x43b682?(_0x1e9d92=_0x504510+this['_calc_speedRate'][0x0]*_0x43b682[0x0],_0x1893b2=_0x5a8318+this['_calc_speedRate'][0x1]*_0x43b682[0x1],_0x281ba3['lng']=_0x504510,_0x281ba3['lat']=_0x5a8318,_0x281ba3['tlng']=_0x1e9d92,_0x281ba3['tlat']=_0x1893b2,_0x281ba3['age']--):_0x281ba3['age']=0x0;}}return this[_0x26d844(0x146)];}},{'key':'_randomParticle','value':function _0x48d66a(_0x2caca6){var _0x1ec8ca=_0x4aac,_0xccae13,_0x553e8b;for(var _0x26afd7=0x0;_0x26afd7<0x1e;_0x26afd7++){_0xccae13=this['getRandomLatLng'](),_0x553e8b=this[_0x1ec8ca(0x19c)](_0xccae13['lng'],_0xccae13[_0x1ec8ca(0xcc)]);if(_0x553e8b&&_0x553e8b[0x2]>0x0)break;}if(!_0x553e8b)return _0x2caca6;var _0x51cc3f=_0xccae13[_0x1ec8ca(0x1b3)]+this['_calc_speedRate'][0x0]*_0x553e8b[0x0],_0x1ef1bc=_0xccae13['lat']+this['_calc_speedRate'][0x1]*_0x553e8b[0x1];return _0x2caca6[_0x1ec8ca(0x1b3)]=_0xccae13['lng'],_0x2caca6['lat']=_0xccae13['lat'],_0x2caca6[_0x1ec8ca(0x16a)]=_0x51cc3f,_0x2caca6['tlat']=_0x1ef1bc,_0x2caca6[_0x1ec8ca(0xe4)]=Math['round'](Math['random']()*this[_0x1ec8ca(0x156)]),_0x2caca6;}},{'key':'destroy','value':function _0x53fc1e(){for(var _0x2eb67d in this){delete this[_0x2eb67d];}}}]),_0x1f79be;}());function fRandomByfloat(_0x41a18d,_0x74d621){return _0x41a18d+Math['random']()*(_0x74d621-_0x41a18d);}var Cesium=mars3d__namespace[_0x27700f(0xd2)],BaseLayer=mars3d__namespace[_0x27700f(0x179)]['BaseLayer'],CanvasWindLayer=function(_0x584fd0){var _0x5b4c59=_0x27700f;_inherits(_0xda0871,_0x584fd0);var _0x2bdd97=_createSuper(_0xda0871);function _0xda0871(){var _0x5f39fa=_0x4aac,_0x47b7a1,_0x4e0bb7=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0xda0871),_0x47b7a1=_0x2bdd97['call'](this,_0x4e0bb7),_0x47b7a1['_setOptionsHook'](_0x4e0bb7),_0x47b7a1[_0x5f39fa(0x11f)]=null,_0x47b7a1;}return _createClass(_0xda0871,[{'key':'_setOptionsHook','value':function _0x425a87(_0x2aa7b6,_0xc5fd5d){var _0x3a6d5e=_0x4aac,_0x7cbe2f,_0x1a02ca,_0xd69b13;this['frameTime']=0x3e8/(_0x2aa7b6[_0x3a6d5e(0x160)]||0xa),this['_pointerEvents']=(_0x7cbe2f=this['options'][_0x3a6d5e(0xf6)])!==null&&_0x7cbe2f!==void 0x0?_0x7cbe2f:![],this[_0x3a6d5e(0x1b7)]=_0x2aa7b6['color']||_0x3a6d5e(0x158),this[_0x3a6d5e(0x136)]=_0x2aa7b6['lineWidth']||0x1,this[_0x3a6d5e(0x124)]=(_0x1a02ca=_0x2aa7b6['fixedHeight'])!==null&&_0x1a02ca!==void 0x0?_0x1a02ca:0x0,this['reverseY']=(_0xd69b13=_0x2aa7b6['reverseY'])!==null&&_0xd69b13!==void 0x0?_0xd69b13:![],this['windField']&&this['windField']['setOptions'](_0x2aa7b6);}},{'key':_0x5b4c59(0x179),'get':function _0x2b5b02(){return this['canvas'];}},{'key':_0x5b4c59(0x1bf),'get':function _0x4ea0d3(){return this['_map']['scene']['canvas']['clientWidth'];}},{'key':_0x5b4c59(0x159),'get':function _0x18859d(){var _0x1801c7=_0x5b4c59;return this['_map']['scene']['canvas'][_0x1801c7(0x143)];}},{'key':'pointerEvents','get':function _0x22785a(){return this['_pointerEvents'];},'set':function _0x44daba(_0x638770){var _0x8162fa=_0x5b4c59;this['_pointerEvents']=_0x638770;if(!this[_0x8162fa(0x11f)])return;_0x638770?this[_0x8162fa(0x11f)]['style']['pointer-events']='all':this['canvas'][_0x8162fa(0x117)][_0x8162fa(0xf7)]=_0x8162fa(0xce);}},{'key':'particlesNumber','get':function _0x48d650(){return this['options']['particlesNumber'];},'set':function _0x596f81(_0x36cad7){var _0x4fa49c=_0x5b4c59,_0x5c3018=this;this['options']['particlesNumber']=_0x36cad7,clearTimeout(this[_0x4fa49c(0x1b6)]),this['_canrefresh']=setTimeout(function(){_0x5c3018['redraw']();},0x1f4);}},{'key':'speedRate','get':function _0x2a0521(){var _0x69e611=_0x5b4c59;return this[_0x69e611(0x108)]['speedRate'];},'set':function _0x32fa64(_0x54a974){var _0x15143e=_0x5b4c59;this['options']['speedRate']=_0x54a974,this['windField']&&(this['windField'][_0x15143e(0x1c2)]=_0x54a974);}},{'key':'maxAge','get':function _0x312bde(){return this['options']['maxAge'];},'set':function _0x447273(_0x381985){this['options']['maxAge']=_0x381985,this['windField']&&(this['windField']['maxAge']=_0x381985);}},{'key':'data','get':function _0xebf3fc(){var _0x17db3d=_0x5b4c59;return this[_0x17db3d(0x114)];},'set':function _0x170884(_0x1693ff){this['setData'](_0x1693ff);}},{'key':'_showHook','value':function _0x5b16a3(_0x5d61b5){var _0xf0484c=_0x5b4c59;_0x5d61b5?this['_addedHook']():(this['windData']&&(this['options'][_0xf0484c(0x144)]=this['windData']),this[_0xf0484c(0x153)]());}},{'key':'_mountedHook','value':function _0x2df5c9(){var _0x54818c=_0x5b4c59;this[_0x54818c(0x108)][_0x54818c(0x1c3)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}},{'key':'_addedHook','value':function _0x30ab57(){var _0x1a87c6=_0x5b4c59;this['canvas']=this['_createCanvas'](),this[_0x1a87c6(0x1ac)]=this['canvas'][_0x1a87c6(0xe3)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options'][_0x1a87c6(0x144)]);}},{'key':_0x5b4c59(0x153),'value':function _0x46df01(){var _0x2d4695=_0x5b4c59;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this[_0x2d4695(0x11f)]);}},{'key':'_createCanvas','value':function _0x1b909c(){var _0x1bc023=_0x5b4c59,_0xad44a4=document['createElement']('canvas');_0xad44a4['style']['position']=_0x1bc023(0xd7),_0xad44a4['style']['top']='0px',_0xad44a4['style']['left']='0px',_0xad44a4['style']['width']=_0x1bc023(0x1be),_0xad44a4[_0x1bc023(0x117)][_0x1bc023(0x13e)]='100%',_0xad44a4['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0xad44a4['style']['zIndex']=0xa,_0xad44a4['setAttribute']('id','canvasWindy'),_0xad44a4[_0x1bc023(0x17f)](_0x1bc023(0x17a),_0x1bc023(0x162)),this['_map'][_0x1bc023(0xdb)]['appendChild'](_0xad44a4);var _0xce9b6=this[_0x1bc023(0x12e)][_0x1bc023(0x10c)];return _0xad44a4['width']=_0xce9b6['canvas']['clientWidth'],_0xad44a4['height']=_0xce9b6[_0x1bc023(0x11f)][_0x1bc023(0x143)],_0xad44a4;}},{'key':'resize','value':function _0x4c804a(){var _0x412715=_0x5b4c59;this['canvas']&&(this['canvas']['width']=this['canvasWidth'],this[_0x412715(0x11f)]['height']=this['canvasHeight']);}},{'key':_0x5b4c59(0x10d),'value':function _0x35a381(){var _0xf96d7e=_0x5b4c59,_0x5ceb92=this,_0x2cb6ac=Date['now']();(function _0x240251(){var _0xee1f06=_0x4aac;_0x5ceb92['animateFrame']=window['requestAnimationFrame'](_0x240251);if(_0x5ceb92['show']&&_0x5ceb92['windField']){var _0x52951d=Date['now'](),_0x10ea97=_0x52951d-_0x2cb6ac;_0x10ea97>_0x5ceb92['frameTime']&&(_0x2cb6ac=_0x52951d-_0x10ea97%_0x5ceb92[_0xee1f06(0x12f)],_0x5ceb92['update']());}}(),window['addEventListener']('resize',this[_0xf96d7e(0xd5)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType'][_0xf96d7e(0x123)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0xf96d7e(0x11d)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0xf96d7e(0x1c4)]['mouseUp'],this['_onMouseUpEvent'],this)));}},{'key':_0x5b4c59(0x1ad),'value':function _0x545e50(){var _0x4b9921=_0x5b4c59;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x4b9921(0x171)],window[_0x4b9921(0x115)]('resize',this['resize']),this['options']['mouseHidden']&&(this[_0x4b9921(0x12e)]['off'](mars3d__namespace[_0x4b9921(0x1c4)]['wheel'],this[_0x4b9921(0x13d)],this),this['_map'][_0x4b9921(0x1cc)](mars3d__namespace[_0x4b9921(0x1c4)]['mouseDown'],this['_onMouseDownEvent'],this),this[_0x4b9921(0x12e)]['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x4b9921(0x1cc)](mars3d__namespace[_0x4b9921(0x1c4)]['mouseMove'],this['_onMouseMoveEvent'],this));}},{'key':'_onMapWhellEvent','value':function _0x3a6ce5(_0x22cbf5){var _0x4fb413=_0x5b4c59,_0xa2e719=this;clearTimeout(this[_0x4fb413(0x12d)]);if(!this['show']||!this[_0x4fb413(0x11f)])return;this[_0x4fb413(0x11f)]['style']['visibility']=_0x4fb413(0x139),this['refreshTimer']=setTimeout(function(){var _0x49c628=_0x4fb413;if(!_0xa2e719['show'])return;_0xa2e719['redraw'](),_0xa2e719['canvas']['style'][_0x49c628(0x197)]='visible';},0xc8);}},{'key':'_onMouseDownEvent','value':function _0x17b42b(_0xd40410){var _0x1e6033=_0x5b4c59;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x1e6033(0x12e)]['on'](mars3d__namespace[_0x1e6033(0x1c4)]['mouseMove'],this[_0x1e6033(0x174)],this);}},{'key':_0x5b4c59(0x174),'value':function _0x3db087(_0x4a63a2){var _0x1423cd=_0x5b4c59;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this[_0x1423cd(0x116)]=!![]);}},{'key':'_onMouseUpEvent','value':function _0x383d35(_0x28aa55){var _0x4643a6=_0x5b4c59;if(!this['show']||!this['canvas'])return;this['_map'][_0x4643a6(0x1cc)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x4643a6(0x132)]&&this['mouse_move']&&this[_0x4643a6(0x151)](),this['canvas']['style'][_0x4643a6(0x197)]='visible',this[_0x4643a6(0x132)]=![],this['mouse_move']=![];}},{'key':'setData','value':function _0x4a768f(_0x55eb2a){var _0x217fb8=_0x5b4c59;this[_0x217fb8(0x1b4)](),this['windData']=_0x55eb2a,this[_0x217fb8(0xfd)]['setDate'](_0x55eb2a),this[_0x217fb8(0x151)]();}},{'key':_0x5b4c59(0x151),'value':function _0x2b93a1(){var _0x51bfd0=_0x5b4c59;if(!this['show'])return;this['windField'][_0x51bfd0(0x135)](this['options']),this[_0x51bfd0(0x193)]();}},{'key':_0x5b4c59(0x193),'value':function _0x132e1b(){var _0x358fcb=_0x5b4c59;if(this['_updateIng'])return;this[_0x358fcb(0x130)]=!![];if(this['worker'])this['windField'][_0x358fcb(0x193)]();else{var _0x3c5da6=this['windField'][_0x358fcb(0x105)]();this['_drawLines'](_0x3c5da6);}this['_updateIng']=![];}},{'key':_0x5b4c59(0x10b),'value':function _0x577a61(_0x54905c){var _0x72335f=_0x5b4c59;this[_0x72335f(0x1ac)]['globalCompositeOperation']='destination-in',this[_0x72335f(0x1ac)][_0x72335f(0x18f)](0x0,0x0,this['canvasWidth'],this[_0x72335f(0x159)]),this['canvasContext'][_0x72335f(0x106)]='lighter',this['canvasContext']['globalAlpha']=0.9,this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x72335f(0x1ac)][_0x72335f(0xd0)]=this['color'];var _0x1f8239=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'];for(var _0x4a21b8=0x0,_0x492ed1=_0x54905c['length'];_0x4a21b8<_0x492ed1;_0x4a21b8++){var _0x7d67e6=_0x54905c[_0x4a21b8],_0x2cc314=this['_tomap'](_0x7d67e6[_0x72335f(0x1b3)],_0x7d67e6[_0x72335f(0xcc)],_0x7d67e6),_0x40804f=this[_0x72335f(0x11c)](_0x7d67e6['tlng'],_0x7d67e6[_0x72335f(0x164)],_0x7d67e6);if(!_0x2cc314||!_0x40804f)continue;if(_0x1f8239&&Math['abs'](_0x2cc314[0x0]-_0x40804f[0x0])>=this['canvasWidth'])continue;this['canvasContext']['moveTo'](_0x2cc314[0x0],_0x2cc314[0x1]),this['canvasContext']['lineTo'](_0x40804f[0x0],_0x40804f[0x1]);}this['canvasContext']['stroke']();}},{'key':'_tomap','value':function _0x37b456(_0x4451f3,_0x1953d7,_0x2958a8){var _0x45891d=_0x5b4c59,_0x4b0500=Cesium['Cartesian3']['fromDegrees'](_0x4451f3,_0x1953d7,this[_0x45891d(0x124)]),_0x2fd588=this[_0x45891d(0x12e)]['scene'];if(_0x2fd588['mode']===Cesium['SceneMode'][_0x45891d(0x142)]){var _0x26362d=new Cesium[(_0x45891d(0x102))](_0x2fd588[_0x45891d(0x122)]['ellipsoid'],_0x2fd588['camera']['positionWC']),_0x3d32cb=_0x26362d['isPointVisible'](_0x4b0500);if(!_0x3d32cb)return _0x2958a8['age']=0x0,null;}var _0x2bae51=Cesium[_0x45891d(0x18b)]['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x4b0500);return _0x2bae51?[_0x2bae51['x'],_0x2bae51['y']]:null;}},{'key':'clear','value':function _0x4ae3f9(){var _0x4347f9=_0x5b4c59;this[_0x4347f9(0xfd)]['clear'](),delete this['windData'];}},{'key':'initWorker','value':function _0x13ceb5(){var _0x933f08=_0x5b4c59,_0x25b255=this;this['worker']=new Worker(this['options']['worker']),this[_0x933f08(0x1c3)][_0x933f08(0x19f)]=function(_0x27c0bb){_0x25b255['_drawLines'](_0x27c0bb['data']['particles']),_0x25b255['_updateIng2']=![];},this['windField']={'init':function _0x311282(_0x29fd3d){var _0x45ecfb=_0x933f08;_0x25b255['worker'][_0x45ecfb(0x1b0)]({'type':'init','options':_0x29fd3d});},'setOptions':function _0xec638f(_0x2bf425){_0x25b255['worker']['postMessage']({'type':'setOptions','options':_0x2bf425});},'setDate':function _0x4a3424(_0x43a420){var _0x49f5cf=_0x933f08;_0x25b255['worker'][_0x49f5cf(0x1b0)]({'type':'setDate','data':_0x43a420});},'update':function _0x59550e(){var _0xf6b22e=_0x933f08;if(_0x25b255['_updateIng2'])return;_0x25b255['_updateIng2']=!![],_0x25b255['worker']['postMessage']({'type':_0xf6b22e(0x193)});},'clear':function _0x52e656(){var _0x2abace=_0x933f08;_0x25b255['worker']['postMessage']({'type':_0x2abace(0x1b4)});}},this[_0x933f08(0xfd)]['init'](this['options']);}}]),_0xda0871;}(BaseLayer);mars3d__namespace[_0x27700f(0xf1)][_0x27700f(0x15a)](_0x27700f(0xe7),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x27700f(0x121)]=CanvasWindField,mars3d__namespace[_0x27700f(0x1ae)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x27700f(0x181)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
