/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.5
 * 编译日期：2024-03-05 20:10:34
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x30d788=_0x52aa;(function(_0xf3b066,_0x334d60){const _0x6dbcdf=_0x52aa,_0x3a1dc5=_0xf3b066();while(!![]){try{const _0x3e3e19=parseInt(_0x6dbcdf(0x1dc))/0x1*(-parseInt(_0x6dbcdf(0x1b0))/0x2)+-parseInt(_0x6dbcdf(0x13b))/0x3+-parseInt(_0x6dbcdf(0x1c8))/0x4+parseInt(_0x6dbcdf(0x149))/0x5*(-parseInt(_0x6dbcdf(0x17e))/0x6)+-parseInt(_0x6dbcdf(0x103))/0x7*(-parseInt(_0x6dbcdf(0x1a6))/0x8)+-parseInt(_0x6dbcdf(0x104))/0x9+parseInt(_0x6dbcdf(0x123))/0xa;if(_0x3e3e19===_0x334d60)break;else _0x3a1dc5['push'](_0x3a1dc5['shift']());}catch(_0x58367b){_0x3a1dc5['push'](_0x3a1dc5['shift']());}}}(_0x3149,0xe6fb3));function _interopNamespace(_0x4e4049){const _0x439c46=_0x52aa;if(_0x4e4049&&_0x4e4049['__esModule'])return _0x4e4049;var _0x4fdac7=Object['create'](null);return _0x4e4049&&Object['keys'](_0x4e4049)[_0x439c46(0x13a)](function(_0x1e2ce9){const _0x58a271=_0x439c46;if(_0x1e2ce9!=='default'){var _0x42bb1f=Object[_0x58a271(0x168)](_0x4e4049,_0x1e2ce9);Object[_0x58a271(0x1b1)](_0x4fdac7,_0x1e2ce9,_0x42bb1f['get']?_0x42bb1f:{'enumerable':!![],'get':function(){return _0x4e4049[_0x1e2ce9];}});}}),_0x4fdac7['default']=_0x4e4049,_0x4fdac7;}var mars3d__namespace=_interopNamespace(mars3d);function _0x3149(){const _0x1272a3=['lev','commandToExecute','postProcessingSpeed','windTextures','ALWAYS','depthTest','refreshTimer','lineTo','VertexArray','lineWidth','clearCommand','TextureMagnificationFilter','mode','__esModule','nextParticlesSpeed','particlesRendering','left','FLOAT','scene','Rectangle','50593970iJkveF','depthMask','particleSystem','getColorTexture','redraw','Matrix4','Pass','attributeLocations','strokeStyle','computeViewRectangle','OPAQUE','maxAge','applyViewerParameters','_colorRamp','log','_drawLines','NEAREST','Math','umin','PixelDatatype','beginPath','stroke','getUVByPoint','forEach','1491774EzJTFu','visibility','_tomap','moveTo','cancelAnimationFrame','min','mouseDown','getDefaultRenderState','setDate','pointerEvents','cols','addEventListener','_removedHook','refreshParticles','290oHePox','_data','DepthFunction','addPrimitives','color','all','initWorker','BufferUsage','mouseHidden','CanvasWindLayer','top','vertexArray','isInExtent','mouseMove','lng','unbindEvent','dimensions','fadeOpacity','max','destroyParticlesTextures','0px','outputTexture','globalCompositeOperation','createComputingPrimitives','ymin','tlat','wind','visible','WindUtil','data','xmin','getOwnPropertyDescriptor','lat','udata','_onMouseUpEvent','_calcUV','length','colorTable','wheel','reverseY','defined','createRenderingTextures','canvas','createWindTextures','nextTrails','textures','Geometry','Compute','ClearCommand','camera','drawingBufferWidth','abs','fromGeometry','24714ghUXoS','lon','GeometryAttribute','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','lonRange','colors','ShaderSource','getUVByXY','grid','randomBetween','height','particleHeight','array','setOptions','age','clampToLatitudeRange','maxParticles','pixelSize','none','options','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','windField','resize','_showHook','context','random','Cartesian3','PixelFormat','clearFramebuffers','vertexShaderSource','atan2','primitiveType','currentParticlesPosition','destination-in','destroy','geometry','keys','PI_OVER_THREE','preExecute','EllipsoidalOccluder','43448ytdNQb','trails','postMessage','Cesium','createParticlesTextures','ComponentDatatype','positionWC','mouseUp','fixedHeight','add','1108ftlXar','defineProperty','randomizeParticles','speed','_setOptionsHook','canvasContext','_map','east','vdata','clientWidth','ShaderProgram','west','show','frameRate','currentParticlesSpeed','createRenderingPrimitives','toRadians','style','clientHeight','toDegrees','windData','fromCache','commandList','particlesComputing','7452256gsYPhN','_onMouseDownEvent','viewerParameters','Draw','container','PrimitiveType','worker','SCENE3D','reverse','width','ymax','CanvasWindField','segmentsDepth','fill','_onMouseMoveEvent','layer','STATIC_DRAW','speedRate','_calc_speedRate','nextParticlesPosition','1919wYfccg','xmax','updatePosition','_updateIng2','commandType','mouse_move','BoundingSphere','sin','createSegmentsGeometry','vmin','createTexture','particlesTextures','_pointerEvents','tlng','primitives','segments','postProcessingPosition','getRandomLatLng','clear','particlesTextureSize','create','round','_randomParticle','mouse_down','_onMapWhellEvent','push','BaseLayer','particlesNumber','pointer-events','getContext','_speedRate','DrawCommand','714XITdpK','9044190KqvvWe','off','TRIANGLES','rows','framebuffers','createRawRenderState','bindEvent','_addedHook','EventType','_canrefresh','createFramebuffer'];_0x3149=function(){return _0x1272a3;};return _0x3149();}const Cesium$7=mars3d__namespace['Cesium'];function _0x52aa(_0x8eb52d,_0x60263b){const _0x3149c7=_0x3149();return _0x52aa=function(_0x52aac0,_0x46646f){_0x52aac0=_0x52aac0-0xf4;let _0x465411=_0x3149c7[_0x52aac0];return _0x465411;},_0x52aa(_0x8eb52d,_0x60263b);}function getU(_0x4da5e4,_0x1891a4){const _0x3a52a2=_0x52aa,_0xf706cc=_0x4da5e4*Math['cos'](Cesium$7['Math'][_0x3a52a2(0x1c0)](_0x1891a4));return _0xf706cc;}function getV(_0x1c3d73,_0xd06c83){const _0x108226=_0x52aa,_0x23834a=_0x1c3d73*Math[_0x108226(0x1e3)](Cesium$7['Math'][_0x108226(0x1c0)](_0xd06c83));return _0x23834a;}function getSpeed(_0x5e76be,_0x59edde){const _0x238b29=Math['sqrt'](Math['pow'](_0x5e76be,0x2)+Math['pow'](_0x59edde,0x2));return _0x238b29;}function getDirection(_0x548b3a,_0x49c3a1){const _0x5088a4=_0x52aa;let _0x3c05b4=Cesium$7['Math']['toDegrees'](Math[_0x5088a4(0x19c)](_0x49c3a1,_0x548b3a));return _0x3c05b4+=_0x3c05b4<0x0?0x168:0x0,_0x3c05b4;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x53c276){const _0x1c7191=_0x52aa;this['commandType']=_0x53c276[_0x1c7191(0x1e0)],this['geometry']=_0x53c276[_0x1c7191(0x1a1)],this[_0x1c7191(0x12a)]=_0x53c276['attributeLocations'],this[_0x1c7191(0x19d)]=_0x53c276['primitiveType'],this['uniformMap']=_0x53c276['uniformMap'],this[_0x1c7191(0x19b)]=_0x53c276['vertexShaderSource'],this['fragmentShaderSource']=_0x53c276['fragmentShaderSource'],this['rawRenderState']=_0x53c276['rawRenderState'],this['framebuffer']=_0x53c276['framebuffer'],this[_0x1c7191(0x15e)]=_0x53c276['outputTexture'],this['autoClear']=_0x53c276['autoClear']??![],this['preExecute']=_0x53c276[_0x1c7191(0x1a4)],this[_0x1c7191(0x1bc)]=!![],this[_0x1c7191(0x110)]=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x1c7191(0x129)]['OPAQUE']}));}['createCommand'](_0x2a54b6){const _0x25e5e1=_0x52aa;switch(this['commandType']){case _0x25e5e1(0x1cb):{const _0x12df18=Cesium$6['VertexArray']['fromGeometry']({'context':_0x2a54b6,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x25e5e1(0x150)][_0x25e5e1(0x1d8)]}),_0x427321=Cesium$6[_0x25e5e1(0x1ba)][_0x25e5e1(0x1c5)]({'context':_0x2a54b6,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x3fe3ca=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6[(_0x25e5e1(0x102))]({'primitiveType':this['primitiveType'],'shaderProgram':_0x427321,'vertexArray':_0x12df18,'modelMatrix':Cesium$6[_0x25e5e1(0x128)]['IDENTITY'],'renderState':_0x3fe3ca,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x25e5e1(0x12d)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x25ba0e,_0xbc97fb){const _0x3d6020=_0x52aa;this['geometry']=_0xbc97fb;const _0x406119=Cesium$6[_0x3d6020(0x117)][_0x3d6020(0x17d)]({'context':_0x25ba0e,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x406119;}['update'](_0x5056a6){const _0x3a0f13=_0x52aa;if(!this['show'])return;if(_0x5056a6['mode']!==Cesium$6['SceneMode'][_0x3a0f13(0x1cf)])return;!Cesium$6['defined'](this[_0x3a0f13(0x110)])&&(this['commandToExecute']=this['createCommand'](_0x5056a6['context'])),Cesium$6['defined'](this[_0x3a0f13(0x1a4)])&&this['preExecute'](),Cesium$6[_0x3a0f13(0x171)](this[_0x3a0f13(0x119)])&&_0x5056a6['commandList']['push'](this[_0x3a0f13(0x119)]),_0x5056a6[_0x3a0f13(0x1c6)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x1d7a3a=_0x52aa;if(this[_0x1d7a3a(0x119)]){var _0x347006,_0x1996d7;(_0x347006=this['clearCommand'])!==null&&_0x347006!==void 0x0&&_0x347006['vertexArray']&&this['clearCommand']['vertexArray'][_0x1d7a3a(0x1a0)](),(_0x1996d7=this[_0x1d7a3a(0x119)])!==null&&_0x1996d7!==void 0x0&&_0x1996d7['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute'][_0x1d7a3a(0x154)]&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x3a554e=function(){const _0x3db0be=_0x52aa,_0xb50ef1=new Cesium$5[(_0x3db0be(0x177))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x3db0be(0x120)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x3db0be(0x180))]({'componentDatatype':Cesium$5[_0x3db0be(0x1ab)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0xb50ef1;},_0x4f7e03=function(_0x2a0a17,_0x993b3d){if(Cesium$5['defined'](_0x993b3d)){const _0x328059={};_0x328059['arrayBufferView']=_0x993b3d,_0x2a0a17['source']=_0x328059;}const _0xe7375d=new Cesium$5['Texture'](_0x2a0a17);return _0xe7375d;},_0x223db7=function(_0x5444b1,_0x9b721e,_0x525a36){const _0x1f487=new Cesium$5['Framebuffer']({'context':_0x5444b1,'colorTextures':[_0x9b721e],'depthTexture':_0x525a36});return _0x1f487;},_0x2e668e=function(_0x45037b){const _0x11f42e=_0x52aa,_0x16d3f3=!![],_0x265562=![],_0x42a439={'viewport':_0x45037b['viewport'],'depthTest':_0x45037b[_0x11f42e(0x114)],'depthMask':_0x45037b[_0x11f42e(0x124)],'blending':_0x45037b['blending']},_0x28113e=Cesium$5['Appearance'][_0x11f42e(0x142)](_0x16d3f3,_0x265562,_0x42a439);return _0x28113e;},_0x41dcea=function(_0x49d9c7){const _0xccc50b=_0x52aa,_0xf4db79={},_0x3002be=Cesium$5['Math']['mod'](_0x49d9c7[_0xccc50b(0x1bb)],Cesium$5['Math']['TWO_PI']),_0x2c3720=Cesium$5[_0xccc50b(0x134)]['mod'](_0x49d9c7[_0xccc50b(0x1b7)],Cesium$5['Math']['TWO_PI']),_0x10770e=_0x49d9c7['width'];let _0x2aa041,_0x576321;_0x10770e>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x2aa041=0x0,_0x576321=Cesium$5['Math']['TWO_PI']):_0x2c3720-_0x3002be<_0x10770e?(_0x2aa041=_0x3002be,_0x576321=_0x3002be+_0x10770e):(_0x2aa041=_0x3002be,_0x576321=_0x2c3720);_0xf4db79['lon']={'min':Cesium$5['Math'][_0xccc50b(0x1c3)](_0x2aa041),'max':Cesium$5['Math'][_0xccc50b(0x1c3)](_0x576321)};const _0x651021=_0x49d9c7['south'],_0x2008d4=_0x49d9c7['north'],_0x38d87a=_0x49d9c7['height'],_0x319cff=_0x38d87a>Cesium$5[_0xccc50b(0x134)]['PI']/0xc?_0x38d87a/0x2:0x0;let _0x5ab36c=Cesium$5['Math'][_0xccc50b(0x18d)](_0x651021-_0x319cff),_0x2d8dc2=Cesium$5[_0xccc50b(0x134)][_0xccc50b(0x18d)](_0x2008d4+_0x319cff);return _0x5ab36c<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x5ab36c=-Cesium$5['Math']['PI_OVER_TWO']),_0x2d8dc2>Cesium$5['Math'][_0xccc50b(0x1a3)]&&(_0x2d8dc2=Cesium$5[_0xccc50b(0x134)]['PI_OVER_TWO']),_0xf4db79[_0xccc50b(0x169)]={'min':Cesium$5['Math']['toDegrees'](_0x5ab36c),'max':Cesium$5['Math']['toDegrees'](_0x2d8dc2)},_0xf4db79;};return{'getFullscreenQuad':_0x3a554e,'createTexture':_0x4f7e03,'createFramebuffer':_0x223db7,'createRawRenderState':_0x2e668e,'viewRectangleToLonLatRange':_0x41dcea};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x30d788(0x181),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x30d788(0x1a9)];class ParticlesRendering{constructor(_0xf129d9,_0x49575a,_0x8743f3,_0x4b2431,_0x195ed6){const _0x5ca5de=_0x30d788;this[_0x5ca5de(0x172)](_0xf129d9,_0x49575a,_0x8743f3[_0x5ca5de(0x183)]),this['createRenderingFramebuffers'](_0xf129d9),this['createRenderingPrimitives'](_0xf129d9,_0x8743f3,_0x4b2431,_0x195ed6);}[_0x30d788(0x172)](_0x382c4b,_0x58e28c,_0x4b7c40){const _0x878ad4=_0x30d788,_0x340811={'context':_0x382c4b,'width':_0x382c4b[_0x878ad4(0x17b)],'height':_0x382c4b['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x25ae3e={'context':_0x382c4b,'width':_0x382c4b['drawingBufferWidth'],'height':_0x382c4b['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x68484=_0x4b7c40[_0x878ad4(0x16d)],_0x5aa025=new Float32Array(_0x68484*0x3);for(let _0x3a3b79=0x0;_0x3a3b79<_0x68484;_0x3a3b79++){const _0x28773a=Cesium$4['Color']['fromCssColorString'](_0x4b7c40[_0x3a3b79]);_0x5aa025[0x3*_0x3a3b79]=_0x28773a['red'],_0x5aa025[0x3*_0x3a3b79+0x1]=_0x28773a['green'],_0x5aa025[0x3*_0x3a3b79+0x2]=_0x28773a['blue'];}const _0x35b681={'context':_0x382c4b,'width':_0x68484,'height':0x1,'pixelFormat':Cesium$4[_0x878ad4(0x199)]['RGB'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x878ad4(0x120)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x340811),'segmentsDepth':Util['createTexture'](_0x25ae3e),'currentTrailsColor':Util['createTexture'](_0x340811),'currentTrailsDepth':Util['createTexture'](_0x25ae3e),'nextTrailsColor':Util[_0x878ad4(0x1e6)](_0x340811),'nextTrailsDepth':Util['createTexture'](_0x25ae3e),'colorTable':Util['createTexture'](_0x35b681,_0x5aa025)};}['createRenderingFramebuffers'](_0x4000ba){const _0x1a8b3f=_0x30d788;this[_0x1a8b3f(0x108)]={'segments':Util[_0x1a8b3f(0x10e)](_0x4000ba,this['textures']['segmentsColor'],this['textures'][_0x1a8b3f(0x1d4)]),'currentTrails':Util[_0x1a8b3f(0x10e)](_0x4000ba,this['textures']['currentTrailsColor'],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x4000ba,this['textures']['nextTrailsColor'],this[_0x1a8b3f(0x176)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x6f5cc8){const _0x531168=_0x30d788,_0x548b3f=0x4;let _0x32243d=[];for(let _0x3d1452=0x0;_0x3d1452<_0x6f5cc8['particlesTextureSize'];_0x3d1452++){for(let _0x56bf19=0x0;_0x56bf19<_0x6f5cc8['particlesTextureSize'];_0x56bf19++){for(let _0x54088d=0x0;_0x54088d<_0x548b3f;_0x54088d++){_0x32243d['push'](_0x3d1452/_0x6f5cc8[_0x531168(0xf6)]),_0x32243d['push'](_0x56bf19/_0x6f5cc8['particlesTextureSize']);}}}_0x32243d=new Float32Array(_0x32243d);let _0x477044=[];const _0x2cfd38=[-0x1,0x1],_0x209ee6=[-0x1,0x1];for(let _0x255f94=0x0;_0x255f94<_0x6f5cc8[_0x531168(0x18e)];_0x255f94++){for(let _0x199d72=0x0;_0x199d72<_0x548b3f/0x2;_0x199d72++){for(let _0xa428d0=0x0;_0xa428d0<_0x548b3f/0x2;_0xa428d0++){_0x477044['push'](_0x2cfd38[_0x199d72]),_0x477044['push'](_0x209ee6[_0xa428d0]),_0x477044['push'](0x0);}}}_0x477044=new Float32Array(_0x477044);const _0x550180=0x6*_0x6f5cc8['maxParticles'],_0x2ce4bb=new Uint32Array(_0x550180);for(let _0x3eda1f=0x0,_0x56e9a8=0x0,_0x5841ce=0x0;_0x3eda1f<_0x6f5cc8['maxParticles'];_0x3eda1f++){_0x2ce4bb[_0x56e9a8++]=_0x5841ce+0x0,_0x2ce4bb[_0x56e9a8++]=_0x5841ce+0x1,_0x2ce4bb[_0x56e9a8++]=_0x5841ce+0x2,_0x2ce4bb[_0x56e9a8++]=_0x5841ce+0x2,_0x2ce4bb[_0x56e9a8++]=_0x5841ce+0x1,_0x2ce4bb[_0x56e9a8++]=_0x5841ce+0x3,_0x5841ce+=0x4;}const _0xe6a40b=new Cesium$4[(_0x531168(0x177))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x32243d}),'normal':new Cesium$4[(_0x531168(0x180))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x477044})}),'indices':_0x2ce4bb});return _0xe6a40b;}[_0x30d788(0x1bf)](_0x58e74c,_0x1c8d6b,_0x26df59,_0x41da3e){const _0x267cab=_0x30d788,_0x1732fd=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x267cab(0x1e4)](_0x1c8d6b),'primitiveType':Cesium$4[_0x267cab(0x1cd)][_0x267cab(0x106)],'uniformMap':{'currentParticlesPosition':function(){const _0x46adcb=_0x267cab;return _0x41da3e[_0x46adcb(0x1e7)]['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x41da3e['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x6a1d3d=_0x267cab;return _0x41da3e[_0x6a1d3d(0x1e7)]['postProcessingSpeed'];},'colorTable':function(){const _0x3b5f95=_0x267cab;return _0x1732fd['textures'][_0x3b5f95(0x16e)];},'aspect':function(){return _0x58e74c['drawingBufferWidth']/_0x58e74c['drawingBufferHeight'];},'pixelSize':function(){const _0x3a7d8b=_0x267cab;return _0x26df59[_0x3a7d8b(0x18f)];},'lineWidth':function(){return _0x1c8d6b['lineWidth'];},'particleHeight':function(){const _0x42eba1=_0x267cab;return _0x1c8d6b[_0x42eba1(0x189)];}},'vertexShaderSource':new Cesium$4[(_0x267cab(0x184))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x267cab(0x184))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x1732fd['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x1732fd['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x1732fd['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x1732fd['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){const _0x5e70b6=_0x267cab;return _0x1c8d6b[_0x5e70b6(0x15a)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x267cab(0x109)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x267cab(0x14b)][_0x267cab(0x113)]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x267cab(0x175)],'autoClear':!![],'preExecute':function(){const _0x44fac4=_0x267cab,_0x35c9cd=_0x1732fd['framebuffers']['currentTrails'];_0x1732fd['framebuffers']['currentTrails']=_0x1732fd['framebuffers'][_0x44fac4(0x175)],_0x1732fd[_0x44fac4(0x108)]['nextTrails']=_0x35c9cd,_0x1732fd['primitives']['trails']['commandToExecute']['framebuffer']=_0x1732fd['framebuffers']['nextTrails'],_0x1732fd[_0x44fac4(0x1ea)][_0x44fac4(0x1a7)]['clearCommand']['framebuffer']=_0x1732fd[_0x44fac4(0x108)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x267cab(0x1cb),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x12c54f=_0x267cab;return _0x1732fd[_0x12c54f(0x108)]['nextTrails'][_0x12c54f(0x126)](0x0);},'trailsDepthTexture':function(){return _0x1732fd['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x267cab(0x184))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x267cab(0x192)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x19f429,_0x3fee13,_0x58cc68,_0x2f515e){this['data']=_0x3fee13,this['createWindTextures'](_0x19f429,_0x3fee13),this['createParticlesTextures'](_0x19f429,_0x58cc68,_0x2f515e),this['createComputingPrimitives'](_0x3fee13,_0x58cc68,_0x2f515e);}[_0x30d788(0x174)](_0x58c0bf,_0x2cc3c7){const _0x3d1d57=_0x30d788,_0x296364={'context':_0x58c0bf,'width':_0x2cc3c7['dimensions']['lon'],'height':_0x2cc3c7[_0x3d1d57(0x159)][_0x3d1d57(0x169)]*(_0x2cc3c7['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x3d1d57(0x120)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x3d1d57(0x11a)][_0x3d1d57(0x133)]})};this['windTextures']={'U':Util['createTexture'](_0x296364,_0x2cc3c7['U']['array']),'V':Util['createTexture'](_0x296364,_0x2cc3c7['V'][_0x3d1d57(0x18a)])};}[_0x30d788(0x1aa)](_0x490618,_0x53b9d5,_0x24130f){const _0x432330=_0x30d788,_0x5415e1={'context':_0x490618,'width':_0x53b9d5[_0x432330(0xf6)],'height':_0x53b9d5['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3[_0x432330(0x136)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x432330(0x133)]})},_0x3c0da8=this['randomizeParticles'](_0x53b9d5[_0x432330(0x18e)],_0x24130f),_0x5ba5f1=new Float32Array(0x4*_0x53b9d5[_0x432330(0x18e)])[_0x432330(0x1d5)](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x5415e1),'currentParticlesPosition':Util['createTexture'](_0x5415e1,_0x3c0da8),'nextParticlesPosition':Util[_0x432330(0x1e6)](_0x5415e1,_0x3c0da8),'currentParticlesSpeed':Util['createTexture'](_0x5415e1,_0x5ba5f1),'nextParticlesSpeed':Util['createTexture'](_0x5415e1,_0x5ba5f1),'postProcessingPosition':Util['createTexture'](_0x5415e1,_0x3c0da8),'postProcessingSpeed':Util['createTexture'](_0x5415e1,_0x5ba5f1)};}[_0x30d788(0x1b2)](_0x4f7f36,_0x588660){const _0x50e556=_0x30d788,_0x1b27aa=new Float32Array(0x4*_0x4f7f36);for(let _0x46a14a=0x0;_0x46a14a<_0x4f7f36;_0x46a14a++){_0x1b27aa[0x4*_0x46a14a]=Cesium$3['Math'][_0x50e556(0x187)](_0x588660['lonRange']['x'],_0x588660['lonRange']['y']),_0x1b27aa[0x4*_0x46a14a+0x1]=Cesium$3['Math']['randomBetween'](_0x588660['latRange']['x'],_0x588660['latRange']['y']),_0x1b27aa[0x4*_0x46a14a+0x2]=Cesium$3[_0x50e556(0x134)]['randomBetween'](this['data']['lev']['min'],this[_0x50e556(0x166)][_0x50e556(0x10f)][_0x50e556(0x15b)]),_0x1b27aa[0x4*_0x46a14a+0x3]=0x0;}return _0x1b27aa;}[_0x30d788(0x15c)](){const _0x22f987=_0x30d788;Object['keys'](this['particlesTextures'])[_0x22f987(0x13a)](_0x241875=>{const _0x358e4b=_0x22f987;this['particlesTextures'][_0x241875][_0x358e4b(0x1a0)]();});}[_0x30d788(0x160)](_0x548a92,_0x2e19e0,_0x2aa440){const _0x276913=_0x30d788,_0x5a1ae8=new Cesium$3['Cartesian3'](_0x548a92['dimensions']['lon'],_0x548a92['dimensions'][_0x276913(0x169)],_0x548a92['dimensions']['lev']),_0x13c0eb=new Cesium$3['Cartesian3'](_0x548a92['lon'][_0x276913(0x140)],_0x548a92['lat'][_0x276913(0x140)],_0x548a92[_0x276913(0x10f)]['min']),_0x445edf=new Cesium$3['Cartesian3'](_0x548a92[_0x276913(0x17f)]['max'],_0x548a92[_0x276913(0x169)]['max'],_0x548a92[_0x276913(0x10f)][_0x276913(0x15b)]),_0x5a8fbd=new Cesium$3['Cartesian3']((_0x445edf['x']-_0x13c0eb['x'])/(_0x5a1ae8['x']-0x1),(_0x445edf['y']-_0x13c0eb['y'])/(_0x5a1ae8['y']-0x1),_0x5a1ae8['z']>0x1?(_0x445edf['z']-_0x13c0eb['z'])/(_0x5a1ae8['z']-0x1):0x1),_0x50fa66=new Cesium$3['Cartesian2'](_0x548a92['U']['min'],_0x548a92['U'][_0x276913(0x15b)]),_0x9d459c=new Cesium$3['Cartesian2'](_0x548a92['V']['min'],_0x548a92['V'][_0x276913(0x15b)]),_0x19165d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x19114a=_0x276913;return _0x19165d[_0x19114a(0x112)]['U'];},'V':function(){const _0x4803ef=_0x276913;return _0x19165d[_0x4803ef(0x112)]['V'];},'currentParticlesPosition':function(){const _0x33da7a=_0x276913;return _0x19165d[_0x33da7a(0x1e7)]['currentParticlesPosition'];},'dimension':function(){return _0x5a1ae8;},'minimum':function(){return _0x13c0eb;},'maximum':function(){return _0x445edf;},'interval':function(){return _0x5a8fbd;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){_0x19165d['primitives']['getWind']['commandToExecute']['outputTexture']=_0x19165d['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x2e25b9=_0x276913;return _0x19165d['particlesTextures'][_0x2e25b9(0x1be)];},'particlesWind':function(){return _0x19165d['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x50fa66;},'vSpeedRange':function(){return _0x9d459c;},'pixelSize':function(){return _0x2aa440['pixelSize'];},'speedFactor':function(){return _0x2e19e0['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x276913(0x1e7)][_0x276913(0x11d)],'preExecute':function(){const _0x4b1fe4=_0x276913,_0x470c05=_0x19165d[_0x4b1fe4(0x1e7)]['currentParticlesSpeed'];_0x19165d['particlesTextures']['currentParticlesSpeed']=_0x19165d['particlesTextures']['postProcessingSpeed'],_0x19165d[_0x4b1fe4(0x1e7)]['postProcessingSpeed']=_0x470c05,_0x19165d['primitives']['updateSpeed'][_0x4b1fe4(0x110)][_0x4b1fe4(0x15e)]=_0x19165d['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x19165d['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x5c5661=_0x276913;return _0x19165d[_0x5c5661(0x1e7)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x77e95b=_0x276913,_0x5df18d=_0x19165d['particlesTextures'][_0x77e95b(0x19e)];_0x19165d['particlesTextures']['currentParticlesPosition']=_0x19165d[_0x77e95b(0x1e7)]['postProcessingPosition'],_0x19165d[_0x77e95b(0x1e7)][_0x77e95b(0x1ec)]=_0x5df18d,_0x19165d[_0x77e95b(0x1ea)][_0x77e95b(0x1de)]['commandToExecute']['outputTexture']=_0x19165d['particlesTextures'][_0x77e95b(0x1db)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x562584=_0x276913;return _0x19165d['particlesTextures'][_0x562584(0x1db)];},'nextParticlesSpeed':function(){const _0xa4f5bd=_0x276913;return _0x19165d[_0xa4f5bd(0x1e7)]['nextParticlesSpeed'];},'lonRange':function(){return _0x2aa440['lonRange'];},'latRange':function(){return _0x2aa440['latRange'];},'randomCoefficient':function(){const _0x59a756=Math['random']();return _0x59a756;},'dropRate':function(){return _0x2e19e0['dropRate'];},'dropRateBump':function(){return _0x2e19e0['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x153b16=_0x276913;_0x19165d['primitives'][_0x153b16(0x1ec)][_0x153b16(0x110)][_0x153b16(0x15e)]=_0x19165d[_0x153b16(0x1e7)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x276913(0x178),'uniformMap':{'postProcessingPosition':function(){const _0x275241=_0x276913;return _0x19165d['particlesTextures'][_0x275241(0x1ec)];},'nextParticlesSpeed':function(){const _0x4b8dd3=_0x276913;return _0x19165d[_0x4b8dd3(0x1e7)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x276913(0x111)],'preExecute':function(){const _0x446854=_0x276913;_0x19165d['primitives']['postProcessingSpeed'][_0x446854(0x110)][_0x446854(0x15e)]=_0x19165d['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x540d68,_0x44525b,_0x2d2b59,_0x4656d6){const _0x474a8f=_0x30d788;this['context']=_0x540d68,_0x44525b={..._0x44525b},_0x44525b['udata']&&_0x44525b['vdata']&&(_0x44525b['dimensions']={},_0x44525b['dimensions']['lon']=_0x44525b['cols'],_0x44525b['dimensions']['lat']=_0x44525b['rows'],_0x44525b['dimensions']['lev']=_0x44525b[_0x474a8f(0x10f)]||0x1,_0x44525b['lon']={},_0x44525b[_0x474a8f(0x17f)][_0x474a8f(0x140)]=_0x44525b['xmin'],_0x44525b['lon']['max']=_0x44525b['xmax'],_0x44525b['lat']={},_0x44525b[_0x474a8f(0x169)]['min']=_0x44525b['ymin'],_0x44525b['lat']['max']=_0x44525b['ymax'],_0x44525b['lev']={},_0x44525b['lev'][_0x474a8f(0x140)]=_0x44525b['levmin']??0x1,_0x44525b[_0x474a8f(0x10f)][_0x474a8f(0x15b)]=_0x44525b['levmax']??0x1,_0x44525b['U']={},_0x44525b['U']['array']=new Float32Array(_0x44525b[_0x474a8f(0x16a)]),_0x44525b['U'][_0x474a8f(0x140)]=_0x44525b[_0x474a8f(0x135)]??Math['min'](..._0x44525b['udata']),_0x44525b['U'][_0x474a8f(0x15b)]=_0x44525b['umax']??Math[_0x474a8f(0x15b)](..._0x44525b['udata']),_0x44525b['V']={},_0x44525b['V']['array']=new Float32Array(_0x44525b['vdata']),_0x44525b['V']['min']=_0x44525b[_0x474a8f(0x1e5)]??Math[_0x474a8f(0x140)](..._0x44525b['vdata']),_0x44525b['V']['max']=_0x44525b['vmax']??Math['max'](..._0x44525b['vdata'])),this['data']=_0x44525b,this[_0x474a8f(0x191)]=_0x2d2b59,this['viewerParameters']=_0x4656d6,this[_0x474a8f(0x1c7)]=new ParticlesComputing(this[_0x474a8f(0x196)],this['data'],this['options'],this[_0x474a8f(0x1ca)]),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0x474a8f(0x1c7)]);}['canvasResize'](_0x5f5b65){const _0x407348=_0x30d788;this['particlesComputing']['destroyParticlesTextures'](),Object[_0x407348(0x1a2)](this[_0x407348(0x1c7)]['windTextures'])['forEach'](_0x15d28d=>{const _0x1ab705=_0x407348;this[_0x1ab705(0x1c7)][_0x1ab705(0x112)][_0x15d28d][_0x1ab705(0x1a0)]();}),this[_0x407348(0x11e)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x407348(0x108)])['forEach'](_0x5dfc05=>{const _0x2a9d72=_0x407348;this['particlesRendering'][_0x2a9d72(0x108)][_0x5dfc05][_0x2a9d72(0x1a0)]();}),this['context']=_0x5f5b65,this[_0x407348(0x1c7)]=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x407348(0x1ca)]),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x407348(0x1ca)],this['particlesComputing']);}['clearFramebuffers'](){const _0x3799b3=_0x30d788,_0x200ffc=new Cesium$2[(_0x3799b3(0x179))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x555596=>{const _0x1c2e96=_0x3799b3;_0x200ffc['framebuffer']=this[_0x1c2e96(0x11e)]['framebuffers'][_0x555596],_0x200ffc['execute'](this['context']);});}[_0x30d788(0x148)](_0x2572ad){const _0x30c988=_0x30d788;this[_0x30c988(0x19a)](),this['particlesComputing'][_0x30c988(0x15c)](),this['particlesComputing']['createParticlesTextures'](this['context'],this[_0x30c988(0x191)],this['viewerParameters']);if(_0x2572ad){var _0x19966b;const _0x51b992=this['particlesRendering']['createSegmentsGeometry'](this[_0x30c988(0x191)]);this['particlesRendering']['primitives']['segments'][_0x30c988(0x1a1)]=_0x51b992;const _0x46ba50=Cesium$2[_0x30c988(0x117)]['fromGeometry']({'context':this['context'],'geometry':_0x51b992,'attributeLocations':this['particlesRendering']['primitives'][_0x30c988(0x1eb)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x30c988(0x1d8)]});(_0x19966b=this['particlesRendering']['primitives'])!==null&&_0x19966b!==void 0x0&&(_0x19966b=_0x19966b['segments'])!==null&&_0x19966b!==void 0x0&&_0x19966b['commandToExecute']&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x46ba50);}}[_0x30d788(0x18b)](_0x7566cd){const _0x2e45ba=_0x30d788;let _0x59908b=![];this['options'][_0x2e45ba(0x18e)]!==_0x7566cd['maxParticles']&&(_0x59908b=!![]),Object[_0x2e45ba(0x1a2)](_0x7566cd)['forEach'](_0x5911df=>{const _0x1a8468=_0x2e45ba;this[_0x1a8468(0x191)][_0x5911df]=_0x7566cd[_0x5911df];}),this[_0x2e45ba(0x148)](_0x59908b);}['applyViewerParameters'](_0xa278a){const _0x308db1=_0x30d788;Object['keys'](_0xa278a)[_0x308db1(0x13a)](_0xc18537=>{const _0x1b12e1=_0x308db1;this[_0x1b12e1(0x1ca)][_0xc18537]=_0xa278a[_0xc18537];}),this['refreshParticles'](![]);}['destroy'](){const _0x59a827=_0x30d788;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x525af6=>{const _0x48b054=_0x52aa;this[_0x48b054(0x1c7)]['windTextures'][_0x525af6][_0x48b054(0x1a0)]();}),this[_0x59a827(0x11e)][_0x59a827(0x176)]['colorTable'][_0x59a827(0x1a0)](),Object[_0x59a827(0x1a2)](this[_0x59a827(0x11e)][_0x59a827(0x108)])['forEach'](_0x110605=>{this['particlesRendering']['framebuffers'][_0x110605]['destroy']();});for(const _0x3fd492 in this){delete this[_0x3fd492];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x30d788(0xfd)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x238f85={}){const _0x4c821a=_0x30d788;_0x238f85={...DEF_OPTIONS,..._0x238f85},super(_0x238f85),this[_0x4c821a(0x1b4)](_0x238f85);}get['layer'](){return this['primitives'];}get[_0x30d788(0x166)](){return this['_data'];}set['data'](_0x28bdd8){this['setData'](_0x28bdd8);}get['colors'](){return this['options']['colors'];}set['colors'](_0x55f121){const _0x5822bf=_0x30d788;this['options']['colors']=_0x55f121,this[_0x5822bf(0x125)]&&this['particleSystem']['setOptions']({'colors':_0x55f121}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x197cad=_0x30d788;this['scene']=this[_0x197cad(0x1b6)]['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this[_0x197cad(0x1b6)]['scene']['primitives'][_0x197cad(0x1af)](this[_0x197cad(0x1ea)]),this[_0x197cad(0x1ca)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x197cad(0x1e2))](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x197cad(0x194),this[_0x197cad(0x194)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x197cad(0x1d6)],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x4a1e10=_0x30d788;window['removeEventListener']('resize',this[_0x4a1e10(0x194)]),this[_0x4a1e10(0x1b6)][_0x4a1e10(0x105)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x4a1e10(0x16f)],this['_onMapWhellEvent'],this),this[_0x4a1e10(0x1b6)][_0x4a1e10(0x105)](mars3d__namespace['EventType'][_0x4a1e10(0x141)],this[_0x4a1e10(0x1c9)],this),this[_0x4a1e10(0x1b6)]['off'](mars3d__namespace[_0x4a1e10(0x10c)][_0x4a1e10(0x1ad)],this[_0x4a1e10(0x16b)],this),this[_0x4a1e10(0x1b6)][_0x4a1e10(0x105)](mars3d__namespace[_0x4a1e10(0x10c)][_0x4a1e10(0x156)],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}[_0x30d788(0x194)](){const _0x17c007=_0x30d788;if(!this[_0x17c007(0x1bc)]||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x9568a9){const _0x4b56df=_0x30d788;this[_0x4b56df(0x125)]['canvasResize'](this['scene']['context']),this[_0x4b56df(0x14c)](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x1c0126){const _0x5a5535=_0x30d788;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this[_0x5a5535(0x1ea)]['show']=![],this[_0x5a5535(0x115)]=setTimeout(()=>{const _0x3311f1=_0x5a5535;if(!this['show'])return;this[_0x3311f1(0x127)]();},0xc8);}['_onMouseDownEvent'](_0x2c12f5){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x7704dc){const _0x3eb5d8=_0x30d788;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this[_0x3eb5d8(0x1ea)]['show']=![],this[_0x3eb5d8(0x1e1)]=!![]);}[_0x30d788(0x16b)](_0x472581){const _0x551b3b=_0x30d788;if(!this['show']||!this[_0x551b3b(0x125)])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives'][_0x551b3b(0x1bc)]=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x5bb0cd=_0x30d788;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem'][_0x5bb0cd(0x12f)](this['viewerParameters']),this['primitives'][_0x5bb0cd(0x1bc)]=!![];}['setData'](_0x4ed341){const _0x3464db=_0x30d788;this[_0x3464db(0x14a)]=_0x4ed341,this['particleSystem']&&this[_0x3464db(0x125)][_0x3464db(0x1a0)](),this[_0x3464db(0x125)]=new ParticleSystem(this[_0x3464db(0x121)][_0x3464db(0x196)],_0x4ed341,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x315ad9,_0x432af4){if(_0x315ad9)for(const _0x3ea076 in _0x315ad9){this[_0x3ea076]=_0x315ad9[_0x3ea076];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x325c74=_0x30d788,_0x2f95a2=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x2f95a2*_0x2f95a2,{'particlesTextureSize':_0x2f95a2,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x325c74(0x15a)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this[_0x325c74(0x118)],'colors':this['colors']};}[_0x30d788(0x14c)](){const _0x2de3a8=_0x30d788;this[_0x2de3a8(0x1ea)]['add'](this[_0x2de3a8(0x125)][_0x2de3a8(0x1c7)]['primitives']['getWind']),this['primitives']['add'](this['particleSystem'][_0x2de3a8(0x1c7)]['primitives']['updateSpeed']),this[_0x2de3a8(0x1ea)][_0x2de3a8(0x1af)](this['particleSystem']['particlesComputing']['primitives'][_0x2de3a8(0x1de)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x2de3a8(0x111)]),this['primitives']['add'](this[_0x2de3a8(0x125)]['particlesRendering']['primitives'][_0x2de3a8(0x1eb)]),this['primitives'][_0x2de3a8(0x1af)](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives'][_0x2de3a8(0x1af)](this[_0x2de3a8(0x125)]['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0xf31abb=_0x30d788;let _0x50f50f=this['camera'][_0xf31abb(0x12c)](this['scene']['globe']['ellipsoid']);if(!_0x50f50f){const _0x175444=this['_map']['getExtent']();_0x50f50f=Cesium$1[_0xf31abb(0x122)]['fromDegrees'](_0x175444[_0xf31abb(0x167)],_0x175444[_0xf31abb(0x161)],_0x175444[_0xf31abb(0x1dd)],_0x175444['ymax']);}const _0x5bfc97=Util['viewRectangleToLonLatRange'](_0x50f50f);this[_0xf31abb(0x1ca)]['lonRange']['x']=_0x5bfc97['lon'][_0xf31abb(0x140)],this['viewerParameters'][_0xf31abb(0x182)]['y']=_0x5bfc97[_0xf31abb(0x17f)][_0xf31abb(0x15b)],this['viewerParameters']['latRange']['x']=_0x5bfc97['lat'][_0xf31abb(0x140)],this['viewerParameters']['latRange']['y']=_0x5bfc97['lat'][_0xf31abb(0x15b)];const _0x534751=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x534751>0x0&&(this['viewerParameters'][_0xf31abb(0x18f)]=_0x534751);}}mars3d__namespace['LayerUtil']['register'](_0x30d788(0x163),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x18d02d=_0x30d788;this[_0x18d02d(0x157)]=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x568921 in this){delete this[_0x568921];}}}class CanvasWindField{constructor(_0xf08f50){this['setOptions'](_0xf08f50);}get['speedRate'](){const _0x5879e=_0x30d788;return this[_0x5879e(0x101)];}set['speedRate'](_0x3bd1b6){const _0xa0cb8c=_0x30d788;this['_speedRate']=(0x64-(_0x3bd1b6>0x63?0x63:_0x3bd1b6))*0x64,this['_calc_speedRate']=[(this['xmax']-this[_0xa0cb8c(0x167)])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get[_0x30d788(0x12e)](){return this['_maxAge'];}set[_0x30d788(0x12e)](_0x2e9e95){this['_maxAge']=_0x2e9e95;}['setOptions'](_0x378245){const _0x26935f=_0x30d788;this[_0x26935f(0x191)]=_0x378245,this['maxAge']=_0x378245['maxAge']||0x78,this['speedRate']=_0x378245['speedRate']||0x32,this['particles']=[];const _0x3e1fd2=_0x378245['particlesNumber']||0x1000;for(let _0x60703d=0x0;_0x60703d<_0x3e1fd2;_0x60703d++){const _0x5a0092=this[_0x26935f(0xf9)](new CanvasParticle());this['particles'][_0x26935f(0xfc)](_0x5a0092);}}['setDate'](_0x1bd114){const _0x2b7208=_0x30d788;this['rows']=_0x1bd114[_0x2b7208(0x107)],this['cols']=_0x1bd114['cols'],this[_0x2b7208(0x167)]=_0x1bd114['xmin'],this['xmax']=_0x1bd114[_0x2b7208(0x1dd)],this[_0x2b7208(0x161)]=_0x1bd114[_0x2b7208(0x161)],this['ymax']=_0x1bd114[_0x2b7208(0x1d2)],this[_0x2b7208(0x186)]=[];const _0x43414e=_0x1bd114['udata'],_0x58f451=_0x1bd114[_0x2b7208(0x1b8)];let _0x2297d3=![];_0x43414e['length']===this['rows']&&_0x43414e[0x0][_0x2b7208(0x16d)]===this['cols']&&(_0x2297d3=!![]);let _0x122666=0x0,_0x493557=null,_0x227b45=null;for(let _0x353202=0x0;_0x353202<this[_0x2b7208(0x107)];_0x353202++){_0x493557=[];for(let _0x4351b9=0x0;_0x4351b9<this['cols'];_0x4351b9++,_0x122666++){_0x2297d3?_0x227b45=this['_calcUV'](_0x43414e[_0x353202][_0x4351b9],_0x58f451[_0x353202][_0x4351b9]):_0x227b45=this['_calcUV'](_0x43414e[_0x122666],_0x58f451[_0x122666]),_0x493557['push'](_0x227b45);}this[_0x2b7208(0x186)]['push'](_0x493557);}this['options'][_0x2b7208(0x170)]&&this['grid'][_0x2b7208(0x1d0)]();}[_0x30d788(0xf5)](){const _0x389a79=_0x30d788;delete this['rows'],delete this['cols'],delete this[_0x389a79(0x167)],delete this[_0x389a79(0x1dd)],delete this[_0x389a79(0x161)],delete this['ymax'],delete this['grid'],delete this['particles'];}['toGridXY'](_0x380e36,_0x5d1ca3){const _0x2d13e3=_0x30d788,_0x2ea55b=(_0x380e36-this['xmin'])/(this[_0x2d13e3(0x1dd)]-this['xmin'])*(this[_0x2d13e3(0x145)]-0x1),_0x2b9338=(this['ymax']-_0x5d1ca3)/(this[_0x2d13e3(0x1d2)]-this['ymin'])*(this['rows']-0x1);return[_0x2ea55b,_0x2b9338];}['getUVByXY'](_0x1ce4ff,_0x2a891e){const _0x3862d1=_0x30d788;if(_0x1ce4ff<0x0||_0x1ce4ff>=this['cols']||_0x2a891e>=this['rows'])return[0x0,0x0,0x0];const _0x291ece=Math['floor'](_0x1ce4ff),_0x49a4f8=Math['floor'](_0x2a891e);if(_0x291ece===_0x1ce4ff&&_0x49a4f8===_0x2a891e)return this['grid'][_0x2a891e][_0x1ce4ff];const _0x55869d=_0x291ece+0x1,_0xa83545=_0x49a4f8+0x1,_0x2a25fe=this['getUVByXY'](_0x291ece,_0x49a4f8),_0x599973=this['getUVByXY'](_0x55869d,_0x49a4f8),_0x3e8171=this[_0x3862d1(0x185)](_0x291ece,_0xa83545),_0x456cf5=this[_0x3862d1(0x185)](_0x55869d,_0xa83545);let _0x1d2108=null;try{_0x1d2108=this['_bilinearInterpolation'](_0x1ce4ff-_0x291ece,_0x2a891e-_0x49a4f8,_0x2a25fe,_0x599973,_0x3e8171,_0x456cf5);}catch(_0xbf7c96){console[_0x3862d1(0x131)](_0x1ce4ff,_0x2a891e);}return _0x1d2108;}['_bilinearInterpolation'](_0x421092,_0x2f7429,_0xcd42fd,_0x591d1f,_0x456667,_0x2ce0f4){const _0x22388f=_0x30d788,_0x5dc9d5=0x1-_0x421092,_0x3cedfc=0x1-_0x2f7429,_0x66a98a=_0x5dc9d5*_0x3cedfc,_0x28ba19=_0x421092*_0x3cedfc,_0x1b0cb0=_0x5dc9d5*_0x2f7429,_0xd61979=_0x421092*_0x2f7429,_0xa14670=_0xcd42fd[0x0]*_0x66a98a+_0x591d1f[0x0]*_0x28ba19+_0x456667[0x0]*_0x1b0cb0+_0x2ce0f4[0x0]*_0xd61979,_0x1ab1fc=_0xcd42fd[0x1]*_0x66a98a+_0x591d1f[0x1]*_0x28ba19+_0x456667[0x1]*_0x1b0cb0+_0x2ce0f4[0x1]*_0xd61979;return this[_0x22388f(0x16c)](_0xa14670,_0x1ab1fc);}['_calcUV'](_0x53e5fd,_0x4f536c){return[+_0x53e5fd,+_0x4f536c,Math['sqrt'](_0x53e5fd*_0x53e5fd+_0x4f536c*_0x4f536c)];}['getUVByPoint'](_0x57a3d6,_0x5ac300){if(!this['isInExtent'](_0x57a3d6,_0x5ac300))return null;const _0x51f930=this['toGridXY'](_0x57a3d6,_0x5ac300),_0x23fcc3=this['getUVByXY'](_0x51f930[0x0],_0x51f930[0x1]);return _0x23fcc3;}[_0x30d788(0x155)](_0x415d55,_0x323aa1){const _0x1ed385=_0x30d788;return _0x415d55>=this[_0x1ed385(0x167)]&&_0x415d55<=this[_0x1ed385(0x1dd)]&&_0x323aa1>=this['ymin']&&_0x323aa1<=this[_0x1ed385(0x1d2)]?!![]:![];}[_0x30d788(0xf4)](){const _0x53a26a=fRandomByfloat(this['xmin'],this['xmax']),_0x571ef5=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x571ef5,'lng':_0x53a26a};}['getParticles'](){const _0x58692d=_0x30d788;let _0x5c9d4e,_0x3fb4cb,_0x98c32c;for(let _0x16c471=0x0,_0x572ee0=this['particles']['length'];_0x16c471<_0x572ee0;_0x16c471++){let _0x7f6883=this['particles'][_0x16c471];_0x7f6883['age']<=0x0&&(_0x7f6883=this[_0x58692d(0xf9)](_0x7f6883));if(_0x7f6883['age']>0x0){const _0x277300=_0x7f6883[_0x58692d(0x1e9)],_0x1875b8=_0x7f6883[_0x58692d(0x162)];_0x98c32c=this[_0x58692d(0x139)](_0x277300,_0x1875b8),_0x98c32c?(_0x5c9d4e=_0x277300+this['_calc_speedRate'][0x0]*_0x98c32c[0x0],_0x3fb4cb=_0x1875b8+this['_calc_speedRate'][0x1]*_0x98c32c[0x1],_0x7f6883[_0x58692d(0x157)]=_0x277300,_0x7f6883[_0x58692d(0x169)]=_0x1875b8,_0x7f6883['tlng']=_0x5c9d4e,_0x7f6883[_0x58692d(0x162)]=_0x3fb4cb,_0x7f6883['speed']=_0x98c32c[0x2],_0x7f6883['age']--):_0x7f6883['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x59e215){const _0x2f30b3=_0x30d788;let _0x24a8a5,_0x76b1b3;for(let _0x41dc46=0x0;_0x41dc46<0x1e;_0x41dc46++){_0x24a8a5=this['getRandomLatLng'](),_0x76b1b3=this['getUVByPoint'](_0x24a8a5['lng'],_0x24a8a5['lat']);if(_0x76b1b3&&_0x76b1b3[0x2]>0x0)break;}if(!_0x76b1b3)return _0x59e215;const _0x28dc15=_0x24a8a5['lng']+this[_0x2f30b3(0x1da)][0x0]*_0x76b1b3[0x0],_0x4c17a0=_0x24a8a5['lat']+this['_calc_speedRate'][0x1]*_0x76b1b3[0x1];return _0x59e215[_0x2f30b3(0x157)]=_0x24a8a5['lng'],_0x59e215['lat']=_0x24a8a5['lat'],_0x59e215['tlng']=_0x28dc15,_0x59e215['tlat']=_0x4c17a0,_0x59e215[_0x2f30b3(0x18c)]=Math[_0x2f30b3(0xf8)](Math[_0x2f30b3(0x197)]()*this[_0x2f30b3(0x12e)]),_0x59e215['speed']=_0x76b1b3[0x2],_0x59e215;}[_0x30d788(0x1a0)](){for(const _0x44bbfd in this){delete this[_0x44bbfd];}}}function fRandomByfloat(_0xa5900,_0x16871e){return _0xa5900+Math['random']()*(_0x16871e-_0xa5900);}const Cesium=mars3d__namespace[_0x30d788(0x1a9)],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x287be9={}){const _0x8afd11=_0x30d788;super(_0x287be9),this['_setOptionsHook'](_0x287be9),this['canvas']=null,_0x287be9[_0x8afd11(0x183)]&&_0x287be9['steps']&&(this[_0x8afd11(0x130)]=new mars3d__namespace['ColorRamp'](_0x287be9));}['_setOptionsHook'](_0x24660c,_0x21d6c6){const _0x5a994f=_0x30d788;this['frameTime']=0x3e8/(_0x24660c[_0x5a994f(0x1bd)]||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x24660c['color']||'#ffffff',this['lineWidth']=_0x24660c[_0x5a994f(0x118)]||0x1,this['fixedHeight']=_0x24660c['fixedHeight']??0x0,this[_0x5a994f(0x170)]=_0x24660c['reverseY']??![],this['windField']&&this[_0x5a994f(0x193)]['setOptions'](_0x24660c);}get['layer'](){const _0x34995c=_0x30d788;return this[_0x34995c(0x173)];}get['canvasWidth'](){return this['_map']['scene']['canvas']['clientWidth'];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get[_0x30d788(0x144)](){return this['_pointerEvents'];}set['pointerEvents'](_0x167923){const _0x329fca=_0x30d788;this['_pointerEvents']=_0x167923;if(!this['canvas'])return;_0x167923?this['canvas']['style'][_0x329fca(0xff)]=_0x329fca(0x14e):this['canvas'][_0x329fca(0x1c1)]['pointer-events']=_0x329fca(0x190);}get[_0x30d788(0xfe)](){const _0x3129da=_0x30d788;return this[_0x3129da(0x191)][_0x3129da(0xfe)];}set['particlesNumber'](_0x193807){const _0x1ad965=_0x30d788;this[_0x1ad965(0x191)]['particlesNumber']=_0x193807,clearTimeout(this['_canrefresh']),this[_0x1ad965(0x10d)]=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x30d788(0x1d9)](){const _0x3b7b57=_0x30d788;return this['options'][_0x3b7b57(0x1d9)];}set[_0x30d788(0x1d9)](_0x37a790){const _0x35bd76=_0x30d788;this['options'][_0x35bd76(0x1d9)]=_0x37a790,this['windField']&&(this['windField']['speedRate']=_0x37a790);}get[_0x30d788(0x12e)](){const _0x73d5d5=_0x30d788;return this[_0x73d5d5(0x191)][_0x73d5d5(0x12e)];}set[_0x30d788(0x12e)](_0x4adc2a){const _0x45b73c=_0x30d788;this['options']['maxAge']=_0x4adc2a,this['windField']&&(this[_0x45b73c(0x193)]['maxAge']=_0x4adc2a);}get['data'](){const _0x5c7fa7=_0x30d788;return this[_0x5c7fa7(0x1c4)];}set['data'](_0x57409f){this['setData'](_0x57409f);}[_0x30d788(0x195)](_0xe41360){const _0x5c073a=_0x30d788;_0xe41360?this[_0x5c073a(0x10b)]():(this['windData']&&(this[_0x5c073a(0x191)]['data']=this[_0x5c073a(0x1c4)]),this['_removedHook']());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x30d788(0x10b)](){const _0x4d95ad=_0x30d788;this[_0x4d95ad(0x173)]=this['_createCanvas'](),this['canvasContext']=this['canvas'][_0x4d95ad(0x100)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x4d95ad(0x166)]&&this['setData'](this[_0x4d95ad(0x191)]['data']);}[_0x30d788(0x147)](){const _0x56b9a4=_0x30d788;this['clear'](),this['unbindEvent'](),this[_0x56b9a4(0x173)]&&(this['_map'][_0x56b9a4(0x1cc)]['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x2c9fa8=_0x30d788,_0x9c5bd8=mars3d__namespace['DomUtil'][_0x2c9fa8(0xf7)](_0x2c9fa8(0x173),'mars3d-canvasWind',this['_map']['container']);return _0x9c5bd8['style']['position']='absolute',_0x9c5bd8[_0x2c9fa8(0x1c1)][_0x2c9fa8(0x153)]=_0x2c9fa8(0x15d),_0x9c5bd8['style'][_0x2c9fa8(0x11f)]='0px',_0x9c5bd8['style']['width']=this[_0x2c9fa8(0x1b6)]['scene']['canvas']['clientWidth']+'px',_0x9c5bd8['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x9c5bd8['style']['pointerEvents']=this[_0x2c9fa8(0x1e8)]?'auto':_0x2c9fa8(0x190),_0x9c5bd8['style']['zIndex']=this['options']['zIndex']??0x9,_0x9c5bd8[_0x2c9fa8(0x1d1)]=this['_map']['scene'][_0x2c9fa8(0x173)]['clientWidth'],_0x9c5bd8[_0x2c9fa8(0x188)]=this['_map']['scene'][_0x2c9fa8(0x173)]['clientHeight'],_0x9c5bd8;}[_0x30d788(0x194)](){const _0x411029=_0x30d788;this['canvas']&&(this[_0x411029(0x173)]['style'][_0x411029(0x1d1)]=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this[_0x411029(0x1b6)]['scene']['canvas'][_0x411029(0x1b9)],this[_0x411029(0x173)][_0x411029(0x188)]=this[_0x411029(0x1b6)][_0x411029(0x121)]['canvas'][_0x411029(0x1c2)]);}[_0x30d788(0x10a)](){const _0x5695c0=_0x30d788,_0x2e8d02=this;let _0x233512=Date['now']();(function _0x222183(){_0x2e8d02['animateFrame']=window['requestAnimationFrame'](_0x222183);if(_0x2e8d02['show']&&_0x2e8d02['windField']){const _0x3c223a=Date['now'](),_0x1928be=_0x3c223a-_0x233512;_0x1928be>_0x2e8d02['frameTime']&&(_0x233512=_0x3c223a-_0x1928be%_0x2e8d02['frameTime'],_0x2e8d02['update']());}}(),window[_0x5695c0(0x146)](_0x5695c0(0x194),this[_0x5695c0(0x194)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options'][_0x5695c0(0x151)]&&(this[_0x5695c0(0x1b6)]['on'](mars3d__namespace[_0x5695c0(0x10c)][_0x5695c0(0x16f)],this[_0x5695c0(0xfb)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x5695c0(0x141)],this[_0x5695c0(0x1c9)],this),this[_0x5695c0(0x1b6)]['on'](mars3d__namespace['EventType'][_0x5695c0(0x1ad)],this[_0x5695c0(0x16b)],this)));}[_0x30d788(0x158)](){const _0x455ca4=_0x30d788;window[_0x455ca4(0x13f)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x455ca4(0x194)]),this[_0x455ca4(0x191)]['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType'][_0x455ca4(0x16f)],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x455ca4(0x1c9)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x243796){const _0x5421d4=_0x30d788;clearTimeout(this[_0x5421d4(0x115)]);if(!this['show']||!this['canvas'])return;this[_0x5421d4(0x173)][_0x5421d4(0x1c1)]['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x5f2b4d=_0x5421d4;if(!this['show'])return;this['redraw'](),this['canvas'][_0x5f2b4d(0x1c1)][_0x5f2b4d(0x13c)]='visible';},0xc8);}['_onMouseDownEvent'](_0x5af24c){const _0x3ab70b=_0x30d788;this[_0x3ab70b(0xfa)]=!![],this[_0x3ab70b(0x1b6)]['off'](mars3d__namespace['EventType'][_0x3ab70b(0x156)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x46437c){const _0x254f92=_0x30d788;if(!this['show']||!this['canvas'])return;this[_0x254f92(0xfa)]&&(this['canvas']['style'][_0x254f92(0x13c)]='hidden',this[_0x254f92(0x1e1)]=!![]);}['_onMouseUpEvent'](_0x19b6b4){const _0x4b49a3=_0x30d788;if(!this[_0x4b49a3(0x1bc)]||!this['canvas'])return;this[_0x4b49a3(0x1b6)][_0x4b49a3(0x105)](mars3d__namespace['EventType'][_0x4b49a3(0x156)],this['_onMouseMoveEvent'],this),this[_0x4b49a3(0xfa)]&&this[_0x4b49a3(0x1e1)]&&this[_0x4b49a3(0x127)](),this['canvas']['style']['visibility']=_0x4b49a3(0x164),this[_0x4b49a3(0xfa)]=![],this[_0x4b49a3(0x1e1)]=![];}['setData'](_0x18cce6){const _0x299584=_0x30d788;this['clear'](),this['windData']=_0x18cce6,this[_0x299584(0x193)]['setDate'](_0x18cce6),this['redraw']();}[_0x30d788(0x127)](){const _0x7b226e=_0x30d788;if(!this['show'])return;this['windField']['setOptions'](this[_0x7b226e(0x191)]),this['update']();}['update'](){const _0x1ee67e=_0x30d788;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0x1ee67e(0x1ce)])this['windField']['update']();else{const _0x2460a6=this['windField']['getParticles']();this['_drawLines'](_0x2460a6);}this['_updateIng']=![];}[_0x30d788(0x132)](_0x4bb0e3){const _0x4d7ec7=_0x30d788;this['canvasContext']['globalCompositeOperation']=_0x4d7ec7(0x19f),this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this[_0x4d7ec7(0x1b5)][_0x4d7ec7(0x15f)]='lighter',this[_0x4d7ec7(0x1b5)]['globalAlpha']=0.9;const _0x28b55d=this['_map']['scene'][_0x4d7ec7(0x11b)]!==Cesium['SceneMode']['SCENE3D'],_0x34419b=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x354164=0x0,_0x25ad14=_0x4bb0e3['length'];_0x354164<_0x25ad14;_0x354164++){const _0x131a75=_0x4bb0e3[_0x354164],_0x406e78=this[_0x4d7ec7(0x13d)](_0x131a75['lng'],_0x131a75['lat'],_0x131a75),_0x5abf5f=this['_tomap'](_0x131a75['tlng'],_0x131a75['tlat'],_0x131a75);if(!_0x406e78||!_0x5abf5f)continue;if(_0x28b55d&&Math[_0x4d7ec7(0x17c)](_0x406e78[0x0]-_0x5abf5f[0x0])>=_0x34419b)continue;this[_0x4d7ec7(0x1b5)][_0x4d7ec7(0x137)](),this[_0x4d7ec7(0x1b5)]['lineWidth']=this['lineWidth'],this[_0x4d7ec7(0x1b5)][_0x4d7ec7(0x12b)]=this[_0x4d7ec7(0x130)]['getColor'](_0x131a75[_0x4d7ec7(0x1b3)]),this['canvasContext'][_0x4d7ec7(0x13e)](_0x406e78[0x0],_0x406e78[0x1]),this['canvasContext'][_0x4d7ec7(0x116)](_0x5abf5f[0x0],_0x5abf5f[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this[_0x4d7ec7(0x1b5)]['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x4d7ec7(0x14d)];for(let _0x5f408a=0x0,_0x177e67=_0x4bb0e3['length'];_0x5f408a<_0x177e67;_0x5f408a++){const _0x1d9fa7=_0x4bb0e3[_0x5f408a],_0x4e46b5=this['_tomap'](_0x1d9fa7['lng'],_0x1d9fa7['lat'],_0x1d9fa7),_0x130139=this[_0x4d7ec7(0x13d)](_0x1d9fa7['tlng'],_0x1d9fa7['tlat'],_0x1d9fa7);if(!_0x4e46b5||!_0x130139)continue;if(_0x28b55d&&Math[_0x4d7ec7(0x17c)](_0x4e46b5[0x0]-_0x130139[0x0])>=_0x34419b)continue;this[_0x4d7ec7(0x1b5)][_0x4d7ec7(0x13e)](_0x4e46b5[0x0],_0x4e46b5[0x1]),this[_0x4d7ec7(0x1b5)][_0x4d7ec7(0x116)](_0x130139[0x0],_0x130139[0x1]);}this['canvasContext'][_0x4d7ec7(0x138)]();}}[_0x30d788(0x13d)](_0x281bdb,_0xb82ab5,_0x1131a0){const _0x274c43=_0x30d788,_0x275ab1=Cesium[_0x274c43(0x198)]['fromDegrees'](_0x281bdb,_0xb82ab5,this[_0x274c43(0x1ae)]),_0x4de7e0=this[_0x274c43(0x1b6)]['scene'];if(_0x4de7e0['mode']===Cesium['SceneMode']['SCENE3D']){const _0x5aa305=new Cesium[(_0x274c43(0x1a5))](_0x4de7e0['globe']['ellipsoid'],_0x4de7e0[_0x274c43(0x17a)][_0x274c43(0x1ac)]),_0x457794=_0x5aa305['isPointVisible'](_0x275ab1);if(!_0x457794)return _0x1131a0['age']=0x0,null;}const _0x2c442f=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x275ab1);return _0x2c442f?[_0x2c442f['x'],_0x2c442f['y']]:null;}[_0x30d788(0xf5)](){this['windField']['clear'](),delete this['windData'];}[_0x30d788(0x14f)](){const _0x3ccaa0=_0x30d788;this['worker']=new Worker(this['options'][_0x3ccaa0(0x1ce)]),this['worker']['onmessage']=_0x197ca4=>{const _0x3f5845=_0x3ccaa0;this[_0x3f5845(0x132)](_0x197ca4[_0x3f5845(0x166)]['particles']),this['_updateIng2']=![];},this[_0x3ccaa0(0x193)]={'init':_0xf8cffd=>{this['worker']['postMessage']({'type':'init','options':_0xf8cffd});},'setOptions':_0x5d7b60=>{this['worker']['postMessage']({'type':'setOptions','options':_0x5d7b60});},'setDate':_0x62c65b=>{const _0x58a8a1=_0x3ccaa0;this['worker'][_0x58a8a1(0x1a8)]({'type':_0x58a8a1(0x143),'data':_0x62c65b});},'update':()=>{const _0x17745c=_0x3ccaa0;if(this['_updateIng2'])return;this[_0x17745c(0x1df)]=!![],this['worker'][_0x17745c(0x1a8)]({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x30d788(0x1d7)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x30d788(0x165)]=WindUtil,exports[_0x30d788(0x1d3)]=CanvasWindField,exports[_0x30d788(0x152)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x30d788(0x11c),{'value':!![]});
}));
