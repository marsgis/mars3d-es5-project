/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.5
 * 编译日期：2023-09-08 17:09:48
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x39aca5=_0x5e17;(function(_0x2b5202,_0x2f3b76){const _0x179e45=_0x5e17,_0x263909=_0x2b5202();while(!![]){try{const _0x1fd824=-parseInt(_0x179e45(0x12c))/0x1*(-parseInt(_0x179e45(0x157))/0x2)+-parseInt(_0x179e45(0x175))/0x3*(-parseInt(_0x179e45(0x1ab))/0x4)+parseInt(_0x179e45(0x191))/0x5+-parseInt(_0x179e45(0x14f))/0x6+parseInt(_0x179e45(0x131))/0x7*(-parseInt(_0x179e45(0x1d1))/0x8)+-parseInt(_0x179e45(0x17f))/0x9*(parseInt(_0x179e45(0x11a))/0xa)+parseInt(_0x179e45(0x1df))/0xb*(parseInt(_0x179e45(0x177))/0xc);if(_0x1fd824===_0x2f3b76)break;else _0x263909['push'](_0x263909['shift']());}catch(_0x213e39){_0x263909['push'](_0x263909['shift']());}}}(_0x56aa,0xd1770));function _interopNamespace(_0x27a1e6){const _0x358f61=_0x5e17;if(_0x27a1e6&&_0x27a1e6['__esModule'])return _0x27a1e6;var _0x43029b=Object['create'](null);return _0x27a1e6&&Object[_0x358f61(0x1de)](_0x27a1e6)['forEach'](function(_0x5bd3a6){const _0x3aafe8=_0x358f61;if(_0x5bd3a6!==_0x3aafe8(0x14c)){var _0x5ae554=Object['getOwnPropertyDescriptor'](_0x27a1e6,_0x5bd3a6);Object['defineProperty'](_0x43029b,_0x5bd3a6,_0x5ae554['get']?_0x5ae554:{'enumerable':!![],'get':function(){return _0x27a1e6[_0x5bd3a6];}});}}),_0x43029b['default']=_0x27a1e6,_0x43029b;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x595758,_0x70a6b){const _0x53492e=_0x5e17,_0x154b72=_0x595758*Math[_0x53492e(0x19f)](Cesium$7['Math']['toRadians'](_0x70a6b));return _0x154b72;}function getV(_0x22b436,_0xe7e565){const _0x29ee72=_0x5e17,_0x2c92b2=_0x22b436*Math['sin'](Cesium$7[_0x29ee72(0x1ed)][_0x29ee72(0x1c4)](_0xe7e565));return _0x2c92b2;}function getSpeed(_0x3019a8,_0x2a5d7b){const _0x84f798=Math['sqrt'](Math['pow'](_0x3019a8,0x2)+Math['pow'](_0x2a5d7b,0x2));return _0x84f798;}function getDirection(_0x1e87e5,_0x52e6e7){const _0x424ac3=_0x5e17;let _0x4c5491=Cesium$7['Math'][_0x424ac3(0x1b3)](Math['atan2'](_0x52e6e7,_0x1e87e5));return _0x4c5491+=_0x4c5491<0x0?0x168:0x0,_0x4c5491;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x39aca5(0x195)];class CustomPrimitive{constructor(_0x450973){const _0x5c76bd=_0x39aca5;this['commandType']=_0x450973[_0x5c76bd(0x1b0)],this['geometry']=_0x450973[_0x5c76bd(0x153)],this[_0x5c76bd(0x183)]=_0x450973['attributeLocations'],this['primitiveType']=_0x450973['primitiveType'],this['uniformMap']=_0x450973[_0x5c76bd(0x1a5)],this['vertexShaderSource']=_0x450973[_0x5c76bd(0x18f)],this['fragmentShaderSource']=_0x450973[_0x5c76bd(0x1d8)],this['rawRenderState']=_0x450973['rawRenderState'],this['framebuffer']=_0x450973['framebuffer'],this[_0x5c76bd(0x161)]=_0x450973['outputTexture'],this['autoClear']=_0x450973['autoClear']??![],this['preExecute']=_0x450973[_0x5c76bd(0x187)],this['show']=!![],this[_0x5c76bd(0x17b)]=undefined,this['clearCommand']=undefined,this[_0x5c76bd(0x121)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x5c76bd(0x1f0)],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x98eca2){const _0x35f823=_0x39aca5;switch(this['commandType']){case'Draw':{const _0x5cdd32=Cesium$6['VertexArray']['fromGeometry']({'context':_0x98eca2,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x156c66=Cesium$6[_0x35f823(0x184)]['fromCache']({'context':_0x98eca2,'attributeLocations':this[_0x35f823(0x183)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x4b2a2=Cesium$6['RenderState']['fromCache'](this[_0x35f823(0x164)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x156c66,'vertexArray':_0x5cdd32,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x4b2a2,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x35f823(0x1a6))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x4e5e31,_0x2cd395){const _0x47eae9=_0x39aca5;this['geometry']=_0x2cd395;const _0x52425d=Cesium$6['VertexArray'][_0x47eae9(0x1c3)]({'context':_0x4e5e31,'geometry':this[_0x47eae9(0x153)],'attributeLocations':this[_0x47eae9(0x183)],'bufferUsage':Cesium$6[_0x47eae9(0x16a)]['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x52425d;}['update'](_0x980e36){const _0x2829e9=_0x39aca5;if(!this['show'])return;if(_0x980e36['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x980e36['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0x2829e9(0x17e)](this['clearCommand'])&&_0x980e36['commandList']['push'](this[_0x2829e9(0x1b8)]),_0x980e36['commandList'][_0x2829e9(0x194)](this['commandToExecute']);}[_0x39aca5(0x167)](){return![];}[_0x39aca5(0x12a)](){const _0x59bf3b=_0x39aca5;if(this['clearCommand']){var _0x3fd98,_0xf829cd;(_0x3fd98=this['clearCommand'])!==null&&_0x3fd98!==void 0x0&&_0x3fd98['vertexArray']&&this['clearCommand'][_0x59bf3b(0x13b)]['destroy'](),(_0xf829cd=this[_0x59bf3b(0x1b8)])!==null&&_0xf829cd!==void 0x0&&_0xf829cd[_0x59bf3b(0x172)]&&this[_0x59bf3b(0x1b8)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x59bf3b(0x17b)]['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute'][_0x59bf3b(0x172)]&&this['commandToExecute'][_0x59bf3b(0x172)]['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x3175b7=function(){const _0x1dcaf3=_0x5e17,_0x5dd6e7=new Cesium$5[(_0x1dcaf3(0x130))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x1dcaf3(0x1f3))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x5dd6e7;},_0x37c54f=function(_0x2b1670,_0x164eec){const _0x212acc=_0x5e17;if(Cesium$5['defined'](_0x164eec)){const _0x3a52e5={};_0x3a52e5['arrayBufferView']=_0x164eec,_0x2b1670[_0x212acc(0x1a0)]=_0x3a52e5;}const _0x127dcc=new Cesium$5['Texture'](_0x2b1670);return _0x127dcc;},_0x35acdb=function(_0x32bd96,_0x738de9,_0x411589){const _0x246f8f=new Cesium$5['Framebuffer']({'context':_0x32bd96,'colorTextures':[_0x738de9],'depthTexture':_0x411589});return _0x246f8f;},_0x2213ff=function(_0xb18950){const _0x485e5=_0x5e17,_0xf3aca0=!![],_0x4d2794=![],_0x531cec={'viewport':_0xb18950[_0x485e5(0x1ca)],'depthTest':_0xb18950['depthTest'],'depthMask':_0xb18950[_0x485e5(0x168)],'blending':_0xb18950['blending']},_0x9e476d=Cesium$5['Appearance']['getDefaultRenderState'](_0xf3aca0,_0x4d2794,_0x531cec);return _0x9e476d;},_0x236476=function(_0x306670){const _0x525650=_0x5e17,_0x11ef69={},_0x111bb9=Cesium$5[_0x525650(0x1ed)][_0x525650(0x1d5)](_0x306670['west'],Cesium$5['Math']['TWO_PI']),_0x1badda=Cesium$5[_0x525650(0x1ed)]['mod'](_0x306670['east'],Cesium$5['Math']['TWO_PI']),_0x1df5f5=_0x306670['width'];let _0x5de313,_0x261875;_0x1df5f5>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x5de313=0x0,_0x261875=Cesium$5[_0x525650(0x1ed)]['TWO_PI']):_0x1badda-_0x111bb9<_0x1df5f5?(_0x5de313=_0x111bb9,_0x261875=_0x111bb9+_0x1df5f5):(_0x5de313=_0x111bb9,_0x261875=_0x1badda);_0x11ef69[_0x525650(0x1e1)]={'min':Cesium$5['Math']['toDegrees'](_0x5de313),'max':Cesium$5['Math']['toDegrees'](_0x261875)};const _0x44ba56=_0x306670[_0x525650(0x14a)],_0x2d78bc=_0x306670['north'],_0x3f58ad=_0x306670[_0x525650(0x16e)],_0x1608e7=_0x3f58ad>Cesium$5[_0x525650(0x1ed)]['PI']/0xc?_0x3f58ad/0x2:0x0;let _0x58f6a2=Cesium$5['Math'][_0x525650(0x181)](_0x44ba56-_0x1608e7),_0x2f8282=Cesium$5['Math'][_0x525650(0x181)](_0x2d78bc+_0x1608e7);return _0x58f6a2<-Cesium$5[_0x525650(0x1ed)][_0x525650(0x1ac)]&&(_0x58f6a2=-Cesium$5['Math']['PI_OVER_TWO']),_0x2f8282>Cesium$5['Math']['PI_OVER_THREE']&&(_0x2f8282=Cesium$5['Math']['PI_OVER_TWO']),_0x11ef69['lat']={'min':Cesium$5['Math']['toDegrees'](_0x58f6a2),'max':Cesium$5[_0x525650(0x1ed)]['toDegrees'](_0x2f8282)},_0x11ef69;};return{'getFullscreenQuad':_0x3175b7,'createTexture':_0x37c54f,'createFramebuffer':_0x35acdb,'createRawRenderState':_0x2213ff,'viewRectangleToLonLatRange':_0x236476};}());function _0x56aa(){const _0x21d77e=['_removedHook','6965946LMmEXZ','setOptions','_updateIng','0px','geometry','_setOptionsHook','dimensions','LUMINANCE','3394jjItbH','add','textures','refreshParticles','initWorker','primitives','xmin','ymin','windField','frameTime','outputTexture','TextureMinificationFilter','Cartesian3','rawRenderState','drawingBufferWidth','canvasWind','isDestroyed','depthMask','vmax','BufferUsage','floor','lng','redraw','height','DomUtil','data','CanvasWindLayer','shaderProgram','tlat','clientHeight','6pdeKhH','cancelAnimationFrame','828YueZVN','layer','scene','NEAREST','commandToExecute','colorTable','clearFramebuffers','defined','9OcgUIr','createTexture','clampToLatitudeRange','currentParticlesSpeed','attributeLocations','ShaderProgram','isPointVisible','TRIANGLES','preExecute','Compute','currentParticlesPosition','_onMap_preRenderEvent','pointerEvents','_calc_speedRate','postProcessingPosition','getColorTexture','vertexShaderSource','LINEAR','6006325cFzCeG','array','randomizeParticles','push','Cesium','mouseMove','worker','context','postProcessingSpeed','mouse_down','ellipsoid','particlesRendering','fromCssColorString','pointer-events','cos','source','init','particleSystem','destroyParticlesTextures','speedRate','uniformMap','ComputeCommand','unbindEvent','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','PrimitiveType','fill','1423952zZUNBq','PI_OVER_THREE','Cartesian2','windData','ymax','commandType','_onMouseUpEvent','strokeStyle','toDegrees','udata','resize','register','STATIC_DRAW','clearCommand','camera','randomBetween','updatePosition','getUVByXY','_map','max','Color','lighter','red','setData','fromGeometry','toRadians','ColorRamp','framebuffers','lat','createParticlesTextures','_bilinearInterpolation','viewport','nextParticlesPosition','zIndex','width','nextTrails','onmessage','stroke','8esWHge','ShaderSource','beginPath','particlesTextureSize','mod','setDate','xmax','fragmentShaderSource','_onMapWhellEvent','ClearCommand','currentTrailsColor','getFullscreenQuad','RGB','keys','60841lUPVlo','depthTexture','lon','lonRange','TextureMagnificationFilter','wgs84ToWindowCoordinates','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','grid','rows','removeEventListener','canvasContext','off','FLOAT','nextParticlesSpeed','Math','refreshTimer','addEventListener','framebuffer','destination-in','create','GeometryAttribute','mouseUp','clear','show','clientWidth','canvas','preRender','createRenderingTextures','EventType','maxAge','10733990uDeCOx','windTextures','_tomap','dropRate','random','forEach','_speedRate','autoClear','min','viewerParameters','age','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','visibility','length','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','viewRectangleToLonLatRange','destroy','toGridXY','778fKOnOv','postMessage','wheel','_drawLines','Geometry','3659516eDjPxu','lineWidth','colors','particlesNumber','tlng','speed','particles','mouseDown','particlesTextures','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','vertexArray','pixelSize','createFramebuffer','_randomParticle','_onMouseMoveEvent','style','PixelFormat','PixelDatatype','createRawRenderState','mouse_move','fixedHeight','DEPTH_COMPONENT','options','_data','lev','south','_onMouseDownEvent','default','particlesComputing'];_0x56aa=function(){return _0x21d77e;};return _0x56aa();}function _0x5e17(_0x223f9f,_0x248f2d){const _0x56aaa7=_0x56aa();return _0x5e17=function(_0x5e1716,_0x522537){_0x5e1716=_0x5e1716-0x119;let _0x4dbe39=_0x56aaa7[_0x5e1716];return _0x4dbe39;},_0x5e17(_0x223f9f,_0x248f2d);}var segmentDraw_vert=_0x39aca5(0x128),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x39aca5(0x195)];class ParticlesRendering{constructor(_0x58a67d,_0x1d58ba,_0x5382c3,_0x938e68,_0x533129){const _0x1e9380=_0x39aca5;this[_0x1e9380(0x1fa)](_0x58a67d,_0x1d58ba,_0x5382c3['colors']),this['createRenderingFramebuffers'](_0x58a67d),this['createRenderingPrimitives'](_0x58a67d,_0x5382c3,_0x938e68,_0x533129);}['createRenderingTextures'](_0x456fb6,_0x2b7ec6,_0x18ee0b){const _0x2d961d=_0x39aca5,_0x1ebdec={'context':_0x456fb6,'width':_0x456fb6['drawingBufferWidth'],'height':_0x456fb6['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x29df9a={'context':_0x456fb6,'width':_0x456fb6[_0x2d961d(0x165)],'height':_0x456fb6['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x2d961d(0x141)][_0x2d961d(0x146)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0xd6c45e=_0x18ee0b['length'],_0x4bd18e=new Float32Array(_0xd6c45e*0x3);for(let _0x4145f6=0x0;_0x4145f6<_0xd6c45e;_0x4145f6++){const _0x40a0d3=Cesium$4[_0x2d961d(0x1bf)][_0x2d961d(0x19d)](_0x18ee0b[_0x4145f6]);_0x4bd18e[0x3*_0x4145f6]=_0x40a0d3[_0x2d961d(0x1c1)],_0x4bd18e[0x3*_0x4145f6+0x1]=_0x40a0d3['green'],_0x4bd18e[0x3*_0x4145f6+0x2]=_0x40a0d3['blue'];}const _0x2fbeae={'context':_0x456fb6,'width':_0xd6c45e,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x2d961d(0x1dd)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x2d961d(0x190)],'magnificationFilter':Cesium$4[_0x2d961d(0x1e3)]['LINEAR']})};this[_0x2d961d(0x159)]={'segmentsColor':Util['createTexture'](_0x1ebdec),'segmentsDepth':Util['createTexture'](_0x29df9a),'currentTrailsColor':Util['createTexture'](_0x1ebdec),'currentTrailsDepth':Util[_0x2d961d(0x180)](_0x29df9a),'nextTrailsColor':Util['createTexture'](_0x1ebdec),'nextTrailsDepth':Util[_0x2d961d(0x180)](_0x29df9a),'colorTable':Util['createTexture'](_0x2fbeae,_0x4bd18e)};}['createRenderingFramebuffers'](_0x503d38){const _0xbe8b4a=_0x39aca5;this['framebuffers']={'segments':Util['createFramebuffer'](_0x503d38,this[_0xbe8b4a(0x159)]['segmentsColor'],this[_0xbe8b4a(0x159)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x503d38,this['textures'][_0xbe8b4a(0x1db)],this[_0xbe8b4a(0x159)]['currentTrailsDepth']),'nextTrails':Util[_0xbe8b4a(0x13d)](_0x503d38,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0xcd7ec5){const _0x24a9c7=_0x39aca5,_0x5d9830=0x4;let _0x6055bc=[];for(let _0x3254ab=0x0;_0x3254ab<_0xcd7ec5['particlesTextureSize'];_0x3254ab++){for(let _0x44eb39=0x0;_0x44eb39<_0xcd7ec5['particlesTextureSize'];_0x44eb39++){for(let _0x4a4416=0x0;_0x4a4416<_0x5d9830;_0x4a4416++){_0x6055bc[_0x24a9c7(0x194)](_0x3254ab/_0xcd7ec5[_0x24a9c7(0x1d4)]),_0x6055bc[_0x24a9c7(0x194)](_0x44eb39/_0xcd7ec5['particlesTextureSize']);}}}_0x6055bc=new Float32Array(_0x6055bc);let _0x555ef3=[];const _0xc548ae=[-0x1,0x1],_0x215f24=[-0x1,0x1];for(let _0x125083=0x0;_0x125083<_0xcd7ec5['maxParticles'];_0x125083++){for(let _0x3018df=0x0;_0x3018df<_0x5d9830/0x2;_0x3018df++){for(let _0xa9b044=0x0;_0xa9b044<_0x5d9830/0x2;_0xa9b044++){_0x555ef3['push'](_0xc548ae[_0x3018df]),_0x555ef3['push'](_0x215f24[_0xa9b044]),_0x555ef3['push'](0x0);}}}_0x555ef3=new Float32Array(_0x555ef3);const _0x313391=0x6*_0xcd7ec5['maxParticles'],_0x5a7ef5=new Uint32Array(_0x313391);for(let _0x1575e8=0x0,_0x409dc5=0x0,_0x2bbde7=0x0;_0x1575e8<_0xcd7ec5['maxParticles'];_0x1575e8++){_0x5a7ef5[_0x409dc5++]=_0x2bbde7+0x0,_0x5a7ef5[_0x409dc5++]=_0x2bbde7+0x1,_0x5a7ef5[_0x409dc5++]=_0x2bbde7+0x2,_0x5a7ef5[_0x409dc5++]=_0x2bbde7+0x2,_0x5a7ef5[_0x409dc5++]=_0x2bbde7+0x1,_0x5a7ef5[_0x409dc5++]=_0x2bbde7+0x3,_0x2bbde7+=0x4;}const _0x53b194=new Cesium$4[(_0x24a9c7(0x130))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x24a9c7(0x1eb)],'componentsPerAttribute':0x2,'values':_0x6055bc}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x24a9c7(0x1eb)],'componentsPerAttribute':0x3,'values':_0x555ef3})}),'indices':_0x5a7ef5});return _0x53b194;}['createRenderingPrimitives'](_0x2b37dd,_0x19d754,_0x21a34f,_0x2da1a4){const _0x21a952=_0x39aca5,_0x120376=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x19d754),'primitiveType':Cesium$4[_0x21a952(0x1a9)][_0x21a952(0x186)],'uniformMap':{'currentParticlesPosition':function(){return _0x2da1a4['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x2da1a4['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x2da1a4['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x1866c7=_0x21a952;return _0x120376[_0x1866c7(0x159)][_0x1866c7(0x17c)];},'aspect':function(){return _0x2b37dd['drawingBufferWidth']/_0x2b37dd['drawingBufferHeight'];},'pixelSize':function(){return _0x21a34f['pixelSize'];},'lineWidth':function(){return _0x19d754['lineWidth'];},'particleHeight':function(){return _0x19d754['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x21a952(0x1d2))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x120376['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0xad16fb=_0x21a952;return _0x120376[_0xad16fb(0x159)]['segmentsDepth'];},'currentTrailsColor':function(){const _0x1fec5f=_0x21a952;return _0x120376[_0x1fec5f(0x1c6)]['currentTrails'][_0x1fec5f(0x18e)](0x0);},'trailsDepthTexture':function(){const _0x44d5a2=_0x21a952;return _0x120376['framebuffers']['currentTrails'][_0x44d5a2(0x1e0)];},'fadeOpacity':function(){return _0x19d754['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x21a952(0x143)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x23f3c9=_0x21a952,_0x4ae57c=_0x120376['framebuffers']['currentTrails'];_0x120376['framebuffers']['currentTrails']=_0x120376['framebuffers']['nextTrails'],_0x120376['framebuffers'][_0x23f3c9(0x1ce)]=_0x4ae57c,_0x120376[_0x23f3c9(0x15c)]['trails'][_0x23f3c9(0x17b)][_0x23f3c9(0x1f0)]=_0x120376['framebuffers']['nextTrails'],_0x120376['primitives']['trails']['clearCommand']['framebuffer']=_0x120376[_0x23f3c9(0x1c6)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x21a952(0x1dc)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){return _0x120376['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x887110=_0x21a952;return _0x120376['framebuffers'][_0x887110(0x1ce)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x21a952(0x1d2))]({'defines':[_0x21a952(0x1a8)],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x21a952(0x143)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x39aca5(0x1e5),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x39aca5(0x13a),postProcessingSpeed_frag=_0x39aca5(0x125);const Cesium$3=mars3d__namespace[_0x39aca5(0x195)];class ParticlesComputing{constructor(_0x52e36c,_0x4e453e,_0xe6e310,_0x3ae50f){const _0x2ecb20=_0x39aca5;this['data']=_0x4e453e,this['createWindTextures'](_0x52e36c,_0x4e453e),this[_0x2ecb20(0x1c8)](_0x52e36c,_0xe6e310,_0x3ae50f),this['createComputingPrimitives'](_0x4e453e,_0xe6e310,_0x3ae50f);}['createWindTextures'](_0xc5e936,_0x1d8667){const _0x46c287=_0x39aca5,_0x505b16={'context':_0xc5e936,'width':_0x1d8667[_0x46c287(0x155)]['lon'],'height':_0x1d8667[_0x46c287(0x155)][_0x46c287(0x1c7)]*(_0x1d8667['dimensions']['lev']||0x1),'pixelFormat':Cesium$3[_0x46c287(0x141)][_0x46c287(0x156)],'pixelDatatype':Cesium$3[_0x46c287(0x142)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this[_0x46c287(0x11b)]={'U':Util[_0x46c287(0x180)](_0x505b16,_0x1d8667['U']['array']),'V':Util['createTexture'](_0x505b16,_0x1d8667['V']['array'])};}['createParticlesTextures'](_0x2e56b2,_0x1d518a,_0x10f9a9){const _0x54885d=_0x39aca5,_0x144489={'context':_0x2e56b2,'width':_0x1d518a[_0x54885d(0x1d4)],'height':_0x1d518a[_0x54885d(0x1d4)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x54885d(0x1eb)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x54885d(0x162)][_0x54885d(0x17a)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x318dcd=this['randomizeParticles'](_0x1d518a['maxParticles'],_0x10f9a9),_0x2204be=new Float32Array(0x4*_0x1d518a['maxParticles'])[_0x54885d(0x1aa)](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x144489),'currentParticlesPosition':Util['createTexture'](_0x144489,_0x318dcd),'nextParticlesPosition':Util['createTexture'](_0x144489,_0x318dcd),'currentParticlesSpeed':Util[_0x54885d(0x180)](_0x144489,_0x2204be),'nextParticlesSpeed':Util['createTexture'](_0x144489,_0x2204be),'postProcessingPosition':Util['createTexture'](_0x144489,_0x318dcd),'postProcessingSpeed':Util['createTexture'](_0x144489,_0x2204be)};}[_0x39aca5(0x193)](_0x2ee039,_0x40c0d3){const _0x3e765d=_0x39aca5,_0xf467c4=new Float32Array(0x4*_0x2ee039);for(let _0x42b546=0x0;_0x42b546<_0x2ee039;_0x42b546++){_0xf467c4[0x4*_0x42b546]=Cesium$3['Math'][_0x3e765d(0x1ba)](_0x40c0d3['lonRange']['x'],_0x40c0d3['lonRange']['y']),_0xf467c4[0x4*_0x42b546+0x1]=Cesium$3['Math']['randomBetween'](_0x40c0d3['latRange']['x'],_0x40c0d3['latRange']['y']),_0xf467c4[0x4*_0x42b546+0x2]=Cesium$3[_0x3e765d(0x1ed)]['randomBetween'](this[_0x3e765d(0x170)]['lev'][_0x3e765d(0x122)],this['data']['lev'][_0x3e765d(0x1be)]),_0xf467c4[0x4*_0x42b546+0x3]=0x0;}return _0xf467c4;}['destroyParticlesTextures'](){const _0x276121=_0x39aca5;Object['keys'](this[_0x276121(0x139)])['forEach'](_0x1eb5ab=>{this['particlesTextures'][_0x1eb5ab]['destroy']();});}['createComputingPrimitives'](_0x55bc73,_0x47dc34,_0x165348){const _0x4acfe0=_0x39aca5,_0x225b46=new Cesium$3['Cartesian3'](_0x55bc73['dimensions'][_0x4acfe0(0x1e1)],_0x55bc73['dimensions']['lat'],_0x55bc73['dimensions'][_0x4acfe0(0x149)]),_0x235d1b=new Cesium$3['Cartesian3'](_0x55bc73[_0x4acfe0(0x1e1)]['min'],_0x55bc73['lat']['min'],_0x55bc73['lev']['min']),_0x1da6f8=new Cesium$3['Cartesian3'](_0x55bc73['lon'][_0x4acfe0(0x1be)],_0x55bc73[_0x4acfe0(0x1c7)][_0x4acfe0(0x1be)],_0x55bc73['lev'][_0x4acfe0(0x1be)]),_0x2614ed=new Cesium$3['Cartesian3']((_0x1da6f8['x']-_0x235d1b['x'])/(_0x225b46['x']-0x1),(_0x1da6f8['y']-_0x235d1b['y'])/(_0x225b46['y']-0x1),_0x225b46['z']>0x1?(_0x1da6f8['z']-_0x235d1b['z'])/(_0x225b46['z']-0x1):0x1),_0x390c18=new Cesium$3['Cartesian2'](_0x55bc73['U'][_0x4acfe0(0x122)],_0x55bc73['U']['max']),_0x5e1c56=new Cesium$3[(_0x4acfe0(0x1ad))](_0x55bc73['V']['min'],_0x55bc73['V']['max']),_0x14b994=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x14b994['windTextures']['U'];},'V':function(){return _0x14b994['windTextures']['V'];},'currentParticlesPosition':function(){return _0x14b994['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x225b46;},'minimum':function(){return _0x235d1b;},'maximum':function(){return _0x1da6f8;},'interval':function(){return _0x2614ed;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x4acfe0(0x139)]['particlesWind'],'preExecute':function(){const _0x27d6b5=_0x4acfe0;_0x14b994['primitives']['getWind']['commandToExecute'][_0x27d6b5(0x161)]=_0x14b994['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0xa56a7e=_0x4acfe0;return _0x14b994[_0xa56a7e(0x139)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x14b994['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x390c18;},'vSpeedRange':function(){return _0x5e1c56;},'pixelSize':function(){const _0x177d4a=_0x4acfe0;return _0x165348[_0x177d4a(0x13c)];},'speedFactor':function(){return _0x47dc34['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x4acfe0(0x1ec)],'preExecute':function(){const _0x9e35df=_0x4acfe0,_0x41b4ff=_0x14b994['particlesTextures']['currentParticlesSpeed'];_0x14b994['particlesTextures']['currentParticlesSpeed']=_0x14b994['particlesTextures']['postProcessingSpeed'],_0x14b994['particlesTextures'][_0x9e35df(0x199)]=_0x41b4ff,_0x14b994['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x14b994['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x14b994['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x57f4b0=_0x4acfe0;return _0x14b994['particlesTextures'][_0x57f4b0(0x182)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x4acfe0(0x1cb)],'preExecute':function(){const _0x3083b7=_0x4acfe0,_0x31c0cb=_0x14b994[_0x3083b7(0x139)]['currentParticlesPosition'];_0x14b994[_0x3083b7(0x139)][_0x3083b7(0x189)]=_0x14b994['particlesTextures']['postProcessingPosition'],_0x14b994[_0x3083b7(0x139)]['postProcessingPosition']=_0x31c0cb,_0x14b994[_0x3083b7(0x15c)]['updatePosition'][_0x3083b7(0x17b)]['outputTexture']=_0x14b994['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x4acfe0(0x188),'uniformMap':{'nextParticlesPosition':function(){return _0x14b994['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x14b994['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x165348['lonRange'];},'latRange':function(){return _0x165348['latRange'];},'randomCoefficient':function(){const _0x2377bb=_0x4acfe0,_0x254878=Math[_0x2377bb(0x11e)]();return _0x254878;},'dropRate':function(){return _0x47dc34['dropRate'];},'dropRateBump':function(){return _0x47dc34['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x4acfe0(0x1d2))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x59fba5=_0x4acfe0;_0x14b994['primitives']['postProcessingPosition'][_0x59fba5(0x17b)]['outputTexture']=_0x14b994['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x4acfe0(0x188),'uniformMap':{'postProcessingPosition':function(){return _0x14b994['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x14b994['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x4acfe0(0x199)],'preExecute':function(){const _0x1e5af4=_0x4acfe0;_0x14b994[_0x1e5af4(0x15c)]['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x14b994['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x39aca5(0x195)];class ParticleSystem{constructor(_0x37db97,_0x3865a2,_0x230728,_0x3b42bc){const _0x171ce5=_0x39aca5;this[_0x171ce5(0x198)]=_0x37db97,_0x3865a2={..._0x3865a2},_0x3865a2['udata']&&_0x3865a2['vdata']&&(_0x3865a2['dimensions']={},_0x3865a2['dimensions'][_0x171ce5(0x1e1)]=_0x3865a2['cols'],_0x3865a2['dimensions']['lat']=_0x3865a2['rows'],_0x3865a2['dimensions']['lev']=_0x3865a2[_0x171ce5(0x149)]||0x1,_0x3865a2['lon']={},_0x3865a2['lon']['min']=_0x3865a2['xmin'],_0x3865a2['lon']['max']=_0x3865a2[_0x171ce5(0x1d7)],_0x3865a2['lat']={},_0x3865a2['lat']['min']=_0x3865a2[_0x171ce5(0x15e)],_0x3865a2['lat']['max']=_0x3865a2['ymax'],_0x3865a2[_0x171ce5(0x149)]={},_0x3865a2['lev'][_0x171ce5(0x122)]=_0x3865a2['levmin']??0x1,_0x3865a2['lev'][_0x171ce5(0x1be)]=_0x3865a2['levmax']??0x1,_0x3865a2['U']={},_0x3865a2['U']['array']=new Float32Array(_0x3865a2[_0x171ce5(0x1b4)]),_0x3865a2['U']['min']=_0x3865a2['umin']??Math['min'](..._0x3865a2[_0x171ce5(0x1b4)]),_0x3865a2['U']['max']=_0x3865a2['umax']??Math['max'](..._0x3865a2[_0x171ce5(0x1b4)]),_0x3865a2['V']={},_0x3865a2['V'][_0x171ce5(0x192)]=new Float32Array(_0x3865a2['vdata']),_0x3865a2['V'][_0x171ce5(0x122)]=_0x3865a2['vmin']??Math['min'](..._0x3865a2['vdata']),_0x3865a2['V']['max']=_0x3865a2[_0x171ce5(0x169)]??Math['max'](..._0x3865a2['vdata'])),this[_0x171ce5(0x170)]=_0x3865a2,this['options']=_0x230728,this['viewerParameters']=_0x3b42bc,this['particlesComputing']=new ParticlesComputing(this[_0x171ce5(0x198)],this['data'],this['options'],this['viewerParameters']),this[_0x171ce5(0x19c)]=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x171ce5(0x123)],this['particlesComputing']);}['canvasResize'](_0x4dbc67){const _0x5c03be=_0x39aca5;this['particlesComputing'][_0x5c03be(0x1a3)](),Object['keys'](this[_0x5c03be(0x14d)][_0x5c03be(0x11b)])['forEach'](_0x25c668=>{const _0x94350=_0x5c03be;this['particlesComputing'][_0x94350(0x11b)][_0x25c668][_0x94350(0x12a)]();}),this['particlesRendering']['textures']['colorTable'][_0x5c03be(0x12a)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x199482=>{const _0x16e43c=_0x5c03be;this['particlesRendering']['framebuffers'][_0x199482][_0x16e43c(0x12a)]();}),this['context']=_0x4dbc67,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x5c03be(0x147)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x5c03be(0x198)],this[_0x5c03be(0x170)],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x39aca5(0x17d)](){const _0x367811=_0x39aca5,_0xa59379=new Cesium$2[(_0x367811(0x1da))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this[_0x367811(0x19c)]['framebuffers'])['forEach'](_0xd47899=>{const _0x14eb6a=_0x367811;_0xa59379[_0x14eb6a(0x1f0)]=this['particlesRendering']['framebuffers'][_0xd47899],_0xa59379['execute'](this[_0x14eb6a(0x198)]);});}['refreshParticles'](_0x18c2e2){const _0x1a59e0=_0x39aca5;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x18c2e2){var _0x88fa3,_0x2a3627;const _0x43a686=this[_0x1a59e0(0x19c)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x43a686;const _0x4fb85b=Cesium$2['VertexArray'][_0x1a59e0(0x1c3)]({'context':this['context'],'geometry':_0x43a686,'attributeLocations':this['particlesRendering']['primitives']['segments'][_0x1a59e0(0x183)],'bufferUsage':Cesium$2['BufferUsage'][_0x1a59e0(0x1b7)]});(_0x88fa3=this['particlesRendering'][_0x1a59e0(0x15c)])!==null&&_0x88fa3!==void 0x0&&(_0x2a3627=_0x88fa3['segments'])!==null&&_0x2a3627!==void 0x0&&_0x2a3627[_0x1a59e0(0x17b)]&&(this['particlesRendering']['primitives']['segments'][_0x1a59e0(0x17b)]['vertexArray']=_0x4fb85b);}}['setOptions'](_0x108273){const _0x56308f=_0x39aca5;let _0xc1200d=![];this['options']['maxParticles']!==_0x108273['maxParticles']&&(_0xc1200d=!![]),Object['keys'](_0x108273)['forEach'](_0x21619e=>{this['options'][_0x21619e]=_0x108273[_0x21619e];}),this[_0x56308f(0x15a)](_0xc1200d);}['applyViewerParameters'](_0x2d0077){const _0x3d444b=_0x39aca5;Object['keys'](_0x2d0077)[_0x3d444b(0x11f)](_0x55f444=>{this['viewerParameters'][_0x55f444]=_0x2d0077[_0x55f444];}),this[_0x3d444b(0x15a)](![]);}['destroy'](){const _0x6d4f21=_0x39aca5;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x45ecd1=>{this['particlesComputing']['windTextures'][_0x45ecd1]['destroy']();}),this[_0x6d4f21(0x19c)][_0x6d4f21(0x159)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x2c2a76=>{const _0x1d9e62=_0x6d4f21;this[_0x1d9e62(0x19c)]['framebuffers'][_0x2c2a76][_0x1d9e62(0x12a)]();});for(const _0xa8dacb in this){delete this[_0xa8dacb];}}}const Cesium$1=mars3d__namespace[_0x39aca5(0x195)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x135a84={}){_0x135a84={...DEF_OPTIONS,..._0x135a84},super(_0x135a84),this['_setOptionsHook'](_0x135a84);}get['layer'](){const _0x1d5729=_0x39aca5;return this[_0x1d5729(0x15c)];}get[_0x39aca5(0x170)](){return this['_data'];}set['data'](_0x12c031){this['setData'](_0x12c031);}get['colors'](){return this['options']['colors'];}set['colors'](_0x3dcf1d){const _0x10fe94=_0x39aca5;this['options']['colors']=_0x3dcf1d,this['particleSystem']&&this['particleSystem'][_0x10fe94(0x150)]({'colors':_0x3dcf1d}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x3c549a=_0x39aca5;this['scene']=this[_0x3c549a(0x1bd)]['scene'],this['camera']=this['_map']['camera'],this[_0x3c549a(0x15c)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x3c549a(0x1b5),this['resize']['bind'](this),![]),this[_0x3c549a(0x19a)]=![],this[_0x3c549a(0x144)]=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x3c549a(0x1bd)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x3c549a(0x1f4)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace[_0x3c549a(0x1fb)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x3c549a(0x148)]);}[_0x39aca5(0x14e)](){const _0x2a2fc5=_0x39aca5;window[_0x2a2fc5(0x1e8)]('resize',this[_0x2a2fc5(0x1b5)]),this[_0x2a2fc5(0x1bd)]['off'](mars3d__namespace['EventType'][_0x2a2fc5(0x1f9)],this['_onMap_preRenderEvent'],this),this['_map'][_0x2a2fc5(0x1ea)](mars3d__namespace[_0x2a2fc5(0x1fb)]['wheel'],this['_onMapWhellEvent'],this),this[_0x2a2fc5(0x1bd)]['off'](mars3d__namespace[_0x2a2fc5(0x1fb)][_0x2a2fc5(0x138)],this['_onMouseDownEvent'],this),this[_0x2a2fc5(0x1bd)][_0x2a2fc5(0x1ea)](mars3d__namespace[_0x2a2fc5(0x1fb)][_0x2a2fc5(0x1f4)],this[_0x2a2fc5(0x1b1)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map'][_0x2a2fc5(0x179)]['primitives']['remove'](this[_0x2a2fc5(0x15c)]);}['resize'](){const _0xb26f6b=_0x39aca5;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace[_0xb26f6b(0x1fb)]['preRender'],this[_0xb26f6b(0x18a)],this);}['_onMap_preRenderEvent'](_0xea579b){const _0x201690=_0x39aca5;this['particleSystem']['canvasResize'](this['scene'][_0x201690(0x198)]),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x14d8f0){const _0x53ded4=_0x39aca5;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x53ded4(0x1ee)]=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x44aea8){this['mouse_down']=!![];}[_0x39aca5(0x13f)](_0xcff6ba){const _0x8f00ec=_0x39aca5;if(!this[_0x8f00ec(0x1f6)]||!this[_0x8f00ec(0x1a2)])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}[_0x39aca5(0x1b1)](_0x41d8ec){const _0x3339a0=_0x39aca5;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this[_0x3339a0(0x19a)]=![],this['mouse_move']=![];}[_0x39aca5(0x16d)](){const _0x4c9619=_0x39aca5;if(!this['_map']||!this[_0x4c9619(0x1f6)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this[_0x4c9619(0x123)]),this['primitives']['show']=!![];}['setData'](_0x15380b){const _0x47e7cf=_0x39aca5;this[_0x47e7cf(0x148)]=_0x15380b,this[_0x47e7cf(0x1a2)]&&this['particleSystem'][_0x47e7cf(0x12a)](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x15380b,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x1cebbe,_0x361187){if(_0x1cebbe)for(const _0x2c651d in _0x1cebbe){this[_0x2c651d]=_0x1cebbe[_0x2c651d];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x181a8e=_0x39aca5,_0x5f185b=Math['ceil'](Math['sqrt'](this[_0x181a8e(0x134)]));return this[_0x181a8e(0x134)]=_0x5f185b*_0x5f185b,{'particlesTextureSize':_0x5f185b,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x181a8e(0x11d)],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x181a8e(0x133)]};}['addPrimitives'](){const _0xb01172=_0x39aca5;this['primitives'][_0xb01172(0x158)](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives'][_0xb01172(0x158)](this[_0xb01172(0x1a2)]['particlesComputing']['primitives']['updateSpeed']),this[_0xb01172(0x15c)]['add'](this[_0xb01172(0x1a2)][_0xb01172(0x14d)]['primitives'][_0xb01172(0x1bb)]),this['primitives']['add'](this[_0xb01172(0x1a2)]['particlesComputing']['primitives'][_0xb01172(0x18d)]),this[_0xb01172(0x15c)][_0xb01172(0x158)](this['particleSystem']['particlesComputing']['primitives'][_0xb01172(0x199)]),this[_0xb01172(0x15c)]['add'](this['particleSystem'][_0xb01172(0x19c)]['primitives']['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives']['add'](this['particleSystem'][_0xb01172(0x19c)]['primitives']['screen']);}['updateViewerParameters'](){const _0x1010bf=_0x39aca5;let _0x3ae747=this['camera']['computeViewRectangle'](this['scene']['globe'][_0x1010bf(0x19b)]);if(!_0x3ae747){const _0x4289c6=this['_map']['getExtent']();_0x3ae747=Cesium$1['Rectangle']['fromDegrees'](_0x4289c6['xmin'],_0x4289c6['ymin'],_0x4289c6[_0x1010bf(0x1d7)],_0x4289c6[_0x1010bf(0x1af)]);}const _0x144f3a=Util[_0x1010bf(0x129)](_0x3ae747);this['viewerParameters']['lonRange']['x']=_0x144f3a[_0x1010bf(0x1e1)]['min'],this[_0x1010bf(0x123)][_0x1010bf(0x1e2)]['y']=_0x144f3a['lon'][_0x1010bf(0x1be)],this[_0x1010bf(0x123)]['latRange']['x']=_0x144f3a['lat']['min'],this[_0x1010bf(0x123)]['latRange']['y']=_0x144f3a[_0x1010bf(0x1c7)]['max'];const _0x443b05=this[_0x1010bf(0x1b9)]['getPixelSize'](this['globeBoundingSphere'],this[_0x1010bf(0x179)]['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x443b05>0x0&&(this['viewerParameters'][_0x1010bf(0x13c)]=_0x443b05);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x418318=_0x39aca5;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this[_0x418318(0x136)]=null;}[_0x39aca5(0x12a)](){for(const _0x22a73d in this){delete this[_0x22a73d];}}}class CanvasWindField{constructor(_0x6bad5e){this['setOptions'](_0x6bad5e);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x2f0f19){const _0x32e6e8=_0x39aca5;this[_0x32e6e8(0x120)]=(0x64-(_0x2f0f19>0x63?0x63:_0x2f0f19))*0x64,this['_calc_speedRate']=[(this[_0x32e6e8(0x1d7)]-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this[_0x32e6e8(0x120)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x3ca1db){this['_maxAge']=_0x3ca1db;}['setOptions'](_0x36cb4f){const _0x149568=_0x39aca5;this['options']=_0x36cb4f,this['maxAge']=_0x36cb4f['maxAge']||0x78,this[_0x149568(0x1a4)]=_0x36cb4f[_0x149568(0x1a4)]||0x32,this['particles']=[];const _0x4b4544=_0x36cb4f['particlesNumber']||0x1000;for(let _0x23ac1d=0x0;_0x23ac1d<_0x4b4544;_0x23ac1d++){const _0x47e160=this['_randomParticle'](new CanvasParticle());this['particles'][_0x149568(0x194)](_0x47e160);}}['setDate'](_0x3a38ea){const _0x4fd310=_0x39aca5;this[_0x4fd310(0x1e7)]=_0x3a38ea['rows'],this['cols']=_0x3a38ea['cols'],this['xmin']=_0x3a38ea['xmin'],this['xmax']=_0x3a38ea['xmax'],this['ymin']=_0x3a38ea['ymin'],this[_0x4fd310(0x1af)]=_0x3a38ea['ymax'],this['grid']=[];const _0xd5f0c=_0x3a38ea[_0x4fd310(0x1b4)],_0x253273=_0x3a38ea['vdata'];let _0x5a1f37=![];_0xd5f0c['length']===this[_0x4fd310(0x1e7)]&&_0xd5f0c[0x0][_0x4fd310(0x127)]===this['cols']&&(_0x5a1f37=!![]);let _0x4857bc=0x0,_0x271327=null,_0x3d860d=null;for(let _0x2eb21d=0x0;_0x2eb21d<this['rows'];_0x2eb21d++){_0x271327=[];for(let _0x4a59c0=0x0;_0x4a59c0<this['cols'];_0x4a59c0++,_0x4857bc++){_0x5a1f37?_0x3d860d=this['_calcUV'](_0xd5f0c[_0x2eb21d][_0x4a59c0],_0x253273[_0x2eb21d][_0x4a59c0]):_0x3d860d=this['_calcUV'](_0xd5f0c[_0x4857bc],_0x253273[_0x4857bc]),_0x271327[_0x4fd310(0x194)](_0x3d860d);}this['grid']['push'](_0x271327);}this['options']['reverseY']&&this[_0x4fd310(0x1e6)]['reverse']();}['clear'](){const _0x2f42f5=_0x39aca5;delete this[_0x2f42f5(0x1e7)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x2f42f5(0x15e)],delete this['ymax'],delete this[_0x2f42f5(0x1e6)],delete this['particles'];}['toGridXY'](_0x1ec4d8,_0x445588){const _0x41cc88=_0x39aca5,_0x289baa=(_0x1ec4d8-this[_0x41cc88(0x15d)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x5f13a8=(this[_0x41cc88(0x1af)]-_0x445588)/(this[_0x41cc88(0x1af)]-this['ymin'])*(this[_0x41cc88(0x1e7)]-0x1);return[_0x289baa,_0x5f13a8];}['getUVByXY'](_0x191f32,_0x2bb397){const _0x1120d6=_0x39aca5;if(_0x191f32<0x0||_0x191f32>=this['cols']||_0x2bb397>=this['rows'])return[0x0,0x0,0x0];const _0x5112d6=Math['floor'](_0x191f32),_0x2a6a25=Math[_0x1120d6(0x16b)](_0x2bb397);if(_0x5112d6===_0x191f32&&_0x2a6a25===_0x2bb397)return this['grid'][_0x2bb397][_0x191f32];const _0x24f426=_0x5112d6+0x1,_0x392bda=_0x2a6a25+0x1,_0x6a0ae3=this[_0x1120d6(0x1bc)](_0x5112d6,_0x2a6a25),_0x77e17b=this['getUVByXY'](_0x24f426,_0x2a6a25),_0x834a46=this['getUVByXY'](_0x5112d6,_0x392bda),_0x402b91=this['getUVByXY'](_0x24f426,_0x392bda);let _0x50c9db=null;try{_0x50c9db=this['_bilinearInterpolation'](_0x191f32-_0x5112d6,_0x2bb397-_0x2a6a25,_0x6a0ae3,_0x77e17b,_0x834a46,_0x402b91);}catch(_0x44a9ff){console['log'](_0x191f32,_0x2bb397);}return _0x50c9db;}[_0x39aca5(0x1c9)](_0x2e96d6,_0x555732,_0x111eb2,_0x26f342,_0x287774,_0x2b70a7){const _0x1302e9=0x1-_0x2e96d6,_0x2dd883=0x1-_0x555732,_0x1853a4=_0x1302e9*_0x2dd883,_0x49736f=_0x2e96d6*_0x2dd883,_0x3dd81e=_0x1302e9*_0x555732,_0x4f8db9=_0x2e96d6*_0x555732,_0x388cdf=_0x111eb2[0x0]*_0x1853a4+_0x26f342[0x0]*_0x49736f+_0x287774[0x0]*_0x3dd81e+_0x2b70a7[0x0]*_0x4f8db9,_0x84b365=_0x111eb2[0x1]*_0x1853a4+_0x26f342[0x1]*_0x49736f+_0x287774[0x1]*_0x3dd81e+_0x2b70a7[0x1]*_0x4f8db9;return this['_calcUV'](_0x388cdf,_0x84b365);}['_calcUV'](_0x53de95,_0x5ed74d){return[+_0x53de95,+_0x5ed74d,Math['sqrt'](_0x53de95*_0x53de95+_0x5ed74d*_0x5ed74d)];}['getUVByPoint'](_0x48176a,_0x44e8b6){const _0x4ba656=_0x39aca5;if(!this['isInExtent'](_0x48176a,_0x44e8b6))return null;const _0x36c51f=this[_0x4ba656(0x12b)](_0x48176a,_0x44e8b6),_0x3abd44=this['getUVByXY'](_0x36c51f[0x0],_0x36c51f[0x1]);return _0x3abd44;}['isInExtent'](_0x17ec3d,_0x17be26){return _0x17ec3d>=this['xmin']&&_0x17ec3d<=this['xmax']&&_0x17be26>=this['ymin']&&_0x17be26<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x5d8cd0=_0x39aca5,_0x50e1c3=fRandomByfloat(this['xmin'],this['xmax']),_0x485c03=fRandomByfloat(this[_0x5d8cd0(0x15e)],this['ymax']);return{'lat':_0x485c03,'lng':_0x50e1c3};}['getParticles'](){const _0x191340=_0x39aca5;let _0x2001bd,_0x44e68b,_0x3fb26f;for(let _0x4eebb9=0x0,_0x172524=this['particles']['length'];_0x4eebb9<_0x172524;_0x4eebb9++){let _0x1a750f=this['particles'][_0x4eebb9];_0x1a750f[_0x191340(0x124)]<=0x0&&(_0x1a750f=this[_0x191340(0x13e)](_0x1a750f));if(_0x1a750f[_0x191340(0x124)]>0x0){const _0x541e2f=_0x1a750f['tlng'],_0x2d2ab6=_0x1a750f['tlat'];_0x3fb26f=this['getUVByPoint'](_0x541e2f,_0x2d2ab6),_0x3fb26f?(_0x2001bd=_0x541e2f+this['_calc_speedRate'][0x0]*_0x3fb26f[0x0],_0x44e68b=_0x2d2ab6+this[_0x191340(0x18c)][0x1]*_0x3fb26f[0x1],_0x1a750f[_0x191340(0x16c)]=_0x541e2f,_0x1a750f['lat']=_0x2d2ab6,_0x1a750f[_0x191340(0x135)]=_0x2001bd,_0x1a750f[_0x191340(0x173)]=_0x44e68b,_0x1a750f['speed']=_0x3fb26f[0x2],_0x1a750f['age']--):_0x1a750f[_0x191340(0x124)]=0x0;}}return this['particles'];}['_randomParticle'](_0x5db95d){const _0x542200=_0x39aca5;let _0x3034be,_0x32a081;for(let _0x51f5c9=0x0;_0x51f5c9<0x1e;_0x51f5c9++){_0x3034be=this['getRandomLatLng'](),_0x32a081=this['getUVByPoint'](_0x3034be[_0x542200(0x16c)],_0x3034be['lat']);if(_0x32a081&&_0x32a081[0x2]>0x0)break;}if(!_0x32a081)return _0x5db95d;const _0x122452=_0x3034be['lng']+this['_calc_speedRate'][0x0]*_0x32a081[0x0],_0x3a31d4=_0x3034be['lat']+this['_calc_speedRate'][0x1]*_0x32a081[0x1];return _0x5db95d['lng']=_0x3034be['lng'],_0x5db95d['lat']=_0x3034be['lat'],_0x5db95d['tlng']=_0x122452,_0x5db95d[_0x542200(0x173)]=_0x3a31d4,_0x5db95d[_0x542200(0x124)]=Math['round'](Math[_0x542200(0x11e)]()*this[_0x542200(0x119)]),_0x5db95d['speed']=_0x32a081[0x2],_0x5db95d;}['destroy'](){for(const _0x947963 in this){delete this[_0x947963];}}}function fRandomByfloat(_0x8809b,_0x49abad){const _0x241719=_0x39aca5;return _0x8809b+Math[_0x241719(0x11e)]()*(_0x49abad-_0x8809b);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x39aca5(0x178)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0xe9337d={}){const _0x48a553=_0x39aca5;super(_0xe9337d),this['_setOptionsHook'](_0xe9337d),this[_0x48a553(0x1f8)]=null,_0xe9337d[_0x48a553(0x133)]&&_0xe9337d['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x48a553(0x1c5))](_0xe9337d));}[_0x39aca5(0x154)](_0x26c428,_0x1b6c6e){const _0x2e3c92=_0x39aca5;this['frameTime']=0x3e8/(_0x26c428['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x26c428['color']||'#ffffff',this[_0x2e3c92(0x132)]=_0x26c428['lineWidth']||0x1,this['fixedHeight']=_0x26c428['fixedHeight']??0x0,this['reverseY']=_0x26c428['reverseY']??![],this['windField']&&this[_0x2e3c92(0x15f)]['setOptions'](_0x26c428);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x744238=_0x39aca5;return this['_map']['scene']['canvas'][_0x744238(0x1f7)];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x48a740){const _0x43bfb5=_0x39aca5;this['_pointerEvents']=_0x48a740;if(!this['canvas'])return;_0x48a740?this['canvas']['style'][_0x43bfb5(0x19e)]='all':this[_0x43bfb5(0x1f8)][_0x43bfb5(0x140)]['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x6f998c){const _0x2bfd97=_0x39aca5;this['options'][_0x2bfd97(0x134)]=_0x6f998c,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{const _0x1a03e8=_0x2bfd97;this[_0x1a03e8(0x16d)]();},0x1f4);}get['speedRate'](){const _0x6cc068=_0x39aca5;return this['options'][_0x6cc068(0x1a4)];}set[_0x39aca5(0x1a4)](_0x223dbc){const _0x1fc403=_0x39aca5;this[_0x1fc403(0x147)]['speedRate']=_0x223dbc,this['windField']&&(this['windField']['speedRate']=_0x223dbc);}get['maxAge'](){const _0x2fad9f=_0x39aca5;return this[_0x2fad9f(0x147)]['maxAge'];}set['maxAge'](_0x19a29e){this['options']['maxAge']=_0x19a29e,this['windField']&&(this['windField']['maxAge']=_0x19a29e);}get['data'](){const _0x279d96=_0x39aca5;return this[_0x279d96(0x1ae)];}set[_0x39aca5(0x170)](_0x11cd5b){this['setData'](_0x11cd5b);}['_showHook'](_0x2a9085){_0x2a9085?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x5f0bed=_0x39aca5;this['options']['worker']?this[_0x5f0bed(0x15b)]():this[_0x5f0bed(0x15f)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x2f4b16=_0x39aca5;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options'][_0x2f4b16(0x170)]);}[_0x39aca5(0x14e)](){this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x346002=_0x39aca5,_0x4bbc14=mars3d__namespace[_0x346002(0x16f)][_0x346002(0x1f2)]('canvas','mars3d-canvasWind',this[_0x346002(0x1bd)]['container']);return _0x4bbc14[_0x346002(0x140)]['position']='absolute',_0x4bbc14['style']['top']='0px',_0x4bbc14[_0x346002(0x140)]['left']=_0x346002(0x152),_0x4bbc14[_0x346002(0x140)]['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x4bbc14['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x4bbc14['style'][_0x346002(0x18b)]=this['_pointerEvents']?'auto':'none',_0x4bbc14[_0x346002(0x140)][_0x346002(0x1cc)]=this['options'][_0x346002(0x1cc)]??0x9,_0x4bbc14[_0x346002(0x1cd)]=this['_map'][_0x346002(0x179)]['canvas'][_0x346002(0x1f7)],_0x4bbc14[_0x346002(0x16e)]=this[_0x346002(0x1bd)][_0x346002(0x179)][_0x346002(0x1f8)]['clientHeight'],_0x4bbc14;}['resize'](){const _0x14c1a6=_0x39aca5;this[_0x14c1a6(0x1f8)]&&(this[_0x14c1a6(0x1f8)]['style']['width']=this[_0x14c1a6(0x1bd)][_0x14c1a6(0x179)]['canvas'][_0x14c1a6(0x1f7)]+'px',this[_0x14c1a6(0x1f8)]['style']['height']=this['_map'][_0x14c1a6(0x179)]['canvas']['clientHeight']+'px',this[_0x14c1a6(0x1f8)]['width']=this['_map']['scene']['canvas']['clientWidth'],this['canvas'][_0x14c1a6(0x16e)]=this[_0x14c1a6(0x1bd)]['scene']['canvas'][_0x14c1a6(0x174)]);}['bindEvent'](){const _0x48b809=_0x39aca5,_0x3a271e=this;let _0x118128=Date['now']();(function _0x522df7(){const _0x140955=_0x5e17;_0x3a271e['animateFrame']=window['requestAnimationFrame'](_0x522df7);if(_0x3a271e[_0x140955(0x1f6)]&&_0x3a271e[_0x140955(0x15f)]){const _0x472330=Date['now'](),_0x40bd3e=_0x472330-_0x118128;_0x40bd3e>_0x3a271e['frameTime']&&(_0x118128=_0x472330-_0x40bd3e%_0x3a271e[_0x140955(0x160)],_0x3a271e['update']());}}(),window[_0x48b809(0x1ef)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x48b809(0x147)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x48b809(0x1fb)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x48b809(0x1fb)]['mouseUp'],this[_0x48b809(0x1b1)],this)));}[_0x39aca5(0x1a7)](){const _0x326809=_0x39aca5;window[_0x326809(0x176)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener'](_0x326809(0x1b5),this['resize']),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType'][_0x326809(0x12e)],this[_0x326809(0x1d9)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x326809(0x14b)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x326809(0x1b1)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x326809(0x196)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x14383e){const _0x20a014=_0x39aca5;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x20a014(0x1f8)])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0xf6a3f5=_0x20a014;if(!this[_0xf6a3f5(0x1f6)])return;this['redraw'](),this['canvas']['style'][_0xf6a3f5(0x126)]='visible';},0xc8);}['_onMouseDownEvent'](_0x29f1d8){const _0x57b2f2=_0x39aca5;this['mouse_down']=!![],this['_map'][_0x57b2f2(0x1ea)](mars3d__namespace['EventType'][_0x57b2f2(0x196)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x57b2f2(0x196)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x22ae6e){const _0x33cf1a=_0x39aca5;if(!this['show']||!this[_0x33cf1a(0x1f8)])return;this['mouse_down']&&(this[_0x33cf1a(0x1f8)]['style']['visibility']='hidden',this[_0x33cf1a(0x144)]=!![]);}['_onMouseUpEvent'](_0x5dd1d3){const _0x2c2161=_0x39aca5;if(!this['show']||!this[_0x2c2161(0x1f8)])return;this[_0x2c2161(0x1bd)]['off'](mars3d__namespace['EventType'][_0x2c2161(0x196)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x2c2161(0x144)]&&this['redraw'](),this['canvas'][_0x2c2161(0x140)][_0x2c2161(0x126)]='visible',this['mouse_down']=![],this['mouse_move']=![];}[_0x39aca5(0x1c2)](_0x1d98e0){const _0xbe8af9=_0x39aca5;this[_0xbe8af9(0x1f5)](),this['windData']=_0x1d98e0,this[_0xbe8af9(0x15f)]['setDate'](_0x1d98e0),this[_0xbe8af9(0x16d)]();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}['update'](){const _0x409ff1=_0x39aca5;if(this[_0x409ff1(0x151)])return;this['_updateIng']=!![];if(this['worker'])this[_0x409ff1(0x15f)]['update']();else{const _0x42e715=this['windField']['getParticles']();this['_drawLines'](_0x42e715);}this['_updateIng']=![];}['_drawLines'](_0xa4c5ef){const _0x11d391=_0x39aca5;this['canvasContext']['globalCompositeOperation']=_0x11d391(0x1f1),this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']=_0x11d391(0x1c0),this['canvasContext']['globalAlpha']=0.9;const _0x493340=this[_0x11d391(0x1bd)]['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x53e641=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0xe5255f=0x0,_0x362a10=_0xa4c5ef['length'];_0xe5255f<_0x362a10;_0xe5255f++){const _0x37cdb9=_0xa4c5ef[_0xe5255f],_0x189753=this['_tomap'](_0x37cdb9['lng'],_0x37cdb9[_0x11d391(0x1c7)],_0x37cdb9),_0x412c4a=this['_tomap'](_0x37cdb9['tlng'],_0x37cdb9['tlat'],_0x37cdb9);if(!_0x189753||!_0x412c4a)continue;if(_0x493340&&Math['abs'](_0x189753[0x0]-_0x412c4a[0x0])>=_0x53e641)continue;this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x11d391(0x1e9)]['strokeStyle']=this['_colorRamp']['getColor'](_0x37cdb9['speed']),this[_0x11d391(0x1e9)]['moveTo'](_0x189753[0x0],_0x189753[0x1]),this[_0x11d391(0x1e9)]['lineTo'](_0x412c4a[0x0],_0x412c4a[0x1]),this['canvasContext']['stroke']();}else{this[_0x11d391(0x1e9)][_0x11d391(0x1d3)](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x11d391(0x1b2)]=this['color'];for(let _0xd565c8=0x0,_0x37bee7=_0xa4c5ef[_0x11d391(0x127)];_0xd565c8<_0x37bee7;_0xd565c8++){const _0x4699ab=_0xa4c5ef[_0xd565c8],_0x239eae=this['_tomap'](_0x4699ab['lng'],_0x4699ab['lat'],_0x4699ab),_0x189ca2=this[_0x11d391(0x11c)](_0x4699ab['tlng'],_0x4699ab[_0x11d391(0x173)],_0x4699ab);if(!_0x239eae||!_0x189ca2)continue;if(_0x493340&&Math['abs'](_0x239eae[0x0]-_0x189ca2[0x0])>=_0x53e641)continue;this['canvasContext']['moveTo'](_0x239eae[0x0],_0x239eae[0x1]),this['canvasContext']['lineTo'](_0x189ca2[0x0],_0x189ca2[0x1]);}this['canvasContext'][_0x11d391(0x1d0)]();}}[_0x39aca5(0x11c)](_0x473b14,_0x153081,_0x408ab7){const _0x613b38=_0x39aca5,_0x5d8122=Cesium[_0x613b38(0x163)]['fromDegrees'](_0x473b14,_0x153081,this[_0x613b38(0x145)]),_0x1a2f98=this[_0x613b38(0x1bd)]['scene'];if(_0x1a2f98['mode']===Cesium['SceneMode']['SCENE3D']){const _0x5f0d0a=new Cesium['EllipsoidalOccluder'](_0x1a2f98['globe']['ellipsoid'],_0x1a2f98['camera']['positionWC']),_0x43f9d1=_0x5f0d0a[_0x613b38(0x185)](_0x5d8122);if(!_0x43f9d1)return _0x408ab7['age']=0x0,null;}const _0x258129=Cesium['SceneTransforms'][_0x613b38(0x1e4)](this[_0x613b38(0x1bd)][_0x613b38(0x179)],_0x5d8122);return _0x258129?[_0x258129['x'],_0x258129['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}[_0x39aca5(0x15b)](){const _0x284d26=_0x39aca5;this['worker']=new Worker(this[_0x284d26(0x147)]['worker']),this[_0x284d26(0x197)][_0x284d26(0x1cf)]=_0xb437f9=>{const _0x1a143d=_0x284d26;this[_0x1a143d(0x12f)](_0xb437f9['data'][_0x1a143d(0x137)]),this['_updateIng2']=![];},this[_0x284d26(0x15f)]={'init':_0x3123ef=>{this['worker']['postMessage']({'type':'init','options':_0x3123ef});},'setOptions':_0x3e8c2d=>{const _0x3942bd=_0x284d26;this['worker']['postMessage']({'type':_0x3942bd(0x150),'options':_0x3e8c2d});},'setDate':_0x3c29ff=>{const _0x2ee19c=_0x284d26;this[_0x2ee19c(0x197)]['postMessage']({'type':_0x2ee19c(0x1d6),'data':_0x3c29ff});},'update':()=>{const _0x8937aa=_0x284d26;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker'][_0x8937aa(0x12d)]({'type':'update'});},'clear':()=>{const _0x483567=_0x284d26;this[_0x483567(0x197)][_0x483567(0x12d)]({'type':_0x483567(0x1f5)});}},this['windField'][_0x284d26(0x1a1)](this[_0x284d26(0x147)]);}}mars3d__namespace['LayerUtil'][_0x39aca5(0x1b6)](_0x39aca5(0x166),CanvasWindLayer),mars3d__namespace[_0x39aca5(0x178)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x39aca5(0x171)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
