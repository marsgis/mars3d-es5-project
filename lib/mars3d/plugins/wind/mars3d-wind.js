/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.14
 * 编译日期：2023-07-03 18:40:34
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x4a4072=_0x31e3;(function(_0x400534,_0x240c28){const _0x2b2f8d=_0x31e3,_0x2901bb=_0x400534();while(!![]){try{const _0x516e71=parseInt(_0x2b2f8d(0xd8))/0x1*(parseInt(_0x2b2f8d(0x12d))/0x2)+-parseInt(_0x2b2f8d(0x143))/0x3+parseInt(_0x2b2f8d(0xf6))/0x4+-parseInt(_0x2b2f8d(0x18c))/0x5*(-parseInt(_0x2b2f8d(0xd1))/0x6)+parseInt(_0x2b2f8d(0x130))/0x7+parseInt(_0x2b2f8d(0x104))/0x8*(-parseInt(_0x2b2f8d(0x17c))/0x9)+-parseInt(_0x2b2f8d(0x194))/0xa;if(_0x516e71===_0x240c28)break;else _0x2901bb['push'](_0x2901bb['shift']());}catch(_0x46a64c){_0x2901bb['push'](_0x2901bb['shift']());}}}(_0x46cb,0x6c271));function _interopNamespace(_0x5ef7d1){const _0x26bef3=_0x31e3;if(_0x5ef7d1&&_0x5ef7d1['__esModule'])return _0x5ef7d1;var _0xdef35a=Object[_0x26bef3(0x176)](null);return _0x5ef7d1&&Object['keys'](_0x5ef7d1)[_0x26bef3(0x18d)](function(_0x5ecae4){const _0x2a848b=_0x26bef3;if(_0x5ecae4!==_0x2a848b(0xc2)){var _0x449e41=Object[_0x2a848b(0x16f)](_0x5ef7d1,_0x5ecae4);Object[_0x2a848b(0x14c)](_0xdef35a,_0x5ecae4,_0x449e41[_0x2a848b(0xcd)]?_0x449e41:{'enumerable':!![],'get':function(){return _0x5ef7d1[_0x5ecae4];}});}}),_0xdef35a[_0x26bef3(0xc2)]=_0x5ef7d1,_0xdef35a;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x4a4072(0x101)];function getU(_0x55ddb0,_0x19d80f){const _0x4a8425=_0x4a4072,_0x53e3b2=_0x55ddb0*Math[_0x4a8425(0x179)](Cesium$7['Math']['toRadians'](_0x19d80f));return _0x53e3b2;}function getV(_0x33375e,_0x1b6393){const _0xef14df=_0x4a4072,_0x590688=_0x33375e*Math['sin'](Cesium$7['Math'][_0xef14df(0x122)](_0x1b6393));return _0x590688;}function getSpeed(_0x9d5dc4,_0x1080e7){const _0x47c89e=Math['sqrt'](Math['pow'](_0x9d5dc4,0x2)+Math['pow'](_0x1080e7,0x2));return _0x47c89e;}function getDirection(_0x5773f6,_0x299b1d){const _0x299c0b=_0x4a4072;let _0x2dde7c=Cesium$7[_0x299c0b(0xfe)]['toDegrees'](Math[_0x299c0b(0x167)](_0x299b1d,_0x5773f6));return _0x2dde7c+=_0x2dde7c<0x0?0x168:0x0,_0x2dde7c;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x224105){const _0x75b640=_0x4a4072;this['commandType']=_0x224105['commandType'],this['geometry']=_0x224105['geometry'],this['attributeLocations']=_0x224105[_0x75b640(0xfb)],this[_0x75b640(0xfd)]=_0x224105[_0x75b640(0xfd)],this['uniformMap']=_0x224105['uniformMap'],this['vertexShaderSource']=_0x224105['vertexShaderSource'],this['fragmentShaderSource']=_0x224105['fragmentShaderSource'],this['rawRenderState']=_0x224105['rawRenderState'],this['framebuffer']=_0x224105['framebuffer'],this[_0x75b640(0xbe)]=_0x224105['outputTexture'],this[_0x75b640(0xf1)]=_0x224105['autoClear']??![],this[_0x75b640(0x128)]=_0x224105[_0x75b640(0x128)],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x75b640(0x10c)]=new Cesium$6[(_0x75b640(0xcc))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x75b640(0xca)],'pass':Cesium$6[_0x75b640(0x17f)]['OPAQUE']}));}[_0x4a4072(0xeb)](_0x429b41){const _0x5d876b=_0x4a4072;switch(this['commandType']){case'Draw':{const _0x23b356=Cesium$6['VertexArray']['fromGeometry']({'context':_0x429b41,'geometry':this[_0x5d876b(0x183)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x29d2ff=Cesium$6['ShaderProgram']['fromCache']({'context':_0x429b41,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x1c0c7d=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x5d876b(0xfd)],'shaderProgram':_0x29d2ff,'vertexArray':_0x23b356,'modelMatrix':Cesium$6[_0x5d876b(0xc8)]['IDENTITY'],'renderState':_0x1c0c7d,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x5d876b(0x117)],'pickOnly':!![],'owner':this});}case _0x5d876b(0xed):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x5d876b(0x162)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x107a25,_0x4ff4f5){const _0x564274=_0x4a4072;this['geometry']=_0x4ff4f5;const _0x5ceb34=Cesium$6['VertexArray']['fromGeometry']({'context':_0x107a25,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x564274(0x100)]});this['commandToExecute']['vertexArray']=_0x5ceb34;}['update'](_0x8b190f){const _0x1f9062=_0x4a4072;if(!this['show'])return;if(_0x8b190f[_0x1f9062(0xd5)]!==Cesium$6[_0x1f9062(0x187)][_0x1f9062(0x15d)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x8b190f['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x8b190f['commandList']['push'](this['clearCommand']),_0x8b190f[_0x1f9062(0xe3)]['push'](this[_0x1f9062(0x18e)]);}['isDestroyed'](){return![];}[_0x4a4072(0xf9)](){const _0x2bf54e=_0x4a4072;if(this['clearCommand']){var _0x40b0ee,_0x486ad4;(_0x40b0ee=this['clearCommand'])!==null&&_0x40b0ee!==void 0x0&&_0x40b0ee['vertexArray']&&this[_0x2bf54e(0x10c)]['vertexArray']['destroy'](),(_0x486ad4=this['clearCommand'])!==null&&_0x486ad4!==void 0x0&&_0x486ad4['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x2bf54e(0xf9)](),delete this['clearCommand'];}return this[_0x2bf54e(0x18e)]&&(this[_0x2bf54e(0x18e)]['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6[_0x2bf54e(0x12c)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0xffdc32=function(){const _0xbe24e5=_0x31e3,_0x1aa856=new Cesium$5[(_0xbe24e5(0xcf))]({'attributes':new Cesium$5[(_0xbe24e5(0x163))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0xbe24e5(0xc5)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0xbe24e5(0x18a)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x1aa856;},_0x2af839=function(_0x4e871a,_0x5b844b){if(Cesium$5['defined'](_0x5b844b)){const _0x549dbc={};_0x549dbc['arrayBufferView']=_0x5b844b,_0x4e871a['source']=_0x549dbc;}const _0x28493a=new Cesium$5['Texture'](_0x4e871a);return _0x28493a;},_0x101371=function(_0x7e40a5,_0x3d64ce,_0x240db5){const _0x111874=new Cesium$5['Framebuffer']({'context':_0x7e40a5,'colorTextures':[_0x3d64ce],'depthTexture':_0x240db5});return _0x111874;},_0x546d85=function(_0x43b07a){const _0x163d98=_0x31e3,_0x2c3900=!![],_0x3eadb1=![],_0x5c1f35={'viewport':_0x43b07a['viewport'],'depthTest':_0x43b07a[_0x163d98(0x177)],'depthMask':_0x43b07a['depthMask'],'blending':_0x43b07a['blending']},_0xdb5b6=Cesium$5[_0x163d98(0x16d)]['getDefaultRenderState'](_0x2c3900,_0x3eadb1,_0x5c1f35);return _0xdb5b6;},_0x55dfae=function(_0x3ad988){const _0xfd9f04=_0x31e3,_0x56707a={},_0x319961=Cesium$5['Math'][_0xfd9f04(0xb4)](_0x3ad988['west'],Cesium$5['Math'][_0xfd9f04(0x189)]),_0x1292cc=Cesium$5[_0xfd9f04(0xfe)]['mod'](_0x3ad988['east'],Cesium$5[_0xfd9f04(0xfe)]['TWO_PI']),_0x2d0dc3=_0x3ad988['width'];let _0x4d19b1,_0x1ebbdf;_0x2d0dc3>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x4d19b1=0x0,_0x1ebbdf=Cesium$5['Math']['TWO_PI']):_0x1292cc-_0x319961<_0x2d0dc3?(_0x4d19b1=_0x319961,_0x1ebbdf=_0x319961+_0x2d0dc3):(_0x4d19b1=_0x319961,_0x1ebbdf=_0x1292cc);_0x56707a['lon']={'min':Cesium$5[_0xfd9f04(0xfe)]['toDegrees'](_0x4d19b1),'max':Cesium$5['Math']['toDegrees'](_0x1ebbdf)};const _0x197e6b=_0x3ad988['south'],_0x35d9ee=_0x3ad988['north'],_0x2e2163=_0x3ad988['height'],_0x38f2ba=_0x2e2163>Cesium$5['Math']['PI']/0xc?_0x2e2163/0x2:0x0;let _0x312068=Cesium$5['Math']['clampToLatitudeRange'](_0x197e6b-_0x38f2ba),_0x3a6dd9=Cesium$5['Math']['clampToLatitudeRange'](_0x35d9ee+_0x38f2ba);return _0x312068<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x312068=-Cesium$5['Math']['PI_OVER_TWO']),_0x3a6dd9>Cesium$5['Math'][_0xfd9f04(0xf4)]&&(_0x3a6dd9=Cesium$5[_0xfd9f04(0xfe)][_0xfd9f04(0xb6)]),_0x56707a['lat']={'min':Cesium$5[_0xfd9f04(0xfe)][_0xfd9f04(0x152)](_0x312068),'max':Cesium$5['Math'][_0xfd9f04(0x152)](_0x3a6dd9)},_0x56707a;};return{'getFullscreenQuad':_0xffdc32,'createTexture':_0x2af839,'createFramebuffer':_0x101371,'createRawRenderState':_0x546d85,'viewRectangleToLonLatRange':_0x55dfae};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag=_0x4a4072(0x198),fullscreen_vert=_0x4a4072(0xe1),trailDraw_frag=_0x4a4072(0x192),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x3f2e50,_0xbbc51d,_0x47d559,_0x60a9ef,_0x2318d9){const _0x246601=_0x4a4072;this[_0x246601(0xde)](_0x3f2e50,_0xbbc51d,_0x47d559['colors']),this['createRenderingFramebuffers'](_0x3f2e50),this['createRenderingPrimitives'](_0x3f2e50,_0x47d559,_0x60a9ef,_0x2318d9);}['createRenderingTextures'](_0xcdfd1a,_0x4f56a0,_0x5a6b05){const _0x43ea73=_0x4a4072,_0x5a2b83={'context':_0xcdfd1a,'width':_0xcdfd1a['drawingBufferWidth'],'height':_0xcdfd1a['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x38b568={'context':_0xcdfd1a,'width':_0xcdfd1a['drawingBufferWidth'],'height':_0xcdfd1a[_0x43ea73(0x12e)],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x43ea73(0x185)]},_0x1e56c7=_0x5a6b05[_0x43ea73(0xee)],_0x12562e=new Float32Array(_0x1e56c7*0x3);for(let _0x5d7308=0x0;_0x5d7308<_0x1e56c7;_0x5d7308++){const _0x59c62a=Cesium$4['Color'][_0x43ea73(0x17a)](_0x5a6b05[_0x5d7308]);_0x12562e[0x3*_0x5d7308]=_0x59c62a['red'],_0x12562e[0x3*_0x5d7308+0x1]=_0x59c62a[_0x43ea73(0x124)],_0x12562e[0x3*_0x5d7308+0x2]=_0x59c62a[_0x43ea73(0xc4)];}const _0xf59e4e={'context':_0xcdfd1a,'width':_0x1e56c7,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x43ea73(0xc7)][_0x43ea73(0x181)],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x43ea73(0x181)]})};this['textures']={'segmentsColor':Util['createTexture'](_0x5a2b83),'segmentsDepth':Util[_0x43ea73(0xd7)](_0x38b568),'currentTrailsColor':Util[_0x43ea73(0xd7)](_0x5a2b83),'currentTrailsDepth':Util['createTexture'](_0x38b568),'nextTrailsColor':Util['createTexture'](_0x5a2b83),'nextTrailsDepth':Util['createTexture'](_0x38b568),'colorTable':Util['createTexture'](_0xf59e4e,_0x12562e)};}['createRenderingFramebuffers'](_0x1fa8dc){const _0x2b74fd=_0x4a4072;this['framebuffers']={'segments':Util['createFramebuffer'](_0x1fa8dc,this['textures']['segmentsColor'],this['textures'][_0x2b74fd(0xd9)]),'currentTrails':Util[_0x2b74fd(0x11d)](_0x1fa8dc,this['textures'][_0x2b74fd(0x169)],this['textures'][_0x2b74fd(0x114)]),'nextTrails':Util[_0x2b74fd(0x11d)](_0x1fa8dc,this[_0x2b74fd(0x113)][_0x2b74fd(0x172)],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x5a4e9b){const _0x1fc00a=_0x4a4072,_0x4f00c0=0x4;let _0xfbceca=[];for(let _0x173588=0x0;_0x173588<_0x5a4e9b['particlesTextureSize'];_0x173588++){for(let _0xb73ddf=0x0;_0xb73ddf<_0x5a4e9b['particlesTextureSize'];_0xb73ddf++){for(let _0x238218=0x0;_0x238218<_0x4f00c0;_0x238218++){_0xfbceca['push'](_0x173588/_0x5a4e9b['particlesTextureSize']),_0xfbceca['push'](_0xb73ddf/_0x5a4e9b[_0x1fc00a(0x182)]);}}}_0xfbceca=new Float32Array(_0xfbceca);let _0x24c070=[];const _0x43d140=[-0x1,0x1],_0x25513f=[-0x1,0x1];for(let _0x523de8=0x0;_0x523de8<_0x5a4e9b['maxParticles'];_0x523de8++){for(let _0x667016=0x0;_0x667016<_0x4f00c0/0x2;_0x667016++){for(let _0x2037f4=0x0;_0x2037f4<_0x4f00c0/0x2;_0x2037f4++){_0x24c070['push'](_0x43d140[_0x667016]),_0x24c070[_0x1fc00a(0x15f)](_0x25513f[_0x2037f4]),_0x24c070['push'](0x0);}}}_0x24c070=new Float32Array(_0x24c070);const _0x2ecc76=0x6*_0x5a4e9b[_0x1fc00a(0x184)],_0x3ac00a=new Uint32Array(_0x2ecc76);for(let _0x330060=0x0,_0x53439f=0x0,_0x35a92f=0x0;_0x330060<_0x5a4e9b[_0x1fc00a(0x184)];_0x330060++){_0x3ac00a[_0x53439f++]=_0x35a92f+0x0,_0x3ac00a[_0x53439f++]=_0x35a92f+0x1,_0x3ac00a[_0x53439f++]=_0x35a92f+0x2,_0x3ac00a[_0x53439f++]=_0x35a92f+0x2,_0x3ac00a[_0x53439f++]=_0x35a92f+0x1,_0x3ac00a[_0x53439f++]=_0x35a92f+0x3,_0x35a92f+=0x4;}const _0x5f545d=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x1fc00a(0xc5)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0xfbceca}),'normal':new Cesium$4[(_0x1fc00a(0x196))]({'componentDatatype':Cesium$4[_0x1fc00a(0xc5)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x24c070})}),'indices':_0x3ac00a});return _0x5f545d;}[_0x4a4072(0x115)](_0x51d338,_0x52888b,_0x690c83,_0x2547be){const _0x1af89f=_0x4a4072,_0x9a0cf=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x52888b),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x2547be['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x3bb67e=_0x31e3;return _0x2547be['particlesTextures'][_0x3bb67e(0x178)];},'postProcessingSpeed':function(){return _0x2547be['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x9a0cf['textures']['colorTable'];},'aspect':function(){return _0x51d338['drawingBufferWidth']/_0x51d338['drawingBufferHeight'];},'pixelSize':function(){return _0x690c83['pixelSize'];},'lineWidth':function(){return _0x52888b['lineWidth'];},'particleHeight':function(){const _0x168acd=_0x31e3;return _0x52888b[_0x168acd(0x134)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x1af89f(0xe2)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x1af89f(0x191),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x5a81dd=_0x1af89f;return _0x9a0cf['textures'][_0x5a81dd(0x175)];},'segmentsDepthTexture':function(){const _0x2f94d2=_0x1af89f;return _0x9a0cf['textures'][_0x2f94d2(0xd9)];},'currentTrailsColor':function(){const _0x162f2c=_0x1af89f;return _0x9a0cf['framebuffers']['currentTrails'][_0x162f2c(0xce)](0x0);},'trailsDepthTexture':function(){const _0x595d7f=_0x1af89f;return _0x9a0cf[_0x595d7f(0xb9)]['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x52888b['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x11f300=_0x1af89f,_0x1534a4=_0x9a0cf['framebuffers']['currentTrails'];_0x9a0cf['framebuffers']['currentTrails']=_0x9a0cf['framebuffers']['nextTrails'],_0x9a0cf['framebuffers'][_0x11f300(0x116)]=_0x1534a4,_0x9a0cf[_0x11f300(0xe8)][_0x11f300(0x135)][_0x11f300(0x18e)][_0x11f300(0xca)]=_0x9a0cf['framebuffers'][_0x11f300(0x116)],_0x9a0cf['primitives']['trails']['clearCommand'][_0x11f300(0xca)]=_0x9a0cf[_0x11f300(0xb9)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x1af89f(0x137)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x403b25=_0x1af89f;return _0x9a0cf['framebuffers']['nextTrails'][_0x403b25(0xce)](0x0);},'trailsDepthTexture':function(){const _0x8e5f4b=_0x1af89f;return _0x9a0cf['framebuffers']['nextTrails'][_0x8e5f4b(0xe5)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x4a4072(0x111),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];function _0x31e3(_0x4202b0,_0x3e3ea2){const _0x46cb4b=_0x46cb();return _0x31e3=function(_0x31e336,_0x1563d2){_0x31e336=_0x31e336-0xb4;let _0x5dce1c=_0x46cb4b[_0x31e336];return _0x5dce1c;},_0x31e3(_0x4202b0,_0x3e3ea2);}class ParticlesComputing{constructor(_0x48f043,_0x150fe5,_0x4507c2,_0x249955){const _0x3197ea=_0x4a4072;this[_0x3197ea(0xc3)]=_0x150fe5,this['createWindTextures'](_0x48f043,_0x150fe5),this['createParticlesTextures'](_0x48f043,_0x4507c2,_0x249955),this['createComputingPrimitives'](_0x150fe5,_0x4507c2,_0x249955);}[_0x4a4072(0xf3)](_0x32b691,_0x431193){const _0x4d94dc=_0x4a4072,_0x212e91={'context':_0x32b691,'width':_0x431193['dimensions']['lon'],'height':_0x431193['dimensions'][_0x4d94dc(0x140)]*(_0x431193['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x4d94dc(0x107)][_0x4d94dc(0x18a)],'flipY':![],'sampler':new Cesium$3[(_0x4d94dc(0x164))]({'minificationFilter':Cesium$3[_0x4d94dc(0xc7)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util[_0x4d94dc(0xd7)](_0x212e91,_0x431193['U']['array']),'V':Util['createTexture'](_0x212e91,_0x431193['V']['array'])};}['createParticlesTextures'](_0x3ef6ac,_0x4eb166,_0x3c4c46){const _0x39e48d=_0x4a4072,_0x235494={'context':_0x3ef6ac,'width':_0x4eb166[_0x39e48d(0x182)],'height':_0x4eb166['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3[_0x39e48d(0x107)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x39e48d(0x14a)]['NEAREST']})},_0x2c4e14=this['randomizeParticles'](_0x4eb166['maxParticles'],_0x3c4c46),_0x15d428=new Float32Array(0x4*_0x4eb166['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x235494),'currentParticlesPosition':Util['createTexture'](_0x235494,_0x2c4e14),'nextParticlesPosition':Util['createTexture'](_0x235494,_0x2c4e14),'currentParticlesSpeed':Util['createTexture'](_0x235494,_0x15d428),'nextParticlesSpeed':Util['createTexture'](_0x235494,_0x15d428),'postProcessingPosition':Util[_0x39e48d(0xd7)](_0x235494,_0x2c4e14),'postProcessingSpeed':Util[_0x39e48d(0xd7)](_0x235494,_0x15d428)};}['randomizeParticles'](_0x2b97ce,_0x120bdb){const _0x14da55=_0x4a4072,_0x380e6d=new Float32Array(0x4*_0x2b97ce);for(let _0x16723c=0x0;_0x16723c<_0x2b97ce;_0x16723c++){_0x380e6d[0x4*_0x16723c]=Cesium$3['Math']['randomBetween'](_0x120bdb['lonRange']['x'],_0x120bdb[_0x14da55(0xdf)]['y']),_0x380e6d[0x4*_0x16723c+0x1]=Cesium$3['Math']['randomBetween'](_0x120bdb[_0x14da55(0x13f)]['x'],_0x120bdb['latRange']['y']),_0x380e6d[0x4*_0x16723c+0x2]=Cesium$3['Math'][_0x14da55(0x11c)](this[_0x14da55(0xc3)][_0x14da55(0xf5)][_0x14da55(0x149)],this['data']['lev']['max']),_0x380e6d[0x4*_0x16723c+0x3]=0x0;}return _0x380e6d;}['destroyParticlesTextures'](){const _0x141fe0=_0x4a4072;Object[_0x141fe0(0x16e)](this['particlesTextures'])[_0x141fe0(0x18d)](_0x1c985b=>{this['particlesTextures'][_0x1c985b]['destroy']();});}[_0x4a4072(0xe6)](_0x33fd53,_0x47fb7f,_0x17a5c1){const _0x13660d=_0x4a4072,_0x4b9878=new Cesium$3[(_0x13660d(0x171))](_0x33fd53[_0x13660d(0x168)]['lon'],_0x33fd53['dimensions']['lat'],_0x33fd53[_0x13660d(0x168)]['lev']),_0x274628=new Cesium$3[(_0x13660d(0x171))](_0x33fd53[_0x13660d(0x14b)]['min'],_0x33fd53['lat']['min'],_0x33fd53['lev']['min']),_0x19653a=new Cesium$3[(_0x13660d(0x171))](_0x33fd53[_0x13660d(0x14b)]['max'],_0x33fd53['lat']['max'],_0x33fd53['lev'][_0x13660d(0xc9)]),_0x1faf79=new Cesium$3[(_0x13660d(0x171))]((_0x19653a['x']-_0x274628['x'])/(_0x4b9878['x']-0x1),(_0x19653a['y']-_0x274628['y'])/(_0x4b9878['y']-0x1),_0x4b9878['z']>0x1?(_0x19653a['z']-_0x274628['z'])/(_0x4b9878['z']-0x1):0x1),_0x3256c8=new Cesium$3['Cartesian2'](_0x33fd53['U']['min'],_0x33fd53['U']['max']),_0x1d8ed1=new Cesium$3[(_0x13660d(0x102))](_0x33fd53['V'][_0x13660d(0x149)],_0x33fd53['V']['max']),_0x332449=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x332449['windTextures']['U'];},'V':function(){const _0x1d86fa=_0x13660d;return _0x332449[_0x1d86fa(0x17e)]['V'];},'currentParticlesPosition':function(){return _0x332449['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x4b9878;},'minimum':function(){return _0x274628;},'maximum':function(){return _0x19653a;},'interval':function(){return _0x1faf79;}},'fragmentShaderSource':new Cesium$3[(_0x13660d(0x161))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x6ce30=_0x13660d;_0x332449['primitives'][_0x6ce30(0x13c)]['commandToExecute'][_0x6ce30(0xbe)]=_0x332449['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x1742a4=_0x13660d;return _0x332449[_0x1742a4(0xba)][_0x1742a4(0xf2)];},'particlesWind':function(){const _0x12ee72=_0x13660d;return _0x332449[_0x12ee72(0xba)]['particlesWind'];},'uSpeedRange':function(){return _0x3256c8;},'vSpeedRange':function(){return _0x1d8ed1;},'pixelSize':function(){return _0x17a5c1['pixelSize'];},'speedFactor':function(){return _0x47fb7f['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x115f1d=_0x13660d,_0x537b86=_0x332449['particlesTextures'][_0x115f1d(0xf2)];_0x332449['particlesTextures']['currentParticlesSpeed']=_0x332449['particlesTextures']['postProcessingSpeed'],_0x332449['particlesTextures']['postProcessingSpeed']=_0x537b86,_0x332449['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x332449['particlesTextures'][_0x115f1d(0x18b)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x481c80=_0x13660d;return _0x332449['particlesTextures'][_0x481c80(0x157)];},'currentParticlesSpeed':function(){const _0x2d2902=_0x13660d;return _0x332449[_0x2d2902(0xba)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x13660d(0x161))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x4bdd43=_0x13660d,_0xddc99d=_0x332449['particlesTextures']['currentParticlesPosition'];_0x332449['particlesTextures'][_0x4bdd43(0x157)]=_0x332449['particlesTextures'][_0x4bdd43(0x178)],_0x332449['particlesTextures']['postProcessingPosition']=_0xddc99d,_0x332449['primitives']['updatePosition'][_0x4bdd43(0x18e)]['outputTexture']=_0x332449[_0x4bdd43(0xba)][_0x4bdd43(0xf0)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x332449['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x332449['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x17a5c1['lonRange'];},'latRange':function(){return _0x17a5c1['latRange'];},'randomCoefficient':function(){const _0x141dcd=_0x13660d,_0x47570f=Math[_0x141dcd(0xff)]();return _0x47570f;},'dropRate':function(){return _0x47fb7f['dropRate'];},'dropRateBump':function(){return _0x47fb7f['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x13660d(0xba)]['postProcessingPosition'],'preExecute':function(){const _0x358f59=_0x13660d;_0x332449['primitives']['postProcessingPosition'][_0x358f59(0x18e)]['outputTexture']=_0x332449['particlesTextures'][_0x358f59(0x178)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x332449['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x486d02=_0x13660d;return _0x332449[_0x486d02(0xba)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x13660d(0xba)]['postProcessingSpeed'],'preExecute':function(){const _0x549c02=_0x13660d;_0x332449['primitives']['postProcessingSpeed']['commandToExecute'][_0x549c02(0xbe)]=_0x332449['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x1f477c,_0x31bc6c,_0x15c099,_0x475006){const _0x39244f=_0x4a4072;this['context']=_0x1f477c,_0x31bc6c={..._0x31bc6c},_0x31bc6c[_0x39244f(0x197)]&&_0x31bc6c[_0x39244f(0xbb)]&&(_0x31bc6c['dimensions']={},_0x31bc6c['dimensions']['lon']=_0x31bc6c['cols'],_0x31bc6c[_0x39244f(0x168)]['lat']=_0x31bc6c['rows'],_0x31bc6c['dimensions']['lev']=_0x31bc6c[_0x39244f(0xf5)]||0x1,_0x31bc6c[_0x39244f(0x14b)]={},_0x31bc6c['lon'][_0x39244f(0x149)]=_0x31bc6c[_0x39244f(0xd6)],_0x31bc6c['lon'][_0x39244f(0xc9)]=_0x31bc6c['xmax'],_0x31bc6c[_0x39244f(0x140)]={},_0x31bc6c['lat']['min']=_0x31bc6c['ymin'],_0x31bc6c['lat'][_0x39244f(0xc9)]=_0x31bc6c['ymax'],_0x31bc6c['lev']={},_0x31bc6c[_0x39244f(0xf5)][_0x39244f(0x149)]=_0x31bc6c[_0x39244f(0xbd)]??0x1,_0x31bc6c['lev']['max']=_0x31bc6c['levmax']??0x1,_0x31bc6c['U']={},_0x31bc6c['U'][_0x39244f(0x106)]=new Float32Array(_0x31bc6c[_0x39244f(0x197)]),_0x31bc6c['U'][_0x39244f(0x149)]=_0x31bc6c[_0x39244f(0x13b)]??Math['min'](..._0x31bc6c['udata']),_0x31bc6c['U'][_0x39244f(0xc9)]=_0x31bc6c[_0x39244f(0x10b)]??Math['max'](..._0x31bc6c['udata']),_0x31bc6c['V']={},_0x31bc6c['V'][_0x39244f(0x106)]=new Float32Array(_0x31bc6c[_0x39244f(0xbb)]),_0x31bc6c['V']['min']=_0x31bc6c['vmin']??Math[_0x39244f(0x149)](..._0x31bc6c[_0x39244f(0xbb)]),_0x31bc6c['V']['max']=_0x31bc6c['vmax']??Math['max'](..._0x31bc6c[_0x39244f(0xbb)])),this['data']=_0x31bc6c,this['options']=_0x15c099,this['viewerParameters']=_0x475006,this['particlesComputing']=new ParticlesComputing(this[_0x39244f(0x170)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0x39244f(0x126)]);}['canvasResize'](_0x2b9ba0){const _0x1b3b79=_0x4a4072;this['particlesComputing'][_0x1b3b79(0x129)](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0xd79cfc=>{const _0x4af12e=_0x1b3b79;this['particlesComputing']['windTextures'][_0xd79cfc][_0x4af12e(0xf9)]();}),this[_0x1b3b79(0x174)]['textures']['colorTable']['destroy'](),Object['keys'](this[_0x1b3b79(0x174)]['framebuffers'])['forEach'](_0x43cefa=>{const _0x44188d=_0x1b3b79;this[_0x44188d(0x174)]['framebuffers'][_0x43cefa][_0x44188d(0xf9)]();}),this['context']=_0x2b9ba0,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x1b3b79(0xc3)],this[_0x1b3b79(0x12a)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x1b3b79(0x12a)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x234d14=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x3feb4e=>{const _0x48c730=_0x31e3;_0x234d14['framebuffer']=this['particlesRendering'][_0x48c730(0xb9)][_0x3feb4e],_0x234d14[_0x48c730(0xdd)](this['context']);});}['refreshParticles'](_0x4120b5){const _0x463387=_0x4a4072;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x4120b5){const _0x22700f=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives'][_0x463387(0xe2)]['geometry']=_0x22700f;const _0x2587b9=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x463387(0x170)],'geometry':_0x22700f,'attributeLocations':this['particlesRendering'][_0x463387(0xe8)]['segments'][_0x463387(0xfb)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x2587b9;}}['setOptions'](_0x281283){let _0x93855=![];this['options']['maxParticles']!==_0x281283['maxParticles']&&(_0x93855=!![]),Object['keys'](_0x281283)['forEach'](_0x309438=>{this['options'][_0x309438]=_0x281283[_0x309438];}),this['refreshParticles'](_0x93855);}[_0x4a4072(0xe4)](_0x2fdf96){Object['keys'](_0x2fdf96)['forEach'](_0x1ffae3=>{const _0xdb8502=_0x31e3;this[_0xdb8502(0x12f)][_0x1ffae3]=_0x2fdf96[_0x1ffae3];}),this['refreshParticles'](![]);}['destroy'](){const _0x3cd14f=_0x4a4072;clearTimeout(this[_0x3cd14f(0xb7)]),this[_0x3cd14f(0x126)]['destroyParticlesTextures'](),Object['keys'](this[_0x3cd14f(0x126)]['windTextures'])[_0x3cd14f(0x18d)](_0x3bb355=>{this['particlesComputing']['windTextures'][_0x3bb355]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x3cd14f(0x18d)](_0x49c6fb=>{const _0x5bebbc=_0x3cd14f;this[_0x5bebbc(0x174)][_0x5bebbc(0xb9)][_0x49c6fb]['destroy']();});for(const _0x4d5dcf in this){delete this[_0x4d5dcf];}}}function _0x46cb(){const _0x5c497e=['LINEAR','particlesTextureSize','geometry','maxParticles','UNSIGNED_INT','_mountedHook','SceneMode','_updateIng2','TWO_PI','FLOAT','nextParticlesSpeed','50890TEJwbZ','forEach','commandToExecute','reverse','width','Draw','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','globe','3111650xWIudX','particles','GeometryAttribute','udata','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','top','fixedHeight','style','mod','_randomParticle','PI_OVER_TWO','canrefresh','computeViewRectangle','framebuffers','particlesTextures','vdata','isPointVisible','levmin','outputTexture','lineWidth','rows','speedRate','default','data','blue','ComponentDatatype','CanvasWindLayer','TextureMinificationFilter','Matrix4','max','framebuffer','mouseHidden','ClearCommand','get','getColorTexture','Geometry','worker','426tfZXyy','xmax','add','getOptions','mode','xmin','createTexture','127431MpHLXC','segmentsDepth','frameTime','age','resize','execute','createRenderingTextures','lonRange','_maxAge','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','segments','commandList','applyViewerParameters','depthTexture','createComputingPrimitives','wheel','primitives','tlng','_onMap_preRenderEvent','createCommand','tlat','Compute','length','color','nextParticlesPosition','autoClear','currentParticlesSpeed','createWindTextures','PI_OVER_THREE','lev','233124suyzkj','fadeOpacity','_pointerEvents','destroy','clientWidth','attributeLocations','pointer-events','primitiveType','Math','random','STATIC_DRAW','Cesium','Cartesian2','mouse_move','368gBYwTB','frameRate','array','PixelDatatype','setDate','positionWC','canvasResize','umax','clearCommand','canvasContext','maxAge','height','camera','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','windField','textures','currentTrailsDepth','createRenderingPrimitives','nextTrails','OPAQUE','0px','_onMapWhellEvent','pointerEvents','EventType','randomBetween','createFramebuffer','register','_createCanvas','ymax','destination-in','toRadians','BaseLayer','green','container','particlesComputing','initWorker','preExecute','destroyParticlesTextures','options','_tomap','destroyObject','6PyHVul','drawingBufferHeight','viewerParameters','6084344JUrMKL','off','_onMouseDownEvent','updateViewerParameters','particleHeight','trails','log','PrimitiveType','_canrefresh','_calc_speedRate','colors','umin','getWind','show','mouse_down','latRange','lat','setOptions','scene','1709400DCzOnr','refreshTimer','canvas','_onMouseUpEvent','_showHook','sqrt','min','TextureMagnificationFilter','lon','defineProperty','postMessage','particlesNumber','windData','_onMouseMoveEvent','mars3d-canvasWind','toDegrees','ymin','updatePosition','clientHeight','_setOptionsHook','currentParticlesPosition','update','visibility','postProcessingSpeed','_removedHook','lng','SCENE3D','particleSystem','push','ZERO','ShaderSource','fragmentShaderSource','GeometryAttributes','Sampler','speedFactor','_map','atan2','dimensions','currentTrailsColor','clear','cols','_bilinearInterpolation','Appearance','keys','getOwnPropertyDescriptor','context','Cartesian3','nextTrailsColor','floor','particlesRendering','segmentsColor','create','depthTest','postProcessingPosition','cos','fromCssColorString','addEventListener','138609pMXfVJ','globalCompositeOperation','windTextures','Pass','moveTo'];_0x46cb=function(){return _0x5c497e;};return _0x46cb();}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x4a4072(0x123)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0xde6490={}){_0xde6490={...DEF_OPTIONS,..._0xde6490},super(_0xde6490),this['_setOptionsHook'](_0xde6490);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x3983bd){this['setData'](_0x3983bd);}get[_0x4a4072(0x13a)](){const _0x3944b2=_0x4a4072;return this['options'][_0x3944b2(0x13a)];}set[_0x4a4072(0x13a)](_0x203ade){this['options']['colors']=_0x203ade,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x203ade}),this['resize']();}[_0x4a4072(0x186)](){}['_addedHook'](){const _0x4f6e2f=_0x4a4072;this['scene']=this['_map']['scene'],this['camera']=this['_map'][_0x4f6e2f(0x110)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene'][_0x4f6e2f(0xe8)]['add'](this['primitives']),this[_0x4f6e2f(0x12f)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1[_0x4f6e2f(0x171)][_0x4f6e2f(0x160)],0.99*0x615299),this['updateViewerParameters'](),window[_0x4f6e2f(0x17b)](_0x4f6e2f(0xdc),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x4f6e2f(0x166)]['on'](mars3d__namespace['EventType'][_0x4f6e2f(0xe7)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x4f6e2f(0x150)],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x258f1b=_0x4a4072;window['removeEventListener']('resize',this['resize']),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this[_0x258f1b(0x166)]['off'](mars3d__namespace['EventType'][_0x258f1b(0xe7)],this['_onMapWhellEvent'],this),this['_map'][_0x258f1b(0x131)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x258f1b(0x146)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x258f1b(0x150)],this),this['primitives']['removeAll'](),this[_0x258f1b(0x166)]['scene']['primitives']['remove'](this[_0x258f1b(0xe8)]);}['resize'](){const _0x13db0b=_0x4a4072;if(!this['show']||!this[_0x13db0b(0x15e)])return;this['primitives'][_0x13db0b(0x13d)]=![],this[_0x13db0b(0xe8)]['removeAll'](),this['_map']['once'](mars3d__namespace[_0x13db0b(0x11b)]['preRender'],this[_0x13db0b(0xea)],this);}[_0x4a4072(0xea)](_0x4eb2cc){const _0x260f2c=_0x4a4072;this['particleSystem'][_0x260f2c(0x10a)](this[_0x260f2c(0x142)][_0x260f2c(0x170)]),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x38f508){const _0x3ed85e=_0x4a4072;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x3ed85e(0x144)]=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x1d1432){const _0x43dbc1=_0x4a4072;this[_0x43dbc1(0x13e)]=!![];}[_0x4a4072(0x150)](_0x161239){const _0x34d886=_0x4a4072;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this[_0x34d886(0xe8)]['show']=![],this['mouse_move']=!![]);}[_0x4a4072(0x146)](_0x1d040a){const _0x534064=_0x4a4072;if(!this['show']||!this['particleSystem'])return;this[_0x534064(0x13e)]&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x29dfdd=_0x4a4072;if(!this['_map']||!this[_0x29dfdd(0x13d)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x29dfdd(0xe8)]['show']=!![];}['setData'](_0x3551ab){const _0xa57b75=_0x4a4072;this['_data']=_0x3551ab,this[_0xa57b75(0x15e)]&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this[_0xa57b75(0x142)][_0xa57b75(0x170)],_0x3551ab,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}[_0x4a4072(0x156)](_0xeb59ae,_0x27c83c){const _0x5dfded=_0x4a4072;if(_0xeb59ae)for(const _0x10f835 in _0xeb59ae){this[_0x10f835]=_0xeb59ae[_0x10f835];}this[_0x5dfded(0x15e)]&&this['particleSystem'][_0x5dfded(0x141)](this[_0x5dfded(0xd4)]());}['getOptions'](){const _0x1d3a94=_0x4a4072,_0x41490b=Math['ceil'](Math[_0x1d3a94(0x148)](this['particlesNumber']));return this['particlesNumber']=_0x41490b*_0x41490b,{'particlesTextureSize':_0x41490b,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x1d3a94(0xf7)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x1d3a94(0x165)],'lineWidth':this['lineWidth'],'colors':this[_0x1d3a94(0x13a)]};}['addPrimitives'](){const _0x517885=_0x4a4072;this['primitives']['add'](this['particleSystem'][_0x517885(0x126)]['primitives']['getWind']),this['primitives']['add'](this[_0x517885(0x15e)]['particlesComputing'][_0x517885(0xe8)]['updateSpeed']),this[_0x517885(0xe8)]['add'](this['particleSystem']['particlesComputing']['primitives'][_0x517885(0x154)]),this['primitives'][_0x517885(0xd3)](this['particleSystem']['particlesComputing']['primitives'][_0x517885(0x178)]),this['primitives'][_0x517885(0xd3)](this['particleSystem']['particlesComputing']['primitives'][_0x517885(0x15a)]),this[_0x517885(0xe8)]['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this[_0x517885(0xe8)]['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives']['add'](this[_0x517885(0x15e)]['particlesRendering']['primitives']['screen']);}[_0x4a4072(0x133)](){const _0x5c1515=_0x4a4072;let _0x24b721=this['camera'][_0x5c1515(0xb8)](this['scene'][_0x5c1515(0x193)]['ellipsoid']);if(!_0x24b721){const _0x362172=this[_0x5c1515(0x166)]['getExtent']();_0x24b721=Cesium$1['Rectangle']['fromDegrees'](_0x362172['xmin'],_0x362172['ymin'],_0x362172['xmax'],_0x362172[_0x5c1515(0x120)]);}const _0x590082=Util['viewRectangleToLonLatRange'](_0x24b721);this['viewerParameters'][_0x5c1515(0xdf)]['x']=_0x590082['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x590082['lon'][_0x5c1515(0xc9)],this['viewerParameters'][_0x5c1515(0x13f)]['x']=_0x590082['lat']['min'],this[_0x5c1515(0x12f)][_0x5c1515(0x13f)]['y']=_0x590082['lat']['max'];const _0x54e687=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this[_0x5c1515(0x142)]['drawingBufferHeight']);_0x54e687>0x0&&(this[_0x5c1515(0x12f)]['pixelSize']=_0x54e687);}}mars3d__namespace['LayerUtil'][_0x4a4072(0x11e)]('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x35bbcf=_0x4a4072;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x35bbcf(0xdb)]=null;}['destroy'](){for(const _0xc6cfc0 in this){delete this[_0xc6cfc0];}}}class CanvasWindField{constructor(_0x220a5e){const _0x2a1227=_0x4a4072;this[_0x2a1227(0x141)](_0x220a5e);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x19dfff){const _0x17116b=_0x4a4072;this['_speedRate']=(0x64-(_0x19dfff>0x63?0x63:_0x19dfff))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x17116b(0x153)])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x1259c7){const _0xa8533d=_0x4a4072;this[_0xa8533d(0xe0)]=_0x1259c7;}['setOptions'](_0x44c010){const _0x30c6b2=_0x4a4072;this['options']=_0x44c010,this[_0x30c6b2(0x10e)]=_0x44c010[_0x30c6b2(0x10e)]||0x78,this['speedRate']=_0x44c010[_0x30c6b2(0xc1)]||0x32,this['particles']=[];const _0x3fe1da=_0x44c010['particlesNumber']||0x1000;for(let _0x273f90=0x0;_0x273f90<_0x3fe1da;_0x273f90++){const _0x33b674=this[_0x30c6b2(0xb5)](new CanvasParticle());this['particles']['push'](_0x33b674);}}[_0x4a4072(0x108)](_0x494723){const _0x52c579=_0x4a4072;this['rows']=_0x494723[_0x52c579(0xc0)],this['cols']=_0x494723['cols'],this['xmin']=_0x494723['xmin'],this['xmax']=_0x494723['xmax'],this['ymin']=_0x494723['ymin'],this['ymax']=_0x494723[_0x52c579(0x120)],this['grid']=[];const _0x3403bd=_0x494723['udata'],_0x44c79c=_0x494723['vdata'];let _0x30623d=![];_0x3403bd['length']===this['rows']&&_0x3403bd[0x0]['length']===this[_0x52c579(0x16b)]&&(_0x30623d=!![]);let _0x7156e3=0x0,_0x56f941=null,_0x3bf48f=null;for(let _0x434ff2=0x0;_0x434ff2<this['rows'];_0x434ff2++){_0x56f941=[];for(let _0x5be1f4=0x0;_0x5be1f4<this[_0x52c579(0x16b)];_0x5be1f4++,_0x7156e3++){_0x30623d?_0x3bf48f=this['_calcUV'](_0x3403bd[_0x434ff2][_0x5be1f4],_0x44c79c[_0x434ff2][_0x5be1f4]):_0x3bf48f=this['_calcUV'](_0x3403bd[_0x7156e3],_0x44c79c[_0x7156e3]),_0x56f941[_0x52c579(0x15f)](_0x3bf48f);}this['grid']['push'](_0x56f941);}this[_0x52c579(0x12a)]['reverseY']&&this['grid'][_0x52c579(0x18f)]();}[_0x4a4072(0x16a)](){const _0x2fdc5e=_0x4a4072;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x2fdc5e(0x153)],delete this['ymax'],delete this['grid'],delete this[_0x2fdc5e(0x195)];}['toGridXY'](_0x36f4a8,_0x5a9da9){const _0x7976=_0x4a4072,_0x5db241=(_0x36f4a8-this[_0x7976(0xd6)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x50d76d=(this['ymax']-_0x5a9da9)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x5db241,_0x50d76d];}['getUVByXY'](_0x2bd259,_0x31fd89){const _0x580ab3=_0x4a4072;if(_0x2bd259<0x0||_0x2bd259>=this['cols']||_0x31fd89>=this['rows'])return[0x0,0x0,0x0];const _0x440696=Math[_0x580ab3(0x173)](_0x2bd259),_0x5283ec=Math['floor'](_0x31fd89);if(_0x440696===_0x2bd259&&_0x5283ec===_0x31fd89)return this['grid'][_0x31fd89][_0x2bd259];const _0x2d6fce=_0x440696+0x1,_0x250372=_0x5283ec+0x1,_0x3e7f2e=this['getUVByXY'](_0x440696,_0x5283ec),_0x4cb301=this['getUVByXY'](_0x2d6fce,_0x5283ec),_0x5c690e=this['getUVByXY'](_0x440696,_0x250372),_0x13ec1b=this['getUVByXY'](_0x2d6fce,_0x250372);let _0x597118=null;try{_0x597118=this['_bilinearInterpolation'](_0x2bd259-_0x440696,_0x31fd89-_0x5283ec,_0x3e7f2e,_0x4cb301,_0x5c690e,_0x13ec1b);}catch(_0x1f213e){console[_0x580ab3(0x136)](_0x2bd259,_0x31fd89);}return _0x597118;}[_0x4a4072(0x16c)](_0x24f48a,_0x344418,_0x305488,_0x4662e8,_0x5e3bfd,_0x304a11){const _0xa47c30=0x1-_0x24f48a,_0x703672=0x1-_0x344418,_0x3324d1=_0xa47c30*_0x703672,_0x922308=_0x24f48a*_0x703672,_0x1c5691=_0xa47c30*_0x344418,_0x18489f=_0x24f48a*_0x344418,_0x540708=_0x305488[0x0]*_0x3324d1+_0x4662e8[0x0]*_0x922308+_0x5e3bfd[0x0]*_0x1c5691+_0x304a11[0x0]*_0x18489f,_0x4bbb4f=_0x305488[0x1]*_0x3324d1+_0x4662e8[0x1]*_0x922308+_0x5e3bfd[0x1]*_0x1c5691+_0x304a11[0x1]*_0x18489f;return this['_calcUV'](_0x540708,_0x4bbb4f);}['_calcUV'](_0x4f2373,_0x565c7b){return[+_0x4f2373,+_0x565c7b,Math['sqrt'](_0x4f2373*_0x4f2373+_0x565c7b*_0x565c7b)];}['getUVByPoint'](_0x8f6440,_0x176f71){if(!this['isInExtent'](_0x8f6440,_0x176f71))return null;const _0x5d0a71=this['toGridXY'](_0x8f6440,_0x176f71),_0x57f440=this['getUVByXY'](_0x5d0a71[0x0],_0x5d0a71[0x1]);return _0x57f440;}['isInExtent'](_0x38f9b2,_0x4da728){const _0x5b7e01=_0x4a4072;return _0x38f9b2>=this[_0x5b7e01(0xd6)]&&_0x38f9b2<=this[_0x5b7e01(0xd2)]&&_0x4da728>=this[_0x5b7e01(0x153)]&&_0x4da728<=this[_0x5b7e01(0x120)]?!![]:![];}['getRandomLatLng'](){const _0x19637a=_0x4a4072,_0xae8fb3=fRandomByfloat(this['xmin'],this['xmax']),_0x35d6c0=fRandomByfloat(this['ymin'],this[_0x19637a(0x120)]);return{'lat':_0x35d6c0,'lng':_0xae8fb3};}['getParticles'](){const _0x6ec8b2=_0x4a4072;let _0x44e3ce,_0x556c5b,_0x2d1de5;for(let _0x279ba2=0x0,_0x853169=this['particles']['length'];_0x279ba2<_0x853169;_0x279ba2++){let _0x1eec91=this['particles'][_0x279ba2];_0x1eec91['age']<=0x0&&(_0x1eec91=this['_randomParticle'](_0x1eec91));if(_0x1eec91[_0x6ec8b2(0xdb)]>0x0){const _0x315464=_0x1eec91[_0x6ec8b2(0xe9)],_0x579703=_0x1eec91['tlat'];_0x2d1de5=this['getUVByPoint'](_0x315464,_0x579703),_0x2d1de5?(_0x44e3ce=_0x315464+this['_calc_speedRate'][0x0]*_0x2d1de5[0x0],_0x556c5b=_0x579703+this['_calc_speedRate'][0x1]*_0x2d1de5[0x1],_0x1eec91['lng']=_0x315464,_0x1eec91[_0x6ec8b2(0x140)]=_0x579703,_0x1eec91['tlng']=_0x44e3ce,_0x1eec91['tlat']=_0x556c5b,_0x1eec91[_0x6ec8b2(0xdb)]--):_0x1eec91[_0x6ec8b2(0xdb)]=0x0;}}return this['particles'];}['_randomParticle'](_0x3f80a4){const _0x5be09d=_0x4a4072;let _0x4ed148,_0x1d4220;for(let _0x47a7db=0x0;_0x47a7db<0x1e;_0x47a7db++){_0x4ed148=this['getRandomLatLng'](),_0x1d4220=this['getUVByPoint'](_0x4ed148[_0x5be09d(0x15c)],_0x4ed148[_0x5be09d(0x140)]);if(_0x1d4220&&_0x1d4220[0x2]>0x0)break;}if(!_0x1d4220)return _0x3f80a4;const _0xf3ca0a=_0x4ed148['lng']+this[_0x5be09d(0x139)][0x0]*_0x1d4220[0x0],_0xd8a1c4=_0x4ed148[_0x5be09d(0x140)]+this[_0x5be09d(0x139)][0x1]*_0x1d4220[0x1];return _0x3f80a4['lng']=_0x4ed148['lng'],_0x3f80a4['lat']=_0x4ed148[_0x5be09d(0x140)],_0x3f80a4['tlng']=_0xf3ca0a,_0x3f80a4['tlat']=_0xd8a1c4,_0x3f80a4['age']=Math['round'](Math[_0x5be09d(0xff)]()*this['maxAge']),_0x3f80a4;}['destroy'](){for(const _0x1f8ee7 in this){delete this[_0x1f8ee7];}}}function fRandomByfloat(_0x1372ce,_0x7f05b4){return _0x1372ce+Math['random']()*(_0x7f05b4-_0x1372ce);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x3b0c1f={}){super(_0x3b0c1f),this['_setOptionsHook'](_0x3b0c1f),this['canvas']=null;}['_setOptionsHook'](_0x3e8d29,_0x28e0b1){const _0x2133f3=_0x4a4072;this[_0x2133f3(0xda)]=0x3e8/(_0x3e8d29[_0x2133f3(0x105)]||0xa),this[_0x2133f3(0xf8)]=this['options'][_0x2133f3(0x11a)]??![],this['color']=_0x3e8d29[_0x2133f3(0xef)]||'#ffffff',this['lineWidth']=_0x3e8d29[_0x2133f3(0xbf)]||0x1,this['fixedHeight']=_0x3e8d29['fixedHeight']??0x0,this['reverseY']=_0x3e8d29['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x3e8d29);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x59dcf7=_0x4a4072;return this['_map'][_0x59dcf7(0x142)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0x40b2ee=_0x4a4072;return this[_0x40b2ee(0x166)]['scene'][_0x40b2ee(0x145)]['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set[_0x4a4072(0x11a)](_0x3c60be){const _0x5dd8b9=_0x4a4072;this[_0x5dd8b9(0xf8)]=_0x3c60be;if(!this['canvas'])return;_0x3c60be?this['canvas'][_0x5dd8b9(0x19b)][_0x5dd8b9(0xfc)]='all':this['canvas'][_0x5dd8b9(0x19b)]['pointer-events']='none';}get[_0x4a4072(0x14e)](){const _0x122b5f=_0x4a4072;return this['options'][_0x122b5f(0x14e)];}set[_0x4a4072(0x14e)](_0x5bdba0){const _0x10e786=_0x4a4072;this[_0x10e786(0x12a)]['particlesNumber']=_0x5bdba0,clearTimeout(this[_0x10e786(0x138)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x291e13){const _0x54d3da=_0x4a4072;this[_0x54d3da(0x12a)][_0x54d3da(0xc1)]=_0x291e13,this['windField']&&(this[_0x54d3da(0x112)]['speedRate']=_0x291e13);}get[_0x4a4072(0x10e)](){return this['options']['maxAge'];}set['maxAge'](_0xb0bae9){const _0x12bbef=_0x4a4072;this['options']['maxAge']=_0xb0bae9,this['windField']&&(this[_0x12bbef(0x112)]['maxAge']=_0xb0bae9);}get[_0x4a4072(0xc3)](){return this['windData'];}set['data'](_0x4fe291){this['setData'](_0x4fe291);}[_0x4a4072(0x147)](_0x3b217c){const _0x2f4847=_0x4a4072;_0x3b217c?this['_addedHook']():(this[_0x2f4847(0x14f)]&&(this[_0x2f4847(0x12a)][_0x2f4847(0xc3)]=this[_0x2f4847(0x14f)]),this[_0x2f4847(0x15b)]());}['_mountedHook'](){const _0x4dbc70=_0x4a4072;this['options'][_0x4dbc70(0xd0)]?this[_0x4dbc70(0x127)]():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x1a8d43=_0x4a4072;this['canvas']=this[_0x1a8d43(0x11f)](),this[_0x1a8d43(0x10d)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0x1a8d43(0x12a)][_0x1a8d43(0xc3)]&&this['setData'](this[_0x1a8d43(0x12a)]['data']);}['_removedHook'](){const _0x4a4395=_0x4a4072;this[_0x4a4395(0x16a)](),this['unbindEvent'](),this['canvas']&&(this[_0x4a4395(0x166)]['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x18d06f=_0x4a4072,_0x351aba=mars3d__namespace['DomUtil']['create'](_0x18d06f(0x145),_0x18d06f(0x151),this['_map'][_0x18d06f(0x125)]);return _0x351aba['style']['position']='absolute',_0x351aba[_0x18d06f(0x19b)][_0x18d06f(0x199)]='0px',_0x351aba['style']['left']=_0x18d06f(0x118),_0x351aba['style'][_0x18d06f(0x190)]=this['_map']['scene']['canvas']['clientWidth']+'px',_0x351aba[_0x18d06f(0x19b)]['height']=this['_map']['scene']['canvas'][_0x18d06f(0x155)]+'px',_0x351aba['style'][_0x18d06f(0x11a)]=this['_pointerEvents']?'auto':'none',_0x351aba['style']['zIndex']=this['options']['zIndex']??0x9,_0x351aba['width']=this['_map']['scene'][_0x18d06f(0x145)]['clientWidth'],_0x351aba['height']=this['_map']['scene']['canvas']['clientHeight'],_0x351aba;}['resize'](){const _0x539bab=_0x4a4072;this[_0x539bab(0x145)]&&(this['canvas'][_0x539bab(0x19b)]['width']=this['_map'][_0x539bab(0x142)]['canvas'][_0x539bab(0xfa)]+'px',this['canvas']['style'][_0x539bab(0x10f)]=this['_map']['scene']['canvas'][_0x539bab(0x155)]+'px',this['canvas'][_0x539bab(0x190)]=this['_map']['scene'][_0x539bab(0x145)]['clientWidth'],this['canvas'][_0x539bab(0x10f)]=this['_map']['scene']['canvas'][_0x539bab(0x155)]);}['bindEvent'](){const _0x1f7215=_0x4a4072,_0x29940f=this;let _0x596d82=Date['now']();(function _0x8e85e8(){const _0x208a04=_0x31e3;_0x29940f['animateFrame']=window['requestAnimationFrame'](_0x8e85e8);if(_0x29940f['show']&&_0x29940f['windField']){const _0x30354c=Date['now'](),_0x2363f0=_0x30354c-_0x596d82;_0x2363f0>_0x29940f[_0x208a04(0xda)]&&(_0x596d82=_0x30354c-_0x2363f0%_0x29940f[_0x208a04(0xda)],_0x29940f['update']());}}(),window['addEventListener'](_0x1f7215(0xdc),this['resize']['bind'](this),![]),this[_0x1f7215(0x13e)]=![],this[_0x1f7215(0x103)]=![],this[_0x1f7215(0x12a)][_0x1f7215(0xcb)]&&(this[_0x1f7215(0x166)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x1f7215(0x132)],this),this[_0x1f7215(0x166)]['on'](mars3d__namespace[_0x1f7215(0x11b)]['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x4c6c1e=_0x4a4072;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x4c6c1e(0xdc)]),this['options'][_0x4c6c1e(0xcb)]&&(this[_0x4c6c1e(0x166)][_0x4c6c1e(0x131)](mars3d__namespace[_0x4c6c1e(0x11b)][_0x4c6c1e(0xe7)],this[_0x4c6c1e(0x119)],this),this['_map']['off'](mars3d__namespace[_0x4c6c1e(0x11b)]['mouseDown'],this[_0x4c6c1e(0x132)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x1c1b8f){const _0x4cbf6b=_0x4a4072;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style'][_0x4cbf6b(0x159)]='hidden',this[_0x4cbf6b(0x144)]=setTimeout(()=>{if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x1893f7){const _0x27fc57=_0x4a4072;this[_0x27fc57(0x13e)]=!![],this['_map']['off'](mars3d__namespace[_0x27fc57(0x11b)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x55f6c0){const _0x2e43d5=_0x4a4072;if(!this[_0x2e43d5(0x13d)]||!this['canvas'])return;this[_0x2e43d5(0x13e)]&&(this['canvas']['style']['visibility']='hidden',this[_0x2e43d5(0x103)]=!![]);}['_onMouseUpEvent'](_0xdc4793){const _0xd77ec7=_0x4a4072;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace[_0xd77ec7(0x11b)]['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this[_0xd77ec7(0x13e)]=![],this['mouse_move']=![];}['setData'](_0x8e791){const _0x37183b=_0x4a4072;this[_0x37183b(0x16a)](),this['windData']=_0x8e791,this['windField'][_0x37183b(0x108)](_0x8e791),this['redraw']();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}[_0x4a4072(0x158)](){const _0x1af997=_0x4a4072;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField'][_0x1af997(0x158)]();else{const _0x508c18=this[_0x1af997(0x112)]['getParticles']();this['_drawLines'](_0x508c18);}this['_updateIng']=![];}['_drawLines'](_0x33c3c9){const _0x87a869=_0x4a4072;this['canvasContext'][_0x87a869(0x17d)]=_0x87a869(0x121),this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9,this[_0x87a869(0x10d)]['beginPath'](),this[_0x87a869(0x10d)]['lineWidth']=this['lineWidth'],this[_0x87a869(0x10d)]['strokeStyle']=this['color'];const _0x2e769f=this[_0x87a869(0x166)]['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x2560e4=this['canvasWidth']*0.25;for(let _0x53de98=0x0,_0x1d00c8=_0x33c3c9['length'];_0x53de98<_0x1d00c8;_0x53de98++){const _0x3b941=_0x33c3c9[_0x53de98],_0x1f6ace=this['_tomap'](_0x3b941['lng'],_0x3b941['lat'],_0x3b941),_0x155858=this[_0x87a869(0x12b)](_0x3b941['tlng'],_0x3b941[_0x87a869(0xec)],_0x3b941);if(!_0x1f6ace||!_0x155858)continue;if(_0x2e769f&&Math['abs'](_0x1f6ace[0x0]-_0x155858[0x0])>=_0x2560e4)continue;this['canvasContext'][_0x87a869(0x180)](_0x1f6ace[0x0],_0x1f6ace[0x1]),this['canvasContext']['lineTo'](_0x155858[0x0],_0x155858[0x1]);}this[_0x87a869(0x10d)]['stroke']();}['_tomap'](_0x9fe384,_0xa452f3,_0x3ee10b){const _0x333715=_0x4a4072,_0x2ae08d=Cesium['Cartesian3']['fromDegrees'](_0x9fe384,_0xa452f3,this[_0x333715(0x19a)]),_0x4c9296=this['_map']['scene'];if(_0x4c9296['mode']===Cesium[_0x333715(0x187)]['SCENE3D']){const _0x34894f=new Cesium['EllipsoidalOccluder'](_0x4c9296[_0x333715(0x193)]['ellipsoid'],_0x4c9296['camera'][_0x333715(0x109)]),_0x504148=_0x34894f[_0x333715(0xbc)](_0x2ae08d);if(!_0x504148)return _0x3ee10b[_0x333715(0xdb)]=0x0,null;}const _0x1f7900=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x2ae08d);return _0x1f7900?[_0x1f7900['x'],_0x1f7900['y']]:null;}['clear'](){const _0x4e7658=_0x4a4072;this['windField'][_0x4e7658(0x16a)](),delete this['windData'];}[_0x4a4072(0x127)](){const _0x4619a6=_0x4a4072;this[_0x4619a6(0xd0)]=new Worker(this['options']['worker']),this['worker']['onmessage']=_0x911df7=>{const _0x4345cc=_0x4619a6;this['_drawLines'](_0x911df7['data']['particles']),this[_0x4345cc(0x188)]=![];},this['windField']={'init':_0x7cb0f3=>{const _0x51fc75=_0x4619a6;this['worker'][_0x51fc75(0x14d)]({'type':'init','options':_0x7cb0f3});},'setOptions':_0x55437e=>{const _0x5603ec=_0x4619a6;this[_0x5603ec(0xd0)][_0x5603ec(0x14d)]({'type':'setOptions','options':_0x55437e});},'setDate':_0x29b157=>{const _0x20c29b=_0x4619a6;this[_0x20c29b(0xd0)]['postMessage']({'type':'setDate','data':_0x29b157});},'update':()=>{const _0x5087f9=_0x4619a6;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x5087f9(0xd0)]['postMessage']({'type':'update'});},'clear':()=>{const _0x4a865d=_0x4619a6;this['worker'][_0x4a865d(0x14d)]({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x4a4072(0xc6)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x4a4072(0x14c)](exports,'__esModule',{'value':!![]});
}));
