/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.2
 * 编译日期：2023-08-22 10:38:20
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x553eab=_0xa3ae;(function(_0x574b5e,_0x133f17){const _0x3f6cdd=_0xa3ae,_0xb9a4f1=_0x574b5e();while(!![]){try{const _0xbcccf6=-parseInt(_0x3f6cdd(0x231))/0x1*(-parseInt(_0x3f6cdd(0x191))/0x2)+parseInt(_0x3f6cdd(0x237))/0x3+parseInt(_0x3f6cdd(0x221))/0x4+-parseInt(_0x3f6cdd(0x189))/0x5+parseInt(_0x3f6cdd(0x242))/0x6*(-parseInt(_0x3f6cdd(0x1a8))/0x7)+parseInt(_0x3f6cdd(0x16c))/0x8*(-parseInt(_0x3f6cdd(0x220))/0x9)+parseInt(_0x3f6cdd(0x1b6))/0xa;if(_0xbcccf6===_0x133f17)break;else _0xb9a4f1['push'](_0xb9a4f1['shift']());}catch(_0x20ccc7){_0xb9a4f1['push'](_0xb9a4f1['shift']());}}}(_0x4094,0xdde16));function _interopNamespace(_0x18ccfa){if(_0x18ccfa&&_0x18ccfa['__esModule'])return _0x18ccfa;var _0x2a0a5d=Object['create'](null);return _0x18ccfa&&Object['keys'](_0x18ccfa)['forEach'](function(_0x4ea8d7){const _0x426cb5=_0xa3ae;if(_0x4ea8d7!==_0x426cb5(0x23b)){var _0x203c9e=Object['getOwnPropertyDescriptor'](_0x18ccfa,_0x4ea8d7);Object['defineProperty'](_0x2a0a5d,_0x4ea8d7,_0x203c9e[_0x426cb5(0x214)]?_0x203c9e:{'enumerable':!![],'get':function(){return _0x18ccfa[_0x4ea8d7];}});}}),_0x2a0a5d['default']=_0x18ccfa,_0x2a0a5d;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x160d6a,_0x10939e){const _0x1d636f=_0x160d6a*Math['cos'](Cesium$7['Math']['toRadians'](_0x10939e));return _0x1d636f;}function getV(_0x1d7099,_0x2cd350){const _0x1a940b=_0xa3ae,_0x2df682=_0x1d7099*Math['sin'](Cesium$7[_0x1a940b(0x19b)][_0x1a940b(0x1f1)](_0x2cd350));return _0x2df682;}function _0xa3ae(_0x17e3ac,_0x42160a){const _0x40943d=_0x4094();return _0xa3ae=function(_0xa3ae90,_0x5b4d67){_0xa3ae90=_0xa3ae90-0x156;let _0x4fab2b=_0x40943d[_0xa3ae90];return _0x4fab2b;},_0xa3ae(_0x17e3ac,_0x42160a);}function getSpeed(_0x4f4b2d,_0x4df25c){const _0x459974=_0xa3ae,_0x4fc58c=Math['sqrt'](Math['pow'](_0x4f4b2d,0x2)+Math[_0x459974(0x15c)](_0x4df25c,0x2));return _0x4fc58c;}function getDirection(_0x3e44f2,_0x1c30e2){let _0x1647dc=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x1c30e2,_0x3e44f2));return _0x1647dc+=_0x1647dc<0x0?0x168:0x0,_0x1647dc;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x49dbab){const _0x3b0fbf=_0xa3ae;this['commandType']=_0x49dbab['commandType'],this['geometry']=_0x49dbab[_0x3b0fbf(0x1e3)],this['attributeLocations']=_0x49dbab['attributeLocations'],this['primitiveType']=_0x49dbab['primitiveType'],this['uniformMap']=_0x49dbab[_0x3b0fbf(0x1ea)],this[_0x3b0fbf(0x1a7)]=_0x49dbab['vertexShaderSource'],this[_0x3b0fbf(0x207)]=_0x49dbab[_0x3b0fbf(0x207)],this['rawRenderState']=_0x49dbab['rawRenderState'],this['framebuffer']=_0x49dbab['framebuffer'],this['outputTexture']=_0x49dbab['outputTexture'],this['autoClear']=_0x49dbab['autoClear']??![],this[_0x3b0fbf(0x1c5)]=_0x49dbab[_0x3b0fbf(0x1c5)],this['show']=!![],this[_0x3b0fbf(0x17b)]=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x3b0fbf(0x15d)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x3b0fbf(0x21a)],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x3103be){const _0x13e899=_0xa3ae;switch(this[_0x13e899(0x211)]){case _0x13e899(0x1fb):{const _0x37570b=Cesium$6[_0x13e899(0x202)]['fromGeometry']({'context':_0x3103be,'geometry':this['geometry'],'attributeLocations':this[_0x13e899(0x16d)],'bufferUsage':Cesium$6[_0x13e899(0x195)]['STATIC_DRAW']}),_0x31f48a=Cesium$6['ShaderProgram']['fromCache']({'context':_0x3103be,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x13e899(0x207)]}),_0x22002f=Cesium$6[_0x13e899(0x229)]['fromCache'](this[_0x13e899(0x22a)]);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x13e899(0x243)],'shaderProgram':_0x31f48a,'vertexArray':_0x37570b,'modelMatrix':Cesium$6[_0x13e899(0x16b)]['IDENTITY'],'renderState':_0x22002f,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x13e899(0x21a)],'pass':Cesium$6[_0x13e899(0x1cb)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0x13e899(0x1c7)],'persists':!![]});}}}['setGeometry'](_0x4e8ad1,_0x5f15e0){const _0x2efc4f=_0xa3ae;this[_0x2efc4f(0x1e3)]=_0x5f15e0;const _0x411da6=Cesium$6['VertexArray']['fromGeometry']({'context':_0x4e8ad1,'geometry':this[_0x2efc4f(0x1e3)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x2efc4f(0x15b)]});this['commandToExecute']['vertexArray']=_0x411da6;}['update'](_0x129117){const _0x3b0e82=_0xa3ae;if(!this['show'])return;if(_0x129117['mode']!==Cesium$6[_0x3b0e82(0x1b1)][_0x3b0e82(0x1ba)])return;!Cesium$6[_0x3b0e82(0x1df)](this['commandToExecute'])&&(this['commandToExecute']=this[_0x3b0e82(0x1ff)](_0x129117[_0x3b0e82(0x225)])),Cesium$6['defined'](this['preExecute'])&&this[_0x3b0e82(0x1c5)](),Cesium$6['defined'](this[_0x3b0e82(0x15d)])&&_0x129117['commandList']['push'](this['clearCommand']),_0x129117['commandList'][_0x3b0e82(0x160)](this[_0x3b0e82(0x17b)]);}[_0x553eab(0x1c6)](){return![];}['destroy'](){const _0x15c9db=_0x553eab;if(this['clearCommand']){var _0x42d987,_0x3c611b;(_0x42d987=this[_0x15c9db(0x15d)])!==null&&_0x42d987!==void 0x0&&_0x42d987['vertexArray']&&this[_0x15c9db(0x15d)]['vertexArray'][_0x15c9db(0x161)](),(_0x3c611b=this['clearCommand'])!==null&&_0x3c611b!==void 0x0&&_0x3c611b['shaderProgram']&&this[_0x15c9db(0x15d)]['shaderProgram']['destroy'](),delete this[_0x15c9db(0x15d)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute'][_0x15c9db(0x1e0)]['destroy'](),this[_0x15c9db(0x17b)]['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x487f6f=function(){const _0x19aee6=_0xa3ae,_0x383d2d=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x19aee6(0x164))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x19aee6(0x1f6)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x19aee6(0x1f6)][_0x19aee6(0x22c)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x383d2d;},_0x570331=function(_0x122fa1,_0x46800c){const _0x40abe5=_0xa3ae;if(Cesium$5['defined'](_0x46800c)){const _0x1fe069={};_0x1fe069['arrayBufferView']=_0x46800c,_0x122fa1[_0x40abe5(0x201)]=_0x1fe069;}const _0x4ccc08=new Cesium$5[(_0x40abe5(0x1c1))](_0x122fa1);return _0x4ccc08;},_0x1b07a5=function(_0x63d25e,_0x2ae6f6,_0x70bdb1){const _0x662d81=new Cesium$5['Framebuffer']({'context':_0x63d25e,'colorTextures':[_0x2ae6f6],'depthTexture':_0x70bdb1});return _0x662d81;},_0x3ecffe=function(_0x109dfc){const _0x1bad36=_0xa3ae,_0x4bf2ec=!![],_0xb614da=![],_0x1768ef={'viewport':_0x109dfc[_0x1bad36(0x196)],'depthTest':_0x109dfc['depthTest'],'depthMask':_0x109dfc['depthMask'],'blending':_0x109dfc[_0x1bad36(0x182)]},_0x205826=Cesium$5[_0x1bad36(0x1b4)]['getDefaultRenderState'](_0x4bf2ec,_0xb614da,_0x1768ef);return _0x205826;},_0x5d6822=function(_0xf2a28d){const _0x23c3f7=_0xa3ae,_0x2870dc={},_0x251dcf=Cesium$5[_0x23c3f7(0x19b)]['mod'](_0xf2a28d[_0x23c3f7(0x240)],Cesium$5['Math'][_0x23c3f7(0x1a0)]),_0x435423=Cesium$5['Math'][_0x23c3f7(0x1ed)](_0xf2a28d[_0x23c3f7(0x226)],Cesium$5['Math'][_0x23c3f7(0x1a0)]),_0xdff887=_0xf2a28d['width'];let _0x279353,_0x56aa5d;_0xdff887>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x279353=0x0,_0x56aa5d=Cesium$5['Math'][_0x23c3f7(0x1a0)]):_0x435423-_0x251dcf<_0xdff887?(_0x279353=_0x251dcf,_0x56aa5d=_0x251dcf+_0xdff887):(_0x279353=_0x251dcf,_0x56aa5d=_0x435423);_0x2870dc[_0x23c3f7(0x1c4)]={'min':Cesium$5['Math']['toDegrees'](_0x279353),'max':Cesium$5['Math']['toDegrees'](_0x56aa5d)};const _0x293f6a=_0xf2a28d[_0x23c3f7(0x168)],_0x137eb0=_0xf2a28d['north'],_0x2af822=_0xf2a28d[_0x23c3f7(0x1cd)],_0x39eb3d=_0x2af822>Cesium$5[_0x23c3f7(0x19b)]['PI']/0xc?_0x2af822/0x2:0x0;let _0x1b5538=Cesium$5['Math']['clampToLatitudeRange'](_0x293f6a-_0x39eb3d),_0x2ad50a=Cesium$5['Math']['clampToLatitudeRange'](_0x137eb0+_0x39eb3d);return _0x1b5538<-Cesium$5[_0x23c3f7(0x19b)]['PI_OVER_THREE']&&(_0x1b5538=-Cesium$5['Math']['PI_OVER_TWO']),_0x2ad50a>Cesium$5['Math']['PI_OVER_THREE']&&(_0x2ad50a=Cesium$5['Math']['PI_OVER_TWO']),_0x2870dc['lat']={'min':Cesium$5['Math']['toDegrees'](_0x1b5538),'max':Cesium$5['Math'][_0x23c3f7(0x1e5)](_0x2ad50a)},_0x2870dc;};return{'getFullscreenQuad':_0x487f6f,'createTexture':_0x570331,'createFramebuffer':_0x1b07a5,'createRawRenderState':_0x3ecffe,'viewRectangleToLonLatRange':_0x5d6822};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x553eab(0x1c2),trailDraw_frag=_0x553eab(0x172),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x49235b,_0x53bfdf,_0x3f22a0,_0x17b2c0,_0x2631e8){const _0x36fce1=_0x553eab;this[_0x36fce1(0x20d)](_0x49235b,_0x53bfdf,_0x3f22a0[_0x36fce1(0x1a1)]),this[_0x36fce1(0x166)](_0x49235b),this['createRenderingPrimitives'](_0x49235b,_0x3f22a0,_0x17b2c0,_0x2631e8);}['createRenderingTextures'](_0x151c95,_0x195b04,_0x5a217b){const _0x132b58=_0x553eab,_0x418b5d={'context':_0x151c95,'width':_0x151c95[_0x132b58(0x165)],'height':_0x151c95[_0x132b58(0x19e)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x132b58(0x24c)][_0x132b58(0x192)]},_0x24a4d3={'context':_0x151c95,'width':_0x151c95['drawingBufferWidth'],'height':_0x151c95[_0x132b58(0x19e)],'pixelFormat':Cesium$4[_0x132b58(0x234)][_0x132b58(0x216)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x36c19b=_0x5a217b['length'],_0x461c94=new Float32Array(_0x36c19b*0x3);for(let _0x4ba493=0x0;_0x4ba493<_0x36c19b;_0x4ba493++){const _0x2876a8=Cesium$4['Color'][_0x132b58(0x1e1)](_0x5a217b[_0x4ba493]);_0x461c94[0x3*_0x4ba493]=_0x2876a8['red'],_0x461c94[0x3*_0x4ba493+0x1]=_0x2876a8['green'],_0x461c94[0x3*_0x4ba493+0x2]=_0x2876a8['blue'];}const _0x6c92ad={'context':_0x151c95,'width':_0x36c19b,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x132b58(0x24c)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x132b58(0x1e8)][_0x132b58(0x20b)],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x418b5d),'segmentsDepth':Util['createTexture'](_0x24a4d3),'currentTrailsColor':Util['createTexture'](_0x418b5d),'currentTrailsDepth':Util['createTexture'](_0x24a4d3),'nextTrailsColor':Util['createTexture'](_0x418b5d),'nextTrailsDepth':Util['createTexture'](_0x24a4d3),'colorTable':Util['createTexture'](_0x6c92ad,_0x461c94)};}['createRenderingFramebuffers'](_0x196bb1){const _0xd48965=_0x553eab;this['framebuffers']={'segments':Util['createFramebuffer'](_0x196bb1,this['textures']['segmentsColor'],this['textures'][_0xd48965(0x1d5)]),'currentTrails':Util['createFramebuffer'](_0x196bb1,this['textures'][_0xd48965(0x175)],this[_0xd48965(0x210)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x196bb1,this['textures']['nextTrailsColor'],this[_0xd48965(0x210)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x5b7fbc){const _0x2f9c07=_0x553eab,_0x4bc8ce=0x4;let _0x2fcd98=[];for(let _0x3cf3ce=0x0;_0x3cf3ce<_0x5b7fbc['particlesTextureSize'];_0x3cf3ce++){for(let _0x21bf43=0x0;_0x21bf43<_0x5b7fbc['particlesTextureSize'];_0x21bf43++){for(let _0x54a651=0x0;_0x54a651<_0x4bc8ce;_0x54a651++){_0x2fcd98['push'](_0x3cf3ce/_0x5b7fbc['particlesTextureSize']),_0x2fcd98[_0x2f9c07(0x160)](_0x21bf43/_0x5b7fbc[_0x2f9c07(0x223)]);}}}_0x2fcd98=new Float32Array(_0x2fcd98);let _0x30af3e=[];const _0x1409d3=[-0x1,0x1],_0x5bb74c=[-0x1,0x1];for(let _0x268e98=0x0;_0x268e98<_0x5b7fbc[_0x2f9c07(0x206)];_0x268e98++){for(let _0x54df3f=0x0;_0x54df3f<_0x4bc8ce/0x2;_0x54df3f++){for(let _0x10e777=0x0;_0x10e777<_0x4bc8ce/0x2;_0x10e777++){_0x30af3e['push'](_0x1409d3[_0x54df3f]),_0x30af3e['push'](_0x5bb74c[_0x10e777]),_0x30af3e['push'](0x0);}}}_0x30af3e=new Float32Array(_0x30af3e);const _0x289d56=0x6*_0x5b7fbc['maxParticles'],_0x249632=new Uint32Array(_0x289d56);for(let _0x341623=0x0,_0x3a7fd9=0x0,_0x44838a=0x0;_0x341623<_0x5b7fbc['maxParticles'];_0x341623++){_0x249632[_0x3a7fd9++]=_0x44838a+0x0,_0x249632[_0x3a7fd9++]=_0x44838a+0x1,_0x249632[_0x3a7fd9++]=_0x44838a+0x2,_0x249632[_0x3a7fd9++]=_0x44838a+0x2,_0x249632[_0x3a7fd9++]=_0x44838a+0x1,_0x249632[_0x3a7fd9++]=_0x44838a+0x3,_0x44838a+=0x4;}const _0x32955a=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x2fcd98}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x30af3e})}),'indices':_0x249632});return _0x32955a;}['createRenderingPrimitives'](_0x473c02,_0x256015,_0x3d83de,_0x51d890){const _0x34b19d=_0x553eab,_0x3dac97=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x256015),'primitiveType':Cesium$4[_0x34b19d(0x222)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x51d890['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x3ea82e=_0x34b19d;return _0x51d890['particlesTextures'][_0x3ea82e(0x24b)];},'postProcessingSpeed':function(){const _0x31b37d=_0x34b19d;return _0x51d890[_0x31b37d(0x18b)]['postProcessingSpeed'];},'colorTable':function(){return _0x3dac97['textures']['colorTable'];},'aspect':function(){return _0x473c02['drawingBufferWidth']/_0x473c02['drawingBufferHeight'];},'pixelSize':function(){return _0x3d83de['pixelSize'];},'lineWidth':function(){return _0x256015['lineWidth'];},'particleHeight':function(){return _0x256015['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x34b19d(0x173)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x34b19d(0x15f)],'uniformMap':{'segmentsColorTexture':function(){const _0x36f093=_0x34b19d;return _0x3dac97[_0x36f093(0x210)][_0x36f093(0x199)];},'segmentsDepthTexture':function(){const _0x31569a=_0x34b19d;return _0x3dac97[_0x31569a(0x210)][_0x31569a(0x1d5)];},'currentTrailsColor':function(){const _0x92bb15=_0x34b19d;return _0x3dac97[_0x92bb15(0x21c)][_0x92bb15(0x183)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x421795=_0x34b19d;return _0x3dac97['framebuffers']['currentTrails'][_0x421795(0x193)];},'fadeOpacity':function(){return _0x256015['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x34b19d(0x235)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x34b19d(0x167))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x52f5d1=_0x34b19d,_0x51010b=_0x3dac97[_0x52f5d1(0x21c)]['currentTrails'];_0x3dac97[_0x52f5d1(0x21c)]['currentTrails']=_0x3dac97['framebuffers']['nextTrails'],_0x3dac97['framebuffers']['nextTrails']=_0x51010b,_0x3dac97[_0x52f5d1(0x1d2)]['trails']['commandToExecute'][_0x52f5d1(0x21a)]=_0x3dac97['framebuffers']['nextTrails'],_0x3dac97['primitives']['trails']['clearCommand'][_0x52f5d1(0x21a)]=_0x3dac97['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x34b19d(0x1fb),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x34b19d(0x179)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x1f754b=_0x34b19d;return _0x3dac97[_0x1f754b(0x21c)][_0x1f754b(0x1f8)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x3dac97['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x34b19d(0x167))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x34b19d(0x167))]({'defines':[_0x34b19d(0x16f)],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x34b19d(0x233)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x553eab(0x236),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x553eab(0x1b0)];class ParticlesComputing{constructor(_0x323c0d,_0xb4d3b3,_0x36414b,_0x3385be){const _0x25d03c=_0x553eab;this['data']=_0xb4d3b3,this[_0x25d03c(0x24d)](_0x323c0d,_0xb4d3b3),this[_0x25d03c(0x247)](_0x323c0d,_0x36414b,_0x3385be),this['createComputingPrimitives'](_0xb4d3b3,_0x36414b,_0x3385be);}[_0x553eab(0x24d)](_0x5ac50a,_0x2a4a78){const _0x54f380=_0x553eab,_0x302914={'context':_0x5ac50a,'width':_0x2a4a78['dimensions'][_0x54f380(0x1c4)],'height':_0x2a4a78['dimensions']['lat']*(_0x2a4a78['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x54f380(0x24c)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x54f380(0x1bb))]({'minificationFilter':Cesium$3[_0x54f380(0x1e8)][_0x54f380(0x1f4)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x54f380(0x1f4)]})};this[_0x54f380(0x219)]={'U':Util['createTexture'](_0x302914,_0x2a4a78['U']['array']),'V':Util['createTexture'](_0x302914,_0x2a4a78['V']['array'])};}['createParticlesTextures'](_0x10c999,_0x41ad7d,_0x5c3a9a){const _0x387d03=_0x553eab,_0x448ec9={'context':_0x10c999,'width':_0x41ad7d['particlesTextureSize'],'height':_0x41ad7d['particlesTextureSize'],'pixelFormat':Cesium$3[_0x387d03(0x234)][_0x387d03(0x1fe)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x387d03(0x1bb))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0xb0e9c7=this['randomizeParticles'](_0x41ad7d[_0x387d03(0x206)],_0x5c3a9a),_0x2530b6=new Float32Array(0x4*_0x41ad7d['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x448ec9),'currentParticlesPosition':Util['createTexture'](_0x448ec9,_0xb0e9c7),'nextParticlesPosition':Util['createTexture'](_0x448ec9,_0xb0e9c7),'currentParticlesSpeed':Util['createTexture'](_0x448ec9,_0x2530b6),'nextParticlesSpeed':Util['createTexture'](_0x448ec9,_0x2530b6),'postProcessingPosition':Util['createTexture'](_0x448ec9,_0xb0e9c7),'postProcessingSpeed':Util['createTexture'](_0x448ec9,_0x2530b6)};}['randomizeParticles'](_0x192ccb,_0x10bc3c){const _0x258d75=_0x553eab,_0x8a003e=new Float32Array(0x4*_0x192ccb);for(let _0x392832=0x0;_0x392832<_0x192ccb;_0x392832++){_0x8a003e[0x4*_0x392832]=Cesium$3['Math']['randomBetween'](_0x10bc3c[_0x258d75(0x15a)]['x'],_0x10bc3c['lonRange']['y']),_0x8a003e[0x4*_0x392832+0x1]=Cesium$3[_0x258d75(0x19b)][_0x258d75(0x1f5)](_0x10bc3c['latRange']['x'],_0x10bc3c[_0x258d75(0x186)]['y']),_0x8a003e[0x4*_0x392832+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x258d75(0x178)]['min'],this['data']['lev']['max']),_0x8a003e[0x4*_0x392832+0x3]=0x0;}return _0x8a003e;}[_0x553eab(0x159)](){const _0x1479b2=_0x553eab;Object['keys'](this['particlesTextures'])[_0x1479b2(0x204)](_0x5566b4=>{const _0x52328d=_0x1479b2;this[_0x52328d(0x18b)][_0x5566b4]['destroy']();});}[_0x553eab(0x1c8)](_0x56abd0,_0x312f76,_0x151397){const _0x5d6731=_0x553eab,_0x296bb9=new Cesium$3['Cartesian3'](_0x56abd0['dimensions']['lon'],_0x56abd0['dimensions'][_0x5d6731(0x1e9)],_0x56abd0[_0x5d6731(0x245)][_0x5d6731(0x178)]),_0x2435db=new Cesium$3['Cartesian3'](_0x56abd0['lon'][_0x5d6731(0x19a)],_0x56abd0[_0x5d6731(0x1e9)]['min'],_0x56abd0['lev'][_0x5d6731(0x19a)]),_0x379a31=new Cesium$3['Cartesian3'](_0x56abd0['lon']['max'],_0x56abd0[_0x5d6731(0x1e9)]['max'],_0x56abd0['lev']['max']),_0x54b547=new Cesium$3['Cartesian3']((_0x379a31['x']-_0x2435db['x'])/(_0x296bb9['x']-0x1),(_0x379a31['y']-_0x2435db['y'])/(_0x296bb9['y']-0x1),_0x296bb9['z']>0x1?(_0x379a31['z']-_0x2435db['z'])/(_0x296bb9['z']-0x1):0x1),_0x10bb9f=new Cesium$3['Cartesian2'](_0x56abd0['U'][_0x5d6731(0x19a)],_0x56abd0['U'][_0x5d6731(0x217)]),_0x487714=new Cesium$3['Cartesian2'](_0x56abd0['V']['min'],_0x56abd0['V']['max']),_0x3786e8=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x3786e8['windTextures']['U'];},'V':function(){const _0x3205ef=_0x5d6731;return _0x3786e8[_0x3205ef(0x219)]['V'];},'currentParticlesPosition':function(){const _0x3ef781=_0x5d6731;return _0x3786e8[_0x3ef781(0x18b)]['currentParticlesPosition'];},'dimension':function(){return _0x296bb9;},'minimum':function(){return _0x2435db;},'maximum':function(){return _0x379a31;},'interval':function(){return _0x54b547;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x5d6731(0x23f)],'preExecute':function(){const _0x2ed0ad=_0x5d6731;_0x3786e8['primitives']['getWind']['commandToExecute'][_0x2ed0ad(0x1c7)]=_0x3786e8['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x5d6731(0x194),'uniformMap':{'currentParticlesSpeed':function(){return _0x3786e8['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x3786e8['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x10bb9f;},'vSpeedRange':function(){return _0x487714;},'pixelSize':function(){return _0x151397['pixelSize'];},'speedFactor':function(){return _0x312f76['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x5d6731(0x18b)][_0x5d6731(0x184)],'preExecute':function(){const _0x5d7f4e=_0x5d6731,_0x205a3a=_0x3786e8['particlesTextures']['currentParticlesSpeed'];_0x3786e8['particlesTextures']['currentParticlesSpeed']=_0x3786e8[_0x5d7f4e(0x18b)]['postProcessingSpeed'],_0x3786e8['particlesTextures'][_0x5d7f4e(0x15e)]=_0x205a3a,_0x3786e8['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x3786e8['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x5d6731(0x194),'uniformMap':{'currentParticlesPosition':function(){return _0x3786e8['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x3786e8['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x5d6731(0x167))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x5d6731(0x1ab)],'preExecute':function(){const _0x1601af=_0x5d6731,_0x37eae2=_0x3786e8['particlesTextures'][_0x1601af(0x1e7)];_0x3786e8['particlesTextures']['currentParticlesPosition']=_0x3786e8['particlesTextures']['postProcessingPosition'],_0x3786e8['particlesTextures']['postProcessingPosition']=_0x37eae2,_0x3786e8['primitives'][_0x1601af(0x197)][_0x1601af(0x17b)][_0x1601af(0x1c7)]=_0x3786e8['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x3546c5=_0x5d6731;return _0x3786e8[_0x3546c5(0x18b)]['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x3786e8['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){const _0x2b837e=_0x5d6731;return _0x151397[_0x2b837e(0x15a)];},'latRange':function(){return _0x151397['latRange'];},'randomCoefficient':function(){const _0xb28e18=Math['random']();return _0xb28e18;},'dropRate':function(){return _0x312f76['dropRate'];},'dropRateBump':function(){return _0x312f76['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x5d6731(0x24b)],'preExecute':function(){const _0x3f3680=_0x5d6731;_0x3786e8['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x3786e8[_0x3f3680(0x18b)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x3786e8['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x89986c=_0x5d6731;return _0x3786e8[_0x89986c(0x18b)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x5ab78e=_0x5d6731;_0x3786e8[_0x5ab78e(0x1d2)]['postProcessingSpeed']['commandToExecute'][_0x5ab78e(0x1c7)]=_0x3786e8['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];function _0x4094(){const _0x3da626=['1531490eGmIXs','add','particlesTextures','lng','update','strokeStyle','tlng','_onMouseDownEvent','2083102wwpFtK','UNSIGNED_BYTE','depthTexture','Compute','BufferUsage','viewport','updatePosition','fadeOpacity','segmentsColor','min','Math','width','scene','drawingBufferHeight','none','TWO_PI','colors','udata','style','ymin','canvasHeight','color','vertexShaderSource','12530ALVUad','getUVByXY','fromDegrees','nextParticlesPosition','levmax','initWorker','layer','ymax','Cesium','SceneMode','_onMap_preRenderEvent','data','Appearance','speedRate','2846280HQgHnF','worker','_bilinearInterpolation','updateSpeed','SCENE3D','Sampler','particles','viewerParameters','camera','setOptions','_setOptionsHook','Texture','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','particleSystem','lon','preExecute','isDestroyed','outputTexture','createComputingPrimitives','rgb(206,255,255)','moveTo','Pass','pointerEvents','height','xmax','wind','particlesNumber','mouseHidden','primitives','updateViewerParameters','_onMouseMoveEvent','segmentsDepth','windData','clientHeight','getWind','off','refreshTimer','clear','_onMapWhellEvent','array','umin','defined','vertexArray','fromCssColorString','hidden','geometry','canvasContext','toDegrees','_map','currentParticlesPosition','TextureMinificationFilter','lat','uniformMap','getUVByPoint','_calcUV','mod','removeAll','requestAnimationFrame','onmessage','toRadians','ellipsoid','applyViewerParameters','NEAREST','randomBetween','ComponentDatatype','mouseUp','nextTrails','SceneTransforms','_onMouseUpEvent','Draw','fixedHeight','options','RGBA','createCommand','register','source','VertexArray','lineWidth','forEach','_maxAge','maxParticles','fragmentShaderSource','0px','bindEvent','xmin','LINEAR','canvas','createRenderingTextures','age','_removedHook','textures','commandType','setData','toGridXY','get','bind','DEPTH_COMPONENT','max','addPrimitives','windTextures','framebuffer','_calc_speedRate','framebuffers','clientWidth','wgs84ToWindowCoordinates','frameTime','2513367elaQBl','1255364TOmEnn','PrimitiveType','particlesTextureSize','resize','context','east','CanvasWindField','visibility','RenderState','rawRenderState','mouse_move','FLOAT','particlesComputing','reverseY','_addedHook','animateFrame','1DzHVIv','abs','createRawRenderState','PixelFormat','DISABLE_GL_POSITION_LOG_DEPTH','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','3757197BpvJNQ','Cartesian3','auto','postMessage','default','init','Color','pointer-events','particlesWind','west','create','2814nGYgQu','primitiveType','globeBoundingSphere','dimensions','getExtent','createParticlesTextures','show','_randomParticle','_pointerEvents','postProcessingPosition','PixelDatatype','createWindTextures','EllipsoidalOccluder','EventType','length','mouse_down','destroyParticlesTextures','lonRange','STATIC_DRAW','pow','clearCommand','postProcessingSpeed','TRIANGLES','push','destroy','mouseDown','sqrt','GeometryAttributes','drawingBufferWidth','createRenderingFramebuffers','ShaderSource','south','tlat','grid','Matrix4','24bIkIHJ','attributeLocations','maxAge','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','WindLayer','particlesRendering','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','segments','umax','currentTrailsColor','wheel','mouseMove','lev','getFullscreenQuad','globalCompositeOperation','commandToExecute','floor','cols','keys','log','redraw','clearFramebuffers','blending','currentTrails','nextParticlesSpeed','rows','latRange','speed','windField'];_0x4094=function(){return _0x3da626;};return _0x4094();}class ParticleSystem{constructor(_0x196e14,_0x3adea9,_0x518695,_0xe55909){const _0x4be605=_0x553eab;this['context']=_0x196e14,_0x3adea9={..._0x3adea9},_0x3adea9['udata']&&_0x3adea9['vdata']&&(_0x3adea9['dimensions']={},_0x3adea9['dimensions']['lon']=_0x3adea9['cols'],_0x3adea9[_0x4be605(0x245)]['lat']=_0x3adea9['rows'],_0x3adea9['dimensions']['lev']=_0x3adea9[_0x4be605(0x178)]||0x1,_0x3adea9['lon']={},_0x3adea9['lon']['min']=_0x3adea9['xmin'],_0x3adea9[_0x4be605(0x1c4)]['max']=_0x3adea9[_0x4be605(0x1ce)],_0x3adea9['lat']={},_0x3adea9['lat'][_0x4be605(0x19a)]=_0x3adea9['ymin'],_0x3adea9['lat']['max']=_0x3adea9[_0x4be605(0x1af)],_0x3adea9['lev']={},_0x3adea9[_0x4be605(0x178)]['min']=_0x3adea9['levmin']??0x1,_0x3adea9['lev']['max']=_0x3adea9[_0x4be605(0x1ac)]??0x1,_0x3adea9['U']={},_0x3adea9['U'][_0x4be605(0x1dd)]=new Float32Array(_0x3adea9[_0x4be605(0x1a2)]),_0x3adea9['U']['min']=_0x3adea9[_0x4be605(0x1de)]??Math['min'](..._0x3adea9['udata']),_0x3adea9['U']['max']=_0x3adea9[_0x4be605(0x174)]??Math['max'](..._0x3adea9[_0x4be605(0x1a2)]),_0x3adea9['V']={},_0x3adea9['V']['array']=new Float32Array(_0x3adea9['vdata']),_0x3adea9['V']['min']=_0x3adea9['vmin']??Math['min'](..._0x3adea9['vdata']),_0x3adea9['V'][_0x4be605(0x217)]=_0x3adea9['vmax']??Math[_0x4be605(0x217)](..._0x3adea9['vdata'])),this['data']=_0x3adea9,this['options']=_0x518695,this['viewerParameters']=_0xe55909,this[_0x4be605(0x22d)]=new ParticlesComputing(this[_0x4be605(0x225)],this[_0x4be605(0x1b3)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x4be605(0x1b3)],this[_0x4be605(0x1fd)],this['viewerParameters'],this[_0x4be605(0x22d)]);}['canvasResize'](_0x32727c){const _0x14039c=_0x553eab;this[_0x14039c(0x22d)][_0x14039c(0x159)](),Object['keys'](this['particlesComputing'][_0x14039c(0x219)])[_0x14039c(0x204)](_0x6ae710=>{const _0x3e1677=_0x14039c;this['particlesComputing'][_0x3e1677(0x219)][_0x6ae710]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this[_0x14039c(0x171)]['framebuffers'])[_0x14039c(0x204)](_0x267daa=>{this['particlesRendering']['framebuffers'][_0x267daa]['destroy']();}),this['context']=_0x32727c,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x14039c(0x1fd)],this[_0x14039c(0x1bd)],this['particlesComputing']);}[_0x553eab(0x181)](){const _0x14cc43=_0x553eab,_0x844e87=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x14cc43(0x23d))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x14cc43(0x1cb)]['OPAQUE']});Object[_0x14cc43(0x17e)](this['particlesRendering']['framebuffers'])['forEach'](_0x1b70e8=>{_0x844e87['framebuffer']=this['particlesRendering']['framebuffers'][_0x1b70e8],_0x844e87['execute'](this['context']);});}['refreshParticles'](_0x3001f8){const _0x23a60f=_0x553eab;this[_0x23a60f(0x181)](),this[_0x23a60f(0x22d)][_0x23a60f(0x159)](),this[_0x23a60f(0x22d)]['createParticlesTextures'](this['context'],this[_0x23a60f(0x1fd)],this[_0x23a60f(0x1bd)]);if(_0x3001f8){var _0x10ef13,_0x23ff04;const _0x26a678=this['particlesRendering']['createSegmentsGeometry'](this['options']);this[_0x23a60f(0x171)]['primitives'][_0x23a60f(0x173)]['geometry']=_0x26a678;const _0x247600=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x26a678,'attributeLocations':this['particlesRendering']['primitives'][_0x23a60f(0x173)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x10ef13=this['particlesRendering'][_0x23a60f(0x1d2)])!==null&&_0x10ef13!==void 0x0&&(_0x23ff04=_0x10ef13['segments'])!==null&&_0x23ff04!==void 0x0&&_0x23ff04[_0x23a60f(0x17b)]&&(this['particlesRendering']['primitives']['segments'][_0x23a60f(0x17b)][_0x23a60f(0x1e0)]=_0x247600);}}['setOptions'](_0x3bae9d){const _0x4af571=_0x553eab;let _0x5834bd=![];this[_0x4af571(0x1fd)]['maxParticles']!==_0x3bae9d['maxParticles']&&(_0x5834bd=!![]),Object['keys'](_0x3bae9d)[_0x4af571(0x204)](_0x4f7ac9=>{this['options'][_0x4f7ac9]=_0x3bae9d[_0x4f7ac9];}),this['refreshParticles'](_0x5834bd);}['applyViewerParameters'](_0x4b6636){const _0x501ae3=_0x553eab;Object['keys'](_0x4b6636)[_0x501ae3(0x204)](_0x11c912=>{const _0x1af4d3=_0x501ae3;this[_0x1af4d3(0x1bd)][_0x11c912]=_0x4b6636[_0x11c912];}),this['refreshParticles'](![]);}['destroy'](){const _0x31c23a=_0x553eab;clearTimeout(this['canrefresh']),this[_0x31c23a(0x22d)]['destroyParticlesTextures'](),Object['keys'](this[_0x31c23a(0x22d)]['windTextures'])['forEach'](_0x5e507c=>{const _0x5cdcb1=_0x31c23a;this['particlesComputing']['windTextures'][_0x5e507c][_0x5cdcb1(0x161)]();}),this[_0x31c23a(0x171)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x31c23a(0x21c)])['forEach'](_0x1b9935=>{const _0x4ca114=_0x31c23a;this['particlesRendering'][_0x4ca114(0x21c)][_0x1b9935]['destroy']();});for(const _0x130dca in this){delete this[_0x130dca];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x553eab(0x1ae)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x553eab(0x1c9)]};class WindLayer extends BaseLayer$1{constructor(_0x29e53f={}){_0x29e53f={...DEF_OPTIONS,..._0x29e53f},super(_0x29e53f),this['_setOptionsHook'](_0x29e53f);}get['layer'](){const _0x521f2f=_0x553eab;return this[_0x521f2f(0x1d2)];}get['data'](){return this['_data'];}set[_0x553eab(0x1b3)](_0x4ceed7){this['setData'](_0x4ceed7);}get[_0x553eab(0x1a1)](){const _0x2e2ee9=_0x553eab;return this[_0x2e2ee9(0x1fd)]['colors'];}set['colors'](_0x68968f){const _0x406db0=_0x553eab;this['options']['colors']=_0x68968f,this['particleSystem']&&this[_0x406db0(0x1c3)]['setOptions']({'colors':_0x68968f}),this['resize']();}['_mountedHook'](){}[_0x553eab(0x22f)](){const _0x31cd31=_0x553eab;this['scene']=this['_map']['scene'],this['camera']=this[_0x31cd31(0x1e6)][_0x31cd31(0x1be)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this[_0x31cd31(0x1e6)]['scene'][_0x31cd31(0x1d2)]['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1[_0x31cd31(0x238)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x31cd31(0x224),this['resize'][_0x31cd31(0x215)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x31cd31(0x1e6)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x31cd31(0x1e6)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x31cd31(0x190)],this),this[_0x31cd31(0x1e6)]['on'](mars3d__namespace['EventType'][_0x31cd31(0x1f7)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x31cd31(0x1d4)],this),this['_data']&&this[_0x31cd31(0x212)](this['_data']);}[_0x553eab(0x20f)](){const _0x542f3a=_0x553eab;window['removeEventListener']('resize',this[_0x542f3a(0x224)]),this['_map'][_0x542f3a(0x1d9)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this[_0x542f3a(0x1e6)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x542f3a(0x1e6)][_0x542f3a(0x1d9)](mars3d__namespace[_0x542f3a(0x156)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x542f3a(0x1d9)](mars3d__namespace['EventType'][_0x542f3a(0x1f7)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x542f3a(0x156)][_0x542f3a(0x177)],this['_onMouseMoveEvent'],this),this['primitives'][_0x542f3a(0x1ee)](),this['_map'][_0x542f3a(0x19d)]['primitives']['remove'](this['primitives']);}['resize'](){const _0x192558=_0x553eab;if(!this['show']||!this['particleSystem'])return;this[_0x192558(0x1d2)]['show']=![],this[_0x192558(0x1d2)][_0x192558(0x1ee)](),this['_map']['once'](mars3d__namespace[_0x192558(0x156)]['preRender'],this[_0x192558(0x1b2)],this);}['_onMap_preRenderEvent'](_0x4011ab){const _0x3ee013=_0x553eab;this[_0x3ee013(0x1c3)]['canvasResize'](this[_0x3ee013(0x19d)][_0x3ee013(0x225)]),this['addPrimitives'](),this[_0x3ee013(0x1d2)][_0x3ee013(0x248)]=!![];}['_onMapWhellEvent'](_0x293486){const _0x1f7fce=_0x553eab;clearTimeout(this[_0x1f7fce(0x1da)]);if(!this[_0x1f7fce(0x248)]||!this['particleSystem'])return;this[_0x1f7fce(0x1d2)][_0x1f7fce(0x248)]=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x5dec4f){this['mouse_down']=!![];}[_0x553eab(0x1d4)](_0x168501){const _0x128540=_0x553eab;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives'][_0x128540(0x248)]=![],this['mouse_move']=!![]);}[_0x553eab(0x1fa)](_0x2dbcfb){const _0x52dfdc=_0x553eab;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this[_0x52dfdc(0x22b)]&&this['redraw'](),this['primitives']['show']=!![],this[_0x52dfdc(0x158)]=![],this['mouse_move']=![];}['redraw'](){const _0x4c5dbc=_0x553eab;if(!this['_map']||!this['show'])return;this[_0x4c5dbc(0x1d3)](),this[_0x4c5dbc(0x1c3)][_0x4c5dbc(0x1f3)](this['viewerParameters']),this[_0x4c5dbc(0x1d2)][_0x4c5dbc(0x248)]=!![];}['setData'](_0x4ec204){const _0x5afd0a=_0x553eab;this['_data']=_0x4ec204,this['particleSystem']&&this['particleSystem'][_0x5afd0a(0x161)](),this[_0x5afd0a(0x1c3)]=new ParticleSystem(this['scene'][_0x5afd0a(0x225)],_0x4ec204,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x518dd9,_0x58f9d1){if(_0x518dd9)for(const _0x41a695 in _0x518dd9){this[_0x41a695]=_0x518dd9[_0x41a695];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x4ddf1f=_0x553eab,_0x3affe6=Math['ceil'](Math[_0x4ddf1f(0x163)](this[_0x4ddf1f(0x1d0)]));return this['particlesNumber']=_0x3affe6*_0x3affe6,{'particlesTextureSize':_0x3affe6,'maxParticles':this[_0x4ddf1f(0x1d0)],'particleHeight':this[_0x4ddf1f(0x1fc)],'fadeOpacity':this[_0x4ddf1f(0x198)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x4ddf1f(0x1a1)]};}[_0x553eab(0x218)](){const _0x6b2717=_0x553eab;this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x6b2717(0x1d2)][_0x6b2717(0x1d8)]),this['primitives']['add'](this['particleSystem'][_0x6b2717(0x22d)]['primitives'][_0x6b2717(0x1b9)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x6b2717(0x1d2)]['updatePosition']),this[_0x6b2717(0x1d2)][_0x6b2717(0x18a)](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem'][_0x6b2717(0x22d)]['primitives']['postProcessingSpeed']),this['primitives']['add'](this[_0x6b2717(0x1c3)][_0x6b2717(0x171)][_0x6b2717(0x1d2)]['segments']),this[_0x6b2717(0x1d2)][_0x6b2717(0x18a)](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives']['add'](this[_0x6b2717(0x1c3)]['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x28f49f=_0x553eab;let _0x12bbf8=this['camera']['computeViewRectangle'](this[_0x28f49f(0x19d)]['globe'][_0x28f49f(0x1f2)]);if(!_0x12bbf8){const _0x53df91=this['_map'][_0x28f49f(0x246)]();_0x12bbf8=Cesium$1['Rectangle'][_0x28f49f(0x1aa)](_0x53df91[_0x28f49f(0x20a)],_0x53df91['ymin'],_0x53df91['xmax'],_0x53df91['ymax']);}const _0x4fb536=Util['viewRectangleToLonLatRange'](_0x12bbf8);this[_0x28f49f(0x1bd)][_0x28f49f(0x15a)]['x']=_0x4fb536['lon']['min'],this[_0x28f49f(0x1bd)]['lonRange']['y']=_0x4fb536[_0x28f49f(0x1c4)][_0x28f49f(0x217)],this['viewerParameters'][_0x28f49f(0x186)]['x']=_0x4fb536['lat']['min'],this['viewerParameters'][_0x28f49f(0x186)]['y']=_0x4fb536['lat']['max'];const _0x1cb52d=this['camera']['getPixelSize'](this[_0x28f49f(0x244)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x1cb52d>0x0&&(this['viewerParameters']['pixelSize']=_0x1cb52d);}}mars3d__namespace['LayerUtil']['register'](_0x553eab(0x1cf),WindLayer),mars3d__namespace[_0x553eab(0x1ae)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x2115ec=_0x553eab;this['lng']=null,this[_0x2115ec(0x1e9)]=null,this['tlng']=null,this['tlat']=null,this['age']=null,this[_0x2115ec(0x187)]=null;}['destroy'](){for(const _0x31cb01 in this){delete this[_0x31cb01];}}}class CanvasWindField{constructor(_0x2cc254){const _0x3146d7=_0x553eab;this[_0x3146d7(0x1bf)](_0x2cc254);}get[_0x553eab(0x1b5)](){return this['_speedRate'];}set['speedRate'](_0x22349f){this['_speedRate']=(0x64-(_0x22349f>0x63?0x63:_0x22349f))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x3efcc2){const _0x659a53=_0x553eab;this[_0x659a53(0x205)]=_0x3efcc2;}['setOptions'](_0x47035f){const _0xf98309=_0x553eab;this['options']=_0x47035f,this['maxAge']=_0x47035f['maxAge']||0x78,this['speedRate']=_0x47035f['speedRate']||0x32,this['particles']=[];const _0x598baf=_0x47035f['particlesNumber']||0x1000;for(let _0x2530a0=0x0;_0x2530a0<_0x598baf;_0x2530a0++){const _0x1c60b3=this[_0xf98309(0x249)](new CanvasParticle());this['particles']['push'](_0x1c60b3);}}['setDate'](_0x191f14){const _0x232cfe=_0x553eab;this[_0x232cfe(0x185)]=_0x191f14[_0x232cfe(0x185)],this[_0x232cfe(0x17d)]=_0x191f14['cols'],this['xmin']=_0x191f14[_0x232cfe(0x20a)],this['xmax']=_0x191f14['xmax'],this['ymin']=_0x191f14['ymin'],this['ymax']=_0x191f14['ymax'],this[_0x232cfe(0x16a)]=[];const _0xbe4a4c=_0x191f14[_0x232cfe(0x1a2)],_0x34466a=_0x191f14['vdata'];let _0x1695ce=![];_0xbe4a4c['length']===this[_0x232cfe(0x185)]&&_0xbe4a4c[0x0]['length']===this[_0x232cfe(0x17d)]&&(_0x1695ce=!![]);let _0x25bde3=0x0,_0xc5de67=null,_0x48db57=null;for(let _0x2f38a8=0x0;_0x2f38a8<this['rows'];_0x2f38a8++){_0xc5de67=[];for(let _0x5f1b2f=0x0;_0x5f1b2f<this['cols'];_0x5f1b2f++,_0x25bde3++){_0x1695ce?_0x48db57=this['_calcUV'](_0xbe4a4c[_0x2f38a8][_0x5f1b2f],_0x34466a[_0x2f38a8][_0x5f1b2f]):_0x48db57=this['_calcUV'](_0xbe4a4c[_0x25bde3],_0x34466a[_0x25bde3]),_0xc5de67[_0x232cfe(0x160)](_0x48db57);}this['grid']['push'](_0xc5de67);}this[_0x232cfe(0x1fd)]['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x6afce3=_0x553eab;delete this['rows'],delete this[_0x6afce3(0x17d)],delete this[_0x6afce3(0x20a)],delete this['xmax'],delete this[_0x6afce3(0x1a4)],delete this[_0x6afce3(0x1af)],delete this['grid'],delete this['particles'];}[_0x553eab(0x213)](_0x22ec26,_0xd1395f){const _0x86338f=_0x553eab,_0x81ebfd=(_0x22ec26-this['xmin'])/(this['xmax']-this['xmin'])*(this[_0x86338f(0x17d)]-0x1),_0x2c126b=(this[_0x86338f(0x1af)]-_0xd1395f)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x81ebfd,_0x2c126b];}[_0x553eab(0x1a9)](_0x36c1f0,_0x4970a4){const _0x1c175d=_0x553eab;if(_0x36c1f0<0x0||_0x36c1f0>=this['cols']||_0x4970a4>=this['rows'])return[0x0,0x0,0x0];const _0x5b6aa3=Math['floor'](_0x36c1f0),_0x44337b=Math[_0x1c175d(0x17c)](_0x4970a4);if(_0x5b6aa3===_0x36c1f0&&_0x44337b===_0x4970a4)return this[_0x1c175d(0x16a)][_0x4970a4][_0x36c1f0];const _0x380b45=_0x5b6aa3+0x1,_0x5b9916=_0x44337b+0x1,_0x4836e1=this['getUVByXY'](_0x5b6aa3,_0x44337b),_0x30a1e6=this['getUVByXY'](_0x380b45,_0x44337b),_0x11bc21=this[_0x1c175d(0x1a9)](_0x5b6aa3,_0x5b9916),_0x12da2f=this[_0x1c175d(0x1a9)](_0x380b45,_0x5b9916);let _0x3eb249=null;try{_0x3eb249=this['_bilinearInterpolation'](_0x36c1f0-_0x5b6aa3,_0x4970a4-_0x44337b,_0x4836e1,_0x30a1e6,_0x11bc21,_0x12da2f);}catch(_0x58130f){console[_0x1c175d(0x17f)](_0x36c1f0,_0x4970a4);}return _0x3eb249;}[_0x553eab(0x1b8)](_0x42cef7,_0x1d6476,_0x53389e,_0x14848d,_0x17f674,_0x51d443){const _0x42d270=_0x553eab,_0x59ac50=0x1-_0x42cef7,_0x20215e=0x1-_0x1d6476,_0xe67eee=_0x59ac50*_0x20215e,_0x24dc7c=_0x42cef7*_0x20215e,_0x483568=_0x59ac50*_0x1d6476,_0x1bad04=_0x42cef7*_0x1d6476,_0x100fed=_0x53389e[0x0]*_0xe67eee+_0x14848d[0x0]*_0x24dc7c+_0x17f674[0x0]*_0x483568+_0x51d443[0x0]*_0x1bad04,_0x3c5e5b=_0x53389e[0x1]*_0xe67eee+_0x14848d[0x1]*_0x24dc7c+_0x17f674[0x1]*_0x483568+_0x51d443[0x1]*_0x1bad04;return this[_0x42d270(0x1ec)](_0x100fed,_0x3c5e5b);}['_calcUV'](_0x204286,_0x372d57){const _0x400b73=_0x553eab;return[+_0x204286,+_0x372d57,Math[_0x400b73(0x163)](_0x204286*_0x204286+_0x372d57*_0x372d57)];}['getUVByPoint'](_0x29e6aa,_0x559e67){const _0x122db1=_0x553eab;if(!this['isInExtent'](_0x29e6aa,_0x559e67))return null;const _0x3cf319=this['toGridXY'](_0x29e6aa,_0x559e67),_0x49c705=this[_0x122db1(0x1a9)](_0x3cf319[0x0],_0x3cf319[0x1]);return _0x49c705;}['isInExtent'](_0x41cf33,_0x4a8444){const _0x354d36=_0x553eab;return _0x41cf33>=this['xmin']&&_0x41cf33<=this[_0x354d36(0x1ce)]&&_0x4a8444>=this['ymin']&&_0x4a8444<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x3c6e12=_0x553eab,_0x12be05=fRandomByfloat(this['xmin'],this[_0x3c6e12(0x1ce)]),_0x5aad0d=fRandomByfloat(this['ymin'],this[_0x3c6e12(0x1af)]);return{'lat':_0x5aad0d,'lng':_0x12be05};}['getParticles'](){const _0x175e03=_0x553eab;let _0x320e7d,_0x2f5c2c,_0xbfad3;for(let _0x50cfe1=0x0,_0xa24417=this['particles'][_0x175e03(0x157)];_0x50cfe1<_0xa24417;_0x50cfe1++){let _0x28dd7d=this['particles'][_0x50cfe1];_0x28dd7d['age']<=0x0&&(_0x28dd7d=this['_randomParticle'](_0x28dd7d));if(_0x28dd7d['age']>0x0){const _0x4e2c4a=_0x28dd7d['tlng'],_0x44a447=_0x28dd7d['tlat'];_0xbfad3=this[_0x175e03(0x1eb)](_0x4e2c4a,_0x44a447),_0xbfad3?(_0x320e7d=_0x4e2c4a+this[_0x175e03(0x21b)][0x0]*_0xbfad3[0x0],_0x2f5c2c=_0x44a447+this['_calc_speedRate'][0x1]*_0xbfad3[0x1],_0x28dd7d['lng']=_0x4e2c4a,_0x28dd7d[_0x175e03(0x1e9)]=_0x44a447,_0x28dd7d['tlng']=_0x320e7d,_0x28dd7d['tlat']=_0x2f5c2c,_0x28dd7d['speed']=_0xbfad3[0x2],_0x28dd7d['age']--):_0x28dd7d['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x23fcd6){const _0x5252cb=_0x553eab;let _0x329824,_0x31b6a3;for(let _0x432ef9=0x0;_0x432ef9<0x1e;_0x432ef9++){_0x329824=this['getRandomLatLng'](),_0x31b6a3=this[_0x5252cb(0x1eb)](_0x329824['lng'],_0x329824['lat']);if(_0x31b6a3&&_0x31b6a3[0x2]>0x0)break;}if(!_0x31b6a3)return _0x23fcd6;const _0x2f01c8=_0x329824['lng']+this['_calc_speedRate'][0x0]*_0x31b6a3[0x0],_0x37fb10=_0x329824[_0x5252cb(0x1e9)]+this['_calc_speedRate'][0x1]*_0x31b6a3[0x1];return _0x23fcd6['lng']=_0x329824[_0x5252cb(0x18c)],_0x23fcd6['lat']=_0x329824['lat'],_0x23fcd6[_0x5252cb(0x18f)]=_0x2f01c8,_0x23fcd6['tlat']=_0x37fb10,_0x23fcd6[_0x5252cb(0x20e)]=Math['round'](Math['random']()*this['maxAge']),_0x23fcd6[_0x5252cb(0x187)]=_0x31b6a3[0x2],_0x23fcd6;}[_0x553eab(0x161)](){for(const _0x283ecf in this){delete this[_0x283ecf];}}}function fRandomByfloat(_0x368bff,_0x51c2de){return _0x368bff+Math['random']()*(_0x51c2de-_0x368bff);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x2cb967={}){const _0x4742ee=_0x553eab;super(_0x2cb967),this[_0x4742ee(0x1c0)](_0x2cb967),this[_0x4742ee(0x20c)]=null,_0x2cb967['colors']&&_0x2cb967['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x2cb967));}['_setOptionsHook'](_0x314d88,_0x563482){const _0x4c213e=_0x553eab;this['frameTime']=0x3e8/(_0x314d88['frameRate']||0xa),this[_0x4c213e(0x24a)]=this[_0x4c213e(0x1fd)]['pointerEvents']??![],this[_0x4c213e(0x1a6)]=_0x314d88['color']||'#ffffff',this[_0x4c213e(0x203)]=_0x314d88['lineWidth']||0x1,this[_0x4c213e(0x1fc)]=_0x314d88['fixedHeight']??0x0,this['reverseY']=_0x314d88[_0x4c213e(0x22e)]??![],this['windField']&&this['windField']['setOptions'](_0x314d88);}get[_0x553eab(0x1ae)](){return this['canvas'];}get['canvasWidth'](){const _0x20b465=_0x553eab;return this[_0x20b465(0x1e6)][_0x20b465(0x19d)][_0x20b465(0x20c)][_0x20b465(0x21d)];}get['canvasHeight'](){const _0x2e7891=_0x553eab;return this[_0x2e7891(0x1e6)][_0x2e7891(0x19d)]['canvas'][_0x2e7891(0x1d7)];}get['pointerEvents'](){const _0x5403cb=_0x553eab;return this[_0x5403cb(0x24a)];}set['pointerEvents'](_0x1ed82c){const _0x351e90=_0x553eab;this['_pointerEvents']=_0x1ed82c;if(!this['canvas'])return;_0x1ed82c?this['canvas'][_0x351e90(0x1a3)]['pointer-events']='all':this['canvas'][_0x351e90(0x1a3)][_0x351e90(0x23e)]=_0x351e90(0x19f);}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0xbf2880){this['options']['particlesNumber']=_0xbf2880,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x8c3b7b){const _0x7ba145=_0x553eab;this['options']['speedRate']=_0x8c3b7b,this[_0x7ba145(0x188)]&&(this['windField']['speedRate']=_0x8c3b7b);}get['maxAge'](){const _0x1b25a7=_0x553eab;return this[_0x1b25a7(0x1fd)]['maxAge'];}set['maxAge'](_0xd316e8){const _0x58fdab=_0x553eab;this['options'][_0x58fdab(0x16e)]=_0xd316e8,this[_0x58fdab(0x188)]&&(this['windField']['maxAge']=_0xd316e8);}get['data'](){return this['windData'];}set[_0x553eab(0x1b3)](_0x223b94){this['setData'](_0x223b94);}['_showHook'](_0xa0aaa8){const _0x5b188b=_0x553eab;_0xa0aaa8?this[_0x5b188b(0x22f)]():(this[_0x5b188b(0x1d6)]&&(this[_0x5b188b(0x1fd)]['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x369ebd=_0x553eab;this[_0x369ebd(0x20c)]=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x369ebd(0x209)](),this[_0x369ebd(0x1fd)][_0x369ebd(0x1b3)]&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x3de4c6=_0x553eab;this['clear'](),this['unbindEvent'](),this['canvas']&&(this[_0x3de4c6(0x1e6)]['container']['removeChild'](this[_0x3de4c6(0x20c)]),delete this['canvas']);}['_createCanvas'](){const _0x531f8f=_0x553eab,_0x2496fb=mars3d__namespace['DomUtil'][_0x531f8f(0x241)]('canvas','mars3d-canvasWind',this['_map']['container']);return _0x2496fb['style']['position']='absolute',_0x2496fb['style']['top']=_0x531f8f(0x208),_0x2496fb['style']['left']='0px',_0x2496fb['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x2496fb['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x2496fb['style'][_0x531f8f(0x1cc)]=this[_0x531f8f(0x24a)]?_0x531f8f(0x239):_0x531f8f(0x19f),_0x2496fb['style']['zIndex']=this['options']['zIndex']??0x9,_0x2496fb['width']=this['_map'][_0x531f8f(0x19d)]['canvas']['clientWidth'],_0x2496fb['height']=this['_map']['scene']['canvas']['clientHeight'],_0x2496fb;}['resize'](){const _0xabc14e=_0x553eab;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene'][_0xabc14e(0x20c)]['clientWidth']+'px',this[_0xabc14e(0x20c)]['style']['height']=this['_map'][_0xabc14e(0x19d)]['canvas']['clientHeight']+'px',this['canvas'][_0xabc14e(0x19c)]=this['_map']['scene']['canvas']['clientWidth'],this[_0xabc14e(0x20c)]['height']=this[_0xabc14e(0x1e6)][_0xabc14e(0x19d)]['canvas']['clientHeight']);}['bindEvent'](){const _0x2e4079=_0x553eab,_0x1f9a71=this;let _0x2e0dad=Date['now']();(function _0x1b6b60(){const _0x528abe=_0xa3ae;_0x1f9a71['animateFrame']=window[_0x528abe(0x1ef)](_0x1b6b60);if(_0x1f9a71[_0x528abe(0x248)]&&_0x1f9a71['windField']){const _0x3a1b8d=Date['now'](),_0x2e0cbe=_0x3a1b8d-_0x2e0dad;_0x2e0cbe>_0x1f9a71[_0x528abe(0x21f)]&&(_0x2e0dad=_0x3a1b8d-_0x2e0cbe%_0x1f9a71['frameTime'],_0x1f9a71['update']());}}(),window['addEventListener']('resize',this[_0x2e4079(0x224)]['bind'](this),![]),this['mouse_down']=![],this[_0x2e4079(0x22b)]=![],this[_0x2e4079(0x1fd)][_0x2e4079(0x1d1)]&&(this[_0x2e4079(0x1e6)]['on'](mars3d__namespace['EventType'][_0x2e4079(0x176)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x2e4079(0x156)][_0x2e4079(0x162)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x2e4079(0x156)][_0x2e4079(0x1f7)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x2aa418=_0x553eab;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x2aa418(0x230)],window['removeEventListener']('resize',this[_0x2aa418(0x224)]),this['options']['mouseHidden']&&(this[_0x2aa418(0x1e6)][_0x2aa418(0x1d9)](mars3d__namespace['EventType'][_0x2aa418(0x176)],this[_0x2aa418(0x1dc)],this),this['_map'][_0x2aa418(0x1d9)](mars3d__namespace['EventType']['mouseDown'],this[_0x2aa418(0x190)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x2aa418(0x1f7)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x1bdf93){const _0x657078=_0x553eab;clearTimeout(this[_0x657078(0x1da)]);if(!this['show']||!this['canvas'])return;this['canvas'][_0x657078(0x1a3)][_0x657078(0x228)]=_0x657078(0x1e2),this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0x553eab(0x190)](_0x13947f){const _0x269c1c=_0x553eab;this['mouse_down']=!![],this[_0x269c1c(0x1e6)][_0x269c1c(0x1d9)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x269c1c(0x1e6)]['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x269c1c(0x1d4)],this);}['_onMouseMoveEvent'](_0x23e444){const _0x5bc1d6=_0x553eab;if(!this[_0x5bc1d6(0x248)]||!this['canvas'])return;this['mouse_down']&&(this[_0x5bc1d6(0x20c)]['style'][_0x5bc1d6(0x228)]='hidden',this['mouse_move']=!![]);}[_0x553eab(0x1fa)](_0x4656e4){const _0x23a364=_0x553eab;if(!this[_0x23a364(0x248)]||!this['canvas'])return;this['_map']['off'](mars3d__namespace[_0x23a364(0x156)]['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas'][_0x23a364(0x1a3)]['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x1f4606){const _0x2e721c=_0x553eab;this['clear'](),this['windData']=_0x1f4606,this['windField']['setDate'](_0x1f4606),this[_0x2e721c(0x180)]();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}['update'](){const _0xb8eccb=_0x553eab;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0xb8eccb(0x1b7)])this[_0xb8eccb(0x188)][_0xb8eccb(0x18d)]();else{const _0xc438=this['windField']['getParticles']();this['_drawLines'](_0xc438);}this['_updateIng']=![];}['_drawLines'](_0x53bbe7){const _0x530734=_0x553eab;this['canvasContext'][_0x530734(0x17a)]='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x530734(0x1a5)]),this[_0x530734(0x1e4)]['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x868382=this[_0x530734(0x1e6)]['scene']['mode']!==Cesium[_0x530734(0x1b1)][_0x530734(0x1ba)],_0x4512b5=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x35460e=0x0,_0x3d427b=_0x53bbe7[_0x530734(0x157)];_0x35460e<_0x3d427b;_0x35460e++){const _0x581b70=_0x53bbe7[_0x35460e],_0x468ec6=this['_tomap'](_0x581b70['lng'],_0x581b70['lat'],_0x581b70),_0x3dd857=this['_tomap'](_0x581b70[_0x530734(0x18f)],_0x581b70[_0x530734(0x169)],_0x581b70);if(!_0x468ec6||!_0x3dd857)continue;if(_0x868382&&Math[_0x530734(0x232)](_0x468ec6[0x0]-_0x3dd857[0x0])>=_0x4512b5)continue;this['canvasContext']['beginPath'](),this['canvasContext'][_0x530734(0x203)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x581b70['speed']),this['canvasContext']['moveTo'](_0x468ec6[0x0],_0x468ec6[0x1]),this[_0x530734(0x1e4)]['lineTo'](_0x3dd857[0x0],_0x3dd857[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x530734(0x18e)]=this[_0x530734(0x1a6)];for(let _0x20e9a0=0x0,_0x1ce152=_0x53bbe7['length'];_0x20e9a0<_0x1ce152;_0x20e9a0++){const _0x362b2d=_0x53bbe7[_0x20e9a0],_0x2f8f47=this['_tomap'](_0x362b2d[_0x530734(0x18c)],_0x362b2d['lat'],_0x362b2d),_0x431413=this['_tomap'](_0x362b2d['tlng'],_0x362b2d[_0x530734(0x169)],_0x362b2d);if(!_0x2f8f47||!_0x431413)continue;if(_0x868382&&Math['abs'](_0x2f8f47[0x0]-_0x431413[0x0])>=_0x4512b5)continue;this['canvasContext'][_0x530734(0x1ca)](_0x2f8f47[0x0],_0x2f8f47[0x1]),this['canvasContext']['lineTo'](_0x431413[0x0],_0x431413[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x278858,_0x449dee,_0x11545d){const _0xc99fe2=_0x553eab,_0x292fbd=Cesium['Cartesian3']['fromDegrees'](_0x278858,_0x449dee,this['fixedHeight']),_0x2da527=this['_map']['scene'];if(_0x2da527['mode']===Cesium['SceneMode'][_0xc99fe2(0x1ba)]){const _0x5961f6=new Cesium[(_0xc99fe2(0x24e))](_0x2da527['globe']['ellipsoid'],_0x2da527[_0xc99fe2(0x1be)]['positionWC']),_0x2ed599=_0x5961f6['isPointVisible'](_0x292fbd);if(!_0x2ed599)return _0x11545d[_0xc99fe2(0x20e)]=0x0,null;}const _0xa04f7a=Cesium[_0xc99fe2(0x1f9)][_0xc99fe2(0x21e)](this['_map']['scene'],_0x292fbd);return _0xa04f7a?[_0xa04f7a['x'],_0xa04f7a['y']]:null;}['clear'](){const _0x21db9a=_0x553eab;this['windField']['clear'](),delete this[_0x21db9a(0x1d6)];}[_0x553eab(0x1ad)](){const _0x1a55aa=_0x553eab;this['worker']=new Worker(this[_0x1a55aa(0x1fd)]['worker']),this['worker'][_0x1a55aa(0x1f0)]=_0x1a2f05=>{const _0x4696c8=_0x1a55aa;this['_drawLines'](_0x1a2f05['data'][_0x4696c8(0x1bc)]),this['_updateIng2']=![];},this['windField']={'init':_0x4dcc9c=>{const _0x45f46d=_0x1a55aa;this['worker']['postMessage']({'type':_0x45f46d(0x23c),'options':_0x4dcc9c});},'setOptions':_0x4f0a82=>{this['worker']['postMessage']({'type':'setOptions','options':_0x4f0a82});},'setDate':_0xba517e=>{this['worker']['postMessage']({'type':'setDate','data':_0xba517e});},'update':()=>{if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x5865d5=_0x1a55aa;this['worker'][_0x5865d5(0x23a)]({'type':_0x5865d5(0x1db)});}},this[_0x1a55aa(0x188)]['init'](this['options']);}}mars3d__namespace['LayerUtil'][_0x553eab(0x200)]('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x553eab(0x227)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports[_0x553eab(0x170)]=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
