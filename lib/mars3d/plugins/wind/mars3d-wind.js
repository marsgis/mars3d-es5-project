/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.5
 * 编译日期：2024-02-25 10:20:02
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x4f2d27=_0x5a2c;(function(_0x399384,_0x156b43){const _0x2a1465=_0x5a2c,_0xdc2af6=_0x399384();while(!![]){try{const _0x449223=parseInt(_0x2a1465(0x151))/0x1*(parseInt(_0x2a1465(0xcc))/0x2)+parseInt(_0x2a1465(0x11f))/0x3*(-parseInt(_0x2a1465(0x122))/0x4)+-parseInt(_0x2a1465(0x144))/0x5*(-parseInt(_0x2a1465(0x184))/0x6)+-parseInt(_0x2a1465(0x138))/0x7*(parseInt(_0x2a1465(0x129))/0x8)+-parseInt(_0x2a1465(0x141))/0x9+parseInt(_0x2a1465(0x12b))/0xa+parseInt(_0x2a1465(0x17a))/0xb;if(_0x449223===_0x156b43)break;else _0xdc2af6['push'](_0xdc2af6['shift']());}catch(_0xd5d452){_0xdc2af6['push'](_0xdc2af6['shift']());}}}(_0x4f9a,0xd7b57));function _interopNamespace(_0x3f0857){const _0x5a0128=_0x5a2c;if(_0x3f0857&&_0x3f0857[_0x5a0128(0xe9)])return _0x3f0857;var _0x1a2366=Object[_0x5a0128(0x139)](null);return _0x3f0857&&Object['keys'](_0x3f0857)['forEach'](function(_0x8529d6){const _0x2a0f46=_0x5a0128;if(_0x8529d6!=='default'){var _0x5cba3c=Object[_0x2a0f46(0xbe)](_0x3f0857,_0x8529d6);Object['defineProperty'](_0x1a2366,_0x8529d6,_0x5cba3c['get']?_0x5cba3c:{'enumerable':!![],'get':function(){return _0x3f0857[_0x8529d6];}});}}),_0x1a2366['default']=_0x3f0857,_0x1a2366;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x23c53b,_0x571c5c){const _0x3e8b15=_0x23c53b*Math['cos'](Cesium$7['Math']['toRadians'](_0x571c5c));return _0x3e8b15;}function getV(_0x196cbc,_0x10890f){const _0x327e48=_0x5a2c,_0x571f57=_0x196cbc*Math['sin'](Cesium$7[_0x327e48(0xff)]['toRadians'](_0x10890f));return _0x571f57;}function getSpeed(_0x34b592,_0x4b58ec){const _0x5928c7=_0x5a2c,_0x1ce6a4=Math[_0x5928c7(0xf2)](Math['pow'](_0x34b592,0x2)+Math['pow'](_0x4b58ec,0x2));return _0x1ce6a4;}function getDirection(_0x3e94a5,_0xace7bf){const _0x5550e0=_0x5a2c;let _0x24c161=Cesium$7['Math']['toDegrees'](Math[_0x5550e0(0x193)](_0xace7bf,_0x3e94a5));return _0x24c161+=_0x24c161<0x0?0x168:0x0,_0x24c161;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x41afa3){const _0x35548c=_0x5a2c;this['commandType']=_0x41afa3['commandType'],this['geometry']=_0x41afa3['geometry'],this['attributeLocations']=_0x41afa3['attributeLocations'],this[_0x35548c(0x16f)]=_0x41afa3['primitiveType'],this['uniformMap']=_0x41afa3[_0x35548c(0x14b)],this['vertexShaderSource']=_0x41afa3['vertexShaderSource'],this['fragmentShaderSource']=_0x41afa3[_0x35548c(0x16d)],this[_0x35548c(0x13d)]=_0x41afa3['rawRenderState'],this['framebuffer']=_0x41afa3[_0x35548c(0x10a)],this[_0x35548c(0xe2)]=_0x41afa3['outputTexture'],this['autoClear']=_0x41afa3['autoClear']??![],this['preExecute']=_0x41afa3['preExecute'],this[_0x35548c(0xf3)]=!![],this['commandToExecute']=undefined,this[_0x35548c(0xfa)]=undefined,this['autoClear']&&(this[_0x35548c(0xfa)]=new Cesium$6[(_0x35548c(0x128))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x35548c(0x10a)],'pass':Cesium$6[_0x35548c(0x11e)][_0x35548c(0x169)]}));}['createCommand'](_0x1c619d){const _0x1dc041=_0x5a2c;switch(this[_0x1dc041(0xbc)]){case _0x1dc041(0x12f):{const _0x373df9=Cesium$6['VertexArray'][_0x1dc041(0x111)]({'context':_0x1c619d,'geometry':this[_0x1dc041(0x148)],'attributeLocations':this[_0x1dc041(0x17b)],'bufferUsage':Cesium$6[_0x1dc041(0xb1)]['STATIC_DRAW']}),_0x1e98b2=Cesium$6['ShaderProgram']['fromCache']({'context':_0x1c619d,'attributeLocations':this[_0x1dc041(0x17b)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x9edf16=Cesium$6['RenderState']['fromCache'](this[_0x1dc041(0x13d)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x1e98b2,'vertexArray':_0x373df9,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x9edf16,'uniformMap':this[_0x1dc041(0x14b)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0x1dc041(0xe2)],'persists':!![]});}}}['setGeometry'](_0x586e7c,_0x3ded2e){const _0x593f2e=_0x5a2c;this[_0x593f2e(0x148)]=_0x3ded2e;const _0x13c2e=Cesium$6[_0x593f2e(0x149)]['fromGeometry']({'context':_0x586e7c,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x593f2e(0xb1)]['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x13c2e;}['update'](_0x458635){const _0x509238=_0x5a2c;if(!this['show'])return;if(_0x458635['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6[_0x509238(0x14e)](this[_0x509238(0xb9)])&&(this['commandToExecute']=this[_0x509238(0x12e)](_0x458635[_0x509238(0xe4)])),Cesium$6[_0x509238(0x14e)](this['preExecute'])&&this[_0x509238(0x190)](),Cesium$6[_0x509238(0x14e)](this[_0x509238(0xfa)])&&_0x458635['commandList']['push'](this['clearCommand']),_0x458635['commandList']['push'](this[_0x509238(0xb9)]);}[_0x4f2d27(0x12a)](){return![];}['destroy'](){const _0x2aa45b=_0x4f2d27;if(this[_0x2aa45b(0xfa)]){var _0x2b27d4,_0x391dd2;(_0x2b27d4=this['clearCommand'])!==null&&_0x2b27d4!==void 0x0&&_0x2b27d4['vertexArray']&&this['clearCommand'][_0x2aa45b(0xaf)][_0x2aa45b(0xbb)](),(_0x391dd2=this[_0x2aa45b(0xfa)])!==null&&_0x391dd2!==void 0x0&&_0x391dd2[_0x2aa45b(0xc8)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x2aa45b(0xb9)]['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}function _0x5a2c(_0x559f72,_0xc9a8bd){const _0x4f9add=_0x4f9a();return _0x5a2c=function(_0x5a2c29,_0x39b1f9){_0x5a2c29=_0x5a2c29-0xac;let _0x49337c=_0x4f9add[_0x5a2c29];return _0x49337c;},_0x5a2c(_0x559f72,_0xc9a8bd);}const Cesium$5=mars3d__namespace[_0x4f2d27(0xc1)],Util=(function(){const _0x5d4a55=function(){const _0x157569=_0x5a2c,_0x4bda9b=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x157569(0x107))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x4bda9b;},_0x5cdda8=function(_0x3132b8,_0x57944a){const _0x54430f=_0x5a2c;if(Cesium$5['defined'](_0x57944a)){const _0x51dd92={};_0x51dd92['arrayBufferView']=_0x57944a,_0x3132b8['source']=_0x51dd92;}const _0x51ebd9=new Cesium$5[(_0x54430f(0x159))](_0x3132b8);return _0x51ebd9;},_0x233ed0=function(_0x145e2c,_0x2f2e43,_0x45f552){const _0x22a792=new Cesium$5['Framebuffer']({'context':_0x145e2c,'colorTextures':[_0x2f2e43],'depthTexture':_0x45f552});return _0x22a792;},_0x5c047e=function(_0x6524e1){const _0x1c9f03=_0x5a2c,_0x3fd5dc=!![],_0x165421=![],_0x3361c7={'viewport':_0x6524e1['viewport'],'depthTest':_0x6524e1['depthTest'],'depthMask':_0x6524e1[_0x1c9f03(0xdf)],'blending':_0x6524e1[_0x1c9f03(0x157)]},_0x425a6a=Cesium$5['Appearance']['getDefaultRenderState'](_0x3fd5dc,_0x165421,_0x3361c7);return _0x425a6a;},_0x53646a=function(_0x27165b){const _0x4e13bf=_0x5a2c,_0x29b4e6={},_0x253b52=Cesium$5['Math']['mod'](_0x27165b['west'],Cesium$5['Math'][_0x4e13bf(0x188)]),_0x5cb188=Cesium$5[_0x4e13bf(0xff)][_0x4e13bf(0x146)](_0x27165b[_0x4e13bf(0xe6)],Cesium$5[_0x4e13bf(0xff)]['TWO_PI']),_0x4c4434=_0x27165b['width'];let _0x388bf5,_0x4d60e6;_0x4c4434>Cesium$5[_0x4e13bf(0xff)][_0x4e13bf(0xcd)]?(_0x388bf5=0x0,_0x4d60e6=Cesium$5['Math']['TWO_PI']):_0x5cb188-_0x253b52<_0x4c4434?(_0x388bf5=_0x253b52,_0x4d60e6=_0x253b52+_0x4c4434):(_0x388bf5=_0x253b52,_0x4d60e6=_0x5cb188);_0x29b4e6[_0x4e13bf(0x130)]={'min':Cesium$5['Math']['toDegrees'](_0x388bf5),'max':Cesium$5['Math']['toDegrees'](_0x4d60e6)};const _0x1a463c=_0x27165b['south'],_0x2cfc8c=_0x27165b['north'],_0x16a8f8=_0x27165b['height'],_0x517683=_0x16a8f8>Cesium$5['Math']['PI']/0xc?_0x16a8f8/0x2:0x0;let _0x2732ad=Cesium$5['Math'][_0x4e13bf(0x124)](_0x1a463c-_0x517683),_0x2334a6=Cesium$5['Math']['clampToLatitudeRange'](_0x2cfc8c+_0x517683);return _0x2732ad<-Cesium$5[_0x4e13bf(0xff)][_0x4e13bf(0x10f)]&&(_0x2732ad=-Cesium$5[_0x4e13bf(0xff)][_0x4e13bf(0xd2)]),_0x2334a6>Cesium$5[_0x4e13bf(0xff)][_0x4e13bf(0x10f)]&&(_0x2334a6=Cesium$5[_0x4e13bf(0xff)]['PI_OVER_TWO']),_0x29b4e6['lat']={'min':Cesium$5[_0x4e13bf(0xff)]['toDegrees'](_0x2732ad),'max':Cesium$5['Math']['toDegrees'](_0x2334a6)},_0x29b4e6;};return{'getFullscreenQuad':_0x5d4a55,'createTexture':_0x5cdda8,'createFramebuffer':_0x233ed0,'createRawRenderState':_0x5c047e,'viewRectangleToLonLatRange':_0x53646a};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x4f2d27(0xb2);const Cesium$4=mars3d__namespace[_0x4f2d27(0xc1)];class ParticlesRendering{constructor(_0x49ef30,_0x2e8b50,_0x26a58c,_0x2e15d5,_0x3f4927){const _0x1d8cd2=_0x4f2d27;this['createRenderingTextures'](_0x49ef30,_0x2e8b50,_0x26a58c['colors']),this['createRenderingFramebuffers'](_0x49ef30),this[_0x1d8cd2(0x12c)](_0x49ef30,_0x26a58c,_0x2e15d5,_0x3f4927);}[_0x4f2d27(0x110)](_0x3e9338,_0x5a6cc7,_0x6f5e9b){const _0x34137e=_0x4f2d27,_0x373ada={'context':_0x3e9338,'width':_0x3e9338['drawingBufferWidth'],'height':_0x3e9338['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x34137e(0x126)]['UNSIGNED_BYTE']},_0x57ee5e={'context':_0x3e9338,'width':_0x3e9338['drawingBufferWidth'],'height':_0x3e9338['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x34137e(0x189)]},_0x1146a1=_0x6f5e9b['length'],_0x5ac7a8=new Float32Array(_0x1146a1*0x3);for(let _0x6318e8=0x0;_0x6318e8<_0x1146a1;_0x6318e8++){const _0x3bb7f0=Cesium$4['Color'][_0x34137e(0x14f)](_0x6f5e9b[_0x6318e8]);_0x5ac7a8[0x3*_0x6318e8]=_0x3bb7f0['red'],_0x5ac7a8[0x3*_0x6318e8+0x1]=_0x3bb7f0['green'],_0x5ac7a8[0x3*_0x6318e8+0x2]=_0x3bb7f0['blue'];}const _0xd6488={'context':_0x3e9338,'width':_0x1146a1,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x34137e(0xcf)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x34137e(0x132))]({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x34137e(0x103)][_0x34137e(0xae)]})};this['textures']={'segmentsColor':Util[_0x34137e(0xef)](_0x373ada),'segmentsDepth':Util[_0x34137e(0xef)](_0x57ee5e),'currentTrailsColor':Util['createTexture'](_0x373ada),'currentTrailsDepth':Util['createTexture'](_0x57ee5e),'nextTrailsColor':Util['createTexture'](_0x373ada),'nextTrailsDepth':Util[_0x34137e(0xef)](_0x57ee5e),'colorTable':Util[_0x34137e(0xef)](_0xd6488,_0x5ac7a8)};}[_0x4f2d27(0x181)](_0x57b993){const _0xf8c462=_0x4f2d27;this['framebuffers']={'segments':Util[_0xf8c462(0x136)](_0x57b993,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x57b993,this['textures']['currentTrailsColor'],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x57b993,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x33d54d){const _0xae0ce6=_0x4f2d27,_0x560bc6=0x4;let _0x5269a2=[];for(let _0x2ee08f=0x0;_0x2ee08f<_0x33d54d['particlesTextureSize'];_0x2ee08f++){for(let _0x28a8c8=0x0;_0x28a8c8<_0x33d54d['particlesTextureSize'];_0x28a8c8++){for(let _0xa33c13=0x0;_0xa33c13<_0x560bc6;_0xa33c13++){_0x5269a2['push'](_0x2ee08f/_0x33d54d['particlesTextureSize']),_0x5269a2[_0xae0ce6(0xc5)](_0x28a8c8/_0x33d54d['particlesTextureSize']);}}}_0x5269a2=new Float32Array(_0x5269a2);let _0x2665e2=[];const _0x5480f8=[-0x1,0x1],_0x3080e3=[-0x1,0x1];for(let _0x376a98=0x0;_0x376a98<_0x33d54d['maxParticles'];_0x376a98++){for(let _0x166b5a=0x0;_0x166b5a<_0x560bc6/0x2;_0x166b5a++){for(let _0x14d26d=0x0;_0x14d26d<_0x560bc6/0x2;_0x14d26d++){_0x2665e2[_0xae0ce6(0xc5)](_0x5480f8[_0x166b5a]),_0x2665e2['push'](_0x3080e3[_0x14d26d]),_0x2665e2['push'](0x0);}}}_0x2665e2=new Float32Array(_0x2665e2);const _0xfdee1b=0x6*_0x33d54d['maxParticles'],_0xb41f3e=new Uint32Array(_0xfdee1b);for(let _0x57a6e2=0x0,_0x7f91f3=0x0,_0x54c527=0x0;_0x57a6e2<_0x33d54d['maxParticles'];_0x57a6e2++){_0xb41f3e[_0x7f91f3++]=_0x54c527+0x0,_0xb41f3e[_0x7f91f3++]=_0x54c527+0x1,_0xb41f3e[_0x7f91f3++]=_0x54c527+0x2,_0xb41f3e[_0x7f91f3++]=_0x54c527+0x2,_0xb41f3e[_0x7f91f3++]=_0x54c527+0x1,_0xb41f3e[_0x7f91f3++]=_0x54c527+0x3,_0x54c527+=0x4;}const _0x5b1b5c=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0xae0ce6(0xd8)],'componentsPerAttribute':0x2,'values':_0x5269a2}),'normal':new Cesium$4[(_0xae0ce6(0x107))]({'componentDatatype':Cesium$4['ComponentDatatype'][_0xae0ce6(0xd8)],'componentsPerAttribute':0x3,'values':_0x2665e2})}),'indices':_0xb41f3e});return _0x5b1b5c;}['createRenderingPrimitives'](_0x5517f5,_0xdd84b9,_0x1d06b7,_0x20ca63){const _0x1e3ab6=_0x4f2d27,_0x4a71ee=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0xdd84b9),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x20ca63['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x51fc67=_0x5a2c;return _0x20ca63['particlesTextures'][_0x51fc67(0xf4)];},'postProcessingSpeed':function(){const _0x4dafa5=_0x5a2c;return _0x20ca63['particlesTextures'][_0x4dafa5(0x13e)];},'colorTable':function(){return _0x4a71ee['textures']['colorTable'];},'aspect':function(){const _0x3b9404=_0x5a2c;return _0x5517f5['drawingBufferWidth']/_0x5517f5[_0x3b9404(0xeb)];},'pixelSize':function(){return _0x1d06b7['pixelSize'];},'lineWidth':function(){return _0xdd84b9['lineWidth'];},'particleHeight':function(){const _0x4b3476=_0x5a2c;return _0xdd84b9[_0x4b3476(0x165)];}},'vertexShaderSource':new Cesium$4[(_0x1e3ab6(0x172))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x4a71ee['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x4a71ee['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x4a71ee['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x3545b6=_0x1e3ab6;return _0x4a71ee['framebuffers'][_0x3545b6(0x14a)]['depthTexture'];},'fadeOpacity':function(){const _0x410841=_0x1e3ab6;return _0xdd84b9[_0x410841(0x192)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x1e3ab6(0xf8)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x1e3ab6(0x172))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0x1e3ab6(0x11c)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x99a952=_0x1e3ab6,_0x370fda=_0x4a71ee[_0x99a952(0xea)]['currentTrails'];_0x4a71ee['framebuffers']['currentTrails']=_0x4a71ee['framebuffers']['nextTrails'],_0x4a71ee[_0x99a952(0xea)][_0x99a952(0xfc)]=_0x370fda,_0x4a71ee['primitives']['trails']['commandToExecute'][_0x99a952(0x10a)]=_0x4a71ee[_0x99a952(0xea)][_0x99a952(0xfc)],_0x4a71ee['primitives'][_0x99a952(0x17d)]['clearCommand']['framebuffer']=_0x4a71ee['framebuffers'][_0x99a952(0xfc)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x1e3ab6(0x167)],'uniformMap':{'trailsColorTexture':function(){const _0x21863d=_0x1e3ab6;return _0x4a71ee[_0x21863d(0xea)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x4b8ce8=_0x1e3ab6;return _0x4a71ee['framebuffers'][_0x4b8ce8(0xfc)]['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x1e3ab6(0x172))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x1e3ab6(0x172))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x1e3ab6(0x115)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x4f2d27(0x125),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x4f2d27(0xc0),postProcessingPosition_frag=_0x4f2d27(0xdd),postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x1bf07a,_0xbeec50,_0x18918e,_0x169df9){this['data']=_0xbeec50,this['createWindTextures'](_0x1bf07a,_0xbeec50),this['createParticlesTextures'](_0x1bf07a,_0x18918e,_0x169df9),this['createComputingPrimitives'](_0xbeec50,_0x18918e,_0x169df9);}['createWindTextures'](_0xf554e3,_0x4a3264){const _0x4e094f=_0x4f2d27,_0x2761ad={'context':_0xf554e3,'width':_0x4a3264['dimensions']['lon'],'height':_0x4a3264['dimensions']['lat']*(_0x4a3264[_0x4e094f(0x186)]['lev']||0x1),'pixelFormat':Cesium$3[_0x4e094f(0x121)]['LUMINANCE'],'pixelDatatype':Cesium$3[_0x4e094f(0x126)][_0x4e094f(0xd8)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x4e094f(0xd3)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x4e094f(0xc9)]})};this['windTextures']={'U':Util['createTexture'](_0x2761ad,_0x4a3264['U']['array']),'V':Util['createTexture'](_0x2761ad,_0x4a3264['V']['array'])};}['createParticlesTextures'](_0x503174,_0x5f54f5,_0x10a6e2){const _0x1d0e87=_0x4f2d27,_0x3123da={'context':_0x503174,'width':_0x5f54f5['particlesTextureSize'],'height':_0x5f54f5[_0x1d0e87(0xe8)],'pixelFormat':Cesium$3[_0x1d0e87(0x121)]['RGBA'],'pixelDatatype':Cesium$3[_0x1d0e87(0x126)][_0x1d0e87(0xd8)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x1d0e87(0xd3)][_0x1d0e87(0xc9)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x1d0e87(0xc9)]})},_0x2b1c6e=this[_0x1d0e87(0x101)](_0x5f54f5[_0x1d0e87(0xb6)],_0x10a6e2),_0x1bd718=new Float32Array(0x4*_0x5f54f5['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x3123da),'currentParticlesPosition':Util['createTexture'](_0x3123da,_0x2b1c6e),'nextParticlesPosition':Util[_0x1d0e87(0xef)](_0x3123da,_0x2b1c6e),'currentParticlesSpeed':Util['createTexture'](_0x3123da,_0x1bd718),'nextParticlesSpeed':Util[_0x1d0e87(0xef)](_0x3123da,_0x1bd718),'postProcessingPosition':Util['createTexture'](_0x3123da,_0x2b1c6e),'postProcessingSpeed':Util[_0x1d0e87(0xef)](_0x3123da,_0x1bd718)};}[_0x4f2d27(0x101)](_0x4bb5a0,_0x4af197){const _0x5e600e=_0x4f2d27,_0x245af9=new Float32Array(0x4*_0x4bb5a0);for(let _0x352e2e=0x0;_0x352e2e<_0x4bb5a0;_0x352e2e++){_0x245af9[0x4*_0x352e2e]=Cesium$3['Math']['randomBetween'](_0x4af197['lonRange']['x'],_0x4af197[_0x5e600e(0x180)]['y']),_0x245af9[0x4*_0x352e2e+0x1]=Cesium$3['Math']['randomBetween'](_0x4af197[_0x5e600e(0xad)]['x'],_0x4af197[_0x5e600e(0xad)]['y']),_0x245af9[0x4*_0x352e2e+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this[_0x5e600e(0x155)][_0x5e600e(0xc6)]['max']),_0x245af9[0x4*_0x352e2e+0x3]=0x0;}return _0x245af9;}[_0x4f2d27(0xb3)](){Object['keys'](this['particlesTextures'])['forEach'](_0x59cd5e=>{const _0x3c3855=_0x5a2c;this['particlesTextures'][_0x59cd5e][_0x3c3855(0xbb)]();});}['createComputingPrimitives'](_0x522f00,_0x51eea9,_0x1b3c1c){const _0xeefcbd=_0x4f2d27,_0x2a91fb=new Cesium$3['Cartesian3'](_0x522f00[_0xeefcbd(0x186)]['lon'],_0x522f00[_0xeefcbd(0x186)]['lat'],_0x522f00['dimensions'][_0xeefcbd(0xc6)]),_0x25c78e=new Cesium$3['Cartesian3'](_0x522f00['lon'][_0xeefcbd(0xec)],_0x522f00['lat']['min'],_0x522f00[_0xeefcbd(0xc6)]['min']),_0x31545f=new Cesium$3['Cartesian3'](_0x522f00[_0xeefcbd(0x130)]['max'],_0x522f00[_0xeefcbd(0xd6)]['max'],_0x522f00['lev']['max']),_0x2c53a1=new Cesium$3['Cartesian3']((_0x31545f['x']-_0x25c78e['x'])/(_0x2a91fb['x']-0x1),(_0x31545f['y']-_0x25c78e['y'])/(_0x2a91fb['y']-0x1),_0x2a91fb['z']>0x1?(_0x31545f['z']-_0x25c78e['z'])/(_0x2a91fb['z']-0x1):0x1),_0x4bdf58=new Cesium$3[(_0xeefcbd(0x13b))](_0x522f00['U']['min'],_0x522f00['U']['max']),_0x5308f9=new Cesium$3['Cartesian2'](_0x522f00['V']['min'],_0x522f00['V']['max']),_0x172dac=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0xeefcbd(0x118),'uniformMap':{'U':function(){const _0x315a59=_0xeefcbd;return _0x172dac[_0x315a59(0x16b)]['U'];},'V':function(){return _0x172dac['windTextures']['V'];},'currentParticlesPosition':function(){const _0x5b45b6=_0xeefcbd;return _0x172dac['particlesTextures'][_0x5b45b6(0x108)];},'dimension':function(){return _0x2a91fb;},'minimum':function(){return _0x25c78e;},'maximum':function(){return _0x31545f;},'interval':function(){return _0x2c53a1;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0xeefcbd(0x152)]['particlesWind'],'preExecute':function(){const _0x46dfbd=_0xeefcbd;_0x172dac['primitives']['getWind']['commandToExecute'][_0x46dfbd(0xe2)]=_0x172dac['particlesTextures'][_0x46dfbd(0xcb)];}}),'updateSpeed':new CustomPrimitive({'commandType':_0xeefcbd(0x118),'uniformMap':{'currentParticlesSpeed':function(){const _0x565aea=_0xeefcbd;return _0x172dac[_0x565aea(0x152)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x172dac['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x4bdf58;},'vSpeedRange':function(){return _0x5308f9;},'pixelSize':function(){const _0x302ce3=_0xeefcbd;return _0x1b3c1c[_0x302ce3(0xb0)];},'speedFactor':function(){return _0x51eea9['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x5927ce=_0xeefcbd,_0x3f59ab=_0x172dac['particlesTextures']['currentParticlesSpeed'];_0x172dac['particlesTextures']['currentParticlesSpeed']=_0x172dac['particlesTextures']['postProcessingSpeed'],_0x172dac['particlesTextures'][_0x5927ce(0x13e)]=_0x3f59ab,_0x172dac['primitives']['updateSpeed']['commandToExecute'][_0x5927ce(0xe2)]=_0x172dac[_0x5927ce(0x152)][_0x5927ce(0x18a)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x46af64=_0xeefcbd;return _0x172dac[_0x46af64(0x152)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x172dac['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0xeefcbd(0x135)],'preExecute':function(){const _0x33dd44=_0xeefcbd,_0x34a8dc=_0x172dac['particlesTextures']['currentParticlesPosition'];_0x172dac[_0x33dd44(0x152)][_0x33dd44(0x108)]=_0x172dac[_0x33dd44(0x152)]['postProcessingPosition'],_0x172dac[_0x33dd44(0x152)]['postProcessingPosition']=_0x34a8dc,_0x172dac['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x172dac[_0x33dd44(0x152)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x40b5a4=_0xeefcbd;return _0x172dac[_0x40b5a4(0x152)][_0x40b5a4(0x135)];},'nextParticlesSpeed':function(){return _0x172dac['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x1b3c1c['lonRange'];},'latRange':function(){return _0x1b3c1c['latRange'];},'randomCoefficient':function(){const _0x14a9de=Math['random']();return _0x14a9de;},'dropRate':function(){return _0x51eea9['dropRate'];},'dropRateBump':function(){return _0x51eea9['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0xeefcbd(0x172))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0xeefcbd(0x152)][_0xeefcbd(0xf4)],'preExecute':function(){const _0x4032a5=_0xeefcbd;_0x172dac['primitives']['postProcessingPosition'][_0x4032a5(0xb9)]['outputTexture']=_0x172dac[_0x4032a5(0x152)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x172dac['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x172dac['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0xeefcbd(0x172))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0xeefcbd(0x152)][_0xeefcbd(0x13e)],'preExecute':function(){const _0x5c9d41=_0xeefcbd;_0x172dac[_0x5c9d41(0x18f)]['postProcessingSpeed'][_0x5c9d41(0xb9)]['outputTexture']=_0x172dac['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x2d109f,_0xefe55d,_0x4f9265,_0x2c678f){const _0x271d59=_0x4f2d27;this['context']=_0x2d109f,_0xefe55d={..._0xefe55d},_0xefe55d[_0x271d59(0x131)]&&_0xefe55d['vdata']&&(_0xefe55d['dimensions']={},_0xefe55d['dimensions']['lon']=_0xefe55d['cols'],_0xefe55d['dimensions'][_0x271d59(0xd6)]=_0xefe55d['rows'],_0xefe55d['dimensions']['lev']=_0xefe55d[_0x271d59(0xc6)]||0x1,_0xefe55d[_0x271d59(0x130)]={},_0xefe55d[_0x271d59(0x130)][_0x271d59(0xec)]=_0xefe55d['xmin'],_0xefe55d[_0x271d59(0x130)]['max']=_0xefe55d['xmax'],_0xefe55d[_0x271d59(0xd6)]={},_0xefe55d['lat']['min']=_0xefe55d['ymin'],_0xefe55d[_0x271d59(0xd6)][_0x271d59(0x175)]=_0xefe55d[_0x271d59(0x119)],_0xefe55d['lev']={},_0xefe55d[_0x271d59(0xc6)][_0x271d59(0xec)]=_0xefe55d['levmin']??0x1,_0xefe55d['lev']['max']=_0xefe55d[_0x271d59(0xe0)]??0x1,_0xefe55d['U']={},_0xefe55d['U'][_0x271d59(0x142)]=new Float32Array(_0xefe55d['udata']),_0xefe55d['U']['min']=_0xefe55d[_0x271d59(0x17c)]??Math['min'](..._0xefe55d['udata']),_0xefe55d['U']['max']=_0xefe55d['umax']??Math['max'](..._0xefe55d['udata']),_0xefe55d['V']={},_0xefe55d['V']['array']=new Float32Array(_0xefe55d['vdata']),_0xefe55d['V'][_0x271d59(0xec)]=_0xefe55d[_0x271d59(0x109)]??Math['min'](..._0xefe55d['vdata']),_0xefe55d['V']['max']=_0xefe55d[_0x271d59(0xb5)]??Math['max'](..._0xefe55d['vdata'])),this['data']=_0xefe55d,this['options']=_0x4f9265,this['viewerParameters']=_0x2c678f,this[_0x271d59(0xdc)]=new ParticlesComputing(this['context'],this['data'],this[_0x271d59(0xbf)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x271d59(0xe4)],this['data'],this['options'],this[_0x271d59(0xba)],this['particlesComputing']);}[_0x4f2d27(0x177)](_0x5e4dbe){const _0x524c3e=_0x4f2d27;this['particlesComputing'][_0x524c3e(0xb3)](),Object[_0x524c3e(0x112)](this['particlesComputing'][_0x524c3e(0x16b)])['forEach'](_0x23f124=>{const _0x596c7f=_0x524c3e;this['particlesComputing'][_0x596c7f(0x16b)][_0x23f124][_0x596c7f(0xbb)]();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x524c3e(0x112)](this[_0x524c3e(0xf5)]['framebuffers'])['forEach'](_0x41c0ca=>{this['particlesRendering']['framebuffers'][_0x41c0ca]['destroy']();}),this['context']=_0x5e4dbe,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x524c3e(0x155)],this[_0x524c3e(0xbf)],this[_0x524c3e(0xba)]),this[_0x524c3e(0xf5)]=new ParticlesRendering(this[_0x524c3e(0xe4)],this['data'],this[_0x524c3e(0xbf)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x4b3cba=_0x4f2d27,_0x11cad7=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x4b3cba(0xc2))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x4b3cba(0x11e)]['OPAQUE']});Object['keys'](this[_0x4b3cba(0xf5)]['framebuffers'])['forEach'](_0x235e73=>{_0x11cad7['framebuffer']=this['particlesRendering']['framebuffers'][_0x235e73],_0x11cad7['execute'](this['context']);});}['refreshParticles'](_0x56fa02){const _0x4d8d47=_0x4f2d27;this['clearFramebuffers'](),this['particlesComputing'][_0x4d8d47(0xb3)](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x56fa02){var _0x249c15;const _0xab08eb=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives'][_0x4d8d47(0x15f)]['geometry']=_0xab08eb;const _0x2e2df2=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0xab08eb,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x249c15=this[_0x4d8d47(0xf5)]['primitives'])!==null&&_0x249c15!==void 0x0&&(_0x249c15=_0x249c15['segments'])!==null&&_0x249c15!==void 0x0&&_0x249c15['commandToExecute']&&(this[_0x4d8d47(0xf5)]['primitives'][_0x4d8d47(0x15f)][_0x4d8d47(0xb9)][_0x4d8d47(0xaf)]=_0x2e2df2);}}[_0x4f2d27(0xe5)](_0x2123a4){const _0x3d9c57=_0x4f2d27;let _0xc171c2=![];this['options']['maxParticles']!==_0x2123a4[_0x3d9c57(0xb6)]&&(_0xc171c2=!![]),Object['keys'](_0x2123a4)[_0x3d9c57(0xe7)](_0x134ac4=>{const _0x3365a6=_0x3d9c57;this[_0x3365a6(0xbf)][_0x134ac4]=_0x2123a4[_0x134ac4];}),this['refreshParticles'](_0xc171c2);}['applyViewerParameters'](_0x56421b){const _0x4a644a=_0x4f2d27;Object['keys'](_0x56421b)[_0x4a644a(0xe7)](_0x13ff17=>{this['viewerParameters'][_0x13ff17]=_0x56421b[_0x13ff17];}),this['refreshParticles'](![]);}[_0x4f2d27(0xbb)](){const _0x1308ba=_0x4f2d27;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x1308ba(0xdc)]['windTextures'])['forEach'](_0x273a92=>{const _0x49f718=_0x1308ba;this['particlesComputing']['windTextures'][_0x273a92][_0x49f718(0xbb)]();}),this[_0x1308ba(0xf5)][_0x1308ba(0xac)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x1308ba(0xea)])['forEach'](_0x14191f=>{const _0x5fc9ab=_0x1308ba;this['particlesRendering'][_0x5fc9ab(0xea)][_0x14191f]['destroy']();});for(const _0x45eea0 in this){delete this[_0x45eea0];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x4d7fad={}){const _0xe29631=_0x4f2d27;_0x4d7fad={...DEF_OPTIONS,..._0x4d7fad},super(_0x4d7fad),this[_0xe29631(0xee)](_0x4d7fad);}get[_0x4f2d27(0xf1)](){const _0xc3d665=_0x4f2d27;return this[_0xc3d665(0x18f)];}get['data'](){return this['_data'];}set['data'](_0x49c268){this['setData'](_0x49c268);}get[_0x4f2d27(0x105)](){return this['options']['colors'];}set['colors'](_0x228658){const _0x584493=_0x4f2d27;this['options'][_0x584493(0x105)]=_0x228658,this['particleSystem']&&this['particleSystem'][_0x584493(0xe5)]({'colors':_0x228658}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x3178f4=_0x4f2d27;this[_0x3178f4(0x18c)]=this[_0x3178f4(0x10c)][_0x3178f4(0x18c)],this[_0x3178f4(0x156)]=this['_map'][_0x3178f4(0x156)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x3178f4(0x18c)][_0x3178f4(0x18f)]['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x3178f4(0x13b))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x3178f4(0xe3)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x3178f4(0x154)],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x3178f4(0xfe)]=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x3178f4(0xc3)],this),this[_0x3178f4(0x10c)]['on'](mars3d__namespace[_0x3178f4(0x173)]['mouseDown'],this[_0x3178f4(0x164)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x3178f4(0xf9)]);}['_removedHook'](){const _0x310a83=_0x4f2d27;window['removeEventListener'](_0x310a83(0x13a),this['resize']),this[_0x310a83(0x10c)]['off'](mars3d__namespace[_0x310a83(0x173)]['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x310a83(0x10c)][_0x310a83(0x166)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x310a83(0x10c)]['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x310a83(0x163)],this),this[_0x310a83(0x18f)]['removeAll'](),this['_map']['scene'][_0x310a83(0x18f)][_0x310a83(0xca)](this['primitives']);}['resize'](){const _0x1103d4=_0x4f2d27;if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x1103d4(0xf3)]=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace[_0x1103d4(0x173)]['preRender'],this[_0x1103d4(0x182)],this);}['_onMap_preRenderEvent'](_0x5f5498){const _0x31f5ac=_0x4f2d27;this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this[_0x31f5ac(0x18f)][_0x31f5ac(0xf3)]=!![];}[_0x4f2d27(0xc3)](_0x32d1fd){const _0x868c6=_0x4f2d27;clearTimeout(this[_0x868c6(0xd9)]);if(!this[_0x868c6(0xf3)]||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x4f2d27(0x164)](_0x7e2054){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x345024){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x387a74){const _0x102858=_0x4f2d27;if(!this['show']||!this[_0x102858(0x15a)])return;this['mouse_down']&&this['mouse_move']&&this[_0x102858(0x160)](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x35c1a6=_0x4f2d27;if(!this[_0x35c1a6(0x10c)]||!this['show'])return;this['updateViewerParameters'](),this[_0x35c1a6(0x15a)]['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x35c1a6(0xf3)]=!![];}['setData'](_0x1e4b24){const _0x3640fb=_0x4f2d27;this[_0x3640fb(0xf9)]=_0x1e4b24,this[_0x3640fb(0x15a)]&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x1e4b24,this[_0x3640fb(0x158)](),this[_0x3640fb(0xba)]),this['addPrimitives']();}[_0x4f2d27(0xee)](_0x4112bd,_0x4e6995){const _0x20f380=_0x4f2d27;if(_0x4112bd)for(const _0x279aa9 in _0x4112bd){this[_0x279aa9]=_0x4112bd[_0x279aa9];}this[_0x20f380(0x15a)]&&this[_0x20f380(0x15a)]['setOptions'](this['getOptions']());}['getOptions'](){const _0x3b578e=_0x4f2d27,_0x13d4f2=Math['ceil'](Math[_0x3b578e(0xf2)](this['particlesNumber']));return this['particlesNumber']=_0x13d4f2*_0x13d4f2,{'particlesTextureSize':_0x13d4f2,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x3f6b85=_0x4f2d27;this['primitives']['add'](this['particleSystem'][_0x3f6b85(0xdc)]['primitives']['getWind']),this[_0x3f6b85(0x18f)]['add'](this[_0x3f6b85(0x15a)]['particlesComputing'][_0x3f6b85(0x18f)]['updateSpeed']),this['primitives']['add'](this[_0x3f6b85(0x15a)][_0x3f6b85(0xdc)][_0x3f6b85(0x18f)][_0x3f6b85(0xda)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x3f6b85(0x18f)]['postProcessingPosition']),this['primitives']['add'](this['particleSystem'][_0x3f6b85(0xdc)]['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem'][_0x3f6b85(0xf5)]['primitives']['segments']),this['primitives']['add'](this[_0x3f6b85(0x15a)]['particlesRendering'][_0x3f6b85(0x18f)]['trails']),this['primitives'][_0x3f6b85(0x14c)](this[_0x3f6b85(0x15a)]['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x4e2310=_0x4f2d27;let _0x475ff6=this[_0x4e2310(0x156)]['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x475ff6){const _0x4cba37=this['_map'][_0x4e2310(0x10e)]();_0x475ff6=Cesium$1[_0x4e2310(0xd1)]['fromDegrees'](_0x4cba37['xmin'],_0x4cba37['ymin'],_0x4cba37['xmax'],_0x4cba37[_0x4e2310(0x119)]);}const _0x5b93fa=Util['viewRectangleToLonLatRange'](_0x475ff6);this['viewerParameters']['lonRange']['x']=_0x5b93fa['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x5b93fa[_0x4e2310(0x130)]['max'],this['viewerParameters']['latRange']['x']=_0x5b93fa['lat']['min'],this['viewerParameters']['latRange']['y']=_0x5b93fa['lat']['max'];const _0x51c3b5=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x51c3b5>0x0&&(this['viewerParameters']['pixelSize']=_0x51c3b5);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x5b0e8d=_0x4f2d27;this[_0x5b0e8d(0x171)]=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x5b0e8d(0x15d)]=null,this['speed']=null;}['destroy'](){for(const _0x37b968 in this){delete this[_0x37b968];}}}class CanvasWindField{constructor(_0x56a2a1){this['setOptions'](_0x56a2a1);}get['speedRate'](){return this['_speedRate'];}set[_0x4f2d27(0x114)](_0x3515c5){const _0x564d76=_0x4f2d27;this['_speedRate']=(0x64-(_0x3515c5>0x63?0x63:_0x3515c5))*0x64,this['_calc_speedRate']=[(this[_0x564d76(0x11b)]-this['xmin'])/this['_speedRate'],(this[_0x564d76(0x119)]-this['ymin'])/this['_speedRate']];}get['maxAge'](){const _0x4c7820=_0x4f2d27;return this[_0x4c7820(0x15e)];}set['maxAge'](_0x2c3dee){this['_maxAge']=_0x2c3dee;}['setOptions'](_0x309e26){const _0x299cdb=_0x4f2d27;this['options']=_0x309e26,this[_0x299cdb(0x100)]=_0x309e26['maxAge']||0x78,this['speedRate']=_0x309e26['speedRate']||0x32,this['particles']=[];const _0x1edbbd=_0x309e26['particlesNumber']||0x1000;for(let _0x315cde=0x0;_0x315cde<_0x1edbbd;_0x315cde++){const _0x22950b=this['_randomParticle'](new CanvasParticle());this['particles'][_0x299cdb(0xc5)](_0x22950b);}}[_0x4f2d27(0x170)](_0x15f3fb){const _0x52d639=_0x4f2d27;this['rows']=_0x15f3fb['rows'],this['cols']=_0x15f3fb['cols'],this['xmin']=_0x15f3fb['xmin'],this[_0x52d639(0x11b)]=_0x15f3fb['xmax'],this[_0x52d639(0x15c)]=_0x15f3fb['ymin'],this['ymax']=_0x15f3fb['ymax'],this['grid']=[];const _0x5144fc=_0x15f3fb['udata'],_0x1954fd=_0x15f3fb['vdata'];let _0x428091=![];_0x5144fc['length']===this['rows']&&_0x5144fc[0x0]['length']===this['cols']&&(_0x428091=!![]);let _0x5e1857=0x0,_0x43ddaa=null,_0x35828f=null;for(let _0x39e37f=0x0;_0x39e37f<this['rows'];_0x39e37f++){_0x43ddaa=[];for(let _0x56aa43=0x0;_0x56aa43<this['cols'];_0x56aa43++,_0x5e1857++){_0x428091?_0x35828f=this[_0x52d639(0x113)](_0x5144fc[_0x39e37f][_0x56aa43],_0x1954fd[_0x39e37f][_0x56aa43]):_0x35828f=this[_0x52d639(0x113)](_0x5144fc[_0x5e1857],_0x1954fd[_0x5e1857]),_0x43ddaa['push'](_0x35828f);}this['grid']['push'](_0x43ddaa);}this['options']['reverseY']&&this[_0x52d639(0x162)]['reverse']();}['clear'](){const _0x4bf262=_0x4f2d27;delete this[_0x4bf262(0x17e)],delete this[_0x4bf262(0x12d)],delete this['xmin'],delete this[_0x4bf262(0x11b)],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this['particles'];}[_0x4f2d27(0xd7)](_0x5d7154,_0x2c84e5){const _0x2218a7=_0x4f2d27,_0x1f8d88=(_0x5d7154-this[_0x2218a7(0x191)])/(this[_0x2218a7(0x11b)]-this['xmin'])*(this['cols']-0x1),_0x5d636b=(this[_0x2218a7(0x119)]-_0x2c84e5)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x1f8d88,_0x5d636b];}['getUVByXY'](_0x2f8d50,_0x220422){const _0x37ed3f=_0x4f2d27;if(_0x2f8d50<0x0||_0x2f8d50>=this['cols']||_0x220422>=this['rows'])return[0x0,0x0,0x0];const _0x4015f7=Math['floor'](_0x2f8d50),_0x53b360=Math['floor'](_0x220422);if(_0x4015f7===_0x2f8d50&&_0x53b360===_0x220422)return this['grid'][_0x220422][_0x2f8d50];const _0x38f929=_0x4015f7+0x1,_0x1eb9e1=_0x53b360+0x1,_0xfb7ac1=this['getUVByXY'](_0x4015f7,_0x53b360),_0x17b4d3=this['getUVByXY'](_0x38f929,_0x53b360),_0x33d0b7=this['getUVByXY'](_0x4015f7,_0x1eb9e1),_0x396569=this[_0x37ed3f(0xd5)](_0x38f929,_0x1eb9e1);let _0x54d624=null;try{_0x54d624=this[_0x37ed3f(0x13f)](_0x2f8d50-_0x4015f7,_0x220422-_0x53b360,_0xfb7ac1,_0x17b4d3,_0x33d0b7,_0x396569);}catch(_0x4182f7){console['log'](_0x2f8d50,_0x220422);}return _0x54d624;}['_bilinearInterpolation'](_0x505acd,_0x3447b8,_0x5dae3b,_0x1bb22e,_0x3437d3,_0x194a52){const _0x55268d=0x1-_0x505acd,_0x6ca017=0x1-_0x3447b8,_0x4dcd8f=_0x55268d*_0x6ca017,_0x46d961=_0x505acd*_0x6ca017,_0x15664e=_0x55268d*_0x3447b8,_0x1d126e=_0x505acd*_0x3447b8,_0x2b9021=_0x5dae3b[0x0]*_0x4dcd8f+_0x1bb22e[0x0]*_0x46d961+_0x3437d3[0x0]*_0x15664e+_0x194a52[0x0]*_0x1d126e,_0x10a236=_0x5dae3b[0x1]*_0x4dcd8f+_0x1bb22e[0x1]*_0x46d961+_0x3437d3[0x1]*_0x15664e+_0x194a52[0x1]*_0x1d126e;return this['_calcUV'](_0x2b9021,_0x10a236);}[_0x4f2d27(0x113)](_0x40dfc8,_0x3f1f3a){return[+_0x40dfc8,+_0x3f1f3a,Math['sqrt'](_0x40dfc8*_0x40dfc8+_0x3f1f3a*_0x3f1f3a)];}['getUVByPoint'](_0x3f6f6b,_0x69cfb9){if(!this['isInExtent'](_0x3f6f6b,_0x69cfb9))return null;const _0x4ca7be=this['toGridXY'](_0x3f6f6b,_0x69cfb9),_0x4b3ea2=this['getUVByXY'](_0x4ca7be[0x0],_0x4ca7be[0x1]);return _0x4b3ea2;}['isInExtent'](_0x362507,_0xadfb67){return _0x362507>=this['xmin']&&_0x362507<=this['xmax']&&_0xadfb67>=this['ymin']&&_0xadfb67<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x361d46=_0x4f2d27,_0x5cb09a=fRandomByfloat(this['xmin'],this['xmax']),_0x4716bb=fRandomByfloat(this['ymin'],this[_0x361d46(0x119)]);return{'lat':_0x4716bb,'lng':_0x5cb09a};}['getParticles'](){const _0x1b6b7e=_0x4f2d27;let _0x1c0c16,_0x255a72,_0x53b764;for(let _0x5c03f5=0x0,_0x4fe63e=this['particles']['length'];_0x5c03f5<_0x4fe63e;_0x5c03f5++){let _0x181364=this[_0x1b6b7e(0x16c)][_0x5c03f5];_0x181364['age']<=0x0&&(_0x181364=this['_randomParticle'](_0x181364));if(_0x181364['age']>0x0){const _0x110e59=_0x181364[_0x1b6b7e(0xed)],_0x572bae=_0x181364['tlat'];_0x53b764=this['getUVByPoint'](_0x110e59,_0x572bae),_0x53b764?(_0x1c0c16=_0x110e59+this['_calc_speedRate'][0x0]*_0x53b764[0x0],_0x255a72=_0x572bae+this['_calc_speedRate'][0x1]*_0x53b764[0x1],_0x181364[_0x1b6b7e(0x171)]=_0x110e59,_0x181364[_0x1b6b7e(0xd6)]=_0x572bae,_0x181364['tlng']=_0x1c0c16,_0x181364['tlat']=_0x255a72,_0x181364['speed']=_0x53b764[0x2],_0x181364['age']--):_0x181364[_0x1b6b7e(0x15d)]=0x0;}}return this['particles'];}['_randomParticle'](_0x20b157){const _0x249a8a=_0x4f2d27;let _0x28d45c,_0x2e2eb9;for(let _0x5dbdb8=0x0;_0x5dbdb8<0x1e;_0x5dbdb8++){_0x28d45c=this[_0x249a8a(0x137)](),_0x2e2eb9=this['getUVByPoint'](_0x28d45c['lng'],_0x28d45c[_0x249a8a(0xd6)]);if(_0x2e2eb9&&_0x2e2eb9[0x2]>0x0)break;}if(!_0x2e2eb9)return _0x20b157;const _0x2d2d80=_0x28d45c['lng']+this[_0x249a8a(0x150)][0x0]*_0x2e2eb9[0x0],_0x5081ee=_0x28d45c['lat']+this['_calc_speedRate'][0x1]*_0x2e2eb9[0x1];return _0x20b157['lng']=_0x28d45c['lng'],_0x20b157[_0x249a8a(0xd6)]=_0x28d45c[_0x249a8a(0xd6)],_0x20b157[_0x249a8a(0xed)]=_0x2d2d80,_0x20b157['tlat']=_0x5081ee,_0x20b157['age']=Math[_0x249a8a(0x120)](Math['random']()*this[_0x249a8a(0x100)]),_0x20b157[_0x249a8a(0x140)]=_0x2e2eb9[0x2],_0x20b157;}['destroy'](){for(const _0x358dee in this){delete this[_0x358dee];}}}function _0x4f9a(){const _0x2ba098=['maxParticles','clientHeight','#ffffff','commandToExecute','viewerParameters','destroy','commandType','absolute','getOwnPropertyDescriptor','options','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','Cesium','Color','_onMapWhellEvent','_pointerEvents','push','lev','bindEvent','shaderProgram','NEAREST','remove','particlesWind','772766nqFwrN','THREE_PI_OVER_TWO','mouseHidden','RGB','CanvasWindField','Rectangle','PI_OVER_TWO','TextureMinificationFilter','_onMouseUpEvent','getUVByXY','lat','toGridXY','FLOAT','refreshTimer','updatePosition','addEventListener','particlesComputing','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','BaseLayer','depthMask','levmax','canvasWidth','outputTexture','globeBoundingSphere','context','setOptions','east','forEach','particlesTextureSize','__esModule','framebuffers','drawingBufferHeight','min','tlng','_setOptionsHook','createTexture','getContext','layer','sqrt','show','postProcessingPosition','particlesRendering','moveTo','init','DISABLE_GL_POSITION_LOG_DEPTH','_data','clearCommand','globalAlpha','nextTrails','length','mouse_move','Math','maxAge','randomizeParticles','stroke','TextureMagnificationFilter','mode','colors','strokeStyle','GeometryAttribute','currentParticlesPosition','vmin','framebuffer','abs','_map','canvasContext','getExtent','PI_OVER_THREE','createRenderingTextures','fromGeometry','keys','_calcUV','speedRate','createRawRenderState','width','_updateIng','Compute','ymax','frameTime','xmax','ALWAYS','onmessage','Pass','27606HDUWtb','round','PixelFormat','676AtXyqV','particlesNumber','clampToLatitudeRange','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','PixelDatatype','clientWidth','ClearCommand','856TBemnu','isDestroyed','9977840tgBTmE','createRenderingPrimitives','cols','createCommand','Draw','lon','udata','Sampler','_colorRamp','visible','nextParticlesPosition','createFramebuffer','getRandomLatLng','31003DEJVFy','create','resize','Cartesian2','canvas','rawRenderState','postProcessingSpeed','_bilinearInterpolation','speed','4658616dkRftO','array','worker','5MrnQIE','style','mod','update','geometry','VertexArray','currentTrails','uniformMap','add','_tomap','defined','fromCssColorString','_calc_speedRate','1nlrldD','particlesTextures','visibility','ZERO','data','camera','blending','getOptions','Texture','particleSystem','WindLayer','ymin','age','_maxAge','segments','redraw','mouseMove','grid','_onMouseMoveEvent','_onMouseDownEvent','particleHeight','off','TRIANGLES','wheel','OPAQUE','globalCompositeOperation','windTextures','particles','fragmentShaderSource','postMessage','primitiveType','setDate','lng','ShaderSource','EventType','animateFrame','max','bind','canvasResize','removeEventListener','now','13272710zyOYqZ','attributeLocations','umin','trails','rows','_updateIng2','lonRange','createRenderingFramebuffers','_onMap_preRenderEvent','windField','5036586JERCaA','fillRect','dimensions','windData','TWO_PI','UNSIGNED_INT','nextParticlesSpeed','reverseY','scene','hidden','EllipsoidalOccluder','primitives','preExecute','xmin','fadeOpacity','atan2','textures','latRange','LINEAR','vertexArray','pixelSize','BufferUsage','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','destroyParticlesTextures','lineWidth','vmax'];_0x4f9a=function(){return _0x2ba098;};return _0x4f9a();}function fRandomByfloat(_0x593e51,_0x282175){return _0x593e51+Math['random']()*(_0x282175-_0x593e51);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x4f2d27(0xde)];class CanvasWindLayer extends BaseLayer{constructor(_0x308214={}){const _0x272c2d=_0x4f2d27;super(_0x308214),this[_0x272c2d(0xee)](_0x308214),this['canvas']=null,_0x308214['colors']&&_0x308214['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x308214));}['_setOptionsHook'](_0xf36265,_0x3a9e5e){const _0x1c93d0=_0x4f2d27;this['frameTime']=0x3e8/(_0xf36265['frameRate']||0xa),this[_0x1c93d0(0xc4)]=this[_0x1c93d0(0xbf)]['pointerEvents']??![],this['color']=_0xf36265['color']||_0x1c93d0(0xb8),this['lineWidth']=_0xf36265[_0x1c93d0(0xb4)]||0x1,this['fixedHeight']=_0xf36265['fixedHeight']??0x0,this[_0x1c93d0(0x18b)]=_0xf36265[_0x1c93d0(0x18b)]??![],this[_0x1c93d0(0x183)]&&this['windField'][_0x1c93d0(0xe5)](_0xf36265);}get[_0x4f2d27(0xf1)](){return this['canvas'];}get[_0x4f2d27(0xe1)](){const _0x32a214=_0x4f2d27;return this['_map']['scene'][_0x32a214(0x13c)]['clientWidth'];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x24ff62){const _0x10e0b9=_0x4f2d27;this[_0x10e0b9(0xc4)]=_0x24ff62;if(!this['canvas'])return;_0x24ff62?this['canvas'][_0x10e0b9(0x145)]['pointer-events']='all':this['canvas']['style']['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x212cd8){const _0x109cbf=_0x4f2d27;this['options'][_0x109cbf(0x123)]=_0x212cd8,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x494c28=_0x4f2d27;return this[_0x494c28(0xbf)]['speedRate'];}set[_0x4f2d27(0x114)](_0x1d5891){const _0x43da8d=_0x4f2d27;this[_0x43da8d(0xbf)][_0x43da8d(0x114)]=_0x1d5891,this['windField']&&(this['windField']['speedRate']=_0x1d5891);}get['maxAge'](){const _0xea24f4=_0x4f2d27;return this[_0xea24f4(0xbf)][_0xea24f4(0x100)];}set['maxAge'](_0x3b5c79){this['options']['maxAge']=_0x3b5c79,this['windField']&&(this['windField']['maxAge']=_0x3b5c79);}get['data'](){const _0x46d351=_0x4f2d27;return this[_0x46d351(0x187)];}set['data'](_0x33b040){this['setData'](_0x33b040);}['_showHook'](_0x5ecccc){_0x5ecccc?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x5bef44=_0x4f2d27;this['options'][_0x5bef44(0x143)]?this['initWorker']():this[_0x5bef44(0x183)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x4b9b9b=_0x4f2d27;this['canvas']=this['_createCanvas'](),this['canvasContext']=this[_0x4b9b9b(0x13c)][_0x4b9b9b(0xf0)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0x4b9b9b(0xbf)]['data']&&this['setData'](this['options']['data']);}['_removedHook'](){this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x749d60=_0x4f2d27,_0x100e0a=mars3d__namespace['DomUtil'][_0x749d60(0x139)]('canvas','mars3d-canvasWind',this['_map']['container']);return _0x100e0a[_0x749d60(0x145)]['position']=_0x749d60(0xbd),_0x100e0a['style']['top']='0px',_0x100e0a['style']['left']='0px',_0x100e0a[_0x749d60(0x145)]['width']=this['_map'][_0x749d60(0x18c)][_0x749d60(0x13c)][_0x749d60(0x127)]+'px',_0x100e0a[_0x749d60(0x145)]['height']=this[_0x749d60(0x10c)]['scene'][_0x749d60(0x13c)][_0x749d60(0xb7)]+'px',_0x100e0a['style']['pointerEvents']=this[_0x749d60(0xc4)]?'auto':'none',_0x100e0a['style']['zIndex']=this['options']['zIndex']??0x9,_0x100e0a['width']=this[_0x749d60(0x10c)]['scene']['canvas']['clientWidth'],_0x100e0a['height']=this[_0x749d60(0x10c)]['scene']['canvas']['clientHeight'],_0x100e0a;}['resize'](){const _0x1cc019=_0x4f2d27;this['canvas']&&(this['canvas']['style']['width']=this['_map'][_0x1cc019(0x18c)]['canvas'][_0x1cc019(0x127)]+'px',this['canvas']['style']['height']=this[_0x1cc019(0x10c)][_0x1cc019(0x18c)][_0x1cc019(0x13c)]['clientHeight']+'px',this['canvas'][_0x1cc019(0x116)]=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this['_map']['scene']['canvas']['clientHeight']);}[_0x4f2d27(0xc7)](){const _0x566c8b=_0x4f2d27,_0x3f5bec=this;let _0x2cf4ed=Date[_0x566c8b(0x179)]();(function _0x230362(){const _0x338a10=_0x566c8b;_0x3f5bec[_0x338a10(0x174)]=window['requestAnimationFrame'](_0x230362);if(_0x3f5bec['show']&&_0x3f5bec['windField']){const _0x2c1004=Date['now'](),_0x4455ae=_0x2c1004-_0x2cf4ed;_0x4455ae>_0x3f5bec['frameTime']&&(_0x2cf4ed=_0x2c1004-_0x4455ae%_0x3f5bec[_0x338a10(0x11a)],_0x3f5bec['update']());}}(),window[_0x566c8b(0xdb)]('resize',this['resize'][_0x566c8b(0x176)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options'][_0x566c8b(0xce)]&&(this[_0x566c8b(0x10c)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x566c8b(0x164)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x566c8b(0xd4)],this)));}['unbindEvent'](){const _0x31091d=_0x4f2d27;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x31091d(0x174)],window[_0x31091d(0x178)]('resize',this[_0x31091d(0x13a)]),this['options'][_0x31091d(0xce)]&&(this['_map']['off'](mars3d__namespace['EventType'][_0x31091d(0x168)],this['_onMapWhellEvent'],this),this[_0x31091d(0x10c)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x31091d(0x173)]['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x31091d(0x166)](mars3d__namespace['EventType'][_0x31091d(0x161)],this['_onMouseMoveEvent'],this));}[_0x4f2d27(0xc3)](_0x149372){const _0x11d6ca=_0x4f2d27;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']=_0x11d6ca(0x18d),this['refreshTimer']=setTimeout(()=>{const _0x1c2db9=_0x11d6ca;if(!this[_0x1c2db9(0xf3)])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0x4f2d27(0x164)](_0x34f00b){const _0x1ab689=_0x4f2d27;this['mouse_down']=!![],this[_0x1ab689(0x10c)][_0x1ab689(0x166)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x1ab689(0x173)][_0x1ab689(0x161)],this[_0x1ab689(0x163)],this);}[_0x4f2d27(0x163)](_0x4780a4){const _0x3d585e=_0x4f2d27;if(!this[_0x3d585e(0xf3)]||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style'][_0x3d585e(0x153)]='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x15cdb4){const _0x1af85b=_0x4f2d27;if(!this['show']||!this[_0x1af85b(0x13c)])return;this['_map']['off'](mars3d__namespace['EventType'][_0x1af85b(0x161)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x1af85b(0xfe)]&&this['redraw'](),this[_0x1af85b(0x13c)]['style']['visibility']=_0x1af85b(0x134),this['mouse_down']=![],this[_0x1af85b(0xfe)]=![];}['setData'](_0x12344f){const _0x259556=_0x4f2d27;this['clear'](),this[_0x259556(0x187)]=_0x12344f,this['windField'][_0x259556(0x170)](_0x12344f),this['redraw']();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}['update'](){const _0x384b82=_0x4f2d27;if(this[_0x384b82(0x117)])return;this['_updateIng']=!![];if(this['worker'])this[_0x384b82(0x183)][_0x384b82(0x147)]();else{const _0x12332e=this['windField']['getParticles']();this['_drawLines'](_0x12332e);}this['_updateIng']=![];}['_drawLines'](_0x2a63d9){const _0x92b6a9=_0x4f2d27;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext'][_0x92b6a9(0x185)](0x0,0x0,this[_0x92b6a9(0xe1)],this['canvasHeight']),this['canvasContext'][_0x92b6a9(0x16a)]='lighter',this[_0x92b6a9(0x10d)][_0x92b6a9(0xfb)]=0.9;const _0x37c164=this[_0x92b6a9(0x10c)]['scene'][_0x92b6a9(0x104)]!==Cesium['SceneMode']['SCENE3D'],_0xe3668e=this['canvasWidth']*0.25;if(this[_0x92b6a9(0x133)])for(let _0x2a87b9=0x0,_0x403e78=_0x2a63d9['length'];_0x2a87b9<_0x403e78;_0x2a87b9++){const _0x2aa0c3=_0x2a63d9[_0x2a87b9],_0x2f774f=this['_tomap'](_0x2aa0c3[_0x92b6a9(0x171)],_0x2aa0c3['lat'],_0x2aa0c3),_0x414c15=this[_0x92b6a9(0x14d)](_0x2aa0c3['tlng'],_0x2aa0c3['tlat'],_0x2aa0c3);if(!_0x2f774f||!_0x414c15)continue;if(_0x37c164&&Math['abs'](_0x2f774f[0x0]-_0x414c15[0x0])>=_0xe3668e)continue;this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x92b6a9(0x133)]['getColor'](_0x2aa0c3['speed']),this[_0x92b6a9(0x10d)]['moveTo'](_0x2f774f[0x0],_0x2f774f[0x1]),this['canvasContext']['lineTo'](_0x414c15[0x0],_0x414c15[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext'][_0x92b6a9(0xb4)]=this[_0x92b6a9(0xb4)],this['canvasContext'][_0x92b6a9(0x106)]=this['color'];for(let _0xdf4d0b=0x0,_0x412bff=_0x2a63d9[_0x92b6a9(0xfd)];_0xdf4d0b<_0x412bff;_0xdf4d0b++){const _0x8d6fc0=_0x2a63d9[_0xdf4d0b],_0x561690=this['_tomap'](_0x8d6fc0['lng'],_0x8d6fc0['lat'],_0x8d6fc0),_0x1893d4=this['_tomap'](_0x8d6fc0['tlng'],_0x8d6fc0['tlat'],_0x8d6fc0);if(!_0x561690||!_0x1893d4)continue;if(_0x37c164&&Math[_0x92b6a9(0x10b)](_0x561690[0x0]-_0x1893d4[0x0])>=_0xe3668e)continue;this['canvasContext'][_0x92b6a9(0xf6)](_0x561690[0x0],_0x561690[0x1]),this['canvasContext']['lineTo'](_0x1893d4[0x0],_0x1893d4[0x1]);}this['canvasContext'][_0x92b6a9(0x102)]();}}[_0x4f2d27(0x14d)](_0x581892,_0x4be5be,_0x1b5f17){const _0x5de161=_0x4f2d27,_0x3c15f6=Cesium['Cartesian3']['fromDegrees'](_0x581892,_0x4be5be,this['fixedHeight']),_0x3a5f43=this['_map']['scene'];if(_0x3a5f43[_0x5de161(0x104)]===Cesium['SceneMode']['SCENE3D']){const _0x54e6c2=new Cesium[(_0x5de161(0x18e))](_0x3a5f43['globe']['ellipsoid'],_0x3a5f43[_0x5de161(0x156)]['positionWC']),_0x214018=_0x54e6c2['isPointVisible'](_0x3c15f6);if(!_0x214018)return _0x1b5f17[_0x5de161(0x15d)]=0x0,null;}const _0x15385d=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x3c15f6);return _0x15385d?[_0x15385d['x'],_0x15385d['y']]:null;}['clear'](){const _0x4a175d=_0x4f2d27;this[_0x4a175d(0x183)]['clear'](),delete this['windData'];}['initWorker'](){const _0x4b2200=_0x4f2d27;this['worker']=new Worker(this['options']['worker']),this['worker'][_0x4b2200(0x11d)]=_0x2f264a=>{const _0x2f540c=_0x4b2200;this['_drawLines'](_0x2f264a['data'][_0x2f540c(0x16c)]),this['_updateIng2']=![];},this['windField']={'init':_0x3da83e=>{const _0x57099f=_0x4b2200;this[_0x57099f(0x143)]['postMessage']({'type':'init','options':_0x3da83e});},'setOptions':_0x17f583=>{this['worker']['postMessage']({'type':'setOptions','options':_0x17f583});},'setDate':_0x245720=>{const _0x119d69=_0x4b2200;this['worker'][_0x119d69(0x16e)]({'type':'setDate','data':_0x245720});},'update':()=>{const _0x2c0cba=_0x4b2200;if(this['_updateIng2'])return;this[_0x2c0cba(0x17f)]=!![],this['worker'][_0x2c0cba(0x16e)]({'type':_0x2c0cba(0x147)});},'clear':()=>{const _0x3d9994=_0x4b2200;this['worker'][_0x3d9994(0x16e)]({'type':'clear'});}},this[_0x4b2200(0x183)][_0x4b2200(0xf7)](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x4f2d27(0xf1)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x4f2d27(0xd0)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports[_0x4f2d27(0x15b)]=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x4f2d27(0xe9),{'value':!![]});
}));
