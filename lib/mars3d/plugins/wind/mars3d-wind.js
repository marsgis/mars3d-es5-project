/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.4
 * 编译日期：2023-08-30 23:18:08
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x17ea5f=_0x3125;(function(_0x546385,_0x1f1ea7){const _0x34de08=_0x3125,_0x5264fc=_0x546385();while(!![]){try{const _0x514f99=-parseInt(_0x34de08(0x110))/0x1+-parseInt(_0x34de08(0xda))/0x2*(parseInt(_0x34de08(0x11a))/0x3)+-parseInt(_0x34de08(0xfb))/0x4*(parseInt(_0x34de08(0x79))/0x5)+-parseInt(_0x34de08(0x97))/0x6+-parseInt(_0x34de08(0xdc))/0x7+-parseInt(_0x34de08(0x86))/0x8*(-parseInt(_0x34de08(0x133))/0x9)+parseInt(_0x34de08(0x13c))/0xa;if(_0x514f99===_0x1f1ea7)break;else _0x5264fc['push'](_0x5264fc['shift']());}catch(_0x3390b5){_0x5264fc['push'](_0x5264fc['shift']());}}}(_0x29cd,0xca42a));function _interopNamespace(_0x2f9a6c){const _0xc8568d=_0x3125;if(_0x2f9a6c&&_0x2f9a6c['__esModule'])return _0x2f9a6c;var _0x243de8=Object[_0xc8568d(0xa3)](null);return _0x2f9a6c&&Object['keys'](_0x2f9a6c)['forEach'](function(_0x2e873a){const _0x29068a=_0xc8568d;if(_0x2e873a!==_0x29068a(0x126)){var _0xdb51b1=Object['getOwnPropertyDescriptor'](_0x2f9a6c,_0x2e873a);Object['defineProperty'](_0x243de8,_0x2e873a,_0xdb51b1['get']?_0xdb51b1:{'enumerable':!![],'get':function(){return _0x2f9a6c[_0x2e873a];}});}}),_0x243de8['default']=_0x2f9a6c,_0x243de8;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x17ea5f(0xa7)];function getU(_0x445a58,_0x237662){const _0xb5c0b7=_0x445a58*Math['cos'](Cesium$7['Math']['toRadians'](_0x237662));return _0xb5c0b7;}function getV(_0x137ca7,_0x5361f3){const _0x5bcb4e=_0x17ea5f,_0x1cb69a=_0x137ca7*Math['sin'](Cesium$7[_0x5bcb4e(0x9c)]['toRadians'](_0x5361f3));return _0x1cb69a;}function getSpeed(_0x44b2c5,_0x542cac){const _0x2979c2=Math['sqrt'](Math['pow'](_0x44b2c5,0x2)+Math['pow'](_0x542cac,0x2));return _0x2979c2;}function getDirection(_0x5b5a3d,_0x82dd37){const _0x300977=_0x17ea5f;let _0x67f7b9=Cesium$7[_0x300977(0x9c)]['toDegrees'](Math['atan2'](_0x82dd37,_0x5b5a3d));return _0x67f7b9+=_0x67f7b9<0x0?0x168:0x0,_0x67f7b9;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x17ea5f(0xa7)];class CustomPrimitive{constructor(_0x58df0b){const _0x2bd7a4=_0x17ea5f;this['commandType']=_0x58df0b['commandType'],this['geometry']=_0x58df0b['geometry'],this['attributeLocations']=_0x58df0b['attributeLocations'],this[_0x2bd7a4(0x144)]=_0x58df0b[_0x2bd7a4(0x144)],this[_0x2bd7a4(0xa1)]=_0x58df0b['uniformMap'],this['vertexShaderSource']=_0x58df0b['vertexShaderSource'],this['fragmentShaderSource']=_0x58df0b[_0x2bd7a4(0x85)],this['rawRenderState']=_0x58df0b['rawRenderState'],this['framebuffer']=_0x58df0b['framebuffer'],this['outputTexture']=_0x58df0b[_0x2bd7a4(0x122)],this['autoClear']=_0x58df0b['autoClear']??![],this['preExecute']=_0x58df0b['preExecute'],this[_0x2bd7a4(0x114)]=!![],this['commandToExecute']=undefined,this[_0x2bd7a4(0x81)]=undefined,this[_0x2bd7a4(0xde)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x2bd7a4(0x121)][_0x2bd7a4(0x11e)]}));}['createCommand'](_0x26058e){const _0x35198f=_0x17ea5f;switch(this[_0x35198f(0x154)]){case'Draw':{const _0xb4d69f=Cesium$6['VertexArray']['fromGeometry']({'context':_0x26058e,'geometry':this[_0x35198f(0xc0)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x35198f(0x12f)][_0x35198f(0xd2)]}),_0x387d4a=Cesium$6['ShaderProgram']['fromCache']({'context':_0x26058e,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x35198f(0x85)]}),_0x27c09c=Cesium$6[_0x35198f(0xb6)]['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x387d4a,'vertexArray':_0xb4d69f,'modelMatrix':Cesium$6[_0x35198f(0x14c)]['IDENTITY'],'renderState':_0x27c09c,'uniformMap':this[_0x35198f(0xa1)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x35198f(0x11e)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x35198f(0x85)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0x17ea5f(0x138)](_0x1913b0,_0x19e6dd){const _0x221337=_0x17ea5f;this['geometry']=_0x19e6dd;const _0x34e975=Cesium$6[_0x221337(0x12c)]['fromGeometry']({'context':_0x1913b0,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x221337(0x12f)]['STATIC_DRAW']});this[_0x221337(0xc3)]['vertexArray']=_0x34e975;}[_0x17ea5f(0xf6)](_0x2a84bd){const _0x1eeaae=_0x17ea5f;if(!this['show'])return;if(_0x2a84bd[_0x1eeaae(0x101)]!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6[_0x1eeaae(0xc5)](this[_0x1eeaae(0xc3)])&&(this['commandToExecute']=this['createCommand'](_0x2a84bd['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0x1eeaae(0xc5)](this['clearCommand'])&&_0x2a84bd['commandList']['push'](this['clearCommand']),_0x2a84bd[_0x1eeaae(0xbd)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x125169=_0x17ea5f;if(this[_0x125169(0x81)]){var _0x190120,_0x284bd0;(_0x190120=this['clearCommand'])!==null&&_0x190120!==void 0x0&&_0x190120['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x284bd0=this['clearCommand'])!==null&&_0x284bd0!==void 0x0&&_0x284bd0['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this[_0x125169(0xc3)]&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x125169(0xe4)](),this[_0x125169(0xc3)]['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x125169(0xc3)]),Cesium$6[_0x125169(0x76)](this);}}const Cesium$5=mars3d__namespace[_0x17ea5f(0xa7)],Util=(function(){const _0xc545d5=function(){const _0x287035=_0x3125,_0x446813=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x287035(0x125))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x287035(0xfc)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x287035(0x116))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x446813;},_0x59695d=function(_0x1da398,_0x2f3599){const _0x501968=_0x3125;if(Cesium$5[_0x501968(0xc5)](_0x2f3599)){const _0x4b6a76={};_0x4b6a76['arrayBufferView']=_0x2f3599,_0x1da398['source']=_0x4b6a76;}const _0xafa383=new Cesium$5['Texture'](_0x1da398);return _0xafa383;},_0xd64943=function(_0x3bdd8b,_0xcc52d0,_0xe3c53e){const _0x1c188d=new Cesium$5['Framebuffer']({'context':_0x3bdd8b,'colorTextures':[_0xcc52d0],'depthTexture':_0xe3c53e});return _0x1c188d;},_0x4dd8e8=function(_0x4a3106){const _0x365bd8=_0x3125,_0x4a2839=!![],_0x25c714=![],_0x914bbe={'viewport':_0x4a3106[_0x365bd8(0x140)],'depthTest':_0x4a3106[_0x365bd8(0xd7)],'depthMask':_0x4a3106['depthMask'],'blending':_0x4a3106['blending']},_0x591c0f=Cesium$5[_0x365bd8(0x14e)][_0x365bd8(0xed)](_0x4a2839,_0x25c714,_0x914bbe);return _0x591c0f;},_0x261552=function(_0x32affe){const _0x664621=_0x3125,_0x410c53={},_0x4e0ef1=Cesium$5['Math']['mod'](_0x32affe['west'],Cesium$5[_0x664621(0x9c)]['TWO_PI']),_0x5594af=Cesium$5[_0x664621(0x9c)]['mod'](_0x32affe[_0x664621(0x13f)],Cesium$5['Math'][_0x664621(0x83)]),_0x3ca4a0=_0x32affe['width'];let _0x5129ac,_0x7a1afe;_0x3ca4a0>Cesium$5['Math'][_0x664621(0xb0)]?(_0x5129ac=0x0,_0x7a1afe=Cesium$5[_0x664621(0x9c)][_0x664621(0x83)]):_0x5594af-_0x4e0ef1<_0x3ca4a0?(_0x5129ac=_0x4e0ef1,_0x7a1afe=_0x4e0ef1+_0x3ca4a0):(_0x5129ac=_0x4e0ef1,_0x7a1afe=_0x5594af);_0x410c53[_0x664621(0x95)]={'min':Cesium$5[_0x664621(0x9c)]['toDegrees'](_0x5129ac),'max':Cesium$5[_0x664621(0x9c)]['toDegrees'](_0x7a1afe)};const _0x9bfad9=_0x32affe[_0x664621(0x117)],_0x92fc38=_0x32affe['north'],_0x513dcc=_0x32affe[_0x664621(0x80)],_0x5a49a6=_0x513dcc>Cesium$5['Math']['PI']/0xc?_0x513dcc/0x2:0x0;let _0x480c54=Cesium$5['Math'][_0x664621(0xfe)](_0x9bfad9-_0x5a49a6),_0x5a6250=Cesium$5[_0x664621(0x9c)]['clampToLatitudeRange'](_0x92fc38+_0x5a49a6);return _0x480c54<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x480c54=-Cesium$5['Math']['PI_OVER_TWO']),_0x5a6250>Cesium$5['Math'][_0x664621(0xcb)]&&(_0x5a6250=Cesium$5['Math']['PI_OVER_TWO']),_0x410c53['lat']={'min':Cesium$5['Math']['toDegrees'](_0x480c54),'max':Cesium$5['Math'][_0x664621(0x14a)](_0x5a6250)},_0x410c53;};return{'getFullscreenQuad':_0xc545d5,'createTexture':_0x59695d,'createFramebuffer':_0xd64943,'createRawRenderState':_0x4dd8e8,'viewRectangleToLonLatRange':_0x261552};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag=_0x17ea5f(0x103),fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x17ea5f(0xa7)];class ParticlesRendering{constructor(_0x2977f2,_0x20e429,_0x46c8a4,_0x24fcc3,_0x3a9b67){const _0x4baa3d=_0x17ea5f;this['createRenderingTextures'](_0x2977f2,_0x20e429,_0x46c8a4[_0x4baa3d(0xaa)]),this['createRenderingFramebuffers'](_0x2977f2),this[_0x4baa3d(0xd1)](_0x2977f2,_0x46c8a4,_0x24fcc3,_0x3a9b67);}[_0x17ea5f(0xcc)](_0x51393c,_0x318685,_0x4c8fab){const _0x2c84ec=_0x17ea5f,_0x194782={'context':_0x51393c,'width':_0x51393c['drawingBufferWidth'],'height':_0x51393c[_0x2c84ec(0xe8)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x2c84ec(0xd9)]['UNSIGNED_BYTE']},_0x5e3886={'context':_0x51393c,'width':_0x51393c['drawingBufferWidth'],'height':_0x51393c[_0x2c84ec(0xe8)],'pixelFormat':Cesium$4['PixelFormat'][_0x2c84ec(0x150)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x2a92ae=_0x4c8fab['length'],_0xdbb530=new Float32Array(_0x2a92ae*0x3);for(let _0x580834=0x0;_0x580834<_0x2a92ae;_0x580834++){const _0x1f943b=Cesium$4['Color']['fromCssColorString'](_0x4c8fab[_0x580834]);_0xdbb530[0x3*_0x580834]=_0x1f943b[_0x2c84ec(0x111)],_0xdbb530[0x3*_0x580834+0x1]=_0x1f943b['green'],_0xdbb530[0x3*_0x580834+0x2]=_0x1f943b['blue'];}const _0x36cc98={'context':_0x51393c,'width':_0x2a92ae,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x2c84ec(0xd9)][_0x2c84ec(0x94)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x194782),'segmentsDepth':Util['createTexture'](_0x5e3886),'currentTrailsColor':Util['createTexture'](_0x194782),'currentTrailsDepth':Util[_0x2c84ec(0x13d)](_0x5e3886),'nextTrailsColor':Util['createTexture'](_0x194782),'nextTrailsDepth':Util[_0x2c84ec(0x13d)](_0x5e3886),'colorTable':Util['createTexture'](_0x36cc98,_0xdbb530)};}[_0x17ea5f(0xbe)](_0x2d6583){const _0x2d7494=_0x17ea5f;this['framebuffers']={'segments':Util[_0x2d7494(0xad)](_0x2d6583,this['textures']['segmentsColor'],this[_0x2d7494(0x107)][_0x2d7494(0xfd)]),'currentTrails':Util['createFramebuffer'](_0x2d6583,this['textures']['currentTrailsColor'],this[_0x2d7494(0x107)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x2d6583,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x44aa9c){const _0x294f30=_0x17ea5f,_0x501d28=0x4;let _0x2acbce=[];for(let _0x3b5df6=0x0;_0x3b5df6<_0x44aa9c[_0x294f30(0x7f)];_0x3b5df6++){for(let _0x4dbbae=0x0;_0x4dbbae<_0x44aa9c[_0x294f30(0x7f)];_0x4dbbae++){for(let _0x5569cd=0x0;_0x5569cd<_0x501d28;_0x5569cd++){_0x2acbce[_0x294f30(0x7e)](_0x3b5df6/_0x44aa9c['particlesTextureSize']),_0x2acbce['push'](_0x4dbbae/_0x44aa9c['particlesTextureSize']);}}}_0x2acbce=new Float32Array(_0x2acbce);let _0x5a544b=[];const _0x2b3476=[-0x1,0x1],_0x4be183=[-0x1,0x1];for(let _0x4e7e9c=0x0;_0x4e7e9c<_0x44aa9c[_0x294f30(0x9a)];_0x4e7e9c++){for(let _0x184bfd=0x0;_0x184bfd<_0x501d28/0x2;_0x184bfd++){for(let _0x27496c=0x0;_0x27496c<_0x501d28/0x2;_0x27496c++){_0x5a544b['push'](_0x2b3476[_0x184bfd]),_0x5a544b['push'](_0x4be183[_0x27496c]),_0x5a544b[_0x294f30(0x7e)](0x0);}}}_0x5a544b=new Float32Array(_0x5a544b);const _0x23d3d2=0x6*_0x44aa9c['maxParticles'],_0x4c5c90=new Uint32Array(_0x23d3d2);for(let _0x19e2c6=0x0,_0x4079bc=0x0,_0x4c5fcb=0x0;_0x19e2c6<_0x44aa9c['maxParticles'];_0x19e2c6++){_0x4c5c90[_0x4079bc++]=_0x4c5fcb+0x0,_0x4c5c90[_0x4079bc++]=_0x4c5fcb+0x1,_0x4c5c90[_0x4079bc++]=_0x4c5fcb+0x2,_0x4c5c90[_0x4079bc++]=_0x4c5fcb+0x2,_0x4c5c90[_0x4079bc++]=_0x4c5fcb+0x1,_0x4c5c90[_0x4079bc++]=_0x4c5fcb+0x3,_0x4c5fcb+=0x4;}const _0x61a5b9=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x2acbce}),'normal':new Cesium$4[(_0x294f30(0x116))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x5a544b})}),'indices':_0x4c5c90});return _0x61a5b9;}['createRenderingPrimitives'](_0x1e38c9,_0x1a14a7,_0x2127a0,_0x54d794){const _0x4d0c0f=_0x17ea5f,_0xf71efa=this;this[_0x4d0c0f(0x105)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x1a14a7),'primitiveType':Cesium$4['PrimitiveType'][_0x4d0c0f(0x11d)],'uniformMap':{'currentParticlesPosition':function(){return _0x54d794['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x54d794['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x54d794['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x56deb8=_0x4d0c0f;return _0xf71efa['textures'][_0x56deb8(0x9e)];},'aspect':function(){return _0x1e38c9['drawingBufferWidth']/_0x1e38c9['drawingBufferHeight'];},'pixelSize':function(){const _0x561421=_0x4d0c0f;return _0x2127a0[_0x561421(0x88)];},'lineWidth':function(){return _0x1a14a7['lineWidth'];},'particleHeight':function(){return _0x1a14a7['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x4d0c0f(0x109))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0xf71efa['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x2c256d=_0x4d0c0f;return _0xf71efa['textures'][_0x2c256d(0xfd)];},'currentTrailsColor':function(){const _0x3604c8=_0x4d0c0f;return _0xf71efa[_0x3604c8(0xf5)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0xf71efa['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){const _0x2de1d8=_0x4d0c0f;return _0x1a14a7[_0x2de1d8(0xbb)];}},'vertexShaderSource':new Cesium$4[(_0x4d0c0f(0x109))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x4d0c0f(0x109))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x4d0c0f(0xf0)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x4d0c0f(0xf5)][_0x4d0c0f(0x137)],'autoClear':!![],'preExecute':function(){const _0x6474be=_0x4d0c0f,_0x1ddb2b=_0xf71efa[_0x6474be(0xf5)][_0x6474be(0x136)];_0xf71efa['framebuffers'][_0x6474be(0x136)]=_0xf71efa['framebuffers']['nextTrails'],_0xf71efa[_0x6474be(0xf5)][_0x6474be(0x137)]=_0x1ddb2b,_0xf71efa['primitives']['trails']['commandToExecute']['framebuffer']=_0xf71efa[_0x6474be(0xf5)]['nextTrails'],_0xf71efa['primitives']['trails'][_0x6474be(0x81)]['framebuffer']=_0xf71efa['framebuffers'][_0x6474be(0x137)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x4d0c0f(0x148)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x551be7=_0x4d0c0f;return _0xf71efa[_0x551be7(0xf5)]['nextTrails'][_0x551be7(0x104)](0x0);},'trailsDepthTexture':function(){const _0x5c779a=_0x4d0c0f;return _0xf71efa[_0x5c779a(0xf5)]['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x4d0c0f(0x109))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x17ea5f(0x112),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x17ea5f(0xbf),postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x579ee9,_0x1641f2,_0x42a2ea,_0x235d51){const _0x3f40bc=_0x17ea5f;this[_0x3f40bc(0xf1)]=_0x1641f2,this['createWindTextures'](_0x579ee9,_0x1641f2),this[_0x3f40bc(0x87)](_0x579ee9,_0x42a2ea,_0x235d51),this['createComputingPrimitives'](_0x1641f2,_0x42a2ea,_0x235d51);}['createWindTextures'](_0x2ee2bc,_0x4e1e7e){const _0x466ad8=_0x17ea5f,_0x158e5b={'context':_0x2ee2bc,'width':_0x4e1e7e['dimensions'][_0x466ad8(0x95)],'height':_0x4e1e7e['dimensions']['lat']*(_0x4e1e7e[_0x466ad8(0xf3)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x466ad8(0xd9)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x466ad8(0xef)]['NEAREST'],'magnificationFilter':Cesium$3[_0x466ad8(0x123)]['NEAREST']})};this[_0x466ad8(0xc6)]={'U':Util['createTexture'](_0x158e5b,_0x4e1e7e['U'][_0x466ad8(0xb8)]),'V':Util[_0x466ad8(0x13d)](_0x158e5b,_0x4e1e7e['V']['array'])};}['createParticlesTextures'](_0x1d4ad7,_0x50ae05,_0x133ff8){const _0x195d29=_0x17ea5f,_0x2e34bb={'context':_0x1d4ad7,'width':_0x50ae05[_0x195d29(0x7f)],'height':_0x50ae05['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x195d29(0xaf)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0xbb82c0=this['randomizeParticles'](_0x50ae05['maxParticles'],_0x133ff8),_0x20b7ca=new Float32Array(0x4*_0x50ae05[_0x195d29(0x9a)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x2e34bb),'currentParticlesPosition':Util['createTexture'](_0x2e34bb,_0xbb82c0),'nextParticlesPosition':Util['createTexture'](_0x2e34bb,_0xbb82c0),'currentParticlesSpeed':Util['createTexture'](_0x2e34bb,_0x20b7ca),'nextParticlesSpeed':Util['createTexture'](_0x2e34bb,_0x20b7ca),'postProcessingPosition':Util[_0x195d29(0x13d)](_0x2e34bb,_0xbb82c0),'postProcessingSpeed':Util['createTexture'](_0x2e34bb,_0x20b7ca)};}['randomizeParticles'](_0x340fdc,_0x532c67){const _0x5defe2=_0x17ea5f,_0x3a73b5=new Float32Array(0x4*_0x340fdc);for(let _0x31dc85=0x0;_0x31dc85<_0x340fdc;_0x31dc85++){_0x3a73b5[0x4*_0x31dc85]=Cesium$3['Math']['randomBetween'](_0x532c67['lonRange']['x'],_0x532c67['lonRange']['y']),_0x3a73b5[0x4*_0x31dc85+0x1]=Cesium$3['Math']['randomBetween'](_0x532c67['latRange']['x'],_0x532c67['latRange']['y']),_0x3a73b5[0x4*_0x31dc85+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this[_0x5defe2(0xf1)][_0x5defe2(0xf8)][_0x5defe2(0x89)]),_0x3a73b5[0x4*_0x31dc85+0x3]=0x0;}return _0x3a73b5;}['destroyParticlesTextures'](){const _0x4a24ce=_0x17ea5f;Object[_0x4a24ce(0xfa)](this[_0x4a24ce(0xa6)])['forEach'](_0x44f901=>{this['particlesTextures'][_0x44f901]['destroy']();});}['createComputingPrimitives'](_0x36f85d,_0x519a5c,_0x3f7686){const _0x499724=_0x17ea5f,_0x308194=new Cesium$3['Cartesian3'](_0x36f85d['dimensions']['lon'],_0x36f85d[_0x499724(0xf3)]['lat'],_0x36f85d['dimensions'][_0x499724(0xf8)]),_0xc5af93=new Cesium$3['Cartesian3'](_0x36f85d['lon']['min'],_0x36f85d[_0x499724(0x147)]['min'],_0x36f85d['lev']['min']),_0x2b6f28=new Cesium$3[(_0x499724(0x12a))](_0x36f85d['lon']['max'],_0x36f85d['lat'][_0x499724(0x89)],_0x36f85d['lev']['max']),_0x20c76c=new Cesium$3['Cartesian3']((_0x2b6f28['x']-_0xc5af93['x'])/(_0x308194['x']-0x1),(_0x2b6f28['y']-_0xc5af93['y'])/(_0x308194['y']-0x1),_0x308194['z']>0x1?(_0x2b6f28['z']-_0xc5af93['z'])/(_0x308194['z']-0x1):0x1),_0x4cf0f8=new Cesium$3['Cartesian2'](_0x36f85d['U']['min'],_0x36f85d['U']['max']),_0x1aeaf8=new Cesium$3['Cartesian2'](_0x36f85d['V'][_0x499724(0x10c)],_0x36f85d['V'][_0x499724(0x89)]),_0x51c119=this;this[_0x499724(0x105)]={'getWind':new CustomPrimitive({'commandType':_0x499724(0xf7),'uniformMap':{'U':function(){const _0x4bab06=_0x499724;return _0x51c119[_0x4bab06(0xc6)]['U'];},'V':function(){return _0x51c119['windTextures']['V'];},'currentParticlesPosition':function(){return _0x51c119['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x308194;},'minimum':function(){return _0xc5af93;},'maximum':function(){return _0x2b6f28;},'interval':function(){return _0x20c76c;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x499724(0xd8)],'preExecute':function(){_0x51c119['primitives']['getWind']['commandToExecute']['outputTexture']=_0x51c119['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x5cea55=_0x499724;return _0x51c119[_0x5cea55(0xa6)]['currentParticlesSpeed'];},'particlesWind':function(){const _0x286157=_0x499724;return _0x51c119['particlesTextures'][_0x286157(0xd8)];},'uSpeedRange':function(){return _0x4cf0f8;},'vSpeedRange':function(){return _0x1aeaf8;},'pixelSize':function(){return _0x3f7686['pixelSize'];},'speedFactor':function(){return _0x519a5c['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x4717f2=_0x499724,_0x633fc5=_0x51c119['particlesTextures'][_0x4717f2(0x93)];_0x51c119[_0x4717f2(0xa6)][_0x4717f2(0x93)]=_0x51c119[_0x4717f2(0xa6)][_0x4717f2(0xc2)],_0x51c119['particlesTextures']['postProcessingSpeed']=_0x633fc5,_0x51c119['primitives']['updateSpeed']['commandToExecute'][_0x4717f2(0x122)]=_0x51c119['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x27088e=_0x499724;return _0x51c119[_0x27088e(0xa6)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x5beca7=_0x499724;return _0x51c119[_0x5beca7(0xa6)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x245265=_0x499724,_0xd14957=_0x51c119['particlesTextures']['currentParticlesPosition'];_0x51c119['particlesTextures'][_0x245265(0xe9)]=_0x51c119[_0x245265(0xa6)]['postProcessingPosition'],_0x51c119['particlesTextures']['postProcessingPosition']=_0xd14957,_0x51c119[_0x245265(0x105)]['updatePosition']['commandToExecute']['outputTexture']=_0x51c119['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x51c119['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x51c119['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x3f7686['lonRange'];},'latRange':function(){return _0x3f7686['latRange'];},'randomCoefficient':function(){const _0x325a5e=Math['random']();return _0x325a5e;},'dropRate':function(){return _0x519a5c['dropRate'];},'dropRateBump':function(){const _0x353350=_0x499724;return _0x519a5c[_0x353350(0xe0)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x498158=_0x499724;_0x51c119['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x51c119[_0x498158(0xa6)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x499724(0xf7),'uniformMap':{'postProcessingPosition':function(){return _0x51c119['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x51c119['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x499724(0x109))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){_0x51c119['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x51c119['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x248ae3,_0x97dc8e,_0x3982e3,_0x1f804b){const _0x2587dd=_0x17ea5f;this['context']=_0x248ae3,_0x97dc8e={..._0x97dc8e},_0x97dc8e['udata']&&_0x97dc8e[_0x2587dd(0x8f)]&&(_0x97dc8e['dimensions']={},_0x97dc8e['dimensions']['lon']=_0x97dc8e['cols'],_0x97dc8e['dimensions'][_0x2587dd(0x147)]=_0x97dc8e['rows'],_0x97dc8e[_0x2587dd(0xf3)]['lev']=_0x97dc8e['lev']||0x1,_0x97dc8e['lon']={},_0x97dc8e['lon']['min']=_0x97dc8e['xmin'],_0x97dc8e[_0x2587dd(0x95)]['max']=_0x97dc8e['xmax'],_0x97dc8e['lat']={},_0x97dc8e[_0x2587dd(0x147)]['min']=_0x97dc8e[_0x2587dd(0x10b)],_0x97dc8e['lat'][_0x2587dd(0x89)]=_0x97dc8e['ymax'],_0x97dc8e['lev']={},_0x97dc8e['lev']['min']=_0x97dc8e['levmin']??0x1,_0x97dc8e['lev']['max']=_0x97dc8e['levmax']??0x1,_0x97dc8e['U']={},_0x97dc8e['U']['array']=new Float32Array(_0x97dc8e[_0x2587dd(0xdb)]),_0x97dc8e['U']['min']=_0x97dc8e['umin']??Math['min'](..._0x97dc8e[_0x2587dd(0xdb)]),_0x97dc8e['U'][_0x2587dd(0x89)]=_0x97dc8e['umax']??Math['max'](..._0x97dc8e[_0x2587dd(0xdb)]),_0x97dc8e['V']={},_0x97dc8e['V'][_0x2587dd(0xb8)]=new Float32Array(_0x97dc8e[_0x2587dd(0x8f)]),_0x97dc8e['V'][_0x2587dd(0x10c)]=_0x97dc8e['vmin']??Math['min'](..._0x97dc8e[_0x2587dd(0x8f)]),_0x97dc8e['V']['max']=_0x97dc8e[_0x2587dd(0xd0)]??Math[_0x2587dd(0x89)](..._0x97dc8e['vdata'])),this[_0x2587dd(0xf1)]=_0x97dc8e,this['options']=_0x3982e3,this['viewerParameters']=_0x1f804b,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x2587dd(0x7d)],this['viewerParameters']),this[_0x2587dd(0x8e)]=new ParticlesRendering(this[_0x2587dd(0xa9)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x2b5366){const _0x1d7a66=_0x17ea5f;this[_0x1d7a66(0xd5)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x2d5523=>{const _0x355223=_0x1d7a66;this[_0x355223(0xd5)]['windTextures'][_0x2d5523]['destroy']();}),this[_0x1d7a66(0x8e)]['textures']['colorTable'][_0x1d7a66(0xe4)](),Object['keys'](this[_0x1d7a66(0x8e)][_0x1d7a66(0xf5)])['forEach'](_0x234fd6=>{const _0x406fcf=_0x1d7a66;this['particlesRendering'][_0x406fcf(0xf5)][_0x234fd6]['destroy']();}),this['context']=_0x2b5366,this[_0x1d7a66(0xd5)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x1d7a66(0xd3)],this[_0x1d7a66(0xd5)]);}[_0x17ea5f(0xa4)](){const _0x12ef71=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x4915de=>{const _0x22afd9=_0x3125;_0x12ef71[_0x22afd9(0xe6)]=this['particlesRendering']['framebuffers'][_0x4915de],_0x12ef71['execute'](this['context']);});}['refreshParticles'](_0x3b52a3){const _0x15a75d=_0x17ea5f;this[_0x15a75d(0xa4)](),this[_0x15a75d(0xd5)]['destroyParticlesTextures'](),this[_0x15a75d(0xd5)][_0x15a75d(0x87)](this['context'],this[_0x15a75d(0x7d)],this[_0x15a75d(0xd3)]);if(_0x3b52a3){var _0x25c327,_0x4ef837;const _0x30fef1=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering'][_0x15a75d(0x105)][_0x15a75d(0xb7)][_0x15a75d(0xc0)]=_0x30fef1;const _0x27184b=Cesium$2['VertexArray'][_0x15a75d(0x9f)]({'context':this[_0x15a75d(0xa9)],'geometry':_0x30fef1,'attributeLocations':this[_0x15a75d(0x8e)]['primitives'][_0x15a75d(0xb7)][_0x15a75d(0x106)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x25c327=this['particlesRendering']['primitives'])!==null&&_0x25c327!==void 0x0&&(_0x4ef837=_0x25c327['segments'])!==null&&_0x4ef837!==void 0x0&&_0x4ef837['commandToExecute']&&(this['particlesRendering']['primitives'][_0x15a75d(0xb7)]['commandToExecute'][_0x15a75d(0xc4)]=_0x27184b);}}['setOptions'](_0x29ba55){let _0x35d862=![];this['options']['maxParticles']!==_0x29ba55['maxParticles']&&(_0x35d862=!![]),Object['keys'](_0x29ba55)['forEach'](_0x14ac60=>{this['options'][_0x14ac60]=_0x29ba55[_0x14ac60];}),this['refreshParticles'](_0x35d862);}['applyViewerParameters'](_0x40b40a){const _0x45c49f=_0x17ea5f;Object['keys'](_0x40b40a)['forEach'](_0x304432=>{this['viewerParameters'][_0x304432]=_0x40b40a[_0x304432];}),this[_0x45c49f(0x11c)](![]);}['destroy'](){const _0x2664a6=_0x17ea5f;clearTimeout(this['canrefresh']),this[_0x2664a6(0xd5)][_0x2664a6(0xab)](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x4190aa=>{const _0x7e225e=_0x2664a6;this['particlesComputing']['windTextures'][_0x4190aa][_0x7e225e(0xe4)]();}),this[_0x2664a6(0x8e)]['textures'][_0x2664a6(0x9e)][_0x2664a6(0xe4)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x40bc69=>{this['particlesRendering']['framebuffers'][_0x40bc69]['destroy']();});for(const _0x1dfc06 in this){delete this[_0x1dfc06];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};function _0x3125(_0x26af35,_0x57a100){const _0x29cde5=_0x29cd();return _0x3125=function(_0x3125b1,_0x5edbc8){_0x3125b1=_0x3125b1-0x75;let _0x3da283=_0x29cde5[_0x3125b1];return _0x3da283;},_0x3125(_0x26af35,_0x57a100);}class WindLayer extends BaseLayer$1{constructor(_0x43063b={}){const _0x2af466=_0x17ea5f;_0x43063b={...DEF_OPTIONS,..._0x43063b},super(_0x43063b),this[_0x2af466(0x128)](_0x43063b);}get['layer'](){return this['primitives'];}get[_0x17ea5f(0xf1)](){return this['_data'];}set['data'](_0x11052b){const _0x1435dd=_0x17ea5f;this[_0x1435dd(0x129)](_0x11052b);}get['colors'](){const _0x4886af=_0x17ea5f;return this[_0x4886af(0x7d)]['colors'];}set['colors'](_0x7bef1b){const _0x2628c1=_0x17ea5f;this['options']['colors']=_0x7bef1b,this[_0x2628c1(0x119)]&&this['particleSystem']['setOptions']({'colors':_0x7bef1b}),this[_0x2628c1(0x149)]();}[_0x17ea5f(0x10f)](){}[_0x17ea5f(0x92)](){const _0x1da6ed=_0x17ea5f;this[_0x1da6ed(0x8d)]=this[_0x1da6ed(0xc8)]['scene'],this['camera']=this['_map']['camera'],this[_0x1da6ed(0x105)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this[_0x1da6ed(0x105)]),this[_0x1da6ed(0xd3)]={'lonRange':new Cesium$1[(_0x1da6ed(0xe5))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x1da6ed(0x145)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x1da6ed(0x13e)](),window['addEventListener']('resize',this[_0x1da6ed(0x149)]['bind'](this),![]),this[_0x1da6ed(0x12d)]=![],this[_0x1da6ed(0x146)]=![],this['_map']['on'](mars3d__namespace[_0x1da6ed(0xa2)][_0x1da6ed(0x135)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x1da6ed(0xa2)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x1da6ed(0xa0)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}[_0x17ea5f(0x12e)](){const _0x25b9a4=_0x17ea5f;window[_0x25b9a4(0x142)](_0x25b9a4(0x149),this[_0x25b9a4(0x149)]),this['_map'][_0x25b9a4(0x139)](mars3d__namespace['EventType'][_0x25b9a4(0xdf)],this['_onMap_preRenderEvent'],this),this[_0x25b9a4(0xc8)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x25b9a4(0xac)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x25b9a4(0xc8)]['off'](mars3d__namespace[_0x25b9a4(0xa2)][_0x25b9a4(0x9d)],this['_onMouseMoveEvent'],this),this['primitives'][_0x25b9a4(0x113)](),this['_map']['scene'][_0x25b9a4(0x105)]['remove'](this['primitives']);}['resize'](){const _0x237af9=_0x17ea5f;if(!this[_0x237af9(0x114)]||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x237af9(0x105)]['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x55c566){this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x17ea5f(0x118)](_0x5bebe6){const _0x45ff9c=_0x17ea5f;clearTimeout(this[_0x45ff9c(0x75)]);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x3c0bc0=_0x45ff9c;if(!this[_0x3c0bc0(0x114)])return;this[_0x3c0bc0(0xf9)]();},0xc8);}['_onMouseDownEvent'](_0x14cf8b){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x1a9c34){const _0x12ea70=_0x17ea5f;if(!this['show']||!this['particleSystem'])return;this[_0x12ea70(0x12d)]&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x187c7c){const _0xc271a6=_0x17ea5f;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this[_0xc271a6(0x146)]&&this['redraw'](),this['primitives'][_0xc271a6(0x114)]=!![],this[_0xc271a6(0x12d)]=![],this[_0xc271a6(0x146)]=![];}['redraw'](){const _0x1d5c55=_0x17ea5f;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0x1d5c55(0x119)]['applyViewerParameters'](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x4206c7){const _0x3f91ec=_0x17ea5f;this['_data']=_0x4206c7,this['particleSystem']&&this[_0x3f91ec(0x119)]['destroy'](),this[_0x3f91ec(0x119)]=new ParticleSystem(this['scene']['context'],_0x4206c7,this['getOptions'](),this['viewerParameters']),this[_0x3f91ec(0xc7)]();}['_setOptionsHook'](_0x237434,_0xeccc10){if(_0x237434)for(const _0x30e84a in _0x237434){this[_0x30e84a]=_0x237434[_0x30e84a];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x301752=_0x17ea5f,_0x307d52=Math[_0x301752(0xe3)](Math['sqrt'](this[_0x301752(0x127)]));return this[_0x301752(0x127)]=_0x307d52*_0x307d52,{'particlesTextureSize':_0x307d52,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x301752(0xbb)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x2c6cdb=_0x17ea5f;this['primitives']['add'](this[_0x2c6cdb(0x119)]['particlesComputing']['primitives']['getWind']),this['primitives'][_0x2c6cdb(0x153)](this['particleSystem']['particlesComputing'][_0x2c6cdb(0x105)]['updateSpeed']),this['primitives'][_0x2c6cdb(0x153)](this['particleSystem']['particlesComputing'][_0x2c6cdb(0x105)]['updatePosition']),this['primitives']['add'](this['particleSystem'][_0x2c6cdb(0xd5)][_0x2c6cdb(0x105)]['postProcessingPosition']),this['primitives'][_0x2c6cdb(0x153)](this[_0x2c6cdb(0x119)]['particlesComputing'][_0x2c6cdb(0x105)]['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives']['add'](this[_0x2c6cdb(0x119)]['particlesRendering']['primitives']['trails']),this['primitives']['add'](this['particleSystem'][_0x2c6cdb(0x8e)]['primitives']['screen']);}['updateViewerParameters'](){const _0x55995a=_0x17ea5f;let _0x1d2aeb=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x1d2aeb){const _0x1d8ea0=this['_map']['getExtent']();_0x1d2aeb=Cesium$1['Rectangle']['fromDegrees'](_0x1d8ea0[_0x55995a(0x120)],_0x1d8ea0[_0x55995a(0x10b)],_0x1d8ea0[_0x55995a(0xd4)],_0x1d8ea0['ymax']);}const _0x3c4b5e=Util['viewRectangleToLonLatRange'](_0x1d2aeb);this['viewerParameters']['lonRange']['x']=_0x3c4b5e['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x3c4b5e['lon'][_0x55995a(0x89)],this[_0x55995a(0xd3)]['latRange']['x']=_0x3c4b5e[_0x55995a(0x147)]['min'],this['viewerParameters']['latRange']['y']=_0x3c4b5e['lat']['max'];const _0x224ea2=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x224ea2>0x0&&(this['viewerParameters']['pixelSize']=_0x224ea2);}}function _0x29cd(){const _0x1b140b=['Cartesian3','lng','VertexArray','mouse_down','_removedHook','BufferUsage','getParticles','CanvasWindLayer','rows','13377267WRzTEX','mars3d-canvasWind','wheel','currentTrails','nextTrails','setGeometry','off','_onMouseMoveEvent','layer','30133430sHCzIs','createTexture','updateViewerParameters','east','viewport','canvas','removeEventListener','worker','primitiveType','globeBoundingSphere','mouse_move','lat','PrimitiveType','resize','toDegrees','_tomap','Matrix4','_colorRamp','Appearance','length','DEPTH_COMPONENT','bindEvent','style','add','commandType','getColor','refreshTimer','destroyObject','toGridXY','reverse','365LwaLUf','_speedRate','bind','SceneMode','options','push','particlesTextureSize','height','clearCommand','isPointVisible','TWO_PI','postMessage','fragmentShaderSource','8YzucQy','createParticlesTextures','pixelSize','max','onmessage','ymax','width','scene','particlesRendering','vdata','canvasWidth','canvasWind','_addedHook','currentParticlesSpeed','FLOAT','lon','windData','3945144KZcJrs','_updateIng','grid','maxParticles','age','Math','mouseMove','colorTable','fromGeometry','mouseUp','uniformMap','EventType','create','clearFramebuffers','#ffffff','particlesTextures','Cesium','_updateIng2','context','colors','destroyParticlesTextures','_onMouseDownEvent','createFramebuffer','register','RGBA','THREE_PI_OVER_TWO','top','beginPath','getUVByPoint','windField','clientHeight','RenderState','segments','array','setDate','clear','fadeOpacity','fixedHeight','commandList','createRenderingFramebuffers','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','geometry','getUVByXY','postProcessingSpeed','commandToExecute','vertexArray','defined','windTextures','addPrimitives','_map','tlat','setOptions','PI_OVER_THREE','createRenderingTextures','cols','hidden','positionWC','vmax','createRenderingPrimitives','STATIC_DRAW','viewerParameters','xmax','particlesComputing','pointerEvents','depthTest','particlesWind','PixelDatatype','536BUgBsS','udata','2083305njoAYV','requestAnimationFrame','autoClear','preRender','dropRateBump','_onMouseUpEvent','_randomParticle','ceil','destroy','Cartesian2','framebuffer','_pointerEvents','drawingBufferHeight','currentParticlesPosition','frameTime','animateFrame','init','getDefaultRenderState','_calcUV','TextureMinificationFilter','createRawRenderState','data','getRandomLatLng','dimensions','tlng','framebuffers','update','Compute','lev','redraw','keys','13564YAEAGE','ComponentDatatype','segmentsDepth','clampToLatitudeRange','clientWidth','color','mode','speedRate','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','getColorTexture','primitives','attributeLocations','textures','lineWidth','ShaderSource','abs','ymin','min','DomUtil','none','_mountedHook','1450702AcyErn','red','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','removeAll','show','initWorker','GeometryAttribute','south','_onMapWhellEvent','particleSystem','11394NfuMro','particles','refreshParticles','TRIANGLES','OPAQUE','canvasContext','xmin','Pass','outputTexture','TextureMagnificationFilter','_calc_speedRate','GeometryAttributes','default','particlesNumber','_setOptionsHook','setData'];_0x29cd=function(){return _0x1b140b;};return _0x29cd();}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x14f84a=_0x17ea5f;this['lng']=null,this['lat']=null,this[_0x14f84a(0xf4)]=null,this[_0x14f84a(0xc9)]=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x360a4a in this){delete this[_0x360a4a];}}}class CanvasWindField{constructor(_0x2557ef){const _0x1a8cd3=_0x17ea5f;this[_0x1a8cd3(0xca)](_0x2557ef);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x56c328){const _0x25b6f9=_0x17ea5f;this['_speedRate']=(0x64-(_0x56c328>0x63?0x63:_0x56c328))*0x64,this[_0x25b6f9(0x124)]=[(this['xmax']-this['xmin'])/this['_speedRate'],(this[_0x25b6f9(0x8b)]-this[_0x25b6f9(0x10b)])/this[_0x25b6f9(0x7a)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x558c79){this['_maxAge']=_0x558c79;}['setOptions'](_0x3ab91b){const _0x1f3b95=_0x17ea5f;this['options']=_0x3ab91b,this['maxAge']=_0x3ab91b['maxAge']||0x78,this['speedRate']=_0x3ab91b[_0x1f3b95(0x102)]||0x32,this[_0x1f3b95(0x11b)]=[];const _0x1083e0=_0x3ab91b['particlesNumber']||0x1000;for(let _0x1f7faf=0x0;_0x1f7faf<_0x1083e0;_0x1f7faf++){const _0x55c335=this['_randomParticle'](new CanvasParticle());this[_0x1f3b95(0x11b)]['push'](_0x55c335);}}[_0x17ea5f(0xb9)](_0x535e81){const _0x17a249=_0x17ea5f;this[_0x17a249(0x132)]=_0x535e81['rows'],this['cols']=_0x535e81['cols'],this[_0x17a249(0x120)]=_0x535e81['xmin'],this['xmax']=_0x535e81[_0x17a249(0xd4)],this['ymin']=_0x535e81['ymin'],this['ymax']=_0x535e81['ymax'],this[_0x17a249(0x99)]=[];const _0x363776=_0x535e81['udata'],_0x561df5=_0x535e81['vdata'];let _0x38f893=![];_0x363776['length']===this['rows']&&_0x363776[0x0][_0x17a249(0x14f)]===this[_0x17a249(0xcd)]&&(_0x38f893=!![]);let _0x476959=0x0,_0x11a19b=null,_0x11b33a=null;for(let _0x3a2282=0x0;_0x3a2282<this['rows'];_0x3a2282++){_0x11a19b=[];for(let _0x35111b=0x0;_0x35111b<this['cols'];_0x35111b++,_0x476959++){_0x38f893?_0x11b33a=this['_calcUV'](_0x363776[_0x3a2282][_0x35111b],_0x561df5[_0x3a2282][_0x35111b]):_0x11b33a=this[_0x17a249(0xee)](_0x363776[_0x476959],_0x561df5[_0x476959]),_0x11a19b['push'](_0x11b33a);}this['grid']['push'](_0x11a19b);}this[_0x17a249(0x7d)]['reverseY']&&this['grid'][_0x17a249(0x78)]();}['clear'](){const _0x768cc2=_0x17ea5f;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0x768cc2(0x11b)];}[_0x17ea5f(0x77)](_0x504157,_0x20d003){const _0x263aea=_0x17ea5f,_0x3878eb=(_0x504157-this[_0x263aea(0x120)])/(this['xmax']-this[_0x263aea(0x120)])*(this[_0x263aea(0xcd)]-0x1),_0x21bb60=(this['ymax']-_0x20d003)/(this['ymax']-this[_0x263aea(0x10b)])*(this[_0x263aea(0x132)]-0x1);return[_0x3878eb,_0x21bb60];}['getUVByXY'](_0x238e62,_0x515c0b){if(_0x238e62<0x0||_0x238e62>=this['cols']||_0x515c0b>=this['rows'])return[0x0,0x0,0x0];const _0x158fca=Math['floor'](_0x238e62),_0x2fe8d8=Math['floor'](_0x515c0b);if(_0x158fca===_0x238e62&&_0x2fe8d8===_0x515c0b)return this['grid'][_0x515c0b][_0x238e62];const _0x326455=_0x158fca+0x1,_0x5bb902=_0x2fe8d8+0x1,_0x1cc347=this['getUVByXY'](_0x158fca,_0x2fe8d8),_0x765c31=this['getUVByXY'](_0x326455,_0x2fe8d8),_0x580897=this['getUVByXY'](_0x158fca,_0x5bb902),_0x590707=this['getUVByXY'](_0x326455,_0x5bb902);let _0x380a6f=null;try{_0x380a6f=this['_bilinearInterpolation'](_0x238e62-_0x158fca,_0x515c0b-_0x2fe8d8,_0x1cc347,_0x765c31,_0x580897,_0x590707);}catch(_0x16f1cf){console['log'](_0x238e62,_0x515c0b);}return _0x380a6f;}['_bilinearInterpolation'](_0x553266,_0x5b25e5,_0xb3d881,_0x129045,_0x1fe636,_0x1cf2d5){const _0x387d84=0x1-_0x553266,_0x477acc=0x1-_0x5b25e5,_0x238422=_0x387d84*_0x477acc,_0x59575c=_0x553266*_0x477acc,_0x47e187=_0x387d84*_0x5b25e5,_0x42c7fd=_0x553266*_0x5b25e5,_0x2940cb=_0xb3d881[0x0]*_0x238422+_0x129045[0x0]*_0x59575c+_0x1fe636[0x0]*_0x47e187+_0x1cf2d5[0x0]*_0x42c7fd,_0x1f49f9=_0xb3d881[0x1]*_0x238422+_0x129045[0x1]*_0x59575c+_0x1fe636[0x1]*_0x47e187+_0x1cf2d5[0x1]*_0x42c7fd;return this['_calcUV'](_0x2940cb,_0x1f49f9);}[_0x17ea5f(0xee)](_0x376142,_0x46b9e4){return[+_0x376142,+_0x46b9e4,Math['sqrt'](_0x376142*_0x376142+_0x46b9e4*_0x46b9e4)];}[_0x17ea5f(0xb3)](_0x441748,_0x321f0f){const _0x1169f5=_0x17ea5f;if(!this['isInExtent'](_0x441748,_0x321f0f))return null;const _0x5b3685=this['toGridXY'](_0x441748,_0x321f0f),_0x5f0696=this[_0x1169f5(0xc1)](_0x5b3685[0x0],_0x5b3685[0x1]);return _0x5f0696;}['isInExtent'](_0x3fdd56,_0x5ac848){const _0x4e523d=_0x17ea5f;return _0x3fdd56>=this[_0x4e523d(0x120)]&&_0x3fdd56<=this['xmax']&&_0x5ac848>=this[_0x4e523d(0x10b)]&&_0x5ac848<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x4bfe04=_0x17ea5f,_0x123c02=fRandomByfloat(this['xmin'],this[_0x4bfe04(0xd4)]),_0x3a78a9=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x3a78a9,'lng':_0x123c02};}[_0x17ea5f(0x130)](){const _0x8f7e22=_0x17ea5f;let _0x107c5f,_0x5eb100,_0x184190;for(let _0xde34da=0x0,_0x52a328=this['particles'][_0x8f7e22(0x14f)];_0xde34da<_0x52a328;_0xde34da++){let _0x99f352=this['particles'][_0xde34da];_0x99f352['age']<=0x0&&(_0x99f352=this['_randomParticle'](_0x99f352));if(_0x99f352['age']>0x0){const _0x1df629=_0x99f352['tlng'],_0xebe524=_0x99f352['tlat'];_0x184190=this['getUVByPoint'](_0x1df629,_0xebe524),_0x184190?(_0x107c5f=_0x1df629+this[_0x8f7e22(0x124)][0x0]*_0x184190[0x0],_0x5eb100=_0xebe524+this[_0x8f7e22(0x124)][0x1]*_0x184190[0x1],_0x99f352[_0x8f7e22(0x12b)]=_0x1df629,_0x99f352['lat']=_0xebe524,_0x99f352['tlng']=_0x107c5f,_0x99f352['tlat']=_0x5eb100,_0x99f352['speed']=_0x184190[0x2],_0x99f352['age']--):_0x99f352['age']=0x0;}}return this[_0x8f7e22(0x11b)];}[_0x17ea5f(0xe2)](_0x5cc01e){const _0x27013c=_0x17ea5f;let _0x4dc14a,_0x330c84;for(let _0xb93cb=0x0;_0xb93cb<0x1e;_0xb93cb++){_0x4dc14a=this[_0x27013c(0xf2)](),_0x330c84=this[_0x27013c(0xb3)](_0x4dc14a['lng'],_0x4dc14a[_0x27013c(0x147)]);if(_0x330c84&&_0x330c84[0x2]>0x0)break;}if(!_0x330c84)return _0x5cc01e;const _0x2a59e4=_0x4dc14a['lng']+this['_calc_speedRate'][0x0]*_0x330c84[0x0],_0x2897cf=_0x4dc14a[_0x27013c(0x147)]+this['_calc_speedRate'][0x1]*_0x330c84[0x1];return _0x5cc01e['lng']=_0x4dc14a['lng'],_0x5cc01e[_0x27013c(0x147)]=_0x4dc14a['lat'],_0x5cc01e['tlng']=_0x2a59e4,_0x5cc01e[_0x27013c(0xc9)]=_0x2897cf,_0x5cc01e['age']=Math['round'](Math['random']()*this['maxAge']),_0x5cc01e['speed']=_0x330c84[0x2],_0x5cc01e;}['destroy'](){for(const _0x294327 in this){delete this[_0x294327];}}}function fRandomByfloat(_0x4473f7,_0x3acc7c){return _0x4473f7+Math['random']()*(_0x3acc7c-_0x4473f7);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x17ea5f(0x13b)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x48403b={}){super(_0x48403b),this['_setOptionsHook'](_0x48403b),this['canvas']=null,_0x48403b['colors']&&_0x48403b['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x48403b));}['_setOptionsHook'](_0x1ccc46,_0x2d6976){const _0x22946d=_0x17ea5f;this['frameTime']=0x3e8/(_0x1ccc46['frameRate']||0xa),this['_pointerEvents']=this[_0x22946d(0x7d)][_0x22946d(0xd6)]??![],this[_0x22946d(0x100)]=_0x1ccc46['color']||_0x22946d(0xa5),this['lineWidth']=_0x1ccc46['lineWidth']||0x1,this['fixedHeight']=_0x1ccc46[_0x22946d(0xbc)]??0x0,this['reverseY']=_0x1ccc46['reverseY']??![],this[_0x22946d(0xb4)]&&this['windField']['setOptions'](_0x1ccc46);}get['layer'](){const _0x160368=_0x17ea5f;return this[_0x160368(0x141)];}get[_0x17ea5f(0x90)](){const _0x337ab2=_0x17ea5f;return this['_map']['scene'][_0x337ab2(0x141)]['clientWidth'];}get['canvasHeight'](){const _0x2bc582=_0x17ea5f;return this[_0x2bc582(0xc8)][_0x2bc582(0x8d)]['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x5e6c01){const _0x192fb8=_0x17ea5f;this['_pointerEvents']=_0x5e6c01;if(!this['canvas'])return;_0x5e6c01?this['canvas']['style']['pointer-events']='all':this[_0x192fb8(0x141)]['style']['pointer-events']=_0x192fb8(0x10e);}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0xfe1cc8){this['options']['particlesNumber']=_0xfe1cc8,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x17ea5f(0x102)](){const _0x51622e=_0x17ea5f;return this[_0x51622e(0x7d)]['speedRate'];}set['speedRate'](_0x2320d9){const _0x12aefc=_0x17ea5f;this['options'][_0x12aefc(0x102)]=_0x2320d9,this['windField']&&(this['windField']['speedRate']=_0x2320d9);}get['maxAge'](){const _0x3c5e67=_0x17ea5f;return this[_0x3c5e67(0x7d)]['maxAge'];}set['maxAge'](_0x1ba7b3){this['options']['maxAge']=_0x1ba7b3,this['windField']&&(this['windField']['maxAge']=_0x1ba7b3);}get['data'](){return this['windData'];}set['data'](_0x3bdddf){const _0x20eed6=_0x17ea5f;this[_0x20eed6(0x129)](_0x3bdddf);}['_showHook'](_0x5d3610){const _0x5c2c1c=_0x17ea5f;_0x5d3610?this['_addedHook']():(this[_0x5c2c1c(0x96)]&&(this[_0x5c2c1c(0x7d)]['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x70077a=_0x17ea5f;this[_0x70077a(0x7d)][_0x70077a(0x143)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x3aaa3f=_0x17ea5f;this['canvas']=this['_createCanvas'](),this['canvasContext']=this[_0x3aaa3f(0x141)]['getContext']('2d',{'willReadFrequently':!![]}),this[_0x3aaa3f(0x151)](),this['options'][_0x3aaa3f(0xf1)]&&this[_0x3aaa3f(0x129)](this['options']['data']);}['_removedHook'](){const _0x3ecae4=_0x17ea5f;this['clear'](),this['unbindEvent'](),this['canvas']&&(this[_0x3ecae4(0xc8)]['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x3baac1=_0x17ea5f,_0x1e0edd=mars3d__namespace[_0x3baac1(0x10d)]['create'](_0x3baac1(0x141),_0x3baac1(0x134),this['_map']['container']);return _0x1e0edd['style']['position']='absolute',_0x1e0edd[_0x3baac1(0x152)][_0x3baac1(0xb1)]='0px',_0x1e0edd[_0x3baac1(0x152)]['left']='0px',_0x1e0edd['style']['width']=this[_0x3baac1(0xc8)]['scene']['canvas']['clientWidth']+'px',_0x1e0edd['style']['height']=this[_0x3baac1(0xc8)][_0x3baac1(0x8d)]['canvas']['clientHeight']+'px',_0x1e0edd[_0x3baac1(0x152)]['pointerEvents']=this[_0x3baac1(0xe7)]?'auto':_0x3baac1(0x10e),_0x1e0edd[_0x3baac1(0x152)]['zIndex']=this[_0x3baac1(0x7d)]['zIndex']??0x9,_0x1e0edd['width']=this[_0x3baac1(0xc8)]['scene']['canvas']['clientWidth'],_0x1e0edd[_0x3baac1(0x80)]=this['_map']['scene']['canvas']['clientHeight'],_0x1e0edd;}['resize'](){const _0x3bda07=_0x17ea5f;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this[_0x3bda07(0x141)]['style']['height']=this[_0x3bda07(0xc8)][_0x3bda07(0x8d)][_0x3bda07(0x141)][_0x3bda07(0xb5)]+'px',this['canvas'][_0x3bda07(0x8c)]=this['_map']['scene']['canvas'][_0x3bda07(0xff)],this['canvas']['height']=this[_0x3bda07(0xc8)]['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x33fd9c=_0x17ea5f,_0x42783c=this;let _0x548986=Date['now']();(function _0x38360f(){const _0x516988=_0x3125;_0x42783c['animateFrame']=window[_0x516988(0xdd)](_0x38360f);if(_0x42783c['show']&&_0x42783c['windField']){const _0x1312bd=Date['now'](),_0x4297aa=_0x1312bd-_0x548986;_0x4297aa>_0x42783c[_0x516988(0xea)]&&(_0x548986=_0x1312bd-_0x4297aa%_0x42783c['frameTime'],_0x42783c[_0x516988(0xf6)]());}}(),window['addEventListener']('resize',this[_0x33fd9c(0x149)][_0x33fd9c(0x7b)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this[_0x33fd9c(0xc8)]['on'](mars3d__namespace['EventType'][_0x33fd9c(0x135)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x33fd9c(0xa2)]['mouseUp'],this[_0x33fd9c(0xe1)],this)));}['unbindEvent'](){const _0x10477c=_0x17ea5f;window['cancelAnimationFrame'](this[_0x10477c(0xeb)]),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x10477c(0x149)]),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x10477c(0xc8)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x10477c(0xe1)],this),this['_map'][_0x10477c(0x139)](mars3d__namespace[_0x10477c(0xa2)]['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x6495f6){const _0xf40b9d=_0x17ea5f;clearTimeout(this['refreshTimer']);if(!this[_0xf40b9d(0x114)]||!this['canvas'])return;this[_0xf40b9d(0x141)]['style']['visibility']=_0xf40b9d(0xce),this['refreshTimer']=setTimeout(()=>{const _0x4c9c49=_0xf40b9d;if(!this['show'])return;this['redraw'](),this[_0x4c9c49(0x141)]['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x1d2b70){const _0x14f7a4=_0x17ea5f;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x14f7a4(0x9d)],this['_onMouseMoveEvent'],this),this[_0x14f7a4(0xc8)]['on'](mars3d__namespace[_0x14f7a4(0xa2)]['mouseMove'],this[_0x14f7a4(0x13a)],this);}['_onMouseMoveEvent'](_0x2e1841){const _0x5900c7=_0x17ea5f;if(!this['show']||!this[_0x5900c7(0x141)])return;this['mouse_down']&&(this['canvas']['style']['visibility']=_0x5900c7(0xce),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x426190){const _0x348aaf=_0x17ea5f;if(!this[_0x348aaf(0x114)]||!this['canvas'])return;this[_0x348aaf(0xc8)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x348aaf(0x12d)]&&this['mouse_move']&&this['redraw'](),this[_0x348aaf(0x141)]['style']['visibility']='visible',this[_0x348aaf(0x12d)]=![],this[_0x348aaf(0x146)]=![];}['setData'](_0x35e287){const _0x51aa52=_0x17ea5f;this['clear'](),this['windData']=_0x35e287,this[_0x51aa52(0xb4)]['setDate'](_0x35e287),this['redraw']();}[_0x17ea5f(0xf9)](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}[_0x17ea5f(0xf6)](){const _0x39cb6d=_0x17ea5f;if(this[_0x39cb6d(0x98)])return;this[_0x39cb6d(0x98)]=!![];if(this['worker'])this['windField']['update']();else{const _0x1febed=this['windField']['getParticles']();this['_drawLines'](_0x1febed);}this['_updateIng']=![];}['_drawLines'](_0x4caa8d){const _0x2abb91=_0x17ea5f;this[_0x2abb91(0x11f)]['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x47cdaa=this['_map']['scene']['mode']!==Cesium[_0x2abb91(0x7c)]['SCENE3D'],_0x3f831e=this[_0x2abb91(0x90)]*0.25;if(this[_0x2abb91(0x14d)])for(let _0x163a9b=0x0,_0x16b139=_0x4caa8d['length'];_0x163a9b<_0x16b139;_0x163a9b++){const _0x47546d=_0x4caa8d[_0x163a9b],_0x222b63=this['_tomap'](_0x47546d['lng'],_0x47546d[_0x2abb91(0x147)],_0x47546d),_0xfe6f4b=this[_0x2abb91(0x14b)](_0x47546d[_0x2abb91(0xf4)],_0x47546d['tlat'],_0x47546d);if(!_0x222b63||!_0xfe6f4b)continue;if(_0x47cdaa&&Math[_0x2abb91(0x10a)](_0x222b63[0x0]-_0xfe6f4b[0x0])>=_0x3f831e)continue;this[_0x2abb91(0x11f)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x2abb91(0x14d)][_0x2abb91(0x155)](_0x47546d['speed']),this['canvasContext']['moveTo'](_0x222b63[0x0],_0x222b63[0x1]),this['canvasContext']['lineTo'](_0xfe6f4b[0x0],_0xfe6f4b[0x1]),this[_0x2abb91(0x11f)]['stroke']();}else{this['canvasContext'][_0x2abb91(0xb2)](),this['canvasContext'][_0x2abb91(0x108)]=this[_0x2abb91(0x108)],this[_0x2abb91(0x11f)]['strokeStyle']=this['color'];for(let _0x183c20=0x0,_0x2d4c7a=_0x4caa8d[_0x2abb91(0x14f)];_0x183c20<_0x2d4c7a;_0x183c20++){const _0x1f7ce2=_0x4caa8d[_0x183c20],_0x37130e=this['_tomap'](_0x1f7ce2[_0x2abb91(0x12b)],_0x1f7ce2[_0x2abb91(0x147)],_0x1f7ce2),_0x39a744=this['_tomap'](_0x1f7ce2['tlng'],_0x1f7ce2[_0x2abb91(0xc9)],_0x1f7ce2);if(!_0x37130e||!_0x39a744)continue;if(_0x47cdaa&&Math['abs'](_0x37130e[0x0]-_0x39a744[0x0])>=_0x3f831e)continue;this['canvasContext']['moveTo'](_0x37130e[0x0],_0x37130e[0x1]),this[_0x2abb91(0x11f)]['lineTo'](_0x39a744[0x0],_0x39a744[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x577e86,_0x88be8b,_0x99e0ff){const _0x4466ca=_0x17ea5f,_0x31f27d=Cesium['Cartesian3']['fromDegrees'](_0x577e86,_0x88be8b,this['fixedHeight']),_0x1a2f0c=this[_0x4466ca(0xc8)]['scene'];if(_0x1a2f0c['mode']===Cesium['SceneMode']['SCENE3D']){const _0x1e531b=new Cesium['EllipsoidalOccluder'](_0x1a2f0c['globe']['ellipsoid'],_0x1a2f0c['camera'][_0x4466ca(0xcf)]),_0x4fa1ff=_0x1e531b[_0x4466ca(0x82)](_0x31f27d);if(!_0x4fa1ff)return _0x99e0ff[_0x4466ca(0x9b)]=0x0,null;}const _0x25e41f=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x31f27d);return _0x25e41f?[_0x25e41f['x'],_0x25e41f['y']]:null;}[_0x17ea5f(0xba)](){const _0x3f4da8=_0x17ea5f;this[_0x3f4da8(0xb4)][_0x3f4da8(0xba)](),delete this[_0x3f4da8(0x96)];}[_0x17ea5f(0x115)](){const _0x319195=_0x17ea5f;this[_0x319195(0x143)]=new Worker(this['options']['worker']),this[_0x319195(0x143)][_0x319195(0x8a)]=_0x2a0a79=>{const _0x4f325b=_0x319195;this['_drawLines'](_0x2a0a79[_0x4f325b(0xf1)][_0x4f325b(0x11b)]),this['_updateIng2']=![];},this['windField']={'init':_0x4da8e0=>{const _0x2896c4=_0x319195;this['worker']['postMessage']({'type':_0x2896c4(0xec),'options':_0x4da8e0});},'setOptions':_0x22f85a=>{const _0x9587d2=_0x319195;this[_0x9587d2(0x143)]['postMessage']({'type':'setOptions','options':_0x22f85a});},'setDate':_0x5eeae0=>{const _0x322a0b=_0x319195;this['worker']['postMessage']({'type':_0x322a0b(0xb9),'data':_0x5eeae0});},'update':()=>{const _0x24fcd6=_0x319195;if(this['_updateIng2'])return;this[_0x24fcd6(0xa8)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x55d15a=_0x319195;this['worker'][_0x55d15a(0x84)]({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil'][_0x17ea5f(0xae)](_0x17ea5f(0x91),CanvasWindLayer),mars3d__namespace[_0x17ea5f(0x13b)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x17ea5f(0x131)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
