/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.7
 * 编译日期：2023-05-16 21:11:52
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x55dedb=_0x50b8;(function(_0x5bca28,_0x3d0857){const _0x41c881=_0x50b8,_0x3f00d0=_0x5bca28();while(!![]){try{const _0xc94172=parseInt(_0x41c881(0x155))/0x1+-parseInt(_0x41c881(0x152))/0x2+-parseInt(_0x41c881(0x17f))/0x3*(parseInt(_0x41c881(0x164))/0x4)+parseInt(_0x41c881(0x175))/0x5*(-parseInt(_0x41c881(0x160))/0x6)+parseInt(_0x41c881(0x1c1))/0x7*(parseInt(_0x41c881(0x17e))/0x8)+parseInt(_0x41c881(0x1e1))/0x9+parseInt(_0x41c881(0x125))/0xa;if(_0xc94172===_0x3d0857)break;else _0x3f00d0['push'](_0x3f00d0['shift']());}catch(_0x11be88){_0x3f00d0['push'](_0x3f00d0['shift']());}}}(_0x1710,0x3e486));function _interopNamespace(_0x5da1f1){if(_0x5da1f1&&_0x5da1f1['__esModule'])return _0x5da1f1;var _0x129d6b=Object['create'](null);return _0x5da1f1&&Object['keys'](_0x5da1f1)['forEach'](function(_0x378804){const _0x439017=_0x50b8;if(_0x378804!=='default'){var _0x393f47=Object[_0x439017(0x131)](_0x5da1f1,_0x378804);Object['defineProperty'](_0x129d6b,_0x378804,_0x393f47[_0x439017(0x120)]?_0x393f47:{'enumerable':!![],'get':function(){return _0x5da1f1[_0x378804];}});}}),_0x129d6b['default']=_0x5da1f1,_0x129d6b;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x55dedb(0x1ca)];function getU(_0x517ec,_0x1966b6){const _0x25aeca=_0x517ec*Math['cos'](Cesium$7['Math']['toRadians'](_0x1966b6));return _0x25aeca;}function getV(_0x50f1ea,_0xaed48){const _0x208a88=_0x55dedb,_0x127d14=_0x50f1ea*Math['sin'](Cesium$7['Math'][_0x208a88(0x13b)](_0xaed48));return _0x127d14;}function getSpeed(_0x37de15,_0x3c4b44){const _0x1c1304=_0x55dedb,_0x564234=Math['sqrt'](Math['pow'](_0x37de15,0x2)+Math[_0x1c1304(0x1b9)](_0x3c4b44,0x2));return _0x564234;}function getDirection(_0x6ceab6,_0x46c159){let _0x280549=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x46c159,_0x6ceab6));return _0x280549+=_0x280549<0x0?0x168:0x0,_0x280549;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x1a3250){const _0x484a9e=_0x55dedb;this['commandType']=_0x1a3250[_0x484a9e(0x19b)],this['geometry']=_0x1a3250['geometry'],this['attributeLocations']=_0x1a3250['attributeLocations'],this['primitiveType']=_0x1a3250['primitiveType'],this['uniformMap']=_0x1a3250['uniformMap'],this[_0x484a9e(0x1cf)]=_0x1a3250['vertexShaderSource'],this['fragmentShaderSource']=_0x1a3250['fragmentShaderSource'],this[_0x484a9e(0x1b8)]=_0x1a3250['rawRenderState'],this['framebuffer']=_0x1a3250['framebuffer'],this['outputTexture']=_0x1a3250['outputTexture'],this['autoClear']=_0x1a3250['autoClear']??![],this['preExecute']=_0x1a3250['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x484a9e(0x1fa))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x5a6db1){const _0x51322b=_0x55dedb;switch(this['commandType']){case _0x51322b(0x12b):{const _0x38f3f7=Cesium$6['VertexArray']['fromGeometry']({'context':_0x5a6db1,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x51322b(0x1bc)]}),_0xfcd7f6=Cesium$6['ShaderProgram'][_0x51322b(0x1ea)]({'context':_0x5a6db1,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x352f05=Cesium$6[_0x51322b(0x176)]['fromCache'](this[_0x51322b(0x1b8)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0xfcd7f6,'vertexArray':_0x38f3f7,'modelMatrix':Cesium$6['Matrix4'][_0x51322b(0x17b)],'renderState':_0x352f05,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0xdcc25c,_0x3c8953){const _0xdb707a=_0x55dedb;this['geometry']=_0x3c8953;const _0x1a74bf=Cesium$6['VertexArray']['fromGeometry']({'context':_0xdcc25c,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute'][_0xdb707a(0x19c)]=_0x1a74bf;}['update'](_0x500e28){const _0x28afd0=_0x55dedb;if(!this[_0x28afd0(0x1b1)])return;if(_0x500e28[_0x28afd0(0x195)]!==Cesium$6[_0x28afd0(0x12a)]['SCENE3D'])return;!Cesium$6['defined'](this[_0x28afd0(0x158)])&&(this['commandToExecute']=this[_0x28afd0(0x139)](_0x500e28[_0x28afd0(0x196)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x500e28['commandList']['push'](this[_0x28afd0(0x1b5)]),_0x500e28['commandList'][_0x28afd0(0x167)](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x4427e8=_0x55dedb;if(this['clearCommand']){var _0x4715e2,_0x3b5115;(_0x4715e2=this[_0x4427e8(0x1b5)])!==null&&_0x4715e2!==void 0x0&&_0x4715e2[_0x4427e8(0x19c)]&&this['clearCommand'][_0x4427e8(0x19c)]['destroy'](),(_0x3b5115=this[_0x4427e8(0x1b5)])!==null&&_0x3b5115!==void 0x0&&_0x3b5115[_0x4427e8(0x163)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x4427e8(0x158)][_0x4427e8(0x19c)]&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute'][_0x4427e8(0x163)]&&this[_0x4427e8(0x158)][_0x4427e8(0x163)][_0x4427e8(0x17c)](),delete this['commandToExecute']),Cesium$6[_0x4427e8(0x183)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x11c1fb=function(){const _0x2aaec5=_0x50b8,_0x5046ff=new Cesium$5[(_0x2aaec5(0x140))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x2aaec5(0x157))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x5046ff;},_0x4b7090=function(_0x1eb168,_0x2b0162){if(Cesium$5['defined'](_0x2b0162)){const _0x389975={};_0x389975['arrayBufferView']=_0x2b0162,_0x1eb168['source']=_0x389975;}const _0x2cb2bf=new Cesium$5['Texture'](_0x1eb168);return _0x2cb2bf;},_0x2067fe=function(_0x3adfca,_0x2a4b88,_0x72c67f){const _0x4feecf=_0x50b8,_0x540683=new Cesium$5[(_0x4feecf(0x18b))]({'context':_0x3adfca,'colorTextures':[_0x2a4b88],'depthTexture':_0x72c67f});return _0x540683;},_0x1ee78e=function(_0x3166df){const _0x3860da=_0x50b8,_0x230212=!![],_0x4432b0=![],_0x561983={'viewport':_0x3166df['viewport'],'depthTest':_0x3166df[_0x3860da(0x1e7)],'depthMask':_0x3166df[_0x3860da(0x1ba)],'blending':_0x3166df[_0x3860da(0x1f3)]},_0x5a1369=Cesium$5[_0x3860da(0x1df)][_0x3860da(0x16e)](_0x230212,_0x4432b0,_0x561983);return _0x5a1369;},_0x4033ca=function(_0x115e79){const _0x515c91=_0x50b8,_0x3f7b26={},_0x3fd474=Cesium$5[_0x515c91(0x1fe)]['mod'](_0x115e79['west'],Cesium$5['Math'][_0x515c91(0x1fb)]),_0x3c03d2=Cesium$5['Math']['mod'](_0x115e79[_0x515c91(0x1a3)],Cesium$5['Math']['TWO_PI']),_0x15127f=_0x115e79[_0x515c91(0x16a)];let _0x1adb8b,_0xcfc4e4;_0x15127f>Cesium$5[_0x515c91(0x1fe)]['THREE_PI_OVER_TWO']?(_0x1adb8b=0x0,_0xcfc4e4=Cesium$5[_0x515c91(0x1fe)]['TWO_PI']):_0x3c03d2-_0x3fd474<_0x15127f?(_0x1adb8b=_0x3fd474,_0xcfc4e4=_0x3fd474+_0x15127f):(_0x1adb8b=_0x3fd474,_0xcfc4e4=_0x3c03d2);_0x3f7b26['lon']={'min':Cesium$5['Math']['toDegrees'](_0x1adb8b),'max':Cesium$5[_0x515c91(0x1fe)]['toDegrees'](_0xcfc4e4)};const _0x9f0e5f=_0x115e79['south'],_0x4b222e=_0x115e79['north'],_0x2e171c=_0x115e79['height'],_0x35710c=_0x2e171c>Cesium$5['Math']['PI']/0xc?_0x2e171c/0x2:0x0;let _0x494c5c=Cesium$5['Math']['clampToLatitudeRange'](_0x9f0e5f-_0x35710c),_0x15137f=Cesium$5['Math']['clampToLatitudeRange'](_0x4b222e+_0x35710c);return _0x494c5c<-Cesium$5[_0x515c91(0x1fe)]['PI_OVER_THREE']&&(_0x494c5c=-Cesium$5[_0x515c91(0x1fe)]['PI_OVER_TWO']),_0x15137f>Cesium$5['Math']['PI_OVER_THREE']&&(_0x15137f=Cesium$5['Math']['PI_OVER_TWO']),_0x3f7b26[_0x515c91(0x190)]={'min':Cesium$5['Math']['toDegrees'](_0x494c5c),'max':Cesium$5['Math'][_0x515c91(0x15e)](_0x15137f)},_0x3f7b26;};return{'getFullscreenQuad':_0x11c1fb,'createTexture':_0x4b7090,'createFramebuffer':_0x2067fe,'createRawRenderState':_0x1ee78e,'viewRectangleToLonLatRange':_0x4033ca};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x55dedb(0x1db),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';function _0x1710(){const _0x1e951b=['RGB','TextureMinificationFilter','rows','show','globalCompositeOperation','addEventListener','random','clearCommand','lineWidth','cols','rawRenderState','pow','depthMask','particlesNumber','STATIC_DRAW','TRIANGLES','latRange','initWorker','getOptions','2876223fiHOhI','createRenderingFramebuffers','unbindEvent','NEAREST','dropRateBump','nextParticlesPosition','setDate','globe','particlesRendering','Cesium','pixelSize','ymax','mouseMove','green','vertexShaderSource','tlng','particlesTextureSize','scene','data','mouse_move','mouseUp','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','getUVByPoint','Sampler','fadeOpacity','getRandomLatLng','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','isPointVisible','globeBoundingSphere','vmin','Appearance','lon','1966392UYkVHW','_updateIng2','_addedHook','mouseDown','particlesTextures','dimensions','depthTest','dropRate','wgs84ToWindowCoordinates','fromCache','fixedHeight','ymin','currentParticlesPosition','EllipsoidalOccluder','attributeLocations','xmin','vdata','EventType','blending','currentParticlesSpeed','refreshParticles','update','min','postProcessingSpeed','removeEventListener','Color','TWO_PI','bind','maxAge','Math','postMessage','trails','_data','colorTable','canvas','canvasHeight','clientHeight','get','windData','_updateIng','height','windTextures','2083960mFBPTS','_speedRate','_tomap','speedRate','Pass','SceneMode','Draw','_maxAge','viewerParameters','bindEvent','nextTrailsDepth','primitives','getOwnPropertyDescriptor','animateFrame','createTexture','udata','resize','colors','_setOptionsHook','_onMap_preRenderEvent','createCommand','pointerEvents','toRadians','geometry','getColorTexture','getParticles','xmax','Geometry','ClearCommand','currentTrails','redraw','defineProperty','_calc_speedRate','preRender','UNSIGNED_BYTE','FLOAT','clientWidth','createSegmentsGeometry','textures','_onMapWhellEvent','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','particlesComputing','maxParticles','LayerUtil','init','763182YodfGr','age','refreshTimer','407724kIBmGR','Cartesian2','GeometryAttribute','commandToExecute','WindLayer','tlat','beginPath','getFullscreenQuad','abs','toDegrees','Cartesian3','138gYlvAK','PixelFormat','_bilinearInterpolation','shaderProgram','24316bUATrJ','mouseHidden','remove','push','pointer-events','createParticlesTextures','width','layer','_onMouseMoveEvent','addPrimitives','getDefaultRenderState','drawingBufferWidth','outputTexture','ShaderSource','none','length','array','43805ruXdkW','RenderState','camera','0px','floor','canvasWidth','IDENTITY','destroy','framebuffers','8lxSzXq','201FOFLSN','options','speedFactor','lng','destroyObject','ComponentDatatype','worker','style','_removedHook','visible','_randomParticle','canvasContext','Framebuffer','WindUtil','windField','_onMouseDownEvent','color','lat','_pointerEvents','segments','keys','nextTrails','mode','context','fill','max','drawingBufferHeight','updatePosition','commandType','vertexArray','randomizeParticles','left','DEPTH_COMPONENT','TextureMagnificationFilter','off','setOptions','east','add','umax','frameRate','grid','_map','createRenderingPrimitives','lev','canvasResize','particleSystem','postProcessingPosition'];_0x1710=function(){return _0x1e951b;};return _0x1710();}const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x3cb1ce,_0x263302,_0x37c03b,_0x282abf,_0x13f630){const _0x55162d=_0x55dedb;this['createRenderingTextures'](_0x3cb1ce,_0x263302,_0x37c03b[_0x55162d(0x136)]),this['createRenderingFramebuffers'](_0x3cb1ce),this[_0x55162d(0x1a9)](_0x3cb1ce,_0x37c03b,_0x282abf,_0x13f630);}['createRenderingTextures'](_0x16efab,_0x4b0ad4,_0x36707a){const _0x83232=_0x55dedb,_0x4d8e65={'context':_0x16efab,'width':_0x16efab['drawingBufferWidth'],'height':_0x16efab['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x83232(0x147)]},_0x2d95f9={'context':_0x16efab,'width':_0x16efab[_0x83232(0x16f)],'height':_0x16efab[_0x83232(0x199)],'pixelFormat':Cesium$4[_0x83232(0x161)][_0x83232(0x19f)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0xb4b78b=_0x36707a['length'],_0x500344=new Float32Array(_0xb4b78b*0x3);for(let _0x6be127=0x0;_0x6be127<_0xb4b78b;_0x6be127++){const _0x1cbf38=Cesium$4[_0x83232(0x1fa)]['fromCssColorString'](_0x36707a[_0x6be127]);_0x500344[0x3*_0x6be127]=_0x1cbf38['red'],_0x500344[0x3*_0x6be127+0x1]=_0x1cbf38[_0x83232(0x1ce)],_0x500344[0x3*_0x6be127+0x2]=_0x1cbf38['blue'];}const _0xc665df={'context':_0x16efab,'width':_0xb4b78b,'height':0x1,'pixelFormat':Cesium$4[_0x83232(0x161)][_0x83232(0x1ae)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x83232(0x148)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x83232(0x1a0)]['LINEAR']})};this[_0x83232(0x14b)]={'segmentsColor':Util['createTexture'](_0x4d8e65),'segmentsDepth':Util[_0x83232(0x133)](_0x2d95f9),'currentTrailsColor':Util['createTexture'](_0x4d8e65),'currentTrailsDepth':Util['createTexture'](_0x2d95f9),'nextTrailsColor':Util['createTexture'](_0x4d8e65),'nextTrailsDepth':Util['createTexture'](_0x2d95f9),'colorTable':Util[_0x83232(0x133)](_0xc665df,_0x500344)};}[_0x55dedb(0x1c2)](_0x121ca4){const _0x13cf78=_0x55dedb;this['framebuffers']={'segments':Util['createFramebuffer'](_0x121ca4,this[_0x13cf78(0x14b)]['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x121ca4,this['textures']['currentTrailsColor'],this[_0x13cf78(0x14b)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x121ca4,this['textures']['nextTrailsColor'],this[_0x13cf78(0x14b)][_0x13cf78(0x12f)])};}['createSegmentsGeometry'](_0x3e0a6c){const _0x27c284=_0x55dedb,_0xb5a70f=0x4;let _0x5ca4ac=[];for(let _0x2a4129=0x0;_0x2a4129<_0x3e0a6c['particlesTextureSize'];_0x2a4129++){for(let _0xcd8511=0x0;_0xcd8511<_0x3e0a6c['particlesTextureSize'];_0xcd8511++){for(let _0x3e2ab8=0x0;_0x3e2ab8<_0xb5a70f;_0x3e2ab8++){_0x5ca4ac['push'](_0x2a4129/_0x3e0a6c['particlesTextureSize']),_0x5ca4ac['push'](_0xcd8511/_0x3e0a6c[_0x27c284(0x1d1)]);}}}_0x5ca4ac=new Float32Array(_0x5ca4ac);let _0x57309f=[];const _0x18986d=[-0x1,0x1],_0x221b23=[-0x1,0x1];for(let _0x205443=0x0;_0x205443<_0x3e0a6c['maxParticles'];_0x205443++){for(let _0x320727=0x0;_0x320727<_0xb5a70f/0x2;_0x320727++){for(let _0x2ce7c8=0x0;_0x2ce7c8<_0xb5a70f/0x2;_0x2ce7c8++){_0x57309f['push'](_0x18986d[_0x320727]),_0x57309f['push'](_0x221b23[_0x2ce7c8]),_0x57309f['push'](0x0);}}}_0x57309f=new Float32Array(_0x57309f);const _0x3f71f4=0x6*_0x3e0a6c['maxParticles'],_0x9c2b1b=new Uint32Array(_0x3f71f4);for(let _0x52c32c=0x0,_0x4a5c1c=0x0,_0x1068f6=0x0;_0x52c32c<_0x3e0a6c[_0x27c284(0x14f)];_0x52c32c++){_0x9c2b1b[_0x4a5c1c++]=_0x1068f6+0x0,_0x9c2b1b[_0x4a5c1c++]=_0x1068f6+0x1,_0x9c2b1b[_0x4a5c1c++]=_0x1068f6+0x2,_0x9c2b1b[_0x4a5c1c++]=_0x1068f6+0x2,_0x9c2b1b[_0x4a5c1c++]=_0x1068f6+0x1,_0x9c2b1b[_0x4a5c1c++]=_0x1068f6+0x3,_0x1068f6+=0x4;}const _0x2d86f4=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x27c284(0x157))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x5ca4ac}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x27c284(0x184)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x57309f})}),'indices':_0x9c2b1b});return _0x2d86f4;}['createRenderingPrimitives'](_0x315212,_0x467772,_0x128f32,_0xf62549){const _0x2fee78=_0x55dedb,_0xd2805c=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x2fee78(0x14a)](_0x467772),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0xf62549['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0xf62549['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0xf62549['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0xd2805c['textures']['colorTable'];},'aspect':function(){return _0x315212['drawingBufferWidth']/_0x315212['drawingBufferHeight'];},'pixelSize':function(){return _0x128f32['pixelSize'];},'lineWidth':function(){return _0x467772['lineWidth'];},'particleHeight':function(){return _0x467772['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x2fee78(0x171))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x2fee78(0x192)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x2fee78(0x15c)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0xd2805c['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0xd2805c['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0xd2805c['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x1e1595=_0x2fee78;return _0xd2805c[_0x1e1595(0x17d)][_0x1e1595(0x142)]['depthTexture'];},'fadeOpacity':function(){return _0x467772['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x2fee78(0x171))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x4972f9=_0x2fee78,_0x268eee=_0xd2805c['framebuffers']['currentTrails'];_0xd2805c['framebuffers']['currentTrails']=_0xd2805c['framebuffers'][_0x4972f9(0x194)],_0xd2805c[_0x4972f9(0x17d)][_0x4972f9(0x194)]=_0x268eee,_0xd2805c['primitives'][_0x4972f9(0x200)]['commandToExecute']['framebuffer']=_0xd2805c['framebuffers']['nextTrails'],_0xd2805c[_0x4972f9(0x130)]['trails']['clearCommand']['framebuffer']=_0xd2805c[_0x4972f9(0x17d)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x2fee78(0x12b),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x2fee78(0x1bd)],'uniformMap':{'trailsColorTexture':function(){const _0x1376b9=_0x2fee78;return _0xd2805c[_0x1376b9(0x17d)][_0x1376b9(0x194)][_0x1376b9(0x13d)](0x0);},'trailsDepthTexture':function(){return _0xd2805c['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x55dedb(0x14d),updateSpeed_frag=_0x55dedb(0x1d6),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x1e086e,_0x1d6742,_0x5ed2ad,_0x111bef){this['data']=_0x1d6742,this['createWindTextures'](_0x1e086e,_0x1d6742),this['createParticlesTextures'](_0x1e086e,_0x5ed2ad,_0x111bef),this['createComputingPrimitives'](_0x1d6742,_0x5ed2ad,_0x111bef);}['createWindTextures'](_0x9127ff,_0x28fc33){const _0x32f625=_0x55dedb,_0xbd7447={'context':_0x9127ff,'width':_0x28fc33[_0x32f625(0x1e6)]['lon'],'height':_0x28fc33['dimensions']['lat']*(_0x28fc33['dimensions']['lev']||0x1),'pixelFormat':Cesium$3[_0x32f625(0x161)]['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x32f625(0x1af)][_0x32f625(0x1c4)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x32f625(0x1c4)]})};this['windTextures']={'U':Util[_0x32f625(0x133)](_0xbd7447,_0x28fc33['U']['array']),'V':Util[_0x32f625(0x133)](_0xbd7447,_0x28fc33['V']['array'])};}['createParticlesTextures'](_0xcd21e0,_0x137590,_0x3850de){const _0x437d57=_0x55dedb,_0x3d6a5a={'context':_0xcd21e0,'width':_0x137590['particlesTextureSize'],'height':_0x137590['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x437d57(0x1d8))]({'minificationFilter':Cesium$3[_0x437d57(0x1af)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x2a606d=this[_0x437d57(0x19d)](_0x137590['maxParticles'],_0x3850de),_0x58ac01=new Float32Array(0x4*_0x137590[_0x437d57(0x14f)])[_0x437d57(0x197)](0x0);this[_0x437d57(0x1e5)]={'particlesWind':Util['createTexture'](_0x3d6a5a),'currentParticlesPosition':Util['createTexture'](_0x3d6a5a,_0x2a606d),'nextParticlesPosition':Util['createTexture'](_0x3d6a5a,_0x2a606d),'currentParticlesSpeed':Util['createTexture'](_0x3d6a5a,_0x58ac01),'nextParticlesSpeed':Util[_0x437d57(0x133)](_0x3d6a5a,_0x58ac01),'postProcessingPosition':Util[_0x437d57(0x133)](_0x3d6a5a,_0x2a606d),'postProcessingSpeed':Util['createTexture'](_0x3d6a5a,_0x58ac01)};}[_0x55dedb(0x19d)](_0x2cf01c,_0x472825){const _0x2984f9=_0x55dedb,_0x436b91=new Float32Array(0x4*_0x2cf01c);for(let _0x501220=0x0;_0x501220<_0x2cf01c;_0x501220++){_0x436b91[0x4*_0x501220]=Cesium$3[_0x2984f9(0x1fe)]['randomBetween'](_0x472825['lonRange']['x'],_0x472825['lonRange']['y']),_0x436b91[0x4*_0x501220+0x1]=Cesium$3['Math']['randomBetween'](_0x472825[_0x2984f9(0x1be)]['x'],_0x472825[_0x2984f9(0x1be)]['y']),_0x436b91[0x4*_0x501220+0x2]=Cesium$3['Math']['randomBetween'](this[_0x2984f9(0x1d3)]['lev']['min'],this['data']['lev']['max']),_0x436b91[0x4*_0x501220+0x3]=0x0;}return _0x436b91;}['destroyParticlesTextures'](){const _0x1a3e2c=_0x55dedb;Object[_0x1a3e2c(0x193)](this['particlesTextures'])['forEach'](_0x22f6e1=>{this['particlesTextures'][_0x22f6e1]['destroy']();});}['createComputingPrimitives'](_0xb7bbda,_0x52dd92,_0x45a2e3){const _0x5a040a=_0x55dedb,_0x2646d9=new Cesium$3['Cartesian3'](_0xb7bbda[_0x5a040a(0x1e6)][_0x5a040a(0x1e0)],_0xb7bbda[_0x5a040a(0x1e6)][_0x5a040a(0x190)],_0xb7bbda['dimensions']['lev']),_0x2ebd5e=new Cesium$3[(_0x5a040a(0x15f))](_0xb7bbda[_0x5a040a(0x1e0)][_0x5a040a(0x1f7)],_0xb7bbda['lat']['min'],_0xb7bbda[_0x5a040a(0x1aa)]['min']),_0x5d4022=new Cesium$3[(_0x5a040a(0x15f))](_0xb7bbda['lon'][_0x5a040a(0x198)],_0xb7bbda[_0x5a040a(0x190)]['max'],_0xb7bbda['lev']['max']),_0x277d26=new Cesium$3[(_0x5a040a(0x15f))]((_0x5d4022['x']-_0x2ebd5e['x'])/(_0x2646d9['x']-0x1),(_0x5d4022['y']-_0x2ebd5e['y'])/(_0x2646d9['y']-0x1),_0x2646d9['z']>0x1?(_0x5d4022['z']-_0x2ebd5e['z'])/(_0x2646d9['z']-0x1):0x1),_0x461aaa=new Cesium$3['Cartesian2'](_0xb7bbda['U']['min'],_0xb7bbda['U'][_0x5a040a(0x198)]),_0x11d25f=new Cesium$3[(_0x5a040a(0x156))](_0xb7bbda['V']['min'],_0xb7bbda['V'][_0x5a040a(0x198)]),_0x131b4d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x5377c1=_0x5a040a;return _0x131b4d[_0x5377c1(0x124)]['U'];},'V':function(){return _0x131b4d['windTextures']['V'];},'currentParticlesPosition':function(){const _0x39387c=_0x5a040a;return _0x131b4d['particlesTextures'][_0x39387c(0x1ed)];},'dimension':function(){return _0x2646d9;},'minimum':function(){return _0x2ebd5e;},'maximum':function(){return _0x5d4022;},'interval':function(){return _0x277d26;}},'fragmentShaderSource':new Cesium$3[(_0x5a040a(0x171))]({'sources':[getWind_frag]}),'outputTexture':this[_0x5a040a(0x1e5)]['particlesWind'],'preExecute':function(){const _0x40b73a=_0x5a040a;_0x131b4d[_0x40b73a(0x130)]['getWind']['commandToExecute'][_0x40b73a(0x170)]=_0x131b4d['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x440ef2=_0x5a040a;return _0x131b4d[_0x440ef2(0x1e5)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x131b4d['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x461aaa;},'vSpeedRange':function(){return _0x11d25f;},'pixelSize':function(){const _0x101ec5=_0x5a040a;return _0x45a2e3[_0x101ec5(0x1cb)];},'speedFactor':function(){return _0x52dd92['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x5a040a(0x171))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x11184b=_0x5a040a,_0x1fbdd2=_0x131b4d[_0x11184b(0x1e5)]['currentParticlesSpeed'];_0x131b4d['particlesTextures'][_0x11184b(0x1f4)]=_0x131b4d['particlesTextures']['postProcessingSpeed'],_0x131b4d['particlesTextures']['postProcessingSpeed']=_0x1fbdd2,_0x131b4d['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x131b4d['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x131b4d['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x131b4d['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x5a040a(0x171))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x232912=_0x131b4d['particlesTextures']['currentParticlesPosition'];_0x131b4d['particlesTextures']['currentParticlesPosition']=_0x131b4d['particlesTextures']['postProcessingPosition'],_0x131b4d['particlesTextures']['postProcessingPosition']=_0x232912,_0x131b4d['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x131b4d['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x1eb449=_0x5a040a;return _0x131b4d[_0x1eb449(0x1e5)][_0x1eb449(0x1c6)];},'nextParticlesSpeed':function(){const _0x322725=_0x5a040a;return _0x131b4d[_0x322725(0x1e5)]['nextParticlesSpeed'];},'lonRange':function(){return _0x45a2e3['lonRange'];},'latRange':function(){const _0x45a7a3=_0x5a040a;return _0x45a2e3[_0x45a7a3(0x1be)];},'randomCoefficient':function(){const _0x13f5b5=_0x5a040a,_0x2db662=Math[_0x13f5b5(0x1b4)]();return _0x2db662;},'dropRate':function(){return _0x52dd92['dropRate'];},'dropRateBump':function(){return _0x52dd92['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x5a040a(0x171))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x5a040a(0x1ad)],'preExecute':function(){_0x131b4d['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x131b4d['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x55e5d5=_0x5a040a;return _0x131b4d[_0x55e5d5(0x1e5)]['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x80a561=_0x5a040a;return _0x131b4d[_0x80a561(0x1e5)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x4e3c4c=_0x5a040a;_0x131b4d[_0x4e3c4c(0x130)]['postProcessingSpeed'][_0x4e3c4c(0x158)]['outputTexture']=_0x131b4d['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x27d230,_0x37d454,_0x28cc90,_0x4cad53){const _0x1ec8b7=_0x55dedb;this['context']=_0x27d230,_0x37d454={..._0x37d454},_0x37d454[_0x1ec8b7(0x134)]&&_0x37d454['vdata']&&(_0x37d454['dimensions']={},_0x37d454['dimensions']['lon']=_0x37d454[_0x1ec8b7(0x1b7)],_0x37d454[_0x1ec8b7(0x1e6)]['lat']=_0x37d454[_0x1ec8b7(0x1b0)],_0x37d454['dimensions']['lev']=_0x37d454['lev']||0x1,_0x37d454['lon']={},_0x37d454['lon']['min']=_0x37d454['xmin'],_0x37d454[_0x1ec8b7(0x1e0)]['max']=_0x37d454['xmax'],_0x37d454[_0x1ec8b7(0x190)]={},_0x37d454[_0x1ec8b7(0x190)]['min']=_0x37d454['ymin'],_0x37d454[_0x1ec8b7(0x190)]['max']=_0x37d454[_0x1ec8b7(0x1cc)],_0x37d454['lev']={},_0x37d454['lev'][_0x1ec8b7(0x1f7)]=_0x37d454['levmin']??0x1,_0x37d454['lev'][_0x1ec8b7(0x198)]=_0x37d454['levmax']??0x1,_0x37d454['U']={},_0x37d454['U'][_0x1ec8b7(0x174)]=new Float32Array(_0x37d454['udata']),_0x37d454['U'][_0x1ec8b7(0x1f7)]=_0x37d454['umin']??Math[_0x1ec8b7(0x1f7)](..._0x37d454[_0x1ec8b7(0x134)]),_0x37d454['U'][_0x1ec8b7(0x198)]=_0x37d454[_0x1ec8b7(0x1a5)]??Math['max'](..._0x37d454[_0x1ec8b7(0x134)]),_0x37d454['V']={},_0x37d454['V']['array']=new Float32Array(_0x37d454['vdata']),_0x37d454['V'][_0x1ec8b7(0x1f7)]=_0x37d454[_0x1ec8b7(0x1de)]??Math[_0x1ec8b7(0x1f7)](..._0x37d454['vdata']),_0x37d454['V']['max']=_0x37d454['vmax']??Math[_0x1ec8b7(0x198)](..._0x37d454['vdata'])),this['data']=_0x37d454,this[_0x1ec8b7(0x180)]=_0x28cc90,this['viewerParameters']=_0x4cad53,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x1ec8b7(0x12d)],this['particlesComputing']);}[_0x55dedb(0x1ab)](_0x5c0038){const _0x373f0d=_0x55dedb;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x4d5199=>{const _0x312f29=_0x50b8;this['particlesComputing']['windTextures'][_0x4d5199][_0x312f29(0x17c)]();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x373f0d(0x17d)])['forEach'](_0x6453a4=>{const _0x30b67c=_0x373f0d;this['particlesRendering'][_0x30b67c(0x17d)][_0x6453a4][_0x30b67c(0x17c)]();}),this['context']=_0x5c0038,this[_0x373f0d(0x14e)]=new ParticlesComputing(this[_0x373f0d(0x196)],this[_0x373f0d(0x1d3)],this[_0x373f0d(0x180)],this[_0x373f0d(0x12d)]),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x1a2751=_0x55dedb,_0x2aeed9=new Cesium$2[(_0x1a2751(0x141))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x1a2751(0x129)]['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x174da5=>{const _0x46c287=_0x1a2751;_0x2aeed9['framebuffer']=this[_0x46c287(0x1c9)]['framebuffers'][_0x174da5],_0x2aeed9['execute'](this['context']);});}[_0x55dedb(0x1f5)](_0x3ed8ef){const _0x32629f=_0x55dedb;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x32629f(0x169)](this[_0x32629f(0x196)],this['options'],this['viewerParameters']);if(_0x3ed8ef){const _0x502609=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments'][_0x32629f(0x13c)]=_0x502609;const _0x50c471=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x502609,'attributeLocations':this['particlesRendering']['primitives']['segments'][_0x32629f(0x1ef)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this[_0x32629f(0x1c9)]['primitives'][_0x32629f(0x192)]['commandToExecute']['vertexArray']=_0x50c471;}}['setOptions'](_0xa212a1){let _0x56e8ab=![];this['options']['maxParticles']!==_0xa212a1['maxParticles']&&(_0x56e8ab=!![]),Object['keys'](_0xa212a1)['forEach'](_0x1d7e88=>{const _0x2bd2fd=_0x50b8;this[_0x2bd2fd(0x180)][_0x1d7e88]=_0xa212a1[_0x1d7e88];}),this['refreshParticles'](_0x56e8ab);}['applyViewerParameters'](_0x4f99ce){const _0x7537ec=_0x55dedb;Object[_0x7537ec(0x193)](_0x4f99ce)['forEach'](_0x4ecc6=>{this['viewerParameters'][_0x4ecc6]=_0x4f99ce[_0x4ecc6];}),this['refreshParticles'](![]);}['destroy'](){const _0x1b7ab2=_0x55dedb;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x1b7ab2(0x14e)]['windTextures'])['forEach'](_0x508c48=>{const _0x31865b=_0x1b7ab2;this[_0x31865b(0x14e)][_0x31865b(0x124)][_0x508c48]['destroy']();}),this['particlesRendering'][_0x1b7ab2(0x14b)][_0x1b7ab2(0x202)]['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0xf2779f=>{this['particlesRendering']['framebuffers'][_0xf2779f]['destroy']();});for(const _0x305140 in this){delete this[_0x305140];}}}function _0x50b8(_0x510881,_0x1d7d26){const _0x1710bf=_0x1710();return _0x50b8=function(_0x50b8b2,_0x71b407){_0x50b8b2=_0x50b8b2-0x11f;let _0x14d528=_0x1710bf[_0x50b8b2];return _0x14d528;},_0x50b8(_0x510881,_0x1d7d26);}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x22c50c={}){const _0xfb1ded=_0x55dedb;_0x22c50c={...DEF_OPTIONS,..._0x22c50c},super(_0x22c50c),this[_0xfb1ded(0x137)](_0x22c50c);}get['layer'](){const _0x29ccc6=_0x55dedb;return this[_0x29ccc6(0x130)];}get['data'](){const _0x2cb9ff=_0x55dedb;return this[_0x2cb9ff(0x201)];}set[_0x55dedb(0x1d3)](_0x217a43){this['setData'](_0x217a43);}get['colors'](){const _0x97e01f=_0x55dedb;return this[_0x97e01f(0x180)]['colors'];}set['colors'](_0x253e06){const _0x40e07a=_0x55dedb;this['options'][_0x40e07a(0x136)]=_0x253e06,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x253e06}),this[_0x40e07a(0x135)]();}['_mountedHook'](){}[_0x55dedb(0x1e3)](){const _0x43cd4f=_0x55dedb;this[_0x43cd4f(0x1d2)]=this['_map'][_0x43cd4f(0x1d2)],this['camera']=this['_map'][_0x43cd4f(0x177)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this[_0x43cd4f(0x1a8)]['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize'][_0x43cd4f(0x1fc)](this),![]),this['mouse_down']=![],this[_0x43cd4f(0x1d4)]=![],this[_0x43cd4f(0x1a8)]['on'](mars3d__namespace[_0x43cd4f(0x1f2)]['wheel'],this[_0x43cd4f(0x14c)],this),this['_map']['on'](mars3d__namespace[_0x43cd4f(0x1f2)]['mouseDown'],this[_0x43cd4f(0x18e)],this),this['_map']['on'](mars3d__namespace[_0x43cd4f(0x1f2)][_0x43cd4f(0x1d5)],this['_onMouseUpEvent'],this),this[_0x43cd4f(0x1a8)]['on'](mars3d__namespace[_0x43cd4f(0x1f2)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x2a8446=_0x55dedb;window[_0x2a8446(0x1f9)]('resize',this['resize']),this['_map'][_0x2a8446(0x1a1)](mars3d__namespace['EventType'][_0x2a8446(0x146)],this['_onMap_preRenderEvent'],this),this['_map'][_0x2a8446(0x1a1)](mars3d__namespace[_0x2a8446(0x1f2)]['wheel'],this[_0x2a8446(0x14c)],this),this['_map']['off'](mars3d__namespace[_0x2a8446(0x1f2)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x2a8446(0x1a1)](mars3d__namespace['EventType'][_0x2a8446(0x1d5)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives'][_0x2a8446(0x166)](this['primitives']);}[_0x55dedb(0x135)](){const _0xe7cd5b=_0x55dedb;if(!this[_0xe7cd5b(0x1b1)]||!this[_0xe7cd5b(0x1ac)])return;this['primitives']['show']=![],this[_0xe7cd5b(0x130)]['removeAll'](),this[_0xe7cd5b(0x1a8)]['once'](mars3d__namespace['EventType']['preRender'],this[_0xe7cd5b(0x138)],this);}['_onMap_preRenderEvent'](_0x30e53b){const _0x2b3035=_0x55dedb;this[_0x2b3035(0x1ac)]['canvasResize'](this['scene']['context']),this[_0x2b3035(0x16d)](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x224183){const _0x52fdb3=_0x55dedb;clearTimeout(this[_0x52fdb3(0x154)]);if(!this[_0x52fdb3(0x1b1)]||!this[_0x52fdb3(0x1ac)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x55dedb(0x18e)](_0x31cfaf){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x574c5d){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x182c5f){const _0x5af6f5=_0x55dedb;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives'][_0x5af6f5(0x1b1)]=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x1e5524=_0x55dedb;if(!this[_0x1e5524(0x1a8)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x2fd938){const _0x49f79a=_0x55dedb;this['_data']=_0x2fd938,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x2fd938,this[_0x49f79a(0x1c0)](),this['viewerParameters']),this[_0x49f79a(0x16d)]();}[_0x55dedb(0x137)](_0x3d5890,_0x49e7a8){const _0x217caf=_0x55dedb;if(_0x3d5890)for(const _0x2d383b in _0x3d5890){this[_0x2d383b]=_0x3d5890[_0x2d383b];}this['particleSystem']&&this[_0x217caf(0x1ac)]['setOptions'](this['getOptions']());}['getOptions'](){const _0x38b29c=_0x55dedb,_0x41be34=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x41be34*_0x41be34,{'particlesTextureSize':_0x41be34,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x38b29c(0x1d9)],'dropRate':this[_0x38b29c(0x1e8)],'dropRateBump':this[_0x38b29c(0x1c5)],'speedFactor':this[_0x38b29c(0x181)],'lineWidth':this[_0x38b29c(0x1b6)],'colors':this['colors']};}['addPrimitives'](){const _0x20a5db=_0x55dedb;this['primitives']['add'](this[_0x20a5db(0x1ac)]['particlesComputing'][_0x20a5db(0x130)]['getWind']),this['primitives'][_0x20a5db(0x1a4)](this[_0x20a5db(0x1ac)]['particlesComputing'][_0x20a5db(0x130)]['updateSpeed']),this[_0x20a5db(0x130)]['add'](this[_0x20a5db(0x1ac)]['particlesComputing'][_0x20a5db(0x130)][_0x20a5db(0x19a)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x20a5db(0x130)][_0x20a5db(0x1ad)]),this[_0x20a5db(0x130)][_0x20a5db(0x1a4)](this['particleSystem']['particlesComputing']['primitives'][_0x20a5db(0x1f8)]),this['primitives']['add'](this[_0x20a5db(0x1ac)]['particlesRendering']['primitives']['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x3f24c5=_0x55dedb;let _0x2f1e9c=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x2f1e9c){const _0x4fef32=this[_0x3f24c5(0x1a8)]['getExtent']();_0x2f1e9c=Cesium$1['Rectangle']['fromDegrees'](_0x4fef32['xmin'],_0x4fef32[_0x3f24c5(0x1ec)],_0x4fef32[_0x3f24c5(0x13f)],_0x4fef32['ymax']);}const _0x5105a1=Util['viewRectangleToLonLatRange'](_0x2f1e9c);this['viewerParameters']['lonRange']['x']=_0x5105a1['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x5105a1['lon']['max'],this['viewerParameters']['latRange']['x']=_0x5105a1['lat']['min'],this['viewerParameters']['latRange']['y']=_0x5105a1['lat']['max'];const _0x17c5ed=this[_0x3f24c5(0x177)]['getPixelSize'](this[_0x3f24c5(0x1dd)],this['scene']['drawingBufferWidth'],this['scene'][_0x3f24c5(0x199)]);_0x17c5ed>0x0&&(this['viewerParameters'][_0x3f24c5(0x1cb)]=_0x17c5ed);}}mars3d__namespace[_0x55dedb(0x150)]['register']('wind',WindLayer),mars3d__namespace[_0x55dedb(0x16b)][_0x55dedb(0x159)]=WindLayer;class CanvasParticle{constructor(){const _0x309eab=_0x55dedb;this[_0x309eab(0x182)]=null,this['lat']=null,this['tlng']=null,this[_0x309eab(0x15a)]=null,this[_0x309eab(0x153)]=null;}['destroy'](){for(const _0x48952f in this){delete this[_0x48952f];}}}class CanvasWindField{constructor(_0xd7cebb){this['setOptions'](_0xd7cebb);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x3f2009){const _0x34b2e8=_0x55dedb;this['_speedRate']=(0x64-(_0x3f2009>0x63?0x63:_0x3f2009))*0x64,this[_0x34b2e8(0x145)]=[(this['xmax']-this[_0x34b2e8(0x1f0)])/this[_0x34b2e8(0x126)],(this['ymax']-this['ymin'])/this[_0x34b2e8(0x126)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x56e61b){const _0x4f3f39=_0x55dedb;this[_0x4f3f39(0x12c)]=_0x56e61b;}[_0x55dedb(0x1a2)](_0x2aba37){const _0x2c1459=_0x55dedb;this[_0x2c1459(0x180)]=_0x2aba37,this['maxAge']=_0x2aba37['maxAge']||0x78,this['speedRate']=_0x2aba37[_0x2c1459(0x128)]||0x32,this['particles']=[];const _0x154efb=_0x2aba37['particlesNumber']||0x1000;for(let _0x2f7a28=0x0;_0x2f7a28<_0x154efb;_0x2f7a28++){const _0x73dbc3=this[_0x2c1459(0x189)](new CanvasParticle());this['particles']['push'](_0x73dbc3);}}[_0x55dedb(0x1c7)](_0x110ced){const _0x215715=_0x55dedb;this['rows']=_0x110ced['rows'],this['cols']=_0x110ced['cols'],this['xmin']=_0x110ced['xmin'],this['xmax']=_0x110ced['xmax'],this['ymin']=_0x110ced['ymin'],this['ymax']=_0x110ced[_0x215715(0x1cc)],this['grid']=[];const _0x2ce4a8=_0x110ced['udata'],_0x344101=_0x110ced[_0x215715(0x1f1)];let _0x2dbb19=![];_0x2ce4a8['length']===this['rows']&&_0x2ce4a8[0x0]['length']===this['cols']&&(_0x2dbb19=!![]);let _0x2b62bb=0x0,_0x59d793=null,_0xc92808=null;for(let _0xc1dfd1=0x0;_0xc1dfd1<this[_0x215715(0x1b0)];_0xc1dfd1++){_0x59d793=[];for(let _0xd25e4c=0x0;_0xd25e4c<this['cols'];_0xd25e4c++,_0x2b62bb++){_0x2dbb19?_0xc92808=this['_calcUV'](_0x2ce4a8[_0xc1dfd1][_0xd25e4c],_0x344101[_0xc1dfd1][_0xd25e4c]):_0xc92808=this['_calcUV'](_0x2ce4a8[_0x2b62bb],_0x344101[_0x2b62bb]),_0x59d793['push'](_0xc92808);}this['grid']['push'](_0x59d793);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x1f7e09=_0x55dedb;delete this['rows'],delete this[_0x1f7e09(0x1b7)],delete this['xmin'],delete this[_0x1f7e09(0x13f)],delete this['ymin'],delete this['ymax'],delete this[_0x1f7e09(0x1a7)],delete this['particles'];}['toGridXY'](_0x2e1603,_0x333b0a){const _0x500911=_0x55dedb,_0x45d277=(_0x2e1603-this[_0x500911(0x1f0)])/(this[_0x500911(0x13f)]-this['xmin'])*(this['cols']-0x1),_0x1daeab=(this['ymax']-_0x333b0a)/(this['ymax']-this['ymin'])*(this[_0x500911(0x1b0)]-0x1);return[_0x45d277,_0x1daeab];}['getUVByXY'](_0x22d1fb,_0x36c98f){const _0x3ae686=_0x55dedb;if(_0x22d1fb<0x0||_0x22d1fb>=this['cols']||_0x36c98f>=this['rows'])return[0x0,0x0,0x0];const _0x19f712=Math['floor'](_0x22d1fb),_0x4c694d=Math[_0x3ae686(0x179)](_0x36c98f);if(_0x19f712===_0x22d1fb&&_0x4c694d===_0x36c98f)return this['grid'][_0x36c98f][_0x22d1fb];const _0x3867ce=_0x19f712+0x1,_0x4d33ba=_0x4c694d+0x1,_0x371c1b=this['getUVByXY'](_0x19f712,_0x4c694d),_0x1f71ee=this['getUVByXY'](_0x3867ce,_0x4c694d),_0xb12fa4=this['getUVByXY'](_0x19f712,_0x4d33ba),_0x3199b4=this['getUVByXY'](_0x3867ce,_0x4d33ba);let _0x5b6591=null;try{_0x5b6591=this[_0x3ae686(0x162)](_0x22d1fb-_0x19f712,_0x36c98f-_0x4c694d,_0x371c1b,_0x1f71ee,_0xb12fa4,_0x3199b4);}catch(_0x21d2ff){console['log'](_0x22d1fb,_0x36c98f);}return _0x5b6591;}['_bilinearInterpolation'](_0x26f5ca,_0x4ab7ba,_0x49fdb0,_0x4bb1ce,_0xe827d4,_0x42bf9f){const _0x5d2806=0x1-_0x26f5ca,_0x2cc976=0x1-_0x4ab7ba,_0x3f2537=_0x5d2806*_0x2cc976,_0x4db59a=_0x26f5ca*_0x2cc976,_0x188111=_0x5d2806*_0x4ab7ba,_0x3060de=_0x26f5ca*_0x4ab7ba,_0x37d0c6=_0x49fdb0[0x0]*_0x3f2537+_0x4bb1ce[0x0]*_0x4db59a+_0xe827d4[0x0]*_0x188111+_0x42bf9f[0x0]*_0x3060de,_0x3fe9b1=_0x49fdb0[0x1]*_0x3f2537+_0x4bb1ce[0x1]*_0x4db59a+_0xe827d4[0x1]*_0x188111+_0x42bf9f[0x1]*_0x3060de;return this['_calcUV'](_0x37d0c6,_0x3fe9b1);}['_calcUV'](_0x5484c5,_0x14fc14){return[+_0x5484c5,+_0x14fc14,Math['sqrt'](_0x5484c5*_0x5484c5+_0x14fc14*_0x14fc14)];}['getUVByPoint'](_0x31c86a,_0x31f916){if(!this['isInExtent'](_0x31c86a,_0x31f916))return null;const _0x5d9834=this['toGridXY'](_0x31c86a,_0x31f916),_0x3282e7=this['getUVByXY'](_0x5d9834[0x0],_0x5d9834[0x1]);return _0x3282e7;}['isInExtent'](_0x2230c7,_0x1e8906){const _0x47e398=_0x55dedb;return _0x2230c7>=this[_0x47e398(0x1f0)]&&_0x2230c7<=this[_0x47e398(0x13f)]&&_0x1e8906>=this[_0x47e398(0x1ec)]&&_0x1e8906<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x3d9ee1=fRandomByfloat(this['xmin'],this['xmax']),_0xfb0e43=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0xfb0e43,'lng':_0x3d9ee1};}[_0x55dedb(0x13e)](){const _0x5c61e6=_0x55dedb;let _0x393425,_0x1df7c8,_0x58564a;for(let _0x5ed95f=0x0,_0x90a080=this['particles'][_0x5c61e6(0x173)];_0x5ed95f<_0x90a080;_0x5ed95f++){let _0xb48012=this['particles'][_0x5ed95f];_0xb48012['age']<=0x0&&(_0xb48012=this[_0x5c61e6(0x189)](_0xb48012));if(_0xb48012['age']>0x0){const _0x3c9187=_0xb48012['tlng'],_0x2a3352=_0xb48012['tlat'];_0x58564a=this['getUVByPoint'](_0x3c9187,_0x2a3352),_0x58564a?(_0x393425=_0x3c9187+this['_calc_speedRate'][0x0]*_0x58564a[0x0],_0x1df7c8=_0x2a3352+this['_calc_speedRate'][0x1]*_0x58564a[0x1],_0xb48012['lng']=_0x3c9187,_0xb48012['lat']=_0x2a3352,_0xb48012[_0x5c61e6(0x1d0)]=_0x393425,_0xb48012['tlat']=_0x1df7c8,_0xb48012['age']--):_0xb48012['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x118bb4){const _0x444af7=_0x55dedb;let _0x3656b1,_0xb722d6;for(let _0x25de98=0x0;_0x25de98<0x1e;_0x25de98++){_0x3656b1=this[_0x444af7(0x1da)](),_0xb722d6=this[_0x444af7(0x1d7)](_0x3656b1[_0x444af7(0x182)],_0x3656b1['lat']);if(_0xb722d6&&_0xb722d6[0x2]>0x0)break;}if(!_0xb722d6)return _0x118bb4;const _0x4a05f3=_0x3656b1[_0x444af7(0x182)]+this[_0x444af7(0x145)][0x0]*_0xb722d6[0x0],_0x1bab35=_0x3656b1['lat']+this[_0x444af7(0x145)][0x1]*_0xb722d6[0x1];return _0x118bb4['lng']=_0x3656b1['lng'],_0x118bb4[_0x444af7(0x190)]=_0x3656b1['lat'],_0x118bb4['tlng']=_0x4a05f3,_0x118bb4['tlat']=_0x1bab35,_0x118bb4['age']=Math['round'](Math['random']()*this['maxAge']),_0x118bb4;}['destroy'](){for(const _0x497718 in this){delete this[_0x497718];}}}function fRandomByfloat(_0x1fd2ce,_0x425ed4){const _0x46760d=_0x55dedb;return _0x1fd2ce+Math[_0x46760d(0x1b4)]()*(_0x425ed4-_0x1fd2ce);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x2dbd4b={}){const _0x30705c=_0x55dedb;super(_0x2dbd4b),this['_setOptionsHook'](_0x2dbd4b),this[_0x30705c(0x203)]=null;}['_setOptionsHook'](_0x30bf9f,_0x527eed){const _0x2a8743=_0x55dedb;this['frameTime']=0x3e8/(_0x30bf9f[_0x2a8743(0x1a6)]||0xa),this[_0x2a8743(0x191)]=this['options']['pointerEvents']??![],this['color']=_0x30bf9f['color']||'#ffffff',this['lineWidth']=_0x30bf9f['lineWidth']||0x1,this['fixedHeight']=_0x30bf9f['fixedHeight']??0x0,this['reverseY']=_0x30bf9f['reverseY']??![],this[_0x2a8743(0x18d)]&&this['windField']['setOptions'](_0x30bf9f);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x5ad5ec=_0x55dedb;return this['_map'][_0x5ad5ec(0x1d2)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0x57041b=_0x55dedb;return this['_map']['scene']['canvas'][_0x57041b(0x11f)];}get[_0x55dedb(0x13a)](){return this['_pointerEvents'];}set['pointerEvents'](_0x1c3ee7){const _0xab79fd=_0x55dedb;this[_0xab79fd(0x191)]=_0x1c3ee7;if(!this['canvas'])return;_0x1c3ee7?this[_0xab79fd(0x203)]['style'][_0xab79fd(0x168)]='all':this['canvas'][_0xab79fd(0x186)]['pointer-events']=_0xab79fd(0x172);}get[_0x55dedb(0x1bb)](){return this['options']['particlesNumber'];}set[_0x55dedb(0x1bb)](_0x141d2e){this['options']['particlesNumber']=_0x141d2e,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x2304ba){const _0x1ef599=_0x55dedb;this['options'][_0x1ef599(0x128)]=_0x2304ba,this['windField']&&(this['windField']['speedRate']=_0x2304ba);}get[_0x55dedb(0x1fd)](){const _0x1ac9d0=_0x55dedb;return this[_0x1ac9d0(0x180)][_0x1ac9d0(0x1fd)];}set['maxAge'](_0x226fc7){const _0x373076=_0x55dedb;this['options']['maxAge']=_0x226fc7,this[_0x373076(0x18d)]&&(this['windField'][_0x373076(0x1fd)]=_0x226fc7);}get['data'](){return this['windData'];}set['data'](_0x23a029){this['setData'](_0x23a029);}['_showHook'](_0x1b2101){const _0x19fb67=_0x55dedb;_0x1b2101?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this[_0x19fb67(0x187)]());}['_mountedHook'](){const _0x19996b=_0x55dedb;this['options'][_0x19996b(0x185)]?this[_0x19996b(0x1bf)]():this['windField']=new CanvasWindField(this[_0x19996b(0x180)]);}['_addedHook'](){const _0x10945e=_0x55dedb;this[_0x10945e(0x203)]=this['_createCanvas'](),this['canvasContext']=this[_0x10945e(0x203)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options']['data']);}['_removedHook'](){this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x520ae8=_0x55dedb,_0x477d75=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map']['container']);return _0x477d75['style']['position']='absolute',_0x477d75[_0x520ae8(0x186)]['top']='0px',_0x477d75['style'][_0x520ae8(0x19e)]=_0x520ae8(0x178),_0x477d75['style'][_0x520ae8(0x16a)]=this[_0x520ae8(0x1a8)]['scene']['canvas'][_0x520ae8(0x149)]+'px',_0x477d75['style']['height']=this[_0x520ae8(0x1a8)][_0x520ae8(0x1d2)][_0x520ae8(0x203)]['clientHeight']+'px',_0x477d75['style']['pointerEvents']=this[_0x520ae8(0x191)]?'auto':'none',_0x477d75['style']['zIndex']=this[_0x520ae8(0x180)]['zIndex']??0x9,_0x477d75['width']=this['_map']['scene'][_0x520ae8(0x203)]['clientWidth'],_0x477d75['height']=this['_map']['scene']['canvas']['clientHeight'],_0x477d75;}['resize'](){const _0xda3029=_0x55dedb;this['canvas']&&(this['canvas'][_0xda3029(0x186)][_0xda3029(0x16a)]=this['_map']['scene'][_0xda3029(0x203)]['clientWidth']+'px',this[_0xda3029(0x203)][_0xda3029(0x186)][_0xda3029(0x123)]=this['_map'][_0xda3029(0x1d2)]['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene'][_0xda3029(0x203)][_0xda3029(0x149)],this['canvas']['height']=this[_0xda3029(0x1a8)]['scene']['canvas']['clientHeight']);}[_0x55dedb(0x12e)](){const _0xab4dd1=_0x55dedb,_0x271bd0=this;let _0x2ae1d6=Date['now']();(function _0x5802fb(){const _0x2ed009=_0x50b8;_0x271bd0[_0x2ed009(0x132)]=window['requestAnimationFrame'](_0x5802fb);if(_0x271bd0[_0x2ed009(0x1b1)]&&_0x271bd0[_0x2ed009(0x18d)]){const _0x141786=Date['now'](),_0x8dddc=_0x141786-_0x2ae1d6;_0x8dddc>_0x271bd0['frameTime']&&(_0x2ae1d6=_0x141786-_0x8dddc%_0x271bd0['frameTime'],_0x271bd0[_0x2ed009(0x1f6)]());}}(),window[_0xab4dd1(0x1b3)](_0xab4dd1(0x135),this[_0xab4dd1(0x135)]['bind'](this),![]),this['mouse_down']=![],this[_0xab4dd1(0x1d4)]=![],this[_0xab4dd1(0x180)][_0xab4dd1(0x165)]&&(this[_0xab4dd1(0x1a8)]['on'](mars3d__namespace['EventType']['wheel'],this[_0xab4dd1(0x14c)],this),this[_0xab4dd1(0x1a8)]['on'](mars3d__namespace[_0xab4dd1(0x1f2)]['mouseDown'],this[_0xab4dd1(0x18e)],this),this[_0xab4dd1(0x1a8)]['on'](mars3d__namespace['EventType'][_0xab4dd1(0x1d5)],this['_onMouseUpEvent'],this)));}[_0x55dedb(0x1c3)](){const _0x5632a8=_0x55dedb;window['cancelAnimationFrame'](this[_0x5632a8(0x132)]),delete this[_0x5632a8(0x132)],window[_0x5632a8(0x1f9)]('resize',this['resize']),this['options']['mouseHidden']&&(this['_map'][_0x5632a8(0x1a1)](mars3d__namespace['EventType']['wheel'],this[_0x5632a8(0x14c)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x5632a8(0x1e4)],this[_0x5632a8(0x18e)],this),this[_0x5632a8(0x1a8)]['off'](mars3d__namespace[_0x5632a8(0x1f2)]['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x5632a8(0x1a1)](mars3d__namespace[_0x5632a8(0x1f2)][_0x5632a8(0x1cd)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x27e0dd){const _0x1b8ecd=_0x55dedb;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x1b8ecd(0x203)])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x4774f0=_0x1b8ecd;if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']=_0x4774f0(0x188);},0xc8);}['_onMouseDownEvent'](_0x1ef855){const _0x1eee55=_0x55dedb;this['mouse_down']=!![],this[_0x1eee55(0x1a8)][_0x1eee55(0x1a1)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x1eee55(0x1a8)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x55dedb(0x16c)](_0x22ceb3){const _0x1033a6=_0x55dedb;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this[_0x1033a6(0x203)][_0x1033a6(0x186)]['visibility']='hidden',this[_0x1033a6(0x1d4)]=!![]);}['_onMouseUpEvent'](_0x178da7){const _0x29745a=_0x55dedb;if(!this['show']||!this[_0x29745a(0x203)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x29745a(0x203)]['style']['visibility']='visible',this['mouse_down']=![],this[_0x29745a(0x1d4)]=![];}['setData'](_0x180369){const _0x581cdc=_0x55dedb;this['clear'](),this['windData']=_0x180369,this['windField']['setDate'](_0x180369),this[_0x581cdc(0x143)]();}['redraw'](){const _0x294620=_0x55dedb;if(!this['show'])return;this['windField']['setOptions'](this[_0x294620(0x180)]),this['update']();}[_0x55dedb(0x1f6)](){const _0x557bf1=_0x55dedb;if(this['_updateIng'])return;this[_0x557bf1(0x122)]=!![];if(this['worker'])this['windField']['update']();else{const _0x11654d=this['windField'][_0x557bf1(0x13e)]();this['_drawLines'](_0x11654d);}this[_0x557bf1(0x122)]=![];}['_drawLines'](_0x422e7a){const _0xbcc98c=_0x55dedb;this['canvasContext']['globalCompositeOperation']='destination-in',this[_0xbcc98c(0x18a)]['fillRect'](0x0,0x0,this['canvasWidth'],this[_0xbcc98c(0x204)]),this['canvasContext'][_0xbcc98c(0x1b2)]='lighter',this[_0xbcc98c(0x18a)]['globalAlpha']=0.9,this[_0xbcc98c(0x18a)][_0xbcc98c(0x15b)](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0xbcc98c(0x18a)]['strokeStyle']=this[_0xbcc98c(0x18f)];const _0x146ae3=this[_0xbcc98c(0x1a8)]['scene'][_0xbcc98c(0x195)]!==Cesium[_0xbcc98c(0x12a)]['SCENE3D'],_0x5d2cb0=this[_0xbcc98c(0x17a)]*0.25;for(let _0x3c5539=0x0,_0x2afe6d=_0x422e7a['length'];_0x3c5539<_0x2afe6d;_0x3c5539++){const _0x2aa8ef=_0x422e7a[_0x3c5539],_0x427a4a=this[_0xbcc98c(0x127)](_0x2aa8ef[_0xbcc98c(0x182)],_0x2aa8ef['lat'],_0x2aa8ef),_0xaead2b=this['_tomap'](_0x2aa8ef['tlng'],_0x2aa8ef['tlat'],_0x2aa8ef);if(!_0x427a4a||!_0xaead2b)continue;if(_0x146ae3&&Math[_0xbcc98c(0x15d)](_0x427a4a[0x0]-_0xaead2b[0x0])>=_0x5d2cb0)continue;this[_0xbcc98c(0x18a)]['moveTo'](_0x427a4a[0x0],_0x427a4a[0x1]),this['canvasContext']['lineTo'](_0xaead2b[0x0],_0xaead2b[0x1]);}this['canvasContext']['stroke']();}['_tomap'](_0x39ea8e,_0x2c3011,_0x1e6b11){const _0x254420=_0x55dedb,_0x3e3b37=Cesium['Cartesian3']['fromDegrees'](_0x39ea8e,_0x2c3011,this[_0x254420(0x1eb)]),_0x5c7255=this['_map']['scene'];if(_0x5c7255[_0x254420(0x195)]===Cesium['SceneMode']['SCENE3D']){const _0x13f4f4=new Cesium[(_0x254420(0x1ee))](_0x5c7255[_0x254420(0x1c8)]['ellipsoid'],_0x5c7255['camera']['positionWC']),_0x5b3fc1=_0x13f4f4[_0x254420(0x1dc)](_0x3e3b37);if(!_0x5b3fc1)return _0x1e6b11['age']=0x0,null;}const _0x3be358=Cesium['SceneTransforms'][_0x254420(0x1e9)](this[_0x254420(0x1a8)]['scene'],_0x3e3b37);return _0x3be358?[_0x3be358['x'],_0x3be358['y']]:null;}['clear'](){const _0x2d365c=_0x55dedb;this['windField']['clear'](),delete this[_0x2d365c(0x121)];}['initWorker'](){const _0x2226ef=_0x55dedb;this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=_0x9ff307=>{this['_drawLines'](_0x9ff307['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x2dce0d=>{this['worker']['postMessage']({'type':'init','options':_0x2dce0d});},'setOptions':_0x1e508d=>{const _0x38f959=_0x50b8;this[_0x38f959(0x185)]['postMessage']({'type':'setOptions','options':_0x1e508d});},'setDate':_0x1b19b7=>{const _0x1de529=_0x50b8;this['worker'][_0x1de529(0x1ff)]({'type':'setDate','data':_0x1b19b7});},'update':()=>{const _0x44fc9d=_0x50b8;if(this['_updateIng2'])return;this[_0x44fc9d(0x1e2)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0xbbf38f=_0x50b8;this[_0xbbf38f(0x185)]['postMessage']({'type':'clear'});}},this[_0x2226ef(0x18d)][_0x2226ef(0x151)](this[_0x2226ef(0x180)]);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x55dedb(0x18c)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x55dedb(0x144)](exports,'__esModule',{'value':!![]});
}));
