/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.12
 * 编译日期：2023-06-19 10:10:45
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x1cfd68=_0x3da3;(function(_0xe24e0d,_0x2f3790){const _0xb66528=_0x3da3,_0x40e176=_0xe24e0d();while(!![]){try{const _0x56d327=-parseInt(_0xb66528(0x264))/0x1*(-parseInt(_0xb66528(0x1f1))/0x2)+-parseInt(_0xb66528(0x1fb))/0x3*(parseInt(_0xb66528(0x25b))/0x4)+-parseInt(_0xb66528(0x2a0))/0x5*(parseInt(_0xb66528(0x1ec))/0x6)+parseInt(_0xb66528(0x23d))/0x7+-parseInt(_0xb66528(0x2ae))/0x8*(-parseInt(_0xb66528(0x27e))/0x9)+parseInt(_0xb66528(0x1ff))/0xa+-parseInt(_0xb66528(0x29c))/0xb*(parseInt(_0xb66528(0x283))/0xc);if(_0x56d327===_0x2f3790)break;else _0x40e176['push'](_0x40e176['shift']());}catch(_0x217038){_0x40e176['push'](_0x40e176['shift']());}}}(_0x4ab3,0x1da03));function _interopNamespace(_0x404de7){const _0xf5d895=_0x3da3;if(_0x404de7&&_0x404de7[_0xf5d895(0x1fc)])return _0x404de7;var _0x37e12f=Object['create'](null);return _0x404de7&&Object['keys'](_0x404de7)['forEach'](function(_0x4d5f2f){const _0x3aaa08=_0xf5d895;if(_0x4d5f2f!==_0x3aaa08(0x265)){var _0x263df3=Object[_0x3aaa08(0x1de)](_0x404de7,_0x4d5f2f);Object['defineProperty'](_0x37e12f,_0x4d5f2f,_0x263df3['get']?_0x263df3:{'enumerable':!![],'get':function(){return _0x404de7[_0x4d5f2f];}});}}),_0x37e12f['default']=_0x404de7,_0x37e12f;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x2d242d,_0x52d1b6){const _0xa677df=_0x3da3,_0x32234c=_0x2d242d*Math[_0xa677df(0x1e0)](Cesium$7['Math']['toRadians'](_0x52d1b6));return _0x32234c;}function getV(_0xd75c3,_0x134030){const _0x564907=_0x3da3,_0x5e14c5=_0xd75c3*Math['sin'](Cesium$7[_0x564907(0x21a)]['toRadians'](_0x134030));return _0x5e14c5;}function getSpeed(_0x4c654d,_0x3ee03b){const _0x37d316=_0x3da3,_0x293ed5=Math['sqrt'](Math[_0x37d316(0x2b6)](_0x4c654d,0x2)+Math[_0x37d316(0x2b6)](_0x3ee03b,0x2));return _0x293ed5;}function getDirection(_0x3c9385,_0x1a6d9b){const _0x386a36=_0x3da3;let _0x591033=Cesium$7['Math'][_0x386a36(0x2ad)](Math['atan2'](_0x1a6d9b,_0x3c9385));return _0x591033+=_0x591033<0x0?0x168:0x0,_0x591033;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x5adce5){const _0x13a4d9=_0x3da3;this['commandType']=_0x5adce5['commandType'],this[_0x13a4d9(0x274)]=_0x5adce5['geometry'],this['attributeLocations']=_0x5adce5[_0x13a4d9(0x23b)],this[_0x13a4d9(0x2a2)]=_0x5adce5['primitiveType'],this['uniformMap']=_0x5adce5[_0x13a4d9(0x28d)],this['vertexShaderSource']=_0x5adce5['vertexShaderSource'],this['fragmentShaderSource']=_0x5adce5['fragmentShaderSource'],this['rawRenderState']=_0x5adce5[_0x13a4d9(0x1c6)],this['framebuffer']=_0x5adce5['framebuffer'],this[_0x13a4d9(0x1f7)]=_0x5adce5['outputTexture'],this['autoClear']=_0x5adce5['autoClear']??![],this['preExecute']=_0x5adce5[_0x13a4d9(0x25a)],this['show']=!![],this['commandToExecute']=undefined,this[_0x13a4d9(0x207)]=undefined,this['autoClear']&&(this[_0x13a4d9(0x207)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x13a4d9(0x2ac)]}));}[_0x1cfd68(0x1fd)](_0x1ecc0e){const _0x3ca278=_0x1cfd68;switch(this['commandType']){case'Draw':{const _0x523f54=Cesium$6[_0x3ca278(0x22a)]['fromGeometry']({'context':_0x1ecc0e,'geometry':this['geometry'],'attributeLocations':this[_0x3ca278(0x23b)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x2ac47f=Cesium$6[_0x3ca278(0x26c)]['fromCache']({'context':_0x1ecc0e,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x3ca278(0x289)],'fragmentShaderSource':this[_0x3ca278(0x29d)]}),_0x1d5519=Cesium$6['RenderState'][_0x3ca278(0x29b)](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x2ac47f,'vertexArray':_0x523f54,'modelMatrix':Cesium$6['Matrix4'][_0x3ca278(0x1d5)],'renderState':_0x1d5519,'uniformMap':this[_0x3ca278(0x28d)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x2a2a19,_0x1bc3fa){const _0x5ca90b=_0x1cfd68;this['geometry']=_0x1bc3fa;const _0x1aeaab=Cesium$6['VertexArray'][_0x5ca90b(0x26d)]({'context':_0x2a2a19,'geometry':this['geometry'],'attributeLocations':this[_0x5ca90b(0x23b)],'bufferUsage':Cesium$6[_0x5ca90b(0x1ea)]['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x1aeaab;}[_0x1cfd68(0x21b)](_0x1b3ec6){const _0x3e0219=_0x1cfd68;if(!this[_0x3e0219(0x26f)])return;if(_0x1b3ec6[_0x3e0219(0x26e)]!==Cesium$6[_0x3e0219(0x2b3)]['SCENE3D'])return;!Cesium$6[_0x3e0219(0x25e)](this[_0x3e0219(0x1f0)])&&(this[_0x3e0219(0x1f0)]=this['createCommand'](_0x1b3ec6[_0x3e0219(0x1eb)])),Cesium$6[_0x3e0219(0x25e)](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x1b3ec6['commandList']['push'](this[_0x3e0219(0x207)]),_0x1b3ec6[_0x3e0219(0x220)][_0x3e0219(0x29a)](this['commandToExecute']);}['isDestroyed'](){return![];}[_0x1cfd68(0x262)](){const _0x55c7b9=_0x1cfd68;if(this['clearCommand']){var _0x456309,_0x15d4bb;(_0x456309=this['clearCommand'])!==null&&_0x456309!==void 0x0&&_0x456309[_0x55c7b9(0x1d9)]&&this['clearCommand']['vertexArray'][_0x55c7b9(0x262)](),(_0x15d4bb=this['clearCommand'])!==null&&_0x15d4bb!==void 0x0&&_0x15d4bb['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this[_0x55c7b9(0x1f0)]&&(this['commandToExecute']['vertexArray']&&this[_0x55c7b9(0x1f0)]['vertexArray'][_0x55c7b9(0x262)](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0x1cfd68(0x233)],Util=(function(){const _0x2b347a=function(){const _0x1a2c6a=_0x3da3,_0x2ebd35=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x1a2c6a(0x1fa))]({'componentDatatype':Cesium$5[_0x1a2c6a(0x20b)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x1a2c6a(0x1fa))]({'componentDatatype':Cesium$5[_0x1a2c6a(0x20b)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x2ebd35;},_0x18dc23=function(_0x29971b,_0x828fa7){const _0x37e1a2=_0x3da3;if(Cesium$5['defined'](_0x828fa7)){const _0x2e3e70={};_0x2e3e70['arrayBufferView']=_0x828fa7,_0x29971b['source']=_0x2e3e70;}const _0x18b767=new Cesium$5[(_0x37e1a2(0x273))](_0x29971b);return _0x18b767;},_0x3b18d7=function(_0x498fde,_0x1b4f4f,_0x564375){const _0x24a224=_0x3da3,_0x400eea=new Cesium$5[(_0x24a224(0x2a1))]({'context':_0x498fde,'colorTextures':[_0x1b4f4f],'depthTexture':_0x564375});return _0x400eea;},_0x19b903=function(_0x419e1c){const _0x150e43=_0x3da3,_0x11d414=!![],_0x59b1ae=![],_0x300d5e={'viewport':_0x419e1c['viewport'],'depthTest':_0x419e1c['depthTest'],'depthMask':_0x419e1c['depthMask'],'blending':_0x419e1c[_0x150e43(0x29e)]},_0x2d89e1=Cesium$5['Appearance'][_0x150e43(0x2a4)](_0x11d414,_0x59b1ae,_0x300d5e);return _0x2d89e1;},_0x3eff2d=function(_0x3cb83d){const _0x1ae4e6=_0x3da3,_0x175c80={},_0x4e84ad=Cesium$5['Math']['mod'](_0x3cb83d['west'],Cesium$5['Math']['TWO_PI']),_0x5790da=Cesium$5[_0x1ae4e6(0x21a)]['mod'](_0x3cb83d['east'],Cesium$5[_0x1ae4e6(0x21a)][_0x1ae4e6(0x1d7)]),_0x4b34c8=_0x3cb83d['width'];let _0x4e9806,_0x16364b;_0x4b34c8>Cesium$5[_0x1ae4e6(0x21a)]['THREE_PI_OVER_TWO']?(_0x4e9806=0x0,_0x16364b=Cesium$5['Math']['TWO_PI']):_0x5790da-_0x4e84ad<_0x4b34c8?(_0x4e9806=_0x4e84ad,_0x16364b=_0x4e84ad+_0x4b34c8):(_0x4e9806=_0x4e84ad,_0x16364b=_0x5790da);_0x175c80[_0x1ae4e6(0x234)]={'min':Cesium$5['Math']['toDegrees'](_0x4e9806),'max':Cesium$5['Math'][_0x1ae4e6(0x2ad)](_0x16364b)};const _0x26d018=_0x3cb83d[_0x1ae4e6(0x22f)],_0x229213=_0x3cb83d['north'],_0x5253e5=_0x3cb83d['height'],_0x334e98=_0x5253e5>Cesium$5[_0x1ae4e6(0x21a)]['PI']/0xc?_0x5253e5/0x2:0x0;let _0x195f52=Cesium$5['Math']['clampToLatitudeRange'](_0x26d018-_0x334e98),_0x47de21=Cesium$5['Math']['clampToLatitudeRange'](_0x229213+_0x334e98);return _0x195f52<-Cesium$5[_0x1ae4e6(0x21a)]['PI_OVER_THREE']&&(_0x195f52=-Cesium$5['Math']['PI_OVER_TWO']),_0x47de21>Cesium$5[_0x1ae4e6(0x21a)]['PI_OVER_THREE']&&(_0x47de21=Cesium$5['Math'][_0x1ae4e6(0x1cc)]),_0x175c80['lat']={'min':Cesium$5['Math']['toDegrees'](_0x195f52),'max':Cesium$5['Math']['toDegrees'](_0x47de21)},_0x175c80;};return{'getFullscreenQuad':_0x2b347a,'createTexture':_0x18dc23,'createFramebuffer':_0x3b18d7,'createRawRenderState':_0x19b903,'viewRectangleToLonLatRange':_0x3eff2d};}());var segmentDraw_vert=_0x1cfd68(0x209),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x1cfd68(0x1fe),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x1cfd68(0x233)];function _0x3da3(_0x16d191,_0x1410b6){const _0x4ab39b=_0x4ab3();return _0x3da3=function(_0x3da327,_0x2da054){_0x3da327=_0x3da327-0x1c5;let _0x5740a9=_0x4ab39b[_0x3da327];return _0x5740a9;},_0x3da3(_0x16d191,_0x1410b6);}class ParticlesRendering{constructor(_0x2c8474,_0x2a0d44,_0x282e4d,_0x525fa2,_0x278074){const _0x4a26a9=_0x1cfd68;this['createRenderingTextures'](_0x2c8474,_0x2a0d44,_0x282e4d['colors']),this[_0x4a26a9(0x1f2)](_0x2c8474),this['createRenderingPrimitives'](_0x2c8474,_0x282e4d,_0x525fa2,_0x278074);}[_0x1cfd68(0x222)](_0x403cf7,_0x2696c1,_0x166e29){const _0x574cfc=_0x1cfd68,_0x19735a={'context':_0x403cf7,'width':_0x403cf7['drawingBufferWidth'],'height':_0x403cf7['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x574cfc(0x1db)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x4bb860={'context':_0x403cf7,'width':_0x403cf7[_0x574cfc(0x270)],'height':_0x403cf7['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x574cfc(0x22b)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x3828bd=_0x166e29['length'],_0x4125c8=new Float32Array(_0x3828bd*0x3);for(let _0x7efd67=0x0;_0x7efd67<_0x3828bd;_0x7efd67++){const _0x1150bc=Cesium$4[_0x574cfc(0x24f)]['fromCssColorString'](_0x166e29[_0x7efd67]);_0x4125c8[0x3*_0x7efd67]=_0x1150bc['red'],_0x4125c8[0x3*_0x7efd67+0x1]=_0x1150bc['green'],_0x4125c8[0x3*_0x7efd67+0x2]=_0x1150bc['blue'];}const _0x47e546={'context':_0x403cf7,'width':_0x3828bd,'height':0x1,'pixelFormat':Cesium$4[_0x574cfc(0x1f6)][_0x574cfc(0x281)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x574cfc(0x224)],'sampler':new Cesium$4[(_0x574cfc(0x266))]({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x574cfc(0x23a)]={'segmentsColor':Util[_0x574cfc(0x286)](_0x19735a),'segmentsDepth':Util['createTexture'](_0x4bb860),'currentTrailsColor':Util['createTexture'](_0x19735a),'currentTrailsDepth':Util[_0x574cfc(0x286)](_0x4bb860),'nextTrailsColor':Util['createTexture'](_0x19735a),'nextTrailsDepth':Util['createTexture'](_0x4bb860),'colorTable':Util['createTexture'](_0x47e546,_0x4125c8)};}['createRenderingFramebuffers'](_0x5554ff){const _0x1a3c7a=_0x1cfd68;this['framebuffers']={'segments':Util['createFramebuffer'](_0x5554ff,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x5554ff,this['textures']['currentTrailsColor'],this[_0x1a3c7a(0x23a)][_0x1a3c7a(0x23c)]),'nextTrails':Util[_0x1a3c7a(0x2b9)](_0x5554ff,this['textures']['nextTrailsColor'],this['textures'][_0x1a3c7a(0x1d8)])};}['createSegmentsGeometry'](_0x538060){const _0x32e72f=_0x1cfd68,_0x4d0d04=0x4;let _0x21c218=[];for(let _0x360192=0x0;_0x360192<_0x538060['particlesTextureSize'];_0x360192++){for(let _0x59af0a=0x0;_0x59af0a<_0x538060['particlesTextureSize'];_0x59af0a++){for(let _0x1354d0=0x0;_0x1354d0<_0x4d0d04;_0x1354d0++){_0x21c218['push'](_0x360192/_0x538060['particlesTextureSize']),_0x21c218[_0x32e72f(0x29a)](_0x59af0a/_0x538060['particlesTextureSize']);}}}_0x21c218=new Float32Array(_0x21c218);let _0x20a9e6=[];const _0x2d9097=[-0x1,0x1],_0x4a3b89=[-0x1,0x1];for(let _0x38b1a5=0x0;_0x38b1a5<_0x538060['maxParticles'];_0x38b1a5++){for(let _0x47c674=0x0;_0x47c674<_0x4d0d04/0x2;_0x47c674++){for(let _0x18b735=0x0;_0x18b735<_0x4d0d04/0x2;_0x18b735++){_0x20a9e6[_0x32e72f(0x29a)](_0x2d9097[_0x47c674]),_0x20a9e6['push'](_0x4a3b89[_0x18b735]),_0x20a9e6['push'](0x0);}}}_0x20a9e6=new Float32Array(_0x20a9e6);const _0x420d86=0x6*_0x538060['maxParticles'],_0x499c99=new Uint32Array(_0x420d86);for(let _0x428e0e=0x0,_0x6ee2e2=0x0,_0x81e82c=0x0;_0x428e0e<_0x538060['maxParticles'];_0x428e0e++){_0x499c99[_0x6ee2e2++]=_0x81e82c+0x0,_0x499c99[_0x6ee2e2++]=_0x81e82c+0x1,_0x499c99[_0x6ee2e2++]=_0x81e82c+0x2,_0x499c99[_0x6ee2e2++]=_0x81e82c+0x2,_0x499c99[_0x6ee2e2++]=_0x81e82c+0x1,_0x499c99[_0x6ee2e2++]=_0x81e82c+0x3,_0x81e82c+=0x4;}const _0x2ed03a=new Cesium$4[(_0x32e72f(0x2b7))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x32e72f(0x1fa))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x21c218}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x32e72f(0x224)],'componentsPerAttribute':0x3,'values':_0x20a9e6})}),'indices':_0x499c99});return _0x2ed03a;}['createRenderingPrimitives'](_0x4742ce,_0x16df77,_0x6e7851,_0x41dc98){const _0x27340a=_0x1cfd68,_0x1b48a0=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x27340a(0x260)](_0x16df77),'primitiveType':Cesium$4[_0x27340a(0x1e7)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x456a94=_0x27340a;return _0x41dc98[_0x456a94(0x1e5)]['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x41dc98['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x4c578c=_0x27340a;return _0x41dc98['particlesTextures'][_0x4c578c(0x25d)];},'colorTable':function(){const _0x265c30=_0x27340a;return _0x1b48a0[_0x265c30(0x23a)][_0x265c30(0x1f3)];},'aspect':function(){return _0x4742ce['drawingBufferWidth']/_0x4742ce['drawingBufferHeight'];},'pixelSize':function(){return _0x6e7851['pixelSize'];},'lineWidth':function(){const _0x2fd851=_0x27340a;return _0x16df77[_0x2fd851(0x294)];},'particleHeight':function(){return _0x16df77['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x27340a(0x27f))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x27340a(0x261),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x464c58=_0x27340a;return _0x1b48a0[_0x464c58(0x23a)][_0x464c58(0x201)];},'segmentsDepthTexture':function(){return _0x1b48a0['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x525d61=_0x27340a;return _0x1b48a0[_0x525d61(0x268)][_0x525d61(0x1ed)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x11cb85=_0x27340a;return _0x1b48a0['framebuffers'][_0x11cb85(0x1ed)][_0x11cb85(0x1ce)];},'fadeOpacity':function(){return _0x16df77['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x27340a(0x27f))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x27340a(0x27f))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x3c4d79=_0x27340a,_0x58f027=_0x1b48a0[_0x3c4d79(0x268)]['currentTrails'];_0x1b48a0[_0x3c4d79(0x268)][_0x3c4d79(0x1ed)]=_0x1b48a0['framebuffers']['nextTrails'],_0x1b48a0['framebuffers']['nextTrails']=_0x58f027,_0x1b48a0['primitives']['trails']['commandToExecute']['framebuffer']=_0x1b48a0['framebuffers']['nextTrails'],_0x1b48a0['primitives'][_0x3c4d79(0x1e8)]['clearCommand'][_0x3c4d79(0x244)]=_0x1b48a0['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x5ba8da=_0x27340a;return _0x1b48a0[_0x5ba8da(0x268)][_0x5ba8da(0x213)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x12db96=_0x27340a;return _0x1b48a0['framebuffers'][_0x12db96(0x213)]['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x27340a(0x27f))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x27340a(0x21c)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x1cfd68(0x2a7),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x1cfd68(0x227),postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x1d1dd7,_0x3c79f9,_0x453f35,_0x5626c1){const _0x2036b8=_0x1cfd68;this['data']=_0x3c79f9,this['createWindTextures'](_0x1d1dd7,_0x3c79f9),this['createParticlesTextures'](_0x1d1dd7,_0x453f35,_0x5626c1),this[_0x2036b8(0x254)](_0x3c79f9,_0x453f35,_0x5626c1);}[_0x1cfd68(0x1c5)](_0x7bfc92,_0x52ecf1){const _0x490aba=_0x1cfd68,_0x43b97b={'context':_0x7bfc92,'width':_0x52ecf1['dimensions']['lon'],'height':_0x52ecf1['dimensions']['lat']*(_0x52ecf1['dimensions'][_0x490aba(0x26b)]||0x1),'pixelFormat':Cesium$3[_0x490aba(0x1f6)]['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x490aba(0x224)],'flipY':![],'sampler':new Cesium$3[(_0x490aba(0x266))]({'minificationFilter':Cesium$3[_0x490aba(0x1da)]['NEAREST'],'magnificationFilter':Cesium$3[_0x490aba(0x257)]['NEAREST']})};this[_0x490aba(0x267)]={'U':Util['createTexture'](_0x43b97b,_0x52ecf1['U']['array']),'V':Util['createTexture'](_0x43b97b,_0x52ecf1['V']['array'])};}['createParticlesTextures'](_0x258839,_0x3a99ab,_0x4fb652){const _0x394ae5=_0x1cfd68,_0x1306f3={'context':_0x258839,'width':_0x3a99ab['particlesTextureSize'],'height':_0x3a99ab['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x394ae5(0x266))]({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x394ae5(0x245)],'magnificationFilter':Cesium$3[_0x394ae5(0x257)][_0x394ae5(0x245)]})},_0xad5122=this[_0x394ae5(0x231)](_0x3a99ab['maxParticles'],_0x4fb652),_0x3a66d4=new Float32Array(0x4*_0x3a99ab['maxParticles'])['fill'](0x0);this[_0x394ae5(0x1e5)]={'particlesWind':Util['createTexture'](_0x1306f3),'currentParticlesPosition':Util['createTexture'](_0x1306f3,_0xad5122),'nextParticlesPosition':Util['createTexture'](_0x1306f3,_0xad5122),'currentParticlesSpeed':Util['createTexture'](_0x1306f3,_0x3a66d4),'nextParticlesSpeed':Util['createTexture'](_0x1306f3,_0x3a66d4),'postProcessingPosition':Util['createTexture'](_0x1306f3,_0xad5122),'postProcessingSpeed':Util['createTexture'](_0x1306f3,_0x3a66d4)};}[_0x1cfd68(0x231)](_0xe3560f,_0x180aa9){const _0x197211=_0x1cfd68,_0x4fddd7=new Float32Array(0x4*_0xe3560f);for(let _0x9a1291=0x0;_0x9a1291<_0xe3560f;_0x9a1291++){_0x4fddd7[0x4*_0x9a1291]=Cesium$3['Math']['randomBetween'](_0x180aa9['lonRange']['x'],_0x180aa9['lonRange']['y']),_0x4fddd7[0x4*_0x9a1291+0x1]=Cesium$3['Math']['randomBetween'](_0x180aa9[_0x197211(0x214)]['x'],_0x180aa9['latRange']['y']),_0x4fddd7[0x4*_0x9a1291+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this[_0x197211(0x1e4)]['lev']['max']),_0x4fddd7[0x4*_0x9a1291+0x3]=0x0;}return _0x4fddd7;}[_0x1cfd68(0x24e)](){Object['keys'](this['particlesTextures'])['forEach'](_0x26c034=>{this['particlesTextures'][_0x26c034]['destroy']();});}['createComputingPrimitives'](_0x45b4c7,_0x593e4b,_0x3d4054){const _0x443067=_0x1cfd68,_0x54c0d8=new Cesium$3[(_0x443067(0x246))](_0x45b4c7[_0x443067(0x2a8)]['lon'],_0x45b4c7['dimensions'][_0x443067(0x2bb)],_0x45b4c7['dimensions']['lev']),_0x2a12ce=new Cesium$3['Cartesian3'](_0x45b4c7['lon']['min'],_0x45b4c7['lat']['min'],_0x45b4c7[_0x443067(0x26b)]['min']),_0x3ea7a8=new Cesium$3['Cartesian3'](_0x45b4c7['lon']['max'],_0x45b4c7['lat']['max'],_0x45b4c7['lev'][_0x443067(0x275)]),_0x1b3045=new Cesium$3[(_0x443067(0x246))]((_0x3ea7a8['x']-_0x2a12ce['x'])/(_0x54c0d8['x']-0x1),(_0x3ea7a8['y']-_0x2a12ce['y'])/(_0x54c0d8['y']-0x1),_0x54c0d8['z']>0x1?(_0x3ea7a8['z']-_0x2a12ce['z'])/(_0x54c0d8['z']-0x1):0x1),_0x53f73d=new Cesium$3[(_0x443067(0x26a))](_0x45b4c7['U']['min'],_0x45b4c7['U']['max']),_0x201b57=new Cesium$3['Cartesian2'](_0x45b4c7['V']['min'],_0x45b4c7['V']['max']),_0x2ca1d5=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x3fcd02=_0x443067;return _0x2ca1d5[_0x3fcd02(0x267)]['U'];},'V':function(){return _0x2ca1d5['windTextures']['V'];},'currentParticlesPosition':function(){const _0x453626=_0x443067;return _0x2ca1d5['particlesTextures'][_0x453626(0x22e)];},'dimension':function(){return _0x54c0d8;},'minimum':function(){return _0x2a12ce;},'maximum':function(){return _0x3ea7a8;},'interval':function(){return _0x1b3045;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x2acfd3=_0x443067;_0x2ca1d5['primitives'][_0x2acfd3(0x236)]['commandToExecute'][_0x2acfd3(0x1f7)]=_0x2ca1d5['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x443067(0x238),'uniformMap':{'currentParticlesSpeed':function(){const _0x530242=_0x443067;return _0x2ca1d5['particlesTextures'][_0x530242(0x28e)];},'particlesWind':function(){const _0x4be478=_0x443067;return _0x2ca1d5[_0x4be478(0x1e5)][_0x4be478(0x27d)];},'uSpeedRange':function(){return _0x53f73d;},'vSpeedRange':function(){return _0x201b57;},'pixelSize':function(){return _0x3d4054['pixelSize'];},'speedFactor':function(){return _0x593e4b['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x443067(0x1e5)][_0x443067(0x221)],'preExecute':function(){const _0x53f2d3=_0x443067,_0x3b087d=_0x2ca1d5['particlesTextures'][_0x53f2d3(0x28e)];_0x2ca1d5[_0x53f2d3(0x1e5)]['currentParticlesSpeed']=_0x2ca1d5[_0x53f2d3(0x1e5)]['postProcessingSpeed'],_0x2ca1d5[_0x53f2d3(0x1e5)][_0x53f2d3(0x25d)]=_0x3b087d,_0x2ca1d5['primitives'][_0x53f2d3(0x28b)]['commandToExecute']['outputTexture']=_0x2ca1d5[_0x53f2d3(0x1e5)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x570726=_0x443067;return _0x2ca1d5['particlesTextures'][_0x570726(0x22e)];},'currentParticlesSpeed':function(){const _0x3ee10d=_0x443067;return _0x2ca1d5['particlesTextures'][_0x3ee10d(0x28e)];}},'fragmentShaderSource':new Cesium$3[(_0x443067(0x27f))]({'sources':[updatePosition_frag]}),'outputTexture':this[_0x443067(0x1e5)][_0x443067(0x293)],'preExecute':function(){const _0x3a4e29=_0x443067,_0x325a7f=_0x2ca1d5[_0x3a4e29(0x1e5)][_0x3a4e29(0x22e)];_0x2ca1d5['particlesTextures']['currentParticlesPosition']=_0x2ca1d5['particlesTextures']['postProcessingPosition'],_0x2ca1d5['particlesTextures']['postProcessingPosition']=_0x325a7f,_0x2ca1d5['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x2ca1d5['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x443067(0x238),'uniformMap':{'nextParticlesPosition':function(){const _0x34e360=_0x443067;return _0x2ca1d5['particlesTextures'][_0x34e360(0x293)];},'nextParticlesSpeed':function(){return _0x2ca1d5['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x3d4054['lonRange'];},'latRange':function(){return _0x3d4054['latRange'];},'randomCoefficient':function(){const _0x553344=Math['random']();return _0x553344;},'dropRate':function(){const _0x24f7c7=_0x443067;return _0x593e4b[_0x24f7c7(0x23e)];},'dropRateBump':function(){return _0x593e4b['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x443067(0x27f))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x443067(0x1f5)],'preExecute':function(){const _0x5a16a8=_0x443067;_0x2ca1d5[_0x5a16a8(0x1d2)]['postProcessingPosition']['commandToExecute']['outputTexture']=_0x2ca1d5[_0x5a16a8(0x1e5)][_0x5a16a8(0x1f5)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x443067(0x238),'uniformMap':{'postProcessingPosition':function(){return _0x2ca1d5['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0xc10fe7=_0x443067;return _0x2ca1d5[_0xc10fe7(0x1e5)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){_0x2ca1d5['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x2ca1d5['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x1cfd68(0x233)];class ParticleSystem{constructor(_0x1bea3a,_0x232d6f,_0x2d4353,_0x47f052){const _0x493def=_0x1cfd68;this['context']=_0x1bea3a,_0x232d6f={..._0x232d6f},_0x232d6f['udata']&&_0x232d6f[_0x493def(0x229)]&&(_0x232d6f['dimensions']={},_0x232d6f['dimensions'][_0x493def(0x234)]=_0x232d6f['cols'],_0x232d6f[_0x493def(0x2a8)][_0x493def(0x2bb)]=_0x232d6f['rows'],_0x232d6f['dimensions']['lev']=_0x232d6f['lev']||0x1,_0x232d6f[_0x493def(0x234)]={},_0x232d6f['lon'][_0x493def(0x263)]=_0x232d6f['xmin'],_0x232d6f['lon']['max']=_0x232d6f['xmax'],_0x232d6f[_0x493def(0x2bb)]={},_0x232d6f['lat']['min']=_0x232d6f['ymin'],_0x232d6f['lat'][_0x493def(0x275)]=_0x232d6f['ymax'],_0x232d6f[_0x493def(0x26b)]={},_0x232d6f['lev']['min']=_0x232d6f[_0x493def(0x240)]??0x1,_0x232d6f['lev'][_0x493def(0x275)]=_0x232d6f['levmax']??0x1,_0x232d6f['U']={},_0x232d6f['U']['array']=new Float32Array(_0x232d6f['udata']),_0x232d6f['U'][_0x493def(0x263)]=_0x232d6f['umin']??Math['min'](..._0x232d6f['udata']),_0x232d6f['U'][_0x493def(0x275)]=_0x232d6f['umax']??Math['max'](..._0x232d6f[_0x493def(0x2ba)]),_0x232d6f['V']={},_0x232d6f['V']['array']=new Float32Array(_0x232d6f['vdata']),_0x232d6f['V'][_0x493def(0x263)]=_0x232d6f[_0x493def(0x208)]??Math[_0x493def(0x263)](..._0x232d6f['vdata']),_0x232d6f['V'][_0x493def(0x275)]=_0x232d6f['vmax']??Math['max'](..._0x232d6f[_0x493def(0x229)])),this['data']=_0x232d6f,this[_0x493def(0x285)]=_0x2d4353,this['viewerParameters']=_0x47f052,this['particlesComputing']=new ParticlesComputing(this[_0x493def(0x1eb)],this[_0x493def(0x1e4)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x493def(0x285)],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x2a0bf8){const _0x3df7e4=_0x1cfd68;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x3df7e4(0x237)][_0x3df7e4(0x267)])['forEach'](_0x107f8e=>{const _0x1b31e8=_0x3df7e4;this[_0x1b31e8(0x237)]['windTextures'][_0x107f8e][_0x1b31e8(0x262)]();}),this[_0x3df7e4(0x249)]['textures']['colorTable']['destroy'](),Object[_0x3df7e4(0x24b)](this['particlesRendering'][_0x3df7e4(0x268)])['forEach'](_0x5c8d1d=>{this['particlesRendering']['framebuffers'][_0x5c8d1d]['destroy']();}),this['context']=_0x2a0bf8,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x3df7e4(0x1e4)],this['options'],this[_0x3df7e4(0x1cf)]),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x3df7e4(0x1cf)],this['particlesComputing']);}['clearFramebuffers'](){const _0x16addf=_0x1cfd68,_0xb98465=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering'][_0x16addf(0x268)])[_0x16addf(0x1dc)](_0x2a45d1=>{const _0x5100e1=_0x16addf;_0xb98465[_0x5100e1(0x244)]=this['particlesRendering']['framebuffers'][_0x2a45d1],_0xb98465[_0x5100e1(0x1c8)](this['context']);});}[_0x1cfd68(0x228)](_0x331775){const _0x435f6d=_0x1cfd68;this['clearFramebuffers'](),this[_0x435f6d(0x237)]['destroyParticlesTextures'](),this[_0x435f6d(0x237)][_0x435f6d(0x202)](this['context'],this['options'],this['viewerParameters']);if(_0x331775){const _0x2e2073=this['particlesRendering']['createSegmentsGeometry'](this[_0x435f6d(0x285)]);this['particlesRendering']['primitives'][_0x435f6d(0x1ef)]['geometry']=_0x2e2073;const _0x293cf1=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x2e2073,'attributeLocations':this[_0x435f6d(0x249)]['primitives']['segments'][_0x435f6d(0x23b)],'bufferUsage':Cesium$2[_0x435f6d(0x1ea)]['STATIC_DRAW']});this['particlesRendering']['primitives'][_0x435f6d(0x1ef)][_0x435f6d(0x1f0)]['vertexArray']=_0x293cf1;}}['setOptions'](_0x15d271){const _0x2b8a3a=_0x1cfd68;let _0x50ba50=![];this['options']['maxParticles']!==_0x15d271['maxParticles']&&(_0x50ba50=!![]),Object[_0x2b8a3a(0x24b)](_0x15d271)['forEach'](_0x5c6a71=>{this['options'][_0x5c6a71]=_0x15d271[_0x5c6a71];}),this[_0x2b8a3a(0x228)](_0x50ba50);}['applyViewerParameters'](_0x42c61d){Object['keys'](_0x42c61d)['forEach'](_0x4cbaba=>{const _0x5dfa7f=_0x3da3;this[_0x5dfa7f(0x1cf)][_0x4cbaba]=_0x42c61d[_0x4cbaba];}),this['refreshParticles'](![]);}['destroy'](){const _0x5c53d8=_0x1cfd68;clearTimeout(this[_0x5c53d8(0x280)]),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x5c53d8(0x267)])['forEach'](_0x12d69f=>{const _0x4a5694=_0x5c53d8;this['particlesComputing'][_0x4a5694(0x267)][_0x12d69f]['destroy']();}),this[_0x5c53d8(0x249)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x35748a=>{const _0x50075d=_0x5c53d8;this[_0x50075d(0x249)][_0x50075d(0x268)][_0x35748a]['destroy']();});for(const _0x584c23 in this){delete this[_0x584c23];}}}const Cesium$1=mars3d__namespace[_0x1cfd68(0x233)],BaseLayer$1=mars3d__namespace[_0x1cfd68(0x27a)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x10280c={}){_0x10280c={...DEF_OPTIONS,..._0x10280c},super(_0x10280c),this['_setOptionsHook'](_0x10280c);}get['layer'](){const _0x1aa379=_0x1cfd68;return this[_0x1aa379(0x1d2)];}get['data'](){return this['_data'];}set['data'](_0x292123){this['setData'](_0x292123);}get['colors'](){return this['options']['colors'];}set['colors'](_0x64b6ab){const _0x5baee3=_0x1cfd68;this['options'][_0x5baee3(0x1d1)]=_0x64b6ab,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x64b6ab}),this['resize']();}['_mountedHook'](){}[_0x1cfd68(0x215)](){const _0x5ef30a=_0x1cfd68;this[_0x5ef30a(0x2ab)]=this[_0x5ef30a(0x20f)][_0x5ef30a(0x2ab)],this['camera']=this['_map'][_0x5ef30a(0x211)],this[_0x5ef30a(0x1d2)]=new Cesium$1[(_0x5ef30a(0x1ee))](),this[_0x5ef30a(0x20f)][_0x5ef30a(0x2ab)]['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x5ef30a(0x1d0)]=new Cesium$1['BoundingSphere'](Cesium$1[_0x5ef30a(0x246)]['ZERO'],0.99*0x615299),this[_0x5ef30a(0x1d4)](),window['addEventListener']('resize',this[_0x5ef30a(0x20d)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x5ef30a(0x20f)]['on'](mars3d__namespace['EventType']['wheel'],this[_0x5ef30a(0x1cb)],this),this[_0x5ef30a(0x20f)]['on'](mars3d__namespace[_0x5ef30a(0x205)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x5ef30a(0x205)]['mouseUp'],this['_onMouseUpEvent'],this),this[_0x5ef30a(0x20f)]['on'](mars3d__namespace[_0x5ef30a(0x205)][_0x5ef30a(0x2a9)],this['_onMouseMoveEvent'],this),this[_0x5ef30a(0x277)]&&this[_0x5ef30a(0x1df)](this['_data']);}['_removedHook'](){const _0x1973ae=_0x1cfd68;window[_0x1973ae(0x284)]('resize',this['resize']),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this[_0x1973ae(0x282)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x1973ae(0x23f)],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x1973ae(0x20f)]['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x1973ae(0x1d3)],this),this[_0x1973ae(0x1d2)][_0x1973ae(0x2a6)](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x3e55fb=_0x1cfd68;if(!this['show']||!this[_0x3e55fb(0x2a3)])return;this['primitives']['show']=![],this[_0x3e55fb(0x1d2)]['removeAll'](),this[_0x3e55fb(0x20f)]['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x22cf67){const _0x179bf2=_0x1cfd68;this['particleSystem']['canvasResize'](this[_0x179bf2(0x2ab)]['context']),this['addPrimitives'](),this['primitives'][_0x179bf2(0x26f)]=!![];}['_onMapWhellEvent'](_0x3e8180){const _0x1c547e=_0x1cfd68;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x1c547e(0x210)]=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x142821){this['mouse_down']=!![];}[_0x1cfd68(0x1d3)](_0x480494){const _0x16c46f=_0x1cfd68;if(!this['show']||!this[_0x16c46f(0x2a3)])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x16c46f(0x242)]=!![]);}['_onMouseUpEvent'](_0x244cd6){const _0xa52282=_0x1cfd68;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives'][_0xa52282(0x26f)]=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x17fed5=_0x1cfd68;if(!this['_map']||!this[_0x17fed5(0x26f)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x17fed5(0x1d2)][_0x17fed5(0x26f)]=!![];}[_0x1cfd68(0x1df)](_0x395743){const _0x12f4e3=_0x1cfd68;this['_data']=_0x395743,this[_0x12f4e3(0x2a3)]&&this[_0x12f4e3(0x2a3)][_0x12f4e3(0x262)](),this[_0x12f4e3(0x2a3)]=new ParticleSystem(this['scene']['context'],_0x395743,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x2f9af4,_0x10362d){const _0x1f0a8e=_0x1cfd68;if(_0x2f9af4)for(const _0x88f948 in _0x2f9af4){this[_0x88f948]=_0x2f9af4[_0x88f948];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x1f0a8e(0x1e9)]());}[_0x1cfd68(0x1e9)](){const _0x45866b=_0x1cfd68,_0x32ea51=Math[_0x45866b(0x22c)](Math['sqrt'](this[_0x45866b(0x20e)]));return this[_0x45866b(0x20e)]=_0x32ea51*_0x32ea51,{'particlesTextureSize':_0x32ea51,'maxParticles':this[_0x45866b(0x20e)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x45866b(0x1d1)]};}['addPrimitives'](){const _0x449c00=_0x1cfd68;this['primitives'][_0x449c00(0x1e3)](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this[_0x449c00(0x1d2)][_0x449c00(0x1e3)](this[_0x449c00(0x2a3)]['particlesComputing'][_0x449c00(0x1d2)][_0x449c00(0x226)]),this[_0x449c00(0x1d2)]['add'](this[_0x449c00(0x2a3)]['particlesComputing']['primitives']['postProcessingPosition']),this['primitives'][_0x449c00(0x1e3)](this[_0x449c00(0x2a3)][_0x449c00(0x237)]['primitives']['postProcessingSpeed']),this['primitives']['add'](this[_0x449c00(0x2a3)][_0x449c00(0x249)]['primitives']['segments']),this['primitives'][_0x449c00(0x1e3)](this['particleSystem']['particlesRendering']['primitives']['trails']),this[_0x449c00(0x1d2)][_0x449c00(0x1e3)](this['particleSystem'][_0x449c00(0x249)]['primitives']['screen']);}['updateViewerParameters'](){const _0x29aa97=_0x1cfd68;let _0x3b8e5=this['camera']['computeViewRectangle'](this[_0x29aa97(0x2ab)][_0x29aa97(0x287)][_0x29aa97(0x1cd)]);if(!_0x3b8e5){const _0x347a48=this[_0x29aa97(0x20f)][_0x29aa97(0x21f)]();_0x3b8e5=Cesium$1[_0x29aa97(0x20a)]['fromDegrees'](_0x347a48['xmin'],_0x347a48[_0x29aa97(0x241)],_0x347a48[_0x29aa97(0x230)],_0x347a48[_0x29aa97(0x1e1)]);}const _0x525c8f=Util['viewRectangleToLonLatRange'](_0x3b8e5);this['viewerParameters']['lonRange']['x']=_0x525c8f['lon']['min'],this[_0x29aa97(0x1cf)]['lonRange']['y']=_0x525c8f['lon'][_0x29aa97(0x275)],this['viewerParameters']['latRange']['x']=_0x525c8f['lat']['min'],this[_0x29aa97(0x1cf)]['latRange']['y']=_0x525c8f['lat']['max'];const _0x1e24af=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene'][_0x29aa97(0x2b8)]);_0x1e24af>0x0&&(this[_0x29aa97(0x1cf)]['pixelSize']=_0x1e24af);}}mars3d__namespace['LayerUtil'][_0x1cfd68(0x256)]('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x5b88bb=_0x1cfd68;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x5b88bb(0x243)]=null;}['destroy'](){for(const _0x288cad in this){delete this[_0x288cad];}}}class CanvasWindField{constructor(_0x58e5fa){this['setOptions'](_0x58e5fa);}get['speedRate'](){return this['_speedRate'];}set[_0x1cfd68(0x258)](_0x1422c2){const _0x3c46de=_0x1cfd68;this[_0x3c46de(0x200)]=(0x64-(_0x1422c2>0x63?0x63:_0x1422c2))*0x64,this['_calc_speedRate']=[(this[_0x3c46de(0x230)]-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x3c46de(0x241)])/this['_speedRate']];}get['maxAge'](){const _0x21d4fb=_0x1cfd68;return this[_0x21d4fb(0x276)];}set['maxAge'](_0x3304a8){const _0x3264b9=_0x1cfd68;this[_0x3264b9(0x276)]=_0x3304a8;}['setOptions'](_0x1569e5){const _0x2385ca=_0x1cfd68;this['options']=_0x1569e5,this['maxAge']=_0x1569e5['maxAge']||0x78,this[_0x2385ca(0x258)]=_0x1569e5['speedRate']||0x32,this['particles']=[];const _0x3fea80=_0x1569e5['particlesNumber']||0x1000;for(let _0x17b10e=0x0;_0x17b10e<_0x3fea80;_0x17b10e++){const _0x5d3aa7=this['_randomParticle'](new CanvasParticle());this['particles'][_0x2385ca(0x29a)](_0x5d3aa7);}}['setDate'](_0x4ef9ff){const _0x14a59b=_0x1cfd68;this[_0x14a59b(0x2aa)]=_0x4ef9ff['rows'],this[_0x14a59b(0x24a)]=_0x4ef9ff[_0x14a59b(0x24a)],this[_0x14a59b(0x2a5)]=_0x4ef9ff['xmin'],this[_0x14a59b(0x230)]=_0x4ef9ff['xmax'],this['ymin']=_0x4ef9ff['ymin'],this[_0x14a59b(0x1e1)]=_0x4ef9ff['ymax'],this[_0x14a59b(0x28a)]=[];const _0x5b6f48=_0x4ef9ff['udata'],_0x58a136=_0x4ef9ff[_0x14a59b(0x229)];let _0x6ec77a=![];_0x5b6f48[_0x14a59b(0x29f)]===this['rows']&&_0x5b6f48[0x0]['length']===this['cols']&&(_0x6ec77a=!![]);let _0x96c225=0x0,_0xa4e51d=null,_0x328502=null;for(let _0x505dd6=0x0;_0x505dd6<this[_0x14a59b(0x2aa)];_0x505dd6++){_0xa4e51d=[];for(let _0x15f34a=0x0;_0x15f34a<this['cols'];_0x15f34a++,_0x96c225++){_0x6ec77a?_0x328502=this['_calcUV'](_0x5b6f48[_0x505dd6][_0x15f34a],_0x58a136[_0x505dd6][_0x15f34a]):_0x328502=this['_calcUV'](_0x5b6f48[_0x96c225],_0x58a136[_0x96c225]),_0xa4e51d[_0x14a59b(0x29a)](_0x328502);}this['grid']['push'](_0xa4e51d);}this['options']['reverseY']&&this['grid']['reverse']();}[_0x1cfd68(0x22d)](){const _0x32380e=_0x1cfd68;delete this['rows'],delete this['cols'],delete this[_0x32380e(0x2a5)],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0x32380e(0x297)];}['toGridXY'](_0x12d135,_0x15c8bb){const _0x4ad27e=_0x1cfd68,_0x17be6d=(_0x12d135-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x429c25=(this[_0x4ad27e(0x1e1)]-_0x15c8bb)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x17be6d,_0x429c25];}['getUVByXY'](_0x153be8,_0x3a4ff2){const _0x3eb208=_0x1cfd68;if(_0x153be8<0x0||_0x153be8>=this[_0x3eb208(0x24a)]||_0x3a4ff2>=this['rows'])return[0x0,0x0,0x0];const _0x304fc7=Math['floor'](_0x153be8),_0x523fc4=Math[_0x3eb208(0x288)](_0x3a4ff2);if(_0x304fc7===_0x153be8&&_0x523fc4===_0x3a4ff2)return this['grid'][_0x3a4ff2][_0x153be8];const _0x478407=_0x304fc7+0x1,_0x25b688=_0x523fc4+0x1,_0x215c0e=this['getUVByXY'](_0x304fc7,_0x523fc4),_0x1d85b5=this[_0x3eb208(0x232)](_0x478407,_0x523fc4),_0x15e495=this['getUVByXY'](_0x304fc7,_0x25b688),_0x2d12f7=this[_0x3eb208(0x232)](_0x478407,_0x25b688);let _0x144758=null;try{_0x144758=this['_bilinearInterpolation'](_0x153be8-_0x304fc7,_0x3a4ff2-_0x523fc4,_0x215c0e,_0x1d85b5,_0x15e495,_0x2d12f7);}catch(_0x5100fd){console[_0x3eb208(0x218)](_0x153be8,_0x3a4ff2);}return _0x144758;}['_bilinearInterpolation'](_0x1bf4ff,_0x5ec473,_0x3e69d9,_0x41cd80,_0x3d1aab,_0x25d92a){const _0x5e9815=0x1-_0x1bf4ff,_0x18a7ec=0x1-_0x5ec473,_0x2ed75e=_0x5e9815*_0x18a7ec,_0xf87211=_0x1bf4ff*_0x18a7ec,_0x38cc76=_0x5e9815*_0x5ec473,_0x532ef4=_0x1bf4ff*_0x5ec473,_0xf59e23=_0x3e69d9[0x0]*_0x2ed75e+_0x41cd80[0x0]*_0xf87211+_0x3d1aab[0x0]*_0x38cc76+_0x25d92a[0x0]*_0x532ef4,_0x2d2781=_0x3e69d9[0x1]*_0x2ed75e+_0x41cd80[0x1]*_0xf87211+_0x3d1aab[0x1]*_0x38cc76+_0x25d92a[0x1]*_0x532ef4;return this['_calcUV'](_0xf59e23,_0x2d2781);}[_0x1cfd68(0x225)](_0x438c0f,_0x4cf77e){return[+_0x438c0f,+_0x4cf77e,Math['sqrt'](_0x438c0f*_0x438c0f+_0x4cf77e*_0x4cf77e)];}[_0x1cfd68(0x28c)](_0x12f019,_0x44d5bd){const _0x47c8cc=_0x1cfd68;if(!this['isInExtent'](_0x12f019,_0x44d5bd))return null;const _0x29ae96=this[_0x47c8cc(0x2af)](_0x12f019,_0x44d5bd),_0x4a5e03=this['getUVByXY'](_0x29ae96[0x0],_0x29ae96[0x1]);return _0x4a5e03;}[_0x1cfd68(0x2b5)](_0x243e70,_0x17b3a8){const _0x3a4b01=_0x1cfd68;return _0x243e70>=this['xmin']&&_0x243e70<=this['xmax']&&_0x17b3a8>=this['ymin']&&_0x17b3a8<=this[_0x3a4b01(0x1e1)]?!![]:![];}['getRandomLatLng'](){const _0x30dd04=_0x1cfd68,_0x1d639e=fRandomByfloat(this[_0x30dd04(0x2a5)],this[_0x30dd04(0x230)]),_0x53373e=fRandomByfloat(this['ymin'],this[_0x30dd04(0x1e1)]);return{'lat':_0x53373e,'lng':_0x1d639e};}[_0x1cfd68(0x24c)](){const _0x27c132=_0x1cfd68;let _0x151aa3,_0x19a86b,_0x182b83;for(let _0x5cbc5f=0x0,_0x3b16c6=this['particles']['length'];_0x5cbc5f<_0x3b16c6;_0x5cbc5f++){let _0x532957=this[_0x27c132(0x297)][_0x5cbc5f];_0x532957[_0x27c132(0x243)]<=0x0&&(_0x532957=this['_randomParticle'](_0x532957));if(_0x532957[_0x27c132(0x243)]>0x0){const _0x3944f5=_0x532957['tlng'],_0x34afe7=_0x532957[_0x27c132(0x252)];_0x182b83=this['getUVByPoint'](_0x3944f5,_0x34afe7),_0x182b83?(_0x151aa3=_0x3944f5+this[_0x27c132(0x204)][0x0]*_0x182b83[0x0],_0x19a86b=_0x34afe7+this['_calc_speedRate'][0x1]*_0x182b83[0x1],_0x532957['lng']=_0x3944f5,_0x532957['lat']=_0x34afe7,_0x532957['tlng']=_0x151aa3,_0x532957[_0x27c132(0x252)]=_0x19a86b,_0x532957['age']--):_0x532957['age']=0x0;}}return this[_0x27c132(0x297)];}['_randomParticle'](_0x3bcb9e){const _0x627ec7=_0x1cfd68;let _0x2a80ba,_0xb129b0;for(let _0x55ef9e=0x0;_0x55ef9e<0x1e;_0x55ef9e++){_0x2a80ba=this['getRandomLatLng'](),_0xb129b0=this[_0x627ec7(0x28c)](_0x2a80ba[_0x627ec7(0x278)],_0x2a80ba['lat']);if(_0xb129b0&&_0xb129b0[0x2]>0x0)break;}if(!_0xb129b0)return _0x3bcb9e;const _0x982af=_0x2a80ba['lng']+this['_calc_speedRate'][0x0]*_0xb129b0[0x0],_0x483541=_0x2a80ba['lat']+this[_0x627ec7(0x204)][0x1]*_0xb129b0[0x1];return _0x3bcb9e['lng']=_0x2a80ba['lng'],_0x3bcb9e['lat']=_0x2a80ba['lat'],_0x3bcb9e[_0x627ec7(0x299)]=_0x982af,_0x3bcb9e['tlat']=_0x483541,_0x3bcb9e['age']=Math[_0x627ec7(0x206)](Math[_0x627ec7(0x1f8)]()*this[_0x627ec7(0x271)]),_0x3bcb9e;}[_0x1cfd68(0x262)](){for(const _0x849360 in this){delete this[_0x849360];}}}function fRandomByfloat(_0x487b8b,_0x45d812){return _0x487b8b+Math['random']()*(_0x45d812-_0x487b8b);}const Cesium=mars3d__namespace[_0x1cfd68(0x233)],BaseLayer=mars3d__namespace['layer'][_0x1cfd68(0x1f9)];class CanvasWindLayer extends BaseLayer{constructor(_0x2c6900={}){const _0x228612=_0x1cfd68;super(_0x2c6900),this['_setOptionsHook'](_0x2c6900),this[_0x228612(0x255)]=null;}['_setOptionsHook'](_0x509af6,_0x2ee9b6){const _0xa4405f=_0x1cfd68;this[_0xa4405f(0x2bc)]=0x3e8/(_0x509af6[_0xa4405f(0x1c7)]||0xa),this[_0xa4405f(0x1e6)]=this[_0xa4405f(0x285)]['pointerEvents']??![],this['color']=_0x509af6['color']||_0xa4405f(0x2bd),this['lineWidth']=_0x509af6['lineWidth']||0x1,this[_0xa4405f(0x290)]=_0x509af6['fixedHeight']??0x0,this['reverseY']=_0x509af6[_0xa4405f(0x1ca)]??![],this[_0xa4405f(0x295)]&&this[_0xa4405f(0x295)]['setOptions'](_0x509af6);}get['layer'](){return this['canvas'];}get['canvasWidth'](){return this['_map']['scene']['canvas']['clientWidth'];}get['canvasHeight'](){const _0x2f3487=_0x1cfd68;return this[_0x2f3487(0x20f)]['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0xc7562f){const _0x4a5f56=_0x1cfd68;this['_pointerEvents']=_0xc7562f;if(!this[_0x4a5f56(0x255)])return;_0xc7562f?this['canvas']['style']['pointer-events']=_0x4a5f56(0x292):this['canvas'][_0x4a5f56(0x259)]['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x564cf7){this['options']['particlesNumber']=_0x564cf7,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x4f9ddb){this['options']['speedRate']=_0x4f9ddb,this['windField']&&(this['windField']['speedRate']=_0x4f9ddb);}get[_0x1cfd68(0x271)](){const _0x42a2f9=_0x1cfd68;return this[_0x42a2f9(0x285)]['maxAge'];}set['maxAge'](_0x5ad36e){const _0x49fda4=_0x1cfd68;this['options']['maxAge']=_0x5ad36e,this[_0x49fda4(0x295)]&&(this['windField']['maxAge']=_0x5ad36e);}get['data'](){return this['windData'];}set['data'](_0x27bf2f){this['setData'](_0x27bf2f);}['_showHook'](_0x1fd1fc){const _0x392242=_0x1cfd68;_0x1fd1fc?this['_addedHook']():(this[_0x392242(0x24d)]&&(this['options'][_0x392242(0x1e4)]=this['windData']),this['_removedHook']());}[_0x1cfd68(0x2b0)](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x1cfd68(0x215)](){const _0x47d9a6=_0x1cfd68;this['canvas']=this['_createCanvas'](),this[_0x47d9a6(0x21d)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x47d9a6(0x1df)](this['options']['data']);}['_removedHook'](){const _0x2c856a=_0x1cfd68;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this[_0x2c856a(0x255)]),delete this['canvas']);}['_createCanvas'](){const _0x956f4b=_0x1cfd68,_0x5e0ccc=mars3d__namespace[_0x956f4b(0x223)]['create'](_0x956f4b(0x255),'mars3d-canvasWind',this['_map']['container']);return _0x5e0ccc['style'][_0x956f4b(0x219)]='absolute',_0x5e0ccc[_0x956f4b(0x259)][_0x956f4b(0x25c)]='0px',_0x5e0ccc['style']['left']=_0x956f4b(0x212),_0x5e0ccc['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x5e0ccc['style'][_0x956f4b(0x216)]=this['_map'][_0x956f4b(0x2ab)]['canvas']['clientHeight']+'px',_0x5e0ccc[_0x956f4b(0x259)]['pointerEvents']=this[_0x956f4b(0x1e6)]?'auto':_0x956f4b(0x25f),_0x5e0ccc['style']['zIndex']=this['options']['zIndex']??0x9,_0x5e0ccc['width']=this['_map'][_0x956f4b(0x2ab)]['canvas']['clientWidth'],_0x5e0ccc['height']=this['_map'][_0x956f4b(0x2ab)]['canvas'][_0x956f4b(0x2b1)],_0x5e0ccc;}[_0x1cfd68(0x20d)](){const _0x3bc310=_0x1cfd68;this[_0x3bc310(0x255)]&&(this['canvas']['style']['width']=this['_map'][_0x3bc310(0x2ab)][_0x3bc310(0x255)][_0x3bc310(0x1e2)]+'px',this['canvas'][_0x3bc310(0x259)]['height']=this[_0x3bc310(0x20f)]['scene']['canvas'][_0x3bc310(0x2b1)]+'px',this['canvas'][_0x3bc310(0x1dd)]=this['_map'][_0x3bc310(0x2ab)][_0x3bc310(0x255)]['clientWidth'],this['canvas'][_0x3bc310(0x216)]=this[_0x3bc310(0x20f)]['scene'][_0x3bc310(0x255)]['clientHeight']);}['bindEvent'](){const _0x669afe=_0x1cfd68,_0x254091=this;let _0x4527a3=Date['now']();(function _0x8119e1(){const _0x2c29be=_0x3da3;_0x254091['animateFrame']=window['requestAnimationFrame'](_0x8119e1);if(_0x254091['show']&&_0x254091['windField']){const _0x220027=Date['now'](),_0x58e460=_0x220027-_0x4527a3;_0x58e460>_0x254091['frameTime']&&(_0x4527a3=_0x220027-_0x58e460%_0x254091['frameTime'],_0x254091[_0x2c29be(0x21b)]());}}(),window[_0x669afe(0x296)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x669afe(0x285)]['mouseHidden']&&(this[_0x669afe(0x20f)]['on'](mars3d__namespace[_0x669afe(0x205)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x53b27d=_0x1cfd68;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x53b27d(0x1f4)],window['removeEventListener'](_0x53b27d(0x20d),this['resize']),this[_0x53b27d(0x285)][_0x53b27d(0x1c9)]&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x53b27d(0x20f)]['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x53b27d(0x248)],this),this[_0x53b27d(0x20f)]['off'](mars3d__namespace['EventType'][_0x53b27d(0x203)],this['_onMouseUpEvent'],this),this[_0x53b27d(0x20f)][_0x53b27d(0x20c)](mars3d__namespace['EventType'][_0x53b27d(0x2a9)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x14b507){const _0x4bb1f8=_0x1cfd68;clearTimeout(this[_0x4bb1f8(0x210)]);if(!this[_0x4bb1f8(0x26f)]||!this['canvas'])return;this['canvas']['style'][_0x4bb1f8(0x272)]='hidden',this['refreshTimer']=setTimeout(()=>{const _0x19557b=_0x4bb1f8;if(!this['show'])return;this['redraw'](),this['canvas'][_0x19557b(0x259)][_0x19557b(0x272)]='visible';},0xc8);}[_0x1cfd68(0x248)](_0x27f00b){const _0x24912b=_0x1cfd68;this[_0x24912b(0x291)]=!![],this['_map']['off'](mars3d__namespace[_0x24912b(0x205)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x24912b(0x20f)]['on'](mars3d__namespace['EventType'][_0x24912b(0x2a9)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x1718e1){const _0x2b999b=_0x1cfd68;if(!this[_0x2b999b(0x26f)]||!this[_0x2b999b(0x255)])return;this['mouse_down']&&(this[_0x2b999b(0x255)]['style']['visibility']='hidden',this[_0x2b999b(0x242)]=!![]);}[_0x1cfd68(0x21e)](_0x34fef7){const _0x2df0c9=_0x1cfd68;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x2df0c9(0x1d3)],this),this['mouse_down']&&this[_0x2df0c9(0x242)]&&this['redraw'](),this['canvas']['style']['visibility']='visible',this[_0x2df0c9(0x291)]=![],this[_0x2df0c9(0x242)]=![];}['setData'](_0x495710){const _0x2feb79=_0x1cfd68;this[_0x2feb79(0x22d)](),this['windData']=_0x495710,this[_0x2feb79(0x295)]['setDate'](_0x495710),this['redraw']();}['redraw'](){const _0x2d68e3=_0x1cfd68;if(!this['show'])return;this[_0x2d68e3(0x295)][_0x2d68e3(0x239)](this['options']),this['update']();}['update'](){const _0xfebca8=_0x1cfd68;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0x12173f=this['windField']['getParticles']();this[_0xfebca8(0x247)](_0x12173f);}this['_updateIng']=![];}['_drawLines'](_0x8fd8bd){const _0x38c0df=_0x1cfd68;this['canvasContext']['globalCompositeOperation']=_0x38c0df(0x298),this[_0x38c0df(0x21d)]['fillRect'](0x0,0x0,this[_0x38c0df(0x235)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext'][_0x38c0df(0x27c)]=0.9,this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['color'];const _0x1047cd=this['_map'][_0x38c0df(0x2ab)]['mode']!==Cesium['SceneMode']['SCENE3D'],_0x3475ca=this[_0x38c0df(0x235)]*0.25;for(let _0x5c477d=0x0,_0x1a92f0=_0x8fd8bd['length'];_0x5c477d<_0x1a92f0;_0x5c477d++){const _0x4bbed7=_0x8fd8bd[_0x5c477d],_0x4d802f=this['_tomap'](_0x4bbed7['lng'],_0x4bbed7['lat'],_0x4bbed7),_0x305c45=this[_0x38c0df(0x279)](_0x4bbed7[_0x38c0df(0x299)],_0x4bbed7['tlat'],_0x4bbed7);if(!_0x4d802f||!_0x305c45)continue;if(_0x1047cd&&Math['abs'](_0x4d802f[0x0]-_0x305c45[0x0])>=_0x3475ca)continue;this[_0x38c0df(0x21d)][_0x38c0df(0x2b2)](_0x4d802f[0x0],_0x4d802f[0x1]),this[_0x38c0df(0x21d)]['lineTo'](_0x305c45[0x0],_0x305c45[0x1]);}this[_0x38c0df(0x21d)]['stroke']();}[_0x1cfd68(0x279)](_0x13c2bf,_0x3877f9,_0x28cd3d){const _0x492181=_0x1cfd68,_0x526717=Cesium['Cartesian3'][_0x492181(0x250)](_0x13c2bf,_0x3877f9,this['fixedHeight']),_0x5804af=this[_0x492181(0x20f)][_0x492181(0x2ab)];if(_0x5804af[_0x492181(0x26e)]===Cesium[_0x492181(0x2b3)][_0x492181(0x2b4)]){const _0x327302=new Cesium['EllipsoidalOccluder'](_0x5804af['globe']['ellipsoid'],_0x5804af['camera']['positionWC']),_0x3b9581=_0x327302[_0x492181(0x253)](_0x526717);if(!_0x3b9581)return _0x28cd3d[_0x492181(0x243)]=0x0,null;}const _0x14c458=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this[_0x492181(0x20f)]['scene'],_0x526717);return _0x14c458?[_0x14c458['x'],_0x14c458['y']]:null;}['clear'](){const _0x21cc9b=_0x1cfd68;this[_0x21cc9b(0x295)]['clear'](),delete this['windData'];}[_0x1cfd68(0x27b)](){const _0x431c15=_0x1cfd68;this['worker']=new Worker(this['options'][_0x431c15(0x251)]),this['worker']['onmessage']=_0x211e9b=>{const _0x110335=_0x431c15;this[_0x110335(0x247)](_0x211e9b['data']['particles']),this['_updateIng2']=![];},this[_0x431c15(0x295)]={'init':_0x1f748c=>{const _0x2d1772=_0x431c15;this[_0x2d1772(0x251)]['postMessage']({'type':'init','options':_0x1f748c});},'setOptions':_0x1d767a=>{this['worker']['postMessage']({'type':'setOptions','options':_0x1d767a});},'setDate':_0x539517=>{this['worker']['postMessage']({'type':'setDate','data':_0x539517});},'update':()=>{const _0x205ea4=_0x431c15;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker'][_0x205ea4(0x217)]({'type':'update'});},'clear':()=>{const _0x494477=_0x431c15;this[_0x494477(0x251)][_0x494477(0x217)]({'type':'clear'});}},this['windField'][_0x431c15(0x269)](this['options']);}}function _0x4ab3(){const _0x519098=['mouseMove','rows','scene','OPAQUE','toDegrees','8nPMxve','toGridXY','_mountedHook','clientHeight','moveTo','SceneMode','SCENE3D','isInExtent','pow','Geometry','drawingBufferHeight','createFramebuffer','udata','lat','frameTime','#ffffff','createWindTextures','rawRenderState','frameRate','execute','mouseHidden','reverseY','_onMapWhellEvent','PI_OVER_TWO','ellipsoid','depthTexture','viewerParameters','globeBoundingSphere','colors','primitives','_onMouseMoveEvent','updateViewerParameters','IDENTITY','WindUtil','TWO_PI','nextTrailsDepth','vertexArray','TextureMinificationFilter','RGBA','forEach','width','getOwnPropertyDescriptor','setData','cos','ymax','clientWidth','add','data','particlesTextures','_pointerEvents','PrimitiveType','trails','getOptions','BufferUsage','context','6lHWNZL','currentTrails','PrimitiveCollection','segments','commandToExecute','214442IycGym','createRenderingFramebuffers','colorTable','animateFrame','postProcessingPosition','PixelFormat','outputTexture','random','BaseLayer','GeometryAttribute','3gyDNNK','__esModule','createCommand','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','1767370oYyTbx','_speedRate','segmentsColor','createParticlesTextures','mouseUp','_calc_speedRate','EventType','round','clearCommand','vmin','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','Rectangle','ComponentDatatype','off','resize','particlesNumber','_map','refreshTimer','camera','0px','nextTrails','latRange','_addedHook','height','postMessage','log','position','Math','update','createRawRenderState','canvasContext','_onMouseUpEvent','getExtent','commandList','nextParticlesSpeed','createRenderingTextures','DomUtil','FLOAT','_calcUV','updatePosition','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','refreshParticles','vdata','VertexArray','DEPTH_COMPONENT','ceil','clear','currentParticlesPosition','south','xmax','randomizeParticles','getUVByXY','Cesium','lon','canvasWidth','getWind','particlesComputing','Compute','setOptions','textures','attributeLocations','currentTrailsDepth','800254cGognA','dropRate','wheel','levmin','ymin','mouse_move','age','framebuffer','NEAREST','Cartesian3','_drawLines','_onMouseDownEvent','particlesRendering','cols','keys','getParticles','windData','destroyParticlesTextures','Color','fromDegrees','worker','tlat','isPointVisible','createComputingPrimitives','canvas','register','TextureMagnificationFilter','speedRate','style','preExecute','898344iqcBEW','top','postProcessingSpeed','defined','none','createSegmentsGeometry','Draw','destroy','min','2UFvPHY','default','Sampler','windTextures','framebuffers','init','Cartesian2','lev','ShaderProgram','fromGeometry','mode','show','drawingBufferWidth','maxAge','visibility','Texture','geometry','max','_maxAge','_data','lng','_tomap','layer','initWorker','globalAlpha','particlesWind','395037VfhXdd','ShaderSource','canrefresh','RGB','_onMap_preRenderEvent','384ncOVjr','removeEventListener','options','createTexture','globe','floor','vertexShaderSource','grid','updateSpeed','getUVByPoint','uniformMap','currentParticlesSpeed','LayerUtil','fixedHeight','mouse_down','all','nextParticlesPosition','lineWidth','windField','addEventListener','particles','destination-in','tlng','push','fromCache','58102UdjMCv','fragmentShaderSource','blending','length','172185DAMSfY','Framebuffer','primitiveType','particleSystem','getDefaultRenderState','xmin','removeAll','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','dimensions'];_0x4ab3=function(){return _0x519098;};return _0x4ab3();}mars3d__namespace[_0x1cfd68(0x28f)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x1cfd68(0x27a)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x1cfd68(0x1d6)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
