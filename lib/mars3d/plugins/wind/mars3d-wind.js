/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.8
 * 编译日期：2024-03-25 20:25:02
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x39bbfa=_0xbdb2;(function(_0x57980a,_0x1019d2){const _0x1a324e=_0xbdb2,_0x3df07e=_0x57980a();while(!![]){try{const _0x5f298f=-parseInt(_0x1a324e(0x22a))/0x1*(parseInt(_0x1a324e(0x244))/0x2)+parseInt(_0x1a324e(0x223))/0x3*(-parseInt(_0x1a324e(0x21b))/0x4)+parseInt(_0x1a324e(0x203))/0x5*(parseInt(_0x1a324e(0x1c3))/0x6)+parseInt(_0x1a324e(0x247))/0x7*(parseInt(_0x1a324e(0x251))/0x8)+-parseInt(_0x1a324e(0x2a6))/0x9+-parseInt(_0x1a324e(0x1eb))/0xa+parseInt(_0x1a324e(0x27f))/0xb*(parseInt(_0x1a324e(0x25d))/0xc);if(_0x5f298f===_0x1019d2)break;else _0x3df07e['push'](_0x3df07e['shift']());}catch(_0x93c48b){_0x3df07e['push'](_0x3df07e['shift']());}}}(_0x49d4,0x6852c));function _interopNamespace(_0x2376f6){const _0x547c22=_0xbdb2;if(_0x2376f6&&_0x2376f6[_0x547c22(0x270)])return _0x2376f6;var _0x42a5fb=Object[_0x547c22(0x217)](null);return _0x2376f6&&Object['keys'](_0x2376f6)[_0x547c22(0x28e)](function(_0x5d147d){const _0x13f762=_0x547c22;if(_0x5d147d!==_0x13f762(0x24e)){var _0x21708c=Object['getOwnPropertyDescriptor'](_0x2376f6,_0x5d147d);Object[_0x13f762(0x2af)](_0x42a5fb,_0x5d147d,_0x21708c['get']?_0x21708c:{'enumerable':!![],'get':function(){return _0x2376f6[_0x5d147d];}});}}),_0x42a5fb[_0x547c22(0x24e)]=_0x2376f6,_0x42a5fb;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x137bce,_0x289289){const _0x699338=_0x137bce*Math['cos'](Cesium$7['Math']['toRadians'](_0x289289));return _0x699338;}function getV(_0x2db3dd,_0x15a4f9){const _0x1bf8a0=_0x2db3dd*Math['sin'](Cesium$7['Math']['toRadians'](_0x15a4f9));return _0x1bf8a0;}function getSpeed(_0x2476be,_0x1df749){const _0x2799f5=Math['sqrt'](Math['pow'](_0x2476be,0x2)+Math['pow'](_0x1df749,0x2));return _0x2799f5;}function getDirection(_0x598a2b,_0x4c56d8){const _0x2cdbba=_0xbdb2;let _0x6fa39c=Cesium$7[_0x2cdbba(0x2ac)]['toDegrees'](Math[_0x2cdbba(0x1f8)](_0x4c56d8,_0x598a2b));return _0x6fa39c+=_0x6fa39c<0x0?0x168:0x0,_0x6fa39c;}function _0xbdb2(_0x541772,_0x3448a5){const _0x49d478=_0x49d4();return _0xbdb2=function(_0xbdb27b,_0x3c7830){_0xbdb27b=_0xbdb27b-0x1c3;let _0x31f024=_0x49d478[_0xbdb27b];return _0x31f024;},_0xbdb2(_0x541772,_0x3448a5);}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x32cbbd){const _0x40bb2c=_0xbdb2;this['commandType']=_0x32cbbd[_0x40bb2c(0x266)],this['geometry']=_0x32cbbd['geometry'],this['attributeLocations']=_0x32cbbd['attributeLocations'],this[_0x40bb2c(0x25c)]=_0x32cbbd['primitiveType'],this['uniformMap']=_0x32cbbd['uniformMap'],this['vertexShaderSource']=_0x32cbbd[_0x40bb2c(0x243)],this['fragmentShaderSource']=_0x32cbbd[_0x40bb2c(0x28c)],this['rawRenderState']=_0x32cbbd[_0x40bb2c(0x1d1)],this[_0x40bb2c(0x29d)]=_0x32cbbd[_0x40bb2c(0x29d)],this['outputTexture']=_0x32cbbd['outputTexture'],this[_0x40bb2c(0x260)]=_0x32cbbd[_0x40bb2c(0x260)]??![],this['preExecute']=_0x32cbbd[_0x40bb2c(0x1ca)],this[_0x40bb2c(0x1e7)]=!![],this[_0x40bb2c(0x224)]=undefined,this[_0x40bb2c(0x205)]=undefined,this['autoClear']&&(this[_0x40bb2c(0x205)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x180078){const _0x32b4c1=_0xbdb2;switch(this['commandType']){case _0x32b4c1(0x268):{const _0x386c5e=Cesium$6[_0x32b4c1(0x21d)][_0x32b4c1(0x1ea)]({'context':_0x180078,'geometry':this['geometry'],'attributeLocations':this[_0x32b4c1(0x28f)],'bufferUsage':Cesium$6[_0x32b4c1(0x262)][_0x32b4c1(0x219)]}),_0x4bfb14=Cesium$6['ShaderProgram']['fromCache']({'context':_0x180078,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x15f5f4=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x4bfb14,'vertexArray':_0x386c5e,'modelMatrix':Cesium$6[_0x32b4c1(0x296)]['IDENTITY'],'renderState':_0x15f5f4,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x32b4c1(0x25a):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0x39bbfa(0x231)](_0x492cb1,_0x3bca68){const _0x11297c=_0x39bbfa;this['geometry']=_0x3bca68;const _0x3e0601=Cesium$6[_0x11297c(0x21d)][_0x11297c(0x1ea)]({'context':_0x492cb1,'geometry':this['geometry'],'attributeLocations':this[_0x11297c(0x28f)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x11297c(0x224)]['vertexArray']=_0x3e0601;}['update'](_0x3c5692){const _0x5d1818=_0x39bbfa;if(!this['show'])return;if(_0x3c5692[_0x5d1818(0x26d)]!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x5d1818(0x224)]=this[_0x5d1818(0x289)](_0x3c5692['context'])),Cesium$6[_0x5d1818(0x237)](this['preExecute'])&&this['preExecute'](),Cesium$6[_0x5d1818(0x237)](this[_0x5d1818(0x205)])&&_0x3c5692[_0x5d1818(0x282)]['push'](this['clearCommand']),_0x3c5692['commandList']['push'](this['commandToExecute']);}[_0x39bbfa(0x21e)](){return![];}['destroy'](){const _0x2ef93f=_0x39bbfa;if(this['clearCommand']){var _0x4640c6,_0x3f8e56;(_0x4640c6=this[_0x2ef93f(0x205)])!==null&&_0x4640c6!==void 0x0&&_0x4640c6['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x3f8e56=this['clearCommand'])!==null&&_0x3f8e56!==void 0x0&&_0x3f8e56[_0x2ef93f(0x29f)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute'][_0x2ef93f(0x2a5)]&&this[_0x2ef93f(0x224)]['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6[_0x2ef93f(0x228)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x130acb=function(){const _0x4ce4d1=_0xbdb2,_0x8230bb=new Cesium$5[(_0x4ce4d1(0x2b6))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x8230bb;},_0x388098=function(_0x5dbb5c,_0x1a7934){const _0x37ce17=_0xbdb2;if(Cesium$5[_0x37ce17(0x237)](_0x1a7934)){const _0x45a48c={};_0x45a48c['arrayBufferView']=_0x1a7934,_0x5dbb5c[_0x37ce17(0x235)]=_0x45a48c;}const _0x4bc1fc=new Cesium$5['Texture'](_0x5dbb5c);return _0x4bc1fc;},_0x2d9965=function(_0x2e144c,_0x37c098,_0x577f14){const _0x5400fa=new Cesium$5['Framebuffer']({'context':_0x2e144c,'colorTextures':[_0x37c098],'depthTexture':_0x577f14});return _0x5400fa;},_0x548e39=function(_0x117d49){const _0x1d33e0=!![],_0x43d4e3=![],_0x30d855={'viewport':_0x117d49['viewport'],'depthTest':_0x117d49['depthTest'],'depthMask':_0x117d49['depthMask'],'blending':_0x117d49['blending']},_0x4f95fe=Cesium$5['Appearance']['getDefaultRenderState'](_0x1d33e0,_0x43d4e3,_0x30d855);return _0x4f95fe;},_0x3883a9=function(_0x5db100){const _0x148e03=_0xbdb2,_0x109f55={},_0x3729a7=Cesium$5['Math']['mod'](_0x5db100['west'],Cesium$5['Math']['TWO_PI']),_0x181dd6=Cesium$5['Math']['mod'](_0x5db100['east'],Cesium$5['Math']['TWO_PI']),_0xb0efd1=_0x5db100[_0x148e03(0x20e)];let _0x4427a2,_0x3123df;_0xb0efd1>Cesium$5[_0x148e03(0x2ac)]['THREE_PI_OVER_TWO']?(_0x4427a2=0x0,_0x3123df=Cesium$5[_0x148e03(0x2ac)][_0x148e03(0x209)]):_0x181dd6-_0x3729a7<_0xb0efd1?(_0x4427a2=_0x3729a7,_0x3123df=_0x3729a7+_0xb0efd1):(_0x4427a2=_0x3729a7,_0x3123df=_0x181dd6);_0x109f55[_0x148e03(0x1f9)]={'min':Cesium$5[_0x148e03(0x2ac)]['toDegrees'](_0x4427a2),'max':Cesium$5[_0x148e03(0x2ac)]['toDegrees'](_0x3123df)};const _0x2644c0=_0x5db100['south'],_0x1450bb=_0x5db100[_0x148e03(0x28a)],_0xc49579=_0x5db100['height'],_0x1e7027=_0xc49579>Cesium$5['Math']['PI']/0xc?_0xc49579/0x2:0x0;let _0x14ee7e=Cesium$5[_0x148e03(0x2ac)]['clampToLatitudeRange'](_0x2644c0-_0x1e7027),_0x187289=Cesium$5['Math'][_0x148e03(0x257)](_0x1450bb+_0x1e7027);return _0x14ee7e<-Cesium$5['Math'][_0x148e03(0x234)]&&(_0x14ee7e=-Cesium$5['Math']['PI_OVER_TWO']),_0x187289>Cesium$5['Math'][_0x148e03(0x234)]&&(_0x187289=Cesium$5[_0x148e03(0x2ac)][_0x148e03(0x22c)]),_0x109f55[_0x148e03(0x24f)]={'min':Cesium$5['Math']['toDegrees'](_0x14ee7e),'max':Cesium$5[_0x148e03(0x2ac)][_0x148e03(0x202)](_0x187289)},_0x109f55;};return{'getFullscreenQuad':_0x130acb,'createTexture':_0x388098,'createFramebuffer':_0x2d9965,'createRawRenderState':_0x548e39,'viewRectangleToLonLatRange':_0x3883a9};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x39bbfa(0x275),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x409718,_0x58af30,_0x4cbe70,_0x9d81b5,_0x120000){const _0x438811=_0x39bbfa;this['createRenderingTextures'](_0x409718,_0x58af30,_0x4cbe70['colors']),this['createRenderingFramebuffers'](_0x409718),this[_0x438811(0x212)](_0x409718,_0x4cbe70,_0x9d81b5,_0x120000);}['createRenderingTextures'](_0x3d3533,_0x338728,_0x21f1a1){const _0x3447a7=_0x39bbfa,_0x10b345={'context':_0x3d3533,'width':_0x3d3533['drawingBufferWidth'],'height':_0x3d3533['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x20c30f={'context':_0x3d3533,'width':_0x3d3533['drawingBufferWidth'],'height':_0x3d3533['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x3447a7(0x1d8)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x44b8dc=_0x21f1a1[_0x3447a7(0x27d)],_0x4b99c0=new Float32Array(_0x44b8dc*0x3);for(let _0x21ea9a=0x0;_0x21ea9a<_0x44b8dc;_0x21ea9a++){const _0x2abb39=Cesium$4['Color']['fromCssColorString'](_0x21f1a1[_0x21ea9a]);_0x4b99c0[0x3*_0x21ea9a]=_0x2abb39['red'],_0x4b99c0[0x3*_0x21ea9a+0x1]=_0x2abb39[_0x3447a7(0x236)],_0x4b99c0[0x3*_0x21ea9a+0x2]=_0x2abb39['blue'];}const _0x5bfab7={'context':_0x3d3533,'width':_0x44b8dc,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x3447a7(0x25f)][_0x3447a7(0x1e4)]})};this['textures']={'segmentsColor':Util[_0x3447a7(0x272)](_0x10b345),'segmentsDepth':Util[_0x3447a7(0x272)](_0x20c30f),'currentTrailsColor':Util['createTexture'](_0x10b345),'currentTrailsDepth':Util['createTexture'](_0x20c30f),'nextTrailsColor':Util['createTexture'](_0x10b345),'nextTrailsDepth':Util[_0x3447a7(0x272)](_0x20c30f),'colorTable':Util[_0x3447a7(0x272)](_0x5bfab7,_0x4b99c0)};}['createRenderingFramebuffers'](_0xeb20be){const _0x19de2a=_0x39bbfa;this[_0x19de2a(0x20a)]={'segments':Util['createFramebuffer'](_0xeb20be,this[_0x19de2a(0x2a4)]['segmentsColor'],this['textures'][_0x19de2a(0x1c9)]),'currentTrails':Util['createFramebuffer'](_0xeb20be,this[_0x19de2a(0x2a4)]['currentTrailsColor'],this[_0x19de2a(0x2a4)][_0x19de2a(0x293)]),'nextTrails':Util[_0x19de2a(0x246)](_0xeb20be,this['textures']['nextTrailsColor'],this['textures'][_0x19de2a(0x26e)])};}[_0x39bbfa(0x20f)](_0x340202){const _0x393480=_0x39bbfa,_0x303123=0x4;let _0x3f50ef=[];for(let _0x2ccb51=0x0;_0x2ccb51<_0x340202[_0x393480(0x291)];_0x2ccb51++){for(let _0x4b0e98=0x0;_0x4b0e98<_0x340202['particlesTextureSize'];_0x4b0e98++){for(let _0x4f9b08=0x0;_0x4f9b08<_0x303123;_0x4f9b08++){_0x3f50ef['push'](_0x2ccb51/_0x340202[_0x393480(0x291)]),_0x3f50ef['push'](_0x4b0e98/_0x340202['particlesTextureSize']);}}}_0x3f50ef=new Float32Array(_0x3f50ef);let _0x4dd177=[];const _0x3662b3=[-0x1,0x1],_0x25de7a=[-0x1,0x1];for(let _0x1ef1fc=0x0;_0x1ef1fc<_0x340202['maxParticles'];_0x1ef1fc++){for(let _0x1c6150=0x0;_0x1c6150<_0x303123/0x2;_0x1c6150++){for(let _0x1d5ca3=0x0;_0x1d5ca3<_0x303123/0x2;_0x1d5ca3++){_0x4dd177['push'](_0x3662b3[_0x1c6150]),_0x4dd177[_0x393480(0x215)](_0x25de7a[_0x1d5ca3]),_0x4dd177[_0x393480(0x215)](0x0);}}}_0x4dd177=new Float32Array(_0x4dd177);const _0x24a653=0x6*_0x340202[_0x393480(0x24a)],_0xa354b1=new Uint32Array(_0x24a653);for(let _0x3c3f3e=0x0,_0x1f3998=0x0,_0x3b593e=0x0;_0x3c3f3e<_0x340202[_0x393480(0x24a)];_0x3c3f3e++){_0xa354b1[_0x1f3998++]=_0x3b593e+0x0,_0xa354b1[_0x1f3998++]=_0x3b593e+0x1,_0xa354b1[_0x1f3998++]=_0x3b593e+0x2,_0xa354b1[_0x1f3998++]=_0x3b593e+0x2,_0xa354b1[_0x1f3998++]=_0x3b593e+0x1,_0xa354b1[_0x1f3998++]=_0x3b593e+0x3,_0x3b593e+=0x4;}const _0xe8a661=new Cesium$4[(_0x393480(0x2b6))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x393480(0x28b)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x3f50ef}),'normal':new Cesium$4[(_0x393480(0x252))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x4dd177})}),'indices':_0xa354b1});return _0xe8a661;}[_0x39bbfa(0x212)](_0x5eced7,_0x2c698e,_0x31684b,_0x983ff6){const _0x128988=_0x39bbfa,_0xe23041=this;this[_0x128988(0x1db)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x2c698e),'primitiveType':Cesium$4['PrimitiveType'][_0x128988(0x227)],'uniformMap':{'currentParticlesPosition':function(){return _0x983ff6['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x32ca3f=_0x128988;return _0x983ff6['particlesTextures'][_0x32ca3f(0x201)];},'postProcessingSpeed':function(){const _0x581843=_0x128988;return _0x983ff6['particlesTextures'][_0x581843(0x240)];},'colorTable':function(){return _0xe23041['textures']['colorTable'];},'aspect':function(){return _0x5eced7['drawingBufferWidth']/_0x5eced7['drawingBufferHeight'];},'pixelSize':function(){return _0x31684b['pixelSize'];},'lineWidth':function(){return _0x2c698e['lineWidth'];},'particleHeight':function(){const _0x232387=_0x128988;return _0x2c698e[_0x232387(0x278)];}},'vertexShaderSource':new Cesium$4[(_0x128988(0x1d5))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x128988(0x283)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x128988(0x268),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x128988(0x27a)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x18a233=_0x128988;return _0xe23041[_0x18a233(0x2a4)]['segmentsColor'];},'segmentsDepthTexture':function(){const _0x255c0e=_0x128988;return _0xe23041[_0x255c0e(0x2a4)][_0x255c0e(0x1c9)];},'currentTrailsColor':function(){const _0x3b7824=_0x128988;return _0xe23041['framebuffers'][_0x3b7824(0x1d2)][_0x3b7824(0x20c)](0x0);},'trailsDepthTexture':function(){return _0xe23041['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x2c698e['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x128988(0x1d5))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0x128988(0x1e6)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x1a52ad=_0x128988,_0xb979fd=_0xe23041['framebuffers']['currentTrails'];_0xe23041['framebuffers']['currentTrails']=_0xe23041['framebuffers']['nextTrails'],_0xe23041['framebuffers']['nextTrails']=_0xb979fd,_0xe23041[_0x1a52ad(0x1db)]['trails']['commandToExecute'][_0x1a52ad(0x29d)]=_0xe23041['framebuffers']['nextTrails'],_0xe23041['primitives'][_0x1a52ad(0x1c5)][_0x1a52ad(0x205)]['framebuffer']=_0xe23041['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x128988(0x268),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x128988(0x2a1)](),'primitiveType':Cesium$4[_0x128988(0x27a)][_0x128988(0x227)],'uniformMap':{'trailsColorTexture':function(){const _0x14659d=_0x128988;return _0xe23041['framebuffers']['nextTrails'][_0x14659d(0x20c)](0x0);},'trailsDepthTexture':function(){return _0xe23041['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x128988(0x1de)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x39bbfa(0x1fa),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x2e935d,_0x2297c5,_0x32ad8e,_0x204e09){const _0x26f529=_0x39bbfa;this[_0x26f529(0x222)]=_0x2297c5,this['createWindTextures'](_0x2e935d,_0x2297c5),this['createParticlesTextures'](_0x2e935d,_0x32ad8e,_0x204e09),this['createComputingPrimitives'](_0x2297c5,_0x32ad8e,_0x204e09);}[_0x39bbfa(0x1e0)](_0x3db4b2,_0x41584e){const _0x4e71e6=_0x39bbfa,_0x32f408={'context':_0x3db4b2,'width':_0x41584e['dimensions']['lon'],'height':_0x41584e['dimensions']['lat']*(_0x41584e[_0x4e71e6(0x249)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x4e71e6(0x295)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x4e71e6(0x23c))]({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x4e71e6(0x206)],'magnificationFilter':Cesium$3[_0x4e71e6(0x25f)]['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x32f408,_0x41584e['U']['array']),'V':Util['createTexture'](_0x32f408,_0x41584e['V'][_0x4e71e6(0x265)])};}[_0x39bbfa(0x1f7)](_0x52f7db,_0x58f3d1,_0x26af3a){const _0x5a22c7=_0x39bbfa,_0x56da06={'context':_0x52f7db,'width':_0x58f3d1[_0x5a22c7(0x291)],'height':_0x58f3d1['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x5a22c7(0x221)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x5a22c7(0x206)],'magnificationFilter':Cesium$3[_0x5a22c7(0x25f)]['NEAREST']})},_0xb33b5f=this['randomizeParticles'](_0x58f3d1[_0x5a22c7(0x24a)],_0x26af3a),_0x4b2a12=new Float32Array(0x4*_0x58f3d1[_0x5a22c7(0x24a)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util[_0x5a22c7(0x272)](_0x56da06),'currentParticlesPosition':Util['createTexture'](_0x56da06,_0xb33b5f),'nextParticlesPosition':Util['createTexture'](_0x56da06,_0xb33b5f),'currentParticlesSpeed':Util['createTexture'](_0x56da06,_0x4b2a12),'nextParticlesSpeed':Util['createTexture'](_0x56da06,_0x4b2a12),'postProcessingPosition':Util['createTexture'](_0x56da06,_0xb33b5f),'postProcessingSpeed':Util['createTexture'](_0x56da06,_0x4b2a12)};}['randomizeParticles'](_0x3f99ba,_0x2dcb4d){const _0x1bf6e6=_0x39bbfa,_0x3cfd9c=new Float32Array(0x4*_0x3f99ba);for(let _0x1b3bb7=0x0;_0x1b3bb7<_0x3f99ba;_0x1b3bb7++){_0x3cfd9c[0x4*_0x1b3bb7]=Cesium$3['Math'][_0x1bf6e6(0x214)](_0x2dcb4d['lonRange']['x'],_0x2dcb4d['lonRange']['y']),_0x3cfd9c[0x4*_0x1b3bb7+0x1]=Cesium$3['Math']['randomBetween'](_0x2dcb4d[_0x1bf6e6(0x2aa)]['x'],_0x2dcb4d['latRange']['y']),_0x3cfd9c[0x4*_0x1b3bb7+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev'][_0x1bf6e6(0x1ed)],this['data']['lev']['max']),_0x3cfd9c[0x4*_0x1b3bb7+0x3]=0x0;}return _0x3cfd9c;}['destroyParticlesTextures'](){const _0x33fd6e=_0x39bbfa;Object[_0x33fd6e(0x267)](this['particlesTextures'])['forEach'](_0x27799d=>{const _0x34e4d3=_0x33fd6e;this['particlesTextures'][_0x27799d][_0x34e4d3(0x1dc)]();});}['createComputingPrimitives'](_0x3b7061,_0x1fb86c,_0x15e90d){const _0x50bd3d=_0x39bbfa,_0x449180=new Cesium$3['Cartesian3'](_0x3b7061['dimensions'][_0x50bd3d(0x1f9)],_0x3b7061['dimensions']['lat'],_0x3b7061['dimensions']['lev']),_0x4a8678=new Cesium$3['Cartesian3'](_0x3b7061['lon']['min'],_0x3b7061['lat'][_0x50bd3d(0x1ed)],_0x3b7061[_0x50bd3d(0x253)][_0x50bd3d(0x1ed)]),_0x1d2e76=new Cesium$3['Cartesian3'](_0x3b7061['lon']['max'],_0x3b7061[_0x50bd3d(0x24f)]['max'],_0x3b7061['lev']['max']),_0x51d36e=new Cesium$3[(_0x50bd3d(0x1ff))]((_0x1d2e76['x']-_0x4a8678['x'])/(_0x449180['x']-0x1),(_0x1d2e76['y']-_0x4a8678['y'])/(_0x449180['y']-0x1),_0x449180['z']>0x1?(_0x1d2e76['z']-_0x4a8678['z'])/(_0x449180['z']-0x1):0x1),_0x43d97a=new Cesium$3['Cartesian2'](_0x3b7061['U']['min'],_0x3b7061['U']['max']),_0x3410c0=new Cesium$3['Cartesian2'](_0x3b7061['V']['min'],_0x3b7061['V']['max']),_0x59531a=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x59531a['windTextures']['U'];},'V':function(){return _0x59531a['windTextures']['V'];},'currentParticlesPosition':function(){return _0x59531a['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x449180;},'minimum':function(){return _0x4a8678;},'maximum':function(){return _0x1d2e76;},'interval':function(){return _0x51d36e;}},'fragmentShaderSource':new Cesium$3[(_0x50bd3d(0x1d5))]({'sources':[getWind_frag]}),'outputTexture':this[_0x50bd3d(0x22f)][_0x50bd3d(0x26a)],'preExecute':function(){const _0x1d79a9=_0x50bd3d;_0x59531a[_0x1d79a9(0x1db)]['getWind']['commandToExecute']['outputTexture']=_0x59531a['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x59531a['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x59531a['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x43d97a;},'vSpeedRange':function(){return _0x3410c0;},'pixelSize':function(){return _0x15e90d['pixelSize'];},'speedFactor':function(){const _0xc892eb=_0x50bd3d;return _0x1fb86c[_0xc892eb(0x225)];}},'fragmentShaderSource':new Cesium$3[(_0x50bd3d(0x1d5))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x50bd3d(0x207)],'preExecute':function(){const _0xd3df72=_0x50bd3d,_0x21fde7=_0x59531a['particlesTextures']['currentParticlesSpeed'];_0x59531a['particlesTextures']['currentParticlesSpeed']=_0x59531a['particlesTextures']['postProcessingSpeed'],_0x59531a['particlesTextures']['postProcessingSpeed']=_0x21fde7,_0x59531a['primitives'][_0xd3df72(0x1f0)]['commandToExecute']['outputTexture']=_0x59531a['particlesTextures'][_0xd3df72(0x207)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x59531a['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x59531a['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x36ed44=_0x50bd3d,_0x2430fc=_0x59531a['particlesTextures'][_0x36ed44(0x264)];_0x59531a['particlesTextures']['currentParticlesPosition']=_0x59531a[_0x36ed44(0x22f)]['postProcessingPosition'],_0x59531a[_0x36ed44(0x22f)]['postProcessingPosition']=_0x2430fc,_0x59531a['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x59531a[_0x36ed44(0x22f)][_0x36ed44(0x1f5)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x59531a['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x59531a['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){const _0x2ddcab=_0x50bd3d;return _0x15e90d[_0x2ddcab(0x280)];},'latRange':function(){return _0x15e90d['latRange'];},'randomCoefficient':function(){const _0x3831df=Math['random']();return _0x3831df;},'dropRate':function(){return _0x1fb86c['dropRate'];},'dropRateBump':function(){return _0x1fb86c['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x50bd3d(0x1d5))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x35f517=_0x50bd3d;_0x59531a['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x59531a['particlesTextures'][_0x35f517(0x201)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x50bd3d(0x25a),'uniformMap':{'postProcessingPosition':function(){const _0x5c8924=_0x50bd3d;return _0x59531a[_0x5c8924(0x22f)][_0x5c8924(0x201)];},'nextParticlesSpeed':function(){const _0x45a417=_0x50bd3d;return _0x59531a[_0x45a417(0x22f)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x50bd3d(0x22f)]['postProcessingSpeed'],'preExecute':function(){const _0x4f0165=_0x50bd3d;_0x59531a['primitives'][_0x4f0165(0x240)]['commandToExecute'][_0x4f0165(0x28d)]=_0x59531a['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x39bbfa(0x297)];class ParticleSystem{constructor(_0x9b198e,_0x3397be,_0x226939,_0x34df1d){const _0x1286d9=_0x39bbfa;this['context']=_0x9b198e,_0x3397be={..._0x3397be},_0x3397be['udata']&&_0x3397be['vdata']&&(_0x3397be[_0x1286d9(0x249)]={},_0x3397be['dimensions'][_0x1286d9(0x1f9)]=_0x3397be['cols'],_0x3397be[_0x1286d9(0x249)][_0x1286d9(0x24f)]=_0x3397be['rows'],_0x3397be[_0x1286d9(0x249)]['lev']=_0x3397be['lev']||0x1,_0x3397be['lon']={},_0x3397be['lon']['min']=_0x3397be[_0x1286d9(0x1d0)],_0x3397be[_0x1286d9(0x1f9)]['max']=_0x3397be['xmax'],_0x3397be[_0x1286d9(0x24f)]={},_0x3397be['lat']['min']=_0x3397be['ymin'],_0x3397be['lat']['max']=_0x3397be['ymax'],_0x3397be['lev']={},_0x3397be['lev']['min']=_0x3397be['levmin']??0x1,_0x3397be['lev']['max']=_0x3397be['levmax']??0x1,_0x3397be['U']={},_0x3397be['U'][_0x1286d9(0x265)]=new Float32Array(_0x3397be['udata']),_0x3397be['U']['min']=_0x3397be['umin']??Math['min'](..._0x3397be['udata']),_0x3397be['U']['max']=_0x3397be['umax']??Math[_0x1286d9(0x2b2)](..._0x3397be['udata']),_0x3397be['V']={},_0x3397be['V']['array']=new Float32Array(_0x3397be[_0x1286d9(0x25e)]),_0x3397be['V']['min']=_0x3397be['vmin']??Math['min'](..._0x3397be['vdata']),_0x3397be['V']['max']=_0x3397be['vmax']??Math[_0x1286d9(0x2b2)](..._0x3397be['vdata'])),this['data']=_0x3397be,this[_0x1286d9(0x281)]=_0x226939,this['viewerParameters']=_0x34df1d,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x1286d9(0x281)],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0xbb30f3){const _0x1b0eaa=_0x39bbfa;this[_0x1b0eaa(0x20d)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x2baaf8=>{const _0x3497a4=_0x1b0eaa;this['particlesComputing']['windTextures'][_0x2baaf8][_0x3497a4(0x1dc)]();}),this['particlesRendering']['textures'][_0x1b0eaa(0x24c)][_0x1b0eaa(0x1dc)](),Object[_0x1b0eaa(0x267)](this[_0x1b0eaa(0x2a2)]['framebuffers'])['forEach'](_0x401c1b=>{const _0xd00f2e=_0x1b0eaa;this[_0xd00f2e(0x2a2)][_0xd00f2e(0x20a)][_0x401c1b]['destroy']();}),this['context']=_0xbb30f3,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x1b0eaa(0x222)],this['options'],this[_0x1b0eaa(0x29b)]),this['particlesRendering']=new ParticlesRendering(this[_0x1b0eaa(0x1fb)],this['data'],this['options'],this['viewerParameters'],this[_0x1b0eaa(0x20d)]);}[_0x39bbfa(0x1cd)](){const _0x24bea1=_0x39bbfa,_0x315e77=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x24bea1(0x267)](this['particlesRendering'][_0x24bea1(0x20a)])[_0x24bea1(0x28e)](_0x18efe1=>{_0x315e77['framebuffer']=this['particlesRendering']['framebuffers'][_0x18efe1],_0x315e77['execute'](this['context']);});}['refreshParticles'](_0x11f107){const _0x471e35=_0x39bbfa;this[_0x471e35(0x1cd)](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this[_0x471e35(0x29b)]);if(_0x11f107){var _0x3f772e;const _0x19ec6b=this[_0x471e35(0x2a2)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives'][_0x471e35(0x238)]['geometry']=_0x19ec6b;const _0x5d4a3a=Cesium$2['VertexArray'][_0x471e35(0x1ea)]({'context':this['context'],'geometry':_0x19ec6b,'attributeLocations':this[_0x471e35(0x2a2)]['primitives'][_0x471e35(0x238)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x471e35(0x219)]});(_0x3f772e=this['particlesRendering']['primitives'])!==null&&_0x3f772e!==void 0x0&&(_0x3f772e=_0x3f772e['segments'])!==null&&_0x3f772e!==void 0x0&&_0x3f772e['commandToExecute']&&(this['particlesRendering']['primitives'][_0x471e35(0x238)]['commandToExecute']['vertexArray']=_0x5d4a3a);}}[_0x39bbfa(0x261)](_0x2ece65){let _0x55263e=![];this['options']['maxParticles']!==_0x2ece65['maxParticles']&&(_0x55263e=!![]),Object['keys'](_0x2ece65)['forEach'](_0x45cc53=>{const _0x3919ed=_0xbdb2;this[_0x3919ed(0x281)][_0x45cc53]=_0x2ece65[_0x45cc53];}),this['refreshParticles'](_0x55263e);}[_0x39bbfa(0x20b)](_0x360f3f){const _0x31d90a=_0x39bbfa;Object['keys'](_0x360f3f)['forEach'](_0x597e03=>{this['viewerParameters'][_0x597e03]=_0x360f3f[_0x597e03];}),this[_0x31d90a(0x26b)](![]);}[_0x39bbfa(0x1dc)](){const _0x3fc337=_0x39bbfa;clearTimeout(this['canrefresh']),this[_0x3fc337(0x20d)][_0x3fc337(0x23b)](),Object['keys'](this['particlesComputing']['windTextures'])[_0x3fc337(0x28e)](_0x2b982c=>{const _0x3a99a1=_0x3fc337;this['particlesComputing'][_0x3a99a1(0x1e2)][_0x2b982c][_0x3a99a1(0x1dc)]();}),this['particlesRendering']['textures']['colorTable'][_0x3fc337(0x1dc)](),Object['keys'](this['particlesRendering'][_0x3fc337(0x20a)])['forEach'](_0x46d8d5=>{const _0x908df=_0x3fc337;this[_0x908df(0x2a2)][_0x908df(0x20a)][_0x46d8d5]['destroy']();});for(const _0x17631b in this){delete this[_0x17631b];}}}const Cesium$1=mars3d__namespace[_0x39bbfa(0x297)],BaseLayer$1=mars3d__namespace['layer'][_0x39bbfa(0x284)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x3ab7f4={}){_0x3ab7f4={...DEF_OPTIONS,..._0x3ab7f4},super(_0x3ab7f4),this['_setOptionsHook'](_0x3ab7f4);}get['layer'](){const _0x468c17=_0x39bbfa;return this[_0x468c17(0x1db)];}get[_0x39bbfa(0x222)](){return this['_data'];}set['data'](_0x567915){const _0x57d74f=_0x39bbfa;this[_0x57d74f(0x23e)](_0x567915);}get['colors'](){const _0x5e2db2=_0x39bbfa;return this[_0x5e2db2(0x281)][_0x5e2db2(0x208)];}set['colors'](_0x20c456){const _0x1b5512=_0x39bbfa;this[_0x1b5512(0x281)]['colors']=_0x20c456,this[_0x1b5512(0x29a)]&&this[_0x1b5512(0x29a)]['setOptions']({'colors':_0x20c456}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x2f66f4=_0x39bbfa;this['scene']=this['_map']['scene'],this[_0x2f66f4(0x248)]=this['_map']['camera'],this[_0x2f66f4(0x1db)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives'][_0x2f66f4(0x2a0)](this[_0x2f66f4(0x1db)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x2f66f4(0x1ce)]=new Cesium$1[(_0x2f66f4(0x1f3))](Cesium$1[_0x2f66f4(0x1ff)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x2f66f4(0x1df),this['resize'][_0x2f66f4(0x213)](this),![]),this[_0x2f66f4(0x22e)]=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType'][_0x2f66f4(0x1cf)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x2f66f4(0x277)],this),this[_0x2f66f4(0x1cb)]['on'](mars3d__namespace[_0x2f66f4(0x22d)][_0x2f66f4(0x1fe)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}[_0x39bbfa(0x1c4)](){const _0x1c1fd7=_0x39bbfa;window[_0x1c1fd7(0x286)](_0x1c1fd7(0x1df),this['resize']),this[_0x1c1fd7(0x1cb)]['off'](mars3d__namespace['EventType']['preRender'],this[_0x1c1fd7(0x287)],this),this[_0x1c1fd7(0x1cb)][_0x1c1fd7(0x1e9)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x1c1fd7(0x1e9)](mars3d__namespace[_0x1c1fd7(0x22d)][_0x1c1fd7(0x29e)],this['_onMouseDownEvent'],this),this['_map'][_0x1c1fd7(0x1e9)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x1c1fd7(0x1cb)][_0x1c1fd7(0x1d4)][_0x1c1fd7(0x1db)]['remove'](this[_0x1c1fd7(0x1db)]);}['resize'](){const _0x2221eb=_0x39bbfa;if(!this[_0x2221eb(0x1e7)]||!this[_0x2221eb(0x29a)])return;this['primitives'][_0x2221eb(0x1e7)]=![],this[_0x2221eb(0x1db)]['removeAll'](),this['_map']['once'](mars3d__namespace[_0x2221eb(0x22d)]['preRender'],this['_onMap_preRenderEvent'],this);}[_0x39bbfa(0x287)](_0x3752c2){const _0x2f53b0=_0x39bbfa;this[_0x2f53b0(0x29a)]['canvasResize'](this['scene'][_0x2f53b0(0x1fb)]),this[_0x2f53b0(0x23f)](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0xbb5c35){const _0x5dcc29=_0x39bbfa;clearTimeout(this['refreshTimer']);if(!this[_0x5dcc29(0x1e7)]||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x4d09b0=_0x5dcc29;if(!this[_0x4d09b0(0x1e7)])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x471a0a){const _0x482a7b=_0x39bbfa;this[_0x482a7b(0x22e)]=!![];}['_onMouseMoveEvent'](_0xd8597a){const _0x186115=_0x39bbfa;if(!this['show']||!this['particleSystem'])return;this[_0x186115(0x22e)]&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x182117){const _0x1654c2=_0x39bbfa;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this[_0x1654c2(0x288)]&&this['redraw'](),this['primitives']['show']=!![],this[_0x1654c2(0x22e)]=![],this[_0x1654c2(0x288)]=![];}[_0x39bbfa(0x2b8)](){const _0x5834be=_0x39bbfa;if(!this['_map']||!this[_0x5834be(0x1e7)])return;this[_0x5834be(0x1f1)](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x5834be(0x1e7)]=!![];}[_0x39bbfa(0x23e)](_0x1fd0ea){const _0x2bd1cb=_0x39bbfa;this[_0x2bd1cb(0x24b)]=_0x1fd0ea,this['particleSystem']&&this['particleSystem']['destroy'](),this[_0x2bd1cb(0x29a)]=new ParticleSystem(this['scene']['context'],_0x1fd0ea,this['getOptions'](),this[_0x2bd1cb(0x29b)]),this['addPrimitives']();}['_setOptionsHook'](_0x22b670,_0x364fb8){const _0x653da2=_0x39bbfa;if(_0x22b670)for(const _0x102bd3 in _0x22b670){this[_0x102bd3]=_0x22b670[_0x102bd3];}this[_0x653da2(0x29a)]&&this['particleSystem'][_0x653da2(0x261)](this['getOptions']());}['getOptions'](){const _0x8766bc=_0x39bbfa,_0x1f85c3=Math[_0x8766bc(0x218)](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x1f85c3*_0x1f85c3,{'particlesTextureSize':_0x1f85c3,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x8766bc(0x1e8)],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x8766bc(0x225)],'lineWidth':this[_0x8766bc(0x1da)],'colors':this[_0x8766bc(0x208)]};}['addPrimitives'](){const _0xb00aa4=_0x39bbfa;this['primitives'][_0xb00aa4(0x2a0)](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives']['add'](this[_0xb00aa4(0x29a)][_0xb00aa4(0x20d)][_0xb00aa4(0x1db)]['updateSpeed']),this['primitives']['add'](this['particleSystem'][_0xb00aa4(0x20d)][_0xb00aa4(0x1db)][_0xb00aa4(0x1d3)]),this[_0xb00aa4(0x1db)][_0xb00aa4(0x2a0)](this['particleSystem']['particlesComputing']['primitives'][_0xb00aa4(0x201)]),this['primitives']['add'](this[_0xb00aa4(0x29a)]['particlesComputing']['primitives'][_0xb00aa4(0x240)]),this['primitives'][_0xb00aa4(0x2a0)](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives']['add'](this[_0xb00aa4(0x29a)]['particlesRendering']['primitives']['trails']),this['primitives'][_0xb00aa4(0x2a0)](this['particleSystem'][_0xb00aa4(0x2a2)]['primitives']['screen']);}['updateViewerParameters'](){const _0x2e9a88=_0x39bbfa;let _0x599857=this[_0x2e9a88(0x248)]['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x599857){const _0x4e598e=this[_0x2e9a88(0x1cb)]['getExtent']();_0x599857=Cesium$1[_0x2e9a88(0x273)]['fromDegrees'](_0x4e598e['xmin'],_0x4e598e['ymin'],_0x4e598e['xmax'],_0x4e598e['ymax']);}const _0x54c38b=Util[_0x2e9a88(0x299)](_0x599857);this['viewerParameters']['lonRange']['x']=_0x54c38b['lon']['min'],this['viewerParameters'][_0x2e9a88(0x280)]['y']=_0x54c38b['lon']['max'],this['viewerParameters'][_0x2e9a88(0x2aa)]['x']=_0x54c38b['lat']['min'],this['viewerParameters'][_0x2e9a88(0x2aa)]['y']=_0x54c38b['lat']['max'];const _0x20ad8a=this['camera'][_0x2e9a88(0x241)](this[_0x2e9a88(0x1ce)],this['scene']['drawingBufferWidth'],this['scene'][_0x2e9a88(0x2a9)]);_0x20ad8a>0x0&&(this['viewerParameters'][_0x2e9a88(0x1ec)]=_0x20ad8a);}}mars3d__namespace[_0x39bbfa(0x24d)][_0x39bbfa(0x2a7)]('wind',WindLayer),mars3d__namespace['layer'][_0x39bbfa(0x23d)]=WindLayer;class CanvasParticle{constructor(){const _0x62d8d6=_0x39bbfa;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x62d8d6(0x216)]=null,this['age']=null,this[_0x62d8d6(0x274)]=null;}['destroy'](){for(const _0x19c6d0 in this){delete this[_0x19c6d0];}}}function _0x49d4(){const _0x45d49f=['atan2','lon','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','context','log','particles','mouseUp','Cartesian3','color','postProcessingPosition','toDegrees','404965CNJVeU','_colorRamp','clearCommand','NEAREST','nextParticlesSpeed','colors','TWO_PI','framebuffers','applyViewerParameters','getColorTexture','particlesComputing','width','createSegmentsGeometry','toGridXY','WindUtil','createRenderingPrimitives','bind','randomBetween','push','tlat','create','ceil','STATIC_DRAW','grid','4BMhpih','_tomap','VertexArray','isDestroyed','pointer-events','getRandomLatLng','RGBA','data','2446911DJkPoS','commandToExecute','speedFactor','xmax','TRIANGLES','destroyObject','hidden','1xbaYub','_calcUV','PI_OVER_TWO','EventType','mouse_down','particlesTextures','steps','setGeometry','canvas','_calc_speedRate','PI_OVER_THREE','source','green','defined','segments','globalCompositeOperation','zIndex','destroyParticlesTextures','Sampler','WindLayer','setData','addPrimitives','postProcessingSpeed','getPixelSize','globalAlpha','vertexShaderSource','1306454Ewxbmb','_updateIng2','createFramebuffer','1775221XKlHHF','camera','dimensions','maxParticles','_data','colorTable','LayerUtil','default','lat','tlng','8kBHTTr','GeometryAttribute','lev','mouseMove','visibility','lng','clampToLatitudeRange','style','particlesNumber','Compute','_bilinearInterpolation','primitiveType','12FWntRH','vdata','TextureMagnificationFilter','autoClear','setOptions','BufferUsage','top','currentParticlesPosition','array','commandType','keys','Draw','unbindEvent','particlesWind','refreshParticles','clientWidth','mode','nextTrailsDepth','update','__esModule','EllipsoidalOccluder','createTexture','Rectangle','speed','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','_onMouseUpEvent','_onMouseDownEvent','particleHeight','none','PrimitiveType','cols','pointerEvents','length','auto','23238556aDphqo','lonRange','options','commandList','createRawRenderState','BaseLayer','canvasContext','removeEventListener','_onMap_preRenderEvent','mouse_move','createCommand','north','ComponentDatatype','fragmentShaderSource','outputTexture','forEach','attributeLocations','position','particlesTextureSize','getUVByPoint','currentTrailsDepth','clientHeight','LUMINANCE','Matrix4','Cesium','abs','viewRectangleToLonLatRange','particleSystem','viewerParameters','postMessage','framebuffer','mouseDown','shaderProgram','add','getFullscreenQuad','particlesRendering','setDate','textures','vertexArray','7238556Awawyp','register','reverseY','drawingBufferHeight','latRange','visible','Math','layer','fixedHeight','defineProperty','cancelAnimationFrame','requestAnimationFrame','max','_onMapWhellEvent','worker','reverse','Geometry','mars3d-canvasWind','redraw','48IwqTEI','_removedHook','trails','CanvasWindField','_onMouseMoveEvent','getParticles','segmentsDepth','preExecute','_map','windData','clearFramebuffers','globeBoundingSphere','wheel','xmin','rawRenderState','currentTrails','updatePosition','scene','ShaderSource','_speedRate','clear','DEPTH_COMPONENT','frameRate','lineWidth','primitives','destroy','ymin','DISABLE_GL_POSITION_LOG_DEPTH','resize','createWindTextures','_mountedHook','windTextures','maxAge','LINEAR','getUVByXY','ALWAYS','show','dropRate','off','fromGeometry','3136870QmbSlV','pixelSize','min','age','windField','updateSpeed','updateViewerParameters','fromDegrees','BoundingSphere','lineTo','nextParticlesPosition','_randomParticle','createParticlesTextures'];_0x49d4=function(){return _0x45d49f;};return _0x49d4();}class CanvasWindField{constructor(_0x566c13){this['setOptions'](_0x566c13);}get['speedRate'](){const _0x3c0435=_0x39bbfa;return this[_0x3c0435(0x1d6)];}set['speedRate'](_0x57a55c){const _0x60f4c2=_0x39bbfa;this['_speedRate']=(0x64-(_0x57a55c>0x63?0x63:_0x57a55c))*0x64,this['_calc_speedRate']=[(this['xmax']-this[_0x60f4c2(0x1d0)])/this['_speedRate'],(this['ymax']-this['ymin'])/this[_0x60f4c2(0x1d6)]];}get['maxAge'](){return this['_maxAge'];}set[_0x39bbfa(0x1e3)](_0x6470c6){this['_maxAge']=_0x6470c6;}['setOptions'](_0x884377){const _0x43c61e=_0x39bbfa;this[_0x43c61e(0x281)]=_0x884377,this[_0x43c61e(0x1e3)]=_0x884377['maxAge']||0x78,this['speedRate']=_0x884377['speedRate']||0x32,this['particles']=[];const _0x191e88=_0x884377['particlesNumber']||0x1000;for(let _0x453f47=0x0;_0x453f47<_0x191e88;_0x453f47++){const _0x37ba71=this['_randomParticle'](new CanvasParticle());this[_0x43c61e(0x1fd)]['push'](_0x37ba71);}}[_0x39bbfa(0x2a3)](_0x2dd8cd){const _0x5b2a8f=_0x39bbfa;this['rows']=_0x2dd8cd['rows'],this['cols']=_0x2dd8cd['cols'],this['xmin']=_0x2dd8cd['xmin'],this['xmax']=_0x2dd8cd[_0x5b2a8f(0x226)],this['ymin']=_0x2dd8cd['ymin'],this['ymax']=_0x2dd8cd['ymax'],this['grid']=[];const _0x23ba6b=_0x2dd8cd['udata'],_0x3b0d59=_0x2dd8cd['vdata'];let _0x39cc65=![];_0x23ba6b[_0x5b2a8f(0x27d)]===this['rows']&&_0x23ba6b[0x0]['length']===this['cols']&&(_0x39cc65=!![]);let _0x1975ce=0x0,_0x3121b6=null,_0x3c9669=null;for(let _0x3b8fb6=0x0;_0x3b8fb6<this['rows'];_0x3b8fb6++){_0x3121b6=[];for(let _0x66d34a=0x0;_0x66d34a<this[_0x5b2a8f(0x27b)];_0x66d34a++,_0x1975ce++){_0x39cc65?_0x3c9669=this[_0x5b2a8f(0x22b)](_0x23ba6b[_0x3b8fb6][_0x66d34a],_0x3b0d59[_0x3b8fb6][_0x66d34a]):_0x3c9669=this[_0x5b2a8f(0x22b)](_0x23ba6b[_0x1975ce],_0x3b0d59[_0x1975ce]),_0x3121b6['push'](_0x3c9669);}this['grid']['push'](_0x3121b6);}this[_0x5b2a8f(0x281)]['reverseY']&&this[_0x5b2a8f(0x21a)][_0x5b2a8f(0x2b5)]();}[_0x39bbfa(0x1d7)](){const _0xe564f9=_0x39bbfa;delete this['rows'],delete this[_0xe564f9(0x27b)],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0xe564f9(0x1fd)];}[_0x39bbfa(0x210)](_0x51b6f9,_0x434a65){const _0xeeb3f5=_0x39bbfa,_0x2d5451=(_0x51b6f9-this['xmin'])/(this[_0xeeb3f5(0x226)]-this['xmin'])*(this['cols']-0x1),_0x3556c2=(this['ymax']-_0x434a65)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x2d5451,_0x3556c2];}['getUVByXY'](_0x45c4d3,_0x306e5d){const _0x2dacd2=_0x39bbfa;if(_0x45c4d3<0x0||_0x45c4d3>=this[_0x2dacd2(0x27b)]||_0x306e5d>=this['rows'])return[0x0,0x0,0x0];const _0x5904ce=Math['floor'](_0x45c4d3),_0x288245=Math['floor'](_0x306e5d);if(_0x5904ce===_0x45c4d3&&_0x288245===_0x306e5d)return this['grid'][_0x306e5d][_0x45c4d3];const _0x32a394=_0x5904ce+0x1,_0x336c51=_0x288245+0x1,_0x4f1021=this['getUVByXY'](_0x5904ce,_0x288245),_0x153be2=this['getUVByXY'](_0x32a394,_0x288245),_0x4094cf=this['getUVByXY'](_0x5904ce,_0x336c51),_0x572231=this[_0x2dacd2(0x1e5)](_0x32a394,_0x336c51);let _0x3711a9=null;try{_0x3711a9=this['_bilinearInterpolation'](_0x45c4d3-_0x5904ce,_0x306e5d-_0x288245,_0x4f1021,_0x153be2,_0x4094cf,_0x572231);}catch(_0x372ee9){console[_0x2dacd2(0x1fc)](_0x45c4d3,_0x306e5d);}return _0x3711a9;}[_0x39bbfa(0x25b)](_0x3d35d8,_0x670e2f,_0x322845,_0x4f0720,_0x32a835,_0x484c06){const _0x1faa69=0x1-_0x3d35d8,_0x9e9d02=0x1-_0x670e2f,_0x22fe22=_0x1faa69*_0x9e9d02,_0x4a557b=_0x3d35d8*_0x9e9d02,_0xff41d=_0x1faa69*_0x670e2f,_0x46304b=_0x3d35d8*_0x670e2f,_0x512649=_0x322845[0x0]*_0x22fe22+_0x4f0720[0x0]*_0x4a557b+_0x32a835[0x0]*_0xff41d+_0x484c06[0x0]*_0x46304b,_0xc0ffbc=_0x322845[0x1]*_0x22fe22+_0x4f0720[0x1]*_0x4a557b+_0x32a835[0x1]*_0xff41d+_0x484c06[0x1]*_0x46304b;return this['_calcUV'](_0x512649,_0xc0ffbc);}['_calcUV'](_0x451934,_0x38001c){return[+_0x451934,+_0x38001c,Math['sqrt'](_0x451934*_0x451934+_0x38001c*_0x38001c)];}[_0x39bbfa(0x292)](_0x4b3b4c,_0x2444dd){const _0x4aa2c8=_0x39bbfa;if(!this['isInExtent'](_0x4b3b4c,_0x2444dd))return null;const _0x20b641=this['toGridXY'](_0x4b3b4c,_0x2444dd),_0x50e24e=this[_0x4aa2c8(0x1e5)](_0x20b641[0x0],_0x20b641[0x1]);return _0x50e24e;}['isInExtent'](_0x1284e0,_0x474411){const _0x3f426a=_0x39bbfa;return _0x1284e0>=this[_0x3f426a(0x1d0)]&&_0x1284e0<=this['xmax']&&_0x474411>=this['ymin']&&_0x474411<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x55084a=_0x39bbfa,_0x239401=fRandomByfloat(this[_0x55084a(0x1d0)],this['xmax']),_0x3d5c25=fRandomByfloat(this[_0x55084a(0x1dd)],this['ymax']);return{'lat':_0x3d5c25,'lng':_0x239401};}[_0x39bbfa(0x1c8)](){const _0x3731d1=_0x39bbfa;let _0x2a00e5,_0x2ddaa6,_0x32239a;for(let _0x42da02=0x0,_0x516c47=this['particles'][_0x3731d1(0x27d)];_0x42da02<_0x516c47;_0x42da02++){let _0x5a22db=this[_0x3731d1(0x1fd)][_0x42da02];_0x5a22db[_0x3731d1(0x1ee)]<=0x0&&(_0x5a22db=this[_0x3731d1(0x1f6)](_0x5a22db));if(_0x5a22db['age']>0x0){const _0x397876=_0x5a22db['tlng'],_0x5deaa5=_0x5a22db['tlat'];_0x32239a=this['getUVByPoint'](_0x397876,_0x5deaa5),_0x32239a?(_0x2a00e5=_0x397876+this['_calc_speedRate'][0x0]*_0x32239a[0x0],_0x2ddaa6=_0x5deaa5+this[_0x3731d1(0x233)][0x1]*_0x32239a[0x1],_0x5a22db[_0x3731d1(0x256)]=_0x397876,_0x5a22db['lat']=_0x5deaa5,_0x5a22db[_0x3731d1(0x250)]=_0x2a00e5,_0x5a22db['tlat']=_0x2ddaa6,_0x5a22db['speed']=_0x32239a[0x2],_0x5a22db['age']--):_0x5a22db[_0x3731d1(0x1ee)]=0x0;}}return this[_0x3731d1(0x1fd)];}[_0x39bbfa(0x1f6)](_0x4b8f7c){const _0x396dfe=_0x39bbfa;let _0x46f938,_0x668a32;for(let _0x127603=0x0;_0x127603<0x1e;_0x127603++){_0x46f938=this[_0x396dfe(0x220)](),_0x668a32=this['getUVByPoint'](_0x46f938[_0x396dfe(0x256)],_0x46f938['lat']);if(_0x668a32&&_0x668a32[0x2]>0x0)break;}if(!_0x668a32)return _0x4b8f7c;const _0x3f4e70=_0x46f938['lng']+this[_0x396dfe(0x233)][0x0]*_0x668a32[0x0],_0x3e36c0=_0x46f938['lat']+this[_0x396dfe(0x233)][0x1]*_0x668a32[0x1];return _0x4b8f7c[_0x396dfe(0x256)]=_0x46f938['lng'],_0x4b8f7c['lat']=_0x46f938['lat'],_0x4b8f7c[_0x396dfe(0x250)]=_0x3f4e70,_0x4b8f7c['tlat']=_0x3e36c0,_0x4b8f7c['age']=Math['round'](Math['random']()*this[_0x396dfe(0x1e3)]),_0x4b8f7c['speed']=_0x668a32[0x2],_0x4b8f7c;}['destroy'](){for(const _0x52e750 in this){delete this[_0x52e750];}}}function fRandomByfloat(_0x575a40,_0x118ebf){return _0x575a40+Math['random']()*(_0x118ebf-_0x575a40);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x39bbfa(0x2ad)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x24f0e1={}){const _0xc0bfec=_0x39bbfa;super(_0x24f0e1),this['_setOptionsHook'](_0x24f0e1),this[_0xc0bfec(0x232)]=null,_0x24f0e1[_0xc0bfec(0x208)]&&_0x24f0e1[_0xc0bfec(0x230)]&&(this[_0xc0bfec(0x204)]=new mars3d__namespace['ColorRamp'](_0x24f0e1));}['_setOptionsHook'](_0x5c08f7,_0x354f52){const _0x4e9c9f=_0x39bbfa;this['frameTime']=0x3e8/(_0x5c08f7[_0x4e9c9f(0x1d9)]||0xa),this['_pointerEvents']=this[_0x4e9c9f(0x281)]['pointerEvents']??![],this['color']=_0x5c08f7[_0x4e9c9f(0x200)]||'#ffffff',this['lineWidth']=_0x5c08f7[_0x4e9c9f(0x1da)]||0x1,this[_0x4e9c9f(0x2ae)]=_0x5c08f7['fixedHeight']??0x0,this[_0x4e9c9f(0x2a8)]=_0x5c08f7['reverseY']??![],this['windField']&&this['windField'][_0x4e9c9f(0x261)](_0x5c08f7);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x2fd34a=_0x39bbfa;return this[_0x2fd34a(0x1cb)]['scene']['canvas']['clientWidth'];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get[_0x39bbfa(0x27c)](){return this['_pointerEvents'];}set[_0x39bbfa(0x27c)](_0x4dc30d){const _0x25a34f=_0x39bbfa;this['_pointerEvents']=_0x4dc30d;if(!this['canvas'])return;_0x4dc30d?this['canvas']['style'][_0x25a34f(0x21f)]='all':this[_0x25a34f(0x232)]['style'][_0x25a34f(0x21f)]='none';}get['particlesNumber'](){const _0x37c306=_0x39bbfa;return this['options'][_0x37c306(0x259)];}set['particlesNumber'](_0x933d47){this['options']['particlesNumber']=_0x933d47,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x5edb83){const _0x1dc13f=_0x39bbfa;this['options']['speedRate']=_0x5edb83,this['windField']&&(this[_0x1dc13f(0x1ef)]['speedRate']=_0x5edb83);}get[_0x39bbfa(0x1e3)](){const _0x11c8e7=_0x39bbfa;return this[_0x11c8e7(0x281)][_0x11c8e7(0x1e3)];}set['maxAge'](_0x3e730a){const _0x5e0af4=_0x39bbfa;this['options'][_0x5e0af4(0x1e3)]=_0x3e730a,this['windField']&&(this['windField'][_0x5e0af4(0x1e3)]=_0x3e730a);}get['data'](){return this['windData'];}set[_0x39bbfa(0x222)](_0x514791){this['setData'](_0x514791);}['_showHook'](_0x188776){const _0x3c8a1e=_0x39bbfa;_0x188776?this['_addedHook']():(this[_0x3c8a1e(0x1cc)]&&(this['options'][_0x3c8a1e(0x222)]=this['windData']),this['_removedHook']());}[_0x39bbfa(0x1e1)](){const _0xa991ea=_0x39bbfa;this['options']['worker']?this['initWorker']():this[_0xa991ea(0x1ef)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x26d169=_0x39bbfa;this['canvas']=this['_createCanvas'](),this['canvasContext']=this[_0x26d169(0x232)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options'][_0x26d169(0x222)]);}['_removedHook'](){this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x19f073=_0x39bbfa,_0x8263c8=mars3d__namespace['DomUtil']['create']('canvas',_0x19f073(0x2b7),this['_map']['container']);return _0x8263c8[_0x19f073(0x258)][_0x19f073(0x290)]='absolute',_0x8263c8['style'][_0x19f073(0x263)]='0px',_0x8263c8['style']['left']='0px',_0x8263c8['style']['width']=this['_map']['scene']['canvas'][_0x19f073(0x26c)]+'px',_0x8263c8['style']['height']=this['_map'][_0x19f073(0x1d4)]['canvas']['clientHeight']+'px',_0x8263c8[_0x19f073(0x258)]['pointerEvents']=this['_pointerEvents']?_0x19f073(0x27e):_0x19f073(0x279),_0x8263c8['style']['zIndex']=this['options'][_0x19f073(0x23a)]??0x9,_0x8263c8['width']=this['_map'][_0x19f073(0x1d4)][_0x19f073(0x232)]['clientWidth'],_0x8263c8['height']=this[_0x19f073(0x1cb)]['scene']['canvas']['clientHeight'],_0x8263c8;}['resize'](){const _0x3354d2=_0x39bbfa;this['canvas']&&(this['canvas']['style']['width']=this[_0x3354d2(0x1cb)]['scene']['canvas']['clientWidth']+'px',this['canvas'][_0x3354d2(0x258)]['height']=this['_map']['scene']['canvas'][_0x3354d2(0x294)]+'px',this['canvas'][_0x3354d2(0x20e)]=this[_0x3354d2(0x1cb)]['scene'][_0x3354d2(0x232)][_0x3354d2(0x26c)],this[_0x3354d2(0x232)]['height']=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x1e7593=_0x39bbfa,_0xec434d=this;let _0x3d65e0=Date['now']();(function _0x5cec63(){const _0x41060b=_0xbdb2;_0xec434d['animateFrame']=window[_0x41060b(0x2b1)](_0x5cec63);if(_0xec434d['show']&&_0xec434d['windField']){const _0x42285e=Date['now'](),_0x516a55=_0x42285e-_0x3d65e0;_0x516a55>_0xec434d['frameTime']&&(_0x3d65e0=_0x42285e-_0x516a55%_0xec434d['frameTime'],_0xec434d[_0x41060b(0x26f)]());}}(),window['addEventListener'](_0x1e7593(0x1df),this[_0x1e7593(0x1df)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace[_0x1e7593(0x22d)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x1e7593(0x22d)]['mouseUp'],this[_0x1e7593(0x276)],this)));}[_0x39bbfa(0x269)](){const _0x47c319=_0x39bbfa;window[_0x47c319(0x2b0)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this[_0x47c319(0x281)]['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x47c319(0x254)],this[_0x47c319(0x1c7)],this));}[_0x39bbfa(0x2b3)](_0xf22b7a){const _0x4277ad=_0x39bbfa;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x4277ad(0x232)])return;this['canvas']['style'][_0x4277ad(0x255)]=_0x4277ad(0x229),this['refreshTimer']=setTimeout(()=>{const _0x275e92=_0x4277ad;if(!this['show'])return;this[_0x275e92(0x2b8)](),this[_0x275e92(0x232)][_0x275e92(0x258)]['visibility']=_0x275e92(0x2ab);},0xc8);}['_onMouseDownEvent'](_0x4566e1){const _0x8ef0f9=_0x39bbfa;this['mouse_down']=!![],this['_map'][_0x8ef0f9(0x1e9)](mars3d__namespace['EventType'][_0x8ef0f9(0x254)],this[_0x8ef0f9(0x1c7)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0xd09be6){const _0x3fb907=_0x39bbfa;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this[_0x3fb907(0x232)][_0x3fb907(0x258)]['visibility']='hidden',this[_0x3fb907(0x288)]=!![]);}['_onMouseUpEvent'](_0x3aadf8){const _0x35930c=_0x39bbfa;if(!this[_0x35930c(0x1e7)]||!this['canvas'])return;this['_map'][_0x35930c(0x1e9)](mars3d__namespace[_0x35930c(0x22d)]['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this[_0x35930c(0x288)]=![];}[_0x39bbfa(0x23e)](_0x468033){const _0x4f46b7=_0x39bbfa;this['clear'](),this['windData']=_0x468033,this['windField']['setDate'](_0x468033),this[_0x4f46b7(0x2b8)]();}['redraw'](){const _0x44d6ee=_0x39bbfa;if(!this['show'])return;this['windField']['setOptions'](this['options']),this[_0x44d6ee(0x26f)]();}['update'](){const _0x3419ac=_0x39bbfa;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this[_0x3419ac(0x1ef)]['update']();else{const _0xb21e9d=this['windField'][_0x3419ac(0x1c8)]();this['_drawLines'](_0xb21e9d);}this['_updateIng']=![];}['_drawLines'](_0xa57d3a){const _0x65525c=_0x39bbfa;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext'][_0x65525c(0x239)]='lighter',this['canvasContext'][_0x65525c(0x242)]=0.9;const _0x3f6851=this[_0x65525c(0x1cb)][_0x65525c(0x1d4)][_0x65525c(0x26d)]!==Cesium['SceneMode']['SCENE3D'],_0x1b9273=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x5c561e=0x0,_0xf868b5=_0xa57d3a['length'];_0x5c561e<_0xf868b5;_0x5c561e++){const _0x443ffe=_0xa57d3a[_0x5c561e],_0x153db9=this['_tomap'](_0x443ffe['lng'],_0x443ffe['lat'],_0x443ffe),_0x664380=this['_tomap'](_0x443ffe['tlng'],_0x443ffe['tlat'],_0x443ffe);if(!_0x153db9||!_0x664380)continue;if(_0x3f6851&&Math[_0x65525c(0x298)](_0x153db9[0x0]-_0x664380[0x0])>=_0x1b9273)continue;this[_0x65525c(0x285)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x65525c(0x204)]['getColor'](_0x443ffe['speed']),this[_0x65525c(0x285)]['moveTo'](_0x153db9[0x0],_0x153db9[0x1]),this['canvasContext']['lineTo'](_0x664380[0x0],_0x664380[0x1]),this['canvasContext']['stroke']();}else{this[_0x65525c(0x285)]['beginPath'](),this['canvasContext']['lineWidth']=this[_0x65525c(0x1da)],this[_0x65525c(0x285)]['strokeStyle']=this['color'];for(let _0xf08334=0x0,_0xd6b217=_0xa57d3a[_0x65525c(0x27d)];_0xf08334<_0xd6b217;_0xf08334++){const _0xf34e28=_0xa57d3a[_0xf08334],_0x14cfea=this['_tomap'](_0xf34e28['lng'],_0xf34e28['lat'],_0xf34e28),_0x56d0de=this['_tomap'](_0xf34e28['tlng'],_0xf34e28['tlat'],_0xf34e28);if(!_0x14cfea||!_0x56d0de)continue;if(_0x3f6851&&Math[_0x65525c(0x298)](_0x14cfea[0x0]-_0x56d0de[0x0])>=_0x1b9273)continue;this['canvasContext']['moveTo'](_0x14cfea[0x0],_0x14cfea[0x1]),this['canvasContext'][_0x65525c(0x1f4)](_0x56d0de[0x0],_0x56d0de[0x1]);}this['canvasContext']['stroke']();}}[_0x39bbfa(0x21c)](_0x226855,_0x3cb846,_0x4dd2a3){const _0x4bf7c4=_0x39bbfa,_0xcb155e=Cesium[_0x4bf7c4(0x1ff)][_0x4bf7c4(0x1f2)](_0x226855,_0x3cb846,this['fixedHeight']),_0x3ba73b=this['_map'][_0x4bf7c4(0x1d4)];if(_0x3ba73b['mode']===Cesium['SceneMode']['SCENE3D']){const _0xddb5d5=new Cesium[(_0x4bf7c4(0x271))](_0x3ba73b['globe']['ellipsoid'],_0x3ba73b['camera']['positionWC']),_0x53ef6f=_0xddb5d5['isPointVisible'](_0xcb155e);if(!_0x53ef6f)return _0x4dd2a3['age']=0x0,null;}const _0x32cf68=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0xcb155e);return _0x32cf68?[_0x32cf68['x'],_0x32cf68['y']]:null;}[_0x39bbfa(0x1d7)](){const _0x2fb985=_0x39bbfa;this[_0x2fb985(0x1ef)][_0x2fb985(0x1d7)](),delete this['windData'];}['initWorker'](){this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=_0x49311c=>{const _0x1d2bce=_0xbdb2;this['_drawLines'](_0x49311c['data']['particles']),this[_0x1d2bce(0x245)]=![];},this['windField']={'init':_0x5e2ffc=>{this['worker']['postMessage']({'type':'init','options':_0x5e2ffc});},'setOptions':_0x3d6c8d=>{const _0xe7dccc=_0xbdb2;this[_0xe7dccc(0x2b4)]['postMessage']({'type':'setOptions','options':_0x3d6c8d});},'setDate':_0x11faac=>{this['worker']['postMessage']({'type':'setDate','data':_0x11faac});},'update':()=>{const _0x3765ec=_0xbdb2;if(this['_updateIng2'])return;this[_0x3765ec(0x245)]=!![],this['worker']['postMessage']({'type':_0x3765ec(0x26f)});},'clear':()=>{const _0x168165=_0xbdb2;this['worker'][_0x168165(0x29c)]({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x39bbfa(0x24d)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x39bbfa(0x1c6)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x39bbfa(0x211)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
