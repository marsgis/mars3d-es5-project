/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.17
 * 编译日期：2023-12-14 20:38:41
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x34c216=_0x5876;(function(_0x46a9e0,_0x56884e){const _0x54f171=_0x5876,_0x44b087=_0x46a9e0();while(!![]){try{const _0x21743a=parseInt(_0x54f171(0x14a))/0x1+-parseInt(_0x54f171(0x1da))/0x2+-parseInt(_0x54f171(0x1c8))/0x3+parseInt(_0x54f171(0x1f6))/0x4*(parseInt(_0x54f171(0x1ae))/0x5)+parseInt(_0x54f171(0x136))/0x6*(parseInt(_0x54f171(0x11f))/0x7)+parseInt(_0x54f171(0x1a8))/0x8*(parseInt(_0x54f171(0x214))/0x9)+-parseInt(_0x54f171(0x18a))/0xa;if(_0x21743a===_0x56884e)break;else _0x44b087['push'](_0x44b087['shift']());}catch(_0x5c37a9){_0x44b087['push'](_0x44b087['shift']());}}}(_0x4cc5,0x89621));function _interopNamespace(_0x51a942){const _0x1abc08=_0x5876;if(_0x51a942&&_0x51a942['__esModule'])return _0x51a942;var _0x2115bf=Object[_0x1abc08(0x16b)](null);return _0x51a942&&Object['keys'](_0x51a942)[_0x1abc08(0x13b)](function(_0x35efba){const _0x25a89f=_0x1abc08;if(_0x35efba!=='default'){var _0x221498=Object['getOwnPropertyDescriptor'](_0x51a942,_0x35efba);Object['defineProperty'](_0x2115bf,_0x35efba,_0x221498[_0x25a89f(0x165)]?_0x221498:{'enumerable':!![],'get':function(){return _0x51a942[_0x35efba];}});}}),_0x2115bf[_0x1abc08(0x1cd)]=_0x51a942,_0x2115bf;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x34c216(0x13c)];function getU(_0x4c7d57,_0x1efa61){const _0x4fdce0=_0x4c7d57*Math['cos'](Cesium$7['Math']['toRadians'](_0x1efa61));return _0x4fdce0;}function getV(_0x243ed3,_0x49424f){const _0x2cf478=_0x243ed3*Math['sin'](Cesium$7['Math']['toRadians'](_0x49424f));return _0x2cf478;}function getSpeed(_0x51ae2f,_0x9c5157){const _0x3a16b7=_0x34c216,_0xbbf6ce=Math[_0x3a16b7(0x1c1)](Math['pow'](_0x51ae2f,0x2)+Math['pow'](_0x9c5157,0x2));return _0xbbf6ce;}function getDirection(_0x302e7f,_0x2fadf2){const _0x3d921d=_0x34c216;let _0x17b2c1=Cesium$7['Math'][_0x3d921d(0x1b6)](Math['atan2'](_0x2fadf2,_0x302e7f));return _0x17b2c1+=_0x17b2c1<0x0?0x168:0x0,_0x17b2c1;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x1b5274){const _0x1423fe=_0x34c216;this[_0x1423fe(0x1a1)]=_0x1b5274['commandType'],this[_0x1423fe(0x15c)]=_0x1b5274['geometry'],this['attributeLocations']=_0x1b5274['attributeLocations'],this['primitiveType']=_0x1b5274['primitiveType'],this['uniformMap']=_0x1b5274['uniformMap'],this['vertexShaderSource']=_0x1b5274['vertexShaderSource'],this[_0x1423fe(0x17e)]=_0x1b5274['fragmentShaderSource'],this['rawRenderState']=_0x1b5274['rawRenderState'],this['framebuffer']=_0x1b5274['framebuffer'],this['outputTexture']=_0x1b5274[_0x1423fe(0x1e2)],this['autoClear']=_0x1b5274['autoClear']??![],this['preExecute']=_0x1b5274['preExecute'],this[_0x1423fe(0x127)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x1423fe(0x15f)]&&(this['clearCommand']=new Cesium$6[(_0x1423fe(0x12c))]({'color':new Cesium$6[(_0x1423fe(0x145))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x1423fe(0x201)]}));}['createCommand'](_0x29c02f){const _0x59c0a4=_0x34c216;switch(this['commandType']){case _0x59c0a4(0x1f4):{const _0x2e5514=Cesium$6['VertexArray'][_0x59c0a4(0x160)]({'context':_0x29c02f,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x4d3fcc=Cesium$6['ShaderProgram']['fromCache']({'context':_0x29c02f,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x59c0a4(0x170)],'fragmentShaderSource':this[_0x59c0a4(0x17e)]}),_0x2e6b07=Cesium$6['RenderState']['fromCache'](this[_0x59c0a4(0x204)]);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x59c0a4(0x212)],'shaderProgram':_0x4d3fcc,'vertexArray':_0x2e5514,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x2e6b07,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0x34c216(0x18d)](_0x1a78cb,_0x55f6c5){this['geometry']=_0x55f6c5;const _0x305c3c=Cesium$6['VertexArray']['fromGeometry']({'context':_0x1a78cb,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x305c3c;}['update'](_0x3a5728){const _0x4d759e=_0x34c216;if(!this['show'])return;if(_0x3a5728[_0x4d759e(0x146)]!==Cesium$6[_0x4d759e(0x137)][_0x4d759e(0x1fa)])return;!Cesium$6[_0x4d759e(0x20f)](this[_0x4d759e(0x1dc)])&&(this['commandToExecute']=this['createCommand'](_0x3a5728['context'])),Cesium$6[_0x4d759e(0x20f)](this[_0x4d759e(0x1ec)])&&this['preExecute'](),Cesium$6['defined'](this[_0x4d759e(0x217)])&&_0x3a5728[_0x4d759e(0x17d)]['push'](this[_0x4d759e(0x217)]),_0x3a5728['commandList']['push'](this[_0x4d759e(0x1dc)]);}['isDestroyed'](){return![];}[_0x34c216(0x213)](){const _0x318a85=_0x34c216;if(this['clearCommand']){var _0x174bce,_0x24f11b;(_0x174bce=this['clearCommand'])!==null&&_0x174bce!==void 0x0&&_0x174bce['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x24f11b=this[_0x318a85(0x217)])!==null&&_0x24f11b!==void 0x0&&_0x24f11b['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute'][_0x318a85(0x157)][_0x318a85(0x213)](),this['commandToExecute']['shaderProgram']&&this[_0x318a85(0x1dc)]['shaderProgram'][_0x318a85(0x213)](),delete this[_0x318a85(0x1dc)]),Cesium$6[_0x318a85(0x20a)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x2c79c2=function(){const _0x52354e=_0x5876,_0x477927=new Cesium$5[(_0x52354e(0x17a))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x52354e(0x20e))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x52354e(0x20e))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x477927;},_0x36bc16=function(_0x5d4d5f,_0x5b2fa1){const _0xf0866c=_0x5876;if(Cesium$5[_0xf0866c(0x20f)](_0x5b2fa1)){const _0x28d29f={};_0x28d29f['arrayBufferView']=_0x5b2fa1,_0x5d4d5f[_0xf0866c(0x1fc)]=_0x28d29f;}const _0x208a7e=new Cesium$5[(_0xf0866c(0x13e))](_0x5d4d5f);return _0x208a7e;},_0x25c912=function(_0x3d3cf9,_0x2be6ba,_0x307d51){const _0x169c8d=new Cesium$5['Framebuffer']({'context':_0x3d3cf9,'colorTextures':[_0x2be6ba],'depthTexture':_0x307d51});return _0x169c8d;},_0x11db3e=function(_0x196b52){const _0x1f1168=_0x5876,_0xb6a9a2=!![],_0x1fbd62=![],_0x5723cb={'viewport':_0x196b52[_0x1f1168(0x18c)],'depthTest':_0x196b52[_0x1f1168(0x20b)],'depthMask':_0x196b52[_0x1f1168(0x1b8)],'blending':_0x196b52['blending']},_0x18b12f=Cesium$5[_0x1f1168(0x19d)]['getDefaultRenderState'](_0xb6a9a2,_0x1fbd62,_0x5723cb);return _0x18b12f;},_0x35817d=function(_0x13de5c){const _0x21f156=_0x5876,_0x5b7004={},_0x156910=Cesium$5['Math'][_0x21f156(0x1d9)](_0x13de5c[_0x21f156(0x195)],Cesium$5['Math']['TWO_PI']),_0x21b204=Cesium$5['Math'][_0x21f156(0x1d9)](_0x13de5c[_0x21f156(0x151)],Cesium$5['Math']['TWO_PI']),_0x338931=_0x13de5c['width'];let _0x1533b5,_0x3718c6;_0x338931>Cesium$5[_0x21f156(0x13d)][_0x21f156(0x1ff)]?(_0x1533b5=0x0,_0x3718c6=Cesium$5['Math'][_0x21f156(0x124)]):_0x21b204-_0x156910<_0x338931?(_0x1533b5=_0x156910,_0x3718c6=_0x156910+_0x338931):(_0x1533b5=_0x156910,_0x3718c6=_0x21b204);_0x5b7004[_0x21f156(0x1e7)]={'min':Cesium$5['Math']['toDegrees'](_0x1533b5),'max':Cesium$5['Math']['toDegrees'](_0x3718c6)};const _0x2f3f1f=_0x13de5c['south'],_0xe53243=_0x13de5c['north'],_0x5e68c0=_0x13de5c['height'],_0x3babc2=_0x5e68c0>Cesium$5['Math']['PI']/0xc?_0x5e68c0/0x2:0x0;let _0xac7a29=Cesium$5[_0x21f156(0x13d)]['clampToLatitudeRange'](_0x2f3f1f-_0x3babc2),_0x52b70c=Cesium$5[_0x21f156(0x13d)]['clampToLatitudeRange'](_0xe53243+_0x3babc2);return _0xac7a29<-Cesium$5['Math']['PI_OVER_THREE']&&(_0xac7a29=-Cesium$5['Math']['PI_OVER_TWO']),_0x52b70c>Cesium$5[_0x21f156(0x13d)]['PI_OVER_THREE']&&(_0x52b70c=Cesium$5[_0x21f156(0x13d)]['PI_OVER_TWO']),_0x5b7004['lat']={'min':Cesium$5[_0x21f156(0x13d)]['toDegrees'](_0xac7a29),'max':Cesium$5[_0x21f156(0x13d)][_0x21f156(0x1b6)](_0x52b70c)},_0x5b7004;};return{'getFullscreenQuad':_0x2c79c2,'createTexture':_0x36bc16,'createFramebuffer':_0x25c912,'createRawRenderState':_0x11db3e,'viewRectangleToLonLatRange':_0x35817d};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x34c216(0x138),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x34c216(0x13c)];class ParticlesRendering{constructor(_0x43a080,_0x2a238a,_0x5a5dd2,_0x21b59f,_0x2b8822){this['createRenderingTextures'](_0x43a080,_0x2a238a,_0x5a5dd2['colors']),this['createRenderingFramebuffers'](_0x43a080),this['createRenderingPrimitives'](_0x43a080,_0x5a5dd2,_0x21b59f,_0x2b8822);}[_0x34c216(0x11d)](_0x290768,_0x33c202,_0x41fbe7){const _0x3113fd=_0x34c216,_0x2f8b81={'context':_0x290768,'width':_0x290768['drawingBufferWidth'],'height':_0x290768['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x3113fd(0x132)]['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x3113fd(0x1ce)]},_0x3f4a11={'context':_0x290768,'width':_0x290768['drawingBufferWidth'],'height':_0x290768[_0x3113fd(0x1ef)],'pixelFormat':Cesium$4[_0x3113fd(0x132)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0xa1c92=_0x41fbe7['length'],_0x57f30e=new Float32Array(_0xa1c92*0x3);for(let _0x5ccd38=0x0;_0x5ccd38<_0xa1c92;_0x5ccd38++){const _0x18cb75=Cesium$4['Color'][_0x3113fd(0x1c7)](_0x41fbe7[_0x5ccd38]);_0x57f30e[0x3*_0x5ccd38]=_0x18cb75['red'],_0x57f30e[0x3*_0x5ccd38+0x1]=_0x18cb75['green'],_0x57f30e[0x3*_0x5ccd38+0x2]=_0x18cb75[_0x3113fd(0x15b)];}const _0x553b6b={'context':_0x290768,'width':_0xa1c92,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x3113fd(0x1d6)],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x3113fd(0x1c4)]={'segmentsColor':Util['createTexture'](_0x2f8b81),'segmentsDepth':Util['createTexture'](_0x3f4a11),'currentTrailsColor':Util['createTexture'](_0x2f8b81),'currentTrailsDepth':Util['createTexture'](_0x3f4a11),'nextTrailsColor':Util['createTexture'](_0x2f8b81),'nextTrailsDepth':Util['createTexture'](_0x3f4a11),'colorTable':Util['createTexture'](_0x553b6b,_0x57f30e)};}['createRenderingFramebuffers'](_0xa92883){const _0x218f39=_0x34c216;this[_0x218f39(0x1c5)]={'segments':Util['createFramebuffer'](_0xa92883,this['textures']['segmentsColor'],this[_0x218f39(0x1c4)]['segmentsDepth']),'currentTrails':Util[_0x218f39(0x11e)](_0xa92883,this['textures'][_0x218f39(0x166)],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0xa92883,this['textures'][_0x218f39(0x162)],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x35520f){const _0x1cf7a3=_0x34c216,_0x518782=0x4;let _0x5757a2=[];for(let _0x455fb4=0x0;_0x455fb4<_0x35520f[_0x1cf7a3(0x168)];_0x455fb4++){for(let _0x5252fd=0x0;_0x5252fd<_0x35520f['particlesTextureSize'];_0x5252fd++){for(let _0x6ff6f4=0x0;_0x6ff6f4<_0x518782;_0x6ff6f4++){_0x5757a2[_0x1cf7a3(0x1a6)](_0x455fb4/_0x35520f['particlesTextureSize']),_0x5757a2['push'](_0x5252fd/_0x35520f['particlesTextureSize']);}}}_0x5757a2=new Float32Array(_0x5757a2);let _0x27b5b7=[];const _0x3a5229=[-0x1,0x1],_0x15b00b=[-0x1,0x1];for(let _0x6793e3=0x0;_0x6793e3<_0x35520f['maxParticles'];_0x6793e3++){for(let _0x15aa20=0x0;_0x15aa20<_0x518782/0x2;_0x15aa20++){for(let _0x26824f=0x0;_0x26824f<_0x518782/0x2;_0x26824f++){_0x27b5b7[_0x1cf7a3(0x1a6)](_0x3a5229[_0x15aa20]),_0x27b5b7['push'](_0x15b00b[_0x26824f]),_0x27b5b7[_0x1cf7a3(0x1a6)](0x0);}}}_0x27b5b7=new Float32Array(_0x27b5b7);const _0xefd73d=0x6*_0x35520f['maxParticles'],_0x234b2c=new Uint32Array(_0xefd73d);for(let _0x255289=0x0,_0x3e7cb4=0x0,_0x66b779=0x0;_0x255289<_0x35520f[_0x1cf7a3(0x1f8)];_0x255289++){_0x234b2c[_0x3e7cb4++]=_0x66b779+0x0,_0x234b2c[_0x3e7cb4++]=_0x66b779+0x1,_0x234b2c[_0x3e7cb4++]=_0x66b779+0x2,_0x234b2c[_0x3e7cb4++]=_0x66b779+0x2,_0x234b2c[_0x3e7cb4++]=_0x66b779+0x1,_0x234b2c[_0x3e7cb4++]=_0x66b779+0x3,_0x66b779+=0x4;}const _0x4be119=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x1cf7a3(0x215)][_0x1cf7a3(0x179)],'componentsPerAttribute':0x2,'values':_0x5757a2}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x1cf7a3(0x215)][_0x1cf7a3(0x179)],'componentsPerAttribute':0x3,'values':_0x27b5b7})}),'indices':_0x234b2c});return _0x4be119;}['createRenderingPrimitives'](_0x3e981f,_0x21a403,_0x1566e0,_0x569d09){const _0x58dd3c=_0x34c216,_0x55e977=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x21a403),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x120c8a=_0x5876;return _0x569d09[_0x120c8a(0x1b3)]['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x569d09['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x569d09['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x55e977['textures']['colorTable'];},'aspect':function(){return _0x3e981f['drawingBufferWidth']/_0x3e981f['drawingBufferHeight'];},'pixelSize':function(){const _0x48dd7b=_0x5876;return _0x1566e0[_0x48dd7b(0x14b)];},'lineWidth':function(){return _0x21a403['lineWidth'];},'particleHeight':function(){return _0x21a403['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x58dd3c(0x15e)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x58dd3c(0x1f4),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x58dd3c(0x128)],'uniformMap':{'segmentsColorTexture':function(){return _0x55e977['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x22e5b4=_0x58dd3c;return _0x55e977[_0x22e5b4(0x1c4)]['segmentsDepth'];},'currentTrailsColor':function(){const _0x2f7969=_0x58dd3c;return _0x55e977['framebuffers'][_0x2f7969(0x12b)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x4e9c3f=_0x58dd3c;return _0x55e977['framebuffers']['currentTrails'][_0x4e9c3f(0x1ed)];},'fadeOpacity':function(){const _0x27d766=_0x58dd3c;return _0x21a403[_0x27d766(0x18e)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x58dd3c(0x1d4)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x58dd3c(0x183))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x58dd3c(0x1a5)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x58dd3c(0x1cb)][_0x58dd3c(0x14e)]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x58dd3c(0x17b)],'autoClear':!![],'preExecute':function(){const _0x553c8b=_0x58dd3c,_0x4dabb3=_0x55e977['framebuffers']['currentTrails'];_0x55e977[_0x553c8b(0x1c5)][_0x553c8b(0x12b)]=_0x55e977['framebuffers']['nextTrails'],_0x55e977['framebuffers'][_0x553c8b(0x17b)]=_0x4dabb3,_0x55e977[_0x553c8b(0x1e3)][_0x553c8b(0x141)]['commandToExecute'][_0x553c8b(0x1fb)]=_0x55e977['framebuffers'][_0x553c8b(0x17b)],_0x55e977['primitives']['trails']['clearCommand'][_0x553c8b(0x1fb)]=_0x55e977['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x58dd3c(0x1a7)](),'primitiveType':Cesium$4['PrimitiveType'][_0x58dd3c(0x128)],'uniformMap':{'trailsColorTexture':function(){const _0x3b637d=_0x58dd3c;return _0x55e977['framebuffers'][_0x3b637d(0x17b)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x37dc1c=_0x58dd3c;return _0x55e977[_0x37dc1c(0x1c5)]['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x58dd3c(0x1d4)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x34c216(0x1ba),postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x34c216(0x13c)];class ParticlesComputing{constructor(_0x525651,_0x15e926,_0x32e3e8,_0x3dd4c4){const _0x4068c8=_0x34c216;this['data']=_0x15e926,this['createWindTextures'](_0x525651,_0x15e926),this[_0x4068c8(0x11c)](_0x525651,_0x32e3e8,_0x3dd4c4),this['createComputingPrimitives'](_0x15e926,_0x32e3e8,_0x3dd4c4);}['createWindTextures'](_0x33dfeb,_0x56ab1b){const _0x381307=_0x34c216,_0x5edf0c={'context':_0x33dfeb,'width':_0x56ab1b[_0x381307(0x196)][_0x381307(0x1e7)],'height':_0x56ab1b['dimensions']['lat']*(_0x56ab1b['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x381307(0x1bd)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x381307(0x125)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this[_0x381307(0x1d8)]={'U':Util['createTexture'](_0x5edf0c,_0x56ab1b['U']['array']),'V':Util[_0x381307(0x216)](_0x5edf0c,_0x56ab1b['V'][_0x381307(0x1a2)])};}['createParticlesTextures'](_0x315388,_0x1ebfd2,_0x467002){const _0x21142e=_0x34c216,_0x49b2c2={'context':_0x315388,'width':_0x1ebfd2[_0x21142e(0x168)],'height':_0x1ebfd2['particlesTextureSize'],'pixelFormat':Cesium$3[_0x21142e(0x132)]['RGBA'],'pixelDatatype':Cesium$3[_0x21142e(0x1b9)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x411f25=this['randomizeParticles'](_0x1ebfd2['maxParticles'],_0x467002),_0x4ee345=new Float32Array(0x4*_0x1ebfd2[_0x21142e(0x1f8)])[_0x21142e(0x17c)](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x49b2c2),'currentParticlesPosition':Util['createTexture'](_0x49b2c2,_0x411f25),'nextParticlesPosition':Util['createTexture'](_0x49b2c2,_0x411f25),'currentParticlesSpeed':Util['createTexture'](_0x49b2c2,_0x4ee345),'nextParticlesSpeed':Util[_0x21142e(0x216)](_0x49b2c2,_0x4ee345),'postProcessingPosition':Util[_0x21142e(0x216)](_0x49b2c2,_0x411f25),'postProcessingSpeed':Util['createTexture'](_0x49b2c2,_0x4ee345)};}[_0x34c216(0x188)](_0x75b13c,_0x52b088){const _0x4eea27=_0x34c216,_0x43f3f4=new Float32Array(0x4*_0x75b13c);for(let _0x2ca2fe=0x0;_0x2ca2fe<_0x75b13c;_0x2ca2fe++){_0x43f3f4[0x4*_0x2ca2fe]=Cesium$3['Math']['randomBetween'](_0x52b088['lonRange']['x'],_0x52b088['lonRange']['y']),_0x43f3f4[0x4*_0x2ca2fe+0x1]=Cesium$3['Math']['randomBetween'](_0x52b088['latRange']['x'],_0x52b088['latRange']['y']),_0x43f3f4[0x4*_0x2ca2fe+0x2]=Cesium$3['Math']['randomBetween'](this[_0x4eea27(0x200)]['lev'][_0x4eea27(0x158)],this['data']['lev']['max']),_0x43f3f4[0x4*_0x2ca2fe+0x3]=0x0;}return _0x43f3f4;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x19361d=>{const _0x90d14c=_0x5876;this[_0x90d14c(0x1b3)][_0x19361d]['destroy']();});}['createComputingPrimitives'](_0x5ac243,_0x463789,_0x37d1c8){const _0x29a1d1=_0x34c216,_0x10622f=new Cesium$3[(_0x29a1d1(0x1a0))](_0x5ac243['dimensions']['lon'],_0x5ac243['dimensions']['lat'],_0x5ac243[_0x29a1d1(0x196)]['lev']),_0x3542c6=new Cesium$3['Cartesian3'](_0x5ac243['lon']['min'],_0x5ac243[_0x29a1d1(0x154)]['min'],_0x5ac243[_0x29a1d1(0x1aa)][_0x29a1d1(0x158)]),_0x1d7cea=new Cesium$3['Cartesian3'](_0x5ac243['lon']['max'],_0x5ac243[_0x29a1d1(0x154)]['max'],_0x5ac243['lev'][_0x29a1d1(0x150)]),_0x538ded=new Cesium$3['Cartesian3']((_0x1d7cea['x']-_0x3542c6['x'])/(_0x10622f['x']-0x1),(_0x1d7cea['y']-_0x3542c6['y'])/(_0x10622f['y']-0x1),_0x10622f['z']>0x1?(_0x1d7cea['z']-_0x3542c6['z'])/(_0x10622f['z']-0x1):0x1),_0x4c2f17=new Cesium$3['Cartesian2'](_0x5ac243['U'][_0x29a1d1(0x158)],_0x5ac243['U']['max']),_0x5b063b=new Cesium$3['Cartesian2'](_0x5ac243['V']['min'],_0x5ac243['V'][_0x29a1d1(0x150)]),_0x1ee338=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x29a1d1(0x1ad),'uniformMap':{'U':function(){const _0x1d309a=_0x29a1d1;return _0x1ee338[_0x1d309a(0x1d8)]['U'];},'V':function(){const _0x317e25=_0x29a1d1;return _0x1ee338[_0x317e25(0x1d8)]['V'];},'currentParticlesPosition':function(){return _0x1ee338['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x10622f;},'minimum':function(){return _0x3542c6;},'maximum':function(){return _0x1d7cea;},'interval':function(){return _0x538ded;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x48b801=_0x29a1d1;_0x1ee338[_0x48b801(0x1e3)]['getWind']['commandToExecute']['outputTexture']=_0x1ee338['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x29a1d1(0x1ad),'uniformMap':{'currentParticlesSpeed':function(){return _0x1ee338['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x1ee338['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x4c2f17;},'vSpeedRange':function(){return _0x5b063b;},'pixelSize':function(){return _0x37d1c8['pixelSize'];},'speedFactor':function(){return _0x463789['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x29a1d1(0x1b3)][_0x29a1d1(0x1ee)],'preExecute':function(){const _0x1062ce=_0x29a1d1,_0x272776=_0x1ee338[_0x1062ce(0x1b3)]['currentParticlesSpeed'];_0x1ee338['particlesTextures'][_0x1062ce(0x1e4)]=_0x1ee338['particlesTextures'][_0x1062ce(0x211)],_0x1ee338['particlesTextures']['postProcessingSpeed']=_0x272776,_0x1ee338[_0x1062ce(0x1e3)]['updateSpeed']['commandToExecute'][_0x1062ce(0x1e2)]=_0x1ee338[_0x1062ce(0x1b3)][_0x1062ce(0x1ee)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x30b455=_0x29a1d1;return _0x1ee338['particlesTextures'][_0x30b455(0x175)];},'currentParticlesSpeed':function(){const _0xf88786=_0x29a1d1;return _0x1ee338[_0xf88786(0x1b3)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x29a1d1(0x1f5)],'preExecute':function(){const _0x3afbfc=_0x29a1d1,_0x595307=_0x1ee338['particlesTextures'][_0x3afbfc(0x175)];_0x1ee338['particlesTextures']['currentParticlesPosition']=_0x1ee338[_0x3afbfc(0x1b3)][_0x3afbfc(0x149)],_0x1ee338[_0x3afbfc(0x1b3)]['postProcessingPosition']=_0x595307,_0x1ee338['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x1ee338['particlesTextures'][_0x3afbfc(0x1f5)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x446e1a=_0x29a1d1;return _0x1ee338[_0x446e1a(0x1b3)]['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x1ee338['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){const _0x3e2cc0=_0x29a1d1;return _0x37d1c8[_0x3e2cc0(0x174)];},'latRange':function(){const _0x5535f4=_0x29a1d1;return _0x37d1c8[_0x5535f4(0x1c3)];},'randomCoefficient':function(){const _0x25a739=Math['random']();return _0x25a739;},'dropRate':function(){return _0x463789['dropRate'];},'dropRateBump':function(){const _0x2204f3=_0x29a1d1;return _0x463789[_0x2204f3(0x203)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x29a1d1(0x149)],'preExecute':function(){const _0x36913d=_0x29a1d1;_0x1ee338[_0x36913d(0x1e3)][_0x36913d(0x149)][_0x36913d(0x1dc)]['outputTexture']=_0x1ee338[_0x36913d(0x1b3)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x1ee338['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x5fc837=_0x29a1d1;return _0x1ee338['particlesTextures'][_0x5fc837(0x1ee)];}},'fragmentShaderSource':new Cesium$3[(_0x29a1d1(0x183))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x29a1d1(0x1b3)]['postProcessingSpeed'],'preExecute':function(){const _0x4827b2=_0x29a1d1;_0x1ee338['primitives']['postProcessingSpeed'][_0x4827b2(0x1dc)]['outputTexture']=_0x1ee338['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x13a6a0,_0xe16163,_0x59950c,_0x375c38){const _0x1dfdf2=_0x34c216;this['context']=_0x13a6a0,_0xe16163={..._0xe16163},_0xe16163[_0x1dfdf2(0x1f0)]&&_0xe16163[_0x1dfdf2(0x163)]&&(_0xe16163['dimensions']={},_0xe16163['dimensions']['lon']=_0xe16163['cols'],_0xe16163['dimensions']['lat']=_0xe16163['rows'],_0xe16163['dimensions'][_0x1dfdf2(0x1aa)]=_0xe16163['lev']||0x1,_0xe16163['lon']={},_0xe16163['lon']['min']=_0xe16163['xmin'],_0xe16163['lon']['max']=_0xe16163['xmax'],_0xe16163['lat']={},_0xe16163[_0x1dfdf2(0x154)]['min']=_0xe16163['ymin'],_0xe16163[_0x1dfdf2(0x154)]['max']=_0xe16163['ymax'],_0xe16163['lev']={},_0xe16163['lev'][_0x1dfdf2(0x158)]=_0xe16163['levmin']??0x1,_0xe16163['lev']['max']=_0xe16163['levmax']??0x1,_0xe16163['U']={},_0xe16163['U']['array']=new Float32Array(_0xe16163['udata']),_0xe16163['U']['min']=_0xe16163['umin']??Math[_0x1dfdf2(0x158)](..._0xe16163['udata']),_0xe16163['U']['max']=_0xe16163[_0x1dfdf2(0x14d)]??Math['max'](..._0xe16163['udata']),_0xe16163['V']={},_0xe16163['V']['array']=new Float32Array(_0xe16163['vdata']),_0xe16163['V'][_0x1dfdf2(0x158)]=_0xe16163['vmin']??Math['min'](..._0xe16163[_0x1dfdf2(0x163)]),_0xe16163['V'][_0x1dfdf2(0x150)]=_0xe16163['vmax']??Math['max'](..._0xe16163['vdata'])),this['data']=_0xe16163,this[_0x1dfdf2(0x126)]=_0x59950c,this['viewerParameters']=_0x375c38,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x1dfdf2(0x200)],this['options'],this['viewerParameters'],this[_0x1dfdf2(0x173)]);}['canvasResize'](_0xcfe9e9){const _0x48dbc8=_0x34c216;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x311fac=>{this['particlesComputing']['windTextures'][_0x311fac]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x48dbc8(0x213)](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x48dbc8(0x13b)](_0x2defd6=>{const _0x287d22=_0x48dbc8;this['particlesRendering'][_0x287d22(0x1c5)][_0x2defd6]['destroy']();}),this['context']=_0xcfe9e9,this['particlesComputing']=new ParticlesComputing(this[_0x48dbc8(0x129)],this['data'],this[_0x48dbc8(0x126)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x48dbc8(0x129)],this['data'],this[_0x48dbc8(0x126)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x541579=_0x34c216,_0xc3021a=new Cesium$2[(_0x541579(0x12c))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x2d0ada=>{const _0x17216a=_0x541579;_0xc3021a[_0x17216a(0x1fb)]=this['particlesRendering']['framebuffers'][_0x2d0ada],_0xc3021a['execute'](this['context']);});}[_0x34c216(0x133)](_0x53c592){const _0x176627=_0x34c216;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x176627(0x173)]['createParticlesTextures'](this[_0x176627(0x129)],this['options'],this[_0x176627(0x1a9)]);if(_0x53c592){var _0x1d5587;const _0xc34abf=this[_0x176627(0x180)]['createSegmentsGeometry'](this[_0x176627(0x126)]);this['particlesRendering']['primitives'][_0x176627(0x15e)]['geometry']=_0xc34abf;const _0x1f5598=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0xc34abf,'attributeLocations':this['particlesRendering'][_0x176627(0x1e3)][_0x176627(0x15e)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x1d5587=this[_0x176627(0x180)]['primitives'])!==null&&_0x1d5587!==void 0x0&&(_0x1d5587=_0x1d5587['segments'])!==null&&_0x1d5587!==void 0x0&&_0x1d5587['commandToExecute']&&(this['particlesRendering']['primitives']['segments'][_0x176627(0x1dc)]['vertexArray']=_0x1f5598);}}['setOptions'](_0x1cc516){const _0x44ebdc=_0x34c216;let _0x29d67e=![];this[_0x44ebdc(0x126)]['maxParticles']!==_0x1cc516['maxParticles']&&(_0x29d67e=!![]),Object['keys'](_0x1cc516)['forEach'](_0x3b6d2f=>{const _0x1d94c3=_0x44ebdc;this[_0x1d94c3(0x126)][_0x3b6d2f]=_0x1cc516[_0x3b6d2f];}),this['refreshParticles'](_0x29d67e);}['applyViewerParameters'](_0x45f058){Object['keys'](_0x45f058)['forEach'](_0x48caf1=>{this['viewerParameters'][_0x48caf1]=_0x45f058[_0x48caf1];}),this['refreshParticles'](![]);}['destroy'](){const _0x229590=_0x34c216;clearTimeout(this[_0x229590(0x190)]),this[_0x229590(0x173)][_0x229590(0x207)](),Object[_0x229590(0x1be)](this['particlesComputing']['windTextures'])[_0x229590(0x13b)](_0x249d2f=>{this['particlesComputing']['windTextures'][_0x249d2f]['destroy']();}),this[_0x229590(0x180)]['textures']['colorTable']['destroy'](),Object[_0x229590(0x1be)](this['particlesRendering']['framebuffers'])[_0x229590(0x13b)](_0x18f3c2=>{this['particlesRendering']['framebuffers'][_0x18f3c2]['destroy']();});for(const _0x1b4a9a in this){delete this[_0x1b4a9a];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x39af2f={}){_0x39af2f={...DEF_OPTIONS,..._0x39af2f},super(_0x39af2f),this['_setOptionsHook'](_0x39af2f);}get['layer'](){const _0x2da195=_0x34c216;return this[_0x2da195(0x1e3)];}get['data'](){const _0x539102=_0x34c216;return this[_0x539102(0x1f1)];}set[_0x34c216(0x200)](_0x351db0){const _0x8b33c1=_0x34c216;this[_0x8b33c1(0x1b2)](_0x351db0);}get[_0x34c216(0x155)](){const _0x388d56=_0x34c216;return this[_0x388d56(0x126)]['colors'];}set['colors'](_0x2f6ff0){const _0x1ab815=_0x34c216;this['options'][_0x1ab815(0x155)]=_0x2f6ff0,this[_0x1ab815(0x210)]&&this['particleSystem']['setOptions']({'colors':_0x2f6ff0}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x27bf7f=_0x34c216;this['scene']=this['_map'][_0x27bf7f(0x15a)],this[_0x27bf7f(0x19b)]=this[_0x27bf7f(0x147)]['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x27bf7f(0x15a)]['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x27bf7f(0x206))](Cesium$1[_0x27bf7f(0x1a0)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x27bf7f(0x16f)](_0x27bf7f(0x182),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x27bf7f(0x131)],this[_0x27bf7f(0x1d5)],this),this[_0x27bf7f(0x147)]['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x27bf7f(0x159)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x27bf7f(0x1f9)],this),this[_0x27bf7f(0x1f1)]&&this['setData'](this[_0x27bf7f(0x1f1)]);}['_removedHook'](){const _0x36ed8b=_0x34c216;window['removeEventListener']('resize',this[_0x36ed8b(0x182)]),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x36ed8b(0x192)],this['_onMapWhellEvent'],this),this[_0x36ed8b(0x147)][_0x36ed8b(0x1e5)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x36ed8b(0x1d0)]['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x36ed8b(0x1e5)](mars3d__namespace[_0x36ed8b(0x1d0)][_0x36ed8b(0x120)],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map']['scene'][_0x36ed8b(0x1e3)]['remove'](this['primitives']);}['resize'](){const _0x331408=_0x34c216;if(!this['show']||!this['particleSystem'])return;this[_0x331408(0x1e3)]['show']=![],this[_0x331408(0x1e3)]['removeAll'](),this['_map'][_0x331408(0x1f2)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}[_0x34c216(0x189)](_0x251a5e){const _0x3f8637=_0x34c216;this['particleSystem'][_0x3f8637(0x185)](this['scene']['context']),this['addPrimitives'](),this['primitives'][_0x3f8637(0x127)]=!![];}['_onMapWhellEvent'](_0x4da9e4){const _0x4e5e56=_0x34c216;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x4e5e56(0x210)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x36170c){const _0x23cac7=_0x34c216;this[_0x23cac7(0x12f)]=!![];}['_onMouseMoveEvent'](_0xd4139b){const _0x3ff8fb=_0x34c216;if(!this[_0x3ff8fb(0x127)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x3ff8fb(0x172)]=!![]);}['_onMouseUpEvent'](_0x4e51a2){const _0x5b0f7d=_0x34c216;if(!this['show']||!this[_0x5b0f7d(0x210)])return;this['mouse_down']&&this['mouse_move']&&this[_0x5b0f7d(0x176)](),this['primitives']['show']=!![],this[_0x5b0f7d(0x12f)]=![],this[_0x5b0f7d(0x172)]=![];}['redraw'](){const _0x2360f3=_0x34c216;if(!this['_map']||!this[_0x2360f3(0x127)])return;this['updateViewerParameters'](),this['particleSystem'][_0x2360f3(0x1a3)](this[_0x2360f3(0x1a9)]),this[_0x2360f3(0x1e3)]['show']=!![];}['setData'](_0xe815a5){const _0x307429=_0x34c216;this['_data']=_0xe815a5,this[_0x307429(0x210)]&&this['particleSystem'][_0x307429(0x213)](),this[_0x307429(0x210)]=new ParticleSystem(this['scene']['context'],_0xe815a5,this[_0x307429(0x1b7)](),this['viewerParameters']),this['addPrimitives']();}[_0x34c216(0x17f)](_0xf4de88,_0x45e80d){const _0x5141d6=_0x34c216;if(_0xf4de88)for(const _0x32b138 in _0xf4de88){this[_0x32b138]=_0xf4de88[_0x32b138];}this[_0x5141d6(0x210)]&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x1ce3ba=_0x34c216,_0x4af264=Math[_0x1ce3ba(0x1de)](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x4af264*_0x4af264,{'particlesTextureSize':_0x4af264,'maxParticles':this[_0x1ce3ba(0x16d)],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x1ce3ba(0x18e)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x1ce3ba(0x1bb)],'lineWidth':this[_0x1ce3ba(0x1a4)],'colors':this['colors']};}['addPrimitives'](){const _0x158c28=_0x34c216;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x158c28(0x16c)]),this[_0x158c28(0x1e3)]['add'](this['particleSystem'][_0x158c28(0x173)]['primitives']['updateSpeed']),this[_0x158c28(0x1e3)]['add'](this['particleSystem']['particlesComputing']['primitives']['updatePosition']),this[_0x158c28(0x1e3)]['add'](this[_0x158c28(0x210)]['particlesComputing'][_0x158c28(0x1e3)]['postProcessingPosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this[_0x158c28(0x1e3)]['add'](this['particleSystem'][_0x158c28(0x180)]['primitives'][_0x158c28(0x15e)]),this['primitives']['add'](this['particleSystem'][_0x158c28(0x180)][_0x158c28(0x1e3)][_0x158c28(0x141)]),this['primitives']['add'](this['particleSystem'][_0x158c28(0x180)]['primitives']['screen']);}['updateViewerParameters'](){const _0x16af69=_0x34c216;let _0x2d43d2=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x2d43d2){const _0xc2287e=this['_map']['getExtent']();_0x2d43d2=Cesium$1[_0x16af69(0x19e)][_0x16af69(0x161)](_0xc2287e[_0x16af69(0x199)],_0xc2287e['ymin'],_0xc2287e[_0x16af69(0x1cf)],_0xc2287e[_0x16af69(0x12d)]);}const _0x4c5da5=Util['viewRectangleToLonLatRange'](_0x2d43d2);this['viewerParameters']['lonRange']['x']=_0x4c5da5['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x4c5da5[_0x16af69(0x1e7)]['max'],this['viewerParameters']['latRange']['x']=_0x4c5da5['lat']['min'],this['viewerParameters']['latRange']['y']=_0x4c5da5['lat']['max'];const _0x7bc2d=this['camera']['getPixelSize'](this[_0x16af69(0x19f)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x7bc2d>0x0&&(this['viewerParameters'][_0x16af69(0x14b)]=_0x7bc2d);}}mars3d__namespace[_0x34c216(0x1ca)]['register'](_0x34c216(0x202),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0xe553b3=_0x34c216;this['lng']=null,this[_0xe553b3(0x154)]=null,this['tlng']=null,this['tlat']=null,this['age']=null,this[_0xe553b3(0x194)]=null;}['destroy'](){for(const _0x3651d3 in this){delete this[_0x3651d3];}}}class CanvasWindField{constructor(_0x1ed79e){this['setOptions'](_0x1ed79e);}get['speedRate'](){const _0x30f410=_0x34c216;return this[_0x30f410(0x16a)];}set['speedRate'](_0x2298aa){const _0x2e362a=_0x34c216;this['_speedRate']=(0x64-(_0x2298aa>0x63?0x63:_0x2298aa))*0x64,this[_0x2e362a(0x197)]=[(this['xmax']-this['xmin'])/this[_0x2e362a(0x16a)],(this[_0x2e362a(0x12d)]-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x280c6f){this['_maxAge']=_0x280c6f;}[_0x34c216(0x169)](_0xfaa12){const _0x138f7d=_0x34c216;this['options']=_0xfaa12,this['maxAge']=_0xfaa12['maxAge']||0x78,this['speedRate']=_0xfaa12['speedRate']||0x32,this['particles']=[];const _0x22c125=_0xfaa12['particlesNumber']||0x1000;for(let _0x454a6d=0x0;_0x454a6d<_0x22c125;_0x454a6d++){const _0x436137=this['_randomParticle'](new CanvasParticle());this[_0x138f7d(0x1cc)][_0x138f7d(0x1a6)](_0x436137);}}['setDate'](_0x8f757e){const _0x5e4d4b=_0x34c216;this['rows']=_0x8f757e['rows'],this['cols']=_0x8f757e[_0x5e4d4b(0x1f7)],this['xmin']=_0x8f757e[_0x5e4d4b(0x199)],this[_0x5e4d4b(0x1cf)]=_0x8f757e[_0x5e4d4b(0x1cf)],this['ymin']=_0x8f757e['ymin'],this[_0x5e4d4b(0x12d)]=_0x8f757e['ymax'],this['grid']=[];const _0x464695=_0x8f757e[_0x5e4d4b(0x1f0)],_0x5d939c=_0x8f757e['vdata'];let _0x5b2ca3=![];_0x464695['length']===this[_0x5e4d4b(0x1ea)]&&_0x464695[0x0][_0x5e4d4b(0x153)]===this[_0x5e4d4b(0x1f7)]&&(_0x5b2ca3=!![]);let _0x529e4a=0x0,_0x4b55fa=null,_0x334ac5=null;for(let _0x46804f=0x0;_0x46804f<this[_0x5e4d4b(0x1ea)];_0x46804f++){_0x4b55fa=[];for(let _0xbeb74=0x0;_0xbeb74<this['cols'];_0xbeb74++,_0x529e4a++){_0x5b2ca3?_0x334ac5=this[_0x5e4d4b(0x142)](_0x464695[_0x46804f][_0xbeb74],_0x5d939c[_0x46804f][_0xbeb74]):_0x334ac5=this[_0x5e4d4b(0x142)](_0x464695[_0x529e4a],_0x5d939c[_0x529e4a]),_0x4b55fa[_0x5e4d4b(0x1a6)](_0x334ac5);}this['grid'][_0x5e4d4b(0x1a6)](_0x4b55fa);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x4fcba8=_0x34c216;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x4fcba8(0x1dd)],delete this['ymax'],delete this['grid'],delete this['particles'];}['toGridXY'](_0x3c1115,_0x9b5d2a){const _0x4494ce=_0x34c216,_0x23607e=(_0x3c1115-this[_0x4494ce(0x199)])/(this['xmax']-this[_0x4494ce(0x199)])*(this['cols']-0x1),_0x39c08c=(this['ymax']-_0x9b5d2a)/(this[_0x4494ce(0x12d)]-this['ymin'])*(this[_0x4494ce(0x1ea)]-0x1);return[_0x23607e,_0x39c08c];}['getUVByXY'](_0x57ea78,_0x30f85c){const _0x545a21=_0x34c216;if(_0x57ea78<0x0||_0x57ea78>=this['cols']||_0x30f85c>=this['rows'])return[0x0,0x0,0x0];const _0x407767=Math['floor'](_0x57ea78),_0x5aabb3=Math['floor'](_0x30f85c);if(_0x407767===_0x57ea78&&_0x5aabb3===_0x30f85c)return this[_0x545a21(0x1e1)][_0x30f85c][_0x57ea78];const _0x28b2e2=_0x407767+0x1,_0x59c597=_0x5aabb3+0x1,_0x2c2a07=this['getUVByXY'](_0x407767,_0x5aabb3),_0x9444a3=this['getUVByXY'](_0x28b2e2,_0x5aabb3),_0x190070=this['getUVByXY'](_0x407767,_0x59c597),_0xadb7ca=this['getUVByXY'](_0x28b2e2,_0x59c597);let _0x1b92aa=null;try{_0x1b92aa=this['_bilinearInterpolation'](_0x57ea78-_0x407767,_0x30f85c-_0x5aabb3,_0x2c2a07,_0x9444a3,_0x190070,_0xadb7ca);}catch(_0x1d2101){console['log'](_0x57ea78,_0x30f85c);}return _0x1b92aa;}[_0x34c216(0x122)](_0x243737,_0x594e81,_0x19512a,_0x52b645,_0x326baa,_0x316f61){const _0x18d0f5=0x1-_0x243737,_0x84fce=0x1-_0x594e81,_0x16f60c=_0x18d0f5*_0x84fce,_0x4c677a=_0x243737*_0x84fce,_0x5624b9=_0x18d0f5*_0x594e81,_0x17c0f9=_0x243737*_0x594e81,_0x339a3c=_0x19512a[0x0]*_0x16f60c+_0x52b645[0x0]*_0x4c677a+_0x326baa[0x0]*_0x5624b9+_0x316f61[0x0]*_0x17c0f9,_0x67da6f=_0x19512a[0x1]*_0x16f60c+_0x52b645[0x1]*_0x4c677a+_0x326baa[0x1]*_0x5624b9+_0x316f61[0x1]*_0x17c0f9;return this['_calcUV'](_0x339a3c,_0x67da6f);}['_calcUV'](_0x5c0b69,_0x1d5a8e){return[+_0x5c0b69,+_0x1d5a8e,Math['sqrt'](_0x5c0b69*_0x5c0b69+_0x1d5a8e*_0x1d5a8e)];}['getUVByPoint'](_0x58a558,_0x54c46a){const _0x1b9eab=_0x34c216;if(!this[_0x1b9eab(0x1d1)](_0x58a558,_0x54c46a))return null;const _0x470bd1=this['toGridXY'](_0x58a558,_0x54c46a),_0x29907c=this[_0x1b9eab(0x1d2)](_0x470bd1[0x0],_0x470bd1[0x1]);return _0x29907c;}['isInExtent'](_0x150b88,_0x8f1aaa){const _0x268d78=_0x34c216;return _0x150b88>=this['xmin']&&_0x150b88<=this['xmax']&&_0x8f1aaa>=this['ymin']&&_0x8f1aaa<=this[_0x268d78(0x12d)]?!![]:![];}['getRandomLatLng'](){const _0x990b83=fRandomByfloat(this['xmin'],this['xmax']),_0x2e7677=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x2e7677,'lng':_0x990b83};}['getParticles'](){const _0x580c1a=_0x34c216;let _0x32019b,_0x11cd9d,_0x163993;for(let _0xa89f15=0x0,_0xa197c=this[_0x580c1a(0x1cc)][_0x580c1a(0x153)];_0xa89f15<_0xa197c;_0xa89f15++){let _0x360b96=this[_0x580c1a(0x1cc)][_0xa89f15];_0x360b96['age']<=0x0&&(_0x360b96=this['_randomParticle'](_0x360b96));if(_0x360b96[_0x580c1a(0x198)]>0x0){const _0x1140c0=_0x360b96[_0x580c1a(0x209)],_0x446e0c=_0x360b96[_0x580c1a(0x181)];_0x163993=this[_0x580c1a(0x1c9)](_0x1140c0,_0x446e0c),_0x163993?(_0x32019b=_0x1140c0+this[_0x580c1a(0x197)][0x0]*_0x163993[0x0],_0x11cd9d=_0x446e0c+this['_calc_speedRate'][0x1]*_0x163993[0x1],_0x360b96['lng']=_0x1140c0,_0x360b96['lat']=_0x446e0c,_0x360b96['tlng']=_0x32019b,_0x360b96['tlat']=_0x11cd9d,_0x360b96['speed']=_0x163993[0x2],_0x360b96['age']--):_0x360b96['age']=0x0;}}return this['particles'];}[_0x34c216(0x1b1)](_0x49d5f4){const _0x342c01=_0x34c216;let _0x4dadba,_0x64452c;for(let _0x38d3c6=0x0;_0x38d3c6<0x1e;_0x38d3c6++){_0x4dadba=this[_0x342c01(0x1e8)](),_0x64452c=this[_0x342c01(0x1c9)](_0x4dadba['lng'],_0x4dadba[_0x342c01(0x154)]);if(_0x64452c&&_0x64452c[0x2]>0x0)break;}if(!_0x64452c)return _0x49d5f4;const _0x5c9319=_0x4dadba[_0x342c01(0x16e)]+this['_calc_speedRate'][0x0]*_0x64452c[0x0],_0x2b1c71=_0x4dadba['lat']+this[_0x342c01(0x197)][0x1]*_0x64452c[0x1];return _0x49d5f4['lng']=_0x4dadba['lng'],_0x49d5f4['lat']=_0x4dadba[_0x342c01(0x154)],_0x49d5f4['tlng']=_0x5c9319,_0x49d5f4[_0x342c01(0x181)]=_0x2b1c71,_0x49d5f4['age']=Math[_0x342c01(0x144)](Math['random']()*this[_0x342c01(0x1c2)]),_0x49d5f4[_0x342c01(0x194)]=_0x64452c[0x2],_0x49d5f4;}[_0x34c216(0x213)](){for(const _0xb60c7e in this){delete this[_0xb60c7e];}}}function _0x5876(_0x3a225e,_0x470894){const _0x4cc5aa=_0x4cc5();return _0x5876=function(_0x5876be,_0x2eba64){_0x5876be=_0x5876be-0x11c;let _0x4177d7=_0x4cc5aa[_0x5876be];return _0x4177d7;},_0x5876(_0x3a225e,_0x470894);}function fRandomByfloat(_0x20dbec,_0x433efd){const _0x9e1a3d=_0x34c216;return _0x20dbec+Math[_0x9e1a3d(0x18f)]()*(_0x433efd-_0x20dbec);}function _0x4cc5(){const _0x5d864f=['windTextures','mod','1790110rNttXs','_removedHook','commandToExecute','ymin','ceil','destination-in','strokeStyle','grid','outputTexture','primitives','currentParticlesSpeed','off','_updateIng','lon','getRandomLatLng','left','rows','globalAlpha','preExecute','depthTexture','nextParticlesSpeed','drawingBufferHeight','udata','_data','once','none','Draw','nextParticlesPosition','9524FOcAKE','cols','maxParticles','_onMouseMoveEvent','SCENE3D','framebuffer','source','defineProperty','ellipsoid','THREE_PI_OVER_TWO','data','OPAQUE','wind','dropRateBump','rawRenderState','_addedHook','BoundingSphere','destroyParticlesTextures','canvasContext','tlng','destroyObject','depthTest','all','CanvasWindField','GeometryAttribute','defined','particleSystem','postProcessingSpeed','primitiveType','destroy','1385811oVwzJA','ComponentDatatype','createTexture','clearCommand','createParticlesTextures','createRenderingTextures','createFramebuffer','737044MquEcC','mouseMove','clientWidth','_bilinearInterpolation','zIndex','TWO_PI','NEAREST','options','show','TRIANGLES','context','style','currentTrails','ClearCommand','ymax','fillRect','mouse_down','windData','mouseDown','PixelFormat','refreshParticles','color','clientHeight','54krsaWU','SceneMode','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','clear','animateFrame','forEach','Cesium','Math','Texture','stroke','init','trails','_calcUV','_pointerEvents','round','Color','mode','_map','frameTime','postProcessingPosition','159052rfQyYl','pixelSize','update','umax','ALWAYS','_showHook','max','east','height','length','lat','colors','visibility','vertexArray','min','_onMouseUpEvent','scene','blue','geometry','_tomap','segments','autoClear','fromGeometry','fromDegrees','nextTrailsColor','vdata','width','get','currentTrailsColor','onmessage','particlesTextureSize','setOptions','_speedRate','create','getWind','particlesNumber','lng','addEventListener','vertexShaderSource','_createCanvas','mouse_move','particlesComputing','lonRange','currentParticlesPosition','redraw','windField','CanvasWindLayer','FLOAT','Geometry','nextTrails','fill','commandList','fragmentShaderSource','_setOptionsHook','particlesRendering','tlat','resize','ShaderSource','speedRate','canvasResize','hidden','postMessage','randomizeParticles','_onMap_preRenderEvent','4117540ctLpbj','getParticles','viewport','setGeometry','fadeOpacity','random','canrefresh','isPointVisible','wheel','pointerEvents','speed','west','dimensions','_calc_speedRate','age','xmin','canvas','camera','getContext','Appearance','Rectangle','globeBoundingSphere','Cartesian3','commandType','array','applyViewerParameters','lineWidth','createRawRenderState','push','getFullscreenQuad','8PvMdXI','viewerParameters','lev','requestAnimationFrame','_onMapWhellEvent','Compute','1430ZoFONN','initWorker','refreshTimer','_randomParticle','setData','particlesTextures','_colorRamp','bindEvent','toDegrees','getOptions','depthMask','PixelDatatype','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','speedFactor','removeEventListener','LUMINANCE','keys','0px','EllipsoidalOccluder','sqrt','maxAge','latRange','textures','framebuffers','fixedHeight','fromCssColorString','216285HTGwjH','getUVByPoint','LayerUtil','DepthFunction','particles','default','UNSIGNED_BYTE','xmax','EventType','isInExtent','getUVByXY','now','DISABLE_GL_POSITION_LOG_DEPTH','_onMouseDownEvent','LINEAR','worker'];_0x4cc5=function(){return _0x5d864f;};return _0x4cc5();}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x411ade={}){const _0x3060a4=_0x34c216;super(_0x411ade),this['_setOptionsHook'](_0x411ade),this[_0x3060a4(0x19a)]=null,_0x411ade['colors']&&_0x411ade['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x411ade));}['_setOptionsHook'](_0x5abf8c,_0x52b76e){const _0x5a22cc=_0x34c216;this[_0x5a22cc(0x148)]=0x3e8/(_0x5abf8c['frameRate']||0xa),this[_0x5a22cc(0x143)]=this['options']['pointerEvents']??![],this['color']=_0x5abf8c[_0x5a22cc(0x134)]||'#ffffff',this['lineWidth']=_0x5abf8c['lineWidth']||0x1,this[_0x5a22cc(0x1c6)]=_0x5abf8c[_0x5a22cc(0x1c6)]??0x0,this['reverseY']=_0x5abf8c['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x5abf8c);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x47e2cc=_0x34c216;return this['_map']['scene']['canvas'][_0x47e2cc(0x121)];}get['canvasHeight'](){const _0x383242=_0x34c216;return this['_map']['scene'][_0x383242(0x19a)]['clientHeight'];}get[_0x34c216(0x193)](){return this['_pointerEvents'];}set[_0x34c216(0x193)](_0x22855e){const _0x28fe6f=_0x34c216;this['_pointerEvents']=_0x22855e;if(!this['canvas'])return;_0x22855e?this['canvas']['style']['pointer-events']=_0x28fe6f(0x20c):this['canvas']['style']['pointer-events']=_0x28fe6f(0x1f3);}get[_0x34c216(0x16d)](){return this['options']['particlesNumber'];}set[_0x34c216(0x16d)](_0xe31322){const _0x94c2a9=_0x34c216;this[_0x94c2a9(0x126)]['particlesNumber']=_0xe31322,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x3738ad=_0x34c216;return this[_0x3738ad(0x126)][_0x3738ad(0x184)];}set[_0x34c216(0x184)](_0x137ad5){const _0x204a7c=_0x34c216;this['options']['speedRate']=_0x137ad5,this['windField']&&(this[_0x204a7c(0x177)][_0x204a7c(0x184)]=_0x137ad5);}get[_0x34c216(0x1c2)](){const _0x5e087a=_0x34c216;return this[_0x5e087a(0x126)]['maxAge'];}set['maxAge'](_0x4b0327){const _0x5eb9b6=_0x34c216;this['options'][_0x5eb9b6(0x1c2)]=_0x4b0327,this[_0x5eb9b6(0x177)]&&(this['windField']['maxAge']=_0x4b0327);}get['data'](){return this['windData'];}set[_0x34c216(0x200)](_0x4b150e){this['setData'](_0x4b150e);}[_0x34c216(0x14f)](_0x1cdaef){const _0x110c91=_0x34c216;_0x1cdaef?this[_0x110c91(0x205)]():(this[_0x110c91(0x130)]&&(this['options'][_0x110c91(0x200)]=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x4cfc40=_0x34c216;this['options'][_0x4cfc40(0x1d7)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x50415b=_0x34c216;this[_0x50415b(0x19a)]=this[_0x50415b(0x171)](),this['canvasContext']=this['canvas'][_0x50415b(0x19c)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x50415b(0x1b2)](this[_0x50415b(0x126)]['data']);}[_0x34c216(0x1db)](){const _0x58aa90=_0x34c216;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this[_0x58aa90(0x19a)]);}['_createCanvas'](){const _0x2399df=_0x34c216,_0x20d5c9=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map']['container']);return _0x20d5c9['style']['position']='absolute',_0x20d5c9['style']['top']=_0x2399df(0x1bf),_0x20d5c9[_0x2399df(0x12a)][_0x2399df(0x1e9)]='0px',_0x20d5c9['style'][_0x2399df(0x164)]=this['_map'][_0x2399df(0x15a)][_0x2399df(0x19a)]['clientWidth']+'px',_0x20d5c9['style'][_0x2399df(0x152)]=this['_map']['scene']['canvas']['clientHeight']+'px',_0x20d5c9['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x20d5c9['style']['zIndex']=this['options'][_0x2399df(0x123)]??0x9,_0x20d5c9[_0x2399df(0x164)]=this[_0x2399df(0x147)]['scene']['canvas']['clientWidth'],_0x20d5c9['height']=this['_map'][_0x2399df(0x15a)]['canvas'][_0x2399df(0x135)],_0x20d5c9;}['resize'](){const _0x69d07b=_0x34c216;this['canvas']&&(this['canvas']['style']['width']=this[_0x69d07b(0x147)]['scene']['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this['_map']['scene'][_0x69d07b(0x19a)]['clientHeight']+'px',this[_0x69d07b(0x19a)]['width']=this[_0x69d07b(0x147)]['scene']['canvas'][_0x69d07b(0x121)],this[_0x69d07b(0x19a)]['height']=this[_0x69d07b(0x147)]['scene']['canvas']['clientHeight']);}[_0x34c216(0x1b5)](){const _0x310c2b=_0x34c216,_0x28c4ea=this;let _0x3472ee=Date['now']();(function _0x32bfdd(){const _0x70082a=_0x5876;_0x28c4ea[_0x70082a(0x13a)]=window[_0x70082a(0x1ab)](_0x32bfdd);if(_0x28c4ea['show']&&_0x28c4ea['windField']){const _0x208e77=Date[_0x70082a(0x1d3)](),_0x25b361=_0x208e77-_0x3472ee;_0x25b361>_0x28c4ea['frameTime']&&(_0x3472ee=_0x208e77-_0x25b361%_0x28c4ea['frameTime'],_0x28c4ea[_0x70082a(0x14c)]());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this[_0x310c2b(0x12f)]=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x310c2b(0x1ac)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x310c2b(0x147)]['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x310c2b(0x159)],this)));}['unbindEvent'](){const _0x290636=_0x34c216;window['cancelAnimationFrame'](this[_0x290636(0x13a)]),delete this['animateFrame'],window[_0x290636(0x1bc)](_0x290636(0x182),this[_0x290636(0x182)]),this[_0x290636(0x126)]['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x290636(0x131)],this['_onMouseDownEvent'],this),this[_0x290636(0x147)]['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x290636(0x147)][_0x290636(0x1e5)](mars3d__namespace[_0x290636(0x1d0)][_0x290636(0x120)],this['_onMouseMoveEvent'],this));}[_0x34c216(0x1ac)](_0x367aa6){const _0x51fd00=_0x34c216;clearTimeout(this['refreshTimer']);if(!this[_0x51fd00(0x127)]||!this['canvas'])return;this['canvas'][_0x51fd00(0x12a)]['visibility']='hidden',this[_0x51fd00(0x1b0)]=setTimeout(()=>{if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x1bec7c){const _0x128824=_0x34c216;this[_0x128824(0x12f)]=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x1fcad5){const _0x22f88a=_0x34c216;if(!this[_0x22f88a(0x127)]||!this['canvas'])return;this[_0x22f88a(0x12f)]&&(this['canvas']['style'][_0x22f88a(0x156)]=_0x22f88a(0x186),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x57d08a){const _0x4056fe=_0x34c216;if(!this['show']||!this['canvas'])return;this['_map'][_0x4056fe(0x1e5)](mars3d__namespace['EventType'][_0x4056fe(0x120)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x4056fe(0x19a)]['style'][_0x4056fe(0x156)]='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x24c8f1){const _0x68080a=_0x34c216;this['clear'](),this['windData']=_0x24c8f1,this['windField']['setDate'](_0x24c8f1),this[_0x68080a(0x176)]();}['redraw'](){const _0x3960d3=_0x34c216;if(!this['show'])return;this['windField']['setOptions'](this['options']),this[_0x3960d3(0x14c)]();}['update'](){const _0x4ade39=_0x34c216;if(this['_updateIng'])return;this[_0x4ade39(0x1e6)]=!![];if(this['worker'])this['windField']['update']();else{const _0x5ae9bc=this['windField'][_0x4ade39(0x18b)]();this['_drawLines'](_0x5ae9bc);}this['_updateIng']=![];}['_drawLines'](_0x4e4d34){const _0x18bf0a=_0x34c216;this['canvasContext']['globalCompositeOperation']=_0x18bf0a(0x1df),this[_0x18bf0a(0x208)][_0x18bf0a(0x12e)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext'][_0x18bf0a(0x1eb)]=0.9;const _0x20636c=this['_map'][_0x18bf0a(0x15a)][_0x18bf0a(0x146)]!==Cesium[_0x18bf0a(0x137)]['SCENE3D'],_0x3c9de2=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x1bf7b9=0x0,_0x41400f=_0x4e4d34[_0x18bf0a(0x153)];_0x1bf7b9<_0x41400f;_0x1bf7b9++){const _0x1544d5=_0x4e4d34[_0x1bf7b9],_0x4e77a7=this[_0x18bf0a(0x15d)](_0x1544d5['lng'],_0x1544d5[_0x18bf0a(0x154)],_0x1544d5),_0x3c70b3=this['_tomap'](_0x1544d5['tlng'],_0x1544d5[_0x18bf0a(0x181)],_0x1544d5);if(!_0x4e77a7||!_0x3c70b3)continue;if(_0x20636c&&Math['abs'](_0x4e77a7[0x0]-_0x3c70b3[0x0])>=_0x3c9de2)continue;this['canvasContext']['beginPath'](),this[_0x18bf0a(0x208)][_0x18bf0a(0x1a4)]=this[_0x18bf0a(0x1a4)],this[_0x18bf0a(0x208)][_0x18bf0a(0x1e0)]=this[_0x18bf0a(0x1b4)]['getColor'](_0x1544d5[_0x18bf0a(0x194)]),this[_0x18bf0a(0x208)]['moveTo'](_0x4e77a7[0x0],_0x4e77a7[0x1]),this['canvasContext']['lineTo'](_0x3c70b3[0x0],_0x3c70b3[0x1]),this['canvasContext'][_0x18bf0a(0x13f)]();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x18bf0a(0x1e0)]=this['color'];for(let _0x2dcb37=0x0,_0x171b7d=_0x4e4d34['length'];_0x2dcb37<_0x171b7d;_0x2dcb37++){const _0x30ab46=_0x4e4d34[_0x2dcb37],_0x3c1bf0=this['_tomap'](_0x30ab46['lng'],_0x30ab46[_0x18bf0a(0x154)],_0x30ab46),_0x2b0f0c=this[_0x18bf0a(0x15d)](_0x30ab46['tlng'],_0x30ab46[_0x18bf0a(0x181)],_0x30ab46);if(!_0x3c1bf0||!_0x2b0f0c)continue;if(_0x20636c&&Math['abs'](_0x3c1bf0[0x0]-_0x2b0f0c[0x0])>=_0x3c9de2)continue;this['canvasContext']['moveTo'](_0x3c1bf0[0x0],_0x3c1bf0[0x1]),this[_0x18bf0a(0x208)]['lineTo'](_0x2b0f0c[0x0],_0x2b0f0c[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x275d3e,_0x1dacaa,_0x496897){const _0xe84918=_0x34c216,_0x1d7c83=Cesium['Cartesian3']['fromDegrees'](_0x275d3e,_0x1dacaa,this['fixedHeight']),_0x1ce89b=this['_map']['scene'];if(_0x1ce89b[_0xe84918(0x146)]===Cesium['SceneMode']['SCENE3D']){const _0x1e80b6=new Cesium[(_0xe84918(0x1c0))](_0x1ce89b['globe'][_0xe84918(0x1fe)],_0x1ce89b['camera']['positionWC']),_0x1d2e4e=_0x1e80b6[_0xe84918(0x191)](_0x1d7c83);if(!_0x1d2e4e)return _0x496897['age']=0x0,null;}const _0x8af7ec=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x1d7c83);return _0x8af7ec?[_0x8af7ec['x'],_0x8af7ec['y']]:null;}['clear'](){const _0x2edafe=_0x34c216;this['windField'][_0x2edafe(0x139)](),delete this['windData'];}[_0x34c216(0x1af)](){const _0xb27642=_0x34c216;this['worker']=new Worker(this['options']['worker']),this['worker'][_0xb27642(0x167)]=_0x49820e=>{this['_drawLines'](_0x49820e['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x31bc29=>{const _0x1f0005=_0xb27642;this['worker'][_0x1f0005(0x187)]({'type':_0x1f0005(0x140),'options':_0x31bc29});},'setOptions':_0x1772f9=>{const _0x4f16dd=_0xb27642;this['worker']['postMessage']({'type':_0x4f16dd(0x169),'options':_0x1772f9});},'setDate':_0x31abcc=>{const _0x33ed70=_0xb27642;this[_0x33ed70(0x1d7)]['postMessage']({'type':'setDate','data':_0x31abcc});},'update':()=>{const _0x120dd6=_0xb27642;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':_0x120dd6(0x14c)});},'clear':()=>{const _0x528d0d=_0xb27642;this[_0x528d0d(0x1d7)]['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer'][_0x34c216(0x178)]=CanvasWindLayer,mars3d__namespace[_0x34c216(0x20d)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x34c216(0x1fd)](exports,'__esModule',{'value':!![]});
}));
