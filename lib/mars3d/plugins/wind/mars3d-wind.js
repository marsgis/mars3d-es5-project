/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.2
 * 编译日期：2023-08-20 20:28:56
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x4301e1=_0x5220;(function(_0xe6bfd6,_0x16bfc3){const _0x1eb6b3=_0x5220,_0x3fe961=_0xe6bfd6();while(!![]){try{const _0x1f32d1=parseInt(_0x1eb6b3(0x1f1))/0x1+parseInt(_0x1eb6b3(0x27e))/0x2*(parseInt(_0x1eb6b3(0x1d1))/0x3)+-parseInt(_0x1eb6b3(0x1c6))/0x4*(parseInt(_0x1eb6b3(0x250))/0x5)+parseInt(_0x1eb6b3(0x1b3))/0x6+parseInt(_0x1eb6b3(0x1e7))/0x7*(-parseInt(_0x1eb6b3(0x263))/0x8)+parseInt(_0x1eb6b3(0x1c7))/0x9*(parseInt(_0x1eb6b3(0x25c))/0xa)+parseInt(_0x1eb6b3(0x218))/0xb;if(_0x1f32d1===_0x16bfc3)break;else _0x3fe961['push'](_0x3fe961['shift']());}catch(_0x2b50bd){_0x3fe961['push'](_0x3fe961['shift']());}}}(_0x1ff2,0xd1086));function _interopNamespace(_0x35c477){const _0x52c792=_0x5220;if(_0x35c477&&_0x35c477['__esModule'])return _0x35c477;var _0x4131c1=Object[_0x52c792(0x25a)](null);return _0x35c477&&Object[_0x52c792(0x1cc)](_0x35c477)['forEach'](function(_0x410b95){if(_0x410b95!=='default'){var _0x411645=Object['getOwnPropertyDescriptor'](_0x35c477,_0x410b95);Object['defineProperty'](_0x4131c1,_0x410b95,_0x411645['get']?_0x411645:{'enumerable':!![],'get':function(){return _0x35c477[_0x410b95];}});}}),_0x4131c1['default']=_0x35c477,_0x4131c1;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x4a6a97,_0x479810){const _0x139625=_0x4a6a97*Math['cos'](Cesium$7['Math']['toRadians'](_0x479810));return _0x139625;}function getV(_0x19a0ef,_0x2f9d2c){const _0x4b79a8=_0x5220,_0x4acf18=_0x19a0ef*Math['sin'](Cesium$7['Math'][_0x4b79a8(0x1c4)](_0x2f9d2c));return _0x4acf18;}function _0x1ff2(){const _0x4db93f=['maxAge','textures','_calc_speedRate','mouse_down','_mountedHook','fromGeometry','ALWAYS','mouseHidden','show','canvasHeight','lng','min','now','redraw','_addedHook','19266764SLKsLK','#ffffff','color','commandToExecute','particlesTextures','age','clampToLatitudeRange','_bilinearInterpolation','rgb(206,255,255)','mouse_move','fixedHeight','clientHeight','addPrimitives','toGridXY','_showHook','beginPath','positionWC','TextureMinificationFilter','framebuffer','mouseUp','createParticlesTextures','TextureMagnificationFilter','clearCommand','geometry','blue','ClearCommand','WindUtil','getUVByPoint','_map','destroyParticlesTextures','data','random','FLOAT','wheel','camera','_randomParticle','floor','lonRange','add','uniformMap','destroy','context','register','bindEvent','SCENE3D','_colorRamp','colors','Cesium','drawingBufferHeight','_maxAge','updateViewerParameters','drawingBufferWidth','mouseMove','SceneTransforms','windField','nextTrailsColor','6145LVgDnI','preRender','update','canvas','vertexArray','PrimitiveType','off','EventType','none','particlesWind','create','grid','2680MMrnDI','particleSystem','windData','sqrt','clientWidth','ComponentDatatype','lev','2396672DvCqyb','toDegrees','Cartesian2','moveTo','_createCanvas','setOptions','destroyObject','options','visibility','primitives','particlesComputing','pow','attributeLocations','TRIANGLES','vdata','refreshParticles','abs','refreshTimer','ShaderSource','Math','ymin','lon','umax','_tomap','shaderProgram','cancelAnimationFrame','wgs84ToWindowCoordinates','12dbdAkP','dimensions','_pointerEvents','getFullscreenQuad','forEach','visible','setDate','STATIC_DRAW','createTexture','_onMap_preRenderEvent','LayerUtil','green','getUVByXY','onmessage','postProcessingSpeed','Cartesian3','speedRate','ymax','xmin','getContext','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','_onMapWhellEvent','_onMouseMoveEvent','container','zIndex','outputTexture','THREE_PI_OVER_TWO','updatePosition','lineTo','lineWidth','VertexArray','speedFactor','67128imlgST','atan2','NEAREST','postProcessingPosition','RGBA','canvasContext','nextTrails','createCommand','style','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','viewerParameters','setData','xmax','push','PixelDatatype','_removedHook','Matrix4','toRadians','Sampler','4588XDCeFj','6867YbAJMt','depthMask','length','createComputingPrimitives','GeometryAttributes','keys','_onMouseDownEvent','resize','_speedRate','mouseDown','9417hIynqI','createRenderingTextures','defineProperty','reverse','trails','globalCompositeOperation','WindLayer','_data','removeEventListener','_onMouseUpEvent','preExecute','autoClear','getRandomLatLng','segments','PI_OVER_TWO','OPAQUE','isPointVisible','layer','pointerEvents','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','getColorTexture','currentTrails','7sMLhOD','globeBoundingSphere','createRawRenderState','scene','maxParticles','udata','animateFrame','canvasResize','clear','fadeOpacity','579415nifnMb','vmin','isDestroyed','framebuffers','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','primitiveType','array','cols','north','max','getOptions','createFramebuffer','height','mode','lat','postMessage','worker','CanvasWindField','particles','strokeStyle','particlesRendering','Draw','Pass','BufferUsage'];_0x1ff2=function(){return _0x4db93f;};return _0x1ff2();}function getSpeed(_0x687757,_0x1b8e86){const _0x390ff3=_0x5220,_0x139bbd=Math['sqrt'](Math[_0x390ff3(0x26e)](_0x687757,0x2)+Math[_0x390ff3(0x26e)](_0x1b8e86,0x2));return _0x139bbd;}function getDirection(_0x5ce0d5,_0x2f848f){const _0xfdedc4=_0x5220;let _0x352a15=Cesium$7[_0xfdedc4(0x276)]['toDegrees'](Math[_0xfdedc4(0x1b4)](_0x2f848f,_0x5ce0d5));return _0x352a15+=_0x352a15<0x0?0x168:0x0,_0x352a15;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x4301e1(0x247)];class CustomPrimitive{constructor(_0x8cb14d){const _0x5e0d2c=_0x4301e1;this['commandType']=_0x8cb14d['commandType'],this[_0x5e0d2c(0x22f)]=_0x8cb14d['geometry'],this[_0x5e0d2c(0x26f)]=_0x8cb14d[_0x5e0d2c(0x26f)],this['primitiveType']=_0x8cb14d[_0x5e0d2c(0x1f6)],this['uniformMap']=_0x8cb14d['uniformMap'],this['vertexShaderSource']=_0x8cb14d['vertexShaderSource'],this['fragmentShaderSource']=_0x8cb14d['fragmentShaderSource'],this['rawRenderState']=_0x8cb14d['rawRenderState'],this['framebuffer']=_0x8cb14d[_0x5e0d2c(0x22a)],this['outputTexture']=_0x8cb14d['outputTexture'],this['autoClear']=_0x8cb14d['autoClear']??![],this['preExecute']=_0x8cb14d[_0x5e0d2c(0x1db)],this[_0x5e0d2c(0x211)]=!![],this[_0x5e0d2c(0x21b)]=undefined,this[_0x5e0d2c(0x22e)]=undefined,this[_0x5e0d2c(0x1dc)]&&(this['clearCommand']=new Cesium$6[(_0x5e0d2c(0x231))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x5e0d2c(0x22a)],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x148b88){const _0x7456ed=_0x4301e1;switch(this['commandType']){case'Draw':{const _0x550206=Cesium$6['VertexArray']['fromGeometry']({'context':_0x148b88,'geometry':this[_0x7456ed(0x22f)],'attributeLocations':this[_0x7456ed(0x26f)],'bufferUsage':Cesium$6['BufferUsage'][_0x7456ed(0x19a)]}),_0x262a87=Cesium$6['ShaderProgram']['fromCache']({'context':_0x148b88,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x3966e6=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x7456ed(0x1f6)],'shaderProgram':_0x262a87,'vertexArray':_0x550206,'modelMatrix':Cesium$6[_0x7456ed(0x1c3)]['IDENTITY'],'renderState':_0x3966e6,'uniformMap':this[_0x7456ed(0x23f)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x7456ed(0x207)][_0x7456ed(0x1e0)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x212999,_0x1a1895){const _0x2719df=_0x4301e1;this['geometry']=_0x1a1895;const _0x2876b0=Cesium$6['VertexArray']['fromGeometry']({'context':_0x212999,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x2719df(0x208)]['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x2876b0;}[_0x4301e1(0x252)](_0x439f47){const _0x2511db=_0x4301e1;if(!this['show'])return;if(_0x439f47[_0x2511db(0x1fe)]!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this[_0x2511db(0x21b)])&&(this['commandToExecute']=this[_0x2511db(0x1ba)](_0x439f47['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this[_0x2511db(0x22e)])&&_0x439f47['commandList']['push'](this['clearCommand']),_0x439f47['commandList']['push'](this['commandToExecute']);}[_0x4301e1(0x1f3)](){return![];}['destroy'](){const _0x5f58d5=_0x4301e1;if(this[_0x5f58d5(0x22e)]){var _0x10187a,_0x28a5e5;(_0x10187a=this['clearCommand'])!==null&&_0x10187a!==void 0x0&&_0x10187a[_0x5f58d5(0x254)]&&this[_0x5f58d5(0x22e)]['vertexArray']['destroy'](),(_0x28a5e5=this['clearCommand'])!==null&&_0x28a5e5!==void 0x0&&_0x28a5e5['shaderProgram']&&this[_0x5f58d5(0x22e)]['shaderProgram']['destroy'](),delete this[_0x5f58d5(0x22e)];}return this[_0x5f58d5(0x21b)]&&(this['commandToExecute']['vertexArray']&&this['commandToExecute'][_0x5f58d5(0x254)][_0x5f58d5(0x240)](),this[_0x5f58d5(0x21b)][_0x5f58d5(0x27b)]&&this[_0x5f58d5(0x21b)]['shaderProgram'][_0x5f58d5(0x240)](),delete this['commandToExecute']),Cesium$6[_0x5f58d5(0x269)](this);}}const Cesium$5=mars3d__namespace[_0x4301e1(0x247)],Util=(function(){const _0x5bdd86=function(){const _0x3eae53=_0x5220,_0x38cf11=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x3eae53(0x261)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x3eae53(0x238)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x38cf11;},_0x2344a5=function(_0x5af133,_0x593d8b){if(Cesium$5['defined'](_0x593d8b)){const _0x1f8f25={};_0x1f8f25['arrayBufferView']=_0x593d8b,_0x5af133['source']=_0x1f8f25;}const _0x274372=new Cesium$5['Texture'](_0x5af133);return _0x274372;},_0x538615=function(_0x2da107,_0x4217a7,_0x14c5db){const _0x249317=new Cesium$5['Framebuffer']({'context':_0x2da107,'colorTextures':[_0x4217a7],'depthTexture':_0x14c5db});return _0x249317;},_0x62353e=function(_0x2544c0){const _0x22fd0e=_0x5220,_0x1f7e53=!![],_0x23b194=![],_0x2828a0={'viewport':_0x2544c0['viewport'],'depthTest':_0x2544c0['depthTest'],'depthMask':_0x2544c0[_0x22fd0e(0x1c8)],'blending':_0x2544c0['blending']},_0x573608=Cesium$5['Appearance']['getDefaultRenderState'](_0x1f7e53,_0x23b194,_0x2828a0);return _0x573608;},_0x1a9de9=function(_0x695b7c){const _0x418834=_0x5220,_0x21b739={},_0x35090e=Cesium$5['Math']['mod'](_0x695b7c['west'],Cesium$5['Math']['TWO_PI']),_0x3aae5a=Cesium$5['Math']['mod'](_0x695b7c['east'],Cesium$5['Math']['TWO_PI']),_0x352831=_0x695b7c['width'];let _0x36747b,_0x48bf97;_0x352831>Cesium$5[_0x418834(0x276)][_0x418834(0x1ad)]?(_0x36747b=0x0,_0x48bf97=Cesium$5[_0x418834(0x276)]['TWO_PI']):_0x3aae5a-_0x35090e<_0x352831?(_0x36747b=_0x35090e,_0x48bf97=_0x35090e+_0x352831):(_0x36747b=_0x35090e,_0x48bf97=_0x3aae5a);_0x21b739[_0x418834(0x278)]={'min':Cesium$5['Math'][_0x418834(0x264)](_0x36747b),'max':Cesium$5['Math']['toDegrees'](_0x48bf97)};const _0x3570f5=_0x695b7c['south'],_0x2a7c45=_0x695b7c[_0x418834(0x1f9)],_0x1ce24a=_0x695b7c[_0x418834(0x1fd)],_0xb3369a=_0x1ce24a>Cesium$5['Math']['PI']/0xc?_0x1ce24a/0x2:0x0;let _0x473dac=Cesium$5['Math']['clampToLatitudeRange'](_0x3570f5-_0xb3369a),_0x4f5973=Cesium$5[_0x418834(0x276)][_0x418834(0x21e)](_0x2a7c45+_0xb3369a);return _0x473dac<-Cesium$5[_0x418834(0x276)]['PI_OVER_THREE']&&(_0x473dac=-Cesium$5['Math']['PI_OVER_TWO']),_0x4f5973>Cesium$5['Math']['PI_OVER_THREE']&&(_0x4f5973=Cesium$5[_0x418834(0x276)][_0x418834(0x1df)]),_0x21b739['lat']={'min':Cesium$5['Math']['toDegrees'](_0x473dac),'max':Cesium$5['Math']['toDegrees'](_0x4f5973)},_0x21b739;};return{'getFullscreenQuad':_0x5bdd86,'createTexture':_0x2344a5,'createFramebuffer':_0x538615,'createRawRenderState':_0x62353e,'viewRectangleToLonLatRange':_0x1a9de9};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x1e133d,_0x58bb85,_0x10b1de,_0x3b3e65,_0x844ea){const _0x437e56=_0x4301e1;this[_0x437e56(0x1d2)](_0x1e133d,_0x58bb85,_0x10b1de[_0x437e56(0x246)]),this['createRenderingFramebuffers'](_0x1e133d),this['createRenderingPrimitives'](_0x1e133d,_0x10b1de,_0x3b3e65,_0x844ea);}[_0x4301e1(0x1d2)](_0x59c159,_0x241ad0,_0x40f1af){const _0x4a10d2=_0x4301e1,_0x1a9bee={'context':_0x59c159,'width':_0x59c159['drawingBufferWidth'],'height':_0x59c159['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x4a10d2(0x1c1)]['UNSIGNED_BYTE']},_0x105bd9={'context':_0x59c159,'width':_0x59c159['drawingBufferWidth'],'height':_0x59c159['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x1749fe=_0x40f1af['length'],_0x5e2a86=new Float32Array(_0x1749fe*0x3);for(let _0x248551=0x0;_0x248551<_0x1749fe;_0x248551++){const _0x2653c4=Cesium$4['Color']['fromCssColorString'](_0x40f1af[_0x248551]);_0x5e2a86[0x3*_0x248551]=_0x2653c4['red'],_0x5e2a86[0x3*_0x248551+0x1]=_0x2653c4[_0x4a10d2(0x19e)],_0x5e2a86[0x3*_0x248551+0x2]=_0x2653c4[_0x4a10d2(0x230)];}const _0x38944f={'context':_0x59c159,'width':_0x1749fe,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x1a9bee),'segmentsDepth':Util['createTexture'](_0x105bd9),'currentTrailsColor':Util[_0x4a10d2(0x19b)](_0x1a9bee),'currentTrailsDepth':Util[_0x4a10d2(0x19b)](_0x105bd9),'nextTrailsColor':Util['createTexture'](_0x1a9bee),'nextTrailsDepth':Util['createTexture'](_0x105bd9),'colorTable':Util[_0x4a10d2(0x19b)](_0x38944f,_0x5e2a86)};}['createRenderingFramebuffers'](_0xb81c68){const _0x547433=_0x4301e1;this['framebuffers']={'segments':Util[_0x547433(0x1fc)](_0xb81c68,this['textures']['segmentsColor'],this[_0x547433(0x20a)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0xb81c68,this[_0x547433(0x20a)]['currentTrailsColor'],this[_0x547433(0x20a)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0xb81c68,this['textures'][_0x547433(0x24f)],this[_0x547433(0x20a)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x31104b){const _0x55e61f=_0x4301e1,_0x58d5ab=0x4;let _0x371494=[];for(let _0x3b5737=0x0;_0x3b5737<_0x31104b['particlesTextureSize'];_0x3b5737++){for(let _0x2eabb6=0x0;_0x2eabb6<_0x31104b['particlesTextureSize'];_0x2eabb6++){for(let _0x5c0178=0x0;_0x5c0178<_0x58d5ab;_0x5c0178++){_0x371494['push'](_0x3b5737/_0x31104b['particlesTextureSize']),_0x371494['push'](_0x2eabb6/_0x31104b['particlesTextureSize']);}}}_0x371494=new Float32Array(_0x371494);let _0x3a7bf4=[];const _0x3f0f1b=[-0x1,0x1],_0x6c9728=[-0x1,0x1];for(let _0x5addfd=0x0;_0x5addfd<_0x31104b[_0x55e61f(0x1eb)];_0x5addfd++){for(let _0x3d50ed=0x0;_0x3d50ed<_0x58d5ab/0x2;_0x3d50ed++){for(let _0x542270=0x0;_0x542270<_0x58d5ab/0x2;_0x542270++){_0x3a7bf4['push'](_0x3f0f1b[_0x3d50ed]),_0x3a7bf4['push'](_0x6c9728[_0x542270]),_0x3a7bf4[_0x55e61f(0x1c0)](0x0);}}}_0x3a7bf4=new Float32Array(_0x3a7bf4);const _0x1b0f4f=0x6*_0x31104b['maxParticles'],_0x140697=new Uint32Array(_0x1b0f4f);for(let _0x5281cf=0x0,_0x396bca=0x0,_0x3ab719=0x0;_0x5281cf<_0x31104b['maxParticles'];_0x5281cf++){_0x140697[_0x396bca++]=_0x3ab719+0x0,_0x140697[_0x396bca++]=_0x3ab719+0x1,_0x140697[_0x396bca++]=_0x3ab719+0x2,_0x140697[_0x396bca++]=_0x3ab719+0x2,_0x140697[_0x396bca++]=_0x3ab719+0x1,_0x140697[_0x396bca++]=_0x3ab719+0x3,_0x3ab719+=0x4;}const _0x536b8f=new Cesium$4['Geometry']({'attributes':new Cesium$4[(_0x55e61f(0x1cb))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x371494}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x3a7bf4})}),'indices':_0x140697});return _0x536b8f;}['createRenderingPrimitives'](_0x1940a1,_0x258f8e,_0x5f4d9d,_0x3e54a7){const _0x1392d6=_0x4301e1,_0x559c90=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x258f8e),'primitiveType':Cesium$4[_0x1392d6(0x255)][_0x1392d6(0x270)],'uniformMap':{'currentParticlesPosition':function(){const _0x2d5806=_0x1392d6;return _0x3e54a7[_0x2d5806(0x21c)]['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x3e54a7['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x23891e=_0x1392d6;return _0x3e54a7['particlesTextures'][_0x23891e(0x1a1)];},'colorTable':function(){const _0x4e00f0=_0x1392d6;return _0x559c90[_0x4e00f0(0x20a)]['colorTable'];},'aspect':function(){const _0x479224=_0x1392d6;return _0x1940a1['drawingBufferWidth']/_0x1940a1[_0x479224(0x248)];},'pixelSize':function(){return _0x5f4d9d['pixelSize'];},'lineWidth':function(){return _0x258f8e['lineWidth'];},'particleHeight':function(){return _0x258f8e['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x1392d6(0x275))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x1392d6(0x1e9)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x1392d6(0x1de)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x1392d6(0x206),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x1392d6(0x281)](),'primitiveType':Cesium$4[_0x1392d6(0x255)][_0x1392d6(0x270)],'uniformMap':{'segmentsColorTexture':function(){const _0x8f0f0c=_0x1392d6;return _0x559c90[_0x8f0f0c(0x20a)]['segmentsColor'];},'segmentsDepthTexture':function(){return _0x559c90['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x4ad6ec=_0x1392d6;return _0x559c90[_0x4ad6ec(0x1f4)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x559c90['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){const _0x446615=_0x1392d6;return _0x258f8e[_0x446615(0x1f0)];}},'vertexShaderSource':new Cesium$4[(_0x1392d6(0x275))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x1392d6(0x275))]({'defines':[_0x1392d6(0x1e4)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0x1392d6(0x20f)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x9be3cb=_0x1392d6,_0xd157f=_0x559c90['framebuffers']['currentTrails'];_0x559c90['framebuffers'][_0x9be3cb(0x1e6)]=_0x559c90['framebuffers'][_0x9be3cb(0x1b9)],_0x559c90[_0x9be3cb(0x1f4)][_0x9be3cb(0x1b9)]=_0xd157f,_0x559c90[_0x9be3cb(0x26c)][_0x9be3cb(0x1d5)][_0x9be3cb(0x21b)]['framebuffer']=_0x559c90['framebuffers'][_0x9be3cb(0x1b9)],_0x559c90[_0x9be3cb(0x26c)]['trails']['clearCommand']['framebuffer']=_0x559c90['framebuffers'][_0x9be3cb(0x1b9)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x118c8e=_0x1392d6;return _0x559c90['framebuffers']['nextTrails'][_0x118c8e(0x1e5)](0x0);},'trailsDepthTexture':function(){const _0x4c327b=_0x1392d6;return _0x559c90['framebuffers'][_0x4c327b(0x1b9)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x1392d6(0x275))]({'defines':[_0x1392d6(0x1e4)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x4301e1(0x1bc),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x4301e1(0x1a7),postProcessingSpeed_frag=_0x4301e1(0x1f5);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x12d049,_0x4d25a6,_0x1eb429,_0x248480){const _0x5f2186=_0x4301e1;this['data']=_0x4d25a6,this['createWindTextures'](_0x12d049,_0x4d25a6),this['createParticlesTextures'](_0x12d049,_0x1eb429,_0x248480),this[_0x5f2186(0x1ca)](_0x4d25a6,_0x1eb429,_0x248480);}['createWindTextures'](_0xae3f72,_0x1c8d16){const _0x35b6ba=_0x4301e1,_0x14568d={'context':_0xae3f72,'width':_0x1c8d16['dimensions']['lon'],'height':_0x1c8d16['dimensions']['lat']*(_0x1c8d16[_0x35b6ba(0x27f)][_0x35b6ba(0x262)]||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x35b6ba(0x238)],'flipY':![],'sampler':new Cesium$3[(_0x35b6ba(0x1c5))]({'minificationFilter':Cesium$3[_0x35b6ba(0x229)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x35b6ba(0x1b5)]})};this['windTextures']={'U':Util[_0x35b6ba(0x19b)](_0x14568d,_0x1c8d16['U'][_0x35b6ba(0x1f7)]),'V':Util['createTexture'](_0x14568d,_0x1c8d16['V'][_0x35b6ba(0x1f7)])};}[_0x4301e1(0x22c)](_0x55d7f4,_0x2ebbd8,_0x466c46){const _0x196c13=_0x4301e1,_0x226f29={'context':_0x55d7f4,'width':_0x2ebbd8['particlesTextureSize'],'height':_0x2ebbd8['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x196c13(0x1b7)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x196c13(0x229)]['NEAREST'],'magnificationFilter':Cesium$3[_0x196c13(0x22d)]['NEAREST']})},_0x2d667e=this['randomizeParticles'](_0x2ebbd8['maxParticles'],_0x466c46),_0x51415f=new Float32Array(0x4*_0x2ebbd8['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util[_0x196c13(0x19b)](_0x226f29),'currentParticlesPosition':Util['createTexture'](_0x226f29,_0x2d667e),'nextParticlesPosition':Util['createTexture'](_0x226f29,_0x2d667e),'currentParticlesSpeed':Util['createTexture'](_0x226f29,_0x51415f),'nextParticlesSpeed':Util['createTexture'](_0x226f29,_0x51415f),'postProcessingPosition':Util['createTexture'](_0x226f29,_0x2d667e),'postProcessingSpeed':Util[_0x196c13(0x19b)](_0x226f29,_0x51415f)};}['randomizeParticles'](_0x4ceeac,_0x55d6de){const _0x40c401=_0x4301e1,_0x3dd057=new Float32Array(0x4*_0x4ceeac);for(let _0x30b18c=0x0;_0x30b18c<_0x4ceeac;_0x30b18c++){_0x3dd057[0x4*_0x30b18c]=Cesium$3['Math']['randomBetween'](_0x55d6de['lonRange']['x'],_0x55d6de['lonRange']['y']),_0x3dd057[0x4*_0x30b18c+0x1]=Cesium$3['Math']['randomBetween'](_0x55d6de['latRange']['x'],_0x55d6de['latRange']['y']),_0x3dd057[0x4*_0x30b18c+0x2]=Cesium$3[_0x40c401(0x276)]['randomBetween'](this[_0x40c401(0x236)]['lev']['min'],this['data']['lev']['max']),_0x3dd057[0x4*_0x30b18c+0x3]=0x0;}return _0x3dd057;}['destroyParticlesTextures'](){const _0x4a9cd6=_0x4301e1;Object['keys'](this['particlesTextures'])[_0x4a9cd6(0x282)](_0x2d6048=>{const _0x155bb5=_0x4a9cd6;this['particlesTextures'][_0x2d6048][_0x155bb5(0x240)]();});}['createComputingPrimitives'](_0x23ebe1,_0x9e98e2,_0x2a0c19){const _0x85a209=_0x4301e1,_0x325ba3=new Cesium$3['Cartesian3'](_0x23ebe1['dimensions']['lon'],_0x23ebe1['dimensions']['lat'],_0x23ebe1[_0x85a209(0x27f)]['lev']),_0x539d54=new Cesium$3['Cartesian3'](_0x23ebe1['lon'][_0x85a209(0x214)],_0x23ebe1[_0x85a209(0x1ff)]['min'],_0x23ebe1['lev'][_0x85a209(0x214)]),_0x387102=new Cesium$3['Cartesian3'](_0x23ebe1[_0x85a209(0x278)]['max'],_0x23ebe1['lat'][_0x85a209(0x1fa)],_0x23ebe1['lev']['max']),_0x383829=new Cesium$3['Cartesian3']((_0x387102['x']-_0x539d54['x'])/(_0x325ba3['x']-0x1),(_0x387102['y']-_0x539d54['y'])/(_0x325ba3['y']-0x1),_0x325ba3['z']>0x1?(_0x387102['z']-_0x539d54['z'])/(_0x325ba3['z']-0x1):0x1),_0x67fe1c=new Cesium$3[(_0x85a209(0x265))](_0x23ebe1['U'][_0x85a209(0x214)],_0x23ebe1['U'][_0x85a209(0x1fa)]),_0x132d99=new Cesium$3[(_0x85a209(0x265))](_0x23ebe1['V']['min'],_0x23ebe1['V']['max']),_0xb854d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0xb854d['windTextures']['U'];},'V':function(){return _0xb854d['windTextures']['V'];},'currentParticlesPosition':function(){return _0xb854d['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x325ba3;},'minimum':function(){return _0x539d54;},'maximum':function(){return _0x387102;},'interval':function(){return _0x383829;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x85a209(0x259)],'preExecute':function(){_0xb854d['primitives']['getWind']['commandToExecute']['outputTexture']=_0xb854d['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0xfe24ed=_0x85a209;return _0xb854d[_0xfe24ed(0x21c)]['currentParticlesSpeed'];},'particlesWind':function(){return _0xb854d['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x67fe1c;},'vSpeedRange':function(){return _0x132d99;},'pixelSize':function(){return _0x2a0c19['pixelSize'];},'speedFactor':function(){return _0x9e98e2['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x85a209(0x21c)]['nextParticlesSpeed'],'preExecute':function(){const _0x15a39f=_0x85a209,_0x2f6e43=_0xb854d[_0x15a39f(0x21c)]['currentParticlesSpeed'];_0xb854d['particlesTextures']['currentParticlesSpeed']=_0xb854d['particlesTextures'][_0x15a39f(0x1a1)],_0xb854d[_0x15a39f(0x21c)]['postProcessingSpeed']=_0x2f6e43,_0xb854d[_0x15a39f(0x26c)]['updateSpeed'][_0x15a39f(0x21b)][_0x15a39f(0x1ac)]=_0xb854d[_0x15a39f(0x21c)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0xb854d['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x11b7c5=_0x85a209;return _0xb854d[_0x11b7c5(0x21c)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x1dad91=_0x85a209,_0x4ae4a3=_0xb854d['particlesTextures']['currentParticlesPosition'];_0xb854d[_0x1dad91(0x21c)]['currentParticlesPosition']=_0xb854d[_0x1dad91(0x21c)]['postProcessingPosition'],_0xb854d['particlesTextures']['postProcessingPosition']=_0x4ae4a3,_0xb854d['primitives'][_0x1dad91(0x1ae)]['commandToExecute']['outputTexture']=_0xb854d['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0xb854d['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0xb854d['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x2a0c19['lonRange'];},'latRange':function(){return _0x2a0c19['latRange'];},'randomCoefficient':function(){const _0x2cd625=_0x85a209,_0x3dfa51=Math[_0x2cd625(0x237)]();return _0x3dfa51;},'dropRate':function(){return _0x9e98e2['dropRate'];},'dropRateBump':function(){return _0x9e98e2['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x85a209(0x1b6)],'preExecute':function(){const _0x571565=_0x85a209;_0xb854d['primitives']['postProcessingPosition'][_0x571565(0x21b)]['outputTexture']=_0xb854d['particlesTextures'][_0x571565(0x1b6)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0xb854d['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x553265=_0x85a209;return _0xb854d[_0x553265(0x21c)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x2da52d=_0x85a209;_0xb854d['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0xb854d[_0x2da52d(0x21c)]['postProcessingSpeed'];}})};}}function _0x5220(_0x26546b,_0x5863ea){const _0x1ff22a=_0x1ff2();return _0x5220=function(_0x5220c6,_0x593e15){_0x5220c6=_0x5220c6-0x199;let _0x2715ee=_0x1ff22a[_0x5220c6];return _0x2715ee;},_0x5220(_0x26546b,_0x5863ea);}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x4fc40d,_0x15b581,_0x32f2aa,_0x5536c9){const _0x50cf72=_0x4301e1;this['context']=_0x4fc40d,_0x15b581={..._0x15b581},_0x15b581[_0x50cf72(0x1ec)]&&_0x15b581[_0x50cf72(0x271)]&&(_0x15b581['dimensions']={},_0x15b581['dimensions']['lon']=_0x15b581[_0x50cf72(0x1f8)],_0x15b581['dimensions']['lat']=_0x15b581['rows'],_0x15b581[_0x50cf72(0x27f)]['lev']=_0x15b581['lev']||0x1,_0x15b581['lon']={},_0x15b581['lon'][_0x50cf72(0x214)]=_0x15b581['xmin'],_0x15b581['lon']['max']=_0x15b581[_0x50cf72(0x1bf)],_0x15b581[_0x50cf72(0x1ff)]={},_0x15b581[_0x50cf72(0x1ff)]['min']=_0x15b581['ymin'],_0x15b581['lat']['max']=_0x15b581['ymax'],_0x15b581['lev']={},_0x15b581['lev']['min']=_0x15b581['levmin']??0x1,_0x15b581['lev']['max']=_0x15b581['levmax']??0x1,_0x15b581['U']={},_0x15b581['U']['array']=new Float32Array(_0x15b581['udata']),_0x15b581['U']['min']=_0x15b581['umin']??Math['min'](..._0x15b581['udata']),_0x15b581['U']['max']=_0x15b581[_0x50cf72(0x279)]??Math['max'](..._0x15b581['udata']),_0x15b581['V']={},_0x15b581['V']['array']=new Float32Array(_0x15b581[_0x50cf72(0x271)]),_0x15b581['V'][_0x50cf72(0x214)]=_0x15b581[_0x50cf72(0x1f2)]??Math['min'](..._0x15b581['vdata']),_0x15b581['V']['max']=_0x15b581['vmax']??Math['max'](..._0x15b581[_0x50cf72(0x271)])),this['data']=_0x15b581,this['options']=_0x32f2aa,this['viewerParameters']=_0x5536c9,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x50cf72(0x241)],this['data'],this['options'],this['viewerParameters'],this[_0x50cf72(0x26d)]);}[_0x4301e1(0x1ee)](_0x5badfd){const _0xe4b17d=_0x4301e1;this['particlesComputing'][_0xe4b17d(0x235)](),Object[_0xe4b17d(0x1cc)](this['particlesComputing']['windTextures'])['forEach'](_0x3bd81c=>{this['particlesComputing']['windTextures'][_0x3bd81c]['destroy']();}),this[_0xe4b17d(0x205)]['textures']['colorTable'][_0xe4b17d(0x240)](),Object['keys'](this[_0xe4b17d(0x205)][_0xe4b17d(0x1f4)])['forEach'](_0x309f95=>{const _0x1ed678=_0xe4b17d;this[_0x1ed678(0x205)]['framebuffers'][_0x309f95]['destroy']();}),this[_0xe4b17d(0x241)]=_0x5badfd,this['particlesComputing']=new ParticlesComputing(this[_0xe4b17d(0x241)],this['data'],this['options'],this[_0xe4b17d(0x1bd)]),this[_0xe4b17d(0x205)]=new ParticlesRendering(this['context'],this[_0xe4b17d(0x236)],this[_0xe4b17d(0x26a)],this[_0xe4b17d(0x1bd)],this['particlesComputing']);}['clearFramebuffers'](){const _0x59d713=_0x4301e1,_0xece537=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x59d713(0x1e0)]});Object[_0x59d713(0x1cc)](this['particlesRendering'][_0x59d713(0x1f4)])['forEach'](_0x269042=>{const _0x57164f=_0x59d713;_0xece537['framebuffer']=this['particlesRendering']['framebuffers'][_0x269042],_0xece537['execute'](this[_0x57164f(0x241)]);});}['refreshParticles'](_0x360a08){const _0x16d1a7=_0x4301e1;this['clearFramebuffers'](),this['particlesComputing'][_0x16d1a7(0x235)](),this[_0x16d1a7(0x26d)][_0x16d1a7(0x22c)](this['context'],this['options'],this['viewerParameters']);if(_0x360a08){var _0x1182a1,_0x2a3975;const _0x10205d=this['particlesRendering']['createSegmentsGeometry'](this['options']);this[_0x16d1a7(0x205)][_0x16d1a7(0x26c)]['segments']['geometry']=_0x10205d;const _0x112065=Cesium$2[_0x16d1a7(0x1b1)][_0x16d1a7(0x20e)]({'context':this[_0x16d1a7(0x241)],'geometry':_0x10205d,'attributeLocations':this[_0x16d1a7(0x205)][_0x16d1a7(0x26c)][_0x16d1a7(0x1de)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x1182a1=this['particlesRendering']['primitives'])!==null&&_0x1182a1!==void 0x0&&(_0x2a3975=_0x1182a1['segments'])!==null&&_0x2a3975!==void 0x0&&_0x2a3975['commandToExecute']&&(this[_0x16d1a7(0x205)]['primitives']['segments']['commandToExecute'][_0x16d1a7(0x254)]=_0x112065);}}['setOptions'](_0x446e45){const _0x2a176b=_0x4301e1;let _0x346e78=![];this['options']['maxParticles']!==_0x446e45['maxParticles']&&(_0x346e78=!![]),Object['keys'](_0x446e45)[_0x2a176b(0x282)](_0xcdac2a=>{this['options'][_0xcdac2a]=_0x446e45[_0xcdac2a];}),this[_0x2a176b(0x272)](_0x346e78);}['applyViewerParameters'](_0x1c7583){Object['keys'](_0x1c7583)['forEach'](_0x349ee4=>{this['viewerParameters'][_0x349ee4]=_0x1c7583[_0x349ee4];}),this['refreshParticles'](![]);}['destroy'](){const _0x1b7d07=_0x4301e1;clearTimeout(this['canrefresh']),this[_0x1b7d07(0x26d)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x1b7d07(0x282)](_0x269f53=>{const _0x52168d=_0x1b7d07;this[_0x52168d(0x26d)]['windTextures'][_0x269f53]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x1b7d07(0x1cc)](this['particlesRendering']['framebuffers'])['forEach'](_0x5d0292=>{const _0x3ef415=_0x1b7d07;this['particlesRendering'][_0x3ef415(0x1f4)][_0x5d0292]['destroy']();});for(const _0x2b3db3 in this){delete this[_0x2b3db3];}}}const Cesium$1=mars3d__namespace[_0x4301e1(0x247)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x4301e1(0x220)]};class WindLayer extends BaseLayer$1{constructor(_0x314e2f={}){_0x314e2f={...DEF_OPTIONS,..._0x314e2f},super(_0x314e2f),this['_setOptionsHook'](_0x314e2f);}get[_0x4301e1(0x1e2)](){const _0x54ccee=_0x4301e1;return this[_0x54ccee(0x26c)];}get['data'](){const _0x20c091=_0x4301e1;return this[_0x20c091(0x1d8)];}set['data'](_0xaf1b05){this['setData'](_0xaf1b05);}get['colors'](){const _0xd9cafa=_0x4301e1;return this[_0xd9cafa(0x26a)]['colors'];}set[_0x4301e1(0x246)](_0x752901){const _0x5811fa=_0x4301e1;this['options'][_0x5811fa(0x246)]=_0x752901,this['particleSystem']&&this[_0x5811fa(0x25d)]['setOptions']({'colors':_0x752901}),this['resize']();}[_0x4301e1(0x20d)](){}['_addedHook'](){const _0x5b0a67=_0x4301e1;this['scene']=this[_0x5b0a67(0x234)][_0x5b0a67(0x1ea)],this[_0x5b0a67(0x23a)]=this['_map']['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this[_0x5b0a67(0x26c)]),this[_0x5b0a67(0x1bd)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x5b0a67(0x265))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1[_0x5b0a67(0x1a2)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x5b0a67(0x1ce),this[_0x5b0a67(0x1ce)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x5b0a67(0x234)]['on'](mars3d__namespace[_0x5b0a67(0x257)][_0x5b0a67(0x239)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x5b0a67(0x1d0)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x5b0a67(0x1da)],this),this['_map']['on'](mars3d__namespace[_0x5b0a67(0x257)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x5b0a67(0x1be)](this['_data']);}[_0x4301e1(0x1c2)](){const _0x202e96=_0x4301e1;window['removeEventListener']('resize',this[_0x202e96(0x1ce)]),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this[_0x202e96(0x19c)],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x202e96(0x257)][_0x202e96(0x1d0)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x202e96(0x22b)],this['_onMouseUpEvent'],this),this[_0x202e96(0x234)]['off'](mars3d__namespace[_0x202e96(0x257)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x202e96(0x26c)]['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x501127=_0x4301e1;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace[_0x501127(0x257)][_0x501127(0x251)],this['_onMap_preRenderEvent'],this);}[_0x4301e1(0x19c)](_0x37a3dd){const _0x4a6f22=_0x4301e1;this['particleSystem']['canvasResize'](this['scene'][_0x4a6f22(0x241)]),this[_0x4a6f22(0x224)](),this['primitives']['show']=!![];}[_0x4301e1(0x1a8)](_0x2f69a1){const _0x49fb9b=_0x4301e1;clearTimeout(this[_0x49fb9b(0x274)]);if(!this['show']||!this['particleSystem'])return;this[_0x49fb9b(0x26c)]['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x11626c=_0x49fb9b;if(!this['show'])return;this[_0x11626c(0x216)]();},0xc8);}[_0x4301e1(0x1cd)](_0xcef175){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x1d115c){const _0x2f471b=_0x4301e1;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x2f471b(0x221)]=!![]);}['_onMouseUpEvent'](_0x578191){const _0x10c9da=_0x4301e1;if(!this[_0x10c9da(0x211)]||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x10c9da(0x26c)][_0x10c9da(0x211)]=!![],this[_0x10c9da(0x20c)]=![],this['mouse_move']=![];}['redraw'](){const _0x558c53=_0x4301e1;if(!this['_map']||!this[_0x558c53(0x211)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x558c53(0x211)]=!![];}['setData'](_0x4d46c2){const _0x45c100=_0x4301e1;this['_data']=_0x4d46c2,this['particleSystem']&&this[_0x45c100(0x25d)]['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x4d46c2,this['getOptions'](),this[_0x45c100(0x1bd)]),this[_0x45c100(0x224)]();}['_setOptionsHook'](_0x3c9097,_0x2bd085){const _0x5d44c6=_0x4301e1;if(_0x3c9097)for(const _0x1c6d9f in _0x3c9097){this[_0x1c6d9f]=_0x3c9097[_0x1c6d9f];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x5d44c6(0x1fb)]());}['getOptions'](){const _0x3f896a=_0x4301e1,_0x4254a6=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x4254a6*_0x4254a6,{'particlesTextureSize':_0x4254a6,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x3f896a(0x1f0)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x3f896a(0x1b2)],'lineWidth':this['lineWidth'],'colors':this[_0x3f896a(0x246)]};}['addPrimitives'](){const _0x3f783f=_0x4301e1;this[_0x3f783f(0x26c)][_0x3f783f(0x23e)](this['particleSystem'][_0x3f783f(0x26d)][_0x3f783f(0x26c)]['getWind']),this['primitives']['add'](this[_0x3f783f(0x25d)]['particlesComputing'][_0x3f783f(0x26c)]['updateSpeed']),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x3f783f(0x26c)]['updatePosition']),this[_0x3f783f(0x26c)]['add'](this[_0x3f783f(0x25d)][_0x3f783f(0x26d)][_0x3f783f(0x26c)][_0x3f783f(0x1b6)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives'][_0x3f783f(0x23e)](this['particleSystem'][_0x3f783f(0x205)]['primitives']['segments']),this['primitives']['add'](this['particleSystem'][_0x3f783f(0x205)]['primitives']['trails']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}[_0x4301e1(0x24a)](){const _0x329f6b=_0x4301e1;let _0x4d4caf=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x4d4caf){const _0x5c6ec3=this[_0x329f6b(0x234)]['getExtent']();_0x4d4caf=Cesium$1['Rectangle']['fromDegrees'](_0x5c6ec3['xmin'],_0x5c6ec3['ymin'],_0x5c6ec3['xmax'],_0x5c6ec3['ymax']);}const _0x2be7ac=Util['viewRectangleToLonLatRange'](_0x4d4caf);this[_0x329f6b(0x1bd)][_0x329f6b(0x23d)]['x']=_0x2be7ac[_0x329f6b(0x278)][_0x329f6b(0x214)],this['viewerParameters']['lonRange']['y']=_0x2be7ac['lon'][_0x329f6b(0x1fa)],this['viewerParameters']['latRange']['x']=_0x2be7ac[_0x329f6b(0x1ff)]['min'],this[_0x329f6b(0x1bd)]['latRange']['y']=_0x2be7ac['lat']['max'];const _0x341438=this[_0x329f6b(0x23a)]['getPixelSize'](this[_0x329f6b(0x1e8)],this['scene'][_0x329f6b(0x24b)],this['scene']['drawingBufferHeight']);_0x341438>0x0&&(this[_0x329f6b(0x1bd)]['pixelSize']=_0x341438);}}mars3d__namespace['LayerUtil'][_0x4301e1(0x242)]('wind',WindLayer),mars3d__namespace[_0x4301e1(0x1e2)][_0x4301e1(0x1d7)]=WindLayer;class CanvasParticle{constructor(){const _0x12c34a=_0x4301e1;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x12c34a(0x21d)]=null,this['speed']=null;}['destroy'](){for(const _0x54f064 in this){delete this[_0x54f064];}}}class CanvasWindField{constructor(_0x525c9a){this['setOptions'](_0x525c9a);}get['speedRate'](){const _0x4f5aa0=_0x4301e1;return this[_0x4f5aa0(0x1cf)];}set[_0x4301e1(0x1a3)](_0x332069){const _0x23ae28=_0x4301e1;this['_speedRate']=(0x64-(_0x332069>0x63?0x63:_0x332069))*0x64,this['_calc_speedRate']=[(this['xmax']-this[_0x23ae28(0x1a5)])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){const _0x3a4aba=_0x4301e1;return this[_0x3a4aba(0x249)];}set['maxAge'](_0x320247){this['_maxAge']=_0x320247;}['setOptions'](_0x5ae345){const _0x42a77f=_0x4301e1;this['options']=_0x5ae345,this[_0x42a77f(0x209)]=_0x5ae345[_0x42a77f(0x209)]||0x78,this[_0x42a77f(0x1a3)]=_0x5ae345['speedRate']||0x32,this['particles']=[];const _0xef59d7=_0x5ae345['particlesNumber']||0x1000;for(let _0x3b9d64=0x0;_0x3b9d64<_0xef59d7;_0x3b9d64++){const _0x36d3b6=this['_randomParticle'](new CanvasParticle());this['particles'][_0x42a77f(0x1c0)](_0x36d3b6);}}[_0x4301e1(0x199)](_0x5a26b2){const _0x49b7fe=_0x4301e1;this['rows']=_0x5a26b2['rows'],this['cols']=_0x5a26b2['cols'],this[_0x49b7fe(0x1a5)]=_0x5a26b2['xmin'],this[_0x49b7fe(0x1bf)]=_0x5a26b2[_0x49b7fe(0x1bf)],this[_0x49b7fe(0x277)]=_0x5a26b2['ymin'],this['ymax']=_0x5a26b2['ymax'],this['grid']=[];const _0x35769d=_0x5a26b2['udata'],_0x1da195=_0x5a26b2[_0x49b7fe(0x271)];let _0x6a8952=![];_0x35769d['length']===this['rows']&&_0x35769d[0x0][_0x49b7fe(0x1c9)]===this['cols']&&(_0x6a8952=!![]);let _0x592d3c=0x0,_0x220508=null,_0x592f5f=null;for(let _0x36495b=0x0;_0x36495b<this['rows'];_0x36495b++){_0x220508=[];for(let _0x2b8dbd=0x0;_0x2b8dbd<this['cols'];_0x2b8dbd++,_0x592d3c++){_0x6a8952?_0x592f5f=this['_calcUV'](_0x35769d[_0x36495b][_0x2b8dbd],_0x1da195[_0x36495b][_0x2b8dbd]):_0x592f5f=this['_calcUV'](_0x35769d[_0x592d3c],_0x1da195[_0x592d3c]),_0x220508['push'](_0x592f5f);}this['grid'][_0x49b7fe(0x1c0)](_0x220508);}this[_0x49b7fe(0x26a)]['reverseY']&&this['grid'][_0x49b7fe(0x1d4)]();}['clear'](){const _0x523b1e=_0x4301e1;delete this['rows'],delete this[_0x523b1e(0x1f8)],delete this[_0x523b1e(0x1a5)],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this[_0x523b1e(0x25b)],delete this[_0x523b1e(0x203)];}[_0x4301e1(0x225)](_0x2b46dd,_0x1b1df5){const _0x5cf87d=_0x4301e1,_0xec8962=(_0x2b46dd-this[_0x5cf87d(0x1a5)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x23b674=(this[_0x5cf87d(0x1a4)]-_0x1b1df5)/(this['ymax']-this[_0x5cf87d(0x277)])*(this['rows']-0x1);return[_0xec8962,_0x23b674];}['getUVByXY'](_0x1cc8a1,_0x48e511){const _0x4533e8=_0x4301e1;if(_0x1cc8a1<0x0||_0x1cc8a1>=this['cols']||_0x48e511>=this['rows'])return[0x0,0x0,0x0];const _0x3a30b6=Math[_0x4533e8(0x23c)](_0x1cc8a1),_0x3cbb9a=Math['floor'](_0x48e511);if(_0x3a30b6===_0x1cc8a1&&_0x3cbb9a===_0x48e511)return this['grid'][_0x48e511][_0x1cc8a1];const _0x191e15=_0x3a30b6+0x1,_0x1b3cce=_0x3cbb9a+0x1,_0xe8658f=this['getUVByXY'](_0x3a30b6,_0x3cbb9a),_0x46c1a6=this[_0x4533e8(0x19f)](_0x191e15,_0x3cbb9a),_0x16106e=this[_0x4533e8(0x19f)](_0x3a30b6,_0x1b3cce),_0x322cf6=this[_0x4533e8(0x19f)](_0x191e15,_0x1b3cce);let _0x1312bd=null;try{_0x1312bd=this['_bilinearInterpolation'](_0x1cc8a1-_0x3a30b6,_0x48e511-_0x3cbb9a,_0xe8658f,_0x46c1a6,_0x16106e,_0x322cf6);}catch(_0x27ef2d){console['log'](_0x1cc8a1,_0x48e511);}return _0x1312bd;}[_0x4301e1(0x21f)](_0x149b84,_0x8094b6,_0x21c413,_0x2c2e35,_0x48f8d0,_0x14171a){const _0x106529=0x1-_0x149b84,_0x56884a=0x1-_0x8094b6,_0x3d4ca0=_0x106529*_0x56884a,_0x280723=_0x149b84*_0x56884a,_0x26d88f=_0x106529*_0x8094b6,_0x5da89b=_0x149b84*_0x8094b6,_0x4c44f0=_0x21c413[0x0]*_0x3d4ca0+_0x2c2e35[0x0]*_0x280723+_0x48f8d0[0x0]*_0x26d88f+_0x14171a[0x0]*_0x5da89b,_0x549cc7=_0x21c413[0x1]*_0x3d4ca0+_0x2c2e35[0x1]*_0x280723+_0x48f8d0[0x1]*_0x26d88f+_0x14171a[0x1]*_0x5da89b;return this['_calcUV'](_0x4c44f0,_0x549cc7);}['_calcUV'](_0x4107f0,_0xb38ec4){const _0x51cc5c=_0x4301e1;return[+_0x4107f0,+_0xb38ec4,Math[_0x51cc5c(0x25f)](_0x4107f0*_0x4107f0+_0xb38ec4*_0xb38ec4)];}['getUVByPoint'](_0x369cdc,_0x504ac6){const _0x26c981=_0x4301e1;if(!this['isInExtent'](_0x369cdc,_0x504ac6))return null;const _0x4d1a67=this['toGridXY'](_0x369cdc,_0x504ac6),_0x1501b7=this[_0x26c981(0x19f)](_0x4d1a67[0x0],_0x4d1a67[0x1]);return _0x1501b7;}['isInExtent'](_0x82dfff,_0x35c760){const _0x286b03=_0x4301e1;return _0x82dfff>=this['xmin']&&_0x82dfff<=this['xmax']&&_0x35c760>=this[_0x286b03(0x277)]&&_0x35c760<=this['ymax']?!![]:![];}[_0x4301e1(0x1dd)](){const _0x3f6579=_0x4301e1,_0x4d0159=fRandomByfloat(this['xmin'],this['xmax']),_0x26ca61=fRandomByfloat(this['ymin'],this[_0x3f6579(0x1a4)]);return{'lat':_0x26ca61,'lng':_0x4d0159};}['getParticles'](){const _0x4cdcdb=_0x4301e1;let _0x20d0f8,_0x558f01,_0x3e358f;for(let _0x3994fa=0x0,_0x25e5b7=this['particles'][_0x4cdcdb(0x1c9)];_0x3994fa<_0x25e5b7;_0x3994fa++){let _0x23b48b=this['particles'][_0x3994fa];_0x23b48b[_0x4cdcdb(0x21d)]<=0x0&&(_0x23b48b=this[_0x4cdcdb(0x23b)](_0x23b48b));if(_0x23b48b['age']>0x0){const _0x59b79c=_0x23b48b['tlng'],_0x487d2f=_0x23b48b['tlat'];_0x3e358f=this[_0x4cdcdb(0x233)](_0x59b79c,_0x487d2f),_0x3e358f?(_0x20d0f8=_0x59b79c+this[_0x4cdcdb(0x20b)][0x0]*_0x3e358f[0x0],_0x558f01=_0x487d2f+this['_calc_speedRate'][0x1]*_0x3e358f[0x1],_0x23b48b['lng']=_0x59b79c,_0x23b48b[_0x4cdcdb(0x1ff)]=_0x487d2f,_0x23b48b['tlng']=_0x20d0f8,_0x23b48b['tlat']=_0x558f01,_0x23b48b['speed']=_0x3e358f[0x2],_0x23b48b['age']--):_0x23b48b[_0x4cdcdb(0x21d)]=0x0;}}return this['particles'];}['_randomParticle'](_0x391dec){const _0x489cf0=_0x4301e1;let _0x3cc524,_0x28454c;for(let _0x202e3f=0x0;_0x202e3f<0x1e;_0x202e3f++){_0x3cc524=this[_0x489cf0(0x1dd)](),_0x28454c=this[_0x489cf0(0x233)](_0x3cc524[_0x489cf0(0x213)],_0x3cc524['lat']);if(_0x28454c&&_0x28454c[0x2]>0x0)break;}if(!_0x28454c)return _0x391dec;const _0x391d19=_0x3cc524['lng']+this['_calc_speedRate'][0x0]*_0x28454c[0x0],_0x24818b=_0x3cc524['lat']+this[_0x489cf0(0x20b)][0x1]*_0x28454c[0x1];return _0x391dec['lng']=_0x3cc524['lng'],_0x391dec['lat']=_0x3cc524['lat'],_0x391dec['tlng']=_0x391d19,_0x391dec['tlat']=_0x24818b,_0x391dec['age']=Math['round'](Math['random']()*this['maxAge']),_0x391dec['speed']=_0x28454c[0x2],_0x391dec;}['destroy'](){for(const _0x2e7cce in this){delete this[_0x2e7cce];}}}function fRandomByfloat(_0x396a4f,_0x80bd02){return _0x396a4f+Math['random']()*(_0x80bd02-_0x396a4f);}const Cesium=mars3d__namespace[_0x4301e1(0x247)],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x11d2bb={}){const _0x443f83=_0x4301e1;super(_0x11d2bb),this['_setOptionsHook'](_0x11d2bb),this[_0x443f83(0x253)]=null,_0x11d2bb['colors']&&_0x11d2bb['steps']&&(this[_0x443f83(0x245)]=new mars3d__namespace['ColorRamp'](_0x11d2bb));}['_setOptionsHook'](_0x16d4ec,_0x4bb5cc){const _0x4bd3e8=_0x4301e1;this['frameTime']=0x3e8/(_0x16d4ec['frameRate']||0xa),this[_0x4bd3e8(0x280)]=this[_0x4bd3e8(0x26a)]['pointerEvents']??![],this['color']=_0x16d4ec['color']||_0x4bd3e8(0x219),this[_0x4bd3e8(0x1b0)]=_0x16d4ec['lineWidth']||0x1,this[_0x4bd3e8(0x222)]=_0x16d4ec['fixedHeight']??0x0,this['reverseY']=_0x16d4ec['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x16d4ec);}get['layer'](){return this['canvas'];}get['canvasWidth'](){return this['_map']['scene']['canvas']['clientWidth'];}get[_0x4301e1(0x212)](){const _0x5a8381=_0x4301e1;return this[_0x5a8381(0x234)]['scene']['canvas']['clientHeight'];}get[_0x4301e1(0x1e3)](){const _0x44739c=_0x4301e1;return this[_0x44739c(0x280)];}set['pointerEvents'](_0x2cdf32){const _0x72bea8=_0x4301e1;this[_0x72bea8(0x280)]=_0x2cdf32;if(!this['canvas'])return;_0x2cdf32?this['canvas']['style']['pointer-events']='all':this[_0x72bea8(0x253)]['style']['pointer-events']='none';}get['particlesNumber'](){const _0x285671=_0x4301e1;return this[_0x285671(0x26a)]['particlesNumber'];}set['particlesNumber'](_0x985d85){this['options']['particlesNumber']=_0x985d85,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0xe66b01){const _0x4c2adf=_0x4301e1;this['options'][_0x4c2adf(0x1a3)]=_0xe66b01,this[_0x4c2adf(0x24e)]&&(this['windField'][_0x4c2adf(0x1a3)]=_0xe66b01);}get[_0x4301e1(0x209)](){const _0x38a44a=_0x4301e1;return this[_0x38a44a(0x26a)]['maxAge'];}set['maxAge'](_0x5906c4){const _0x2b8f0e=_0x4301e1;this[_0x2b8f0e(0x26a)]['maxAge']=_0x5906c4,this['windField']&&(this['windField']['maxAge']=_0x5906c4);}get['data'](){const _0x1922c3=_0x4301e1;return this[_0x1922c3(0x25e)];}set['data'](_0x2fa822){const _0x398fdf=_0x4301e1;this[_0x398fdf(0x1be)](_0x2fa822);}[_0x4301e1(0x226)](_0x57bed2){const _0x424211=_0x4301e1;_0x57bed2?this[_0x424211(0x217)]():(this[_0x424211(0x25e)]&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x2166f4=_0x4301e1;this['options']['worker']?this['initWorker']():this[_0x2166f4(0x24e)]=new CanvasWindField(this['options']);}[_0x4301e1(0x217)](){const _0xe633d6=_0x4301e1;this[_0xe633d6(0x253)]=this[_0xe633d6(0x267)](),this['canvasContext']=this['canvas'][_0xe633d6(0x1a6)]('2d',{'willReadFrequently':!![]}),this[_0xe633d6(0x243)](),this[_0xe633d6(0x26a)]['data']&&this['setData'](this[_0xe633d6(0x26a)][_0xe633d6(0x236)]);}[_0x4301e1(0x1c2)](){const _0x3827a1=_0x4301e1;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this[_0x3827a1(0x253)]),delete this['canvas']);}[_0x4301e1(0x267)](){const _0x596948=_0x4301e1,_0x1e8e8d=mars3d__namespace['DomUtil'][_0x596948(0x25a)](_0x596948(0x253),'mars3d-canvasWind',this['_map'][_0x596948(0x1aa)]);return _0x1e8e8d['style']['position']='absolute',_0x1e8e8d['style']['top']='0px',_0x1e8e8d['style']['left']='0px',_0x1e8e8d['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x1e8e8d['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x1e8e8d['style'][_0x596948(0x1e3)]=this['_pointerEvents']?'auto':_0x596948(0x258),_0x1e8e8d[_0x596948(0x1bb)][_0x596948(0x1ab)]=this[_0x596948(0x26a)][_0x596948(0x1ab)]??0x9,_0x1e8e8d['width']=this['_map']['scene']['canvas']['clientWidth'],_0x1e8e8d['height']=this['_map']['scene']['canvas']['clientHeight'],_0x1e8e8d;}[_0x4301e1(0x1ce)](){const _0x41ee0d=_0x4301e1;this['canvas']&&(this['canvas']['style']['width']=this['_map'][_0x41ee0d(0x1ea)]['canvas'][_0x41ee0d(0x260)]+'px',this['canvas'][_0x41ee0d(0x1bb)]['height']=this['_map'][_0x41ee0d(0x1ea)]['canvas'][_0x41ee0d(0x223)]+'px',this[_0x41ee0d(0x253)]['width']=this['_map'][_0x41ee0d(0x1ea)]['canvas']['clientWidth'],this['canvas']['height']=this['_map'][_0x41ee0d(0x1ea)]['canvas']['clientHeight']);}[_0x4301e1(0x243)](){const _0x2fa50d=_0x4301e1,_0x2d527e=this;let _0x5aefe0=Date[_0x2fa50d(0x215)]();(function _0x2f69ba(){const _0x2f8e68=_0x2fa50d;_0x2d527e['animateFrame']=window['requestAnimationFrame'](_0x2f69ba);if(_0x2d527e['show']&&_0x2d527e[_0x2f8e68(0x24e)]){const _0x1ca291=Date[_0x2f8e68(0x215)](),_0x47d419=_0x1ca291-_0x5aefe0;_0x47d419>_0x2d527e['frameTime']&&(_0x5aefe0=_0x1ca291-_0x47d419%_0x2d527e['frameTime'],_0x2d527e['update']());}}(),window['addEventListener'](_0x2fa50d(0x1ce),this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x2fa50d(0x221)]=![],this['options'][_0x2fa50d(0x210)]&&(this['_map']['on'](mars3d__namespace[_0x2fa50d(0x257)]['wheel'],this[_0x2fa50d(0x1a8)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x2fa50d(0x1da)],this)));}['unbindEvent'](){const _0x524682=_0x4301e1;window[_0x524682(0x27c)](this[_0x524682(0x1ed)]),delete this['animateFrame'],window[_0x524682(0x1d9)]('resize',this[_0x524682(0x1ce)]),this[_0x524682(0x26a)][_0x524682(0x210)]&&(this['_map'][_0x524682(0x256)](mars3d__namespace['EventType']['wheel'],this[_0x524682(0x1a8)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x524682(0x256)](mars3d__namespace['EventType'][_0x524682(0x22b)],this['_onMouseUpEvent'],this),this['_map'][_0x524682(0x256)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x206f75){const _0x526bd4=_0x4301e1;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this[_0x526bd4(0x253)]['style']['visibility']='hidden',this[_0x526bd4(0x274)]=setTimeout(()=>{const _0x237db7=_0x526bd4;if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']=_0x237db7(0x283);},0xc8);}['_onMouseDownEvent'](_0x4549ab){const _0x56e6f2=_0x4301e1;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x56e6f2(0x1a9)],this),this[_0x56e6f2(0x234)]['on'](mars3d__namespace[_0x56e6f2(0x257)]['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x3942f0){const _0x44a2a0=_0x4301e1;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this[_0x44a2a0(0x253)]['style'][_0x44a2a0(0x26b)]='hidden',this[_0x44a2a0(0x221)]=!![]);}[_0x4301e1(0x1da)](_0x20c446){const _0x482b62=_0x4301e1;if(!this['show']||!this[_0x482b62(0x253)])return;this['_map']['off'](mars3d__namespace['EventType'][_0x482b62(0x24c)],this[_0x482b62(0x1a9)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas'][_0x482b62(0x1bb)][_0x482b62(0x26b)]='visible',this['mouse_down']=![],this[_0x482b62(0x221)]=![];}[_0x4301e1(0x1be)](_0x25f69e){const _0x442bf3=_0x4301e1;this[_0x442bf3(0x1ef)](),this['windData']=_0x25f69e,this['windField']['setDate'](_0x25f69e),this['redraw']();}[_0x4301e1(0x216)](){const _0x149edf=_0x4301e1;if(!this['show'])return;this['windField'][_0x149edf(0x268)](this['options']),this['update']();}['update'](){const _0x94de4f=_0x4301e1;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0x2ad6ad=this[_0x94de4f(0x24e)]['getParticles']();this['_drawLines'](_0x2ad6ad);}this['_updateIng']=![];}['_drawLines'](_0x589b22){const _0x57eda0=_0x4301e1;this[_0x57eda0(0x1b8)][_0x57eda0(0x1d6)]='destination-in',this[_0x57eda0(0x1b8)]['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x57eda0(0x212)]),this['canvasContext']['globalCompositeOperation']='lighter',this[_0x57eda0(0x1b8)]['globalAlpha']=0.9;const _0x443793=this[_0x57eda0(0x234)]['scene']['mode']!==Cesium['SceneMode'][_0x57eda0(0x244)],_0xebc0d=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x3de65a=0x0,_0x4f61c4=_0x589b22['length'];_0x3de65a<_0x4f61c4;_0x3de65a++){const _0x3c0dc6=_0x589b22[_0x3de65a],_0x335f37=this['_tomap'](_0x3c0dc6[_0x57eda0(0x213)],_0x3c0dc6['lat'],_0x3c0dc6),_0x4a3fec=this['_tomap'](_0x3c0dc6['tlng'],_0x3c0dc6['tlat'],_0x3c0dc6);if(!_0x335f37||!_0x4a3fec)continue;if(_0x443793&&Math['abs'](_0x335f37[0x0]-_0x4a3fec[0x0])>=_0xebc0d)continue;this['canvasContext'][_0x57eda0(0x227)](),this[_0x57eda0(0x1b8)]['lineWidth']=this['lineWidth'],this[_0x57eda0(0x1b8)]['strokeStyle']=this['_colorRamp']['getColor'](_0x3c0dc6['speed']),this['canvasContext']['moveTo'](_0x335f37[0x0],_0x335f37[0x1]),this['canvasContext']['lineTo'](_0x4a3fec[0x0],_0x4a3fec[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x57eda0(0x1b8)][_0x57eda0(0x204)]=this[_0x57eda0(0x21a)];for(let _0x30593b=0x0,_0x5bcac7=_0x589b22['length'];_0x30593b<_0x5bcac7;_0x30593b++){const _0x543eef=_0x589b22[_0x30593b],_0x4040c4=this[_0x57eda0(0x27a)](_0x543eef['lng'],_0x543eef['lat'],_0x543eef),_0x2f517b=this['_tomap'](_0x543eef['tlng'],_0x543eef['tlat'],_0x543eef);if(!_0x4040c4||!_0x2f517b)continue;if(_0x443793&&Math[_0x57eda0(0x273)](_0x4040c4[0x0]-_0x2f517b[0x0])>=_0xebc0d)continue;this['canvasContext'][_0x57eda0(0x266)](_0x4040c4[0x0],_0x4040c4[0x1]),this[_0x57eda0(0x1b8)][_0x57eda0(0x1af)](_0x2f517b[0x0],_0x2f517b[0x1]);}this[_0x57eda0(0x1b8)]['stroke']();}}['_tomap'](_0x5972f5,_0x5b43e5,_0x256bcd){const _0x1416de=_0x4301e1,_0x3f9b71=Cesium['Cartesian3']['fromDegrees'](_0x5972f5,_0x5b43e5,this['fixedHeight']),_0x3177d5=this['_map']['scene'];if(_0x3177d5['mode']===Cesium['SceneMode']['SCENE3D']){const _0xe2c45f=new Cesium['EllipsoidalOccluder'](_0x3177d5['globe']['ellipsoid'],_0x3177d5['camera'][_0x1416de(0x228)]),_0xfd4d79=_0xe2c45f[_0x1416de(0x1e1)](_0x3f9b71);if(!_0xfd4d79)return _0x256bcd['age']=0x0,null;}const _0x2c9d3a=Cesium[_0x1416de(0x24d)][_0x1416de(0x27d)](this['_map'][_0x1416de(0x1ea)],_0x3f9b71);return _0x2c9d3a?[_0x2c9d3a['x'],_0x2c9d3a['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x45b875=_0x4301e1;this[_0x45b875(0x201)]=new Worker(this['options']['worker']),this['worker'][_0x45b875(0x1a0)]=_0xe6ae51=>{const _0x275278=_0x45b875;this['_drawLines'](_0xe6ae51[_0x275278(0x236)]['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x475404=>{const _0x3dd365=_0x45b875;this[_0x3dd365(0x201)]['postMessage']({'type':'init','options':_0x475404});},'setOptions':_0x9cff71=>{this['worker']['postMessage']({'type':'setOptions','options':_0x9cff71});},'setDate':_0x3d6890=>{const _0x36cd8f=_0x45b875;this[_0x36cd8f(0x201)][_0x36cd8f(0x200)]({'type':'setDate','data':_0x3d6890});},'update':()=>{const _0x3c604f=_0x45b875;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x3c604f(0x201)][_0x3c604f(0x200)]({'type':_0x3c604f(0x252)});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x4301e1(0x19d)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x4301e1(0x202)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports[_0x4301e1(0x1d7)]=WindLayer,exports[_0x4301e1(0x232)]=WindUtil,Object[_0x4301e1(0x1d3)](exports,'__esModule',{'value':!![]});
}));
