/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.0
 * 编译日期：2023-03-16 18:58:40
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2022-10-01
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';var _0x2aba85=_0x4fd9;(function(_0x4a9381,_0x21784a){var _0x2565f0=_0x4fd9,_0xf09db4=_0x4a9381();while(!![]){try{var _0x477672=-parseInt(_0x2565f0(0x248))/0x1+-parseInt(_0x2565f0(0x224))/0x2+-parseInt(_0x2565f0(0x216))/0x3*(-parseInt(_0x2565f0(0x273))/0x4)+parseInt(_0x2565f0(0x263))/0x5+parseInt(_0x2565f0(0x220))/0x6*(-parseInt(_0x2565f0(0x214))/0x7)+parseInt(_0x2565f0(0x1e9))/0x8*(parseInt(_0x2565f0(0x1c0))/0x9)+-parseInt(_0x2565f0(0x20e))/0xa;if(_0x477672===_0x21784a)break;else _0xf09db4['push'](_0xf09db4['shift']());}catch(_0x1434dc){_0xf09db4['push'](_0xf09db4['shift']());}}}(_0x5766,0x965a5));function _interopNamespace(_0x303f0a){var _0x31b48e=_0x4fd9;if(_0x303f0a&&_0x303f0a['__esModule'])return _0x303f0a;var _0x28df76=Object[_0x31b48e(0x20c)](null);return _0x303f0a&&Object[_0x31b48e(0x25d)](_0x303f0a)['forEach'](function(_0x511178){var _0x29e5a2=_0x31b48e;if(_0x511178!==_0x29e5a2(0x1c2)){var _0x17f94a=Object['getOwnPropertyDescriptor'](_0x303f0a,_0x511178);Object[_0x29e5a2(0x25b)](_0x28df76,_0x511178,_0x17f94a['get']?_0x17f94a:{'enumerable':!![],'get':function(){return _0x303f0a[_0x511178];}});}}),_0x28df76[_0x31b48e(0x1c2)]=_0x303f0a,_0x28df76;}var mars3d__namespace=_interopNamespace(mars3d),Cesium$7=mars3d__namespace['Cesium'];function getU(_0x5041fa,_0x270a6a){var _0x41f70c=_0x4fd9,_0x4664b9=_0x5041fa*Math[_0x41f70c(0x1d3)](Cesium$7['Math']['toRadians'](_0x270a6a));return _0x4664b9;}function getV(_0x408a10,_0x4f85fb){var _0x52e73d=_0x4fd9,_0x507f3c=_0x408a10*Math['sin'](Cesium$7[_0x52e73d(0x299)]['toRadians'](_0x4f85fb));return _0x507f3c;}function getSpeed(_0x426abf,_0x5ab266){var _0x278eb5=Math['sqrt'](Math['pow'](_0x426abf,0x2)+Math['pow'](_0x5ab266,0x2));return _0x278eb5;}function getDirection(_0x51e68a,_0x1ff6c3){var _0x323681=_0x4fd9,_0x44a5fe=Cesium$7[_0x323681(0x299)][_0x323681(0x1ec)](Math['atan2'](_0x1ff6c3,_0x51e68a));return _0x44a5fe+=_0x44a5fe<0x0?0x168:0x0,_0x44a5fe;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};function ownKeys(_0x52cdc7,_0x428a70){var _0x2f9a7f=_0x4fd9,_0x50cb81=Object[_0x2f9a7f(0x25d)](_0x52cdc7);if(Object[_0x2f9a7f(0x1db)]){var _0x4b19c0=Object['getOwnPropertySymbols'](_0x52cdc7);_0x428a70&&(_0x4b19c0=_0x4b19c0['filter'](function(_0x50ac0d){var _0x4b0cd0=_0x2f9a7f;return Object['getOwnPropertyDescriptor'](_0x52cdc7,_0x50ac0d)[_0x4b0cd0(0x1ef)];})),_0x50cb81[_0x2f9a7f(0x240)]['apply'](_0x50cb81,_0x4b19c0);}return _0x50cb81;}function _objectSpread2(_0x411d57){var _0x14bb2f=_0x4fd9;for(var _0x326e77=0x1;_0x326e77<arguments['length'];_0x326e77++){var _0x4213c4=null!=arguments[_0x326e77]?arguments[_0x326e77]:{};_0x326e77%0x2?ownKeys(Object(_0x4213c4),!0x0)['forEach'](function(_0x37184b){_defineProperty(_0x411d57,_0x37184b,_0x4213c4[_0x37184b]);}):Object[_0x14bb2f(0x26b)]?Object['defineProperties'](_0x411d57,Object['getOwnPropertyDescriptors'](_0x4213c4)):ownKeys(Object(_0x4213c4))[_0x14bb2f(0x25f)](function(_0x1a39f4){var _0xe8d7fe=_0x14bb2f;Object[_0xe8d7fe(0x25b)](_0x411d57,_0x1a39f4,Object[_0xe8d7fe(0x1e5)](_0x4213c4,_0x1a39f4));});}return _0x411d57;}function _classCallCheck(_0x3a0e35,_0x3f9a0e){if(!(_0x3a0e35 instanceof _0x3f9a0e))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x1a0c1f,_0x38bd75){var _0x2e6891=_0x4fd9;for(var _0x2c37cb=0x0;_0x2c37cb<_0x38bd75[_0x2e6891(0x1bf)];_0x2c37cb++){var _0x40b317=_0x38bd75[_0x2c37cb];_0x40b317[_0x2e6891(0x1ef)]=_0x40b317['enumerable']||![],_0x40b317['configurable']=!![];if(_0x2e6891(0x274)in _0x40b317)_0x40b317[_0x2e6891(0x1d2)]=!![];Object['defineProperty'](_0x1a0c1f,_0x40b317['key'],_0x40b317);}}function _createClass(_0x1fc018,_0x3fea49,_0x364fac){var _0x33fb73=_0x4fd9;if(_0x3fea49)_defineProperties(_0x1fc018['prototype'],_0x3fea49);if(_0x364fac)_defineProperties(_0x1fc018,_0x364fac);return Object['defineProperty'](_0x1fc018,_0x33fb73(0x1a0),{'writable':![]}),_0x1fc018;}function _defineProperty(_0x239ebe,_0xa5ef77,_0x2503a9){return _0xa5ef77 in _0x239ebe?Object['defineProperty'](_0x239ebe,_0xa5ef77,{'value':_0x2503a9,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x239ebe[_0xa5ef77]=_0x2503a9,_0x239ebe;}function _inherits(_0x786570,_0x461861){var _0x1d9daf=_0x4fd9;if(typeof _0x461861!==_0x1d9daf(0x27f)&&_0x461861!==null)throw new TypeError('Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function');_0x786570['prototype']=Object[_0x1d9daf(0x20c)](_0x461861&&_0x461861[_0x1d9daf(0x1a0)],{'constructor':{'value':_0x786570,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x786570,_0x1d9daf(0x1a0),{'writable':![]});if(_0x461861)_setPrototypeOf(_0x786570,_0x461861);}function _getPrototypeOf(_0x44aae2){return _getPrototypeOf=Object['setPrototypeOf']?Object['getPrototypeOf']:function _0x2209cb(_0x3d7cd8){return _0x3d7cd8['__proto__']||Object['getPrototypeOf'](_0x3d7cd8);},_getPrototypeOf(_0x44aae2);}function _setPrototypeOf(_0x90db14,_0x2065b6){var _0x902592=_0x4fd9;return _setPrototypeOf=Object[_0x902592(0x22d)]||function _0x494d5e(_0x4c3aca,_0x47e319){var _0x27fdc8=_0x902592;return _0x4c3aca[_0x27fdc8(0x23e)]=_0x47e319,_0x4c3aca;},_setPrototypeOf(_0x90db14,_0x2065b6);}function _0x5766(){var _0x179d18=['ComponentDatatype','createRenderingTextures','outputTexture','vertexArray','createRenderingFramebuffers','dropRateBump','redraw','226626xHgNRa','hidden','Color','segments','863528zPFEvJ','iterator','EllipsoidalOccluder','max','nextParticlesPosition','FLOAT','getWind','lng','primitives','setPrototypeOf','globe','primitiveType','options','floor','construct','position','textures','maxAge','particlesComputing','applyViewerParameters','ellipsoid','viewerParameters','ymax','CanvasWindField','_tomap','reverseY','__proto__','initWorker','push','ShaderProgram','udata','currentParticlesPosition','WindUtil','visibility','addPrimitives','vertexShaderSource','810150aZimmf','particlesTextureSize','_addedHook','levmin','pointer-events','_onMouseDownEvent','setOptions','getParticles','_onMouseUpEvent','toGridXY','_removedHook','fixedHeight','abs','_drawLines','mouseMove','min','particlesRendering','requestAnimationFrame','createComputingPrimitives','defineProperty','getDefaultRenderState','keys','zIndex','forEach','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','getColorTexture','windField','5504425QiNKPA','bind','_maxAge','uniformMap','destroy','absolute','strokeStyle','shaderProgram','getOwnPropertyDescriptors','width','canrefresh','particlesTextures','lineTo','RenderState','color','createWindTextures','692dPRodx','value','resize','commandToExecute','VertexArray','framebuffer','particles','cols','particlesWind','Cartesian2','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','GeometryAttributes','function','postMessage','Arguments','animateFrame','style','pointerEvents','arrayBufferView','valueOf','lev','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','vdata','height','windTextures','east','dimensions','@@iterator','clear','getFullscreenQuad','name','lonRange','CanvasWindLayer','add','init','destroyObject','clearCommand','lat','Math','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','grid','canvasContext','rawRenderState','prototype','canvasWidth','DISABLE_GL_POSITION_LOG_DEPTH','createParticlesTextures','rows','show','createTexture','context','particleSystem','colors','depthTexture','nextTrailsDepth','LUMINANCE','mouseUp','fillRect','setData','Compute','EventType','framebuffers','postProcessingPosition','OPAQUE','RGB','ALWAYS','rgb(206,255,255)','BufferUsage','data','log','off','_onMapWhellEvent','ShaderSource','array','length','9061677hHzJAF','mouseDown','default','undefined','ymin','_pointerEvents','WindLayer','updatePosition','_onMouseMoveEvent','ClearCommand','call','_showHook','clampToLatitudeRange','globeBoundingSphere','canvasWindy','_mountedHook','frameTime','Framebuffer','writable','cos','random','BaseLayer','nextTrailsColor','SceneMode','speedRate','maxParticles','from','getOwnPropertySymbols','createCommand','toString','Cesium','canvas','mouse_down','scene','Draw','wheel','apply','getOwnPropertyDescriptor','register','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','north','8YeTpWc','dropRate','stroke','toDegrees','xmax','createRawRenderState','enumerable','getUVByPoint','mouseHidden','layer','IDENTITY','postProcessingSpeed','segmentsDepth','attributeLocations','canvasHeight','currentParticlesSpeed','worker','particlesNumber','latRange','camera','fragmentShaderSource','source','_map','commandList','setDate','tlat','drawingBufferHeight','commandType','speedFactor','xmin','SCENE3D','geometry','destroyParticlesTextures','getUVByXY','age','create','mouse_move','2559770vuiuap','visible','BoundingSphere','GeometryAttribute','Cartesian3','lineWidth','7NUmtCn','nextTrails','759Uazskq','windData','lon'];_0x5766=function(){return _0x179d18;};return _0x5766();}function _isNativeReflectConstruct(){var _0x397543=_0x4fd9;if(typeof Reflect===_0x397543(0x1c3)||!Reflect['construct'])return![];if(Reflect[_0x397543(0x232)]['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype'][_0x397543(0x286)][_0x397543(0x1ca)](Reflect['construct'](Boolean,[],function(){})),!![];}catch(_0x55c626){return![];}}function _0x4fd9(_0x48b195,_0x484a91){var _0x576631=_0x5766();return _0x4fd9=function(_0x4fd9f2,_0x533fc0){_0x4fd9f2=_0x4fd9f2-0x19c;var _0x3e3198=_0x576631[_0x4fd9f2];return _0x3e3198;},_0x4fd9(_0x48b195,_0x484a91);}function _assertThisInitialized(_0x52fa84){if(_0x52fa84===void 0x0)throw new ReferenceError('this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called');return _0x52fa84;}function _possibleConstructorReturn(_0xc95bf8,_0x24cd62){if(_0x24cd62&&(typeof _0x24cd62==='object'||typeof _0x24cd62==='function'))return _0x24cd62;else{if(_0x24cd62!==void 0x0)throw new TypeError('Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined');}return _assertThisInitialized(_0xc95bf8);}function _createSuper(_0x24718a){var _0x33f02b=_isNativeReflectConstruct();return function _0x113f4d(){var _0x183377=_getPrototypeOf(_0x24718a),_0x38252f;if(_0x33f02b){var _0x5c80d0=_getPrototypeOf(this)['constructor'];_0x38252f=Reflect['construct'](_0x183377,arguments,_0x5c80d0);}else _0x38252f=_0x183377['apply'](this,arguments);return _possibleConstructorReturn(this,_0x38252f);};}function _toConsumableArray(_0x143c0e){return _arrayWithoutHoles(_0x143c0e)||_iterableToArray(_0x143c0e)||_unsupportedIterableToArray(_0x143c0e)||_nonIterableSpread();}function _arrayWithoutHoles(_0x2db9fd){if(Array['isArray'](_0x2db9fd))return _arrayLikeToArray(_0x2db9fd);}function _iterableToArray(_0x56d977){var _0x139621=_0x4fd9;if(typeof Symbol!=='undefined'&&_0x56d977[Symbol[_0x139621(0x225)]]!=null||_0x56d977[_0x139621(0x28e)]!=null)return Array[_0x139621(0x1da)](_0x56d977);}function _unsupportedIterableToArray(_0x1b67f0,_0x38134e){var _0x1e9e30=_0x4fd9;if(!_0x1b67f0)return;if(typeof _0x1b67f0==='string')return _arrayLikeToArray(_0x1b67f0,_0x38134e);var _0x1bf154=Object['prototype'][_0x1e9e30(0x1dd)]['call'](_0x1b67f0)['slice'](0x8,-0x1);if(_0x1bf154==='Object'&&_0x1b67f0['constructor'])_0x1bf154=_0x1b67f0['constructor'][_0x1e9e30(0x291)];if(_0x1bf154==='Map'||_0x1bf154==='Set')return Array['from'](_0x1b67f0);if(_0x1bf154===_0x1e9e30(0x281)||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/['test'](_0x1bf154))return _arrayLikeToArray(_0x1b67f0,_0x38134e);}function _arrayLikeToArray(_0x1367ac,_0x191e13){if(_0x191e13==null||_0x191e13>_0x1367ac['length'])_0x191e13=_0x1367ac['length'];for(var _0xe5e67e=0x0,_0x15d97d=new Array(_0x191e13);_0xe5e67e<_0x191e13;_0xe5e67e++)_0x15d97d[_0xe5e67e]=_0x1367ac[_0xe5e67e];return _0x15d97d;}function _nonIterableSpread(){throw new TypeError('Invalid\x20attempt\x20to\x20spread\x20non-iterable\x20instance.\x0aIn\x20order\x20to\x20be\x20iterable,\x20non-array\x20objects\x20must\x20have\x20a\x20[Symbol.iterator]()\x20method.');}var Cesium$6=mars3d__namespace['Cesium'],CustomPrimitive=(function(){function _0x37e515(_0x4190c2){var _0x468ac2=_0x4fd9,_0x327638;_classCallCheck(this,_0x37e515),this[_0x468ac2(0x204)]=_0x4190c2['commandType'],this['geometry']=_0x4190c2['geometry'],this[_0x468ac2(0x1f6)]=_0x4190c2['attributeLocations'],this[_0x468ac2(0x22f)]=_0x4190c2['primitiveType'],this['uniformMap']=_0x4190c2['uniformMap'],this[_0x468ac2(0x247)]=_0x4190c2['vertexShaderSource'],this['fragmentShaderSource']=_0x4190c2[_0x468ac2(0x1fd)],this['rawRenderState']=_0x4190c2[_0x468ac2(0x19f)],this['framebuffer']=_0x4190c2[_0x468ac2(0x278)],this[_0x468ac2(0x21b)]=_0x4190c2['outputTexture'],this['autoClear']=(_0x327638=_0x4190c2['autoClear'])!==null&&_0x327638!==void 0x0?_0x327638:![],this['preExecute']=_0x4190c2['preExecute'],this[_0x468ac2(0x1a5)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x468ac2(0x278)],'pass':Cesium$6['Pass'][_0x468ac2(0x1b4)]}));}return _createClass(_0x37e515,[{'key':'createCommand','value':function _0x5c0d98(_0x545a1a){var _0xc0029=_0x4fd9;switch(this[_0xc0029(0x204)]){case'Draw':{var _0x340e6e=Cesium$6['VertexArray']['fromGeometry']({'context':_0x545a1a,'geometry':this[_0xc0029(0x208)],'attributeLocations':this[_0xc0029(0x1f6)],'bufferUsage':Cesium$6[_0xc0029(0x1b8)]['STATIC_DRAW']}),_0x40327f=Cesium$6[_0xc0029(0x241)]['fromCache']({'context':_0x545a1a,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x1bce23=Cesium$6[_0xc0029(0x270)]['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0xc0029(0x22f)],'shaderProgram':_0x40327f,'vertexArray':_0x340e6e,'modelMatrix':Cesium$6['Matrix4'][_0xc0029(0x1f3)],'renderState':_0x1bce23,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0xc0029(0x1fd)],'uniformMap':this[_0xc0029(0x266)],'outputTexture':this['outputTexture'],'persists':!![]});}}}},{'key':'setGeometry','value':function _0x5f20bb(_0x25c012,_0x51f8ec){this['geometry']=_0x51f8ec;var _0x4f979a=Cesium$6['VertexArray']['fromGeometry']({'context':_0x25c012,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x4f979a;}},{'key':'update','value':function _0x7adaf(_0x1c6a7c){var _0x3edb12=_0x4fd9;if(!this['show'])return;if(_0x1c6a7c['mode']!==Cesium$6[_0x3edb12(0x1d7)][_0x3edb12(0x207)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this[_0x3edb12(0x1dc)](_0x1c6a7c[_0x3edb12(0x1a7)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this[_0x3edb12(0x297)])&&_0x1c6a7c[_0x3edb12(0x200)][_0x3edb12(0x240)](this['clearCommand']),_0x1c6a7c[_0x3edb12(0x200)]['push'](this['commandToExecute']);}},{'key':'isDestroyed','value':function _0x19ec3a(){return![];}},{'key':'destroy','value':function _0x29c3e4(){var _0x147f03=_0x4fd9;if(this['clearCommand']){var _0x1a6c67,_0x4d541f;(_0x1a6c67=this[_0x147f03(0x297)])!==null&&_0x1a6c67!==void 0x0&&_0x1a6c67[_0x147f03(0x21c)]&&this['clearCommand'][_0x147f03(0x21c)]['destroy'](),(_0x4d541f=this['clearCommand'])!==null&&_0x4d541f!==void 0x0&&_0x4d541f[_0x147f03(0x26a)]&&this['clearCommand']['shaderProgram'][_0x147f03(0x267)](),delete this[_0x147f03(0x297)];}return this['commandToExecute']&&(this['commandToExecute'][_0x147f03(0x21c)]&&this[_0x147f03(0x276)]['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6[_0x147f03(0x296)](this);}}]),_0x37e515;}()),Cesium$5=mars3d__namespace[_0x2aba85(0x1de)],Util=(function(){var _0x30968c=function _0x4e5e3a(){var _0x36c3c8=_0x4fd9,_0x552104=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x36c3c8(0x27e))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x36c3c8(0x219)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x552104;},_0x474ab7=function _0x61fe5a(_0x4d765b,_0x4ef1cd){var _0x2926f9=_0x4fd9;if(Cesium$5['defined'](_0x4ef1cd)){var _0x212c95={};_0x212c95[_0x2926f9(0x285)]=_0x4ef1cd,_0x4d765b[_0x2926f9(0x1fe)]=_0x212c95;}var _0x4cc437=new Cesium$5['Texture'](_0x4d765b);return _0x4cc437;},_0x4ba9ed=function _0x409c26(_0xac6de,_0xb7a29c,_0x2f55f4){var _0x31309f=_0x4fd9,_0x4e5091=new Cesium$5[(_0x31309f(0x1d1))]({'context':_0xac6de,'colorTextures':[_0xb7a29c],'depthTexture':_0x2f55f4});return _0x4e5091;},_0x5c58ba=function _0x51cacf(_0x465014){var _0x1a8170=_0x4fd9,_0x525b47=!![],_0x91685d=![],_0x33cc31={'viewport':_0x465014['viewport'],'depthTest':_0x465014['depthTest'],'depthMask':_0x465014['depthMask'],'blending':_0x465014['blending']},_0x1e9951=Cesium$5['Appearance'][_0x1a8170(0x25c)](_0x525b47,_0x91685d,_0x33cc31);return _0x1e9951;},_0x3ffeac=function _0xb9c9c2(_0x27ca72){var _0x6bc59c=_0x4fd9,_0x5215a3={},_0x51c133=Cesium$5[_0x6bc59c(0x299)]['mod'](_0x27ca72['west'],Cesium$5['Math']['TWO_PI']),_0x16cd75=Cesium$5[_0x6bc59c(0x299)]['mod'](_0x27ca72[_0x6bc59c(0x28c)],Cesium$5['Math']['TWO_PI']),_0x17eadb=_0x27ca72['width'],_0x40b0d2,_0x58f74a;_0x17eadb>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x40b0d2=0x0,_0x58f74a=Cesium$5[_0x6bc59c(0x299)]['TWO_PI']):_0x16cd75-_0x51c133<_0x17eadb?(_0x40b0d2=_0x51c133,_0x58f74a=_0x51c133+_0x17eadb):(_0x40b0d2=_0x51c133,_0x58f74a=_0x16cd75);_0x5215a3['lon']={'min':Cesium$5['Math']['toDegrees'](_0x40b0d2),'max':Cesium$5[_0x6bc59c(0x299)][_0x6bc59c(0x1ec)](_0x58f74a)};var _0x55a25f=_0x27ca72['south'],_0x5ec692=_0x27ca72[_0x6bc59c(0x1e8)],_0x2d7ef6=_0x27ca72['height'],_0x41ceb5=_0x2d7ef6>Cesium$5['Math']['PI']/0xc?_0x2d7ef6/0x2:0x0,_0x2cd365=Cesium$5['Math'][_0x6bc59c(0x1cc)](_0x55a25f-_0x41ceb5),_0x289dbd=Cesium$5['Math'][_0x6bc59c(0x1cc)](_0x5ec692+_0x41ceb5);return _0x2cd365<-Cesium$5[_0x6bc59c(0x299)]['PI_OVER_THREE']&&(_0x2cd365=-Cesium$5[_0x6bc59c(0x299)]['PI_OVER_TWO']),_0x289dbd>Cesium$5[_0x6bc59c(0x299)]['PI_OVER_THREE']&&(_0x289dbd=Cesium$5['Math']['PI_OVER_TWO']),_0x5215a3['lat']={'min':Cesium$5['Math']['toDegrees'](_0x2cd365),'max':Cesium$5[_0x6bc59c(0x299)]['toDegrees'](_0x289dbd)},_0x5215a3;};return{'getFullscreenQuad':_0x30968c,'createTexture':_0x474ab7,'createFramebuffer':_0x4ba9ed,'createRawRenderState':_0x5c58ba,'viewRectangleToLonLatRange':_0x3ffeac};}()),segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x2aba85(0x19c),screenDraw_frag=_0x2aba85(0x27d),Cesium$4=mars3d__namespace[_0x2aba85(0x1de)],ParticlesRendering=(function(){var _0x968d6a=_0x2aba85;function _0x38b44b(_0x4a6812,_0x4cecd8,_0x503423,_0xd31fb5,_0x1bc790){var _0x512c65=_0x4fd9;_classCallCheck(this,_0x38b44b),this['createRenderingTextures'](_0x4a6812,_0x4cecd8,_0x503423[_0x512c65(0x1a9)]),this[_0x512c65(0x21d)](_0x4a6812),this['createRenderingPrimitives'](_0x4a6812,_0x503423,_0xd31fb5,_0x1bc790);}return _createClass(_0x38b44b,[{'key':_0x968d6a(0x21a),'value':function _0x54caf5(_0x375bfb,_0x3ee954,_0x1965f3){var _0x44bab8=_0x968d6a,_0xb3691e={'context':_0x375bfb,'width':_0x375bfb['drawingBufferWidth'],'height':_0x375bfb['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x13b219={'context':_0x375bfb,'width':_0x375bfb['drawingBufferWidth'],'height':_0x375bfb['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x2ab827=_0x1965f3[_0x44bab8(0x1bf)],_0xdec07f=new Float32Array(_0x2ab827*0x3);for(var _0x22c5e1=0x0;_0x22c5e1<_0x2ab827;_0x22c5e1++){var _0x336a0d=Cesium$4['Color']['fromCssColorString'](_0x1965f3[_0x22c5e1]);_0xdec07f[0x3*_0x22c5e1]=_0x336a0d['red'],_0xdec07f[0x3*_0x22c5e1+0x1]=_0x336a0d['green'],_0xdec07f[0x3*_0x22c5e1+0x2]=_0x336a0d['blue'];}var _0x52242c={'context':_0x375bfb,'width':_0x2ab827,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x44bab8(0x1b5)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x44bab8(0x229)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x44bab8(0x234)]={'segmentsColor':Util['createTexture'](_0xb3691e),'segmentsDepth':Util['createTexture'](_0x13b219),'currentTrailsColor':Util[_0x44bab8(0x1a6)](_0xb3691e),'currentTrailsDepth':Util['createTexture'](_0x13b219),'nextTrailsColor':Util['createTexture'](_0xb3691e),'nextTrailsDepth':Util['createTexture'](_0x13b219),'colorTable':Util['createTexture'](_0x52242c,_0xdec07f)};}},{'key':'createRenderingFramebuffers','value':function _0x3e009e(_0xd26285){var _0x52f37f=_0x968d6a;this[_0x52f37f(0x1b2)]={'segments':Util['createFramebuffer'](_0xd26285,this[_0x52f37f(0x234)]['segmentsColor'],this['textures'][_0x52f37f(0x1f5)]),'currentTrails':Util['createFramebuffer'](_0xd26285,this['textures']['currentTrailsColor'],this[_0x52f37f(0x234)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0xd26285,this['textures'][_0x52f37f(0x1d6)],this[_0x52f37f(0x234)][_0x52f37f(0x1ab)])};}},{'key':'createSegmentsGeometry','value':function _0x2b152b(_0x2ab959){var _0x41ead7=_0x968d6a,_0x2e82e7=0x4,_0x5390ae=[];for(var _0x34010f=0x0;_0x34010f<_0x2ab959['particlesTextureSize'];_0x34010f++){for(var _0x1afdc1=0x0;_0x1afdc1<_0x2ab959[_0x41ead7(0x249)];_0x1afdc1++){for(var _0x10a6bb=0x0;_0x10a6bb<_0x2e82e7;_0x10a6bb++){_0x5390ae['push'](_0x34010f/_0x2ab959['particlesTextureSize']),_0x5390ae['push'](_0x1afdc1/_0x2ab959['particlesTextureSize']);}}}_0x5390ae=new Float32Array(_0x5390ae);var _0x136c18=[],_0x17f33b=[-0x1,0x1],_0x1f1b51=[-0x1,0x1];for(var _0x328bf9=0x0;_0x328bf9<_0x2ab959[_0x41ead7(0x1d9)];_0x328bf9++){for(var _0x1af5bc=0x0;_0x1af5bc<_0x2e82e7/0x2;_0x1af5bc++){for(var _0x22c34e=0x0;_0x22c34e<_0x2e82e7/0x2;_0x22c34e++){_0x136c18['push'](_0x17f33b[_0x1af5bc]),_0x136c18['push'](_0x1f1b51[_0x22c34e]),_0x136c18['push'](0x0);}}}_0x136c18=new Float32Array(_0x136c18);var _0x5777ca=0x6*_0x2ab959['maxParticles'],_0x3f8b56=new Uint32Array(_0x5777ca);for(var _0x4588cf=0x0,_0x14da0b=0x0,_0x308193=0x0;_0x4588cf<_0x2ab959['maxParticles'];_0x4588cf++){_0x3f8b56[_0x14da0b++]=_0x308193+0x0,_0x3f8b56[_0x14da0b++]=_0x308193+0x1,_0x3f8b56[_0x14da0b++]=_0x308193+0x2,_0x3f8b56[_0x14da0b++]=_0x308193+0x2,_0x3f8b56[_0x14da0b++]=_0x308193+0x1,_0x3f8b56[_0x14da0b++]=_0x308193+0x3,_0x308193+=0x4;}var _0x53e4d5=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x41ead7(0x211))]({'componentDatatype':Cesium$4[_0x41ead7(0x219)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x5390ae}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x41ead7(0x229)],'componentsPerAttribute':0x3,'values':_0x136c18})}),'indices':_0x3f8b56});return _0x53e4d5;}},{'key':'createRenderingPrimitives','value':function _0x359602(_0x52460d,_0x3fbadc,_0x1b94c2,_0x2bbc14){var _0xbb73f2=_0x968d6a,_0x9c877=this;this[_0xbb73f2(0x22c)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x3fbadc),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function _0x9f7ca8(){return _0x2bbc14['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function _0x40b165(){var _0x37a505=_0xbb73f2;return _0x2bbc14[_0x37a505(0x26e)]['postProcessingPosition'];},'postProcessingSpeed':function _0x6da2f6(){var _0x91aeea=_0xbb73f2;return _0x2bbc14[_0x91aeea(0x26e)]['postProcessingSpeed'];},'colorTable':function _0x26393c(){return _0x9c877['textures']['colorTable'];},'aspect':function _0x367d45(){var _0x68ee71=_0xbb73f2;return _0x52460d['drawingBufferWidth']/_0x52460d[_0x68ee71(0x203)];},'pixelSize':function _0x51f815(){return _0x1b94c2['pixelSize'];},'lineWidth':function _0x2799d0(){return _0x3fbadc['lineWidth'];},'particleHeight':function _0x4fdce9(){return _0x3fbadc['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0xbb73f2(0x223)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0xbb73f2(0x1e2),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0xbb73f2(0x290)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function _0x3d6ed4(){return _0x9c877['textures']['segmentsColor'];},'segmentsDepthTexture':function _0x25f999(){return _0x9c877['textures']['segmentsDepth'];},'currentTrailsColor':function _0x5de8fd(){var _0x18a2e4=_0xbb73f2;return _0x9c877['framebuffers']['currentTrails'][_0x18a2e4(0x261)](0x0);},'trailsDepthTexture':function _0x1ccc05(){return _0x9c877['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function _0x5a47d6(){return _0x3fbadc['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0xbb73f2(0x1a2)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0xbb73f2(0x1ee)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0xbb73f2(0x1b6)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function _0x243621(){var _0x55d29d=_0xbb73f2,_0xfceaca=_0x9c877['framebuffers']['currentTrails'];_0x9c877['framebuffers']['currentTrails']=_0x9c877['framebuffers'][_0x55d29d(0x215)],_0x9c877['framebuffers']['nextTrails']=_0xfceaca,_0x9c877[_0x55d29d(0x22c)]['trails']['commandToExecute']['framebuffer']=_0x9c877['framebuffers']['nextTrails'],_0x9c877[_0x55d29d(0x22c)]['trails']['clearCommand']['framebuffer']=_0x9c877[_0x55d29d(0x1b2)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0xbb73f2(0x290)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function _0x527bc7(){var _0x3dae8f=_0xbb73f2;return _0x9c877['framebuffers'][_0x3dae8f(0x215)]['getColorTexture'](0x0);},'trailsDepthTexture':function _0x4718f7(){var _0x12833c=_0xbb73f2;return _0x9c877[_0x12833c(0x1b2)]['nextTrails'][_0x12833c(0x1aa)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0xbb73f2(0x1bd))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}]),_0x38b44b;}()),getWind_frag=_0x2aba85(0x1e7),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x2aba85(0x288),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x2aba85(0x260),Cesium$3=mars3d__namespace['Cesium'],ParticlesComputing=(function(){var _0x2f8a44=_0x2aba85;function _0x3836cb(_0x14174e,_0x1be597,_0x5e595a,_0x18c81d){var _0x328f7c=_0x4fd9;_classCallCheck(this,_0x3836cb),this[_0x328f7c(0x1b9)]=_0x1be597,this['createWindTextures'](_0x14174e,_0x1be597),this['createParticlesTextures'](_0x14174e,_0x5e595a,_0x18c81d),this[_0x328f7c(0x25a)](_0x1be597,_0x5e595a,_0x18c81d);}return _createClass(_0x3836cb,[{'key':_0x2f8a44(0x272),'value':function _0x16edd0(_0x164990,_0x3d4d64){var _0x3436c3=_0x2f8a44,_0x13546b={'context':_0x164990,'width':_0x3d4d64['dimensions'][_0x3436c3(0x218)],'height':_0x3d4d64[_0x3436c3(0x28d)][_0x3436c3(0x298)]*(_0x3d4d64['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x3436c3(0x1ac)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x13546b,_0x3d4d64['U']['array']),'V':Util['createTexture'](_0x13546b,_0x3d4d64['V']['array'])};}},{'key':'createParticlesTextures','value':function _0x387caa(_0x446e60,_0x4698c9,_0x1881ca){var _0x47051a=_0x2f8a44,_0x408aa5={'context':_0x446e60,'width':_0x4698c9['particlesTextureSize'],'height':_0x4698c9[_0x47051a(0x249)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x2f2173=this['randomizeParticles'](_0x4698c9['maxParticles'],_0x1881ca),_0x1c8d50=new Float32Array(0x4*_0x4698c9[_0x47051a(0x1d9)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x408aa5),'currentParticlesPosition':Util['createTexture'](_0x408aa5,_0x2f2173),'nextParticlesPosition':Util[_0x47051a(0x1a6)](_0x408aa5,_0x2f2173),'currentParticlesSpeed':Util['createTexture'](_0x408aa5,_0x1c8d50),'nextParticlesSpeed':Util['createTexture'](_0x408aa5,_0x1c8d50),'postProcessingPosition':Util[_0x47051a(0x1a6)](_0x408aa5,_0x2f2173),'postProcessingSpeed':Util['createTexture'](_0x408aa5,_0x1c8d50)};}},{'key':'randomizeParticles','value':function _0x3cc269(_0x11d31d,_0x3bed42){var _0xb61428=_0x2f8a44,_0x3cac71=new Float32Array(0x4*_0x11d31d);for(var _0x4654bd=0x0;_0x4654bd<_0x11d31d;_0x4654bd++){_0x3cac71[0x4*_0x4654bd]=Cesium$3[_0xb61428(0x299)]['randomBetween'](_0x3bed42['lonRange']['x'],_0x3bed42['lonRange']['y']),_0x3cac71[0x4*_0x4654bd+0x1]=Cesium$3['Math']['randomBetween'](_0x3bed42[_0xb61428(0x1fb)]['x'],_0x3bed42[_0xb61428(0x1fb)]['y']),_0x3cac71[0x4*_0x4654bd+0x2]=Cesium$3['Math']['randomBetween'](this[_0xb61428(0x1b9)]['lev']['min'],this['data']['lev']['max']),_0x3cac71[0x4*_0x4654bd+0x3]=0x0;}return _0x3cac71;}},{'key':_0x2f8a44(0x209),'value':function _0x163cc5(){var _0x8ee786=_0x2f8a44,_0x548da6=this;Object['keys'](this[_0x8ee786(0x26e)])[_0x8ee786(0x25f)](function(_0xd60867){_0x548da6['particlesTextures'][_0xd60867]['destroy']();});}},{'key':'createComputingPrimitives','value':function _0x297e92(_0x5d9cee,_0x26845a,_0x38eeb4){var _0x1ef181=_0x2f8a44,_0x53f364=new Cesium$3['Cartesian3'](_0x5d9cee['dimensions']['lon'],_0x5d9cee['dimensions'][_0x1ef181(0x298)],_0x5d9cee[_0x1ef181(0x28d)]['lev']),_0x4fa635=new Cesium$3['Cartesian3'](_0x5d9cee['lon']['min'],_0x5d9cee['lat']['min'],_0x5d9cee['lev']['min']),_0x3448db=new Cesium$3['Cartesian3'](_0x5d9cee['lon']['max'],_0x5d9cee['lat'][_0x1ef181(0x227)],_0x5d9cee['lev']['max']),_0x1a324f=new Cesium$3[(_0x1ef181(0x212))]((_0x3448db['x']-_0x4fa635['x'])/(_0x53f364['x']-0x1),(_0x3448db['y']-_0x4fa635['y'])/(_0x53f364['y']-0x1),_0x53f364['z']>0x1?(_0x3448db['z']-_0x4fa635['z'])/(_0x53f364['z']-0x1):0x1),_0xb0ef4b=new Cesium$3[(_0x1ef181(0x27c))](_0x5d9cee['U']['min'],_0x5d9cee['U'][_0x1ef181(0x227)]),_0x2f5166=new Cesium$3['Cartesian2'](_0x5d9cee['V']['min'],_0x5d9cee['V'][_0x1ef181(0x227)]),_0x510de7=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x1ef181(0x1b0),'uniformMap':{'U':function _0x1f3b20(){var _0x26d6ea=_0x1ef181;return _0x510de7[_0x26d6ea(0x28b)]['U'];},'V':function _0x379d9f(){return _0x510de7['windTextures']['V'];},'currentParticlesPosition':function _0x588936(){return _0x510de7['particlesTextures']['currentParticlesPosition'];},'dimension':function _0x4da87b(){return _0x53f364;},'minimum':function _0x28e899(){return _0x4fa635;},'maximum':function _0x4ec575(){return _0x3448db;},'interval':function _0x1cabe8(){return _0x1a324f;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x1ef181(0x26e)]['particlesWind'],'preExecute':function _0x3f8f79(){var _0x44d478=_0x1ef181;_0x510de7[_0x44d478(0x22c)]['getWind']['commandToExecute'][_0x44d478(0x21b)]=_0x510de7['particlesTextures'][_0x44d478(0x27b)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function _0x10b3db(){return _0x510de7['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function _0x3d6b18(){var _0x3341fb=_0x1ef181;return _0x510de7[_0x3341fb(0x26e)][_0x3341fb(0x27b)];},'uSpeedRange':function _0x4e040f(){return _0xb0ef4b;},'vSpeedRange':function _0x191a00(){return _0x2f5166;},'pixelSize':function _0x2d4075(){return _0x38eeb4['pixelSize'];},'speedFactor':function _0xb703aa(){return _0x26845a['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x1ef181(0x1bd))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function _0x26791a(){var _0x4c462b=_0x1ef181,_0x4fe761=_0x510de7['particlesTextures'][_0x4c462b(0x1f8)];_0x510de7['particlesTextures']['currentParticlesSpeed']=_0x510de7['particlesTextures']['postProcessingSpeed'],_0x510de7['particlesTextures']['postProcessingSpeed']=_0x4fe761,_0x510de7['primitives']['updateSpeed'][_0x4c462b(0x276)][_0x4c462b(0x21b)]=_0x510de7['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function _0x49aeba(){var _0xd4b238=_0x1ef181;return _0x510de7['particlesTextures'][_0xd4b238(0x243)];},'currentParticlesSpeed':function _0x72ea9f(){var _0xa629e6=_0x1ef181;return _0x510de7[_0xa629e6(0x26e)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x1ef181(0x1bd))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function _0x2fbad6(){var _0x2d31a9=_0x1ef181,_0x6430c1=_0x510de7['particlesTextures']['currentParticlesPosition'];_0x510de7[_0x2d31a9(0x26e)]['currentParticlesPosition']=_0x510de7['particlesTextures']['postProcessingPosition'],_0x510de7['particlesTextures'][_0x2d31a9(0x1b3)]=_0x6430c1,_0x510de7[_0x2d31a9(0x22c)][_0x2d31a9(0x1c7)]['commandToExecute']['outputTexture']=_0x510de7['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x1ef181(0x1b0),'uniformMap':{'nextParticlesPosition':function _0x1ead99(){var _0x57ac47=_0x1ef181;return _0x510de7['particlesTextures'][_0x57ac47(0x228)];},'nextParticlesSpeed':function _0xd836b6(){var _0x40efb6=_0x1ef181;return _0x510de7[_0x40efb6(0x26e)]['nextParticlesSpeed'];},'lonRange':function _0x146ad1(){return _0x38eeb4['lonRange'];},'latRange':function _0x2162ff(){return _0x38eeb4['latRange'];},'randomCoefficient':function _0x1ce39e(){var _0x239793=_0x1ef181,_0x5cdb4a=Math[_0x239793(0x1d4)]();return _0x5cdb4a;},'dropRate':function _0x54eb3a(){return _0x26845a['dropRate'];},'dropRateBump':function _0x1090c1(){return _0x26845a['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x1ef181(0x1bd))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x1ef181(0x26e)][_0x1ef181(0x1b3)],'preExecute':function _0x24a49c(){var _0x5ac2b3=_0x1ef181;_0x510de7[_0x5ac2b3(0x22c)][_0x5ac2b3(0x1b3)][_0x5ac2b3(0x276)][_0x5ac2b3(0x21b)]=_0x510de7['particlesTextures'][_0x5ac2b3(0x1b3)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x1ef181(0x1b0),'uniformMap':{'postProcessingPosition':function _0xfff11c(){var _0x16037f=_0x1ef181;return _0x510de7[_0x16037f(0x26e)]['postProcessingPosition'];},'nextParticlesSpeed':function _0x329950(){return _0x510de7['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x1ef181(0x1bd))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function _0x113bd1(){var _0x5b8f8a=_0x1ef181;_0x510de7[_0x5b8f8a(0x22c)]['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x510de7[_0x5b8f8a(0x26e)]['postProcessingSpeed'];}})};}}]),_0x3836cb;}()),Cesium$2=mars3d__namespace[_0x2aba85(0x1de)],ParticleSystem=(function(){function _0x2a6b1d(_0x31ebc0,_0x201ac2,_0x410186,_0x7e6bb1){var _0x386683=_0x4fd9;_classCallCheck(this,_0x2a6b1d),this['context']=_0x31ebc0,_0x201ac2=_objectSpread2({},_0x201ac2);if(_0x201ac2[_0x386683(0x242)]&&_0x201ac2[_0x386683(0x289)]){var _0xe408f3,_0x421204,_0x3ba2d9,_0x22dfc0,_0x4e2fad,_0x125b9b;_0x201ac2[_0x386683(0x28d)]={},_0x201ac2['dimensions']['lon']=_0x201ac2['cols'],_0x201ac2[_0x386683(0x28d)][_0x386683(0x298)]=_0x201ac2['rows'],_0x201ac2[_0x386683(0x28d)][_0x386683(0x287)]=_0x201ac2[_0x386683(0x287)]||0x1,_0x201ac2['lon']={},_0x201ac2[_0x386683(0x218)][_0x386683(0x257)]=_0x201ac2['xmin'],_0x201ac2['lon']['max']=_0x201ac2['xmax'],_0x201ac2[_0x386683(0x298)]={},_0x201ac2[_0x386683(0x298)]['min']=_0x201ac2['ymin'],_0x201ac2[_0x386683(0x298)][_0x386683(0x227)]=_0x201ac2[_0x386683(0x23a)],_0x201ac2['lev']={},_0x201ac2[_0x386683(0x287)][_0x386683(0x257)]=(_0xe408f3=_0x201ac2[_0x386683(0x24b)])!==null&&_0xe408f3!==void 0x0?_0xe408f3:0x1,_0x201ac2['lev']['max']=(_0x421204=_0x201ac2['levmax'])!==null&&_0x421204!==void 0x0?_0x421204:0x1,_0x201ac2['U']={},_0x201ac2['U']['array']=new Float32Array(_0x201ac2['udata']),_0x201ac2['U']['min']=(_0x3ba2d9=_0x201ac2['umin'])!==null&&_0x3ba2d9!==void 0x0?_0x3ba2d9:Math['min'][_0x386683(0x1e4)](Math,_toConsumableArray(_0x201ac2[_0x386683(0x242)])),_0x201ac2['U'][_0x386683(0x227)]=(_0x22dfc0=_0x201ac2['umax'])!==null&&_0x22dfc0!==void 0x0?_0x22dfc0:Math[_0x386683(0x227)]['apply'](Math,_toConsumableArray(_0x201ac2['udata'])),_0x201ac2['V']={},_0x201ac2['V'][_0x386683(0x1be)]=new Float32Array(_0x201ac2[_0x386683(0x289)]),_0x201ac2['V']['min']=(_0x4e2fad=_0x201ac2['vmin'])!==null&&_0x4e2fad!==void 0x0?_0x4e2fad:Math[_0x386683(0x257)]['apply'](Math,_toConsumableArray(_0x201ac2['vdata'])),_0x201ac2['V']['max']=(_0x125b9b=_0x201ac2['vmax'])!==null&&_0x125b9b!==void 0x0?_0x125b9b:Math['max'][_0x386683(0x1e4)](Math,_toConsumableArray(_0x201ac2['vdata']));}this['data']=_0x201ac2,this[_0x386683(0x230)]=_0x410186,this[_0x386683(0x239)]=_0x7e6bb1,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x386683(0x239)],this[_0x386683(0x236)]);}return _createClass(_0x2a6b1d,[{'key':'canvasResize','value':function _0x3976fd(_0x39b457){var _0x29c954=_0x4fd9,_0x3527b9=this;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](function(_0x3a3fc9){_0x3527b9['particlesComputing']['windTextures'][_0x3a3fc9]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this[_0x29c954(0x258)][_0x29c954(0x1b2)])['forEach'](function(_0x5706dc){_0x3527b9['particlesRendering']['framebuffers'][_0x5706dc]['destroy']();}),this['context']=_0x39b457,this['particlesComputing']=new ParticlesComputing(this[_0x29c954(0x1a7)],this[_0x29c954(0x1b9)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x29c954(0x1b9)],this['options'],this[_0x29c954(0x239)],this['particlesComputing']);}},{'key':'clearFramebuffers','value':function _0x1137e1(){var _0x401e41=_0x4fd9,_0x46c74b=this,_0x5ad8ad=new Cesium$2[(_0x401e41(0x1c9))]({'color':new Cesium$2[(_0x401e41(0x222))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x401e41(0x25d)](this['particlesRendering']['framebuffers'])['forEach'](function(_0x4e51c9){var _0x4ec172=_0x401e41;_0x5ad8ad['framebuffer']=_0x46c74b[_0x4ec172(0x258)]['framebuffers'][_0x4e51c9],_0x5ad8ad['execute'](_0x46c74b['context']);});}},{'key':'refreshParticles','value':function _0x5b51d9(_0x110067){var _0x15193e=_0x4fd9;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x15193e(0x1a3)](this['context'],this[_0x15193e(0x230)],this[_0x15193e(0x239)]);if(_0x110067){var _0xc452dd=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives'][_0x15193e(0x223)][_0x15193e(0x208)]=_0xc452dd;var _0x17993d=Cesium$2[_0x15193e(0x277)]['fromGeometry']({'context':this[_0x15193e(0x1a7)],'geometry':_0xc452dd,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2[_0x15193e(0x1b8)]['STATIC_DRAW']});this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x17993d;}}},{'key':'setOptions','value':function _0x3cbed1(_0x55f7d8){var _0x347d02=_0x4fd9,_0x109824=this,_0xf87087=![];this[_0x347d02(0x230)][_0x347d02(0x1d9)]!==_0x55f7d8[_0x347d02(0x1d9)]&&(_0xf87087=!![]),Object['keys'](_0x55f7d8)['forEach'](function(_0x3ada37){_0x109824['options'][_0x3ada37]=_0x55f7d8[_0x3ada37];}),this['refreshParticles'](_0xf87087);}},{'key':'applyViewerParameters','value':function _0x3b5d5d(_0x11c6e9){var _0x32a402=this;Object['keys'](_0x11c6e9)['forEach'](function(_0x465dc4){_0x32a402['viewerParameters'][_0x465dc4]=_0x11c6e9[_0x465dc4];}),this['refreshParticles'](![]);}},{'key':'destroy','value':function _0x5d2b5a(){var _0x48fd37=_0x4fd9,_0x33e443=this;clearTimeout(this[_0x48fd37(0x26d)]),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x48fd37(0x236)]['windTextures'])['forEach'](function(_0x25bf07){_0x33e443['particlesComputing']['windTextures'][_0x25bf07]['destroy']();}),this['particlesRendering'][_0x48fd37(0x234)]['colorTable']['destroy'](),Object[_0x48fd37(0x25d)](this['particlesRendering'][_0x48fd37(0x1b2)])[_0x48fd37(0x25f)](function(_0x237cab){var _0x334ac6=_0x48fd37;_0x33e443['particlesRendering']['framebuffers'][_0x237cab][_0x334ac6(0x267)]();});for(var _0x33940d in this){delete this[_0x33940d];}}}]),_0x2a6b1d;}()),Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x2aba85(0x1d5)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x2aba85(0x1b7)]},WindLayer=function(_0x2a9475){var _0x4d73b6=_0x2aba85;_inherits(_0x21f21e,_0x2a9475);var _0x49dfd9=_createSuper(_0x21f21e);function _0x21f21e(){var _0x5eb889,_0x36c9cf=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x21f21e),_0x36c9cf=_objectSpread2(_objectSpread2({},DEF_OPTIONS),_0x36c9cf),_0x5eb889=_0x49dfd9['call'](this,_0x36c9cf),_0x5eb889['_setOptionsHook'](_0x36c9cf),_0x5eb889;}return _createClass(_0x21f21e,[{'key':_0x4d73b6(0x1f2),'get':function _0x43e751(){var _0x1dd130=_0x4d73b6;return this[_0x1dd130(0x22c)];}},{'key':_0x4d73b6(0x1b9),'get':function _0x1acec0(){return this['_data'];},'set':function _0x424f01(_0x1719be){var _0x13e5a9=_0x4d73b6;this[_0x13e5a9(0x1af)](_0x1719be);}},{'key':'colors','get':function _0x2d3a08(){return this['options']['colors'];},'set':function _0x4dd2e0(_0x74d550){var _0x310be0=_0x4d73b6;this[_0x310be0(0x230)][_0x310be0(0x1a9)]=_0x74d550,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x74d550}),this['resize']();}},{'key':'_mountedHook','value':function _0x23f414(){}},{'key':'_addedHook','value':function _0x4a9031(){var _0x1708be=_0x4d73b6;this['scene']=this['_map']['scene'],this['camera']=this['_map'][_0x1708be(0x1fc)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene'][_0x1708be(0x22c)]['add'](this[_0x1708be(0x22c)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x1708be(0x1cd)]=new Cesium$1[(_0x1708be(0x210))](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this[_0x1708be(0x275)][_0x1708be(0x264)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x1708be(0x1ff)]['on'](mars3d__namespace[_0x1708be(0x1b1)]['wheel'],this[_0x1708be(0x1bc)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x1708be(0x1c1)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x1708be(0x1b1)]['mouseUp'],this[_0x1708be(0x250)],this),this[_0x1708be(0x1ff)]['on'](mars3d__namespace[_0x1708be(0x1b1)]['mouseMove'],this[_0x1708be(0x1c8)],this),this['_data']&&this['setData'](this['_data']);}},{'key':'_removedHook','value':function _0x4e7f9c(){var _0x251b7d=_0x4d73b6;window['removeEventListener']('resize',this['resize']),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x251b7d(0x1bb)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x251b7d(0x1ff)]['off'](mars3d__namespace[_0x251b7d(0x1b1)][_0x251b7d(0x1ad)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x251b7d(0x1ff)]['scene']['primitives']['remove'](this['primitives']);}},{'key':'resize','value':function _0x10112a(){var _0x37be18=_0x4d73b6;if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x37be18(0x1a5)]=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}},{'key':'_onMap_preRenderEvent','value':function _0x10c5a2(_0x563603){var _0x3b9343=_0x4d73b6;this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives'][_0x3b9343(0x1a5)]=!![];}},{'key':_0x4d73b6(0x1bc),'value':function _0x5d99cb(_0x558e3c){var _0x7d6ecb=_0x4d73b6,_0x497f56=this;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this[_0x7d6ecb(0x22c)]['show']=![],this['refreshTimer']=setTimeout(function(){var _0x22e883=_0x7d6ecb;if(!_0x497f56[_0x22e883(0x1a5)])return;_0x497f56[_0x22e883(0x21f)]();},0xc8);}},{'key':'_onMouseDownEvent','value':function _0xee6aeb(_0x2aedff){this['mouse_down']=!![];}},{'key':'_onMouseMoveEvent','value':function _0xf6174a(_0x14e5dc){var _0x24ccc8=_0x4d73b6;if(!this[_0x24ccc8(0x1a5)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x24ccc8(0x20d)]=!![]);}},{'key':'_onMouseUpEvent','value':function _0x3e56ef(_0x25ba08){var _0x318071=_0x4d73b6;if(!this['show']||!this[_0x318071(0x1a8)])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x318071(0x20d)]=![];}},{'key':_0x4d73b6(0x21f),'value':function _0x5e20b5(){var _0x57a00a=_0x4d73b6;if(!this[_0x57a00a(0x1ff)]||!this['show'])return;this['updateViewerParameters'](),this[_0x57a00a(0x1a8)][_0x57a00a(0x237)](this[_0x57a00a(0x239)]),this[_0x57a00a(0x22c)][_0x57a00a(0x1a5)]=!![];}},{'key':'setData','value':function _0x5ed5e0(_0x49357d){var _0x59a2bb=_0x4d73b6;this['_data']=_0x49357d,this[_0x59a2bb(0x1a8)]&&this['particleSystem']['destroy'](),this[_0x59a2bb(0x1a8)]=new ParticleSystem(this['scene']['context'],_0x49357d,this['getOptions'](),this[_0x59a2bb(0x239)]),this['addPrimitives']();}},{'key':'_setOptionsHook','value':function _0x37c9e3(_0x308acd,_0x5cd4e7){if(_0x308acd)for(var _0x26f3dc in _0x308acd){this[_0x26f3dc]=_0x308acd[_0x26f3dc];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}},{'key':'getOptions','value':function _0x4bc15d(){var _0x184993=_0x4d73b6,_0x259555=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this[_0x184993(0x1fa)]=_0x259555*_0x259555,{'particlesTextureSize':_0x259555,'maxParticles':this[_0x184993(0x1fa)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x184993(0x1ea)],'dropRateBump':this[_0x184993(0x21e)],'speedFactor':this[_0x184993(0x205)],'lineWidth':this[_0x184993(0x213)],'colors':this['colors']};}},{'key':_0x4d73b6(0x246),'value':function _0x42e963(){var _0xfbbf8e=_0x4d73b6;this['primitives'][_0xfbbf8e(0x294)](this[_0xfbbf8e(0x1a8)][_0xfbbf8e(0x236)]['primitives'][_0xfbbf8e(0x22a)]),this[_0xfbbf8e(0x22c)]['add'](this['particleSystem']['particlesComputing'][_0xfbbf8e(0x22c)]['updateSpeed']),this['primitives'][_0xfbbf8e(0x294)](this['particleSystem'][_0xfbbf8e(0x236)]['primitives'][_0xfbbf8e(0x1c7)]),this[_0xfbbf8e(0x22c)]['add'](this[_0xfbbf8e(0x1a8)]['particlesComputing']['primitives']['postProcessingPosition']),this[_0xfbbf8e(0x22c)][_0xfbbf8e(0x294)](this['particleSystem']['particlesComputing']['primitives'][_0xfbbf8e(0x1f4)]),this['primitives']['add'](this['particleSystem'][_0xfbbf8e(0x258)]['primitives']['segments']),this[_0xfbbf8e(0x22c)]['add'](this['particleSystem'][_0xfbbf8e(0x258)]['primitives']['trails']),this['primitives'][_0xfbbf8e(0x294)](this['particleSystem'][_0xfbbf8e(0x258)]['primitives']['screen']);}},{'key':'updateViewerParameters','value':function _0x12575c(){var _0x5d0fd2=_0x4d73b6,_0x592264=this['camera']['computeViewRectangle'](this['scene'][_0x5d0fd2(0x22e)][_0x5d0fd2(0x238)]);if(!_0x592264){var _0x3dcd87=this['_map']['getExtent']();_0x592264=Cesium$1['Rectangle']['fromDegrees'](_0x3dcd87[_0x5d0fd2(0x206)],_0x3dcd87['ymin'],_0x3dcd87['xmax'],_0x3dcd87['ymax']);}var _0x4de588=Util['viewRectangleToLonLatRange'](_0x592264);this['viewerParameters'][_0x5d0fd2(0x292)]['x']=_0x4de588['lon'][_0x5d0fd2(0x257)],this['viewerParameters'][_0x5d0fd2(0x292)]['y']=_0x4de588['lon']['max'],this['viewerParameters']['latRange']['x']=_0x4de588['lat']['min'],this['viewerParameters']['latRange']['y']=_0x4de588['lat']['max'];var _0x4864d8=this['camera']['getPixelSize'](this[_0x5d0fd2(0x1cd)],this['scene']['drawingBufferWidth'],this[_0x5d0fd2(0x1e1)]['drawingBufferHeight']);_0x4864d8>0x0&&(this[_0x5d0fd2(0x239)]['pixelSize']=_0x4864d8);}}]),_0x21f21e;}(BaseLayer$1);mars3d__namespace['LayerUtil'][_0x2aba85(0x1e6)]('wind',WindLayer),mars3d__namespace['layer'][_0x2aba85(0x1c6)]=WindLayer;var CanvasParticle=(function(){function _0x1cc759(){_classCallCheck(this,_0x1cc759),this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null;}return _createClass(_0x1cc759,[{'key':'destroy','value':function _0x269732(){for(var _0x15db1f in this){delete this[_0x15db1f];}}}]),_0x1cc759;}()),CanvasWindField=(function(){var _0x35edc4=_0x2aba85;function _0x3a15f7(_0x5945e3){var _0x21906f=_0x4fd9;_classCallCheck(this,_0x3a15f7),this[_0x21906f(0x24e)](_0x5945e3);}return _createClass(_0x3a15f7,[{'key':'speedRate','get':function _0x17ca53(){return this['_speedRate'];},'set':function _0x4fcf6a(_0x305cb7){this['_speedRate']=(0x64-(_0x305cb7>0x63?0x63:_0x305cb7))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}},{'key':'maxAge','get':function _0x3f512a(){return this['_maxAge'];},'set':function _0x4eb70d(_0x56a512){var _0x343d6b=_0x4fd9;this[_0x343d6b(0x265)]=_0x56a512;}},{'key':'setOptions','value':function _0x4093a4(_0x1ad8f1){var _0x6333b5=_0x4fd9;this['options']=_0x1ad8f1,this[_0x6333b5(0x235)]=_0x1ad8f1[_0x6333b5(0x235)]||0x78,this[_0x6333b5(0x1d8)]=_0x1ad8f1['speedRate']||0x32,this[_0x6333b5(0x279)]=[];var _0x2c5fe1=_0x1ad8f1[_0x6333b5(0x1fa)]||0x1000;for(var _0x54d83c=0x0;_0x54d83c<_0x2c5fe1;_0x54d83c++){var _0xe0153f=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0xe0153f);}}},{'key':'setDate','value':function _0x5a15eb(_0x3ab297){var _0x3d707d=_0x4fd9;this[_0x3d707d(0x1a4)]=_0x3ab297['rows'],this['cols']=_0x3ab297['cols'],this['xmin']=_0x3ab297['xmin'],this['xmax']=_0x3ab297['xmax'],this[_0x3d707d(0x1c4)]=_0x3ab297['ymin'],this[_0x3d707d(0x23a)]=_0x3ab297['ymax'],this[_0x3d707d(0x19d)]=[];var _0x3c55ad=_0x3ab297[_0x3d707d(0x242)],_0x326011=_0x3ab297['vdata'],_0x37c318=![];_0x3c55ad[_0x3d707d(0x1bf)]===this['rows']&&_0x3c55ad[0x0]['length']===this[_0x3d707d(0x27a)]&&(_0x37c318=!![]);var _0x4d4c08=0x0,_0x7bfa89=null,_0x4d5358=null;for(var _0xedb158=0x0;_0xedb158<this['rows'];_0xedb158++){_0x7bfa89=[];for(var _0x346db5=0x0;_0x346db5<this['cols'];_0x346db5++,_0x4d4c08++){_0x37c318?_0x4d5358=this['_calcUV'](_0x3c55ad[_0xedb158][_0x346db5],_0x326011[_0xedb158][_0x346db5]):_0x4d5358=this['_calcUV'](_0x3c55ad[_0x4d4c08],_0x326011[_0x4d4c08]),_0x7bfa89[_0x3d707d(0x240)](_0x4d5358);}this['grid']['push'](_0x7bfa89);}this[_0x3d707d(0x230)][_0x3d707d(0x23d)]&&this['grid']['reverse']();}},{'key':_0x35edc4(0x28f),'value':function _0x498143(){var _0xaed2f9=_0x35edc4;delete this['rows'],delete this['cols'],delete this['xmin'],delete this[_0xaed2f9(0x1ed)],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0xaed2f9(0x279)];}},{'key':_0x35edc4(0x251),'value':function _0x195ad3(_0x4fc91d,_0x3e6513){var _0x2b2842=(_0x4fc91d-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x1ec326=(this['ymax']-_0x3e6513)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x2b2842,_0x1ec326];}},{'key':'getUVByXY','value':function _0x52411b(_0x54ffcd,_0x1ad3a7){var _0x219893=_0x35edc4;if(_0x54ffcd<0x0||_0x54ffcd>=this[_0x219893(0x27a)]||_0x1ad3a7>=this[_0x219893(0x1a4)])return[0x0,0x0,0x0];var _0x301542=Math['floor'](_0x54ffcd),_0x3d7a1c=Math[_0x219893(0x231)](_0x1ad3a7);if(_0x301542===_0x54ffcd&&_0x3d7a1c===_0x1ad3a7)return this['grid'][_0x1ad3a7][_0x54ffcd];var _0x83f309=_0x301542+0x1,_0x46c10d=_0x3d7a1c+0x1,_0x4dd939=this[_0x219893(0x20a)](_0x301542,_0x3d7a1c),_0x112af7=this['getUVByXY'](_0x83f309,_0x3d7a1c),_0x47ec3b=this['getUVByXY'](_0x301542,_0x46c10d),_0x51ca1b=this['getUVByXY'](_0x83f309,_0x46c10d),_0x1bb6fd=null;try{_0x1bb6fd=this['_bilinearInterpolation'](_0x54ffcd-_0x301542,_0x1ad3a7-_0x3d7a1c,_0x4dd939,_0x112af7,_0x47ec3b,_0x51ca1b);}catch(_0x206d89){console[_0x219893(0x1ba)](_0x54ffcd,_0x1ad3a7);}return _0x1bb6fd;}},{'key':'_bilinearInterpolation','value':function _0x4228b4(_0x2e64ca,_0x3231b0,_0x4e0754,_0x54680c,_0x329807,_0x4137ff){var _0x15d0fd=0x1-_0x2e64ca,_0x6375c=0x1-_0x3231b0,_0x5e5bce=_0x15d0fd*_0x6375c,_0x5e8e4c=_0x2e64ca*_0x6375c,_0x34f86a=_0x15d0fd*_0x3231b0,_0xad6c9=_0x2e64ca*_0x3231b0,_0x2a2e96=_0x4e0754[0x0]*_0x5e5bce+_0x54680c[0x0]*_0x5e8e4c+_0x329807[0x0]*_0x34f86a+_0x4137ff[0x0]*_0xad6c9,_0x2b8735=_0x4e0754[0x1]*_0x5e5bce+_0x54680c[0x1]*_0x5e8e4c+_0x329807[0x1]*_0x34f86a+_0x4137ff[0x1]*_0xad6c9;return this['_calcUV'](_0x2a2e96,_0x2b8735);}},{'key':'_calcUV','value':function _0x5b47be(_0x1a9ef9,_0x597802){return[+_0x1a9ef9,+_0x597802,Math['sqrt'](_0x1a9ef9*_0x1a9ef9+_0x597802*_0x597802)];}},{'key':'getUVByPoint','value':function _0xfcff3(_0x47a645,_0x3aa0ca){if(!this['isInExtent'](_0x47a645,_0x3aa0ca))return null;var _0x588e37=this['toGridXY'](_0x47a645,_0x3aa0ca),_0x37099e=this['getUVByXY'](_0x588e37[0x0],_0x588e37[0x1]);return _0x37099e;}},{'key':'isInExtent','value':function _0x42dbd9(_0x41cac9,_0x1cb2e5){var _0x464a7c=_0x35edc4;return _0x41cac9>=this['xmin']&&_0x41cac9<=this[_0x464a7c(0x1ed)]&&_0x1cb2e5>=this[_0x464a7c(0x1c4)]&&_0x1cb2e5<=this[_0x464a7c(0x23a)]?!![]:![];}},{'key':'getRandomLatLng','value':function _0x52f2db(){var _0x2b7822=_0x35edc4,_0xaf9823=fRandomByfloat(this[_0x2b7822(0x206)],this[_0x2b7822(0x1ed)]),_0x1703d6=fRandomByfloat(this[_0x2b7822(0x1c4)],this[_0x2b7822(0x23a)]);return{'lat':_0x1703d6,'lng':_0xaf9823};}},{'key':'getParticles','value':function _0x5763f5(){var _0x4a1bc3=_0x35edc4,_0x422636,_0xb43443,_0x5cc893;for(var _0x1f0427=0x0,_0x43af47=this['particles']['length'];_0x1f0427<_0x43af47;_0x1f0427++){var _0x1021e7=this[_0x4a1bc3(0x279)][_0x1f0427];_0x1021e7['age']<=0x0&&(_0x1021e7=this['_randomParticle'](_0x1021e7));if(_0x1021e7['age']>0x0){var _0x51161f=_0x1021e7['tlng'],_0x4af31c=_0x1021e7['tlat'];_0x5cc893=this['getUVByPoint'](_0x51161f,_0x4af31c),_0x5cc893?(_0x422636=_0x51161f+this['_calc_speedRate'][0x0]*_0x5cc893[0x0],_0xb43443=_0x4af31c+this['_calc_speedRate'][0x1]*_0x5cc893[0x1],_0x1021e7[_0x4a1bc3(0x22b)]=_0x51161f,_0x1021e7[_0x4a1bc3(0x298)]=_0x4af31c,_0x1021e7['tlng']=_0x422636,_0x1021e7['tlat']=_0xb43443,_0x1021e7['age']--):_0x1021e7['age']=0x0;}}return this['particles'];}},{'key':'_randomParticle','value':function _0x34cf5a(_0x5e1b25){var _0x37135f=_0x35edc4,_0x25bed9,_0x10cbfd;for(var _0x36b3d8=0x0;_0x36b3d8<0x1e;_0x36b3d8++){_0x25bed9=this['getRandomLatLng'](),_0x10cbfd=this[_0x37135f(0x1f0)](_0x25bed9['lng'],_0x25bed9['lat']);if(_0x10cbfd&&_0x10cbfd[0x2]>0x0)break;}if(!_0x10cbfd)return _0x5e1b25;var _0x3d2641=_0x25bed9['lng']+this['_calc_speedRate'][0x0]*_0x10cbfd[0x0],_0x1f1a84=_0x25bed9['lat']+this['_calc_speedRate'][0x1]*_0x10cbfd[0x1];return _0x5e1b25['lng']=_0x25bed9['lng'],_0x5e1b25[_0x37135f(0x298)]=_0x25bed9['lat'],_0x5e1b25['tlng']=_0x3d2641,_0x5e1b25['tlat']=_0x1f1a84,_0x5e1b25[_0x37135f(0x20b)]=Math['round'](Math[_0x37135f(0x1d4)]()*this['maxAge']),_0x5e1b25;}},{'key':'destroy','value':function _0x46b306(){for(var _0x1f2d02 in this){delete this[_0x1f2d02];}}}]),_0x3a15f7;}());function fRandomByfloat(_0x42c273,_0x38871d){return _0x42c273+Math['random']()*(_0x38871d-_0x42c273);}var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x2aba85(0x1f2)]['BaseLayer'],CanvasWindLayer=function(_0x188024){var _0x37f959=_0x2aba85;_inherits(_0xd833d2,_0x188024);var _0x6b93aa=_createSuper(_0xd833d2);function _0xd833d2(){var _0x3c8bb0=_0x4fd9,_0x3a2410,_0x2554cf=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0xd833d2),_0x3a2410=_0x6b93aa['call'](this,_0x2554cf),_0x3a2410['_setOptionsHook'](_0x2554cf),_0x3a2410[_0x3c8bb0(0x1df)]=null,_0x3a2410;}return _createClass(_0xd833d2,[{'key':'_setOptionsHook','value':function _0x32ee9c(_0x164bf1,_0x4b9a55){var _0x12a5ea=_0x4fd9,_0x4c1295,_0x59116a,_0x5de459;this[_0x12a5ea(0x1d0)]=0x3e8/(_0x164bf1['frameRate']||0xa),this['_pointerEvents']=(_0x4c1295=this['options']['pointerEvents'])!==null&&_0x4c1295!==void 0x0?_0x4c1295:![],this[_0x12a5ea(0x271)]=_0x164bf1['color']||'#ffffff',this['lineWidth']=_0x164bf1['lineWidth']||0x1,this['fixedHeight']=(_0x59116a=_0x164bf1[_0x12a5ea(0x253)])!==null&&_0x59116a!==void 0x0?_0x59116a:0x0,this['reverseY']=(_0x5de459=_0x164bf1[_0x12a5ea(0x23d)])!==null&&_0x5de459!==void 0x0?_0x5de459:![],this[_0x12a5ea(0x262)]&&this['windField'][_0x12a5ea(0x24e)](_0x164bf1);}},{'key':'layer','get':function _0x39cd24(){return this['canvas'];}},{'key':'canvasWidth','get':function _0x47535c(){var _0x43310b=_0x4fd9;return this['_map'][_0x43310b(0x1e1)]['canvas']['clientWidth'];}},{'key':_0x37f959(0x1f7),'get':function _0x1aa056(){return this['_map']['scene']['canvas']['clientHeight'];}},{'key':_0x37f959(0x284),'get':function _0x419a40(){var _0x21d56c=_0x37f959;return this[_0x21d56c(0x1c5)];},'set':function _0xedfa21(_0x309a8d){var _0x5c42aa=_0x37f959;this['_pointerEvents']=_0x309a8d;if(!this['canvas'])return;_0x309a8d?this['canvas']['style'][_0x5c42aa(0x24c)]='all':this['canvas'][_0x5c42aa(0x283)]['pointer-events']='none';}},{'key':'particlesNumber','get':function _0xd1fc19(){return this['options']['particlesNumber'];},'set':function _0x15ffad(_0x241e44){var _0x3dd415=this;this['options']['particlesNumber']=_0x241e44,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(function(){_0x3dd415['redraw']();},0x1f4);}},{'key':_0x37f959(0x1d8),'get':function _0x4f7cf5(){var _0x67809a=_0x37f959;return this[_0x67809a(0x230)]['speedRate'];},'set':function _0x26463c(_0x31ce7e){this['options']['speedRate']=_0x31ce7e,this['windField']&&(this['windField']['speedRate']=_0x31ce7e);}},{'key':_0x37f959(0x235),'get':function _0x1c5a12(){return this['options']['maxAge'];},'set':function _0x41656c(_0x5898f4){this['options']['maxAge']=_0x5898f4,this['windField']&&(this['windField']['maxAge']=_0x5898f4);}},{'key':_0x37f959(0x1b9),'get':function _0x4c2232(){return this['windData'];},'set':function _0x4ce57c(_0x24c077){this['setData'](_0x24c077);}},{'key':_0x37f959(0x1cb),'value':function _0x49aa45(_0x11d706){var _0x846073=_0x37f959;_0x11d706?this['_addedHook']():(this['windData']&&(this['options']['data']=this[_0x846073(0x217)]),this['_removedHook']());}},{'key':_0x37f959(0x1cf),'value':function _0x59de58(){var _0x38bc2f=_0x37f959;this[_0x38bc2f(0x230)]['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}},{'key':_0x37f959(0x24a),'value':function _0xf01e13(){var _0x4ae125=_0x37f959;this['canvas']=this['_createCanvas'](),this[_0x4ae125(0x19e)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options'][_0x4ae125(0x1b9)]);}},{'key':_0x37f959(0x252),'value':function _0x1e2e2e(){this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}},{'key':'_createCanvas','value':function _0x360696(){var _0x3df34a=_0x37f959,_0x26ff35=document['createElement']('canvas');_0x26ff35[_0x3df34a(0x283)][_0x3df34a(0x233)]=_0x3df34a(0x268),_0x26ff35[_0x3df34a(0x283)]['top']='0px',_0x26ff35['style']['left']='0px',_0x26ff35['style']['width']='100%',_0x26ff35['style']['height']='100%',_0x26ff35['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x26ff35['style'][_0x3df34a(0x25e)]=0xa,_0x26ff35['setAttribute']('id','canvasWindy'),_0x26ff35['setAttribute']('class',_0x3df34a(0x1ce)),this['_map']['container']['appendChild'](_0x26ff35);var _0x1f1e5e=this['_map'][_0x3df34a(0x1e1)];return _0x26ff35[_0x3df34a(0x26c)]=_0x1f1e5e['canvas']['clientWidth'],_0x26ff35[_0x3df34a(0x28a)]=_0x1f1e5e['canvas']['clientHeight'],_0x26ff35;}},{'key':'resize','value':function _0x23c276(){var _0x49df90=_0x37f959;this['canvas']&&(this['canvas']['width']=this['canvasWidth'],this[_0x49df90(0x1df)][_0x49df90(0x28a)]=this['canvasHeight']);}},{'key':'bindEvent','value':function _0x5e3ed3(){var _0x5cc7fd=_0x37f959,_0x4b1dc7=this,_0x667021=Date['now']();(function _0x1aba5e(){var _0xa3a202=_0x4fd9;_0x4b1dc7[_0xa3a202(0x282)]=window[_0xa3a202(0x259)](_0x1aba5e);if(_0x4b1dc7['show']&&_0x4b1dc7['windField']){var _0x512e09=Date['now'](),_0x446359=_0x512e09-_0x667021;_0x446359>_0x4b1dc7['frameTime']&&(_0x667021=_0x512e09-_0x446359%_0x4b1dc7['frameTime'],_0x4b1dc7['update']());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x5cc7fd(0x230)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType'][_0x5cc7fd(0x1e3)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x5cc7fd(0x1ff)]['on'](mars3d__namespace[_0x5cc7fd(0x1b1)]['mouseUp'],this['_onMouseUpEvent'],this)));}},{'key':'unbindEvent','value':function _0x4b2ea2(){var _0x35075d=_0x37f959;window['cancelAnimationFrame'](this[_0x35075d(0x282)]),delete this['animateFrame'],window['removeEventListener'](_0x35075d(0x275),this['resize']),this['options'][_0x35075d(0x1f1)]&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x35075d(0x1b1)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x35075d(0x1b1)]['mouseMove'],this['_onMouseMoveEvent'],this));}},{'key':'_onMapWhellEvent','value':function _0x2ce9ae(_0x48bda4){var _0x28fd2a=_0x37f959,_0x986c6e=this;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']=_0x28fd2a(0x221),this['refreshTimer']=setTimeout(function(){var _0x24303b=_0x28fd2a;if(!_0x986c6e['show'])return;_0x986c6e['redraw'](),_0x986c6e['canvas'][_0x24303b(0x283)]['visibility']=_0x24303b(0x20f);},0xc8);}},{'key':_0x37f959(0x24d),'value':function _0x514496(_0x2ffc77){var _0x45beea=_0x37f959;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x45beea(0x256)],this[_0x45beea(0x1c8)],this),this[_0x45beea(0x1ff)]['on'](mars3d__namespace['EventType'][_0x45beea(0x256)],this['_onMouseMoveEvent'],this);}},{'key':'_onMouseMoveEvent','value':function _0x4f30b2(_0x5039a9){var _0x2f9ef1=_0x37f959;if(!this['show']||!this['canvas'])return;this[_0x2f9ef1(0x1e0)]&&(this['canvas']['style'][_0x2f9ef1(0x245)]='hidden',this[_0x2f9ef1(0x20d)]=!![]);}},{'key':'_onMouseUpEvent','value':function _0xa1cc05(_0x1fd05a){var _0x1bd538=_0x37f959;if(!this[_0x1bd538(0x1a5)]||!this['canvas'])return;this[_0x1bd538(0x1ff)]['off'](mars3d__namespace[_0x1bd538(0x1b1)]['mouseMove'],this[_0x1bd538(0x1c8)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}},{'key':'setData','value':function _0x287daa(_0x1ff90d){var _0x464a71=_0x37f959;this[_0x464a71(0x28f)](),this[_0x464a71(0x217)]=_0x1ff90d,this['windField'][_0x464a71(0x201)](_0x1ff90d),this[_0x464a71(0x21f)]();}},{'key':'redraw','value':function _0x55ad92(){var _0x25f7fd=_0x37f959;if(!this[_0x25f7fd(0x1a5)])return;this[_0x25f7fd(0x262)]['setOptions'](this['options']),this['update']();}},{'key':'update','value':function _0x2e8f2e(){var _0x331eae=_0x37f959;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{var _0x189a97=this[_0x331eae(0x262)][_0x331eae(0x24f)]();this['_drawLines'](_0x189a97);}this['_updateIng']=![];}},{'key':_0x37f959(0x255),'value':function _0x4fc78f(_0x2a3061){var _0x763aad=_0x37f959;this[_0x763aad(0x19e)]['globalCompositeOperation']='destination-in',this['canvasContext'][_0x763aad(0x1ae)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9,this['canvasContext']['beginPath'](),this['canvasContext'][_0x763aad(0x213)]=this['lineWidth'],this['canvasContext'][_0x763aad(0x269)]=this['color'];var _0x366cea=this['_map'][_0x763aad(0x1e1)]['mode']!==Cesium['SceneMode'][_0x763aad(0x207)];for(var _0x568e40=0x0,_0xe132a6=_0x2a3061['length'];_0x568e40<_0xe132a6;_0x568e40++){var _0x5ee619=_0x2a3061[_0x568e40],_0x2f5b49=this['_tomap'](_0x5ee619['lng'],_0x5ee619['lat'],_0x5ee619),_0x445b6c=this['_tomap'](_0x5ee619['tlng'],_0x5ee619[_0x763aad(0x202)],_0x5ee619);if(!_0x2f5b49||!_0x445b6c)continue;if(_0x366cea&&Math[_0x763aad(0x254)](_0x2f5b49[0x0]-_0x445b6c[0x0])>=this[_0x763aad(0x1a1)])continue;this['canvasContext']['moveTo'](_0x2f5b49[0x0],_0x2f5b49[0x1]),this[_0x763aad(0x19e)][_0x763aad(0x26f)](_0x445b6c[0x0],_0x445b6c[0x1]);}this['canvasContext'][_0x763aad(0x1eb)]();}},{'key':_0x37f959(0x23c),'value':function _0x457c6a(_0x2c188d,_0x25a1cf,_0x38ed86){var _0x485682=_0x37f959,_0x3985cc=Cesium['Cartesian3']['fromDegrees'](_0x2c188d,_0x25a1cf,this[_0x485682(0x253)]),_0x46b53e=this['_map']['scene'];if(_0x46b53e['mode']===Cesium[_0x485682(0x1d7)][_0x485682(0x207)]){var _0x25fb0d=new Cesium[(_0x485682(0x226))](_0x46b53e['globe']['ellipsoid'],_0x46b53e['camera']['positionWC']),_0xd37e89=_0x25fb0d['isPointVisible'](_0x3985cc);if(!_0xd37e89)return _0x38ed86['age']=0x0,null;}var _0x12f600=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x3985cc);return _0x12f600?[_0x12f600['x'],_0x12f600['y']]:null;}},{'key':'clear','value':function _0x1c180b(){var _0x4850d7=_0x37f959;this['windField']['clear'](),delete this[_0x4850d7(0x217)];}},{'key':_0x37f959(0x23f),'value':function _0x1bfce4(){var _0x5a55e1=_0x37f959,_0xc26367=this;this[_0x5a55e1(0x1f9)]=new Worker(this['options']['worker']),this['worker']['onmessage']=function(_0x5375a6){_0xc26367['_drawLines'](_0x5375a6['data']['particles']),_0xc26367['_updateIng2']=![];},this['windField']={'init':function _0x57f42b(_0xc296d2){_0xc26367['worker']['postMessage']({'type':'init','options':_0xc296d2});},'setOptions':function _0x43e6ae(_0xb64a85){var _0x5dce2a=_0x5a55e1;_0xc26367['worker'][_0x5dce2a(0x280)]({'type':'setOptions','options':_0xb64a85});},'setDate':function _0x57c934(_0x1117bf){var _0xb9fadc=_0x5a55e1;_0xc26367['worker']['postMessage']({'type':_0xb9fadc(0x201),'data':_0x1117bf});},'update':function _0x1ce926(){if(_0xc26367['_updateIng2'])return;_0xc26367['_updateIng2']=!![],_0xc26367['worker']['postMessage']({'type':'update'});},'clear':function _0x28ae99(){_0xc26367['worker']['postMessage']({'type':'clear'});}},this['windField'][_0x5a55e1(0x295)](this['options']);}}]),_0xd833d2;}(BaseLayer);mars3d__namespace['LayerUtil'][_0x2aba85(0x1e6)]('canvasWind',CanvasWindLayer),mars3d__namespace['layer'][_0x2aba85(0x293)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x2aba85(0x244)]=WindUtil,exports[_0x2aba85(0x23b)]=CanvasWindField,exports[_0x2aba85(0x293)]=CanvasWindLayer,exports[_0x2aba85(0x1c6)]=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
