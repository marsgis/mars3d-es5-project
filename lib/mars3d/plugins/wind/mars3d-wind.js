/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.3
 * 编译日期：2023-08-27 22:06:40
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x1b5673=_0x242d;(function(_0x2c3939,_0x550b03){const _0x5f3206=_0x242d,_0x474203=_0x2c3939();while(!![]){try{const _0x48e4a4=parseInt(_0x5f3206(0x136))/0x1*(-parseInt(_0x5f3206(0x150))/0x2)+parseInt(_0x5f3206(0x191))/0x3*(parseInt(_0x5f3206(0x109))/0x4)+-parseInt(_0x5f3206(0x166))/0x5*(parseInt(_0x5f3206(0x173))/0x6)+-parseInt(_0x5f3206(0x120))/0x7+parseInt(_0x5f3206(0x11d))/0x8+parseInt(_0x5f3206(0x105))/0x9*(-parseInt(_0x5f3206(0x178))/0xa)+parseInt(_0x5f3206(0x190))/0xb*(parseInt(_0x5f3206(0x14c))/0xc);if(_0x48e4a4===_0x550b03)break;else _0x474203['push'](_0x474203['shift']());}catch(_0x4aa21c){_0x474203['push'](_0x474203['shift']());}}}(_0x48ea,0xc3de5));function _interopNamespace(_0x17b58d){const _0x3eceee=_0x242d;if(_0x17b58d&&_0x17b58d[_0x3eceee(0x10f)])return _0x17b58d;var _0x122907=Object['create'](null);return _0x17b58d&&Object['keys'](_0x17b58d)[_0x3eceee(0x15d)](function(_0x43875d){const _0x3c9a76=_0x3eceee;if(_0x43875d!=='default'){var _0x5709ec=Object['getOwnPropertyDescriptor'](_0x17b58d,_0x43875d);Object['defineProperty'](_0x122907,_0x43875d,_0x5709ec[_0x3c9a76(0x164)]?_0x5709ec:{'enumerable':!![],'get':function(){return _0x17b58d[_0x43875d];}});}}),_0x122907['default']=_0x17b58d,_0x122907;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x42c41a,_0x4c0995){const _0x5eb797=_0x42c41a*Math['cos'](Cesium$7['Math']['toRadians'](_0x4c0995));return _0x5eb797;}function getV(_0x2f2a60,_0x5a1627){const _0x3b5a6b=_0x2f2a60*Math['sin'](Cesium$7['Math']['toRadians'](_0x5a1627));return _0x3b5a6b;}function getSpeed(_0x4a588f,_0x34b5f2){const _0x164fd1=Math['sqrt'](Math['pow'](_0x4a588f,0x2)+Math['pow'](_0x34b5f2,0x2));return _0x164fd1;}function getDirection(_0x382401,_0x31dfff){let _0x1dc736=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x31dfff,_0x382401));return _0x1dc736+=_0x1dc736<0x0?0x168:0x0,_0x1dc736;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x1b5673(0x16f)];class CustomPrimitive{constructor(_0xc6eddf){const _0x2a91ab=_0x1b5673;this['commandType']=_0xc6eddf['commandType'],this['geometry']=_0xc6eddf['geometry'],this['attributeLocations']=_0xc6eddf['attributeLocations'],this['primitiveType']=_0xc6eddf[_0x2a91ab(0x1ee)],this['uniformMap']=_0xc6eddf[_0x2a91ab(0x1cf)],this['vertexShaderSource']=_0xc6eddf[_0x2a91ab(0x123)],this['fragmentShaderSource']=_0xc6eddf[_0x2a91ab(0x12e)],this[_0x2a91ab(0x1f0)]=_0xc6eddf['rawRenderState'],this[_0x2a91ab(0x1d1)]=_0xc6eddf['framebuffer'],this[_0x2a91ab(0x142)]=_0xc6eddf[_0x2a91ab(0x142)],this['autoClear']=_0xc6eddf[_0x2a91ab(0x119)]??![],this['preExecute']=_0xc6eddf[_0x2a91ab(0x1e4)],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x4f1fff){const _0x2824ca=_0x1b5673;switch(this[_0x2824ca(0x115)]){case'Draw':{const _0x9bfd66=Cesium$6[_0x2824ca(0x1bc)][_0x2824ca(0x172)]({'context':_0x4f1fff,'geometry':this['geometry'],'attributeLocations':this[_0x2824ca(0x187)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0xb57e99=Cesium$6[_0x2824ca(0x158)][_0x2824ca(0x147)]({'context':_0x4f1fff,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x2824ca(0x123)],'fragmentShaderSource':this[_0x2824ca(0x12e)]}),_0x3e2008=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0xb57e99,'vertexArray':_0x9bfd66,'modelMatrix':Cesium$6[_0x2824ca(0x167)]['IDENTITY'],'renderState':_0x3e2008,'uniformMap':this[_0x2824ca(0x1cf)],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x2824ca(0x1d1)],'pass':Cesium$6['Pass'][_0x2824ca(0x10e)],'pickOnly':!![],'owner':this});}case _0x2824ca(0x170):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x2824ca(0x12e)],'uniformMap':this[_0x2824ca(0x1cf)],'outputTexture':this[_0x2824ca(0x142)],'persists':!![]});}}}[_0x1b5673(0x17f)](_0x3180be,_0x2cfa36){this['geometry']=_0x2cfa36;const _0x27bb3c=Cesium$6['VertexArray']['fromGeometry']({'context':_0x3180be,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x27bb3c;}['update'](_0x56c531){const _0x33ab10=_0x1b5673;if(!this[_0x33ab10(0x160)])return;if(_0x56c531[_0x33ab10(0x1be)]!==Cesium$6[_0x33ab10(0x194)]['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this[_0x33ab10(0x1a5)](_0x56c531['context'])),Cesium$6[_0x33ab10(0x1d5)](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x56c531[_0x33ab10(0x18b)][_0x33ab10(0x132)](this['clearCommand']),_0x56c531['commandList']['push'](this[_0x33ab10(0x1d2)]);}['isDestroyed'](){return![];}['destroy'](){const _0x4d94f4=_0x1b5673;if(this['clearCommand']){var _0x171e4d,_0x20f824;(_0x171e4d=this['clearCommand'])!==null&&_0x171e4d!==void 0x0&&_0x171e4d[_0x4d94f4(0x122)]&&this['clearCommand']['vertexArray']['destroy'](),(_0x20f824=this['clearCommand'])!==null&&_0x20f824!==void 0x0&&_0x20f824['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this[_0x4d94f4(0x1d2)]&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute'][_0x4d94f4(0x121)]&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x4d94f4(0x1d2)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0x1b5673(0x16f)],Util=(function(){const _0x44c200=function(){const _0x54063f=_0x242d,_0x111f46=new Cesium$5[(_0x54063f(0x1b0))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x54063f(0x138))]({'componentDatatype':Cesium$5[_0x54063f(0x1e6)][_0x54063f(0x11c)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x54063f(0x1e6)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x111f46;},_0x59b3f0=function(_0x5eaa1e,_0x1b9bde){const _0x54c822=_0x242d;if(Cesium$5['defined'](_0x1b9bde)){const _0x35b760={};_0x35b760[_0x54c822(0x12d)]=_0x1b9bde,_0x5eaa1e[_0x54c822(0x183)]=_0x35b760;}const _0x1ac6f9=new Cesium$5['Texture'](_0x5eaa1e);return _0x1ac6f9;},_0x103835=function(_0x43ebf1,_0x226e62,_0x392036){const _0x3e2b0e=new Cesium$5['Framebuffer']({'context':_0x43ebf1,'colorTextures':[_0x226e62],'depthTexture':_0x392036});return _0x3e2b0e;},_0x432fae=function(_0x411343){const _0x43dac5=!![],_0x3c8859=![],_0x75cd24={'viewport':_0x411343['viewport'],'depthTest':_0x411343['depthTest'],'depthMask':_0x411343['depthMask'],'blending':_0x411343['blending']},_0x28992a=Cesium$5['Appearance']['getDefaultRenderState'](_0x43dac5,_0x3c8859,_0x75cd24);return _0x28992a;},_0xbfc221=function(_0x3d32b4){const _0x3b99be=_0x242d,_0x5d665e={},_0x29350c=Cesium$5[_0x3b99be(0x177)][_0x3b99be(0x106)](_0x3d32b4[_0x3b99be(0x1ac)],Cesium$5['Math'][_0x3b99be(0x174)]),_0x39f0f4=Cesium$5[_0x3b99be(0x177)]['mod'](_0x3d32b4[_0x3b99be(0x1c8)],Cesium$5['Math'][_0x3b99be(0x174)]),_0x8f8be0=_0x3d32b4[_0x3b99be(0x1a3)];let _0xba97a1,_0x53950a;_0x8f8be0>Cesium$5['Math'][_0x3b99be(0x127)]?(_0xba97a1=0x0,_0x53950a=Cesium$5['Math'][_0x3b99be(0x174)]):_0x39f0f4-_0x29350c<_0x8f8be0?(_0xba97a1=_0x29350c,_0x53950a=_0x29350c+_0x8f8be0):(_0xba97a1=_0x29350c,_0x53950a=_0x39f0f4);_0x5d665e['lon']={'min':Cesium$5[_0x3b99be(0x177)]['toDegrees'](_0xba97a1),'max':Cesium$5['Math'][_0x3b99be(0x19d)](_0x53950a)};const _0x9a74de=_0x3d32b4[_0x3b99be(0x1b3)],_0x1dec77=_0x3d32b4['north'],_0x29c946=_0x3d32b4[_0x3b99be(0x1e2)],_0x55ebb5=_0x29c946>Cesium$5['Math']['PI']/0xc?_0x29c946/0x2:0x0;let _0x417ee5=Cesium$5[_0x3b99be(0x177)]['clampToLatitudeRange'](_0x9a74de-_0x55ebb5),_0x206228=Cesium$5['Math']['clampToLatitudeRange'](_0x1dec77+_0x55ebb5);return _0x417ee5<-Cesium$5['Math'][_0x3b99be(0x11f)]&&(_0x417ee5=-Cesium$5['Math']['PI_OVER_TWO']),_0x206228>Cesium$5[_0x3b99be(0x177)]['PI_OVER_THREE']&&(_0x206228=Cesium$5['Math']['PI_OVER_TWO']),_0x5d665e['lat']={'min':Cesium$5['Math']['toDegrees'](_0x417ee5),'max':Cesium$5[_0x3b99be(0x177)][_0x3b99be(0x19d)](_0x206228)},_0x5d665e;};return{'getFullscreenQuad':_0x44c200,'createTexture':_0x59b3f0,'createFramebuffer':_0x103835,'createRawRenderState':_0x432fae,'viewRectangleToLonLatRange':_0xbfc221};}());var segmentDraw_vert=_0x1b5673(0x1c6),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x1b5673(0x1c5),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x1b5673(0x16f)];class ParticlesRendering{constructor(_0xa70ed3,_0x5548cd,_0x1f99bf,_0x1452b0,_0x5a8e25){const _0x42f421=_0x1b5673;this['createRenderingTextures'](_0xa70ed3,_0x5548cd,_0x1f99bf['colors']),this['createRenderingFramebuffers'](_0xa70ed3),this[_0x42f421(0x14a)](_0xa70ed3,_0x1f99bf,_0x1452b0,_0x5a8e25);}['createRenderingTextures'](_0x35808a,_0x500602,_0x4c6a03){const _0x5ea180=_0x1b5673,_0xe005aa={'context':_0x35808a,'width':_0x35808a['drawingBufferWidth'],'height':_0x35808a['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x5ea180(0x1ed)]['UNSIGNED_BYTE']},_0x32c2c8={'context':_0x35808a,'width':_0x35808a['drawingBufferWidth'],'height':_0x35808a['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x27868a=_0x4c6a03['length'],_0x11a674=new Float32Array(_0x27868a*0x3);for(let _0x2fb214=0x0;_0x2fb214<_0x27868a;_0x2fb214++){const _0x45d41a=Cesium$4[_0x5ea180(0x1d0)]['fromCssColorString'](_0x4c6a03[_0x2fb214]);_0x11a674[0x3*_0x2fb214]=_0x45d41a['red'],_0x11a674[0x3*_0x2fb214+0x1]=_0x45d41a['green'],_0x11a674[0x3*_0x2fb214+0x2]=_0x45d41a['blue'];}const _0x544968={'context':_0x35808a,'width':_0x27868a,'height':0x1,'pixelFormat':Cesium$4[_0x5ea180(0x1ae)]['RGB'],'pixelDatatype':Cesium$4[_0x5ea180(0x1ed)]['FLOAT'],'sampler':new Cesium$4[(_0x5ea180(0x197))]({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x5ea180(0x11e)]})};this['textures']={'segmentsColor':Util['createTexture'](_0xe005aa),'segmentsDepth':Util[_0x5ea180(0x19e)](_0x32c2c8),'currentTrailsColor':Util[_0x5ea180(0x19e)](_0xe005aa),'currentTrailsDepth':Util['createTexture'](_0x32c2c8),'nextTrailsColor':Util['createTexture'](_0xe005aa),'nextTrailsDepth':Util['createTexture'](_0x32c2c8),'colorTable':Util['createTexture'](_0x544968,_0x11a674)};}['createRenderingFramebuffers'](_0x4a6a7a){const _0xa24cd2=_0x1b5673;this['framebuffers']={'segments':Util[_0xa24cd2(0x1e8)](_0x4a6a7a,this['textures'][_0xa24cd2(0x1c4)],this[_0xa24cd2(0x143)][_0xa24cd2(0x19b)]),'currentTrails':Util[_0xa24cd2(0x1e8)](_0x4a6a7a,this[_0xa24cd2(0x143)]['currentTrailsColor'],this[_0xa24cd2(0x143)]['currentTrailsDepth']),'nextTrails':Util[_0xa24cd2(0x1e8)](_0x4a6a7a,this['textures']['nextTrailsColor'],this[_0xa24cd2(0x143)][_0xa24cd2(0x1dd)])};}['createSegmentsGeometry'](_0x13efd5){const _0x952780=_0x1b5673,_0x6f5e1c=0x4;let _0x1f35c4=[];for(let _0x546500=0x0;_0x546500<_0x13efd5[_0x952780(0x155)];_0x546500++){for(let _0x1aec16=0x0;_0x1aec16<_0x13efd5['particlesTextureSize'];_0x1aec16++){for(let _0x197393=0x0;_0x197393<_0x6f5e1c;_0x197393++){_0x1f35c4['push'](_0x546500/_0x13efd5[_0x952780(0x155)]),_0x1f35c4[_0x952780(0x132)](_0x1aec16/_0x13efd5['particlesTextureSize']);}}}_0x1f35c4=new Float32Array(_0x1f35c4);let _0x10e57d=[];const _0x12cacd=[-0x1,0x1],_0x5cba4b=[-0x1,0x1];for(let _0x1f9b4f=0x0;_0x1f9b4f<_0x13efd5['maxParticles'];_0x1f9b4f++){for(let _0x199273=0x0;_0x199273<_0x6f5e1c/0x2;_0x199273++){for(let _0x4371f9=0x0;_0x4371f9<_0x6f5e1c/0x2;_0x4371f9++){_0x10e57d['push'](_0x12cacd[_0x199273]),_0x10e57d[_0x952780(0x132)](_0x5cba4b[_0x4371f9]),_0x10e57d['push'](0x0);}}}_0x10e57d=new Float32Array(_0x10e57d);const _0x50bd96=0x6*_0x13efd5[_0x952780(0x1d6)],_0x5d1da5=new Uint32Array(_0x50bd96);for(let _0x33014b=0x0,_0x5f1858=0x0,_0x47ef9a=0x0;_0x33014b<_0x13efd5[_0x952780(0x1d6)];_0x33014b++){_0x5d1da5[_0x5f1858++]=_0x47ef9a+0x0,_0x5d1da5[_0x5f1858++]=_0x47ef9a+0x1,_0x5d1da5[_0x5f1858++]=_0x47ef9a+0x2,_0x5d1da5[_0x5f1858++]=_0x47ef9a+0x2,_0x5d1da5[_0x5f1858++]=_0x47ef9a+0x1,_0x5d1da5[_0x5f1858++]=_0x47ef9a+0x3,_0x47ef9a+=0x4;}const _0x198101=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x952780(0x138))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x1f35c4}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x952780(0x11c)],'componentsPerAttribute':0x3,'values':_0x10e57d})}),'indices':_0x5d1da5});return _0x198101;}['createRenderingPrimitives'](_0x124337,_0x3b5539,_0x299f14,_0x4d004f){const _0x23c711=_0x1b5673,_0x4e2210=this;this[_0x23c711(0x1e7)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x3b5539),'primitiveType':Cesium$4[_0x23c711(0x151)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x4338ea=_0x23c711;return _0x4d004f[_0x4338ea(0x165)][_0x4338ea(0x101)];},'postProcessingPosition':function(){const _0x483d8f=_0x23c711;return _0x4d004f['particlesTextures'][_0x483d8f(0x1c3)];},'postProcessingSpeed':function(){return _0x4d004f['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x2b0e29=_0x23c711;return _0x4e2210['textures'][_0x2b0e29(0x1a4)];},'aspect':function(){const _0x31b9d1=_0x23c711;return _0x124337[_0x31b9d1(0x17e)]/_0x124337['drawingBufferHeight'];},'pixelSize':function(){return _0x299f14['pixelSize'];},'lineWidth':function(){return _0x3b5539['lineWidth'];},'particleHeight':function(){const _0x42d22a=_0x23c711;return _0x3b5539[_0x42d22a(0x124)];}},'vertexShaderSource':new Cesium$4[(_0x23c711(0x18e))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x23c711(0x151)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x4e2210['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x4e2210['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x4e2210['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x3332e6=_0x23c711;return _0x4e2210[_0x3332e6(0x184)]['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x3b5539['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x23c711(0x18e))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x23c711(0x162)],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x23c711(0x169)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x23c711(0x159)],'autoClear':!![],'preExecute':function(){const _0x581094=_0x23c711,_0x946739=_0x4e2210['framebuffers']['currentTrails'];_0x4e2210[_0x581094(0x184)]['currentTrails']=_0x4e2210['framebuffers'][_0x581094(0x159)],_0x4e2210['framebuffers']['nextTrails']=_0x946739,_0x4e2210[_0x581094(0x1e7)]['trails'][_0x581094(0x1d2)][_0x581094(0x1d1)]=_0x4e2210[_0x581094(0x184)][_0x581094(0x159)],_0x4e2210['primitives']['trails']['clearCommand']['framebuffer']=_0x4e2210[_0x581094(0x184)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){return _0x4e2210['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0xff1c83=_0x23c711;return _0x4e2210['framebuffers'][_0xff1c83(0x159)][_0xff1c83(0x113)];}},'vertexShaderSource':new Cesium$4[(_0x23c711(0x18e))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x23c711(0x162)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x1b5673(0x1ca),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x1b5673(0x18f),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x1b5673(0x16f)];function _0x48ea(){const _0x2e9e33=['mouseMove','context','speedFactor','vdata','west','STATIC_DRAW','PixelFormat','length','Geometry','_maxAge','_onMouseMoveEvent','south','TextureMagnificationFilter','_speedRate','refreshParticles','particlesNumber','windTextures','_onMouseDownEvent','wgs84ToWindowCoordinates','options','VertexArray','xmin','mode','0px','resize','SCENE3D','fromDegrees','postProcessingPosition','segmentsColor','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','remove','east','defineProperty','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','particleSystem','setOptions','initWorker','beginPath','uniformMap','Color','framebuffer','commandToExecute','_onMouseUpEvent','particlesRendering','defined','maxParticles','_updateIng','setData','createWindTextures','log','init','canvasResize','nextTrailsDepth','updateSpeed','levmin','lat','_addedHook','height','clientHeight','preExecute','updateViewerParameters','ComponentDatatype','primitives','createFramebuffer','cols','off','array','rgb(206,255,255)','PixelDatatype','primitiveType','positionWC','rawRenderState','computeViewRectangle','ymax','currentParticlesPosition','_showHook','addEventListener','EllipsoidalOccluder','572499oAYtdB','mod','windData','lev','37484KfsFji','postProcessingSpeed','TextureMinificationFilter','randomizeParticles','viewerParameters','OPAQUE','__esModule','unbindEvent','canvasContext','postMessage','depthTexture','frameTime','commandType','mouseUp','max','age','autoClear','once','mouse_move','FLOAT','10844560mnVGFy','LINEAR','PI_OVER_THREE','4066937tBCYXb','shaderProgram','vertexArray','vertexShaderSource','particleHeight','preRender','canvasWidth','THREE_PI_OVER_TWO','particlesWind','add','dropRateBump','fadeOpacity','maxAge','arrayBufferView','fragmentShaderSource','lineTo','particles','lng','push','min','createParticlesTextures','destroyParticlesTextures','30FvVsNc','_mountedHook','GeometryAttribute','mouseDown','mouseHidden','ellipsoid','_updateIng2','CanvasWindField','_map','reverseY','create','particlesComputing','outputTexture','textures','umax','speedRate','frameRate','fromCache','RGBA','container','createRenderingPrimitives','wind','104844nYwGZv','_onMapWhellEvent','moveTo','ymin','13084DQQRDW','PrimitiveType','segments','camera','globalCompositeOperation','particlesTextureSize','data','Cartesian3','ShaderProgram','nextTrails','floor','clearFramebuffers','getUVByXY','forEach','lonRange','applyViewerParameters','show','dimensions','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','cancelAnimationFrame','get','particlesTextures','5TRUiHC','Matrix4','latRange','createRawRenderState','fillRect','keys','tlng','destroy','hidden','Cesium','Compute','style','fromGeometry','1036782VoKOjm','TWO_PI','rows','_onMap_preRenderEvent','Math','50WFzIem','EventType','windField','clientWidth','isInExtent','WindLayer','drawingBufferWidth','setGeometry','_pointerEvents','mouse_down','xmax','source','framebuffers','lon','steps','attributeLocations','update','now','pixelSize','commandList','currentParticlesSpeed','colors','ShaderSource','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','605cDOMFB','75qTlISA','_calc_speedRate','visible','SceneMode','canvas','worker','Sampler','addPrimitives','_createCanvas','_data','segmentsDepth','udata','toDegrees','createTexture','scene','Cartesian2','layer','absolute','width','colorTable','createCommand','grid','getOptions'];_0x48ea=function(){return _0x2e9e33;};return _0x48ea();}function _0x242d(_0x254e92,_0x2a11f3){const _0x48ea71=_0x48ea();return _0x242d=function(_0x242d97,_0x51cfb2){_0x242d97=_0x242d97-0x100;let _0x582a2c=_0x48ea71[_0x242d97];return _0x582a2c;},_0x242d(_0x254e92,_0x2a11f3);}class ParticlesComputing{constructor(_0x50081f,_0x4fcdd8,_0x3b7291,_0x524307){const _0x2d39f7=_0x1b5673;this['data']=_0x4fcdd8,this[_0x2d39f7(0x1d9)](_0x50081f,_0x4fcdd8),this['createParticlesTextures'](_0x50081f,_0x3b7291,_0x524307),this['createComputingPrimitives'](_0x4fcdd8,_0x3b7291,_0x524307);}['createWindTextures'](_0x46a2e2,_0x1b2290){const _0x64fcf0=_0x1b5673,_0x145a86={'context':_0x46a2e2,'width':_0x1b2290['dimensions'][_0x64fcf0(0x185)],'height':_0x1b2290[_0x64fcf0(0x161)][_0x64fcf0(0x1e0)]*(_0x1b2290[_0x64fcf0(0x161)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x64fcf0(0x10b)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x145a86,_0x1b2290['U']['array']),'V':Util[_0x64fcf0(0x19e)](_0x145a86,_0x1b2290['V']['array'])};}[_0x1b5673(0x134)](_0xddc94b,_0x266389,_0x471aa0){const _0x2f3e4a=_0x1b5673,_0x16a79f={'context':_0xddc94b,'width':_0x266389[_0x2f3e4a(0x155)],'height':_0x266389[_0x2f3e4a(0x155)],'pixelFormat':Cesium$3[_0x2f3e4a(0x1ae)][_0x2f3e4a(0x148)],'pixelDatatype':Cesium$3[_0x2f3e4a(0x1ed)][_0x2f3e4a(0x11c)],'flipY':![],'sampler':new Cesium$3[(_0x2f3e4a(0x197))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x2f3e4a(0x1b4)]['NEAREST']})},_0x315910=this[_0x2f3e4a(0x10c)](_0x266389['maxParticles'],_0x471aa0),_0x3e9046=new Float32Array(0x4*_0x266389[_0x2f3e4a(0x1d6)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util[_0x2f3e4a(0x19e)](_0x16a79f),'currentParticlesPosition':Util['createTexture'](_0x16a79f,_0x315910),'nextParticlesPosition':Util['createTexture'](_0x16a79f,_0x315910),'currentParticlesSpeed':Util['createTexture'](_0x16a79f,_0x3e9046),'nextParticlesSpeed':Util[_0x2f3e4a(0x19e)](_0x16a79f,_0x3e9046),'postProcessingPosition':Util['createTexture'](_0x16a79f,_0x315910),'postProcessingSpeed':Util['createTexture'](_0x16a79f,_0x3e9046)};}['randomizeParticles'](_0x503278,_0x44a750){const _0x1e689f=_0x1b5673,_0x42e36b=new Float32Array(0x4*_0x503278);for(let _0x2e5dde=0x0;_0x2e5dde<_0x503278;_0x2e5dde++){_0x42e36b[0x4*_0x2e5dde]=Cesium$3[_0x1e689f(0x177)]['randomBetween'](_0x44a750['lonRange']['x'],_0x44a750[_0x1e689f(0x15e)]['y']),_0x42e36b[0x4*_0x2e5dde+0x1]=Cesium$3['Math']['randomBetween'](_0x44a750[_0x1e689f(0x168)]['x'],_0x44a750[_0x1e689f(0x168)]['y']),_0x42e36b[0x4*_0x2e5dde+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x1e689f(0x108)]['min'],this[_0x1e689f(0x156)]['lev']['max']),_0x42e36b[0x4*_0x2e5dde+0x3]=0x0;}return _0x42e36b;}[_0x1b5673(0x135)](){const _0x234205=_0x1b5673;Object[_0x234205(0x16b)](this['particlesTextures'])[_0x234205(0x15d)](_0x5dde80=>{const _0x34c01c=_0x234205;this[_0x34c01c(0x165)][_0x5dde80][_0x34c01c(0x16d)]();});}['createComputingPrimitives'](_0x3d4122,_0x49a0c8,_0x404fbe){const _0x5fac90=_0x1b5673,_0x2f632d=new Cesium$3[(_0x5fac90(0x157))](_0x3d4122['dimensions'][_0x5fac90(0x185)],_0x3d4122[_0x5fac90(0x161)][_0x5fac90(0x1e0)],_0x3d4122['dimensions']['lev']),_0x18c5f3=new Cesium$3[(_0x5fac90(0x157))](_0x3d4122['lon']['min'],_0x3d4122['lat'][_0x5fac90(0x133)],_0x3d4122[_0x5fac90(0x108)]['min']),_0x28a074=new Cesium$3['Cartesian3'](_0x3d4122[_0x5fac90(0x185)]['max'],_0x3d4122['lat']['max'],_0x3d4122[_0x5fac90(0x108)]['max']),_0xec381c=new Cesium$3[(_0x5fac90(0x157))]((_0x28a074['x']-_0x18c5f3['x'])/(_0x2f632d['x']-0x1),(_0x28a074['y']-_0x18c5f3['y'])/(_0x2f632d['y']-0x1),_0x2f632d['z']>0x1?(_0x28a074['z']-_0x18c5f3['z'])/(_0x2f632d['z']-0x1):0x1),_0x56b7c5=new Cesium$3['Cartesian2'](_0x3d4122['U'][_0x5fac90(0x133)],_0x3d4122['U']['max']),_0x5e4f86=new Cesium$3['Cartesian2'](_0x3d4122['V'][_0x5fac90(0x133)],_0x3d4122['V'][_0x5fac90(0x117)]),_0x4f6d9f=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x4f6d9f['windTextures']['U'];},'V':function(){return _0x4f6d9f['windTextures']['V'];},'currentParticlesPosition':function(){return _0x4f6d9f['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x2f632d;},'minimum':function(){return _0x18c5f3;},'maximum':function(){return _0x28a074;},'interval':function(){return _0xec381c;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x2766e4=_0x5fac90;_0x4f6d9f['primitives']['getWind']['commandToExecute'][_0x2766e4(0x142)]=_0x4f6d9f['particlesTextures'][_0x2766e4(0x128)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x32afb3=_0x5fac90;return _0x4f6d9f[_0x32afb3(0x165)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x4f6d9f['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x56b7c5;},'vSpeedRange':function(){return _0x5e4f86;},'pixelSize':function(){const _0x9a88c0=_0x5fac90;return _0x404fbe[_0x9a88c0(0x18a)];},'speedFactor':function(){return _0x49a0c8['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x5fac90(0x18e))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0xcd6348=_0x5fac90,_0x2e8416=_0x4f6d9f['particlesTextures'][_0xcd6348(0x18c)];_0x4f6d9f[_0xcd6348(0x165)]['currentParticlesSpeed']=_0x4f6d9f[_0xcd6348(0x165)]['postProcessingSpeed'],_0x4f6d9f['particlesTextures']['postProcessingSpeed']=_0x2e8416,_0x4f6d9f['primitives'][_0xcd6348(0x1de)]['commandToExecute']['outputTexture']=_0x4f6d9f['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x2ff5fd=_0x5fac90;return _0x4f6d9f[_0x2ff5fd(0x165)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x4f6d9f['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x5fac90(0x165)]['nextParticlesPosition'],'preExecute':function(){const _0x46fc1c=_0x5fac90,_0x3b59c7=_0x4f6d9f['particlesTextures']['currentParticlesPosition'];_0x4f6d9f['particlesTextures']['currentParticlesPosition']=_0x4f6d9f[_0x46fc1c(0x165)][_0x46fc1c(0x1c3)],_0x4f6d9f['particlesTextures']['postProcessingPosition']=_0x3b59c7,_0x4f6d9f['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x4f6d9f['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x4f6d9f['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x474f17=_0x5fac90;return _0x4f6d9f[_0x474f17(0x165)]['nextParticlesSpeed'];},'lonRange':function(){return _0x404fbe['lonRange'];},'latRange':function(){return _0x404fbe['latRange'];},'randomCoefficient':function(){const _0x1be337=Math['random']();return _0x1be337;},'dropRate':function(){return _0x49a0c8['dropRate'];},'dropRateBump':function(){const _0x2d7426=_0x5fac90;return _0x49a0c8[_0x2d7426(0x12a)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x41135f=_0x5fac90;_0x4f6d9f['primitives']['postProcessingPosition'][_0x41135f(0x1d2)][_0x41135f(0x142)]=_0x4f6d9f['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x5fac90(0x170),'uniformMap':{'postProcessingPosition':function(){return _0x4f6d9f['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x58774e=_0x5fac90;return _0x4f6d9f[_0x58774e(0x165)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0xc03496=_0x5fac90;_0x4f6d9f[_0xc03496(0x1e7)]['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x4f6d9f['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x1b5673(0x16f)];class ParticleSystem{constructor(_0x38dabe,_0x23c718,_0x1bc570,_0x1d938a){const _0x3e23d1=_0x1b5673;this[_0x3e23d1(0x1a9)]=_0x38dabe,_0x23c718={..._0x23c718},_0x23c718['udata']&&_0x23c718['vdata']&&(_0x23c718['dimensions']={},_0x23c718['dimensions']['lon']=_0x23c718['cols'],_0x23c718[_0x3e23d1(0x161)]['lat']=_0x23c718['rows'],_0x23c718[_0x3e23d1(0x161)][_0x3e23d1(0x108)]=_0x23c718['lev']||0x1,_0x23c718[_0x3e23d1(0x185)]={},_0x23c718['lon']['min']=_0x23c718[_0x3e23d1(0x1bd)],_0x23c718['lon'][_0x3e23d1(0x117)]=_0x23c718[_0x3e23d1(0x182)],_0x23c718['lat']={},_0x23c718['lat']['min']=_0x23c718['ymin'],_0x23c718[_0x3e23d1(0x1e0)]['max']=_0x23c718['ymax'],_0x23c718['lev']={},_0x23c718['lev']['min']=_0x23c718[_0x3e23d1(0x1df)]??0x1,_0x23c718['lev']['max']=_0x23c718['levmax']??0x1,_0x23c718['U']={},_0x23c718['U'][_0x3e23d1(0x1eb)]=new Float32Array(_0x23c718['udata']),_0x23c718['U']['min']=_0x23c718['umin']??Math['min'](..._0x23c718['udata']),_0x23c718['U']['max']=_0x23c718[_0x3e23d1(0x144)]??Math[_0x3e23d1(0x117)](..._0x23c718[_0x3e23d1(0x19c)]),_0x23c718['V']={},_0x23c718['V'][_0x3e23d1(0x1eb)]=new Float32Array(_0x23c718['vdata']),_0x23c718['V']['min']=_0x23c718['vmin']??Math['min'](..._0x23c718['vdata']),_0x23c718['V']['max']=_0x23c718['vmax']??Math['max'](..._0x23c718['vdata'])),this[_0x3e23d1(0x156)]=_0x23c718,this['options']=_0x1bc570,this['viewerParameters']=_0x1d938a,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x3e23d1(0x10d)]),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x377f9b){const _0x472c6e=_0x1b5673;this[_0x472c6e(0x141)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x472c6e(0x1b8)])['forEach'](_0x20bace=>{const _0x2ea159=_0x472c6e;this['particlesComputing'][_0x2ea159(0x1b8)][_0x20bace]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x12cd0f=>{const _0x2168a4=_0x472c6e;this[_0x2168a4(0x1d4)][_0x2168a4(0x184)][_0x12cd0f]['destroy']();}),this['context']=_0x377f9b,this['particlesComputing']=new ParticlesComputing(this[_0x472c6e(0x1a9)],this[_0x472c6e(0x156)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x472c6e(0x1a9)],this[_0x472c6e(0x156)],this[_0x472c6e(0x1bb)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x5e695d=_0x1b5673,_0x3e7a49=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x5e695d(0x10e)]});Object['keys'](this['particlesRendering'][_0x5e695d(0x184)])['forEach'](_0x2e0745=>{const _0x149dcb=_0x5e695d;_0x3e7a49[_0x149dcb(0x1d1)]=this[_0x149dcb(0x1d4)]['framebuffers'][_0x2e0745],_0x3e7a49['execute'](this[_0x149dcb(0x1a9)]);});}['refreshParticles'](_0x54cf33){const _0x49c57d=_0x1b5673;this[_0x49c57d(0x15b)](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x49c57d(0x141)]['createParticlesTextures'](this[_0x49c57d(0x1a9)],this['options'],this[_0x49c57d(0x10d)]);if(_0x54cf33){var _0x5d075a,_0x2476a5;const _0xace8ee=this[_0x49c57d(0x1d4)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives'][_0x49c57d(0x152)]['geometry']=_0xace8ee;const _0x584c9d=Cesium$2[_0x49c57d(0x1bc)]['fromGeometry']({'context':this['context'],'geometry':_0xace8ee,'attributeLocations':this['particlesRendering'][_0x49c57d(0x1e7)][_0x49c57d(0x152)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x49c57d(0x1ad)]});(_0x5d075a=this['particlesRendering']['primitives'])!==null&&_0x5d075a!==void 0x0&&(_0x2476a5=_0x5d075a[_0x49c57d(0x152)])!==null&&_0x2476a5!==void 0x0&&_0x2476a5['commandToExecute']&&(this['particlesRendering']['primitives']['segments'][_0x49c57d(0x1d2)]['vertexArray']=_0x584c9d);}}['setOptions'](_0x3c4635){const _0x3dcf94=_0x1b5673;let _0x29c4cd=![];this['options'][_0x3dcf94(0x1d6)]!==_0x3c4635[_0x3dcf94(0x1d6)]&&(_0x29c4cd=!![]),Object['keys'](_0x3c4635)['forEach'](_0x2be614=>{this['options'][_0x2be614]=_0x3c4635[_0x2be614];}),this[_0x3dcf94(0x1b6)](_0x29c4cd);}[_0x1b5673(0x15f)](_0x1a3584){Object['keys'](_0x1a3584)['forEach'](_0x1e28fb=>{const _0x5a479c=_0x242d;this[_0x5a479c(0x10d)][_0x1e28fb]=_0x1a3584[_0x1e28fb];}),this['refreshParticles'](![]);}[_0x1b5673(0x16d)](){const _0x38d927=_0x1b5673;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x38d927(0x15d)](_0x1a2eec=>{const _0x1bb44d=_0x38d927;this['particlesComputing'][_0x1bb44d(0x1b8)][_0x1a2eec][_0x1bb44d(0x16d)]();}),this[_0x38d927(0x1d4)]['textures']['colorTable']['destroy'](),Object[_0x38d927(0x16b)](this['particlesRendering']['framebuffers'])[_0x38d927(0x15d)](_0x2e4642=>{const _0x4b48c1=_0x38d927;this['particlesRendering'][_0x4b48c1(0x184)][_0x2e4642]['destroy']();});for(const _0x1a19d4 in this){delete this[_0x1a19d4];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x1b5673(0x1ec)]};class WindLayer extends BaseLayer$1{constructor(_0x41b0ed={}){_0x41b0ed={...DEF_OPTIONS,..._0x41b0ed},super(_0x41b0ed),this['_setOptionsHook'](_0x41b0ed);}get[_0x1b5673(0x1a1)](){return this['primitives'];}get['data'](){return this['_data'];}set[_0x1b5673(0x156)](_0x4b3fee){this['setData'](_0x4b3fee);}get[_0x1b5673(0x18d)](){const _0x98f38b=_0x1b5673;return this['options'][_0x98f38b(0x18d)];}set['colors'](_0x6cc4aa){const _0xdbded4=_0x1b5673;this['options'][_0xdbded4(0x18d)]=_0x6cc4aa,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x6cc4aa}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x36aac6=_0x1b5673;this['scene']=this['_map']['scene'],this['camera']=this[_0x36aac6(0x13e)]['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene'][_0x36aac6(0x1e7)]['add'](this[_0x36aac6(0x1e7)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x36aac6(0x1a0))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x36aac6(0x1e5)](),window[_0x36aac6(0x103)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x36aac6(0x14d)],this),this[_0x36aac6(0x13e)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x36aac6(0x1b9)],this),this['_map']['on'](mars3d__namespace[_0x36aac6(0x179)]['mouseUp'],this[_0x36aac6(0x1d3)],this),this[_0x36aac6(0x13e)]['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x36aac6(0x1b2)],this),this[_0x36aac6(0x19a)]&&this['setData'](this['_data']);}['_removedHook'](){const _0x2dcf09=_0x1b5673;window['removeEventListener'](_0x2dcf09(0x1c0),this[_0x2dcf09(0x1c0)]),this['_map']['off'](mars3d__namespace['EventType'][_0x2dcf09(0x125)],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x2dcf09(0x14d)],this),this['_map']['off'](mars3d__namespace[_0x2dcf09(0x179)][_0x2dcf09(0x139)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x2dcf09(0x13e)][_0x2dcf09(0x1ea)](mars3d__namespace[_0x2dcf09(0x179)]['mouseMove'],this[_0x2dcf09(0x1b2)],this),this['primitives']['removeAll'](),this['_map']['scene'][_0x2dcf09(0x1e7)][_0x2dcf09(0x1c7)](this['primitives']);}['resize'](){const _0x1fb0d8=_0x1b5673;if(!this['show']||!this['particleSystem'])return;this[_0x1fb0d8(0x1e7)][_0x1fb0d8(0x160)]=![],this['primitives']['removeAll'](),this['_map'][_0x1fb0d8(0x11a)](mars3d__namespace['EventType'][_0x1fb0d8(0x125)],this['_onMap_preRenderEvent'],this);}[_0x1b5673(0x176)](_0x41d292){const _0x52c545=_0x1b5673;this['particleSystem'][_0x52c545(0x1dc)](this['scene']['context']),this[_0x52c545(0x198)](),this['primitives']['show']=!![];}[_0x1b5673(0x14d)](_0x1391d9){const _0x395f38=_0x1b5673;clearTimeout(this['refreshTimer']);if(!this[_0x395f38(0x160)]||!this['particleSystem'])return;this['primitives'][_0x395f38(0x160)]=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x1b5673(0x1b9)](_0x10c5b3){this['mouse_down']=!![];}[_0x1b5673(0x1b2)](_0x28abd4){const _0x5b787e=_0x1b5673;if(!this['show']||!this['particleSystem'])return;this[_0x5b787e(0x181)]&&(this[_0x5b787e(0x1e7)]['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x435b85){const _0x36d530=_0x1b5673;if(!this[_0x36d530(0x160)]||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x36d530(0x1e7)][_0x36d530(0x160)]=!![],this[_0x36d530(0x181)]=![],this[_0x36d530(0x11b)]=![];}['redraw'](){const _0x42e26a=_0x1b5673;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0x42e26a(0x1cb)][_0x42e26a(0x15f)](this[_0x42e26a(0x10d)]),this['primitives'][_0x42e26a(0x160)]=!![];}['setData'](_0xba183d){const _0x724d71=_0x1b5673;this['_data']=_0xba183d,this['particleSystem']&&this['particleSystem'][_0x724d71(0x16d)](),this['particleSystem']=new ParticleSystem(this['scene'][_0x724d71(0x1a9)],_0xba183d,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x2f2f56,_0x18d907){if(_0x2f2f56)for(const _0x323838 in _0x2f2f56){this[_0x323838]=_0x2f2f56[_0x323838];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x1b5673(0x1a7)](){const _0x16e71c=_0x1b5673,_0x3505d8=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this[_0x16e71c(0x1b7)]=_0x3505d8*_0x3505d8,{'particlesTextureSize':_0x3505d8,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x16e71c(0x12b)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x16e71c(0x1aa)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x44d64f=_0x1b5673;this['primitives'][_0x44d64f(0x129)](this['particleSystem'][_0x44d64f(0x141)]['primitives']['getWind']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x44d64f(0x1de)]),this['primitives']['add'](this[_0x44d64f(0x1cb)][_0x44d64f(0x141)]['primitives']['updatePosition']),this[_0x44d64f(0x1e7)]['add'](this[_0x44d64f(0x1cb)]['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem'][_0x44d64f(0x141)]['primitives'][_0x44d64f(0x10a)]),this[_0x44d64f(0x1e7)][_0x44d64f(0x129)](this['particleSystem']['particlesRendering'][_0x44d64f(0x1e7)]['segments']),this[_0x44d64f(0x1e7)]['add'](this['particleSystem'][_0x44d64f(0x1d4)][_0x44d64f(0x1e7)]['trails']),this[_0x44d64f(0x1e7)]['add'](this[_0x44d64f(0x1cb)]['particlesRendering'][_0x44d64f(0x1e7)]['screen']);}['updateViewerParameters'](){const _0x432e2c=_0x1b5673;let _0x2e324c=this[_0x432e2c(0x153)][_0x432e2c(0x1f1)](this['scene']['globe'][_0x432e2c(0x13b)]);if(!_0x2e324c){const _0x5346dc=this['_map']['getExtent']();_0x2e324c=Cesium$1['Rectangle'][_0x432e2c(0x1c2)](_0x5346dc[_0x432e2c(0x1bd)],_0x5346dc['ymin'],_0x5346dc['xmax'],_0x5346dc[_0x432e2c(0x100)]);}const _0x260053=Util['viewRectangleToLonLatRange'](_0x2e324c);this['viewerParameters']['lonRange']['x']=_0x260053['lon']['min'],this[_0x432e2c(0x10d)]['lonRange']['y']=_0x260053[_0x432e2c(0x185)][_0x432e2c(0x117)],this[_0x432e2c(0x10d)][_0x432e2c(0x168)]['x']=_0x260053[_0x432e2c(0x1e0)]['min'],this['viewerParameters']['latRange']['y']=_0x260053['lat']['max'];const _0x374326=this[_0x432e2c(0x153)]['getPixelSize'](this['globeBoundingSphere'],this['scene'][_0x432e2c(0x17e)],this['scene']['drawingBufferHeight']);_0x374326>0x0&&(this['viewerParameters'][_0x432e2c(0x18a)]=_0x374326);}}mars3d__namespace['LayerUtil']['register'](_0x1b5673(0x14b),WindLayer),mars3d__namespace['layer'][_0x1b5673(0x17d)]=WindLayer;class CanvasParticle{constructor(){const _0x56fe13=_0x1b5673;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x56fe13(0x118)]=null,this['speed']=null;}['destroy'](){for(const _0x29031c in this){delete this[_0x29031c];}}}class CanvasWindField{constructor(_0x391977){this['setOptions'](_0x391977);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x786dbc){const _0x25bb03=_0x1b5673;this['_speedRate']=(0x64-(_0x786dbc>0x63?0x63:_0x786dbc))*0x64,this['_calc_speedRate']=[(this[_0x25bb03(0x182)]-this['xmin'])/this[_0x25bb03(0x1b5)],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set[_0x1b5673(0x12c)](_0x351194){const _0xcca99d=_0x1b5673;this[_0xcca99d(0x1b1)]=_0x351194;}[_0x1b5673(0x1cc)](_0x4b5d0c){const _0x5d7bb7=_0x1b5673;this['options']=_0x4b5d0c,this['maxAge']=_0x4b5d0c['maxAge']||0x78,this['speedRate']=_0x4b5d0c['speedRate']||0x32,this['particles']=[];const _0x25be38=_0x4b5d0c[_0x5d7bb7(0x1b7)]||0x1000;for(let _0x13fe5d=0x0;_0x13fe5d<_0x25be38;_0x13fe5d++){const _0x116a2f=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x116a2f);}}['setDate'](_0x27d6a3){const _0x34f2dc=_0x1b5673;this['rows']=_0x27d6a3['rows'],this['cols']=_0x27d6a3['cols'],this['xmin']=_0x27d6a3['xmin'],this['xmax']=_0x27d6a3['xmax'],this['ymin']=_0x27d6a3[_0x34f2dc(0x14f)],this[_0x34f2dc(0x100)]=_0x27d6a3['ymax'],this['grid']=[];const _0x511960=_0x27d6a3['udata'],_0x423da8=_0x27d6a3[_0x34f2dc(0x1ab)];let _0x18b184=![];_0x511960[_0x34f2dc(0x1af)]===this['rows']&&_0x511960[0x0]['length']===this['cols']&&(_0x18b184=!![]);let _0x248243=0x0,_0x2dd0b8=null,_0x2945dd=null;for(let _0x8b0b8e=0x0;_0x8b0b8e<this['rows'];_0x8b0b8e++){_0x2dd0b8=[];for(let _0x241623=0x0;_0x241623<this['cols'];_0x241623++,_0x248243++){_0x18b184?_0x2945dd=this['_calcUV'](_0x511960[_0x8b0b8e][_0x241623],_0x423da8[_0x8b0b8e][_0x241623]):_0x2945dd=this['_calcUV'](_0x511960[_0x248243],_0x423da8[_0x248243]),_0x2dd0b8[_0x34f2dc(0x132)](_0x2945dd);}this[_0x34f2dc(0x1a6)]['push'](_0x2dd0b8);}this[_0x34f2dc(0x1bb)]['reverseY']&&this[_0x34f2dc(0x1a6)]['reverse']();}['clear'](){const _0x543676=_0x1b5673;delete this['rows'],delete this[_0x543676(0x1e9)],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this[_0x543676(0x1a6)],delete this[_0x543676(0x130)];}['toGridXY'](_0x2b8665,_0x41ca60){const _0x443168=_0x1b5673,_0x39d19a=(_0x2b8665-this[_0x443168(0x1bd)])/(this['xmax']-this[_0x443168(0x1bd)])*(this[_0x443168(0x1e9)]-0x1),_0x4d460a=(this[_0x443168(0x100)]-_0x41ca60)/(this[_0x443168(0x100)]-this['ymin'])*(this[_0x443168(0x175)]-0x1);return[_0x39d19a,_0x4d460a];}['getUVByXY'](_0x19d70e,_0x4ee0b6){const _0x1247bd=_0x1b5673;if(_0x19d70e<0x0||_0x19d70e>=this['cols']||_0x4ee0b6>=this['rows'])return[0x0,0x0,0x0];const _0x3cb716=Math['floor'](_0x19d70e),_0x36c37f=Math[_0x1247bd(0x15a)](_0x4ee0b6);if(_0x3cb716===_0x19d70e&&_0x36c37f===_0x4ee0b6)return this['grid'][_0x4ee0b6][_0x19d70e];const _0x3c8b7c=_0x3cb716+0x1,_0x4301ff=_0x36c37f+0x1,_0x38f717=this['getUVByXY'](_0x3cb716,_0x36c37f),_0x16cede=this[_0x1247bd(0x15c)](_0x3c8b7c,_0x36c37f),_0x3f355f=this['getUVByXY'](_0x3cb716,_0x4301ff),_0x4e0e96=this[_0x1247bd(0x15c)](_0x3c8b7c,_0x4301ff);let _0x2f38be=null;try{_0x2f38be=this['_bilinearInterpolation'](_0x19d70e-_0x3cb716,_0x4ee0b6-_0x36c37f,_0x38f717,_0x16cede,_0x3f355f,_0x4e0e96);}catch(_0x4f8a5a){console[_0x1247bd(0x1da)](_0x19d70e,_0x4ee0b6);}return _0x2f38be;}['_bilinearInterpolation'](_0x616b95,_0x1289da,_0x40f60c,_0x13d3a2,_0x598ddd,_0x47f129){const _0x1867de=0x1-_0x616b95,_0x23938c=0x1-_0x1289da,_0x320924=_0x1867de*_0x23938c,_0x25eb5c=_0x616b95*_0x23938c,_0x552fdb=_0x1867de*_0x1289da,_0x4474f6=_0x616b95*_0x1289da,_0x396108=_0x40f60c[0x0]*_0x320924+_0x13d3a2[0x0]*_0x25eb5c+_0x598ddd[0x0]*_0x552fdb+_0x47f129[0x0]*_0x4474f6,_0x21ef45=_0x40f60c[0x1]*_0x320924+_0x13d3a2[0x1]*_0x25eb5c+_0x598ddd[0x1]*_0x552fdb+_0x47f129[0x1]*_0x4474f6;return this['_calcUV'](_0x396108,_0x21ef45);}['_calcUV'](_0x1525df,_0x4beff2){return[+_0x1525df,+_0x4beff2,Math['sqrt'](_0x1525df*_0x1525df+_0x4beff2*_0x4beff2)];}['getUVByPoint'](_0x21e7b1,_0x446c89){const _0x5e2977=_0x1b5673;if(!this[_0x5e2977(0x17c)](_0x21e7b1,_0x446c89))return null;const _0x1302f0=this['toGridXY'](_0x21e7b1,_0x446c89),_0x5ba342=this[_0x5e2977(0x15c)](_0x1302f0[0x0],_0x1302f0[0x1]);return _0x5ba342;}['isInExtent'](_0x2d8daf,_0x179dfd){const _0x4b958e=_0x1b5673;return _0x2d8daf>=this['xmin']&&_0x2d8daf<=this[_0x4b958e(0x182)]&&_0x179dfd>=this['ymin']&&_0x179dfd<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x431470=fRandomByfloat(this['xmin'],this['xmax']),_0x2d6e4e=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x2d6e4e,'lng':_0x431470};}['getParticles'](){const _0x48410f=_0x1b5673;let _0x51999e,_0x249d90,_0x8459b2;for(let _0xbe1db4=0x0,_0x58f174=this['particles']['length'];_0xbe1db4<_0x58f174;_0xbe1db4++){let _0x469a9c=this['particles'][_0xbe1db4];_0x469a9c['age']<=0x0&&(_0x469a9c=this['_randomParticle'](_0x469a9c));if(_0x469a9c['age']>0x0){const _0x49e4a3=_0x469a9c['tlng'],_0xff04bc=_0x469a9c['tlat'];_0x8459b2=this['getUVByPoint'](_0x49e4a3,_0xff04bc),_0x8459b2?(_0x51999e=_0x49e4a3+this[_0x48410f(0x192)][0x0]*_0x8459b2[0x0],_0x249d90=_0xff04bc+this['_calc_speedRate'][0x1]*_0x8459b2[0x1],_0x469a9c['lng']=_0x49e4a3,_0x469a9c[_0x48410f(0x1e0)]=_0xff04bc,_0x469a9c[_0x48410f(0x16c)]=_0x51999e,_0x469a9c['tlat']=_0x249d90,_0x469a9c['speed']=_0x8459b2[0x2],_0x469a9c[_0x48410f(0x118)]--):_0x469a9c['age']=0x0;}}return this[_0x48410f(0x130)];}['_randomParticle'](_0x17f932){const _0x3aca0d=_0x1b5673;let _0x444c97,_0x47b982;for(let _0x45825c=0x0;_0x45825c<0x1e;_0x45825c++){_0x444c97=this['getRandomLatLng'](),_0x47b982=this['getUVByPoint'](_0x444c97['lng'],_0x444c97['lat']);if(_0x47b982&&_0x47b982[0x2]>0x0)break;}if(!_0x47b982)return _0x17f932;const _0x5cd168=_0x444c97[_0x3aca0d(0x131)]+this['_calc_speedRate'][0x0]*_0x47b982[0x0],_0x163843=_0x444c97['lat']+this[_0x3aca0d(0x192)][0x1]*_0x47b982[0x1];return _0x17f932['lng']=_0x444c97['lng'],_0x17f932['lat']=_0x444c97['lat'],_0x17f932['tlng']=_0x5cd168,_0x17f932['tlat']=_0x163843,_0x17f932[_0x3aca0d(0x118)]=Math['round'](Math['random']()*this['maxAge']),_0x17f932['speed']=_0x47b982[0x2],_0x17f932;}['destroy'](){for(const _0x56a9da in this){delete this[_0x56a9da];}}}function fRandomByfloat(_0x8c3295,_0x2433c6){return _0x8c3295+Math['random']()*(_0x2433c6-_0x8c3295);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x1b5673(0x1a1)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x4eca9c={}){const _0xcccd04=_0x1b5673;super(_0x4eca9c),this['_setOptionsHook'](_0x4eca9c),this['canvas']=null,_0x4eca9c['colors']&&_0x4eca9c[_0xcccd04(0x186)]&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x4eca9c));}['_setOptionsHook'](_0x15c177,_0x4f25a9){const _0x370b31=_0x1b5673;this['frameTime']=0x3e8/(_0x15c177[_0x370b31(0x146)]||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x15c177['color']||'#ffffff',this['lineWidth']=_0x15c177['lineWidth']||0x1,this['fixedHeight']=_0x15c177['fixedHeight']??0x0,this[_0x370b31(0x13f)]=_0x15c177['reverseY']??![],this['windField']&&this[_0x370b31(0x17a)][_0x370b31(0x1cc)](_0x15c177);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x3df1f3=_0x1b5673;return this['_map'][_0x3df1f3(0x19f)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0xdb548a=_0x1b5673;return this['_map']['scene']['canvas'][_0xdb548a(0x1e3)];}get['pointerEvents'](){const _0x44fb5f=_0x1b5673;return this[_0x44fb5f(0x180)];}set['pointerEvents'](_0x598d85){const _0x58dd7d=_0x1b5673;this[_0x58dd7d(0x180)]=_0x598d85;if(!this['canvas'])return;_0x598d85?this[_0x58dd7d(0x195)]['style']['pointer-events']='all':this['canvas']['style']['pointer-events']='none';}get[_0x1b5673(0x1b7)](){return this['options']['particlesNumber'];}set[_0x1b5673(0x1b7)](_0xc0ff4){const _0x59e46e=_0x1b5673;this['options'][_0x59e46e(0x1b7)]=_0xc0ff4,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x320c27=_0x1b5673;return this['options'][_0x320c27(0x145)];}set['speedRate'](_0x348bed){const _0x1bb86d=_0x1b5673;this['options'][_0x1bb86d(0x145)]=_0x348bed,this['windField']&&(this['windField']['speedRate']=_0x348bed);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x48284f){const _0x3a9e35=_0x1b5673;this['options']['maxAge']=_0x48284f,this[_0x3a9e35(0x17a)]&&(this[_0x3a9e35(0x17a)]['maxAge']=_0x48284f);}get[_0x1b5673(0x156)](){return this['windData'];}set['data'](_0x3a0c0f){this['setData'](_0x3a0c0f);}[_0x1b5673(0x102)](_0x357a68){const _0x15ca7a=_0x1b5673;_0x357a68?this[_0x15ca7a(0x1e1)]():(this['windData']&&(this[_0x15ca7a(0x1bb)]['data']=this['windData']),this['_removedHook']());}[_0x1b5673(0x137)](){const _0x980032=_0x1b5673;this['options']['worker']?this[_0x980032(0x1cd)]():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x1ea78f=_0x1b5673;this['canvas']=this[_0x1ea78f(0x199)](),this['canvasContext']=this[_0x1ea78f(0x195)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x1ea78f(0x156)]&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x447c70=_0x1b5673;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map'][_0x447c70(0x149)]['removeChild'](this['canvas']),delete this['canvas']);}[_0x1b5673(0x199)](){const _0x5640e0=_0x1b5673,_0x37778d=mars3d__namespace['DomUtil'][_0x5640e0(0x140)](_0x5640e0(0x195),'mars3d-canvasWind',this[_0x5640e0(0x13e)][_0x5640e0(0x149)]);return _0x37778d['style']['position']=_0x5640e0(0x1a2),_0x37778d['style']['top']='0px',_0x37778d[_0x5640e0(0x171)]['left']=_0x5640e0(0x1bf),_0x37778d['style'][_0x5640e0(0x1a3)]=this['_map'][_0x5640e0(0x19f)][_0x5640e0(0x195)][_0x5640e0(0x17b)]+'px',_0x37778d[_0x5640e0(0x171)][_0x5640e0(0x1e2)]=this[_0x5640e0(0x13e)]['scene']['canvas'][_0x5640e0(0x1e3)]+'px',_0x37778d['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x37778d['style']['zIndex']=this['options']['zIndex']??0x9,_0x37778d['width']=this['_map']['scene']['canvas'][_0x5640e0(0x17b)],_0x37778d['height']=this['_map']['scene'][_0x5640e0(0x195)]['clientHeight'],_0x37778d;}['resize'](){const _0x2094c8=_0x1b5673;this[_0x2094c8(0x195)]&&(this['canvas']['style']['width']=this[_0x2094c8(0x13e)]['scene'][_0x2094c8(0x195)][_0x2094c8(0x17b)]+'px',this['canvas']['style']['height']=this[_0x2094c8(0x13e)]['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene'][_0x2094c8(0x195)]['clientWidth'],this['canvas']['height']=this['_map']['scene'][_0x2094c8(0x195)][_0x2094c8(0x1e3)]);}['bindEvent'](){const _0x502ee9=_0x1b5673,_0x2ea3aa=this;let _0x5be698=Date[_0x502ee9(0x189)]();(function _0xc5bd16(){const _0x47af18=_0x502ee9;_0x2ea3aa['animateFrame']=window['requestAnimationFrame'](_0xc5bd16);if(_0x2ea3aa[_0x47af18(0x160)]&&_0x2ea3aa['windField']){const _0x3eca6=Date['now'](),_0x469619=_0x3eca6-_0x5be698;_0x469619>_0x2ea3aa[_0x47af18(0x114)]&&(_0x5be698=_0x3eca6-_0x469619%_0x2ea3aa[_0x47af18(0x114)],_0x2ea3aa[_0x47af18(0x188)]());}}(),window['addEventListener']('resize',this[_0x502ee9(0x1c0)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x502ee9(0x1bb)][_0x502ee9(0x13a)]&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x502ee9(0x13e)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x502ee9(0x1d3)],this)));}[_0x1b5673(0x110)](){const _0x53b585=_0x1b5673;window[_0x53b585(0x163)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x53b585(0x1c0)]),this['options']['mouseHidden']&&(this['_map'][_0x53b585(0x1ea)](mars3d__namespace['EventType']['wheel'],this[_0x53b585(0x14d)],this),this['_map']['off'](mars3d__namespace[_0x53b585(0x179)]['mouseDown'],this[_0x53b585(0x1b9)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x53b585(0x116)],this['_onMouseUpEvent'],this),this[_0x53b585(0x13e)]['off'](mars3d__namespace[_0x53b585(0x179)]['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x185e64){const _0x597676=_0x1b5673;clearTimeout(this['refreshTimer']);if(!this[_0x597676(0x160)]||!this[_0x597676(0x195)])return;this['canvas'][_0x597676(0x171)]['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x5d9d47=_0x597676;if(!this['show'])return;this['redraw'](),this['canvas'][_0x5d9d47(0x171)]['visibility']=_0x5d9d47(0x193);},0xc8);}[_0x1b5673(0x1b9)](_0x28d4de){const _0x5848fc=_0x1b5673;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x5848fc(0x1b2)],this),this['_map']['on'](mars3d__namespace[_0x5848fc(0x179)][_0x5848fc(0x1a8)],this[_0x5848fc(0x1b2)],this);}['_onMouseMoveEvent'](_0x53d0e9){const _0x2e3826=_0x1b5673;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this[_0x2e3826(0x195)][_0x2e3826(0x171)]['visibility']=_0x2e3826(0x16e),this[_0x2e3826(0x11b)]=!![]);}[_0x1b5673(0x1d3)](_0x373386){const _0x396dba=_0x1b5673;if(!this[_0x396dba(0x160)]||!this['canvas'])return;this[_0x396dba(0x13e)][_0x396dba(0x1ea)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']=_0x396dba(0x193),this['mouse_down']=![],this[_0x396dba(0x11b)]=![];}[_0x1b5673(0x1d8)](_0x1c5ada){const _0x3cdfff=_0x1b5673;this['clear'](),this[_0x3cdfff(0x107)]=_0x1c5ada,this['windField']['setDate'](_0x1c5ada),this['redraw']();}['redraw'](){const _0x7f07ee=_0x1b5673;if(!this[_0x7f07ee(0x160)])return;this[_0x7f07ee(0x17a)]['setOptions'](this[_0x7f07ee(0x1bb)]),this['update']();}['update'](){const _0x1d1859=_0x1b5673;if(this['_updateIng'])return;this[_0x1d1859(0x1d7)]=!![];if(this[_0x1d1859(0x196)])this['windField']['update']();else{const _0x51339f=this[_0x1d1859(0x17a)]['getParticles']();this['_drawLines'](_0x51339f);}this['_updateIng']=![];}['_drawLines'](_0x31a529){const _0x3803d6=_0x1b5673;this['canvasContext'][_0x3803d6(0x154)]='destination-in',this[_0x3803d6(0x111)][_0x3803d6(0x16a)](0x0,0x0,this[_0x3803d6(0x126)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x5911c5=this['_map']['scene']['mode']!==Cesium['SceneMode'][_0x3803d6(0x1c1)],_0xa6917f=this[_0x3803d6(0x126)]*0.25;if(this['_colorRamp'])for(let _0xc4948=0x0,_0x5efbea=_0x31a529['length'];_0xc4948<_0x5efbea;_0xc4948++){const _0x2495b0=_0x31a529[_0xc4948],_0x24c6e3=this['_tomap'](_0x2495b0['lng'],_0x2495b0['lat'],_0x2495b0),_0x1b3dae=this['_tomap'](_0x2495b0['tlng'],_0x2495b0['tlat'],_0x2495b0);if(!_0x24c6e3||!_0x1b3dae)continue;if(_0x5911c5&&Math['abs'](_0x24c6e3[0x0]-_0x1b3dae[0x0])>=_0xa6917f)continue;this['canvasContext']['beginPath'](),this[_0x3803d6(0x111)]['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x2495b0['speed']),this['canvasContext'][_0x3803d6(0x14e)](_0x24c6e3[0x0],_0x24c6e3[0x1]),this['canvasContext']['lineTo'](_0x1b3dae[0x0],_0x1b3dae[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x3803d6(0x1ce)](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x3803d6(0x111)]['strokeStyle']=this['color'];for(let _0x5812e4=0x0,_0x4b1f8b=_0x31a529['length'];_0x5812e4<_0x4b1f8b;_0x5812e4++){const _0x14b7c7=_0x31a529[_0x5812e4],_0x3dbaa2=this['_tomap'](_0x14b7c7['lng'],_0x14b7c7[_0x3803d6(0x1e0)],_0x14b7c7),_0x342be7=this['_tomap'](_0x14b7c7['tlng'],_0x14b7c7['tlat'],_0x14b7c7);if(!_0x3dbaa2||!_0x342be7)continue;if(_0x5911c5&&Math['abs'](_0x3dbaa2[0x0]-_0x342be7[0x0])>=_0xa6917f)continue;this['canvasContext'][_0x3803d6(0x14e)](_0x3dbaa2[0x0],_0x3dbaa2[0x1]),this[_0x3803d6(0x111)][_0x3803d6(0x12f)](_0x342be7[0x0],_0x342be7[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x169c57,_0xfee2bb,_0x325bf8){const _0x36a4a2=_0x1b5673,_0x398196=Cesium['Cartesian3'][_0x36a4a2(0x1c2)](_0x169c57,_0xfee2bb,this['fixedHeight']),_0x218f00=this['_map']['scene'];if(_0x218f00['mode']===Cesium['SceneMode']['SCENE3D']){const _0xf0eabc=new Cesium[(_0x36a4a2(0x104))](_0x218f00['globe']['ellipsoid'],_0x218f00[_0x36a4a2(0x153)][_0x36a4a2(0x1ef)]),_0x2c6376=_0xf0eabc['isPointVisible'](_0x398196);if(!_0x2c6376)return _0x325bf8['age']=0x0,null;}const _0x5ba335=Cesium['SceneTransforms'][_0x36a4a2(0x1ba)](this['_map'][_0x36a4a2(0x19f)],_0x398196);return _0x5ba335?[_0x5ba335['x'],_0x5ba335['y']]:null;}['clear'](){const _0x4bce3f=_0x1b5673;this[_0x4bce3f(0x17a)]['clear'](),delete this[_0x4bce3f(0x107)];}['initWorker'](){const _0xa9845f=_0x1b5673;this['worker']=new Worker(this['options']['worker']),this[_0xa9845f(0x196)]['onmessage']=_0x4a48f0=>{const _0x31eaba=_0xa9845f;this['_drawLines'](_0x4a48f0[_0x31eaba(0x156)][_0x31eaba(0x130)]),this[_0x31eaba(0x13c)]=![];},this['windField']={'init':_0x8da3f7=>{const _0x46420a=_0xa9845f;this['worker'][_0x46420a(0x112)]({'type':'init','options':_0x8da3f7});},'setOptions':_0x2c9558=>{this['worker']['postMessage']({'type':'setOptions','options':_0x2c9558});},'setDate':_0x4fa2f7=>{this['worker']['postMessage']({'type':'setDate','data':_0x4fa2f7});},'update':()=>{const _0xa08f81=_0xa9845f;if(this[_0xa08f81(0x13c)])return;this[_0xa08f81(0x13c)]=!![],this['worker']['postMessage']({'type':_0xa08f81(0x188)});},'clear':()=>{const _0x3a946e=_0xa9845f;this[_0x3a946e(0x196)][_0x3a946e(0x112)]({'type':'clear'});}},this['windField'][_0xa9845f(0x1db)](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x1b5673(0x1a1)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x1b5673(0x13d)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x1b5673(0x1c9)](exports,_0x1b5673(0x10f),{'value':!![]});
}));
