/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.5
 * 编译日期：2023-05-04 19:17:14
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';var _0x50b879=_0xe51c;(function(_0x420f24,_0x5bf967){var _0x31db10=_0xe51c,_0x3a6870=_0x420f24();while(!![]){try{var _0x1868c5=parseInt(_0x31db10(0x1b1))/0x1*(parseInt(_0x31db10(0xe7))/0x2)+-parseInt(_0x31db10(0xdf))/0x3*(-parseInt(_0x31db10(0x1c2))/0x4)+-parseInt(_0x31db10(0xd9))/0x5+parseInt(_0x31db10(0x115))/0x6*(parseInt(_0x31db10(0x1cd))/0x7)+parseInt(_0x31db10(0x180))/0x8*(-parseInt(_0x31db10(0x16a))/0x9)+parseInt(_0x31db10(0x125))/0xa+parseInt(_0x31db10(0x113))/0xb;if(_0x1868c5===_0x5bf967)break;else _0x3a6870['push'](_0x3a6870['shift']());}catch(_0xc59c9d){_0x3a6870['push'](_0x3a6870['shift']());}}}(_0x173c,0x909a6));function _interopNamespace(_0x4224d2){var _0x55f858=_0xe51c;if(_0x4224d2&&_0x4224d2['__esModule'])return _0x4224d2;var _0x324e9b=Object['create'](null);return _0x4224d2&&Object[_0x55f858(0x17a)](_0x4224d2)['forEach'](function(_0x3ba389){if(_0x3ba389!=='default'){var _0x371b07=Object['getOwnPropertyDescriptor'](_0x4224d2,_0x3ba389);Object['defineProperty'](_0x324e9b,_0x3ba389,_0x371b07['get']?_0x371b07:{'enumerable':!![],'get':function(){return _0x4224d2[_0x3ba389];}});}}),_0x324e9b[_0x55f858(0x15f)]=_0x4224d2,_0x324e9b;}function _0xe51c(_0xc5121,_0x181d3a){var _0x173cfe=_0x173c();return _0xe51c=function(_0xe51ccb,_0x564b25){_0xe51ccb=_0xe51ccb-0xcc;var _0x30413e=_0x173cfe[_0xe51ccb];return _0x30413e;},_0xe51c(_0xc5121,_0x181d3a);}var mars3d__namespace=_interopNamespace(mars3d),Cesium$7=mars3d__namespace['Cesium'];function getU(_0x324bf5,_0x2f89d4){var _0x3a6d31=_0xe51c,_0xa61465=_0x324bf5*Math[_0x3a6d31(0x1b3)](Cesium$7['Math'][_0x3a6d31(0x161)](_0x2f89d4));return _0xa61465;}function getV(_0x183555,_0x49f808){var _0x4e664d=_0x183555*Math['sin'](Cesium$7['Math']['toRadians'](_0x49f808));return _0x4e664d;}function getSpeed(_0x29a85e,_0x4dc34c){var _0x26642b=_0xe51c,_0x4939ab=Math[_0x26642b(0x185)](Math[_0x26642b(0x146)](_0x29a85e,0x2)+Math['pow'](_0x4dc34c,0x2));return _0x4939ab;}function getDirection(_0x58888d,_0x55e697){var _0x27dee3=_0xe51c,_0x16dcfe=Cesium$7[_0x27dee3(0xe8)][_0x27dee3(0x1b7)](Math['atan2'](_0x55e697,_0x58888d));return _0x16dcfe+=_0x16dcfe<0x0?0x168:0x0,_0x16dcfe;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};function ownKeys(_0x592c1b,_0x60b6ce){var _0x212815=_0xe51c,_0x11405a=Object[_0x212815(0x17a)](_0x592c1b);if(Object[_0x212815(0xf5)]){var _0x57f96c=Object['getOwnPropertySymbols'](_0x592c1b);_0x60b6ce&&(_0x57f96c=_0x57f96c['filter'](function(_0x353922){return Object['getOwnPropertyDescriptor'](_0x592c1b,_0x353922)['enumerable'];})),_0x11405a[_0x212815(0x151)]['apply'](_0x11405a,_0x57f96c);}return _0x11405a;}function _objectSpread2(_0x7560a1){var _0x40d0d8=_0xe51c;for(var _0x534d10=0x1;_0x534d10<arguments[_0x40d0d8(0x118)];_0x534d10++){var _0x379a14=null!=arguments[_0x534d10]?arguments[_0x534d10]:{};_0x534d10%0x2?ownKeys(Object(_0x379a14),!0x0)['forEach'](function(_0xc51b8d){_defineProperty(_0x7560a1,_0xc51b8d,_0x379a14[_0xc51b8d]);}):Object['getOwnPropertyDescriptors']?Object['defineProperties'](_0x7560a1,Object['getOwnPropertyDescriptors'](_0x379a14)):ownKeys(Object(_0x379a14))['forEach'](function(_0x5bf742){Object['defineProperty'](_0x7560a1,_0x5bf742,Object['getOwnPropertyDescriptor'](_0x379a14,_0x5bf742));});}return _0x7560a1;}function _classCallCheck(_0x215463,_0x288bce){if(!(_0x215463 instanceof _0x288bce))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x9c97f3,_0x259002){var _0x169c5a=_0xe51c;for(var _0x910d38=0x0;_0x910d38<_0x259002[_0x169c5a(0x118)];_0x910d38++){var _0x1c215f=_0x259002[_0x910d38];_0x1c215f['enumerable']=_0x1c215f['enumerable']||![],_0x1c215f['configurable']=!![];if('value'in _0x1c215f)_0x1c215f['writable']=!![];Object['defineProperty'](_0x9c97f3,_0x1c215f[_0x169c5a(0x112)],_0x1c215f);}}function _createClass(_0x399932,_0x67843a,_0x45af76){var _0x21ebf6=_0xe51c;if(_0x67843a)_defineProperties(_0x399932[_0x21ebf6(0x102)],_0x67843a);if(_0x45af76)_defineProperties(_0x399932,_0x45af76);return Object['defineProperty'](_0x399932,'prototype',{'writable':![]}),_0x399932;}function _defineProperty(_0x441ba4,_0x1f29a8,_0x174833){return _0x1f29a8 in _0x441ba4?Object['defineProperty'](_0x441ba4,_0x1f29a8,{'value':_0x174833,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x441ba4[_0x1f29a8]=_0x174833,_0x441ba4;}function _inherits(_0x14d371,_0x4c38b0){var _0x33ae7b=_0xe51c;if(typeof _0x4c38b0!=='function'&&_0x4c38b0!==null)throw new TypeError(_0x33ae7b(0x117));_0x14d371['prototype']=Object['create'](_0x4c38b0&&_0x4c38b0[_0x33ae7b(0x102)],{'constructor':{'value':_0x14d371,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x14d371,_0x33ae7b(0x102),{'writable':![]});if(_0x4c38b0)_setPrototypeOf(_0x14d371,_0x4c38b0);}function _getPrototypeOf(_0x57ddbe){var _0x2a8e02=_0xe51c;return _getPrototypeOf=Object['setPrototypeOf']?Object[_0x2a8e02(0x148)]:function _0x3d0b6a(_0x47df40){var _0x755757=_0x2a8e02;return _0x47df40[_0x755757(0x109)]||Object['getPrototypeOf'](_0x47df40);},_getPrototypeOf(_0x57ddbe);}function _setPrototypeOf(_0x228325,_0x45cd67){var _0x3d838a=_0xe51c;return _setPrototypeOf=Object[_0x3d838a(0x139)]||function _0x370640(_0x53e103,_0x5ac11e){return _0x53e103['__proto__']=_0x5ac11e,_0x53e103;},_setPrototypeOf(_0x228325,_0x45cd67);}function _isNativeReflectConstruct(){var _0x3c2ac8=_0xe51c;if(typeof Reflect===_0x3c2ac8(0x1a0)||!Reflect[_0x3c2ac8(0x15b)])return![];if(Reflect['construct']['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean[_0x3c2ac8(0x102)][_0x3c2ac8(0x1cc)][_0x3c2ac8(0x1ac)](Reflect['construct'](Boolean,[],function(){})),!![];}catch(_0x1cd28a){return![];}}function _assertThisInitialized(_0x1fca1a){if(_0x1fca1a===void 0x0)throw new ReferenceError('this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called');return _0x1fca1a;}function _0x173c(){var _0x1e4ff7=['preExecute','createRenderingFramebuffers','shaderProgram','wheel','speedRate','PI_OVER_THREE','left','show','cols','framebuffers','postMessage','WindLayer','_onMapWhellEvent','fromCache','setPrototypeOf','mouseUp','Cartesian3','nextParticlesPosition','nextTrailsColor','updatePosition','scene','moveTo','test','primitiveType','_updateIng','randomizeParticles','udata','pow','camera','getPrototypeOf','nextTrails','colors','LayerUtil','canvasWindy','_canrefresh','fadeOpacity','blue','array','push','_addedHook','update','particles','FLOAT','particlesNumber','latRange','Cartesian2','particlesTextureSize','xmax','construct','particleSystem','now','class','default','createElement','toRadians','levmax','maxAge','stroke','destroy','ymin','fromDegrees','cancelAnimationFrame','lon','8245431ZuvQbn','attributeLocations','setAttribute','commandToExecute','LUMINANCE','clampToLatitudeRange','_tomap','vmin','function','removeAll','lat','RGBA','random','updateViewerParameters','worker','mod','keys','removeEventListener','visibility','iterator','ShaderSource','animateFrame','8ojpxsa','getParticles','PixelDatatype','setOptions','clearFramebuffers','sqrt','vertexArray','viewRectangleToLonLatRange','vmax','particlesRendering','Invalid\x20attempt\x20to\x20spread\x20non-iterable\x20instance.\x0aIn\x20order\x20to\x20be\x20iterable,\x20non-array\x20objects\x20must\x20have\x20a\x20[Symbol.iterator]()\x20method.','geometry','hidden','CanvasWindField','windField','wind','BaseLayer','getColorTexture','lineWidth','fragmentShaderSource','age','canvasContext','off','TextureMinificationFilter','_randomParticle','windData','globalCompositeOperation','trails','textures','PrimitiveCollection','dropRateBump','_onMap_preRenderEvent','undefined','currentTrails','ShaderProgram','Cesium','canvas','PrimitiveType','getUVByPoint','viewerParameters','north','mouse_down','ellipsoid','_calcUV','call','clearCommand','Compute','createParticlesTextures','autoClear','46BHtGnU','Draw','cos','currentParticlesPosition','createRenderingTextures','uniformMap','toDegrees','_map','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','floor','data','_createCanvas','forEach','createSegmentsGeometry','primitives','getUVByXY','lonRange','4364972UkIMIK','min','pointerEvents','depthTest','destroyObject','_mountedHook','lev','rgb(206,255,255)','rawRenderState','particlesWind','valueOf','14OiOtbm','TWO_PI','SceneMode','isPointVisible','createRawRenderState','ymax','apply','_onMouseDownEvent','randomBetween','_onMouseUpEvent','framebuffer','depthTexture','GeometryAttribute','_onMouseMoveEvent','3168170PvduqJ','postProcessingSpeed','getExtent','maxParticles','particlesComputing','windTextures','3RtluPT','mouseDown','lineTo','addEventListener','string','_maxAge','100%','EventType','5552AuwWZL','Math','BufferUsage','arrayBufferView','none','options','green','dimensions','defined','particlesTextures','destroyParticlesTextures','ALWAYS','resize','rows','getOwnPropertySymbols','Matrix4','_drawLines','_data','globeBoundingSphere','container','canvasWidth','Geometry','getFullscreenQuad','currentTrailsDepth','0px','createCommand','getWind','prototype','createFramebuffer','add','requestAnimationFrame','style','speedFactor','Pass','__proto__','getOptions','outputTexture','tlat','canvasResize','height','max','VertexArray','visible','key','3007488ayvWys','createTexture','609834gAvVTu','xmin','Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function','length','ceil','colorTable','mouse_move','canvasHeight','_speedRate','redraw','OPAQUE','context','SCENE3D','clear','TextureMagnificationFilter','_calc_speedRate','4464620tOoJeB','segments','vertexShaderSource','refreshTimer','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','postProcessingPosition'];_0x173c=function(){return _0x1e4ff7;};return _0x173c();}function _possibleConstructorReturn(_0x375805,_0x5393f1){var _0x39a45f=_0xe51c;if(_0x5393f1&&(typeof _0x5393f1==='object'||typeof _0x5393f1===_0x39a45f(0x172)))return _0x5393f1;else{if(_0x5393f1!==void 0x0)throw new TypeError('Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined');}return _assertThisInitialized(_0x375805);}function _createSuper(_0x578a8a){var _0x3528e4=_isNativeReflectConstruct();return function _0x382dc5(){var _0x498cf1=_0xe51c,_0x2c69b4=_getPrototypeOf(_0x578a8a),_0x4a474f;if(_0x3528e4){var _0x254d3d=_getPrototypeOf(this)['constructor'];_0x4a474f=Reflect['construct'](_0x2c69b4,arguments,_0x254d3d);}else _0x4a474f=_0x2c69b4[_0x498cf1(0xd1)](this,arguments);return _possibleConstructorReturn(this,_0x4a474f);};}function _toConsumableArray(_0x449673){return _arrayWithoutHoles(_0x449673)||_iterableToArray(_0x449673)||_unsupportedIterableToArray(_0x449673)||_nonIterableSpread();}function _arrayWithoutHoles(_0x3bc056){if(Array['isArray'](_0x3bc056))return _arrayLikeToArray(_0x3bc056);}function _iterableToArray(_0x6b6128){var _0x3e3474=_0xe51c;if(typeof Symbol!=='undefined'&&_0x6b6128[Symbol[_0x3e3474(0x17d)]]!=null||_0x6b6128['@@iterator']!=null)return Array['from'](_0x6b6128);}function _unsupportedIterableToArray(_0x2f9d0d,_0x10b4e8){var _0x413e28=_0xe51c;if(!_0x2f9d0d)return;if(typeof _0x2f9d0d===_0x413e28(0xe3))return _arrayLikeToArray(_0x2f9d0d,_0x10b4e8);var _0x3b7c44=Object['prototype']['toString'][_0x413e28(0x1ac)](_0x2f9d0d)['slice'](0x8,-0x1);if(_0x3b7c44==='Object'&&_0x2f9d0d['constructor'])_0x3b7c44=_0x2f9d0d['constructor']['name'];if(_0x3b7c44==='Map'||_0x3b7c44==='Set')return Array['from'](_0x2f9d0d);if(_0x3b7c44==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/[_0x413e28(0x141)](_0x3b7c44))return _arrayLikeToArray(_0x2f9d0d,_0x10b4e8);}function _arrayLikeToArray(_0x10d61f,_0x1f6428){if(_0x1f6428==null||_0x1f6428>_0x10d61f['length'])_0x1f6428=_0x10d61f['length'];for(var _0x471933=0x0,_0x30b0c7=new Array(_0x1f6428);_0x471933<_0x1f6428;_0x471933++)_0x30b0c7[_0x471933]=_0x10d61f[_0x471933];return _0x30b0c7;}function _nonIterableSpread(){var _0x3515c6=_0xe51c;throw new TypeError(_0x3515c6(0x18a));}var Cesium$6=mars3d__namespace['Cesium'],CustomPrimitive=(function(){var _0x2a12af=_0xe51c;function _0x389cab(_0x17f68d){var _0x12ff8c=_0xe51c,_0x1ee4ec;_classCallCheck(this,_0x389cab),this['commandType']=_0x17f68d['commandType'],this[_0x12ff8c(0x18b)]=_0x17f68d[_0x12ff8c(0x18b)],this[_0x12ff8c(0x16b)]=_0x17f68d['attributeLocations'],this['primitiveType']=_0x17f68d['primitiveType'],this['uniformMap']=_0x17f68d['uniformMap'],this[_0x12ff8c(0x127)]=_0x17f68d['vertexShaderSource'],this['fragmentShaderSource']=_0x17f68d['fragmentShaderSource'],this[_0x12ff8c(0x1ca)]=_0x17f68d[_0x12ff8c(0x1ca)],this['framebuffer']=_0x17f68d[_0x12ff8c(0xd5)],this['outputTexture']=_0x17f68d['outputTexture'],this['autoClear']=(_0x1ee4ec=_0x17f68d['autoClear'])!==null&&_0x1ee4ec!==void 0x0?_0x1ee4ec:![],this['preExecute']=_0x17f68d['preExecute'],this[_0x12ff8c(0x132)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x12ff8c(0x1b0)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x12ff8c(0x108)]['OPAQUE']}));}return _createClass(_0x389cab,[{'key':_0x2a12af(0x100),'value':function _0x4846a5(_0x5b4d13){var _0x27f899=_0x2a12af;switch(this['commandType']){case'Draw':{var _0x3ca7e3=Cesium$6['VertexArray']['fromGeometry']({'context':_0x5b4d13,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x27f899(0xe9)]['STATIC_DRAW']}),_0x80886f=Cesium$6[_0x27f899(0x1a2)][_0x27f899(0x138)]({'context':_0x5b4d13,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x31e7a3=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x27f899(0x142)],'shaderProgram':_0x80886f,'vertexArray':_0x3ca7e3,'modelMatrix':Cesium$6[_0x27f899(0xf6)]['IDENTITY'],'renderState':_0x31e7a3,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x27f899(0x193)],'uniformMap':this[_0x27f899(0x1b6)],'outputTexture':this[_0x27f899(0x10b)],'persists':!![]});}}}},{'key':'setGeometry','value':function _0x63417(_0x3a6dde,_0x11c7cd){var _0x25ce7c=_0x2a12af;this[_0x25ce7c(0x18b)]=_0x11c7cd;var _0x4513a0=Cesium$6['VertexArray']['fromGeometry']({'context':_0x3a6dde,'geometry':this['geometry'],'attributeLocations':this[_0x25ce7c(0x16b)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute'][_0x25ce7c(0x186)]=_0x4513a0;}},{'key':'update','value':function _0x5b2356(_0x2b6029){var _0x3ceb8e=_0x2a12af;if(!this[_0x3ceb8e(0x132)])return;if(_0x2b6029['mode']!==Cesium$6[_0x3ceb8e(0xcd)]['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x3ceb8e(0x16d)]=this['createCommand'](_0x2b6029['context'])),Cesium$6['defined'](this['preExecute'])&&this[_0x3ceb8e(0x12b)](),Cesium$6[_0x3ceb8e(0xef)](this[_0x3ceb8e(0x1ad)])&&_0x2b6029['commandList'][_0x3ceb8e(0x151)](this['clearCommand']),_0x2b6029['commandList']['push'](this['commandToExecute']);}},{'key':'isDestroyed','value':function _0x48b005(){return![];}},{'key':'destroy','value':function _0x1e9b38(){var _0x30b59b=_0x2a12af;if(this[_0x30b59b(0x1ad)]){var _0x52ad28,_0x282746;(_0x52ad28=this['clearCommand'])!==null&&_0x52ad28!==void 0x0&&_0x52ad28['vertexArray']&&this['clearCommand']['vertexArray'][_0x30b59b(0x165)](),(_0x282746=this[_0x30b59b(0x1ad)])!==null&&_0x282746!==void 0x0&&_0x282746['shaderProgram']&&this['clearCommand'][_0x30b59b(0x12d)][_0x30b59b(0x165)](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x30b59b(0x16d)]['vertexArray']&&this['commandToExecute'][_0x30b59b(0x186)]['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram'][_0x30b59b(0x165)](),delete this['commandToExecute']),Cesium$6[_0x30b59b(0x1c6)](this);}}]),_0x389cab;}()),Cesium$5=mars3d__namespace['Cesium'],Util=(function(){var _0x5393e5=function _0x102425(){var _0x4ae33f=_0xe51c,_0xb30a6d=new Cesium$5[(_0x4ae33f(0xfc))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x4ae33f(0xd7))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x4ae33f(0xd7))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0xb30a6d;},_0x23e4ad=function _0x3c12e8(_0x924276,_0x1c6a16){var _0x380cea=_0xe51c;if(Cesium$5[_0x380cea(0xef)](_0x1c6a16)){var _0x181af4={};_0x181af4[_0x380cea(0xea)]=_0x1c6a16,_0x924276['source']=_0x181af4;}var _0x2f33b1=new Cesium$5['Texture'](_0x924276);return _0x2f33b1;},_0x38a3f5=function _0x969a9(_0x280a0e,_0x243bf5,_0x1c51ef){var _0x10aa12=new Cesium$5['Framebuffer']({'context':_0x280a0e,'colorTextures':[_0x243bf5],'depthTexture':_0x1c51ef});return _0x10aa12;},_0x55fc2f=function _0xe76894(_0x2c5e1f){var _0x36621b=_0xe51c,_0x59946d=!![],_0x5b46b9=![],_0x3a9940={'viewport':_0x2c5e1f['viewport'],'depthTest':_0x2c5e1f[_0x36621b(0x1c5)],'depthMask':_0x2c5e1f['depthMask'],'blending':_0x2c5e1f['blending']},_0x26b39b=Cesium$5['Appearance']['getDefaultRenderState'](_0x59946d,_0x5b46b9,_0x3a9940);return _0x26b39b;},_0x3c138d=function _0x5a3794(_0x5ee157){var _0x12a854=_0xe51c,_0x2e6aec={},_0xd5c2d2=Cesium$5[_0x12a854(0xe8)][_0x12a854(0x179)](_0x5ee157['west'],Cesium$5['Math']['TWO_PI']),_0x14259e=Cesium$5['Math']['mod'](_0x5ee157['east'],Cesium$5['Math'][_0x12a854(0xcc)]),_0x224864=_0x5ee157['width'],_0x5bee11,_0x5cf096;_0x224864>Cesium$5[_0x12a854(0xe8)]['THREE_PI_OVER_TWO']?(_0x5bee11=0x0,_0x5cf096=Cesium$5[_0x12a854(0xe8)]['TWO_PI']):_0x14259e-_0xd5c2d2<_0x224864?(_0x5bee11=_0xd5c2d2,_0x5cf096=_0xd5c2d2+_0x224864):(_0x5bee11=_0xd5c2d2,_0x5cf096=_0x14259e);_0x2e6aec['lon']={'min':Cesium$5[_0x12a854(0xe8)]['toDegrees'](_0x5bee11),'max':Cesium$5['Math']['toDegrees'](_0x5cf096)};var _0x1e0446=_0x5ee157['south'],_0x4ca8f0=_0x5ee157[_0x12a854(0x1a8)],_0x352b7e=_0x5ee157['height'],_0x1b52aa=_0x352b7e>Cesium$5[_0x12a854(0xe8)]['PI']/0xc?_0x352b7e/0x2:0x0,_0x381c30=Cesium$5[_0x12a854(0xe8)][_0x12a854(0x16f)](_0x1e0446-_0x1b52aa),_0x787ee=Cesium$5[_0x12a854(0xe8)]['clampToLatitudeRange'](_0x4ca8f0+_0x1b52aa);return _0x381c30<-Cesium$5[_0x12a854(0xe8)]['PI_OVER_THREE']&&(_0x381c30=-Cesium$5[_0x12a854(0xe8)]['PI_OVER_TWO']),_0x787ee>Cesium$5['Math'][_0x12a854(0x130)]&&(_0x787ee=Cesium$5['Math']['PI_OVER_TWO']),_0x2e6aec['lat']={'min':Cesium$5['Math'][_0x12a854(0x1b7)](_0x381c30),'max':Cesium$5['Math']['toDegrees'](_0x787ee)},_0x2e6aec;};return{'getFullscreenQuad':_0x5393e5,'createTexture':_0x23e4ad,'createFramebuffer':_0x38a3f5,'createRawRenderState':_0x55fc2f,'viewRectangleToLonLatRange':_0x3c138d};}()),segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',Cesium$4=mars3d__namespace['Cesium'],ParticlesRendering=(function(){var _0x43f28c=_0xe51c;function _0x5856ff(_0xeb691c,_0x49b0d1,_0x4f6060,_0xf565a5,_0x5e2add){var _0x2f2c75=_0xe51c;_classCallCheck(this,_0x5856ff),this[_0x2f2c75(0x1b5)](_0xeb691c,_0x49b0d1,_0x4f6060['colors']),this[_0x2f2c75(0x12c)](_0xeb691c),this['createRenderingPrimitives'](_0xeb691c,_0x4f6060,_0xf565a5,_0x5e2add);}return _createClass(_0x5856ff,[{'key':_0x43f28c(0x1b5),'value':function _0x5dbc83(_0xaf4014,_0x2cbb62,_0x4c42ec){var _0x5be347=_0x43f28c,_0x41fd6e={'context':_0xaf4014,'width':_0xaf4014['drawingBufferWidth'],'height':_0xaf4014['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x1b067d={'context':_0xaf4014,'width':_0xaf4014['drawingBufferWidth'],'height':_0xaf4014['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x51958a=_0x4c42ec['length'],_0x284ae5=new Float32Array(_0x51958a*0x3);for(var _0x28f3f0=0x0;_0x28f3f0<_0x51958a;_0x28f3f0++){var _0x18f7de=Cesium$4['Color']['fromCssColorString'](_0x4c42ec[_0x28f3f0]);_0x284ae5[0x3*_0x28f3f0]=_0x18f7de['red'],_0x284ae5[0x3*_0x28f3f0+0x1]=_0x18f7de[_0x5be347(0xed)],_0x284ae5[0x3*_0x28f3f0+0x2]=_0x18f7de[_0x5be347(0x14f)];}var _0x1dea9c={'context':_0xaf4014,'width':_0x51958a,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x5be347(0x155)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x41fd6e),'segmentsDepth':Util[_0x5be347(0x114)](_0x1b067d),'currentTrailsColor':Util['createTexture'](_0x41fd6e),'currentTrailsDepth':Util[_0x5be347(0x114)](_0x1b067d),'nextTrailsColor':Util['createTexture'](_0x41fd6e),'nextTrailsDepth':Util[_0x5be347(0x114)](_0x1b067d),'colorTable':Util[_0x5be347(0x114)](_0x1dea9c,_0x284ae5)};}},{'key':'createRenderingFramebuffers','value':function _0x4602a0(_0x53c093){var _0x2bb917=_0x43f28c;this['framebuffers']={'segments':Util['createFramebuffer'](_0x53c093,this[_0x2bb917(0x19c)]['segmentsColor'],this[_0x2bb917(0x19c)]['segmentsDepth']),'currentTrails':Util[_0x2bb917(0x103)](_0x53c093,this['textures']['currentTrailsColor'],this['textures'][_0x2bb917(0xfe)]),'nextTrails':Util['createFramebuffer'](_0x53c093,this['textures'][_0x2bb917(0x13d)],this['textures']['nextTrailsDepth'])};}},{'key':'createSegmentsGeometry','value':function _0x20d890(_0x333111){var _0x1cdfc1=_0x43f28c,_0x56491f=0x4,_0xb4a465=[];for(var _0x264ba7=0x0;_0x264ba7<_0x333111[_0x1cdfc1(0x159)];_0x264ba7++){for(var _0x395f2f=0x0;_0x395f2f<_0x333111[_0x1cdfc1(0x159)];_0x395f2f++){for(var _0x7b0e80=0x0;_0x7b0e80<_0x56491f;_0x7b0e80++){_0xb4a465[_0x1cdfc1(0x151)](_0x264ba7/_0x333111['particlesTextureSize']),_0xb4a465['push'](_0x395f2f/_0x333111['particlesTextureSize']);}}}_0xb4a465=new Float32Array(_0xb4a465);var _0x187ac0=[],_0x273eb6=[-0x1,0x1],_0x34fdd4=[-0x1,0x1];for(var _0x16ea11=0x0;_0x16ea11<_0x333111[_0x1cdfc1(0xdc)];_0x16ea11++){for(var _0x16fd35=0x0;_0x16fd35<_0x56491f/0x2;_0x16fd35++){for(var _0x3a8a42=0x0;_0x3a8a42<_0x56491f/0x2;_0x3a8a42++){_0x187ac0['push'](_0x273eb6[_0x16fd35]),_0x187ac0['push'](_0x34fdd4[_0x3a8a42]),_0x187ac0[_0x1cdfc1(0x151)](0x0);}}}_0x187ac0=new Float32Array(_0x187ac0);var _0xf753f0=0x6*_0x333111['maxParticles'],_0x1016ff=new Uint32Array(_0xf753f0);for(var _0x39b17a=0x0,_0x487db9=0x0,_0x1e7241=0x0;_0x39b17a<_0x333111['maxParticles'];_0x39b17a++){_0x1016ff[_0x487db9++]=_0x1e7241+0x0,_0x1016ff[_0x487db9++]=_0x1e7241+0x1,_0x1016ff[_0x487db9++]=_0x1e7241+0x2,_0x1016ff[_0x487db9++]=_0x1e7241+0x2,_0x1016ff[_0x487db9++]=_0x1e7241+0x1,_0x1016ff[_0x487db9++]=_0x1e7241+0x3,_0x1e7241+=0x4;}var _0xb8f9a8=new Cesium$4[(_0x1cdfc1(0xfc))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0xb4a465}),'normal':new Cesium$4[(_0x1cdfc1(0xd7))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x187ac0})}),'indices':_0x1016ff});return _0xb8f9a8;}},{'key':'createRenderingPrimitives','value':function _0x1bfe68(_0x56eb89,_0x1d0078,_0x5d2d53,_0x34c264){var _0x29ea59=_0x43f28c,_0x1e0f6c=this;this[_0x29ea59(0x1bf)]={'segments':new CustomPrimitive({'commandType':_0x29ea59(0x1b2),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x29ea59(0x1be)](_0x1d0078),'primitiveType':Cesium$4[_0x29ea59(0x1a5)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function _0x107b1a(){var _0x39efab=_0x29ea59;return _0x34c264['particlesTextures'][_0x39efab(0x1b4)];},'postProcessingPosition':function _0x5518f6(){var _0x2802b7=_0x29ea59;return _0x34c264['particlesTextures'][_0x2802b7(0x12a)];},'postProcessingSpeed':function _0x189263(){var _0x2bea92=_0x29ea59;return _0x34c264[_0x2bea92(0xf0)]['postProcessingSpeed'];},'colorTable':function _0x5cd9a1(){var _0x142534=_0x29ea59;return _0x1e0f6c[_0x142534(0x19c)][_0x142534(0x11a)];},'aspect':function _0x45a827(){return _0x56eb89['drawingBufferWidth']/_0x56eb89['drawingBufferHeight'];},'pixelSize':function _0x296589(){return _0x5d2d53['pixelSize'];},'lineWidth':function _0x406e9b(){var _0x3feb2c=_0x29ea59;return _0x1d0078[_0x3feb2c(0x192)];},'particleHeight':function _0x217282(){return _0x1d0078['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x29ea59(0x134)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x29ea59(0xfd)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function _0xd0fed9(){return _0x1e0f6c['textures']['segmentsColor'];},'segmentsDepthTexture':function _0x5c3b0c(){var _0x419650=_0x29ea59;return _0x1e0f6c[_0x419650(0x19c)]['segmentsDepth'];},'currentTrailsColor':function _0x34f7e2(){var _0x4cf1ff=_0x29ea59;return _0x1e0f6c['framebuffers'][_0x4cf1ff(0x1a1)]['getColorTexture'](0x0);},'trailsDepthTexture':function _0x25de48(){var _0x1cb098=_0x29ea59;return _0x1e0f6c[_0x1cb098(0x134)][_0x1cb098(0x1a1)]['depthTexture'];},'fadeOpacity':function _0x2d4f71(){return _0x1d0078['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x29ea59(0xcf)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0x29ea59(0xf2)]},'depthMask':!![]}),'framebuffer':this[_0x29ea59(0x134)][_0x29ea59(0x149)],'autoClear':!![],'preExecute':function _0x16913f(){var _0x150065=_0x29ea59,_0x2d1715=_0x1e0f6c[_0x150065(0x134)]['currentTrails'];_0x1e0f6c[_0x150065(0x134)]['currentTrails']=_0x1e0f6c[_0x150065(0x134)]['nextTrails'],_0x1e0f6c[_0x150065(0x134)]['nextTrails']=_0x2d1715,_0x1e0f6c[_0x150065(0x1bf)]['trails'][_0x150065(0x16d)]['framebuffer']=_0x1e0f6c[_0x150065(0x134)][_0x150065(0x149)],_0x1e0f6c[_0x150065(0x1bf)][_0x150065(0x19b)]['clearCommand']['framebuffer']=_0x1e0f6c[_0x150065(0x134)][_0x150065(0x149)];}}),'screen':new CustomPrimitive({'commandType':_0x29ea59(0x1b2),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x29ea59(0xfd)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function _0xa32948(){var _0x438846=_0x29ea59;return _0x1e0f6c[_0x438846(0x134)]['nextTrails'][_0x438846(0x191)](0x0);},'trailsDepthTexture':function _0x409cb4(){var _0x168b5d=_0x29ea59;return _0x1e0f6c['framebuffers']['nextTrails'][_0x168b5d(0xd6)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x29ea59(0xcf)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}]),_0x5856ff;}()),getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x50b879(0x1b9),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x50b879(0x129),Cesium$3=mars3d__namespace['Cesium'],ParticlesComputing=(function(){var _0x31bca7=_0x50b879;function _0x238fb4(_0x415778,_0x299f4d,_0x1b7d1e,_0x356e1a){var _0x501a8b=_0xe51c;_classCallCheck(this,_0x238fb4),this[_0x501a8b(0x1bb)]=_0x299f4d,this['createWindTextures'](_0x415778,_0x299f4d),this['createParticlesTextures'](_0x415778,_0x1b7d1e,_0x356e1a),this['createComputingPrimitives'](_0x299f4d,_0x1b7d1e,_0x356e1a);}return _createClass(_0x238fb4,[{'key':'createWindTextures','value':function _0x2d372b(_0x531471,_0x46f1a4){var _0x2c415a=_0xe51c,_0x572906={'context':_0x531471,'width':_0x46f1a4[_0x2c415a(0xee)][_0x2c415a(0x169)],'height':_0x46f1a4['dimensions']['lat']*(_0x46f1a4['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x2c415a(0x16e)],'pixelDatatype':Cesium$3[_0x2c415a(0x182)][_0x2c415a(0x155)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x2c415a(0x197)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x572906,_0x46f1a4['U'][_0x2c415a(0x150)]),'V':Util['createTexture'](_0x572906,_0x46f1a4['V']['array'])};}},{'key':'createParticlesTextures','value':function _0x1624b3(_0x5e82bb,_0x47d07c,_0x209a69){var _0x880209=_0xe51c,_0x4c383c={'context':_0x5e82bb,'width':_0x47d07c['particlesTextureSize'],'height':_0x47d07c['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x880209(0x175)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x880209(0x123)]['NEAREST']})},_0x6694f=this['randomizeParticles'](_0x47d07c['maxParticles'],_0x209a69),_0x5c2a74=new Float32Array(0x4*_0x47d07c['maxParticles'])['fill'](0x0);this[_0x880209(0xf0)]={'particlesWind':Util['createTexture'](_0x4c383c),'currentParticlesPosition':Util['createTexture'](_0x4c383c,_0x6694f),'nextParticlesPosition':Util['createTexture'](_0x4c383c,_0x6694f),'currentParticlesSpeed':Util['createTexture'](_0x4c383c,_0x5c2a74),'nextParticlesSpeed':Util['createTexture'](_0x4c383c,_0x5c2a74),'postProcessingPosition':Util['createTexture'](_0x4c383c,_0x6694f),'postProcessingSpeed':Util['createTexture'](_0x4c383c,_0x5c2a74)};}},{'key':_0x31bca7(0x144),'value':function _0x212325(_0x58e7ed,_0x2c369c){var _0x2ed1d3=_0x31bca7,_0x463b86=new Float32Array(0x4*_0x58e7ed);for(var _0x38bac8=0x0;_0x38bac8<_0x58e7ed;_0x38bac8++){_0x463b86[0x4*_0x38bac8]=Cesium$3[_0x2ed1d3(0xe8)]['randomBetween'](_0x2c369c[_0x2ed1d3(0x1c1)]['x'],_0x2c369c['lonRange']['y']),_0x463b86[0x4*_0x38bac8+0x1]=Cesium$3[_0x2ed1d3(0xe8)][_0x2ed1d3(0xd3)](_0x2c369c[_0x2ed1d3(0x157)]['x'],_0x2c369c[_0x2ed1d3(0x157)]['y']),_0x463b86[0x4*_0x38bac8+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this[_0x2ed1d3(0x1bb)][_0x2ed1d3(0x1c8)]['max']),_0x463b86[0x4*_0x38bac8+0x3]=0x0;}return _0x463b86;}},{'key':'destroyParticlesTextures','value':function _0x58d22c(){var _0x1db0ad=_0x31bca7,_0x422087=this;Object[_0x1db0ad(0x17a)](this['particlesTextures'])['forEach'](function(_0x4e08f6){_0x422087['particlesTextures'][_0x4e08f6]['destroy']();});}},{'key':'createComputingPrimitives','value':function _0x591a22(_0x297885,_0x2b60a3,_0x27806c){var _0x1a5cf2=_0x31bca7,_0x58e696=new Cesium$3['Cartesian3'](_0x297885[_0x1a5cf2(0xee)]['lon'],_0x297885[_0x1a5cf2(0xee)]['lat'],_0x297885[_0x1a5cf2(0xee)]['lev']),_0x4e381f=new Cesium$3['Cartesian3'](_0x297885['lon']['min'],_0x297885['lat']['min'],_0x297885['lev']['min']),_0x40cb5a=new Cesium$3['Cartesian3'](_0x297885[_0x1a5cf2(0x169)][_0x1a5cf2(0x10f)],_0x297885['lat'][_0x1a5cf2(0x10f)],_0x297885['lev']['max']),_0x2c2394=new Cesium$3[(_0x1a5cf2(0x13b))]((_0x40cb5a['x']-_0x4e381f['x'])/(_0x58e696['x']-0x1),(_0x40cb5a['y']-_0x4e381f['y'])/(_0x58e696['y']-0x1),_0x58e696['z']>0x1?(_0x40cb5a['z']-_0x4e381f['z'])/(_0x58e696['z']-0x1):0x1),_0x2c370b=new Cesium$3[(_0x1a5cf2(0x158))](_0x297885['U'][_0x1a5cf2(0x1c3)],_0x297885['U'][_0x1a5cf2(0x10f)]),_0x241595=new Cesium$3[(_0x1a5cf2(0x158))](_0x297885['V']['min'],_0x297885['V']['max']),_0x274c38=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x1a5cf2(0x1ae),'uniformMap':{'U':function _0x19bdbd(){return _0x274c38['windTextures']['U'];},'V':function _0x37072a(){return _0x274c38['windTextures']['V'];},'currentParticlesPosition':function _0x3e67f0(){var _0x256e91=_0x1a5cf2;return _0x274c38[_0x256e91(0xf0)]['currentParticlesPosition'];},'dimension':function _0x2aac6d(){return _0x58e696;},'minimum':function _0x285e86(){return _0x4e381f;},'maximum':function _0x48718a(){return _0x40cb5a;},'interval':function _0x14c1f0(){return _0x2c2394;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function _0x388dc7(){var _0x304c82=_0x1a5cf2;_0x274c38['primitives'][_0x304c82(0x101)]['commandToExecute'][_0x304c82(0x10b)]=_0x274c38[_0x304c82(0xf0)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function _0x5b878b(){return _0x274c38['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function _0x3f378a(){var _0x5238d8=_0x1a5cf2;return _0x274c38['particlesTextures'][_0x5238d8(0x1cb)];},'uSpeedRange':function _0x1ca093(){return _0x2c370b;},'vSpeedRange':function _0x1cc8b6(){return _0x241595;},'pixelSize':function _0x20a755(){return _0x27806c['pixelSize'];},'speedFactor':function _0x107517(){var _0x35b34a=_0x1a5cf2;return _0x2b60a3[_0x35b34a(0x107)];}},'fragmentShaderSource':new Cesium$3[(_0x1a5cf2(0x17e))]({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x1a5cf2(0xf0)]['nextParticlesSpeed'],'preExecute':function _0x1963e8(){var _0xfc51ec=_0x1a5cf2,_0x1f4c68=_0x274c38['particlesTextures']['currentParticlesSpeed'];_0x274c38['particlesTextures']['currentParticlesSpeed']=_0x274c38[_0xfc51ec(0xf0)][_0xfc51ec(0xda)],_0x274c38[_0xfc51ec(0xf0)]['postProcessingSpeed']=_0x1f4c68,_0x274c38['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x274c38['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function _0x210b3d(){var _0x2be651=_0x1a5cf2;return _0x274c38[_0x2be651(0xf0)]['currentParticlesPosition'];},'currentParticlesSpeed':function _0x319d71(){return _0x274c38['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x1a5cf2(0x17e))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function _0x12def4(){var _0x51fddd=_0x1a5cf2,_0x47967c=_0x274c38[_0x51fddd(0xf0)]['currentParticlesPosition'];_0x274c38['particlesTextures']['currentParticlesPosition']=_0x274c38['particlesTextures']['postProcessingPosition'],_0x274c38['particlesTextures']['postProcessingPosition']=_0x47967c,_0x274c38['primitives'][_0x51fddd(0x13e)]['commandToExecute']['outputTexture']=_0x274c38['particlesTextures'][_0x51fddd(0x13c)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function _0x148dd2(){var _0x4cb45a=_0x1a5cf2;return _0x274c38['particlesTextures'][_0x4cb45a(0x13c)];},'nextParticlesSpeed':function _0x564423(){return _0x274c38['particlesTextures']['nextParticlesSpeed'];},'lonRange':function _0x4e9a23(){var _0x23cb07=_0x1a5cf2;return _0x27806c[_0x23cb07(0x1c1)];},'latRange':function _0x28b517(){return _0x27806c['latRange'];},'randomCoefficient':function _0x324a2c(){var _0x2de447=Math['random']();return _0x2de447;},'dropRate':function _0x300d80(){return _0x2b60a3['dropRate'];},'dropRateBump':function _0x46c128(){return _0x2b60a3['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function _0x657eb3(){var _0x1b6289=_0x1a5cf2;_0x274c38[_0x1b6289(0x1bf)]['postProcessingPosition'][_0x1b6289(0x16d)]['outputTexture']=_0x274c38['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x1a5cf2(0x1ae),'uniformMap':{'postProcessingPosition':function _0x2d6c35(){return _0x274c38['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function _0x47267f(){var _0x220671=_0x1a5cf2;return _0x274c38[_0x220671(0xf0)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function _0x3efb81(){_0x274c38['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x274c38['particlesTextures']['postProcessingSpeed'];}})};}}]),_0x238fb4;}()),Cesium$2=mars3d__namespace[_0x50b879(0x1a3)],ParticleSystem=(function(){var _0x19868e=_0x50b879;function _0x275d7b(_0x10be34,_0x1773d7,_0x3500dd,_0x2d37f8){var _0x3e0df6=_0xe51c;_classCallCheck(this,_0x275d7b),this['context']=_0x10be34,_0x1773d7=_objectSpread2({},_0x1773d7);if(_0x1773d7['udata']&&_0x1773d7['vdata']){var _0x321ee0,_0x1daa00,_0x271bd8,_0x56d967,_0x7a8dc3,_0x338545;_0x1773d7['dimensions']={},_0x1773d7['dimensions']['lon']=_0x1773d7['cols'],_0x1773d7[_0x3e0df6(0xee)]['lat']=_0x1773d7['rows'],_0x1773d7['dimensions']['lev']=_0x1773d7['lev']||0x1,_0x1773d7[_0x3e0df6(0x169)]={},_0x1773d7['lon']['min']=_0x1773d7['xmin'],_0x1773d7['lon']['max']=_0x1773d7['xmax'],_0x1773d7['lat']={},_0x1773d7['lat']['min']=_0x1773d7[_0x3e0df6(0x166)],_0x1773d7['lat']['max']=_0x1773d7[_0x3e0df6(0xd0)],_0x1773d7[_0x3e0df6(0x1c8)]={},_0x1773d7[_0x3e0df6(0x1c8)]['min']=(_0x321ee0=_0x1773d7['levmin'])!==null&&_0x321ee0!==void 0x0?_0x321ee0:0x1,_0x1773d7['lev']['max']=(_0x1daa00=_0x1773d7[_0x3e0df6(0x162)])!==null&&_0x1daa00!==void 0x0?_0x1daa00:0x1,_0x1773d7['U']={},_0x1773d7['U'][_0x3e0df6(0x150)]=new Float32Array(_0x1773d7['udata']),_0x1773d7['U']['min']=(_0x271bd8=_0x1773d7['umin'])!==null&&_0x271bd8!==void 0x0?_0x271bd8:Math['min']['apply'](Math,_toConsumableArray(_0x1773d7[_0x3e0df6(0x145)])),_0x1773d7['U']['max']=(_0x56d967=_0x1773d7['umax'])!==null&&_0x56d967!==void 0x0?_0x56d967:Math['max']['apply'](Math,_toConsumableArray(_0x1773d7['udata'])),_0x1773d7['V']={},_0x1773d7['V']['array']=new Float32Array(_0x1773d7['vdata']),_0x1773d7['V']['min']=(_0x7a8dc3=_0x1773d7[_0x3e0df6(0x171)])!==null&&_0x7a8dc3!==void 0x0?_0x7a8dc3:Math['min']['apply'](Math,_toConsumableArray(_0x1773d7['vdata'])),_0x1773d7['V']['max']=(_0x338545=_0x1773d7[_0x3e0df6(0x188)])!==null&&_0x338545!==void 0x0?_0x338545:Math['max']['apply'](Math,_toConsumableArray(_0x1773d7['vdata']));}this[_0x3e0df6(0x1bb)]=_0x1773d7,this['options']=_0x3500dd,this['viewerParameters']=_0x2d37f8,this[_0x3e0df6(0xdd)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x3e0df6(0x120)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}return _createClass(_0x275d7b,[{'key':_0x19868e(0x10d),'value':function _0x59959a(_0x47ed4a){var _0x439428=_0x19868e,_0x828d8=this;this['particlesComputing'][_0x439428(0xf1)](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](function(_0x53b9a9){_0x828d8['particlesComputing']['windTextures'][_0x53b9a9]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x439428(0x17a)](this['particlesRendering']['framebuffers'])[_0x439428(0x1bd)](function(_0x21544c){var _0x4f1506=_0x439428;_0x828d8['particlesRendering'][_0x4f1506(0x134)][_0x21544c]['destroy']();}),this['context']=_0x47ed4a,this[_0x439428(0xdd)]=new ParticlesComputing(this[_0x439428(0x120)],this['data'],this['options'],this[_0x439428(0x1a7)]),this['particlesRendering']=new ParticlesRendering(this[_0x439428(0x120)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}},{'key':_0x19868e(0x184),'value':function _0x14a070(){var _0x4eaf09=_0x19868e,_0x50f77f=this,_0x29fd10=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x4eaf09(0x11f)]});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](function(_0x4a9536){var _0x5f29fb=_0x4eaf09;_0x29fd10['framebuffer']=_0x50f77f[_0x5f29fb(0x189)][_0x5f29fb(0x134)][_0x4a9536],_0x29fd10['execute'](_0x50f77f[_0x5f29fb(0x120)]);});}},{'key':'refreshParticles','value':function _0x58f0ca(_0x1fdbeb){var _0x35d2bc=_0x19868e;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x35d2bc(0x1af)](this[_0x35d2bc(0x120)],this['options'],this[_0x35d2bc(0x1a7)]);if(_0x1fdbeb){var _0x1c5101=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x1c5101;var _0x5d75bb=Cesium$2[_0x35d2bc(0x110)]['fromGeometry']({'context':this['context'],'geometry':_0x1c5101,'attributeLocations':this['particlesRendering']['primitives']['segments'][_0x35d2bc(0x16b)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this[_0x35d2bc(0x189)]['primitives'][_0x35d2bc(0x126)]['commandToExecute'][_0x35d2bc(0x186)]=_0x5d75bb;}}},{'key':'setOptions','value':function _0x1e7cf6(_0x3bc3c7){var _0x4d3ad3=_0x19868e,_0x1bb6a2=this,_0x162ca0=![];this['options']['maxParticles']!==_0x3bc3c7['maxParticles']&&(_0x162ca0=!![]),Object['keys'](_0x3bc3c7)[_0x4d3ad3(0x1bd)](function(_0x28a275){_0x1bb6a2['options'][_0x28a275]=_0x3bc3c7[_0x28a275];}),this['refreshParticles'](_0x162ca0);}},{'key':'applyViewerParameters','value':function _0xb12384(_0x4dd0e8){var _0x24314e=_0x19868e,_0x185f01=this;Object['keys'](_0x4dd0e8)[_0x24314e(0x1bd)](function(_0x2ec20a){_0x185f01['viewerParameters'][_0x2ec20a]=_0x4dd0e8[_0x2ec20a];}),this['refreshParticles'](![]);}},{'key':_0x19868e(0x165),'value':function _0x448f07(){var _0x2325a8=_0x19868e,_0x5df138=this;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x2325a8(0xf1)](),Object[_0x2325a8(0x17a)](this['particlesComputing'][_0x2325a8(0xde)])['forEach'](function(_0x4fcda6){_0x5df138['particlesComputing']['windTextures'][_0x4fcda6]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x2325a8(0x165)](),Object[_0x2325a8(0x17a)](this[_0x2325a8(0x189)]['framebuffers'])['forEach'](function(_0x458a17){_0x5df138['particlesRendering']['framebuffers'][_0x458a17]['destroy']();});for(var _0x45006a in this){delete this[_0x45006a];}}}]),_0x275d7b;}()),Cesium$1=mars3d__namespace[_0x50b879(0x1a3)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x50b879(0x1c9)]},WindLayer=function(_0x5b336a){var _0x127541=_0x50b879;_inherits(_0x383ad4,_0x5b336a);var _0x500d78=_createSuper(_0x383ad4);function _0x383ad4(){var _0x20af7c=_0xe51c,_0x1a81ae,_0xcedd33=arguments[_0x20af7c(0x118)]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x383ad4),_0xcedd33=_objectSpread2(_objectSpread2({},DEF_OPTIONS),_0xcedd33),_0x1a81ae=_0x500d78['call'](this,_0xcedd33),_0x1a81ae['_setOptionsHook'](_0xcedd33),_0x1a81ae;}return _createClass(_0x383ad4,[{'key':'layer','get':function _0x454ef2(){var _0xef3b9=_0xe51c;return this[_0xef3b9(0x1bf)];}},{'key':'data','get':function _0x1c5f11(){var _0xf572e5=_0xe51c;return this[_0xf572e5(0xf8)];},'set':function _0x1d1d31(_0x4bb4a1){this['setData'](_0x4bb4a1);}},{'key':'colors','get':function _0xf78e16(){return this['options']['colors'];},'set':function _0x5672eb(_0x541e29){this['options']['colors']=_0x541e29,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x541e29}),this['resize']();}},{'key':_0x127541(0x1c7),'value':function _0x172c75(){}},{'key':'_addedHook','value':function _0x2c38ed(){var _0x3f2699=_0x127541;this['scene']=this['_map']['scene'],this[_0x3f2699(0x147)]=this['_map']['camera'],this['primitives']=new Cesium$1[(_0x3f2699(0x19d))](),this['_map'][_0x3f2699(0x13f)][_0x3f2699(0x1bf)]['add'](this[_0x3f2699(0x1bf)]),this['viewerParameters']={'lonRange':new Cesium$1[(_0x3f2699(0x158))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x3f2699(0xf9)]=new Cesium$1['BoundingSphere'](Cesium$1[_0x3f2699(0x13b)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x3f2699(0xe2)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType'][_0x3f2699(0x12e)],this[_0x3f2699(0x137)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x3f2699(0xd4)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x3f2699(0xf8)]);}},{'key':'_removedHook','value':function _0x394387(){var _0x3505a5=_0x127541;window[_0x3505a5(0x17b)](_0x3505a5(0xf3),this[_0x3505a5(0xf3)]),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x3505a5(0x196)](mars3d__namespace[_0x3505a5(0xe6)]['wheel'],this[_0x3505a5(0x137)],this),this[_0x3505a5(0x1b8)][_0x3505a5(0x196)](mars3d__namespace[_0x3505a5(0xe6)][_0x3505a5(0xe0)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x3505a5(0x13a)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x3505a5(0xe6)]['mouseMove'],this[_0x3505a5(0xd8)],this),this[_0x3505a5(0x1bf)][_0x3505a5(0x173)](),this[_0x3505a5(0x1b8)]['scene'][_0x3505a5(0x1bf)]['remove'](this['primitives']);}},{'key':_0x127541(0xf3),'value':function _0x4d4825(){var _0x182869=_0x127541;if(!this[_0x182869(0x132)]||!this['particleSystem'])return;this[_0x182869(0x1bf)]['show']=![],this['primitives'][_0x182869(0x173)](),this['_map']['once'](mars3d__namespace[_0x182869(0xe6)]['preRender'],this[_0x182869(0x19f)],this);}},{'key':'_onMap_preRenderEvent','value':function _0x583613(_0x25cee4){var _0x38e8b7=_0x127541;this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this[_0x38e8b7(0x1bf)]['show']=!![];}},{'key':'_onMapWhellEvent','value':function _0x1d4cc7(_0x51f56b){var _0x34ff5b=_0x127541,_0x456197=this;clearTimeout(this[_0x34ff5b(0x128)]);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x34ff5b(0x128)]=setTimeout(function(){var _0x2235db=_0x34ff5b;if(!_0x456197[_0x2235db(0x132)])return;_0x456197['redraw']();},0xc8);}},{'key':'_onMouseDownEvent','value':function _0x4c950f(_0x3a8d11){var _0x5b2b97=_0x127541;this[_0x5b2b97(0x1a9)]=!![];}},{'key':_0x127541(0xd8),'value':function _0x50f5db(_0x515d2b){var _0x26808c=_0x127541;if(!this[_0x26808c(0x132)]||!this[_0x26808c(0x15c)])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}},{'key':'_onMouseUpEvent','value':function _0x528008(_0x356526){var _0x46b638=_0x127541;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives'][_0x46b638(0x132)]=!![],this['mouse_down']=![],this['mouse_move']=![];}},{'key':'redraw','value':function _0x5f0640(){var _0x2f0be2=_0x127541;if(!this['_map']||!this[_0x2f0be2(0x132)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives']['show']=!![];}},{'key':'setData','value':function _0x2dfed8(_0x16206d){var _0x2b51b2=_0x127541;this[_0x2b51b2(0xf8)]=_0x16206d,this['particleSystem']&&this[_0x2b51b2(0x15c)]['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x16206d,this[_0x2b51b2(0x10a)](),this['viewerParameters']),this['addPrimitives']();}},{'key':'_setOptionsHook','value':function _0x489344(_0x3b3c7f,_0x36c21c){var _0x37be68=_0x127541;if(_0x3b3c7f)for(var _0x1287f6 in _0x3b3c7f){this[_0x1287f6]=_0x3b3c7f[_0x1287f6];}this['particleSystem']&&this[_0x37be68(0x15c)]['setOptions'](this[_0x37be68(0x10a)]());}},{'key':_0x127541(0x10a),'value':function _0x248b27(){var _0x51168b=_0x127541,_0x3ad1b7=Math[_0x51168b(0x119)](Math[_0x51168b(0x185)](this['particlesNumber']));return this['particlesNumber']=_0x3ad1b7*_0x3ad1b7,{'particlesTextureSize':_0x3ad1b7,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x51168b(0x14e)],'dropRate':this['dropRate'],'dropRateBump':this[_0x51168b(0x19e)],'speedFactor':this['speedFactor'],'lineWidth':this[_0x51168b(0x192)],'colors':this[_0x51168b(0x14a)]};}},{'key':'addPrimitives','value':function _0x14ed56(){var _0x4c1842=_0x127541;this['primitives']['add'](this[_0x4c1842(0x15c)]['particlesComputing']['primitives'][_0x4c1842(0x101)]),this[_0x4c1842(0x1bf)][_0x4c1842(0x104)](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this['primitives']['add'](this[_0x4c1842(0x15c)]['particlesComputing']['primitives'][_0x4c1842(0x13e)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this[_0x4c1842(0x1bf)][_0x4c1842(0x104)](this['particleSystem']['particlesComputing'][_0x4c1842(0x1bf)][_0x4c1842(0xda)]),this['primitives'][_0x4c1842(0x104)](this[_0x4c1842(0x15c)]['particlesRendering'][_0x4c1842(0x1bf)]['segments']),this['primitives'][_0x4c1842(0x104)](this['particleSystem']['particlesRendering']['primitives'][_0x4c1842(0x19b)]),this['primitives']['add'](this[_0x4c1842(0x15c)][_0x4c1842(0x189)]['primitives']['screen']);}},{'key':_0x127541(0x177),'value':function _0x330036(){var _0x56b7f0=_0x127541,_0x1174f8=this['camera']['computeViewRectangle'](this['scene']['globe'][_0x56b7f0(0x1aa)]);if(!_0x1174f8){var _0x31380a=this[_0x56b7f0(0x1b8)][_0x56b7f0(0xdb)]();_0x1174f8=Cesium$1['Rectangle'][_0x56b7f0(0x167)](_0x31380a['xmin'],_0x31380a['ymin'],_0x31380a['xmax'],_0x31380a[_0x56b7f0(0xd0)]);}var _0x327bec=Util[_0x56b7f0(0x187)](_0x1174f8);this['viewerParameters'][_0x56b7f0(0x1c1)]['x']=_0x327bec[_0x56b7f0(0x169)][_0x56b7f0(0x1c3)],this['viewerParameters']['lonRange']['y']=_0x327bec['lon'][_0x56b7f0(0x10f)],this[_0x56b7f0(0x1a7)]['latRange']['x']=_0x327bec[_0x56b7f0(0x174)]['min'],this['viewerParameters']['latRange']['y']=_0x327bec[_0x56b7f0(0x174)][_0x56b7f0(0x10f)];var _0x327147=this['camera']['getPixelSize'](this[_0x56b7f0(0xf9)],this[_0x56b7f0(0x13f)]['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x327147>0x0&&(this['viewerParameters']['pixelSize']=_0x327147);}}]),_0x383ad4;}(BaseLayer$1);mars3d__namespace[_0x50b879(0x14b)]['register'](_0x50b879(0x18f),WindLayer),mars3d__namespace['layer'][_0x50b879(0x136)]=WindLayer;var CanvasParticle=(function(){var _0x266a51=_0x50b879;function _0x45e0ed(){var _0x414f2f=_0xe51c;_classCallCheck(this,_0x45e0ed),this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x414f2f(0x10c)]=null,this['age']=null;}return _createClass(_0x45e0ed,[{'key':_0x266a51(0x165),'value':function _0x3e6e64(){for(var _0x470bb1 in this){delete this[_0x470bb1];}}}]),_0x45e0ed;}()),CanvasWindField=(function(){var _0xeba64d=_0x50b879;function _0xec449e(_0x48358d){_classCallCheck(this,_0xec449e),this['setOptions'](_0x48358d);}return _createClass(_0xec449e,[{'key':'speedRate','get':function _0x404a05(){var _0x24c112=_0xe51c;return this[_0x24c112(0x11d)];},'set':function _0x41c25e(_0x270edc){var _0x3c11a0=_0xe51c;this[_0x3c11a0(0x11d)]=(0x64-(_0x270edc>0x63?0x63:_0x270edc))*0x64,this[_0x3c11a0(0x124)]=[(this[_0x3c11a0(0x15a)]-this['xmin'])/this[_0x3c11a0(0x11d)],(this['ymax']-this[_0x3c11a0(0x166)])/this['_speedRate']];}},{'key':'maxAge','get':function _0x12437c(){return this['_maxAge'];},'set':function _0x5106fe(_0x38ead6){var _0x52de33=_0xe51c;this[_0x52de33(0xe4)]=_0x38ead6;}},{'key':_0xeba64d(0x183),'value':function _0x4a88c3(_0x8e0510){var _0x8140d5=_0xeba64d;this['options']=_0x8e0510,this['maxAge']=_0x8e0510[_0x8140d5(0x163)]||0x78,this[_0x8140d5(0x12f)]=_0x8e0510[_0x8140d5(0x12f)]||0x32,this['particles']=[];var _0x425465=_0x8e0510['particlesNumber']||0x1000;for(var _0xde281d=0x0;_0xde281d<_0x425465;_0xde281d++){var _0x10e1ea=this[_0x8140d5(0x198)](new CanvasParticle());this[_0x8140d5(0x154)]['push'](_0x10e1ea);}}},{'key':'setDate','value':function _0x194d25(_0x3a83d8){var _0x2a8612=_0xeba64d;this['rows']=_0x3a83d8['rows'],this['cols']=_0x3a83d8['cols'],this['xmin']=_0x3a83d8[_0x2a8612(0x116)],this['xmax']=_0x3a83d8['xmax'],this['ymin']=_0x3a83d8['ymin'],this[_0x2a8612(0xd0)]=_0x3a83d8[_0x2a8612(0xd0)],this['grid']=[];var _0x5f181f=_0x3a83d8['udata'],_0x5e4020=_0x3a83d8['vdata'],_0x1e4de1=![];_0x5f181f['length']===this['rows']&&_0x5f181f[0x0]['length']===this[_0x2a8612(0x133)]&&(_0x1e4de1=!![]);var _0x2bef72=0x0,_0x2a16e1=null,_0x3ac9be=null;for(var _0x531671=0x0;_0x531671<this['rows'];_0x531671++){_0x2a16e1=[];for(var _0x3e50a0=0x0;_0x3e50a0<this['cols'];_0x3e50a0++,_0x2bef72++){_0x1e4de1?_0x3ac9be=this['_calcUV'](_0x5f181f[_0x531671][_0x3e50a0],_0x5e4020[_0x531671][_0x3e50a0]):_0x3ac9be=this[_0x2a8612(0x1ab)](_0x5f181f[_0x2bef72],_0x5e4020[_0x2bef72]),_0x2a16e1['push'](_0x3ac9be);}this['grid'][_0x2a8612(0x151)](_0x2a16e1);}this['options']['reverseY']&&this['grid']['reverse']();}},{'key':_0xeba64d(0x122),'value':function _0x4f0a1a(){var _0x2a564=_0xeba64d;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x2a564(0x166)],delete this['ymax'],delete this['grid'],delete this['particles'];}},{'key':'toGridXY','value':function _0xc95c53(_0x3aede2,_0x215c6b){var _0x51d0c6=_0xeba64d,_0x572084=(_0x3aede2-this['xmin'])/(this['xmax']-this[_0x51d0c6(0x116)])*(this['cols']-0x1),_0x1ca685=(this['ymax']-_0x215c6b)/(this[_0x51d0c6(0xd0)]-this['ymin'])*(this[_0x51d0c6(0xf4)]-0x1);return[_0x572084,_0x1ca685];}},{'key':_0xeba64d(0x1c0),'value':function _0x2dfb55(_0x36275d,_0x50bc39){var _0x27e07f=_0xeba64d;if(_0x36275d<0x0||_0x36275d>=this['cols']||_0x50bc39>=this['rows'])return[0x0,0x0,0x0];var _0xedd114=Math[_0x27e07f(0x1ba)](_0x36275d),_0x2d4e0f=Math[_0x27e07f(0x1ba)](_0x50bc39);if(_0xedd114===_0x36275d&&_0x2d4e0f===_0x50bc39)return this['grid'][_0x50bc39][_0x36275d];var _0x29f999=_0xedd114+0x1,_0x980297=_0x2d4e0f+0x1,_0x18e8df=this[_0x27e07f(0x1c0)](_0xedd114,_0x2d4e0f),_0x55bea6=this['getUVByXY'](_0x29f999,_0x2d4e0f),_0x2d56ae=this[_0x27e07f(0x1c0)](_0xedd114,_0x980297),_0x4bbb89=this['getUVByXY'](_0x29f999,_0x980297),_0x435a4e=null;try{_0x435a4e=this['_bilinearInterpolation'](_0x36275d-_0xedd114,_0x50bc39-_0x2d4e0f,_0x18e8df,_0x55bea6,_0x2d56ae,_0x4bbb89);}catch(_0x58ac62){console['log'](_0x36275d,_0x50bc39);}return _0x435a4e;}},{'key':'_bilinearInterpolation','value':function _0x36d8ed(_0x21bfb0,_0x1a6daa,_0x1086b8,_0x3cb039,_0x1d5ea7,_0x3ae305){var _0x50dbb4=0x1-_0x21bfb0,_0x4c3684=0x1-_0x1a6daa,_0x4ddc58=_0x50dbb4*_0x4c3684,_0x1cf97c=_0x21bfb0*_0x4c3684,_0x2b1e5b=_0x50dbb4*_0x1a6daa,_0x214ec5=_0x21bfb0*_0x1a6daa,_0xe1f7cf=_0x1086b8[0x0]*_0x4ddc58+_0x3cb039[0x0]*_0x1cf97c+_0x1d5ea7[0x0]*_0x2b1e5b+_0x3ae305[0x0]*_0x214ec5,_0x2bcfb8=_0x1086b8[0x1]*_0x4ddc58+_0x3cb039[0x1]*_0x1cf97c+_0x1d5ea7[0x1]*_0x2b1e5b+_0x3ae305[0x1]*_0x214ec5;return this['_calcUV'](_0xe1f7cf,_0x2bcfb8);}},{'key':'_calcUV','value':function _0x591d0c(_0x52c954,_0x404d46){return[+_0x52c954,+_0x404d46,Math['sqrt'](_0x52c954*_0x52c954+_0x404d46*_0x404d46)];}},{'key':'getUVByPoint','value':function _0x3278a3(_0x1099f7,_0xb00526){if(!this['isInExtent'](_0x1099f7,_0xb00526))return null;var _0x32d2bf=this['toGridXY'](_0x1099f7,_0xb00526),_0x4e4f9e=this['getUVByXY'](_0x32d2bf[0x0],_0x32d2bf[0x1]);return _0x4e4f9e;}},{'key':'isInExtent','value':function _0xcd2baa(_0x3720fa,_0xa3c29){var _0x294bf4=_0xeba64d;return _0x3720fa>=this[_0x294bf4(0x116)]&&_0x3720fa<=this['xmax']&&_0xa3c29>=this['ymin']&&_0xa3c29<=this['ymax']?!![]:![];}},{'key':'getRandomLatLng','value':function _0x35167c(){var _0x5ba84b=fRandomByfloat(this['xmin'],this['xmax']),_0x160536=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x160536,'lng':_0x5ba84b};}},{'key':'getParticles','value':function _0x361ec5(){var _0x3bf99f=_0xeba64d,_0x42d8d5,_0x556997,_0x403673;for(var _0x1461cb=0x0,_0x24f608=this['particles'][_0x3bf99f(0x118)];_0x1461cb<_0x24f608;_0x1461cb++){var _0x26d410=this['particles'][_0x1461cb];_0x26d410['age']<=0x0&&(_0x26d410=this['_randomParticle'](_0x26d410));if(_0x26d410[_0x3bf99f(0x194)]>0x0){var _0xdb4f4d=_0x26d410['tlng'],_0x2130a1=_0x26d410[_0x3bf99f(0x10c)];_0x403673=this['getUVByPoint'](_0xdb4f4d,_0x2130a1),_0x403673?(_0x42d8d5=_0xdb4f4d+this['_calc_speedRate'][0x0]*_0x403673[0x0],_0x556997=_0x2130a1+this['_calc_speedRate'][0x1]*_0x403673[0x1],_0x26d410['lng']=_0xdb4f4d,_0x26d410['lat']=_0x2130a1,_0x26d410['tlng']=_0x42d8d5,_0x26d410['tlat']=_0x556997,_0x26d410['age']--):_0x26d410['age']=0x0;}}return this['particles'];}},{'key':'_randomParticle','value':function _0x29cac1(_0x58f168){var _0x1bd8bf=_0xeba64d,_0x1a017a,_0x581a3c;for(var _0x4f4628=0x0;_0x4f4628<0x1e;_0x4f4628++){_0x1a017a=this['getRandomLatLng'](),_0x581a3c=this[_0x1bd8bf(0x1a6)](_0x1a017a['lng'],_0x1a017a['lat']);if(_0x581a3c&&_0x581a3c[0x2]>0x0)break;}if(!_0x581a3c)return _0x58f168;var _0x57e624=_0x1a017a['lng']+this['_calc_speedRate'][0x0]*_0x581a3c[0x0],_0x58a158=_0x1a017a['lat']+this['_calc_speedRate'][0x1]*_0x581a3c[0x1];return _0x58f168['lng']=_0x1a017a['lng'],_0x58f168[_0x1bd8bf(0x174)]=_0x1a017a['lat'],_0x58f168['tlng']=_0x57e624,_0x58f168['tlat']=_0x58a158,_0x58f168['age']=Math['round'](Math['random']()*this['maxAge']),_0x58f168;}},{'key':_0xeba64d(0x165),'value':function _0x21ad24(){for(var _0x49606f in this){delete this[_0x49606f];}}}]),_0xec449e;}());function fRandomByfloat(_0x37fcce,_0x5684ad){var _0x3f9525=_0x50b879;return _0x37fcce+Math[_0x3f9525(0x176)]()*(_0x5684ad-_0x37fcce);}var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x50b879(0x190)],CanvasWindLayer=function(_0x4c2c74){var _0xa186f4=_0x50b879;_inherits(_0xc4c788,_0x4c2c74);var _0x146dab=_createSuper(_0xc4c788);function _0xc4c788(){var _0x1930fe,_0x1d800f=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0xc4c788),_0x1930fe=_0x146dab['call'](this,_0x1d800f),_0x1930fe['_setOptionsHook'](_0x1d800f),_0x1930fe['canvas']=null,_0x1930fe;}return _createClass(_0xc4c788,[{'key':'_setOptionsHook','value':function _0x380812(_0x288742,_0x40b89f){var _0x500b3d=_0xe51c,_0x2b491a,_0x330874,_0x1a648c;this['frameTime']=0x3e8/(_0x288742['frameRate']||0xa),this['_pointerEvents']=(_0x2b491a=this['options'][_0x500b3d(0x1c4)])!==null&&_0x2b491a!==void 0x0?_0x2b491a:![],this['color']=_0x288742['color']||'#ffffff',this['lineWidth']=_0x288742[_0x500b3d(0x192)]||0x1,this['fixedHeight']=(_0x330874=_0x288742['fixedHeight'])!==null&&_0x330874!==void 0x0?_0x330874:0x0,this['reverseY']=(_0x1a648c=_0x288742['reverseY'])!==null&&_0x1a648c!==void 0x0?_0x1a648c:![],this[_0x500b3d(0x18e)]&&this[_0x500b3d(0x18e)]['setOptions'](_0x288742);}},{'key':'layer','get':function _0xc058a7(){return this['canvas'];}},{'key':_0xa186f4(0xfb),'get':function _0x5b8118(){var _0x2085e7=_0xa186f4;return this['_map']['scene'][_0x2085e7(0x1a4)]['clientWidth'];}},{'key':'canvasHeight','get':function _0x56912b(){var _0x24e4c4=_0xa186f4;return this['_map'][_0x24e4c4(0x13f)]['canvas']['clientHeight'];}},{'key':_0xa186f4(0x1c4),'get':function _0x42de3d(){return this['_pointerEvents'];},'set':function _0xa6577(_0x140e47){var _0x526723=_0xa186f4;this['_pointerEvents']=_0x140e47;if(!this[_0x526723(0x1a4)])return;_0x140e47?this['canvas']['style']['pointer-events']='all':this['canvas']['style']['pointer-events']=_0x526723(0xeb);}},{'key':'particlesNumber','get':function _0x45ff95(){var _0x1169ca=_0xa186f4;return this['options'][_0x1169ca(0x156)];},'set':function _0x12d6f8(_0x18674a){var _0x328794=_0xa186f4,_0x5dd181=this;this[_0x328794(0xec)]['particlesNumber']=_0x18674a,clearTimeout(this[_0x328794(0x14d)]),this[_0x328794(0x14d)]=setTimeout(function(){_0x5dd181['redraw']();},0x1f4);}},{'key':'speedRate','get':function _0x4c7e94(){return this['options']['speedRate'];},'set':function _0xf5fd62(_0x23a1d9){var _0x25cbda=_0xa186f4;this['options'][_0x25cbda(0x12f)]=_0x23a1d9,this['windField']&&(this['windField']['speedRate']=_0x23a1d9);}},{'key':_0xa186f4(0x163),'get':function _0x24468a(){return this['options']['maxAge'];},'set':function _0x5ce85b(_0x45301a){var _0x4151c6=_0xa186f4;this['options']['maxAge']=_0x45301a,this['windField']&&(this[_0x4151c6(0x18e)][_0x4151c6(0x163)]=_0x45301a);}},{'key':_0xa186f4(0x1bb),'get':function _0x2e64f7(){return this['windData'];},'set':function _0x5c2fc0(_0x426b73){this['setData'](_0x426b73);}},{'key':'_showHook','value':function _0x3970fb(_0x4bc044){var _0x49f126=_0xa186f4;_0x4bc044?this['_addedHook']():(this[_0x49f126(0x199)]&&(this['options']['data']=this['windData']),this['_removedHook']());}},{'key':'_mountedHook','value':function _0x302df7(){var _0x2993ef=_0xa186f4;this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this[_0x2993ef(0xec)]);}},{'key':_0xa186f4(0x152),'value':function _0x98839a(){var _0x5c404f=_0xa186f4;this['canvas']=this[_0x5c404f(0x1bc)](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x5c404f(0x1bb)]&&this['setData'](this[_0x5c404f(0xec)]['data']);}},{'key':'_removedHook','value':function _0x253a2d(){var _0xc1721=_0xa186f4;this['clear'](),this['unbindEvent'](),this['canvas']&&(this[_0xc1721(0x1b8)][_0xc1721(0xfa)]['removeChild'](this['canvas']),delete this['canvas']);}},{'key':'_createCanvas','value':function _0x15e2c1(){var _0x12c7f5=_0xa186f4,_0x480389=document[_0x12c7f5(0x160)]('canvas');_0x480389['style']['position']='absolute',_0x480389[_0x12c7f5(0x106)]['top']=_0x12c7f5(0xff),_0x480389[_0x12c7f5(0x106)][_0x12c7f5(0x131)]='0px',_0x480389['style']['width']='100%',_0x480389['style'][_0x12c7f5(0x10e)]=_0x12c7f5(0xe5),_0x480389['style'][_0x12c7f5(0x1c4)]=this['_pointerEvents']?'auto':_0x12c7f5(0xeb),_0x480389['style']['zIndex']=0xa,_0x480389[_0x12c7f5(0x16c)]('id','canvasWindy'),_0x480389[_0x12c7f5(0x16c)](_0x12c7f5(0x15e),_0x12c7f5(0x14c)),this['_map'][_0x12c7f5(0xfa)]['appendChild'](_0x480389);var _0x517efb=this['_map'][_0x12c7f5(0x13f)];return _0x480389['width']=_0x517efb['canvas']['clientWidth'],_0x480389['height']=_0x517efb['canvas']['clientHeight'],_0x480389;}},{'key':'resize','value':function _0x15abff(){var _0x1edeff=_0xa186f4;this[_0x1edeff(0x1a4)]&&(this['canvas']['width']=this['canvasWidth'],this[_0x1edeff(0x1a4)]['height']=this[_0x1edeff(0x11c)]);}},{'key':'bindEvent','value':function _0x1402c7(){var _0x527188=_0xa186f4,_0x1b6c49=this,_0x27412f=Date[_0x527188(0x15d)]();(function _0xba806a(){var _0x3573cc=_0x527188;_0x1b6c49['animateFrame']=window[_0x3573cc(0x105)](_0xba806a);if(_0x1b6c49['show']&&_0x1b6c49['windField']){var _0x4d5af1=Date['now'](),_0x2500c4=_0x4d5af1-_0x27412f;_0x2500c4>_0x1b6c49['frameTime']&&(_0x27412f=_0x4d5af1-_0x2500c4%_0x1b6c49['frameTime'],_0x1b6c49['update']());}}(),window['addEventListener'](_0x527188(0xf3),this[_0x527188(0xf3)]['bind'](this),![]),this[_0x527188(0x1a9)]=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace[_0x527188(0xe6)][_0x527188(0x12e)],this[_0x527188(0x137)],this),this['_map']['on'](mars3d__namespace[_0x527188(0xe6)][_0x527188(0xe0)],this[_0x527188(0xd2)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x527188(0x13a)],this[_0x527188(0xd4)],this)));}},{'key':'unbindEvent','value':function _0x3b5299(){var _0x191b57=_0xa186f4;window[_0x191b57(0x168)](this[_0x191b57(0x17f)]),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x191b57(0xf3)]),this[_0x191b57(0xec)]['mouseHidden']&&(this['_map']['off'](mars3d__namespace[_0x191b57(0xe6)][_0x191b57(0x12e)],this['_onMapWhellEvent'],this),this[_0x191b57(0x1b8)]['off'](mars3d__namespace['EventType'][_0x191b57(0xe0)],this['_onMouseDownEvent'],this),this['_map'][_0x191b57(0x196)](mars3d__namespace[_0x191b57(0xe6)]['mouseUp'],this[_0x191b57(0xd4)],this),this['_map']['off'](mars3d__namespace[_0x191b57(0xe6)]['mouseMove'],this['_onMouseMoveEvent'],this));}},{'key':'_onMapWhellEvent','value':function _0xbd9225(_0x2841ce){var _0x1622a9=_0xa186f4,_0xe24546=this;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this[_0x1622a9(0x1a4)]['style']['visibility']=_0x1622a9(0x18c),this['refreshTimer']=setTimeout(function(){var _0x285426=_0x1622a9;if(!_0xe24546['show'])return;_0xe24546[_0x285426(0x11e)](),_0xe24546['canvas']['style']['visibility']=_0x285426(0x111);},0xc8);}},{'key':_0xa186f4(0xd2),'value':function _0x4991bd(_0x324311){var _0x51455e=_0xa186f4;this[_0x51455e(0x1a9)]=!![],this['_map'][_0x51455e(0x196)](mars3d__namespace['EventType']['mouseMove'],this[_0x51455e(0xd8)],this),this[_0x51455e(0x1b8)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}},{'key':'_onMouseMoveEvent','value':function _0xe9cb33(_0x59f23d){var _0x5347f8=_0xa186f4;if(!this['show']||!this[_0x5347f8(0x1a4)])return;this['mouse_down']&&(this['canvas']['style'][_0x5347f8(0x17c)]='hidden',this[_0x5347f8(0x11b)]=!![]);}},{'key':'_onMouseUpEvent','value':function _0x134bc2(_0x463ff8){var _0x537655=_0xa186f4;if(!this['show']||!this['canvas'])return;this[_0x537655(0x1b8)]['off'](mars3d__namespace[_0x537655(0xe6)]['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x537655(0x11b)]&&this[_0x537655(0x11e)](),this['canvas']['style']['visibility']='visible',this[_0x537655(0x1a9)]=![],this['mouse_move']=![];}},{'key':'setData','value':function _0x2fe9e5(_0x576d47){var _0x385560=_0xa186f4;this['clear'](),this['windData']=_0x576d47,this['windField']['setDate'](_0x576d47),this[_0x385560(0x11e)]();}},{'key':'redraw','value':function _0xe488ef(){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}},{'key':_0xa186f4(0x153),'value':function _0x382f33(){var _0x37d12e=_0xa186f4;if(this[_0x37d12e(0x143)])return;this['_updateIng']=!![];if(this['worker'])this['windField'][_0x37d12e(0x153)]();else{var _0x1358e4=this['windField'][_0x37d12e(0x181)]();this[_0x37d12e(0xf7)](_0x1358e4);}this['_updateIng']=![];}},{'key':_0xa186f4(0xf7),'value':function _0x370dd7(_0x48e0a5){var _0x8b3a59=_0xa186f4;this[_0x8b3a59(0x195)][_0x8b3a59(0x19a)]='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this[_0x8b3a59(0x195)]['globalCompositeOperation']='lighter',this[_0x8b3a59(0x195)]['globalAlpha']=0.9,this[_0x8b3a59(0x195)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x8b3a59(0x195)]['strokeStyle']=this['color'];var _0x53b23a=this['_map']['scene']['mode']!==Cesium['SceneMode'][_0x8b3a59(0x121)];for(var _0x126197=0x0,_0x2afd28=_0x48e0a5['length'];_0x126197<_0x2afd28;_0x126197++){var _0x208ba7=_0x48e0a5[_0x126197],_0x306b96=this[_0x8b3a59(0x170)](_0x208ba7['lng'],_0x208ba7['lat'],_0x208ba7),_0x2f2e53=this['_tomap'](_0x208ba7['tlng'],_0x208ba7['tlat'],_0x208ba7);if(!_0x306b96||!_0x2f2e53)continue;if(_0x53b23a&&Math['abs'](_0x306b96[0x0]-_0x2f2e53[0x0])>=this['canvasWidth'])continue;this[_0x8b3a59(0x195)][_0x8b3a59(0x140)](_0x306b96[0x0],_0x306b96[0x1]),this['canvasContext'][_0x8b3a59(0xe1)](_0x2f2e53[0x0],_0x2f2e53[0x1]);}this['canvasContext'][_0x8b3a59(0x164)]();}},{'key':'_tomap','value':function _0xbd31d8(_0x1d197e,_0x571d2f,_0x101491){var _0x1a76ff=_0xa186f4,_0x2cc1b7=Cesium['Cartesian3']['fromDegrees'](_0x1d197e,_0x571d2f,this['fixedHeight']),_0x3b982c=this['_map']['scene'];if(_0x3b982c['mode']===Cesium['SceneMode'][_0x1a76ff(0x121)]){var _0x58db13=new Cesium['EllipsoidalOccluder'](_0x3b982c['globe']['ellipsoid'],_0x3b982c['camera']['positionWC']),_0x56047e=_0x58db13[_0x1a76ff(0xce)](_0x2cc1b7);if(!_0x56047e)return _0x101491['age']=0x0,null;}var _0xb85e7e=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this[_0x1a76ff(0x1b8)]['scene'],_0x2cc1b7);return _0xb85e7e?[_0xb85e7e['x'],_0xb85e7e['y']]:null;}},{'key':'clear','value':function _0x4d5f8b(){var _0x52efa4=_0xa186f4;this['windField'][_0x52efa4(0x122)](),delete this['windData'];}},{'key':'initWorker','value':function _0x1825f3(){var _0xabf564=this;this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=function(_0x5e3d21){_0xabf564['_drawLines'](_0x5e3d21['data']['particles']),_0xabf564['_updateIng2']=![];},this['windField']={'init':function _0xe86934(_0x15fa01){_0xabf564['worker']['postMessage']({'type':'init','options':_0x15fa01});},'setOptions':function _0x240150(_0x284da8){var _0xc72f55=_0xe51c;_0xabf564['worker'][_0xc72f55(0x135)]({'type':'setOptions','options':_0x284da8});},'setDate':function _0x166361(_0x363aa5){var _0x1a56e0=_0xe51c;_0xabf564[_0x1a56e0(0x178)][_0x1a56e0(0x135)]({'type':'setDate','data':_0x363aa5});},'update':function _0x4ff1b2(){if(_0xabf564['_updateIng2'])return;_0xabf564['_updateIng2']=!![],_0xabf564['worker']['postMessage']({'type':'update'});},'clear':function _0x2cbdf4(){var _0x4db072=_0xe51c;_0xabf564[_0x4db072(0x178)]['postMessage']({'type':_0x4db072(0x122)});}},this['windField']['init'](this['options']);}}]),_0xc4c788;}(BaseLayer);mars3d__namespace[_0x50b879(0x14b)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x50b879(0x18d)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
