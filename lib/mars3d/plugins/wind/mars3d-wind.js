/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.9
 * 编译日期：2023-05-29 18:07:50
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x36f0aa=_0x54ff;(function(_0x26f939,_0x26e85f){const _0x2cddad=_0x54ff,_0x3a8850=_0x26f939();while(!![]){try{const _0x52aec1=parseInt(_0x2cddad(0x251))/0x1+-parseInt(_0x2cddad(0x246))/0x2+parseInt(_0x2cddad(0x17b))/0x3*(-parseInt(_0x2cddad(0x1c0))/0x4)+-parseInt(_0x2cddad(0x1f8))/0x5+parseInt(_0x2cddad(0x233))/0x6*(parseInt(_0x2cddad(0x221))/0x7)+parseInt(_0x2cddad(0x16e))/0x8*(parseInt(_0x2cddad(0x19f))/0x9)+parseInt(_0x2cddad(0x212))/0xa;if(_0x52aec1===_0x26e85f)break;else _0x3a8850['push'](_0x3a8850['shift']());}catch(_0xdcfbd0){_0x3a8850['push'](_0x3a8850['shift']());}}}(_0x9bc8,0xad176));function _interopNamespace(_0x5067fe){const _0x3eec87=_0x54ff;if(_0x5067fe&&_0x5067fe['__esModule'])return _0x5067fe;var _0x491798=Object[_0x3eec87(0x25e)](null);return _0x5067fe&&Object['keys'](_0x5067fe)['forEach'](function(_0x3fc3cd){const _0x473fd9=_0x3eec87;if(_0x3fc3cd!=='default'){var _0x5f25c3=Object['getOwnPropertyDescriptor'](_0x5067fe,_0x3fc3cd);Object[_0x473fd9(0x1a5)](_0x491798,_0x3fc3cd,_0x5f25c3['get']?_0x5f25c3:{'enumerable':!![],'get':function(){return _0x5067fe[_0x3fc3cd];}});}}),_0x491798['default']=_0x5067fe,_0x491798;}var mars3d__namespace=_interopNamespace(mars3d);function _0x54ff(_0x388d29,_0x161660){const _0x9bc84d=_0x9bc8();return _0x54ff=function(_0x54ff0f,_0x175dbc){_0x54ff0f=_0x54ff0f-0x16d;let _0x4b2c00=_0x9bc84d[_0x54ff0f];return _0x4b2c00;},_0x54ff(_0x388d29,_0x161660);}const Cesium$7=mars3d__namespace[_0x36f0aa(0x236)];function getU(_0x49617a,_0x28a561){const _0x3b31d5=_0x49617a*Math['cos'](Cesium$7['Math']['toRadians'](_0x28a561));return _0x3b31d5;}function getV(_0x2f2fb2,_0x29bba9){const _0x472590=_0x2f2fb2*Math['sin'](Cesium$7['Math']['toRadians'](_0x29bba9));return _0x472590;}function getSpeed(_0x3836c2,_0x1820fd){const _0x48e320=Math['sqrt'](Math['pow'](_0x3836c2,0x2)+Math['pow'](_0x1820fd,0x2));return _0x48e320;}function getDirection(_0x10663d,_0x1ab759){const _0x183046=_0x36f0aa;let _0x18b8bb=Cesium$7['Math']['toDegrees'](Math[_0x183046(0x1d9)](_0x1ab759,_0x10663d));return _0x18b8bb+=_0x18b8bb<0x0?0x168:0x0,_0x18b8bb;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x36f0aa(0x236)];class CustomPrimitive{constructor(_0x244103){const _0x7ff88f=_0x36f0aa;this['commandType']=_0x244103['commandType'],this['geometry']=_0x244103[_0x7ff88f(0x19c)],this[_0x7ff88f(0x1da)]=_0x244103['attributeLocations'],this['primitiveType']=_0x244103['primitiveType'],this[_0x7ff88f(0x1bb)]=_0x244103[_0x7ff88f(0x1bb)],this['vertexShaderSource']=_0x244103['vertexShaderSource'],this['fragmentShaderSource']=_0x244103['fragmentShaderSource'],this['rawRenderState']=_0x244103['rawRenderState'],this['framebuffer']=_0x244103[_0x7ff88f(0x21c)],this['outputTexture']=_0x244103['outputTexture'],this['autoClear']=_0x244103[_0x7ff88f(0x1ae)]??![],this['preExecute']=_0x244103[_0x7ff88f(0x183)],this['show']=!![],this[_0x7ff88f(0x1e1)]=undefined,this[_0x7ff88f(0x22b)]=undefined,this[_0x7ff88f(0x1ae)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x7ff88f(0x1ee)]}));}['createCommand'](_0x4fae4d){const _0x13a05a=_0x36f0aa;switch(this['commandType']){case'Draw':{const _0x528674=Cesium$6['VertexArray']['fromGeometry']({'context':_0x4fae4d,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x53e5ef=Cesium$6['ShaderProgram'][_0x13a05a(0x228)]({'context':_0x4fae4d,'attributeLocations':this[_0x13a05a(0x1da)],'vertexShaderSource':this[_0x13a05a(0x1fb)],'fragmentShaderSource':this[_0x13a05a(0x255)]}),_0x7b45b8=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x13a05a(0x1df)],'shaderProgram':_0x53e5ef,'vertexArray':_0x528674,'modelMatrix':Cesium$6[_0x13a05a(0x25a)][_0x13a05a(0x1ec)],'renderState':_0x7b45b8,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x13a05a(0x1ee)],'pickOnly':!![],'owner':this});}case _0x13a05a(0x194):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x13a05a(0x255)],'uniformMap':this['uniformMap'],'outputTexture':this[_0x13a05a(0x23c)],'persists':!![]});}}}['setGeometry'](_0x4e2ffc,_0x1f82d9){const _0x1f5b36=_0x36f0aa;this['geometry']=_0x1f82d9;const _0x52786a=Cesium$6['VertexArray'][_0x1f5b36(0x1e2)]({'context':_0x4e2ffc,'geometry':this[_0x1f5b36(0x19c)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x1f5b36(0x205)]});this['commandToExecute']['vertexArray']=_0x52786a;}['update'](_0x3e0286){const _0x2825a1=_0x36f0aa;if(!this['show'])return;if(_0x3e0286['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x2825a1(0x1e1)]=this[_0x2825a1(0x1cf)](_0x3e0286['context'])),Cesium$6['defined'](this[_0x2825a1(0x183)])&&this['preExecute'](),Cesium$6[_0x2825a1(0x1ac)](this[_0x2825a1(0x22b)])&&_0x3e0286['commandList']['push'](this['clearCommand']),_0x3e0286[_0x2825a1(0x1b2)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x3cf69c=_0x36f0aa;if(this[_0x3cf69c(0x22b)]){var _0x45bd19,_0x5c1c85;(_0x45bd19=this[_0x3cf69c(0x22b)])!==null&&_0x45bd19!==void 0x0&&_0x45bd19['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x5c1c85=this['clearCommand'])!==null&&_0x5c1c85!==void 0x0&&_0x5c1c85['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x3cf69c(0x1ce)](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x3cf69c(0x1ce)](),this['commandToExecute'][_0x3cf69c(0x1fe)]&&this[_0x3cf69c(0x1e1)][_0x3cf69c(0x1fe)][_0x3cf69c(0x1ce)](),delete this['commandToExecute']),Cesium$6[_0x3cf69c(0x1fa)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x159d55=function(){const _0x2cd9c5=_0x54ff,_0xa7f71f=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x2cd9c5(0x24e)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0xa7f71f;},_0x5b795c=function(_0x38b32b,_0x179c2d){const _0x47775f=_0x54ff;if(Cesium$5['defined'](_0x179c2d)){const _0x3143e9={};_0x3143e9[_0x47775f(0x178)]=_0x179c2d,_0x38b32b['source']=_0x3143e9;}const _0x54c29e=new Cesium$5['Texture'](_0x38b32b);return _0x54c29e;},_0x510f0f=function(_0x287fd1,_0x599fe9,_0x285b63){const _0x4d094f=_0x54ff,_0x221f8f=new Cesium$5[(_0x4d094f(0x1ef))]({'context':_0x287fd1,'colorTextures':[_0x599fe9],'depthTexture':_0x285b63});return _0x221f8f;},_0x28b800=function(_0x36c71a){const _0x4c8831=_0x54ff,_0x3b5eca=!![],_0x837616=![],_0x2a52c0={'viewport':_0x36c71a[_0x4c8831(0x182)],'depthTest':_0x36c71a[_0x4c8831(0x1be)],'depthMask':_0x36c71a['depthMask'],'blending':_0x36c71a[_0x4c8831(0x216)]},_0x18a94a=Cesium$5['Appearance'][_0x4c8831(0x16f)](_0x3b5eca,_0x837616,_0x2a52c0);return _0x18a94a;},_0x26a333=function(_0x139da4){const _0x57f723=_0x54ff,_0x10c570={},_0x4abeee=Cesium$5['Math'][_0x57f723(0x1b3)](_0x139da4['west'],Cesium$5['Math']['TWO_PI']),_0x14c4ba=Cesium$5[_0x57f723(0x1a1)]['mod'](_0x139da4[_0x57f723(0x176)],Cesium$5['Math']['TWO_PI']),_0x10a06a=_0x139da4[_0x57f723(0x1f6)];let _0x40b4c2,_0xc34d0d;_0x10a06a>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x40b4c2=0x0,_0xc34d0d=Cesium$5['Math']['TWO_PI']):_0x14c4ba-_0x4abeee<_0x10a06a?(_0x40b4c2=_0x4abeee,_0xc34d0d=_0x4abeee+_0x10a06a):(_0x40b4c2=_0x4abeee,_0xc34d0d=_0x14c4ba);_0x10c570['lon']={'min':Cesium$5['Math']['toDegrees'](_0x40b4c2),'max':Cesium$5['Math']['toDegrees'](_0xc34d0d)};const _0x300a63=_0x139da4[_0x57f723(0x250)],_0x52891b=_0x139da4['north'],_0x40bcee=_0x139da4[_0x57f723(0x1e4)],_0x513d26=_0x40bcee>Cesium$5['Math']['PI']/0xc?_0x40bcee/0x2:0x0;let _0x1344e5=Cesium$5['Math']['clampToLatitudeRange'](_0x300a63-_0x513d26),_0x401aa3=Cesium$5['Math'][_0x57f723(0x184)](_0x52891b+_0x513d26);return _0x1344e5<-Cesium$5[_0x57f723(0x1a1)]['PI_OVER_THREE']&&(_0x1344e5=-Cesium$5[_0x57f723(0x1a1)]['PI_OVER_TWO']),_0x401aa3>Cesium$5['Math']['PI_OVER_THREE']&&(_0x401aa3=Cesium$5['Math'][_0x57f723(0x198)]),_0x10c570['lat']={'min':Cesium$5['Math'][_0x57f723(0x239)](_0x1344e5),'max':Cesium$5['Math'][_0x57f723(0x239)](_0x401aa3)},_0x10c570;};return{'getFullscreenQuad':_0x159d55,'createTexture':_0x5b795c,'createFramebuffer':_0x510f0f,'createRawRenderState':_0x28b800,'viewRectangleToLonLatRange':_0x26a333};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x36f0aa(0x1b9),trailDraw_frag=_0x36f0aa(0x254),screenDraw_frag=_0x36f0aa(0x1d0);const Cesium$4=mars3d__namespace[_0x36f0aa(0x236)];class ParticlesRendering{constructor(_0x2e6202,_0x7ac59b,_0x1ad9f5,_0x22f771,_0x415853){const _0x5a865f=_0x36f0aa;this['createRenderingTextures'](_0x2e6202,_0x7ac59b,_0x1ad9f5[_0x5a865f(0x179)]),this[_0x5a865f(0x1c8)](_0x2e6202),this[_0x5a865f(0x1d8)](_0x2e6202,_0x1ad9f5,_0x22f771,_0x415853);}['createRenderingTextures'](_0x277419,_0xfcc2e4,_0x239d58){const _0x4f672c=_0x36f0aa,_0x2c96a8={'context':_0x277419,'width':_0x277419[_0x4f672c(0x18e)],'height':_0x277419['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x4f672c(0x199)][_0x4f672c(0x1de)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x1d6775={'context':_0x277419,'width':_0x277419['drawingBufferWidth'],'height':_0x277419['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x4f672c(0x18d)][_0x4f672c(0x1a8)]},_0x4aa490=_0x239d58['length'],_0x34726d=new Float32Array(_0x4aa490*0x3);for(let _0x3b1a7e=0x0;_0x3b1a7e<_0x4aa490;_0x3b1a7e++){const _0x30e87f=Cesium$4['Color'][_0x4f672c(0x258)](_0x239d58[_0x3b1a7e]);_0x34726d[0x3*_0x3b1a7e]=_0x30e87f['red'],_0x34726d[0x3*_0x3b1a7e+0x1]=_0x30e87f['green'],_0x34726d[0x3*_0x3b1a7e+0x2]=_0x30e87f['blue'];}const _0x4f3750={'context':_0x277419,'width':_0x4aa490,'height':0x1,'pixelFormat':Cesium$4[_0x4f672c(0x199)]['RGB'],'pixelDatatype':Cesium$4[_0x4f672c(0x18d)][_0x4f672c(0x24e)],'sampler':new Cesium$4[(_0x4f672c(0x196))]({'minificationFilter':Cesium$4[_0x4f672c(0x256)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x2c96a8),'segmentsDepth':Util['createTexture'](_0x1d6775),'currentTrailsColor':Util['createTexture'](_0x2c96a8),'currentTrailsDepth':Util[_0x4f672c(0x237)](_0x1d6775),'nextTrailsColor':Util['createTexture'](_0x2c96a8),'nextTrailsDepth':Util['createTexture'](_0x1d6775),'colorTable':Util['createTexture'](_0x4f3750,_0x34726d)};}[_0x36f0aa(0x1c8)](_0x318f){const _0xfc75f8=_0x36f0aa;this['framebuffers']={'segments':Util[_0xfc75f8(0x204)](_0x318f,this['textures']['segmentsColor'],this[_0xfc75f8(0x24a)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x318f,this[_0xfc75f8(0x24a)]['currentTrailsColor'],this[_0xfc75f8(0x24a)][_0xfc75f8(0x1b0)]),'nextTrails':Util[_0xfc75f8(0x204)](_0x318f,this['textures']['nextTrailsColor'],this['textures'][_0xfc75f8(0x243)])};}[_0x36f0aa(0x1d1)](_0x2e2a46){const _0x31cd80=_0x36f0aa,_0x553756=0x4;let _0x286afa=[];for(let _0x1167e7=0x0;_0x1167e7<_0x2e2a46['particlesTextureSize'];_0x1167e7++){for(let _0x462e91=0x0;_0x462e91<_0x2e2a46['particlesTextureSize'];_0x462e91++){for(let _0x4de8db=0x0;_0x4de8db<_0x553756;_0x4de8db++){_0x286afa[_0x31cd80(0x1af)](_0x1167e7/_0x2e2a46[_0x31cd80(0x192)]),_0x286afa['push'](_0x462e91/_0x2e2a46['particlesTextureSize']);}}}_0x286afa=new Float32Array(_0x286afa);let _0x1bfbe2=[];const _0x35c658=[-0x1,0x1],_0x50eb4d=[-0x1,0x1];for(let _0x3b56fd=0x0;_0x3b56fd<_0x2e2a46[_0x31cd80(0x1d4)];_0x3b56fd++){for(let _0x4a481c=0x0;_0x4a481c<_0x553756/0x2;_0x4a481c++){for(let _0x4f0b1b=0x0;_0x4f0b1b<_0x553756/0x2;_0x4f0b1b++){_0x1bfbe2['push'](_0x35c658[_0x4a481c]),_0x1bfbe2[_0x31cd80(0x1af)](_0x50eb4d[_0x4f0b1b]),_0x1bfbe2['push'](0x0);}}}_0x1bfbe2=new Float32Array(_0x1bfbe2);const _0x5a140c=0x6*_0x2e2a46[_0x31cd80(0x1d4)],_0x434cc7=new Uint32Array(_0x5a140c);for(let _0x33128c=0x0,_0x52f327=0x0,_0x1147da=0x0;_0x33128c<_0x2e2a46['maxParticles'];_0x33128c++){_0x434cc7[_0x52f327++]=_0x1147da+0x0,_0x434cc7[_0x52f327++]=_0x1147da+0x1,_0x434cc7[_0x52f327++]=_0x1147da+0x2,_0x434cc7[_0x52f327++]=_0x1147da+0x2,_0x434cc7[_0x52f327++]=_0x1147da+0x1,_0x434cc7[_0x52f327++]=_0x1147da+0x3,_0x1147da+=0x4;}const _0x43cf88=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x31cd80(0x171)][_0x31cd80(0x24e)],'componentsPerAttribute':0x2,'values':_0x286afa}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x1bfbe2})}),'indices':_0x434cc7});return _0x43cf88;}[_0x36f0aa(0x1d8)](_0x5ce24c,_0x2a0f90,_0x3bb38a,_0x5c8656){const _0x462acd=_0x36f0aa,_0xefe795=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x2a0f90),'primitiveType':Cesium$4['PrimitiveType'][_0x462acd(0x218)],'uniformMap':{'currentParticlesPosition':function(){return _0x5c8656['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x1bedb8=_0x462acd;return _0x5c8656['particlesTextures'][_0x1bedb8(0x1dd)];},'postProcessingSpeed':function(){const _0x27c5b2=_0x462acd;return _0x5c8656['particlesTextures'][_0x27c5b2(0x20e)];},'colorTable':function(){return _0xefe795['textures']['colorTable'];},'aspect':function(){const _0x1e46ac=_0x462acd;return _0x5ce24c['drawingBufferWidth']/_0x5ce24c[_0x1e46ac(0x25d)];},'pixelSize':function(){return _0x3bb38a['pixelSize'];},'lineWidth':function(){return _0x2a0f90['lineWidth'];},'particleHeight':function(){return _0x2a0f90['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x462acd(0x225)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0xefe795['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0xefe795['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x3d068b=_0x462acd;return _0xefe795[_0x3d068b(0x225)][_0x3d068b(0x226)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x2e5eb2=_0x462acd;return _0xefe795['framebuffers'][_0x2e5eb2(0x226)]['depthTexture'];},'fadeOpacity':function(){return _0x2a0f90['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x499900=_0x462acd,_0x11369b=_0xefe795['framebuffers']['currentTrails'];_0xefe795['framebuffers'][_0x499900(0x226)]=_0xefe795[_0x499900(0x225)]['nextTrails'],_0xefe795[_0x499900(0x225)][_0x499900(0x193)]=_0x11369b,_0xefe795[_0x499900(0x20b)][_0x499900(0x20d)]['commandToExecute']['framebuffer']=_0xefe795['framebuffers']['nextTrails'],_0xefe795['primitives']['trails'][_0x499900(0x22b)]['framebuffer']=_0xefe795[_0x499900(0x225)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x462acd(0x20c)][_0x462acd(0x218)],'uniformMap':{'trailsColorTexture':function(){const _0x38c880=_0x462acd;return _0xefe795['framebuffers']['nextTrails'][_0x38c880(0x229)](0x0);},'trailsDepthTexture':function(){const _0x1eeda3=_0x462acd;return _0xefe795['framebuffers'][_0x1eeda3(0x193)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x36f0aa(0x25b),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x36f0aa(0x236)];class ParticlesComputing{constructor(_0x10c965,_0x47da04,_0x1da9a7,_0x49a170){const _0x46a0e5=_0x36f0aa;this[_0x46a0e5(0x21a)]=_0x47da04,this[_0x46a0e5(0x1dc)](_0x10c965,_0x47da04),this['createParticlesTextures'](_0x10c965,_0x1da9a7,_0x49a170),this[_0x46a0e5(0x240)](_0x47da04,_0x1da9a7,_0x49a170);}['createWindTextures'](_0x2aab8e,_0xaf4859){const _0x5d120b=_0x36f0aa,_0x449898={'context':_0x2aab8e,'width':_0xaf4859['dimensions'][_0x5d120b(0x224)],'height':_0xaf4859['dimensions']['lat']*(_0xaf4859['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x5d120b(0x196))]({'minificationFilter':Cesium$3[_0x5d120b(0x256)][_0x5d120b(0x1b1)],'magnificationFilter':Cesium$3[_0x5d120b(0x1a7)]['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x449898,_0xaf4859['U'][_0x5d120b(0x1d3)]),'V':Util[_0x5d120b(0x237)](_0x449898,_0xaf4859['V']['array'])};}[_0x36f0aa(0x238)](_0x277a50,_0x5ca919,_0x45fe99){const _0x761af1=_0x36f0aa,_0x2132c4={'context':_0x277a50,'width':_0x5ca919[_0x761af1(0x192)],'height':_0x5ca919['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x761af1(0x1de)],'pixelDatatype':Cesium$3['PixelDatatype'][_0x761af1(0x24e)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x58f6f6=this['randomizeParticles'](_0x5ca919[_0x761af1(0x1d4)],_0x45fe99),_0x5d77c0=new Float32Array(0x4*_0x5ca919['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x2132c4),'currentParticlesPosition':Util['createTexture'](_0x2132c4,_0x58f6f6),'nextParticlesPosition':Util['createTexture'](_0x2132c4,_0x58f6f6),'currentParticlesSpeed':Util[_0x761af1(0x237)](_0x2132c4,_0x5d77c0),'nextParticlesSpeed':Util[_0x761af1(0x237)](_0x2132c4,_0x5d77c0),'postProcessingPosition':Util[_0x761af1(0x237)](_0x2132c4,_0x58f6f6),'postProcessingSpeed':Util['createTexture'](_0x2132c4,_0x5d77c0)};}['randomizeParticles'](_0x1927a9,_0xad3b31){const _0x402067=_0x36f0aa,_0x56f93d=new Float32Array(0x4*_0x1927a9);for(let _0x43849a=0x0;_0x43849a<_0x1927a9;_0x43849a++){_0x56f93d[0x4*_0x43849a]=Cesium$3['Math']['randomBetween'](_0xad3b31['lonRange']['x'],_0xad3b31['lonRange']['y']),_0x56f93d[0x4*_0x43849a+0x1]=Cesium$3[_0x402067(0x1a1)]['randomBetween'](_0xad3b31['latRange']['x'],_0xad3b31[_0x402067(0x1ea)]['y']),_0x56f93d[0x4*_0x43849a+0x2]=Cesium$3[_0x402067(0x1a1)]['randomBetween'](this['data'][_0x402067(0x1f3)]['min'],this[_0x402067(0x21a)][_0x402067(0x1f3)]['max']),_0x56f93d[0x4*_0x43849a+0x3]=0x0;}return _0x56f93d;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x34d2f5=>{const _0x27ec08=_0x54ff;this['particlesTextures'][_0x34d2f5][_0x27ec08(0x1ce)]();});}['createComputingPrimitives'](_0xb8b318,_0x4f426a,_0x586593){const _0x4ad509=_0x36f0aa,_0x2458fe=new Cesium$3['Cartesian3'](_0xb8b318['dimensions']['lon'],_0xb8b318['dimensions']['lat'],_0xb8b318['dimensions']['lev']),_0x3918a1=new Cesium$3[(_0x4ad509(0x1c5))](_0xb8b318[_0x4ad509(0x224)]['min'],_0xb8b318['lat'][_0x4ad509(0x17e)],_0xb8b318['lev'][_0x4ad509(0x17e)]),_0x1794b0=new Cesium$3['Cartesian3'](_0xb8b318['lon']['max'],_0xb8b318[_0x4ad509(0x1c6)][_0x4ad509(0x219)],_0xb8b318['lev']['max']),_0x3d6964=new Cesium$3['Cartesian3']((_0x1794b0['x']-_0x3918a1['x'])/(_0x2458fe['x']-0x1),(_0x1794b0['y']-_0x3918a1['y'])/(_0x2458fe['y']-0x1),_0x2458fe['z']>0x1?(_0x1794b0['z']-_0x3918a1['z'])/(_0x2458fe['z']-0x1):0x1),_0x163ed3=new Cesium$3['Cartesian2'](_0xb8b318['U']['min'],_0xb8b318['U'][_0x4ad509(0x219)]),_0x3a038d=new Cesium$3['Cartesian2'](_0xb8b318['V'][_0x4ad509(0x17e)],_0xb8b318['V']['max']),_0x961dd6=this;this[_0x4ad509(0x20b)]={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x961dd6['windTextures']['U'];},'V':function(){return _0x961dd6['windTextures']['V'];},'currentParticlesPosition':function(){return _0x961dd6['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x2458fe;},'minimum':function(){return _0x3918a1;},'maximum':function(){return _0x1794b0;},'interval':function(){return _0x3d6964;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x4ad509(0x21b)][_0x4ad509(0x1a2)],'preExecute':function(){const _0x224b21=_0x4ad509;_0x961dd6['primitives'][_0x224b21(0x1e6)][_0x224b21(0x1e1)]['outputTexture']=_0x961dd6['particlesTextures'][_0x224b21(0x1a2)];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x4ad509(0x194),'uniformMap':{'currentParticlesSpeed':function(){const _0x456495=_0x4ad509;return _0x961dd6['particlesTextures'][_0x456495(0x177)];},'particlesWind':function(){const _0x3c244d=_0x4ad509;return _0x961dd6[_0x3c244d(0x21b)]['particlesWind'];},'uSpeedRange':function(){return _0x163ed3;},'vSpeedRange':function(){return _0x3a038d;},'pixelSize':function(){return _0x586593['pixelSize'];},'speedFactor':function(){const _0x41f848=_0x4ad509;return _0x4f426a[_0x41f848(0x18b)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x4ad509(0x21b)]['nextParticlesSpeed'],'preExecute':function(){const _0x3bb739=_0x4ad509,_0x506b97=_0x961dd6['particlesTextures'][_0x3bb739(0x177)];_0x961dd6['particlesTextures']['currentParticlesSpeed']=_0x961dd6['particlesTextures']['postProcessingSpeed'],_0x961dd6[_0x3bb739(0x21b)]['postProcessingSpeed']=_0x506b97,_0x961dd6['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x961dd6['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x961dd6['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x3bcf44=_0x4ad509;return _0x961dd6['particlesTextures'][_0x3bcf44(0x177)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x2ffc2e=_0x4ad509,_0x33e39f=_0x961dd6['particlesTextures']['currentParticlesPosition'];_0x961dd6['particlesTextures']['currentParticlesPosition']=_0x961dd6[_0x2ffc2e(0x21b)]['postProcessingPosition'],_0x961dd6['particlesTextures']['postProcessingPosition']=_0x33e39f,_0x961dd6['primitives']['updatePosition']['commandToExecute'][_0x2ffc2e(0x23c)]=_0x961dd6[_0x2ffc2e(0x21b)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x29fd12=_0x4ad509;return _0x961dd6[_0x29fd12(0x21b)][_0x29fd12(0x252)];},'nextParticlesSpeed':function(){return _0x961dd6['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x586593['lonRange'];},'latRange':function(){const _0x215c68=_0x4ad509;return _0x586593[_0x215c68(0x1ea)];},'randomCoefficient':function(){const _0x51c4e9=Math['random']();return _0x51c4e9;},'dropRate':function(){const _0x15428e=_0x4ad509;return _0x4f426a[_0x15428e(0x17c)];},'dropRateBump':function(){return _0x4f426a['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x4ad509(0x244))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x40de5d=_0x4ad509;_0x961dd6['primitives'][_0x40de5d(0x1dd)][_0x40de5d(0x1e1)]['outputTexture']=_0x961dd6[_0x40de5d(0x21b)][_0x40de5d(0x1dd)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x3fa7b7=_0x4ad509;return _0x961dd6[_0x3fa7b7(0x21b)][_0x3fa7b7(0x1dd)];},'nextParticlesSpeed':function(){const _0x475c2c=_0x4ad509;return _0x961dd6['particlesTextures'][_0x475c2c(0x202)];}},'fragmentShaderSource':new Cesium$3[(_0x4ad509(0x244))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x4ad509(0x20e)],'preExecute':function(){const _0x125caf=_0x4ad509;_0x961dd6['primitives']['postProcessingSpeed']['commandToExecute'][_0x125caf(0x23c)]=_0x961dd6['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x30cbcd,_0x194110,_0xb3f8de,_0x51ab53){const _0x134f8b=_0x36f0aa;this['context']=_0x30cbcd,_0x194110={..._0x194110},_0x194110['udata']&&_0x194110['vdata']&&(_0x194110['dimensions']={},_0x194110['dimensions'][_0x134f8b(0x224)]=_0x194110['cols'],_0x194110['dimensions'][_0x134f8b(0x1c6)]=_0x194110['rows'],_0x194110[_0x134f8b(0x206)]['lev']=_0x194110['lev']||0x1,_0x194110[_0x134f8b(0x224)]={},_0x194110[_0x134f8b(0x224)]['min']=_0x194110['xmin'],_0x194110['lon']['max']=_0x194110['xmax'],_0x194110['lat']={},_0x194110['lat']['min']=_0x194110[_0x134f8b(0x1f9)],_0x194110['lat']['max']=_0x194110['ymax'],_0x194110['lev']={},_0x194110['lev'][_0x134f8b(0x17e)]=_0x194110['levmin']??0x1,_0x194110['lev']['max']=_0x194110['levmax']??0x1,_0x194110['U']={},_0x194110['U']['array']=new Float32Array(_0x194110['udata']),_0x194110['U']['min']=_0x194110[_0x134f8b(0x231)]??Math[_0x134f8b(0x17e)](..._0x194110['udata']),_0x194110['U'][_0x134f8b(0x219)]=_0x194110['umax']??Math[_0x134f8b(0x219)](..._0x194110['udata']),_0x194110['V']={},_0x194110['V']['array']=new Float32Array(_0x194110[_0x134f8b(0x1d5)]),_0x194110['V']['min']=_0x194110['vmin']??Math['min'](..._0x194110['vdata']),_0x194110['V']['max']=_0x194110[_0x134f8b(0x1f1)]??Math[_0x134f8b(0x219)](..._0x194110['vdata'])),this['data']=_0x194110,this['options']=_0xb3f8de,this['viewerParameters']=_0x51ab53,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x134f8b(0x181)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x134f8b(0x211)],this[_0x134f8b(0x21a)],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x36f0aa(0x249)](_0x5c964d){const _0x15e664=_0x36f0aa;this['particlesComputing'][_0x15e664(0x1ff)](),Object[_0x15e664(0x23d)](this[_0x15e664(0x1c4)]['windTextures'])['forEach'](_0x5021e3=>{this['particlesComputing']['windTextures'][_0x5021e3]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x15e664(0x1ce)](),Object['keys'](this['particlesRendering'][_0x15e664(0x225)])['forEach'](_0x742a26=>{const _0x595bd1=_0x15e664;this[_0x595bd1(0x1cb)][_0x595bd1(0x225)][_0x742a26]['destroy']();}),this[_0x15e664(0x211)]=_0x5c964d,this[_0x15e664(0x1c4)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x15e664(0x211)],this['data'],this[_0x15e664(0x181)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x40daff=_0x36f0aa,_0x28e7b1=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x40daff(0x1ee)]});Object[_0x40daff(0x23d)](this['particlesRendering']['framebuffers'])['forEach'](_0x4e88bb=>{const _0x17e2c5=_0x40daff;_0x28e7b1[_0x17e2c5(0x21c)]=this['particlesRendering']['framebuffers'][_0x4e88bb],_0x28e7b1['execute'](this[_0x17e2c5(0x211)]);});}[_0x36f0aa(0x1a3)](_0x10d8dd){const _0x3e14b4=_0x36f0aa;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x10d8dd){const _0x44aca7=this[_0x3e14b4(0x1cb)]['createSegmentsGeometry'](this['options']);this[_0x3e14b4(0x1cb)]['primitives']['segments']['geometry']=_0x44aca7;const _0x3a25e0=Cesium$2[_0x3e14b4(0x23a)]['fromGeometry']({'context':this['context'],'geometry':_0x44aca7,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this[_0x3e14b4(0x1cb)][_0x3e14b4(0x20b)]['segments'][_0x3e14b4(0x1e1)]['vertexArray']=_0x3a25e0;}}[_0x36f0aa(0x23b)](_0x307513){const _0x45c881=_0x36f0aa;let _0x528a9d=![];this['options']['maxParticles']!==_0x307513[_0x45c881(0x1d4)]&&(_0x528a9d=!![]),Object['keys'](_0x307513)[_0x45c881(0x1db)](_0x52e096=>{this['options'][_0x52e096]=_0x307513[_0x52e096];}),this['refreshParticles'](_0x528a9d);}['applyViewerParameters'](_0x5b0550){Object['keys'](_0x5b0550)['forEach'](_0x1982c4=>{this['viewerParameters'][_0x1982c4]=_0x5b0550[_0x1982c4];}),this['refreshParticles'](![]);}[_0x36f0aa(0x1ce)](){const _0x21d5c3=_0x36f0aa;clearTimeout(this[_0x21d5c3(0x170)]),this[_0x21d5c3(0x1c4)]['destroyParticlesTextures'](),Object['keys'](this[_0x21d5c3(0x1c4)]['windTextures'])['forEach'](_0x3b7886=>{this['particlesComputing']['windTextures'][_0x3b7886]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x26e4d2=>{const _0x449982=_0x21d5c3;this['particlesRendering'][_0x449982(0x225)][_0x26e4d2]['destroy']();});for(const _0x321c5b in this){delete this[_0x321c5b];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x12ca0c={}){_0x12ca0c={...DEF_OPTIONS,..._0x12ca0c},super(_0x12ca0c),this['_setOptionsHook'](_0x12ca0c);}get['layer'](){const _0x45c7a6=_0x36f0aa;return this[_0x45c7a6(0x20b)];}get['data'](){return this['_data'];}set['data'](_0x565471){const _0x59013e=_0x36f0aa;this[_0x59013e(0x174)](_0x565471);}get[_0x36f0aa(0x179)](){return this['options']['colors'];}set[_0x36f0aa(0x179)](_0xa04c5a){const _0x5764ec=_0x36f0aa;this['options']['colors']=_0xa04c5a,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0xa04c5a}),this[_0x5764ec(0x1e8)]();}[_0x36f0aa(0x19d)](){}['_addedHook'](){const _0x4ef7ec=_0x36f0aa;this['scene']=this[_0x4ef7ec(0x21d)]['scene'],this['camera']=this['_map']['camera'],this[_0x4ef7ec(0x20b)]=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x4ef7ec(0x16d)][_0x4ef7ec(0x20b)]['add'](this['primitives']),this[_0x4ef7ec(0x215)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x4ef7ec(0x223)](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x4ef7ec(0x1c3)]=![],this[_0x4ef7ec(0x21d)]['on'](mars3d__namespace[_0x4ef7ec(0x22f)]['wheel'],this['_onMapWhellEvent'],this),this[_0x4ef7ec(0x21d)]['on'](mars3d__namespace['EventType'][_0x4ef7ec(0x22a)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x4ef7ec(0x22f)]['mouseUp'],this[_0x4ef7ec(0x1aa)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x80770c=_0x36f0aa;window[_0x80770c(0x247)]('resize',this['resize']),this['_map']['off'](mars3d__namespace['EventType'][_0x80770c(0x187)],this[_0x80770c(0x201)],this),this[_0x80770c(0x21d)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x80770c(0x195)](mars3d__namespace[_0x80770c(0x22f)]['mouseDown'],this[_0x80770c(0x209)],this),this[_0x80770c(0x21d)]['off'](mars3d__namespace['EventType'][_0x80770c(0x1d2)],this['_onMouseUpEvent'],this),this[_0x80770c(0x21d)]['off'](mars3d__namespace['EventType'][_0x80770c(0x1cc)],this['_onMouseMoveEvent'],this),this[_0x80770c(0x20b)][_0x80770c(0x1f7)](),this[_0x80770c(0x21d)]['scene'][_0x80770c(0x20b)]['remove'](this['primitives']);}['resize'](){const _0x3eb9f6=_0x36f0aa;if(!this[_0x3eb9f6(0x210)]||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x3eb9f6(0x20b)][_0x3eb9f6(0x1f7)](),this['_map']['once'](mars3d__namespace[_0x3eb9f6(0x22f)]['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x52918e){const _0x49fa81=_0x36f0aa;this['particleSystem']['canvasResize'](this['scene'][_0x49fa81(0x211)]),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0xa2bd07){const _0x578c54=_0x36f0aa;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x578c54(0x1e0)])return;this['primitives'][_0x578c54(0x210)]=![],this[_0x578c54(0x1fc)]=setTimeout(()=>{const _0x48499d=_0x578c54;if(!this[_0x48499d(0x210)])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x380777){this['mouse_down']=!![];}[_0x36f0aa(0x1f4)](_0x3ed85e){const _0x4c80cc=_0x36f0aa;if(!this[_0x4c80cc(0x210)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x4ce845){const _0x3ea856=_0x36f0aa;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this[_0x3ea856(0x1c3)]&&this['redraw'](),this['primitives'][_0x3ea856(0x210)]=!![],this[_0x3ea856(0x1bd)]=![],this['mouse_move']=![];}['redraw'](){const _0xae7de5=_0x36f0aa;if(!this[_0xae7de5(0x21d)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x3ec786){const _0x17e0aa=_0x36f0aa;this['_data']=_0x3ec786,this['particleSystem']&&this[_0x17e0aa(0x1e0)][_0x17e0aa(0x1ce)](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x3ec786,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x174e05,_0x2e46f5){const _0x35f8f1=_0x36f0aa;if(_0x174e05)for(const _0x167fde in _0x174e05){this[_0x167fde]=_0x174e05[_0x167fde];}this['particleSystem']&&this['particleSystem'][_0x35f8f1(0x23b)](this['getOptions']());}[_0x36f0aa(0x1e9)](){const _0x383ce0=_0x36f0aa,_0x599501=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this[_0x383ce0(0x242)]=_0x599501*_0x599501,{'particlesTextureSize':_0x599501,'maxParticles':this[_0x383ce0(0x242)],'particleHeight':this[_0x383ce0(0x208)],'fadeOpacity':this[_0x383ce0(0x22c)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x5eae80=_0x36f0aa;this['primitives']['add'](this[_0x5eae80(0x1e0)]['particlesComputing'][_0x5eae80(0x20b)]['getWind']),this['primitives']['add'](this[_0x5eae80(0x1e0)]['particlesComputing']['primitives']['updateSpeed']),this['primitives']['add'](this['particleSystem'][_0x5eae80(0x1c4)][_0x5eae80(0x20b)]['updatePosition']),this[_0x5eae80(0x20b)]['add'](this['particleSystem']['particlesComputing']['primitives'][_0x5eae80(0x1dd)]),this['primitives']['add'](this['particleSystem'][_0x5eae80(0x1c4)]['primitives']['postProcessingSpeed']),this['primitives'][_0x5eae80(0x232)](this[_0x5eae80(0x1e0)][_0x5eae80(0x1cb)]['primitives'][_0x5eae80(0x1ab)]),this[_0x5eae80(0x20b)]['add'](this[_0x5eae80(0x1e0)]['particlesRendering'][_0x5eae80(0x20b)]['trails']),this['primitives'][_0x5eae80(0x232)](this['particleSystem']['particlesRendering']['primitives'][_0x5eae80(0x1fd)]);}[_0x36f0aa(0x223)](){const _0x544b26=_0x36f0aa;let _0x53fbf2=this['camera']['computeViewRectangle'](this['scene'][_0x544b26(0x1d6)]['ellipsoid']);if(!_0x53fbf2){const _0x2c446b=this['_map']['getExtent']();_0x53fbf2=Cesium$1['Rectangle'][_0x544b26(0x1c2)](_0x2c446b['xmin'],_0x2c446b['ymin'],_0x2c446b['xmax'],_0x2c446b['ymax']);}const _0x29b03f=Util['viewRectangleToLonLatRange'](_0x53fbf2);this[_0x544b26(0x215)]['lonRange']['x']=_0x29b03f['lon']['min'],this['viewerParameters'][_0x544b26(0x235)]['y']=_0x29b03f['lon'][_0x544b26(0x219)],this['viewerParameters']['latRange']['x']=_0x29b03f['lat']['min'],this['viewerParameters']['latRange']['y']=_0x29b03f['lat'][_0x544b26(0x219)];const _0x3e4cb5=this['camera'][_0x544b26(0x17f)](this[_0x544b26(0x191)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x3e4cb5>0x0&&(this['viewerParameters']['pixelSize']=_0x3e4cb5);}}mars3d__namespace['LayerUtil']['register'](_0x36f0aa(0x1c7),WindLayer),mars3d__namespace['layer'][_0x36f0aa(0x1ba)]=WindLayer;class CanvasParticle{constructor(){const _0x14114b=_0x36f0aa;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x14114b(0x1b8)]=null,this['age']=null;}['destroy'](){for(const _0x5df54a in this){delete this[_0x5df54a];}}}class CanvasWindField{constructor(_0x333bae){this['setOptions'](_0x333bae);}get['speedRate'](){const _0x5dc481=_0x36f0aa;return this[_0x5dc481(0x175)];}set[_0x36f0aa(0x203)](_0x2c6a34){const _0x3d28e5=_0x36f0aa;this['_speedRate']=(0x64-(_0x2c6a34>0x63?0x63:_0x2c6a34))*0x64,this['_calc_speedRate']=[(this[_0x3d28e5(0x234)]-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get[_0x36f0aa(0x1ca)](){return this['_maxAge'];}set['maxAge'](_0x7fd4a1){const _0x4bd607=_0x36f0aa;this[_0x4bd607(0x21e)]=_0x7fd4a1;}['setOptions'](_0x129e9e){const _0x4fbd78=_0x36f0aa;this['options']=_0x129e9e,this[_0x4fbd78(0x1ca)]=_0x129e9e['maxAge']||0x78,this['speedRate']=_0x129e9e['speedRate']||0x32,this[_0x4fbd78(0x25c)]=[];const _0x289171=_0x129e9e[_0x4fbd78(0x242)]||0x1000;for(let _0x4c055c=0x0;_0x4c055c<_0x289171;_0x4c055c++){const _0x3af2d5=this[_0x4fbd78(0x173)](new CanvasParticle());this[_0x4fbd78(0x25c)]['push'](_0x3af2d5);}}[_0x36f0aa(0x1b6)](_0x481543){const _0x20a74d=_0x36f0aa;this[_0x20a74d(0x189)]=_0x481543['rows'],this['cols']=_0x481543['cols'],this['xmin']=_0x481543['xmin'],this['xmax']=_0x481543['xmax'],this['ymin']=_0x481543['ymin'],this['ymax']=_0x481543['ymax'],this['grid']=[];const _0x5cbc2f=_0x481543['udata'],_0x3b8b28=_0x481543['vdata'];let _0x4201a7=![];_0x5cbc2f['length']===this['rows']&&_0x5cbc2f[0x0]['length']===this['cols']&&(_0x4201a7=!![]);let _0x3201e2=0x0,_0x41e18f=null,_0x47c185=null;for(let _0x34b629=0x0;_0x34b629<this['rows'];_0x34b629++){_0x41e18f=[];for(let _0x10b5b=0x0;_0x10b5b<this['cols'];_0x10b5b++,_0x3201e2++){_0x4201a7?_0x47c185=this[_0x20a74d(0x1f0)](_0x5cbc2f[_0x34b629][_0x10b5b],_0x3b8b28[_0x34b629][_0x10b5b]):_0x47c185=this['_calcUV'](_0x5cbc2f[_0x3201e2],_0x3b8b28[_0x3201e2]),_0x41e18f[_0x20a74d(0x1af)](_0x47c185);}this[_0x20a74d(0x19e)]['push'](_0x41e18f);}this[_0x20a74d(0x181)][_0x20a74d(0x245)]&&this[_0x20a74d(0x19e)]['reverse']();}['clear'](){const _0x51513c=_0x36f0aa;delete this[_0x51513c(0x189)],delete this['cols'],delete this['xmin'],delete this[_0x51513c(0x234)],delete this[_0x51513c(0x1f9)],delete this['ymax'],delete this[_0x51513c(0x19e)],delete this['particles'];}[_0x36f0aa(0x1cd)](_0x52bbe2,_0x3dd6f7){const _0x13147d=_0x36f0aa,_0x2463f=(_0x52bbe2-this['xmin'])/(this['xmax']-this[_0x13147d(0x17a)])*(this['cols']-0x1),_0x277ce9=(this[_0x13147d(0x19a)]-_0x3dd6f7)/(this[_0x13147d(0x19a)]-this[_0x13147d(0x1f9)])*(this[_0x13147d(0x189)]-0x1);return[_0x2463f,_0x277ce9];}['getUVByXY'](_0x109d71,_0x2f4d74){const _0x5c6460=_0x36f0aa;if(_0x109d71<0x0||_0x109d71>=this['cols']||_0x2f4d74>=this[_0x5c6460(0x189)])return[0x0,0x0,0x0];const _0x35977c=Math[_0x5c6460(0x217)](_0x109d71),_0x4364e4=Math['floor'](_0x2f4d74);if(_0x35977c===_0x109d71&&_0x4364e4===_0x2f4d74)return this['grid'][_0x2f4d74][_0x109d71];const _0x41dbfa=_0x35977c+0x1,_0x2a4a25=_0x4364e4+0x1,_0x8ca230=this['getUVByXY'](_0x35977c,_0x4364e4),_0x5df0d4=this['getUVByXY'](_0x41dbfa,_0x4364e4),_0x57d498=this['getUVByXY'](_0x35977c,_0x2a4a25),_0x29ac59=this[_0x5c6460(0x1ad)](_0x41dbfa,_0x2a4a25);let _0x375fbe=null;try{_0x375fbe=this[_0x5c6460(0x1b7)](_0x109d71-_0x35977c,_0x2f4d74-_0x4364e4,_0x8ca230,_0x5df0d4,_0x57d498,_0x29ac59);}catch(_0x18cdee){console['log'](_0x109d71,_0x2f4d74);}return _0x375fbe;}['_bilinearInterpolation'](_0x69c3d6,_0x52acb1,_0x3a4efc,_0x91df9d,_0xe636c1,_0x2c54fe){const _0x57adc8=0x1-_0x69c3d6,_0x4d7cf6=0x1-_0x52acb1,_0x3c8cba=_0x57adc8*_0x4d7cf6,_0x2152ef=_0x69c3d6*_0x4d7cf6,_0x4f1a05=_0x57adc8*_0x52acb1,_0x2e950a=_0x69c3d6*_0x52acb1,_0x5618fb=_0x3a4efc[0x0]*_0x3c8cba+_0x91df9d[0x0]*_0x2152ef+_0xe636c1[0x0]*_0x4f1a05+_0x2c54fe[0x0]*_0x2e950a,_0x4d4109=_0x3a4efc[0x1]*_0x3c8cba+_0x91df9d[0x1]*_0x2152ef+_0xe636c1[0x1]*_0x4f1a05+_0x2c54fe[0x1]*_0x2e950a;return this['_calcUV'](_0x5618fb,_0x4d4109);}[_0x36f0aa(0x1f0)](_0x32f596,_0x44e5bb){return[+_0x32f596,+_0x44e5bb,Math['sqrt'](_0x32f596*_0x32f596+_0x44e5bb*_0x44e5bb)];}['getUVByPoint'](_0xfc3661,_0x173fce){if(!this['isInExtent'](_0xfc3661,_0x173fce))return null;const _0x27e774=this['toGridXY'](_0xfc3661,_0x173fce),_0x27672d=this['getUVByXY'](_0x27e774[0x0],_0x27e774[0x1]);return _0x27672d;}['isInExtent'](_0x3d2b43,_0x272ccf){return _0x3d2b43>=this['xmin']&&_0x3d2b43<=this['xmax']&&_0x272ccf>=this['ymin']&&_0x272ccf<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x169806=_0x36f0aa,_0x146236=fRandomByfloat(this['xmin'],this[_0x169806(0x234)]),_0x1a2341=fRandomByfloat(this[_0x169806(0x1f9)],this['ymax']);return{'lat':_0x1a2341,'lng':_0x146236};}[_0x36f0aa(0x20a)](){const _0x110b0b=_0x36f0aa;let _0x56f6a3,_0x5a91b6,_0x3db52b;for(let _0x4ed089=0x0,_0x354255=this['particles']['length'];_0x4ed089<_0x354255;_0x4ed089++){let _0x54c49b=this['particles'][_0x4ed089];_0x54c49b['age']<=0x0&&(_0x54c49b=this[_0x110b0b(0x173)](_0x54c49b));if(_0x54c49b['age']>0x0){const _0xcda89a=_0x54c49b['tlng'],_0x10c8c4=_0x54c49b['tlat'];_0x3db52b=this['getUVByPoint'](_0xcda89a,_0x10c8c4),_0x3db52b?(_0x56f6a3=_0xcda89a+this[_0x110b0b(0x23f)][0x0]*_0x3db52b[0x0],_0x5a91b6=_0x10c8c4+this['_calc_speedRate'][0x1]*_0x3db52b[0x1],_0x54c49b['lng']=_0xcda89a,_0x54c49b['lat']=_0x10c8c4,_0x54c49b[_0x110b0b(0x24c)]=_0x56f6a3,_0x54c49b[_0x110b0b(0x1b8)]=_0x5a91b6,_0x54c49b[_0x110b0b(0x253)]--):_0x54c49b['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x14cae1){const _0x3dbe92=_0x36f0aa;let _0x1c61f7,_0x20fca4;for(let _0x1426a0=0x0;_0x1426a0<0x1e;_0x1426a0++){_0x1c61f7=this['getRandomLatLng'](),_0x20fca4=this['getUVByPoint'](_0x1c61f7['lng'],_0x1c61f7['lat']);if(_0x20fca4&&_0x20fca4[0x2]>0x0)break;}if(!_0x20fca4)return _0x14cae1;const _0x4b9eb2=_0x1c61f7[_0x3dbe92(0x19b)]+this['_calc_speedRate'][0x0]*_0x20fca4[0x0],_0x199b5e=_0x1c61f7['lat']+this['_calc_speedRate'][0x1]*_0x20fca4[0x1];return _0x14cae1[_0x3dbe92(0x19b)]=_0x1c61f7[_0x3dbe92(0x19b)],_0x14cae1[_0x3dbe92(0x1c6)]=_0x1c61f7['lat'],_0x14cae1[_0x3dbe92(0x24c)]=_0x4b9eb2,_0x14cae1['tlat']=_0x199b5e,_0x14cae1['age']=Math['round'](Math['random']()*this[_0x3dbe92(0x1ca)]),_0x14cae1;}['destroy'](){for(const _0x3dfd01 in this){delete this[_0x3dfd01];}}}function fRandomByfloat(_0x2ccfd4,_0x294008){return _0x2ccfd4+Math['random']()*(_0x294008-_0x2ccfd4);}function _0x9bc8(){const _0x3a7af9=['particlesRendering','mouseMove','toGridXY','destroy','createCommand','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','createSegmentsGeometry','mouseUp','array','maxParticles','vdata','globe','frameTime','createRenderingPrimitives','atan2','attributeLocations','forEach','createWindTextures','postProcessingPosition','RGBA','primitiveType','particleSystem','commandToExecute','fromGeometry','windField','height','clientHeight','getWind','canvasContext','resize','getOptions','latRange','addEventListener','IDENTITY','animateFrame','OPAQUE','Framebuffer','_calcUV','vmax','clientWidth','lev','_onMouseMoveEvent','container','width','removeAll','6239595qRslwF','ymin','destroyObject','vertexShaderSource','refreshTimer','screen','shaderProgram','destroyParticlesTextures','postMessage','_onMap_preRenderEvent','nextParticlesSpeed','speedRate','createFramebuffer','STATIC_DRAW','dimensions','_addedHook','fixedHeight','_onMouseDownEvent','getParticles','primitives','PrimitiveType','trails','postProcessingSpeed','style','show','context','15069030RhyyGW','register','onmessage','viewerParameters','blending','floor','TRIANGLES','max','data','particlesTextures','framebuffer','_map','_maxAge','mode','worker','5747VSCbhF','canvas','updateViewerParameters','lon','framebuffers','currentTrails','canvasWind','fromCache','getColorTexture','mouseDown','clearCommand','fadeOpacity','hidden','canvasWidth','EventType','windData','umin','add','5574poXXwr','xmax','lonRange','Cesium','createTexture','createParticlesTextures','toDegrees','VertexArray','setOptions','outputTexture','keys','_canrefresh','_calc_speedRate','createComputingPrimitives','_pointerEvents','particlesNumber','nextTrailsDepth','ShaderSource','reverseY','1272484goxRuw','removeEventListener','_tomap','canvasResize','textures','lineWidth','tlng','update','FLOAT','_updateIng2','south','621177YSoaNF','nextParticlesPosition','age','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','fragmentShaderSource','TextureMinificationFilter','positionWC','fromCssColorString','CanvasWindLayer','Matrix4','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','particles','drawingBufferHeight','create','0px','scene','4052872SXICnl','getDefaultRenderState','canrefresh','ComponentDatatype','canvasHeight','_randomParticle','setData','_speedRate','east','currentParticlesSpeed','arrayBufferView','colors','xmin','160851hywXfy','dropRate','zIndex','min','getPixelSize','moveTo','options','viewport','preExecute','clampToLatitudeRange','now','SceneTransforms','preRender','pointerEvents','rows','mouseHidden','speedFactor','removeChild','PixelDatatype','drawingBufferWidth','redraw','_onMapWhellEvent','globeBoundingSphere','particlesTextureSize','nextTrails','Compute','off','Sampler','clear','PI_OVER_TWO','PixelFormat','ymax','lng','geometry','_mountedHook','grid','9xVLrAW','wheel','Math','particlesWind','refreshParticles','camera','defineProperty','initWorker','TextureMagnificationFilter','UNSIGNED_INT','abs','_onMouseUpEvent','segments','defined','getUVByXY','autoClear','push','currentTrailsDepth','NEAREST','commandList','mod','color','layer','setDate','_bilinearInterpolation','tlat','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','WindLayer','uniformMap','_updateIng','mouse_down','depthTest','SCENE3D','60Uxcbtj','_removedHook','fromDegrees','mouse_move','particlesComputing','Cartesian3','lat','wind','createRenderingFramebuffers','WindUtil','maxAge'];_0x9bc8=function(){return _0x3a7af9;};return _0x9bc8();}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x36f0aa(0x1b5)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x1c6ba9={}){super(_0x1c6ba9),this['_setOptionsHook'](_0x1c6ba9),this['canvas']=null;}['_setOptionsHook'](_0x1b501c,_0x4e3b56){const _0x192ec7=_0x36f0aa;this['frameTime']=0x3e8/(_0x1b501c['frameRate']||0xa),this['_pointerEvents']=this['options'][_0x192ec7(0x188)]??![],this['color']=_0x1b501c['color']||'#ffffff',this[_0x192ec7(0x24b)]=_0x1b501c['lineWidth']||0x1,this['fixedHeight']=_0x1b501c['fixedHeight']??0x0,this['reverseY']=_0x1b501c['reverseY']??![],this[_0x192ec7(0x1e3)]&&this[_0x192ec7(0x1e3)][_0x192ec7(0x23b)](_0x1b501c);}get['layer'](){const _0x47b5a0=_0x36f0aa;return this[_0x47b5a0(0x222)];}get['canvasWidth'](){const _0x5aa8d2=_0x36f0aa;return this['_map']['scene']['canvas'][_0x5aa8d2(0x1f2)];}get['canvasHeight'](){const _0x34075e=_0x36f0aa;return this['_map']['scene'][_0x34075e(0x222)]['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0xe83a4e){const _0x561217=_0x36f0aa;this['_pointerEvents']=_0xe83a4e;if(!this['canvas'])return;_0xe83a4e?this['canvas']['style']['pointer-events']='all':this['canvas'][_0x561217(0x20f)]['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x547dae){const _0x3961ad=_0x36f0aa;this[_0x3961ad(0x181)]['particlesNumber']=_0x547dae,clearTimeout(this[_0x3961ad(0x23e)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x20ff84=_0x36f0aa;return this['options'][_0x20ff84(0x203)];}set[_0x36f0aa(0x203)](_0x230629){this['options']['speedRate']=_0x230629,this['windField']&&(this['windField']['speedRate']=_0x230629);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x5838ee){const _0xa473e3=_0x36f0aa;this[_0xa473e3(0x181)]['maxAge']=_0x5838ee,this['windField']&&(this['windField']['maxAge']=_0x5838ee);}get['data'](){return this['windData'];}set['data'](_0x23d7bb){this['setData'](_0x23d7bb);}['_showHook'](_0x300345){const _0x25c066=_0x36f0aa;_0x300345?this[_0x25c066(0x207)]():(this[_0x25c066(0x230)]&&(this[_0x25c066(0x181)]['data']=this['windData']),this[_0x25c066(0x1c1)]());}['_mountedHook'](){const _0x24b301=_0x36f0aa;this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this[_0x24b301(0x181)]);}[_0x36f0aa(0x207)](){const _0x1b79ad=_0x36f0aa;this['canvas']=this['_createCanvas'](),this[_0x1b79ad(0x1e7)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0x1b79ad(0x181)]['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x55b13d=_0x36f0aa;this[_0x55b13d(0x197)](),this['unbindEvent'](),this['canvas']&&(this['_map'][_0x55b13d(0x1f5)][_0x55b13d(0x18c)](this['canvas']),delete this[_0x55b13d(0x222)]);}['_createCanvas'](){const _0x2ca5a1=_0x36f0aa,_0x6de68c=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map'][_0x2ca5a1(0x1f5)]);return _0x6de68c['style']['position']='absolute',_0x6de68c[_0x2ca5a1(0x20f)]['top']=_0x2ca5a1(0x25f),_0x6de68c['style']['left']='0px',_0x6de68c['style']['width']=this[_0x2ca5a1(0x21d)]['scene'][_0x2ca5a1(0x222)][_0x2ca5a1(0x1f2)]+'px',_0x6de68c[_0x2ca5a1(0x20f)]['height']=this[_0x2ca5a1(0x21d)]['scene']['canvas'][_0x2ca5a1(0x1e5)]+'px',_0x6de68c['style']['pointerEvents']=this[_0x2ca5a1(0x241)]?'auto':'none',_0x6de68c['style']['zIndex']=this['options'][_0x2ca5a1(0x17d)]??0x9,_0x6de68c['width']=this['_map']['scene'][_0x2ca5a1(0x222)]['clientWidth'],_0x6de68c['height']=this['_map'][_0x2ca5a1(0x16d)][_0x2ca5a1(0x222)]['clientHeight'],_0x6de68c;}[_0x36f0aa(0x1e8)](){const _0x578205=_0x36f0aa;this['canvas']&&(this[_0x578205(0x222)]['style'][_0x578205(0x1f6)]=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this[_0x578205(0x21d)][_0x578205(0x16d)][_0x578205(0x222)][_0x578205(0x1e5)]+'px',this['canvas']['width']=this[_0x578205(0x21d)]['scene'][_0x578205(0x222)][_0x578205(0x1f2)],this['canvas']['height']=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x1ea692=_0x36f0aa,_0x2e0c77=this;let _0x351281=Date[_0x1ea692(0x185)]();(function _0x3b22f2(){const _0x314926=_0x1ea692;_0x2e0c77[_0x314926(0x1ed)]=window['requestAnimationFrame'](_0x3b22f2);if(_0x2e0c77['show']&&_0x2e0c77['windField']){const _0x39b404=Date['now'](),_0x2d9d47=_0x39b404-_0x351281;_0x2d9d47>_0x2e0c77[_0x314926(0x1d7)]&&(_0x351281=_0x39b404-_0x2d9d47%_0x2e0c77[_0x314926(0x1d7)],_0x2e0c77['update']());}}(),window[_0x1ea692(0x1eb)](_0x1ea692(0x1e8),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x1ea692(0x181)][_0x1ea692(0x18a)]&&(this[_0x1ea692(0x21d)]['on'](mars3d__namespace['EventType'][_0x1ea692(0x1a0)],this[_0x1ea692(0x190)],this),this['_map']['on'](mars3d__namespace[_0x1ea692(0x22f)]['mouseDown'],this[_0x1ea692(0x209)],this),this[_0x1ea692(0x21d)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0xfc6e30=_0x36f0aa;window['cancelAnimationFrame'](this[_0xfc6e30(0x1ed)]),delete this['animateFrame'],window['removeEventListener'](_0xfc6e30(0x1e8),this[_0xfc6e30(0x1e8)]),this[_0xfc6e30(0x181)][_0xfc6e30(0x18a)]&&(this[_0xfc6e30(0x21d)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0xfc6e30(0x21d)]['off'](mars3d__namespace['EventType'][_0xfc6e30(0x22a)],this['_onMouseDownEvent'],this),this['_map'][_0xfc6e30(0x195)](mars3d__namespace['EventType'][_0xfc6e30(0x1d2)],this[_0xfc6e30(0x1aa)],this),this['_map']['off'](mars3d__namespace['EventType'][_0xfc6e30(0x1cc)],this['_onMouseMoveEvent'],this));}[_0x36f0aa(0x190)](_0x5e41b1){const _0x53547b=_0x36f0aa;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x53547b(0x222)])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x15457f=_0x53547b;if(!this['show'])return;this[_0x15457f(0x18f)](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0x36f0aa(0x209)](_0x5305d7){const _0x15bdc7=_0x36f0aa;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x15bdc7(0x1f4)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x15bdc7(0x1cc)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x2cbbd4){const _0x5dd93d=_0x36f0aa;if(!this['show']||!this['canvas'])return;this[_0x5dd93d(0x1bd)]&&(this['canvas']['style']['visibility']=_0x5dd93d(0x22d),this[_0x5dd93d(0x1c3)]=!![]);}['_onMouseUpEvent'](_0x4886d3){const _0x278337=_0x36f0aa;if(!this['show']||!this[_0x278337(0x222)])return;this['_map']['off'](mars3d__namespace['EventType'][_0x278337(0x1cc)],this[_0x278337(0x1f4)],this),this[_0x278337(0x1bd)]&&this['mouse_move']&&this['redraw'](),this['canvas'][_0x278337(0x20f)]['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}[_0x36f0aa(0x174)](_0x10ed44){const _0x4b4900=_0x36f0aa;this[_0x4b4900(0x197)](),this['windData']=_0x10ed44,this['windField']['setDate'](_0x10ed44),this['redraw']();}['redraw'](){const _0x11b082=_0x36f0aa;if(!this[_0x11b082(0x210)])return;this['windField'][_0x11b082(0x23b)](this[_0x11b082(0x181)]),this[_0x11b082(0x24d)]();}['update'](){const _0x194f2c=_0x36f0aa;if(this[_0x194f2c(0x1bc)])return;this['_updateIng']=!![];if(this[_0x194f2c(0x220)])this['windField']['update']();else{const _0x2161a4=this['windField']['getParticles']();this['_drawLines'](_0x2161a4);}this['_updateIng']=![];}['_drawLines'](_0x3d0946){const _0x506e0f=_0x36f0aa;this[_0x506e0f(0x1e7)]['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this[_0x506e0f(0x22e)],this[_0x506e0f(0x172)]),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9,this['canvasContext']['beginPath'](),this['canvasContext'][_0x506e0f(0x24b)]=this[_0x506e0f(0x24b)],this['canvasContext']['strokeStyle']=this[_0x506e0f(0x1b4)];const _0x4b1b88=this[_0x506e0f(0x21d)]['scene'][_0x506e0f(0x21f)]!==Cesium['SceneMode'][_0x506e0f(0x1bf)],_0x32531=this[_0x506e0f(0x22e)]*0.25;for(let _0x55eda8=0x0,_0xd4d164=_0x3d0946['length'];_0x55eda8<_0xd4d164;_0x55eda8++){const _0xc8066d=_0x3d0946[_0x55eda8],_0x1b28c0=this[_0x506e0f(0x248)](_0xc8066d['lng'],_0xc8066d['lat'],_0xc8066d),_0x4bdebf=this['_tomap'](_0xc8066d['tlng'],_0xc8066d['tlat'],_0xc8066d);if(!_0x1b28c0||!_0x4bdebf)continue;if(_0x4b1b88&&Math[_0x506e0f(0x1a9)](_0x1b28c0[0x0]-_0x4bdebf[0x0])>=_0x32531)continue;this['canvasContext'][_0x506e0f(0x180)](_0x1b28c0[0x0],_0x1b28c0[0x1]),this['canvasContext']['lineTo'](_0x4bdebf[0x0],_0x4bdebf[0x1]);}this['canvasContext']['stroke']();}[_0x36f0aa(0x248)](_0xaf9a64,_0x2ac40d,_0x2400a7){const _0x217aed=_0x36f0aa,_0x522729=Cesium['Cartesian3']['fromDegrees'](_0xaf9a64,_0x2ac40d,this['fixedHeight']),_0x5149d1=this[_0x217aed(0x21d)][_0x217aed(0x16d)];if(_0x5149d1['mode']===Cesium['SceneMode']['SCENE3D']){const _0x4d8998=new Cesium['EllipsoidalOccluder'](_0x5149d1[_0x217aed(0x1d6)]['ellipsoid'],_0x5149d1[_0x217aed(0x1a4)][_0x217aed(0x257)]),_0x53d930=_0x4d8998['isPointVisible'](_0x522729);if(!_0x53d930)return _0x2400a7['age']=0x0,null;}const _0x31a51d=Cesium[_0x217aed(0x186)]['wgs84ToWindowCoordinates'](this['_map'][_0x217aed(0x16d)],_0x522729);return _0x31a51d?[_0x31a51d['x'],_0x31a51d['y']]:null;}[_0x36f0aa(0x197)](){const _0x3dc900=_0x36f0aa;this['windField']['clear'](),delete this[_0x3dc900(0x230)];}[_0x36f0aa(0x1a6)](){const _0xb0d6e1=_0x36f0aa;this['worker']=new Worker(this['options']['worker']),this['worker'][_0xb0d6e1(0x214)]=_0xad944a=>{this['_drawLines'](_0xad944a['data']['particles']),this['_updateIng2']=![];},this[_0xb0d6e1(0x1e3)]={'init':_0x4e3c9d=>{const _0x3a6419=_0xb0d6e1;this[_0x3a6419(0x220)][_0x3a6419(0x200)]({'type':'init','options':_0x4e3c9d});},'setOptions':_0x2cab56=>{const _0x5b82ae=_0xb0d6e1;this[_0x5b82ae(0x220)]['postMessage']({'type':_0x5b82ae(0x23b),'options':_0x2cab56});},'setDate':_0xa26a42=>{const _0x5b9566=_0xb0d6e1;this['worker']['postMessage']({'type':_0x5b9566(0x1b6),'data':_0xa26a42});},'update':()=>{const _0xf65472=_0xb0d6e1;if(this['_updateIng2'])return;this[_0xf65472(0x24f)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x4feff0=_0xb0d6e1;this['worker'][_0x4feff0(0x200)]({'type':_0x4feff0(0x197)});}},this['windField']['init'](this[_0xb0d6e1(0x181)]);}}mars3d__namespace['LayerUtil'][_0x36f0aa(0x213)](_0x36f0aa(0x227),CanvasWindLayer),mars3d__namespace[_0x36f0aa(0x1b5)][_0x36f0aa(0x259)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x36f0aa(0x1c9)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
