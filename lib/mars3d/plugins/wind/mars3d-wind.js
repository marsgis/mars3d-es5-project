/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.6
 * 编译日期：2023-09-18 16:30:30
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x25c8f6=_0x2ec8;(function(_0x64fc1d,_0x3771dc){const _0x260808=_0x2ec8,_0x2bc237=_0x64fc1d();while(!![]){try{const _0x39a3e7=parseInt(_0x260808(0x188))/0x1+parseInt(_0x260808(0x1c3))/0x2*(-parseInt(_0x260808(0x199))/0x3)+parseInt(_0x260808(0x123))/0x4*(parseInt(_0x260808(0x20d))/0x5)+parseInt(_0x260808(0x18c))/0x6*(-parseInt(_0x260808(0x205))/0x7)+parseInt(_0x260808(0x1ab))/0x8+-parseInt(_0x260808(0x1fd))/0x9+-parseInt(_0x260808(0x15f))/0xa*(parseInt(_0x260808(0x1bc))/0xb);if(_0x39a3e7===_0x3771dc)break;else _0x2bc237['push'](_0x2bc237['shift']());}catch(_0x4e7a07){_0x2bc237['push'](_0x2bc237['shift']());}}}(_0x2c77,0x7c56d));function _interopNamespace(_0x3141cb){const _0x177dc9=_0x2ec8;if(_0x3141cb&&_0x3141cb[_0x177dc9(0x1e4)])return _0x3141cb;var _0x161192=Object['create'](null);return _0x3141cb&&Object[_0x177dc9(0x17e)](_0x3141cb)['forEach'](function(_0x32bae4){if(_0x32bae4!=='default'){var _0x4891d8=Object['getOwnPropertyDescriptor'](_0x3141cb,_0x32bae4);Object['defineProperty'](_0x161192,_0x32bae4,_0x4891d8['get']?_0x4891d8:{'enumerable':!![],'get':function(){return _0x3141cb[_0x32bae4];}});}}),_0x161192['default']=_0x3141cb,_0x161192;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x385c15,_0x377207){const _0x294302=_0x385c15*Math['cos'](Cesium$7['Math']['toRadians'](_0x377207));return _0x294302;}function getV(_0x26bf26,_0x45bdd1){const _0x328eed=_0x26bf26*Math['sin'](Cesium$7['Math']['toRadians'](_0x45bdd1));return _0x328eed;}function getSpeed(_0x23ffc4,_0x21a486){const _0x4b05e0=_0x2ec8,_0x457acd=Math[_0x4b05e0(0x177)](Math[_0x4b05e0(0x1f2)](_0x23ffc4,0x2)+Math[_0x4b05e0(0x1f2)](_0x21a486,0x2));return _0x457acd;}function getDirection(_0x13850c,_0x5cd64c){let _0xc38409=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x5cd64c,_0x13850c));return _0xc38409+=_0xc38409<0x0?0x168:0x0,_0xc38409;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x211487){const _0x300043=_0x2ec8;this[_0x300043(0x192)]=_0x211487['commandType'],this['geometry']=_0x211487[_0x300043(0x134)],this['attributeLocations']=_0x211487['attributeLocations'],this[_0x300043(0x1f9)]=_0x211487['primitiveType'],this['uniformMap']=_0x211487[_0x300043(0x1c8)],this['vertexShaderSource']=_0x211487['vertexShaderSource'],this['fragmentShaderSource']=_0x211487['fragmentShaderSource'],this['rawRenderState']=_0x211487['rawRenderState'],this['framebuffer']=_0x211487['framebuffer'],this['outputTexture']=_0x211487['outputTexture'],this['autoClear']=_0x211487[_0x300043(0x185)]??![],this[_0x300043(0x198)]=_0x211487['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x300043(0x185)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x300043(0x16b)][_0x300043(0x1df)]}));}[_0x25c8f6(0x1fe)](_0x49c760){const _0xf3d5f6=_0x25c8f6;switch(this['commandType']){case'Draw':{const _0x5072c4=Cesium$6['VertexArray']['fromGeometry']({'context':_0x49c760,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x3322a3=Cesium$6[_0xf3d5f6(0x195)]['fromCache']({'context':_0x49c760,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0xf3d5f6(0x166)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x5262db=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0xf3d5f6(0x1f9)],'shaderProgram':_0x3322a3,'vertexArray':_0x5072c4,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x5262db,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0xf3d5f6(0x16b)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this[_0xf3d5f6(0x1c8)],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x32ca35,_0x50254b){const _0x1c0dd0=_0x25c8f6;this['geometry']=_0x50254b;const _0x3c6ed3=Cesium$6['VertexArray']['fromGeometry']({'context':_0x32ca35,'geometry':this['geometry'],'attributeLocations':this[_0x1c0dd0(0x182)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x1c0dd0(0x122)]['vertexArray']=_0x3c6ed3;}['update'](_0x4d7b0a){const _0x3dda5f=_0x25c8f6;if(!this[_0x3dda5f(0x1ef)])return;if(_0x4d7b0a[_0x3dda5f(0x1ad)]!==Cesium$6['SceneMode'][_0x3dda5f(0x19e)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x3dda5f(0x122)]=this['createCommand'](_0x4d7b0a['context'])),Cesium$6['defined'](this[_0x3dda5f(0x198)])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x4d7b0a['commandList'][_0x3dda5f(0x1de)](this[_0x3dda5f(0x1a1)]),_0x4d7b0a[_0x3dda5f(0x201)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x54e1e4=_0x25c8f6;if(this['clearCommand']){var _0x1e901f,_0x47f1b2;(_0x1e901f=this['clearCommand'])!==null&&_0x1e901f!==void 0x0&&_0x1e901f['vertexArray']&&this['clearCommand']['vertexArray'][_0x54e1e4(0x1e1)](),(_0x47f1b2=this['clearCommand'])!==null&&_0x47f1b2!==void 0x0&&_0x47f1b2['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x54e1e4(0x1e1)](),this['commandToExecute']['shaderProgram']&&this[_0x54e1e4(0x122)][_0x54e1e4(0x1f1)][_0x54e1e4(0x1e1)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x4bac05=function(){const _0x42f07e=_0x2ec8,_0x35e4da=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x42f07e(0x14b))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x35e4da;},_0x4552d7=function(_0x4e5bc0,_0x5f3b35){const _0x3c820b=_0x2ec8;if(Cesium$5[_0x3c820b(0x190)](_0x5f3b35)){const _0x3e4812={};_0x3e4812['arrayBufferView']=_0x5f3b35,_0x4e5bc0['source']=_0x3e4812;}const _0x26cfe4=new Cesium$5['Texture'](_0x4e5bc0);return _0x26cfe4;},_0x3c21a3=function(_0x2a056a,_0x507b88,_0x5145e8){const _0xa08914=new Cesium$5['Framebuffer']({'context':_0x2a056a,'colorTextures':[_0x507b88],'depthTexture':_0x5145e8});return _0xa08914;},_0x5cfd75=function(_0x96692e){const _0x22c8f5=_0x2ec8,_0x2b7882=!![],_0x460104=![],_0x883e2a={'viewport':_0x96692e['viewport'],'depthTest':_0x96692e['depthTest'],'depthMask':_0x96692e[_0x22c8f5(0x157)],'blending':_0x96692e['blending']},_0x4ee42c=Cesium$5[_0x22c8f5(0x147)][_0x22c8f5(0x167)](_0x2b7882,_0x460104,_0x883e2a);return _0x4ee42c;},_0x2f95bf=function(_0x52aeeb){const _0xdf6def=_0x2ec8,_0x5121cb={},_0xe9f61=Cesium$5[_0xdf6def(0x1a9)][_0xdf6def(0x11e)](_0x52aeeb['west'],Cesium$5['Math']['TWO_PI']),_0x475db7=Cesium$5['Math']['mod'](_0x52aeeb['east'],Cesium$5[_0xdf6def(0x1a9)]['TWO_PI']),_0xadeece=_0x52aeeb[_0xdf6def(0x1bf)];let _0x59616f,_0x552313;_0xadeece>Cesium$5[_0xdf6def(0x1a9)][_0xdf6def(0x1cc)]?(_0x59616f=0x0,_0x552313=Cesium$5[_0xdf6def(0x1a9)][_0xdf6def(0x1b2)]):_0x475db7-_0xe9f61<_0xadeece?(_0x59616f=_0xe9f61,_0x552313=_0xe9f61+_0xadeece):(_0x59616f=_0xe9f61,_0x552313=_0x475db7);_0x5121cb[_0xdf6def(0x16a)]={'min':Cesium$5[_0xdf6def(0x1a9)]['toDegrees'](_0x59616f),'max':Cesium$5['Math']['toDegrees'](_0x552313)};const _0x505190=_0x52aeeb['south'],_0x69ae96=_0x52aeeb[_0xdf6def(0x194)],_0x15ed75=_0x52aeeb['height'],_0xf9791b=_0x15ed75>Cesium$5['Math']['PI']/0xc?_0x15ed75/0x2:0x0;let _0x3a4387=Cesium$5['Math']['clampToLatitudeRange'](_0x505190-_0xf9791b),_0x51cb00=Cesium$5[_0xdf6def(0x1a9)]['clampToLatitudeRange'](_0x69ae96+_0xf9791b);return _0x3a4387<-Cesium$5['Math'][_0xdf6def(0x126)]&&(_0x3a4387=-Cesium$5['Math']['PI_OVER_TWO']),_0x51cb00>Cesium$5['Math'][_0xdf6def(0x126)]&&(_0x51cb00=Cesium$5['Math']['PI_OVER_TWO']),_0x5121cb[_0xdf6def(0x1f8)]={'min':Cesium$5[_0xdf6def(0x1a9)][_0xdf6def(0x1ae)](_0x3a4387),'max':Cesium$5[_0xdf6def(0x1a9)][_0xdf6def(0x1ae)](_0x51cb00)},_0x5121cb;};return{'getFullscreenQuad':_0x4bac05,'createTexture':_0x4552d7,'createFramebuffer':_0x3c21a3,'createRawRenderState':_0x5cfd75,'viewRectangleToLonLatRange':_0x2f95bf};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag=_0x25c8f6(0x1d2),fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x25c8f6(0x1f0);const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x3c42f3,_0xc92ef8,_0x2cfb00,_0x466033,_0x1c2bea){this['createRenderingTextures'](_0x3c42f3,_0xc92ef8,_0x2cfb00['colors']),this['createRenderingFramebuffers'](_0x3c42f3),this['createRenderingPrimitives'](_0x3c42f3,_0x2cfb00,_0x466033,_0x1c2bea);}[_0x25c8f6(0x193)](_0x1f7f15,_0xd9d05,_0x3dec17){const _0x57553a=_0x25c8f6,_0x2fe1ad={'context':_0x1f7f15,'width':_0x1f7f15['drawingBufferWidth'],'height':_0x1f7f15[_0x57553a(0x1f5)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x57553a(0x136)][_0x57553a(0x1f3)]},_0x75a15f={'context':_0x1f7f15,'width':_0x1f7f15['drawingBufferWidth'],'height':_0x1f7f15[_0x57553a(0x1f5)],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x57553a(0x136)]['UNSIGNED_INT']},_0x1c24ef=_0x3dec17['length'],_0x1edf06=new Float32Array(_0x1c24ef*0x3);for(let _0x1f7f81=0x0;_0x1f7f81<_0x1c24ef;_0x1f7f81++){const _0x5c48cc=Cesium$4['Color']['fromCssColorString'](_0x3dec17[_0x1f7f81]);_0x1edf06[0x3*_0x1f7f81]=_0x5c48cc['red'],_0x1edf06[0x3*_0x1f7f81+0x1]=_0x5c48cc['green'],_0x1edf06[0x3*_0x1f7f81+0x2]=_0x5c48cc['blue'];}const _0x8d3687={'context':_0x1f7f15,'width':_0x1c24ef,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x57553a(0x18d)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x2fe1ad),'segmentsDepth':Util['createTexture'](_0x75a15f),'currentTrailsColor':Util[_0x57553a(0x154)](_0x2fe1ad),'currentTrailsDepth':Util['createTexture'](_0x75a15f),'nextTrailsColor':Util[_0x57553a(0x154)](_0x2fe1ad),'nextTrailsDepth':Util[_0x57553a(0x154)](_0x75a15f),'colorTable':Util[_0x57553a(0x154)](_0x8d3687,_0x1edf06)};}['createRenderingFramebuffers'](_0x46e38b){const _0x45b6a6=_0x25c8f6;this['framebuffers']={'segments':Util[_0x45b6a6(0x20b)](_0x46e38b,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x46e38b,this['textures']['currentTrailsColor'],this['textures'][_0x45b6a6(0x1a8)]),'nextTrails':Util[_0x45b6a6(0x20b)](_0x46e38b,this['textures']['nextTrailsColor'],this['textures'][_0x45b6a6(0x124)])};}[_0x25c8f6(0x15c)](_0x392689){const _0x489372=_0x25c8f6,_0x22970c=0x4;let _0x34f413=[];for(let _0x4356a9=0x0;_0x4356a9<_0x392689[_0x489372(0x17c)];_0x4356a9++){for(let _0x5b2fbe=0x0;_0x5b2fbe<_0x392689[_0x489372(0x17c)];_0x5b2fbe++){for(let _0x6e595e=0x0;_0x6e595e<_0x22970c;_0x6e595e++){_0x34f413['push'](_0x4356a9/_0x392689[_0x489372(0x17c)]),_0x34f413['push'](_0x5b2fbe/_0x392689['particlesTextureSize']);}}}_0x34f413=new Float32Array(_0x34f413);let _0x140bee=[];const _0x232882=[-0x1,0x1],_0x226f7f=[-0x1,0x1];for(let _0x3180fe=0x0;_0x3180fe<_0x392689['maxParticles'];_0x3180fe++){for(let _0x2f57fd=0x0;_0x2f57fd<_0x22970c/0x2;_0x2f57fd++){for(let _0x39ec10=0x0;_0x39ec10<_0x22970c/0x2;_0x39ec10++){_0x140bee[_0x489372(0x1de)](_0x232882[_0x2f57fd]),_0x140bee[_0x489372(0x1de)](_0x226f7f[_0x39ec10]),_0x140bee['push'](0x0);}}}_0x140bee=new Float32Array(_0x140bee);const _0x362d00=0x6*_0x392689[_0x489372(0x18b)],_0x3512b6=new Uint32Array(_0x362d00);for(let _0x296453=0x0,_0x40b3cc=0x0,_0x51a5e5=0x0;_0x296453<_0x392689['maxParticles'];_0x296453++){_0x3512b6[_0x40b3cc++]=_0x51a5e5+0x0,_0x3512b6[_0x40b3cc++]=_0x51a5e5+0x1,_0x3512b6[_0x40b3cc++]=_0x51a5e5+0x2,_0x3512b6[_0x40b3cc++]=_0x51a5e5+0x2,_0x3512b6[_0x40b3cc++]=_0x51a5e5+0x1,_0x3512b6[_0x40b3cc++]=_0x51a5e5+0x3,_0x51a5e5+=0x4;}const _0x16b32a=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x34f413}),'normal':new Cesium$4[(_0x489372(0x19f))]({'componentDatatype':Cesium$4['ComponentDatatype'][_0x489372(0x1b6)],'componentsPerAttribute':0x3,'values':_0x140bee})}),'indices':_0x3512b6});return _0x16b32a;}[_0x25c8f6(0x1d5)](_0x5f57fc,_0x1d6b7a,_0x2ebdbe,_0x903f69){const _0x2f7b6b=_0x25c8f6,_0x59ca68=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x1d6b7a),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x903f69['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x54d79a=_0x2ec8;return _0x903f69[_0x54d79a(0x1f4)]['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x903f69['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x352a50=_0x2ec8;return _0x59ca68[_0x352a50(0x131)][_0x352a50(0x17f)];},'aspect':function(){const _0x365de6=_0x2ec8;return _0x5f57fc['drawingBufferWidth']/_0x5f57fc[_0x365de6(0x1f5)];},'pixelSize':function(){return _0x2ebdbe['pixelSize'];},'lineWidth':function(){return _0x1d6b7a['lineWidth'];},'particleHeight':function(){const _0x4a8a54=_0x2ec8;return _0x1d6b7a[_0x4a8a54(0x1d9)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x2f7b6b(0x19a),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x2f7b6b(0x171)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x59ca68['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x59ca68['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x97edaa=_0x2f7b6b;return _0x59ca68[_0x97edaa(0x1b1)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x1aade0=_0x2f7b6b;return _0x59ca68['framebuffers']['currentTrails'][_0x1aade0(0x16f)];},'fadeOpacity':function(){return _0x1d6b7a['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x2f7b6b(0x20c)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x2f7b6b(0x1ed)],'autoClear':!![],'preExecute':function(){const _0x3735a3=_0x2f7b6b,_0x5d43a6=_0x59ca68['framebuffers'][_0x3735a3(0x1fb)];_0x59ca68['framebuffers']['currentTrails']=_0x59ca68[_0x3735a3(0x1b1)][_0x3735a3(0x1ed)],_0x59ca68['framebuffers']['nextTrails']=_0x5d43a6,_0x59ca68[_0x3735a3(0x135)]['trails']['commandToExecute']['framebuffer']=_0x59ca68['framebuffers']['nextTrails'],_0x59ca68[_0x3735a3(0x135)][_0x3735a3(0x12e)]['clearCommand']['framebuffer']=_0x59ca68['framebuffers'][_0x3735a3(0x1ed)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x2f7b6b(0x1e6)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x48bd45=_0x2f7b6b;return _0x59ca68[_0x48bd45(0x1b1)]['nextTrails'][_0x48bd45(0x1a3)](0x0);},'trailsDepthTexture':function(){const _0x113ef6=_0x2f7b6b;return _0x59ca68['framebuffers']['nextTrails'][_0x113ef6(0x16f)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}function _0x2c77(){const _0x5c06cc=['windData','tlat','autoClear','pixelSize','setData','568353TXzDnW','TextureMinificationFilter','Cesium','maxParticles','634482ffTPfV','TextureMagnificationFilter','_map','clear','defined','fromDegrees','commandType','createRenderingTextures','north','ShaderProgram','#ffffff','hidden','preExecute','25911VfwDrX','Draw','_bilinearInterpolation','scene','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','SCENE3D','GeometryAttribute','Cartesian3','clearCommand','redraw','getColorTexture','speedRate','canvasWind','addPrimitives','_drawLines','currentTrailsDepth','Math','options','4494352xcrIwy','clientWidth','mode','toDegrees','random','particles','framebuffers','TWO_PI','age','rows','beginPath','FLOAT','clearFramebuffers','_onMouseUpEvent','getOptions','postProcessingSpeed','layer','82643AtFcEh','style','outputTexture','width','Cartesian2','resize','drawingBufferWidth','48qOKGWo','PixelFormat','array','destroyParticlesTextures','mouseDown','uniformMap','toGridXY','ceil','log','THREE_PI_OVER_TWO','none','ColorRamp','create','canvas','canvasHeight','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','Compute','refreshParticles','createRenderingPrimitives','pointerEvents','WindLayer','color','particleHeight','windField','getUVByPoint','bindEvent','onmessage','push','OPAQUE','ymin','destroy','canvasContext','postMessage','__esModule','_updateIng','getFullscreenQuad','_onMapWhellEvent','tlng','lng','defineProperty','nextParticlesPosition','mouse_down','nextTrails','abs','show','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','shaderProgram','pow','UNSIGNED_BYTE','particlesTextures','drawingBufferHeight','preRender','vmin','lat','primitiveType','applyViewerParameters','currentTrails','screen','1579905OYqCtw','createCommand','removeEventListener','worker','commandList','register','mouseMove','min','21PtPPgL','fillRect','isPointVisible','postProcessingPosition','ShaderSource','lineTo','createFramebuffer','DISABLE_GL_POSITION_LOG_DEPTH','5IBJMmw','update','_addedHook','particleSystem','camera','mod','xmin','STATIC_DRAW','clientHeight','commandToExecute','527244lAAWsG','nextTrailsDepth','destination-in','PI_OVER_THREE','lineWidth','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','lev','max','maxAge','frameTime','createParticlesTextures','trails','_randomParticle','left','textures','context','colors','geometry','primitives','PixelDatatype','particlesNumber','speedFactor','randomizeParticles','ZERO','fixedHeight','nextParticlesSpeed','_onMouseDownEvent','levmin','refreshTimer','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','latRange','createWindTextures','wheel','data','_updateIng2','absolute','Appearance','remove','getPixelSize','Sampler','GeometryAttributes','getWind','initWorker','add','_setOptionsHook','segments','forEach','_calc_speedRate','dimensions','createTexture','mouse_move','particlesComputing','depthMask','currentParticlesSpeed','viewerParameters','moveTo','dropRateBump','createSegmentsGeometry','removeAll','particlesRendering','70tNDQBb','ymax','_onMouseMoveEvent','addEventListener','_maxAge','setOptions','speed','vertexShaderSource','getDefaultRenderState','canvasWidth','currentParticlesPosition','lon','Pass','getParticles','EventType','vdata','depthTexture','cols','PrimitiveType','PrimitiveCollection','pointer-events','off','length','CanvasWindLayer','sqrt','reverseY','udata','xmax','floor','particlesTextureSize','_colorRamp','keys','colorTable','mouseUp','_data','attributeLocations'];_0x2c77=function(){return _0x5c06cc;};return _0x2c77();}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x25c8f6(0x140),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x25c8f6(0x19d),postProcessingSpeed_frag=_0x25c8f6(0x128);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x3b6f57,_0x33fb2f,_0x9ca752,_0x45f0d6){const _0x2762b4=_0x25c8f6;this['data']=_0x33fb2f,this['createWindTextures'](_0x3b6f57,_0x33fb2f),this[_0x2762b4(0x12d)](_0x3b6f57,_0x9ca752,_0x45f0d6),this['createComputingPrimitives'](_0x33fb2f,_0x9ca752,_0x45f0d6);}[_0x25c8f6(0x142)](_0x30c0fc,_0x3c89df){const _0x3ed83f=_0x25c8f6,_0xd52210={'context':_0x30c0fc,'width':_0x3c89df[_0x3ed83f(0x153)]['lon'],'height':_0x3c89df['dimensions']['lat']*(_0x3c89df['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x3ed83f(0x1b6)],'flipY':![],'sampler':new Cesium$3[(_0x3ed83f(0x14a))]({'minificationFilter':Cesium$3[_0x3ed83f(0x189)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0xd52210,_0x3c89df['U']['array']),'V':Util[_0x3ed83f(0x154)](_0xd52210,_0x3c89df['V']['array'])};}['createParticlesTextures'](_0x647674,_0x4ecc78,_0x4ae149){const _0x5e00fc=_0x25c8f6,_0x31b6de={'context':_0x647674,'width':_0x4ecc78['particlesTextureSize'],'height':_0x4ecc78['particlesTextureSize'],'pixelFormat':Cesium$3[_0x5e00fc(0x1c4)]['RGBA'],'pixelDatatype':Cesium$3[_0x5e00fc(0x136)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x306d54=this['randomizeParticles'](_0x4ecc78[_0x5e00fc(0x18b)],_0x4ae149),_0x357db8=new Float32Array(0x4*_0x4ecc78['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x31b6de),'currentParticlesPosition':Util['createTexture'](_0x31b6de,_0x306d54),'nextParticlesPosition':Util['createTexture'](_0x31b6de,_0x306d54),'currentParticlesSpeed':Util['createTexture'](_0x31b6de,_0x357db8),'nextParticlesSpeed':Util[_0x5e00fc(0x154)](_0x31b6de,_0x357db8),'postProcessingPosition':Util['createTexture'](_0x31b6de,_0x306d54),'postProcessingSpeed':Util['createTexture'](_0x31b6de,_0x357db8)};}[_0x25c8f6(0x139)](_0x512d6e,_0x107ff7){const _0x5f15d2=_0x25c8f6,_0x39d17c=new Float32Array(0x4*_0x512d6e);for(let _0x295071=0x0;_0x295071<_0x512d6e;_0x295071++){_0x39d17c[0x4*_0x295071]=Cesium$3['Math']['randomBetween'](_0x107ff7['lonRange']['x'],_0x107ff7['lonRange']['y']),_0x39d17c[0x4*_0x295071+0x1]=Cesium$3['Math']['randomBetween'](_0x107ff7['latRange']['x'],_0x107ff7['latRange']['y']),_0x39d17c[0x4*_0x295071+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x5f15d2(0x129)]['min'],this['data']['lev']['max']),_0x39d17c[0x4*_0x295071+0x3]=0x0;}return _0x39d17c;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x2cc5f6=>{const _0x2ac83a=_0x2ec8;this[_0x2ac83a(0x1f4)][_0x2cc5f6]['destroy']();});}['createComputingPrimitives'](_0x3deb3f,_0x3b9672,_0x597ce1){const _0x44ff85=_0x25c8f6,_0x2325be=new Cesium$3['Cartesian3'](_0x3deb3f[_0x44ff85(0x153)]['lon'],_0x3deb3f[_0x44ff85(0x153)]['lat'],_0x3deb3f['dimensions']['lev']),_0x7c231e=new Cesium$3['Cartesian3'](_0x3deb3f['lon']['min'],_0x3deb3f['lat']['min'],_0x3deb3f[_0x44ff85(0x129)][_0x44ff85(0x204)]),_0x545a97=new Cesium$3[(_0x44ff85(0x1a0))](_0x3deb3f['lon'][_0x44ff85(0x12a)],_0x3deb3f['lat']['max'],_0x3deb3f['lev'][_0x44ff85(0x12a)]),_0x1bc9ac=new Cesium$3[(_0x44ff85(0x1a0))]((_0x545a97['x']-_0x7c231e['x'])/(_0x2325be['x']-0x1),(_0x545a97['y']-_0x7c231e['y'])/(_0x2325be['y']-0x1),_0x2325be['z']>0x1?(_0x545a97['z']-_0x7c231e['z'])/(_0x2325be['z']-0x1):0x1),_0x5903bc=new Cesium$3['Cartesian2'](_0x3deb3f['U']['min'],_0x3deb3f['U']['max']),_0x2ff574=new Cesium$3['Cartesian2'](_0x3deb3f['V']['min'],_0x3deb3f['V']['max']),_0x53ad3e=this;this[_0x44ff85(0x135)]={'getWind':new CustomPrimitive({'commandType':_0x44ff85(0x1d3),'uniformMap':{'U':function(){return _0x53ad3e['windTextures']['U'];},'V':function(){return _0x53ad3e['windTextures']['V'];},'currentParticlesPosition':function(){return _0x53ad3e['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x2325be;},'minimum':function(){return _0x7c231e;},'maximum':function(){return _0x545a97;},'interval':function(){return _0x1bc9ac;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x44ff85(0x1f4)]['particlesWind'],'preExecute':function(){const _0x1000c1=_0x44ff85;_0x53ad3e['primitives'][_0x1000c1(0x14c)]['commandToExecute']['outputTexture']=_0x53ad3e['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x53ad3e['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x53ad3e['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x5903bc;},'vSpeedRange':function(){return _0x2ff574;},'pixelSize':function(){const _0x505736=_0x44ff85;return _0x597ce1[_0x505736(0x186)];},'speedFactor':function(){const _0xa8128=_0x44ff85;return _0x3b9672[_0xa8128(0x138)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x4646e7=_0x44ff85,_0x1ea643=_0x53ad3e['particlesTextures'][_0x4646e7(0x158)];_0x53ad3e['particlesTextures']['currentParticlesSpeed']=_0x53ad3e[_0x4646e7(0x1f4)]['postProcessingSpeed'],_0x53ad3e['particlesTextures'][_0x4646e7(0x1ba)]=_0x1ea643,_0x53ad3e['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x53ad3e[_0x4646e7(0x1f4)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x37bbc8=_0x44ff85;return _0x53ad3e[_0x37bbc8(0x1f4)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x53ad3e['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x44ff85(0x1eb)],'preExecute':function(){const _0x6cc831=_0x44ff85,_0xeecb7b=_0x53ad3e['particlesTextures'][_0x6cc831(0x169)];_0x53ad3e['particlesTextures']['currentParticlesPosition']=_0x53ad3e[_0x6cc831(0x1f4)]['postProcessingPosition'],_0x53ad3e['particlesTextures']['postProcessingPosition']=_0xeecb7b,_0x53ad3e['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x53ad3e['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x53ad3e['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x53ad3e['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x597ce1['lonRange'];},'latRange':function(){return _0x597ce1['latRange'];},'randomCoefficient':function(){const _0x720b61=_0x44ff85,_0x19fead=Math[_0x720b61(0x1af)]();return _0x19fead;},'dropRate':function(){return _0x3b9672['dropRate'];},'dropRateBump':function(){const _0x171392=_0x44ff85;return _0x3b9672[_0x171392(0x15b)];}},'fragmentShaderSource':new Cesium$3[(_0x44ff85(0x209))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x44ff85(0x1f4)]['postProcessingPosition'],'preExecute':function(){const _0x403bde=_0x44ff85;_0x53ad3e['primitives']['postProcessingPosition'][_0x403bde(0x122)]['outputTexture']=_0x53ad3e['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x2a19a9=_0x44ff85;return _0x53ad3e['particlesTextures'][_0x2a19a9(0x208)];},'nextParticlesSpeed':function(){const _0x3c5732=_0x44ff85;return _0x53ad3e['particlesTextures'][_0x3c5732(0x13c)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x2d3834=_0x44ff85;_0x53ad3e[_0x2d3834(0x135)]['postProcessingSpeed'][_0x2d3834(0x122)][_0x2d3834(0x1be)]=_0x53ad3e['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x25c8f6(0x18a)];class ParticleSystem{constructor(_0x408318,_0x371b56,_0x47a059,_0x286020){const _0x4abbf3=_0x25c8f6;this[_0x4abbf3(0x132)]=_0x408318,_0x371b56={..._0x371b56},_0x371b56['udata']&&_0x371b56['vdata']&&(_0x371b56['dimensions']={},_0x371b56['dimensions']['lon']=_0x371b56['cols'],_0x371b56[_0x4abbf3(0x153)]['lat']=_0x371b56['rows'],_0x371b56['dimensions']['lev']=_0x371b56[_0x4abbf3(0x129)]||0x1,_0x371b56['lon']={},_0x371b56['lon'][_0x4abbf3(0x204)]=_0x371b56[_0x4abbf3(0x11f)],_0x371b56['lon'][_0x4abbf3(0x12a)]=_0x371b56['xmax'],_0x371b56['lat']={},_0x371b56['lat']['min']=_0x371b56[_0x4abbf3(0x1e0)],_0x371b56[_0x4abbf3(0x1f8)]['max']=_0x371b56['ymax'],_0x371b56['lev']={},_0x371b56['lev'][_0x4abbf3(0x204)]=_0x371b56[_0x4abbf3(0x13e)]??0x1,_0x371b56[_0x4abbf3(0x129)]['max']=_0x371b56['levmax']??0x1,_0x371b56['U']={},_0x371b56['U'][_0x4abbf3(0x1c5)]=new Float32Array(_0x371b56['udata']),_0x371b56['U']['min']=_0x371b56['umin']??Math['min'](..._0x371b56[_0x4abbf3(0x179)]),_0x371b56['U']['max']=_0x371b56['umax']??Math[_0x4abbf3(0x12a)](..._0x371b56['udata']),_0x371b56['V']={},_0x371b56['V'][_0x4abbf3(0x1c5)]=new Float32Array(_0x371b56['vdata']),_0x371b56['V'][_0x4abbf3(0x204)]=_0x371b56[_0x4abbf3(0x1f7)]??Math['min'](..._0x371b56[_0x4abbf3(0x16e)]),_0x371b56['V'][_0x4abbf3(0x12a)]=_0x371b56['vmax']??Math[_0x4abbf3(0x12a)](..._0x371b56['vdata'])),this[_0x4abbf3(0x144)]=_0x371b56,this['options']=_0x47a059,this['viewerParameters']=_0x286020,this['particlesComputing']=new ParticlesComputing(this[_0x4abbf3(0x132)],this[_0x4abbf3(0x144)],this['options'],this[_0x4abbf3(0x159)]),this['particlesRendering']=new ParticlesRendering(this[_0x4abbf3(0x132)],this['data'],this[_0x4abbf3(0x1aa)],this[_0x4abbf3(0x159)],this[_0x4abbf3(0x156)]);}['canvasResize'](_0x28b751){const _0xc7275d=_0x25c8f6;this[_0xc7275d(0x156)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x14deb5=>{this['particlesComputing']['windTextures'][_0x14deb5]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this[_0xc7275d(0x15e)]['framebuffers'])['forEach'](_0x43c9e6=>{const _0x516908=_0xc7275d;this[_0x516908(0x15e)]['framebuffers'][_0x43c9e6][_0x516908(0x1e1)]();}),this[_0xc7275d(0x132)]=_0x28b751,this['particlesComputing']=new ParticlesComputing(this[_0xc7275d(0x132)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0xc7275d(0x156)]);}['clearFramebuffers'](){const _0x2a1c5d=_0x25c8f6,_0x104d4e=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x2a1c5d(0x16b)]['OPAQUE']});Object[_0x2a1c5d(0x17e)](this['particlesRendering']['framebuffers'])[_0x2a1c5d(0x151)](_0x2785b7=>{const _0xde2a95=_0x2a1c5d;_0x104d4e['framebuffer']=this[_0xde2a95(0x15e)]['framebuffers'][_0x2785b7],_0x104d4e['execute'](this['context']);});}['refreshParticles'](_0x5709fb){const _0x289a8c=_0x25c8f6;this[_0x289a8c(0x1b7)](),this[_0x289a8c(0x156)][_0x289a8c(0x1c6)](),this[_0x289a8c(0x156)]['createParticlesTextures'](this[_0x289a8c(0x132)],this['options'],this[_0x289a8c(0x159)]);if(_0x5709fb){var _0x300857,_0x276aa2;const _0x5a1aa1=this['particlesRendering']['createSegmentsGeometry'](this['options']);this[_0x289a8c(0x15e)]['primitives']['segments']['geometry']=_0x5a1aa1;const _0x599c1e=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x289a8c(0x132)],'geometry':_0x5a1aa1,'attributeLocations':this['particlesRendering'][_0x289a8c(0x135)]['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x289a8c(0x120)]});(_0x300857=this[_0x289a8c(0x15e)]['primitives'])!==null&&_0x300857!==void 0x0&&(_0x276aa2=_0x300857[_0x289a8c(0x150)])!==null&&_0x276aa2!==void 0x0&&_0x276aa2[_0x289a8c(0x122)]&&(this['particlesRendering'][_0x289a8c(0x135)]['segments']['commandToExecute']['vertexArray']=_0x599c1e);}}['setOptions'](_0x54c24f){const _0x2b17be=_0x25c8f6;let _0x1bac15=![];this['options']['maxParticles']!==_0x54c24f['maxParticles']&&(_0x1bac15=!![]),Object['keys'](_0x54c24f)['forEach'](_0x250cbe=>{const _0x1d2d90=_0x2ec8;this[_0x1d2d90(0x1aa)][_0x250cbe]=_0x54c24f[_0x250cbe];}),this[_0x2b17be(0x1d4)](_0x1bac15);}['applyViewerParameters'](_0x4816f7){const _0xf21db0=_0x25c8f6;Object[_0xf21db0(0x17e)](_0x4816f7)[_0xf21db0(0x151)](_0xaf97f4=>{this['viewerParameters'][_0xaf97f4]=_0x4816f7[_0xaf97f4];}),this['refreshParticles'](![]);}[_0x25c8f6(0x1e1)](){const _0x51521b=_0x25c8f6;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x374b04=>{this['particlesComputing']['windTextures'][_0x374b04]['destroy']();}),this['particlesRendering']['textures'][_0x51521b(0x17f)]['destroy'](),Object[_0x51521b(0x17e)](this['particlesRendering']['framebuffers'])[_0x51521b(0x151)](_0x235a9f=>{const _0x4463dd=_0x51521b;this[_0x4463dd(0x15e)][_0x4463dd(0x1b1)][_0x235a9f]['destroy']();});for(const _0x2b17d5 in this){delete this[_0x2b17d5];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x204742={}){const _0x342e1e=_0x25c8f6;_0x204742={...DEF_OPTIONS,..._0x204742},super(_0x204742),this[_0x342e1e(0x14f)](_0x204742);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set[_0x25c8f6(0x144)](_0x1194ef){this['setData'](_0x1194ef);}get['colors'](){const _0x14ab9d=_0x25c8f6;return this[_0x14ab9d(0x1aa)][_0x14ab9d(0x133)];}set[_0x25c8f6(0x133)](_0x4addce){const _0x29e710=_0x25c8f6;this['options']['colors']=_0x4addce,this['particleSystem']&&this['particleSystem'][_0x29e710(0x164)]({'colors':_0x4addce}),this['resize']();}['_mountedHook'](){}[_0x25c8f6(0x20f)](){const _0x58fc71=_0x25c8f6;this[_0x58fc71(0x19c)]=this['_map']['scene'],this['camera']=this['_map'][_0x58fc71(0x11d)],this['primitives']=new Cesium$1[(_0x58fc71(0x172))](),this['_map']['scene']['primitives']['add'](this['primitives']),this[_0x58fc71(0x159)]={'lonRange':new Cesium$1[(_0x58fc71(0x1c0))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x58fc71(0x13a)],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x58fc71(0x18e)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x58fc71(0x18e)]['on'](mars3d__namespace['EventType'][_0x58fc71(0x180)],this[_0x58fc71(0x1b8)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x58fc71(0x203)],this['_onMouseMoveEvent'],this),this[_0x58fc71(0x181)]&&this['setData'](this['_data']);}['_removedHook'](){const _0x323d3e=_0x25c8f6;window[_0x323d3e(0x1ff)]('resize',this[_0x323d3e(0x1c1)]),this['_map'][_0x323d3e(0x174)](mars3d__namespace['EventType'][_0x323d3e(0x1f6)],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x323d3e(0x143)],this[_0x323d3e(0x1e7)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x323d3e(0x13d)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives'][_0x323d3e(0x15d)](),this['_map'][_0x323d3e(0x19c)][_0x323d3e(0x135)][_0x323d3e(0x148)](this['primitives']);}['resize'](){const _0x24bcc1=_0x25c8f6;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives'][_0x24bcc1(0x15d)](),this['_map']['once'](mars3d__namespace['EventType'][_0x24bcc1(0x1f6)],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x231949){this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x18f1ba){const _0x4de393=_0x25c8f6;clearTimeout(this['refreshTimer']);if(!this[_0x4de393(0x1ef)]||!this[_0x4de393(0x11c)])return;this['primitives']['show']=![],this[_0x4de393(0x13f)]=setTimeout(()=>{const _0x446a42=_0x4de393;if(!this[_0x446a42(0x1ef)])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x953e43){const _0x3c6190=_0x25c8f6;this[_0x3c6190(0x1ec)]=!![];}['_onMouseMoveEvent'](_0x45c794){const _0x121e3c=_0x25c8f6;if(!this['show']||!this[_0x121e3c(0x11c)])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x121e3c(0x155)]=!![]);}['_onMouseUpEvent'](_0x46c258){const _0x46d02e=_0x25c8f6;if(!this[_0x46d02e(0x1ef)]||!this[_0x46d02e(0x11c)])return;this['mouse_down']&&this[_0x46d02e(0x155)]&&this['redraw'](),this[_0x46d02e(0x135)]['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x4cd92d=_0x25c8f6;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem'][_0x4cd92d(0x1fa)](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x1631a5){const _0x17e2f7=_0x25c8f6;this[_0x17e2f7(0x181)]=_0x1631a5,this[_0x17e2f7(0x11c)]&&this['particleSystem']['destroy'](),this[_0x17e2f7(0x11c)]=new ParticleSystem(this['scene']['context'],_0x1631a5,this[_0x17e2f7(0x1b9)](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x4d0347,_0x125267){const _0x116780=_0x25c8f6;if(_0x4d0347)for(const _0x5b40e3 in _0x4d0347){this[_0x5b40e3]=_0x4d0347[_0x5b40e3];}this['particleSystem']&&this[_0x116780(0x11c)][_0x116780(0x164)](this[_0x116780(0x1b9)]());}['getOptions'](){const _0x17a16a=_0x25c8f6,_0x50f7b8=Math[_0x17a16a(0x1ca)](Math['sqrt'](this['particlesNumber']));return this[_0x17a16a(0x137)]=_0x50f7b8*_0x50f7b8,{'particlesTextureSize':_0x50f7b8,'maxParticles':this[_0x17a16a(0x137)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this[_0x17a16a(0x15b)],'speedFactor':this[_0x17a16a(0x138)],'lineWidth':this['lineWidth'],'colors':this['colors']};}[_0x25c8f6(0x1a6)](){const _0x2d1cb0=_0x25c8f6;this[_0x2d1cb0(0x135)]['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives']['add'](this[_0x2d1cb0(0x11c)][_0x2d1cb0(0x156)]['primitives']['updateSpeed']),this['primitives'][_0x2d1cb0(0x14e)](this['particleSystem']['particlesComputing'][_0x2d1cb0(0x135)]['updatePosition']),this['primitives']['add'](this['particleSystem'][_0x2d1cb0(0x156)][_0x2d1cb0(0x135)]['postProcessingPosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this[_0x2d1cb0(0x135)]['add'](this[_0x2d1cb0(0x11c)]['particlesRendering']['primitives'][_0x2d1cb0(0x150)]),this['primitives'][_0x2d1cb0(0x14e)](this[_0x2d1cb0(0x11c)]['particlesRendering']['primitives'][_0x2d1cb0(0x12e)]),this[_0x2d1cb0(0x135)][_0x2d1cb0(0x14e)](this['particleSystem']['particlesRendering']['primitives'][_0x2d1cb0(0x1fc)]);}['updateViewerParameters'](){const _0x35792c=_0x25c8f6;let _0x41af21=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x41af21){const _0x19fcfe=this['_map']['getExtent']();_0x41af21=Cesium$1['Rectangle'][_0x35792c(0x191)](_0x19fcfe['xmin'],_0x19fcfe['ymin'],_0x19fcfe['xmax'],_0x19fcfe['ymax']);}const _0x2bcf60=Util['viewRectangleToLonLatRange'](_0x41af21);this['viewerParameters']['lonRange']['x']=_0x2bcf60['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x2bcf60['lon'][_0x35792c(0x12a)],this[_0x35792c(0x159)]['latRange']['x']=_0x2bcf60['lat']['min'],this['viewerParameters'][_0x35792c(0x141)]['y']=_0x2bcf60['lat']['max'];const _0x3b25c5=this['camera'][_0x35792c(0x149)](this['globeBoundingSphere'],this['scene'][_0x35792c(0x1c2)],this[_0x35792c(0x19c)]['drawingBufferHeight']);_0x3b25c5>0x0&&(this['viewerParameters']['pixelSize']=_0x3b25c5);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace[_0x25c8f6(0x1bb)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x4538ae=_0x25c8f6;this[_0x4538ae(0x1e9)]=null,this['lat']=null,this[_0x4538ae(0x1e8)]=null,this[_0x4538ae(0x184)]=null,this['age']=null,this['speed']=null;}[_0x25c8f6(0x1e1)](){for(const _0x446ff8 in this){delete this[_0x446ff8];}}}class CanvasWindField{constructor(_0x110388){this['setOptions'](_0x110388);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x3744df){const _0x4e3fe1=_0x25c8f6;this['_speedRate']=(0x64-(_0x3744df>0x63?0x63:_0x3744df))*0x64,this[_0x4e3fe1(0x152)]=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x4e3fe1(0x1e0)])/this['_speedRate']];}get[_0x25c8f6(0x12b)](){const _0x2d516a=_0x25c8f6;return this[_0x2d516a(0x163)];}set['maxAge'](_0xb87c79){const _0x548c64=_0x25c8f6;this[_0x548c64(0x163)]=_0xb87c79;}['setOptions'](_0x213c79){const _0x2180fe=_0x25c8f6;this['options']=_0x213c79,this['maxAge']=_0x213c79['maxAge']||0x78,this[_0x2180fe(0x1a4)]=_0x213c79[_0x2180fe(0x1a4)]||0x32,this['particles']=[];const _0x43b6e2=_0x213c79[_0x2180fe(0x137)]||0x1000;for(let _0x207eb0=0x0;_0x207eb0<_0x43b6e2;_0x207eb0++){const _0x2d9bce=this[_0x2180fe(0x12f)](new CanvasParticle());this['particles'][_0x2180fe(0x1de)](_0x2d9bce);}}['setDate'](_0x39cdfa){const _0x44d8ea=_0x25c8f6;this[_0x44d8ea(0x1b4)]=_0x39cdfa[_0x44d8ea(0x1b4)],this['cols']=_0x39cdfa[_0x44d8ea(0x170)],this[_0x44d8ea(0x11f)]=_0x39cdfa[_0x44d8ea(0x11f)],this['xmax']=_0x39cdfa[_0x44d8ea(0x17a)],this['ymin']=_0x39cdfa['ymin'],this['ymax']=_0x39cdfa['ymax'],this['grid']=[];const _0x508d9c=_0x39cdfa['udata'],_0x35bcf7=_0x39cdfa['vdata'];let _0x1f71b0=![];_0x508d9c[_0x44d8ea(0x175)]===this['rows']&&_0x508d9c[0x0]['length']===this['cols']&&(_0x1f71b0=!![]);let _0x2a3468=0x0,_0x38ba9a=null,_0x46c299=null;for(let _0x1def74=0x0;_0x1def74<this['rows'];_0x1def74++){_0x38ba9a=[];for(let _0x3b294e=0x0;_0x3b294e<this[_0x44d8ea(0x170)];_0x3b294e++,_0x2a3468++){_0x1f71b0?_0x46c299=this['_calcUV'](_0x508d9c[_0x1def74][_0x3b294e],_0x35bcf7[_0x1def74][_0x3b294e]):_0x46c299=this['_calcUV'](_0x508d9c[_0x2a3468],_0x35bcf7[_0x2a3468]),_0x38ba9a[_0x44d8ea(0x1de)](_0x46c299);}this['grid']['push'](_0x38ba9a);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x2f498d=_0x25c8f6;delete this[_0x2f498d(0x1b4)],delete this['cols'],delete this['xmin'],delete this[_0x2f498d(0x17a)],delete this[_0x2f498d(0x1e0)],delete this[_0x2f498d(0x160)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x141633,_0x37a08b){const _0x19f417=_0x25c8f6,_0x4e62d8=(_0x141633-this['xmin'])/(this['xmax']-this[_0x19f417(0x11f)])*(this['cols']-0x1),_0x499b45=(this['ymax']-_0x37a08b)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x4e62d8,_0x499b45];}['getUVByXY'](_0x3da6d1,_0x18d65f){const _0x7d133a=_0x25c8f6;if(_0x3da6d1<0x0||_0x3da6d1>=this['cols']||_0x18d65f>=this['rows'])return[0x0,0x0,0x0];const _0x15c636=Math[_0x7d133a(0x17b)](_0x3da6d1),_0x181fa6=Math['floor'](_0x18d65f);if(_0x15c636===_0x3da6d1&&_0x181fa6===_0x18d65f)return this['grid'][_0x18d65f][_0x3da6d1];const _0x1ece9b=_0x15c636+0x1,_0x4bd2fc=_0x181fa6+0x1,_0x327672=this['getUVByXY'](_0x15c636,_0x181fa6),_0x3fad75=this['getUVByXY'](_0x1ece9b,_0x181fa6),_0x449ea2=this['getUVByXY'](_0x15c636,_0x4bd2fc),_0x40daa5=this['getUVByXY'](_0x1ece9b,_0x4bd2fc);let _0x5b0d5b=null;try{_0x5b0d5b=this[_0x7d133a(0x19b)](_0x3da6d1-_0x15c636,_0x18d65f-_0x181fa6,_0x327672,_0x3fad75,_0x449ea2,_0x40daa5);}catch(_0x39bb3f){console[_0x7d133a(0x1cb)](_0x3da6d1,_0x18d65f);}return _0x5b0d5b;}['_bilinearInterpolation'](_0x4918e4,_0x373005,_0x25a84c,_0x4e6921,_0x2af437,_0x2a5562){const _0x5604b0=0x1-_0x4918e4,_0x4bd767=0x1-_0x373005,_0x166417=_0x5604b0*_0x4bd767,_0x35652d=_0x4918e4*_0x4bd767,_0x235418=_0x5604b0*_0x373005,_0x66253d=_0x4918e4*_0x373005,_0x47e229=_0x25a84c[0x0]*_0x166417+_0x4e6921[0x0]*_0x35652d+_0x2af437[0x0]*_0x235418+_0x2a5562[0x0]*_0x66253d,_0x25d39b=_0x25a84c[0x1]*_0x166417+_0x4e6921[0x1]*_0x35652d+_0x2af437[0x1]*_0x235418+_0x2a5562[0x1]*_0x66253d;return this['_calcUV'](_0x47e229,_0x25d39b);}['_calcUV'](_0x554002,_0x58b0b4){const _0x591fc8=_0x25c8f6;return[+_0x554002,+_0x58b0b4,Math[_0x591fc8(0x177)](_0x554002*_0x554002+_0x58b0b4*_0x58b0b4)];}['getUVByPoint'](_0x1e16ef,_0x49ec3f){const _0x3dab21=_0x25c8f6;if(!this['isInExtent'](_0x1e16ef,_0x49ec3f))return null;const _0x205a05=this[_0x3dab21(0x1c9)](_0x1e16ef,_0x49ec3f),_0x3d5fea=this['getUVByXY'](_0x205a05[0x0],_0x205a05[0x1]);return _0x3d5fea;}['isInExtent'](_0x4395c8,_0x4f079c){const _0x15de4d=_0x25c8f6;return _0x4395c8>=this[_0x15de4d(0x11f)]&&_0x4395c8<=this[_0x15de4d(0x17a)]&&_0x4f079c>=this['ymin']&&_0x4f079c<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x919a6=_0x25c8f6,_0x2c210a=fRandomByfloat(this['xmin'],this[_0x919a6(0x17a)]),_0x3c1873=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x3c1873,'lng':_0x2c210a};}[_0x25c8f6(0x16c)](){const _0x2eef35=_0x25c8f6;let _0x22e9fd,_0x7076f6,_0x3b5643;for(let _0x6ead66=0x0,_0x15081e=this['particles'][_0x2eef35(0x175)];_0x6ead66<_0x15081e;_0x6ead66++){let _0x18074f=this['particles'][_0x6ead66];_0x18074f['age']<=0x0&&(_0x18074f=this['_randomParticle'](_0x18074f));if(_0x18074f[_0x2eef35(0x1b3)]>0x0){const _0x240653=_0x18074f[_0x2eef35(0x1e8)],_0xb6771a=_0x18074f['tlat'];_0x3b5643=this['getUVByPoint'](_0x240653,_0xb6771a),_0x3b5643?(_0x22e9fd=_0x240653+this['_calc_speedRate'][0x0]*_0x3b5643[0x0],_0x7076f6=_0xb6771a+this[_0x2eef35(0x152)][0x1]*_0x3b5643[0x1],_0x18074f['lng']=_0x240653,_0x18074f['lat']=_0xb6771a,_0x18074f['tlng']=_0x22e9fd,_0x18074f['tlat']=_0x7076f6,_0x18074f['speed']=_0x3b5643[0x2],_0x18074f[_0x2eef35(0x1b3)]--):_0x18074f['age']=0x0;}}return this[_0x2eef35(0x1b0)];}['_randomParticle'](_0x1ba19a){const _0x3c234a=_0x25c8f6;let _0x1bc08d,_0x1d6d86;for(let _0x1d5609=0x0;_0x1d5609<0x1e;_0x1d5609++){_0x1bc08d=this['getRandomLatLng'](),_0x1d6d86=this[_0x3c234a(0x1db)](_0x1bc08d['lng'],_0x1bc08d['lat']);if(_0x1d6d86&&_0x1d6d86[0x2]>0x0)break;}if(!_0x1d6d86)return _0x1ba19a;const _0x3a4e6a=_0x1bc08d['lng']+this['_calc_speedRate'][0x0]*_0x1d6d86[0x0],_0x45b9a5=_0x1bc08d[_0x3c234a(0x1f8)]+this['_calc_speedRate'][0x1]*_0x1d6d86[0x1];return _0x1ba19a['lng']=_0x1bc08d['lng'],_0x1ba19a['lat']=_0x1bc08d['lat'],_0x1ba19a['tlng']=_0x3a4e6a,_0x1ba19a[_0x3c234a(0x184)]=_0x45b9a5,_0x1ba19a['age']=Math['round'](Math['random']()*this[_0x3c234a(0x12b)]),_0x1ba19a['speed']=_0x1d6d86[0x2],_0x1ba19a;}[_0x25c8f6(0x1e1)](){for(const _0x546f9c in this){delete this[_0x546f9c];}}}function fRandomByfloat(_0xecfe26,_0x389789){return _0xecfe26+Math['random']()*(_0x389789-_0xecfe26);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];function _0x2ec8(_0x316380,_0x18f208){const _0x2c7752=_0x2c77();return _0x2ec8=function(_0x2ec8c7,_0x1bf53e){_0x2ec8c7=_0x2ec8c7-0x11c;let _0x579ee9=_0x2c7752[_0x2ec8c7];return _0x579ee9;},_0x2ec8(_0x316380,_0x18f208);}class CanvasWindLayer extends BaseLayer{constructor(_0xf1e3ba={}){const _0xb55121=_0x25c8f6;super(_0xf1e3ba),this['_setOptionsHook'](_0xf1e3ba),this['canvas']=null,_0xf1e3ba[_0xb55121(0x133)]&&_0xf1e3ba['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0xb55121(0x1ce))](_0xf1e3ba));}['_setOptionsHook'](_0x99ee64,_0x1acede){const _0x4bf109=_0x25c8f6;this[_0x4bf109(0x12c)]=0x3e8/(_0x99ee64['frameRate']||0xa),this['_pointerEvents']=this[_0x4bf109(0x1aa)][_0x4bf109(0x1d6)]??![],this['color']=_0x99ee64[_0x4bf109(0x1d8)]||_0x4bf109(0x196),this[_0x4bf109(0x127)]=_0x99ee64['lineWidth']||0x1,this['fixedHeight']=_0x99ee64[_0x4bf109(0x13b)]??0x0,this[_0x4bf109(0x178)]=_0x99ee64['reverseY']??![],this['windField']&&this['windField'][_0x4bf109(0x164)](_0x99ee64);}get['layer'](){const _0x4199df=_0x25c8f6;return this[_0x4199df(0x1d0)];}get[_0x25c8f6(0x168)](){const _0x882a49=_0x25c8f6;return this['_map'][_0x882a49(0x19c)]['canvas'][_0x882a49(0x1ac)];}get['canvasHeight'](){const _0x39d9a2=_0x25c8f6;return this[_0x39d9a2(0x18e)]['scene']['canvas'][_0x39d9a2(0x121)];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x5dabf4){const _0x364a86=_0x25c8f6;this['_pointerEvents']=_0x5dabf4;if(!this['canvas'])return;_0x5dabf4?this['canvas']['style']['pointer-events']='all':this[_0x364a86(0x1d0)]['style'][_0x364a86(0x173)]=_0x364a86(0x1cd);}get['particlesNumber'](){return this['options']['particlesNumber'];}set[_0x25c8f6(0x137)](_0x39d8af){this['options']['particlesNumber']=_0x39d8af,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x242661){const _0x3fc6e5=_0x25c8f6;this['options'][_0x3fc6e5(0x1a4)]=_0x242661,this['windField']&&(this['windField'][_0x3fc6e5(0x1a4)]=_0x242661);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x355999){const _0x77d3c1=_0x25c8f6;this['options']['maxAge']=_0x355999,this['windField']&&(this[_0x77d3c1(0x1da)][_0x77d3c1(0x12b)]=_0x355999);}get['data'](){const _0x1bd97d=_0x25c8f6;return this[_0x1bd97d(0x183)];}set['data'](_0x5921cc){const _0xc3d72b=_0x25c8f6;this[_0xc3d72b(0x187)](_0x5921cc);}['_showHook'](_0x574da2){_0x574da2?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x56d730=_0x25c8f6;this['options']['worker']?this['initWorker']():this[_0x56d730(0x1da)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x10eb41=_0x25c8f6;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0x10eb41(0x1aa)]['data']&&this['setData'](this['options'][_0x10eb41(0x144)]);}['_removedHook'](){this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x189a4b=_0x25c8f6,_0x42f92d=mars3d__namespace['DomUtil'][_0x189a4b(0x1cf)]('canvas','mars3d-canvasWind',this['_map']['container']);return _0x42f92d['style']['position']=_0x189a4b(0x146),_0x42f92d['style']['top']='0px',_0x42f92d[_0x189a4b(0x1bd)][_0x189a4b(0x130)]='0px',_0x42f92d[_0x189a4b(0x1bd)][_0x189a4b(0x1bf)]=this[_0x189a4b(0x18e)][_0x189a4b(0x19c)]['canvas']['clientWidth']+'px',_0x42f92d['style']['height']=this[_0x189a4b(0x18e)]['scene']['canvas']['clientHeight']+'px',_0x42f92d['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x42f92d['style']['zIndex']=this[_0x189a4b(0x1aa)]['zIndex']??0x9,_0x42f92d['width']=this['_map'][_0x189a4b(0x19c)]['canvas']['clientWidth'],_0x42f92d['height']=this[_0x189a4b(0x18e)]['scene']['canvas'][_0x189a4b(0x121)],_0x42f92d;}[_0x25c8f6(0x1c1)](){const _0x54b477=_0x25c8f6;this[_0x54b477(0x1d0)]&&(this[_0x54b477(0x1d0)]['style']['width']=this[_0x54b477(0x18e)][_0x54b477(0x19c)]['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this[_0x54b477(0x18e)]['scene'][_0x54b477(0x1d0)][_0x54b477(0x121)]+'px',this['canvas']['width']=this[_0x54b477(0x18e)]['scene']['canvas'][_0x54b477(0x1ac)],this[_0x54b477(0x1d0)]['height']=this['_map']['scene'][_0x54b477(0x1d0)]['clientHeight']);}[_0x25c8f6(0x1dc)](){const _0x173d76=_0x25c8f6,_0x46af7f=this;let _0x13fc62=Date['now']();(function _0x561a8a(){_0x46af7f['animateFrame']=window['requestAnimationFrame'](_0x561a8a);if(_0x46af7f['show']&&_0x46af7f['windField']){const _0x603c1a=Date['now'](),_0x483422=_0x603c1a-_0x13fc62;_0x483422>_0x46af7f['frameTime']&&(_0x13fc62=_0x603c1a-_0x483422%_0x46af7f['frameTime'],_0x46af7f['update']());}}(),window[_0x173d76(0x162)](_0x173d76(0x1c1),this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x173d76(0x155)]=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace[_0x173d76(0x16d)][_0x173d76(0x143)],this[_0x173d76(0x1e7)],this),this[_0x173d76(0x18e)]['on'](mars3d__namespace[_0x173d76(0x16d)][_0x173d76(0x1c7)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x52cdd8=_0x25c8f6;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window[_0x52cdd8(0x1ff)]('resize',this['resize']),this['options']['mouseHidden']&&(this['_map'][_0x52cdd8(0x174)](mars3d__namespace[_0x52cdd8(0x16d)][_0x52cdd8(0x143)],this[_0x52cdd8(0x1e7)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x52cdd8(0x13d)],this),this['_map']['off'](mars3d__namespace[_0x52cdd8(0x16d)][_0x52cdd8(0x180)],this['_onMouseUpEvent'],this),this['_map'][_0x52cdd8(0x174)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x2a723d){const _0x5c984a=_0x25c8f6;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']=_0x5c984a(0x197),this['refreshTimer']=setTimeout(()=>{const _0x178fd3=_0x5c984a;if(!this['show'])return;this[_0x178fd3(0x1a2)](),this[_0x178fd3(0x1d0)]['style']['visibility']='visible';},0xc8);}[_0x25c8f6(0x13d)](_0xf6e705){const _0x56b8dd=_0x25c8f6;this['mouse_down']=!![],this[_0x56b8dd(0x18e)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x56b8dd(0x16d)]['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x40a0a3){const _0x13f777=_0x25c8f6;if(!this['show']||!this['canvas'])return;this[_0x13f777(0x1ec)]&&(this[_0x13f777(0x1d0)]['style']['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x701798){const _0x55e9ce=_0x25c8f6;if(!this['show']||!this[_0x55e9ce(0x1d0)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x55e9ce(0x161)],this),this[_0x55e9ce(0x1ec)]&&this[_0x55e9ce(0x155)]&&this['redraw'](),this['canvas']['style']['visibility']='visible',this[_0x55e9ce(0x1ec)]=![],this['mouse_move']=![];}['setData'](_0x248557){const _0x45c448=_0x25c8f6;this[_0x45c448(0x18f)](),this['windData']=_0x248557,this['windField']['setDate'](_0x248557),this['redraw']();}['redraw'](){const _0x2cf96c=_0x25c8f6;if(!this[_0x2cf96c(0x1ef)])return;this['windField']['setOptions'](this[_0x2cf96c(0x1aa)]),this['update']();}['update'](){const _0x3fed9b=_0x25c8f6;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField'][_0x3fed9b(0x20e)]();else{const _0x372f2b=this['windField']['getParticles']();this[_0x3fed9b(0x1a7)](_0x372f2b);}this[_0x3fed9b(0x1e5)]=![];}['_drawLines'](_0x587b03){const _0x167a2b=_0x25c8f6;this['canvasContext']['globalCompositeOperation']=_0x167a2b(0x125),this[_0x167a2b(0x1e2)][_0x167a2b(0x206)](0x0,0x0,this[_0x167a2b(0x168)],this[_0x167a2b(0x1d1)]),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x3ea946=this['_map']['scene'][_0x167a2b(0x1ad)]!==Cesium['SceneMode'][_0x167a2b(0x19e)],_0x45ffe9=this['canvasWidth']*0.25;if(this[_0x167a2b(0x17d)])for(let _0x3cbac7=0x0,_0x2e8c79=_0x587b03['length'];_0x3cbac7<_0x2e8c79;_0x3cbac7++){const _0x26cd20=_0x587b03[_0x3cbac7],_0x4d0355=this['_tomap'](_0x26cd20[_0x167a2b(0x1e9)],_0x26cd20[_0x167a2b(0x1f8)],_0x26cd20),_0xe0970a=this['_tomap'](_0x26cd20['tlng'],_0x26cd20[_0x167a2b(0x184)],_0x26cd20);if(!_0x4d0355||!_0xe0970a)continue;if(_0x3ea946&&Math['abs'](_0x4d0355[0x0]-_0xe0970a[0x0])>=_0x45ffe9)continue;this['canvasContext'][_0x167a2b(0x1b5)](),this[_0x167a2b(0x1e2)]['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x26cd20[_0x167a2b(0x165)]),this['canvasContext'][_0x167a2b(0x15a)](_0x4d0355[0x0],_0x4d0355[0x1]),this[_0x167a2b(0x1e2)]['lineTo'](_0xe0970a[0x0],_0xe0970a[0x1]),this[_0x167a2b(0x1e2)]['stroke']();}else{this['canvasContext'][_0x167a2b(0x1b5)](),this['canvasContext'][_0x167a2b(0x127)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x167a2b(0x1d8)];for(let _0x5df1eb=0x0,_0x5d68ea=_0x587b03['length'];_0x5df1eb<_0x5d68ea;_0x5df1eb++){const _0x4e2cdc=_0x587b03[_0x5df1eb],_0x220268=this['_tomap'](_0x4e2cdc[_0x167a2b(0x1e9)],_0x4e2cdc['lat'],_0x4e2cdc),_0x4332f2=this['_tomap'](_0x4e2cdc[_0x167a2b(0x1e8)],_0x4e2cdc['tlat'],_0x4e2cdc);if(!_0x220268||!_0x4332f2)continue;if(_0x3ea946&&Math[_0x167a2b(0x1ee)](_0x220268[0x0]-_0x4332f2[0x0])>=_0x45ffe9)continue;this[_0x167a2b(0x1e2)]['moveTo'](_0x220268[0x0],_0x220268[0x1]),this['canvasContext'][_0x167a2b(0x20a)](_0x4332f2[0x0],_0x4332f2[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x2985cd,_0x4ce19c,_0x5bc97c){const _0x385518=_0x25c8f6,_0x34868d=Cesium['Cartesian3'][_0x385518(0x191)](_0x2985cd,_0x4ce19c,this['fixedHeight']),_0x41e1ad=this['_map']['scene'];if(_0x41e1ad['mode']===Cesium['SceneMode']['SCENE3D']){const _0x225b4c=new Cesium['EllipsoidalOccluder'](_0x41e1ad['globe']['ellipsoid'],_0x41e1ad['camera']['positionWC']),_0x4188ad=_0x225b4c[_0x385518(0x207)](_0x34868d);if(!_0x4188ad)return _0x5bc97c[_0x385518(0x1b3)]=0x0,null;}const _0x1bfd66=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map'][_0x385518(0x19c)],_0x34868d);return _0x1bfd66?[_0x1bfd66['x'],_0x1bfd66['y']]:null;}[_0x25c8f6(0x18f)](){const _0x12bc06=_0x25c8f6;this['windField']['clear'](),delete this[_0x12bc06(0x183)];}[_0x25c8f6(0x14d)](){const _0x77747c=_0x25c8f6;this['worker']=new Worker(this[_0x77747c(0x1aa)]['worker']),this['worker'][_0x77747c(0x1dd)]=_0x39a46c=>{const _0x135382=_0x77747c;this[_0x135382(0x1a7)](_0x39a46c['data']['particles']),this[_0x135382(0x145)]=![];},this['windField']={'init':_0x19a166=>{this['worker']['postMessage']({'type':'init','options':_0x19a166});},'setOptions':_0x3a23f7=>{this['worker']['postMessage']({'type':'setOptions','options':_0x3a23f7});},'setDate':_0x337a5b=>{this['worker']['postMessage']({'type':'setDate','data':_0x337a5b});},'update':()=>{const _0x21e5f4=_0x77747c;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker'][_0x21e5f4(0x1e3)]({'type':'update'});},'clear':()=>{const _0x207de5=_0x77747c;this[_0x207de5(0x200)]['postMessage']({'type':'clear'});}},this[_0x77747c(0x1da)]['init'](this[_0x77747c(0x1aa)]);}}mars3d__namespace['LayerUtil'][_0x25c8f6(0x202)](_0x25c8f6(0x1a5),CanvasWindLayer),mars3d__namespace['layer'][_0x25c8f6(0x176)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x25c8f6(0x176)]=CanvasWindLayer,exports[_0x25c8f6(0x1d7)]=WindLayer,exports['WindUtil']=WindUtil,Object[_0x25c8f6(0x1ea)](exports,'__esModule',{'value':!![]});
}));
