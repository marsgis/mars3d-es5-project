/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.4
 * 编译日期：2024-02-20 12:25:21
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x33f84e=_0x41cc;(function(_0x1ab80c,_0x46e8e1){const _0x2ef4d8=_0x41cc,_0x2edcfb=_0x1ab80c();while(!![]){try{const _0x12d90c=parseInt(_0x2ef4d8(0x10b))/0x1*(-parseInt(_0x2ef4d8(0x15b))/0x2)+-parseInt(_0x2ef4d8(0x15e))/0x3*(-parseInt(_0x2ef4d8(0x1eb))/0x4)+-parseInt(_0x2ef4d8(0x1ee))/0x5*(-parseInt(_0x2ef4d8(0x1ce))/0x6)+-parseInt(_0x2ef4d8(0x1bb))/0x7+-parseInt(_0x2ef4d8(0x19d))/0x8+-parseInt(_0x2ef4d8(0x180))/0x9+parseInt(_0x2ef4d8(0x116))/0xa;if(_0x12d90c===_0x46e8e1)break;else _0x2edcfb['push'](_0x2edcfb['shift']());}catch(_0x3fb9ba){_0x2edcfb['push'](_0x2edcfb['shift']());}}}(_0x4472,0x9e3ce));function _interopNamespace(_0xc93ccd){const _0x229e52=_0x41cc;if(_0xc93ccd&&_0xc93ccd['__esModule'])return _0xc93ccd;var _0x428c2c=Object[_0x229e52(0x134)](null);return _0xc93ccd&&Object['keys'](_0xc93ccd)['forEach'](function(_0x4378f5){const _0x45cd9b=_0x229e52;if(_0x4378f5!=='default'){var _0x425ffe=Object[_0x45cd9b(0x120)](_0xc93ccd,_0x4378f5);Object[_0x45cd9b(0x177)](_0x428c2c,_0x4378f5,_0x425ffe['get']?_0x425ffe:{'enumerable':!![],'get':function(){return _0xc93ccd[_0x4378f5];}});}}),_0x428c2c['default']=_0xc93ccd,_0x428c2c;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x41dfd0,_0x457bfe){const _0x4df743=_0x41cc,_0x434072=_0x41dfd0*Math['cos'](Cesium$7[_0x4df743(0x1a1)]['toRadians'](_0x457bfe));return _0x434072;}function getV(_0x4ca0a0,_0xdd098){const _0x140149=_0x4ca0a0*Math['sin'](Cesium$7['Math']['toRadians'](_0xdd098));return _0x140149;}function getSpeed(_0x2716b2,_0x213158){const _0x3dc678=_0x41cc,_0x554457=Math['sqrt'](Math['pow'](_0x2716b2,0x2)+Math[_0x3dc678(0x1de)](_0x213158,0x2));return _0x554457;}function getDirection(_0xb4435d,_0x183332){const _0x15e7e6=_0x41cc;let _0x153cbe=Cesium$7[_0x15e7e6(0x1a1)]['toDegrees'](Math['atan2'](_0x183332,_0xb4435d));return _0x153cbe+=_0x153cbe<0x0?0x168:0x0,_0x153cbe;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x33f84e(0x1b3)];class CustomPrimitive{constructor(_0x410de9){const _0x3eb43f=_0x33f84e;this['commandType']=_0x410de9['commandType'],this[_0x3eb43f(0x111)]=_0x410de9[_0x3eb43f(0x111)],this['attributeLocations']=_0x410de9['attributeLocations'],this['primitiveType']=_0x410de9['primitiveType'],this['uniformMap']=_0x410de9[_0x3eb43f(0x1f1)],this['vertexShaderSource']=_0x410de9[_0x3eb43f(0x1b2)],this[_0x3eb43f(0x1c6)]=_0x410de9['fragmentShaderSource'],this['rawRenderState']=_0x410de9[_0x3eb43f(0x124)],this[_0x3eb43f(0x1ae)]=_0x410de9['framebuffer'],this[_0x3eb43f(0x1d7)]=_0x410de9[_0x3eb43f(0x1d7)],this[_0x3eb43f(0x1a3)]=_0x410de9['autoClear']??![],this['preExecute']=_0x410de9['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x3eb43f(0x1a3)]&&(this['clearCommand']=new Cesium$6[(_0x3eb43f(0x127))]({'color':new Cesium$6[(_0x3eb43f(0x161))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x3eb43f(0x1ae)],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x45169d){const _0x405025=_0x33f84e;switch(this['commandType']){case'Draw':{const _0x1f63d2=Cesium$6['VertexArray']['fromGeometry']({'context':_0x45169d,'geometry':this['geometry'],'attributeLocations':this[_0x405025(0x10c)],'bufferUsage':Cesium$6[_0x405025(0x19b)]['STATIC_DRAW']}),_0x26e039=Cesium$6['ShaderProgram'][_0x405025(0x1c1)]({'context':_0x45169d,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x405025(0x1b2)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x4a59b6=Cesium$6[_0x405025(0x168)]['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x26e039,'vertexArray':_0x1f63d2,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x4a59b6,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x405025(0x1ae)],'pass':Cesium$6['Pass'][_0x405025(0x1d2)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0x405025(0x1d7)],'persists':!![]});}}}['setGeometry'](_0x273485,_0x1fdcd1){const _0x412380=_0x33f84e;this['geometry']=_0x1fdcd1;const _0xcf1e74=Cesium$6[_0x412380(0x184)]['fromGeometry']({'context':_0x273485,'geometry':this[_0x412380(0x111)],'attributeLocations':this[_0x412380(0x10c)],'bufferUsage':Cesium$6[_0x412380(0x19b)]['STATIC_DRAW']});this['commandToExecute'][_0x412380(0x158)]=_0xcf1e74;}['update'](_0x329a71){const _0x173794=_0x33f84e;if(!this['show'])return;if(_0x329a71['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6[_0x173794(0x192)](this[_0x173794(0x112)])&&(this['commandToExecute']=this['createCommand'](_0x329a71[_0x173794(0x10f)])),Cesium$6['defined'](this['preExecute'])&&this[_0x173794(0x1f2)](),Cesium$6['defined'](this['clearCommand'])&&_0x329a71[_0x173794(0x1f3)]['push'](this['clearCommand']),_0x329a71['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x2acdae=_0x33f84e;if(this['clearCommand']){var _0x345a39,_0x56a7b4;(_0x345a39=this[_0x2acdae(0x15d)])!==null&&_0x345a39!==void 0x0&&_0x345a39['vertexArray']&&this['clearCommand'][_0x2acdae(0x158)][_0x2acdae(0x1b4)](),(_0x56a7b4=this[_0x2acdae(0x15d)])!==null&&_0x56a7b4!==void 0x0&&_0x56a7b4['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x2acdae(0x112)]['vertexArray']&&this['commandToExecute']['vertexArray'][_0x2acdae(0x1b4)](),this['commandToExecute'][_0x2acdae(0x1c2)]&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x4f5563=function(){const _0x2ead7e=_0x41cc,_0x2fed7d=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x2ead7e(0x1ed)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x2fed7d;},_0x42e6bf=function(_0x27ec2a,_0x861aa7){const _0x56bda3=_0x41cc;if(Cesium$5['defined'](_0x861aa7)){const _0x497392={};_0x497392[_0x56bda3(0x1d9)]=_0x861aa7,_0x27ec2a[_0x56bda3(0x1c9)]=_0x497392;}const _0x528fb9=new Cesium$5['Texture'](_0x27ec2a);return _0x528fb9;},_0x2f5ca0=function(_0x573379,_0x1e0d78,_0x253403){const _0x4def92=new Cesium$5['Framebuffer']({'context':_0x573379,'colorTextures':[_0x1e0d78],'depthTexture':_0x253403});return _0x4def92;},_0x17248c=function(_0x15c4f6){const _0x70c77c=_0x41cc,_0x283a15=!![],_0x54bd9b=![],_0x1cc23f={'viewport':_0x15c4f6[_0x70c77c(0x17c)],'depthTest':_0x15c4f6['depthTest'],'depthMask':_0x15c4f6['depthMask'],'blending':_0x15c4f6[_0x70c77c(0x1a4)]},_0xfa5226=Cesium$5[_0x70c77c(0x188)]['getDefaultRenderState'](_0x283a15,_0x54bd9b,_0x1cc23f);return _0xfa5226;},_0x534b16=function(_0x53ec08){const _0x41e412=_0x41cc,_0x5d8af2={},_0x25f51e=Cesium$5['Math']['mod'](_0x53ec08['west'],Cesium$5[_0x41e412(0x1a1)]['TWO_PI']),_0x21d10b=Cesium$5[_0x41e412(0x1a1)]['mod'](_0x53ec08['east'],Cesium$5[_0x41e412(0x1a1)]['TWO_PI']),_0x127dda=_0x53ec08[_0x41e412(0x13d)];let _0x5ce000,_0x2565f4;_0x127dda>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x5ce000=0x0,_0x2565f4=Cesium$5['Math']['TWO_PI']):_0x21d10b-_0x25f51e<_0x127dda?(_0x5ce000=_0x25f51e,_0x2565f4=_0x25f51e+_0x127dda):(_0x5ce000=_0x25f51e,_0x2565f4=_0x21d10b);_0x5d8af2[_0x41e412(0x12e)]={'min':Cesium$5['Math']['toDegrees'](_0x5ce000),'max':Cesium$5[_0x41e412(0x1a1)]['toDegrees'](_0x2565f4)};const _0x3a8c8f=_0x53ec08[_0x41e412(0x1d5)],_0x238e8e=_0x53ec08['north'],_0x491ec6=_0x53ec08['height'],_0x4ed1ab=_0x491ec6>Cesium$5[_0x41e412(0x1a1)]['PI']/0xc?_0x491ec6/0x2:0x0;let _0x1168cd=Cesium$5['Math']['clampToLatitudeRange'](_0x3a8c8f-_0x4ed1ab),_0x3db507=Cesium$5['Math'][_0x41e412(0x1b7)](_0x238e8e+_0x4ed1ab);return _0x1168cd<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x1168cd=-Cesium$5['Math']['PI_OVER_TWO']),_0x3db507>Cesium$5[_0x41e412(0x1a1)]['PI_OVER_THREE']&&(_0x3db507=Cesium$5['Math']['PI_OVER_TWO']),_0x5d8af2[_0x41e412(0x1bd)]={'min':Cesium$5[_0x41e412(0x1a1)]['toDegrees'](_0x1168cd),'max':Cesium$5['Math']['toDegrees'](_0x3db507)},_0x5d8af2;};return{'getFullscreenQuad':_0x4f5563,'createTexture':_0x42e6bf,'createFramebuffer':_0x2f5ca0,'createRawRenderState':_0x17248c,'viewRectangleToLonLatRange':_0x534b16};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x167d68,_0x1f753b,_0x2c080d,_0x3cb91d,_0x40a54d){this['createRenderingTextures'](_0x167d68,_0x1f753b,_0x2c080d['colors']),this['createRenderingFramebuffers'](_0x167d68),this['createRenderingPrimitives'](_0x167d68,_0x2c080d,_0x3cb91d,_0x40a54d);}['createRenderingTextures'](_0x194d1a,_0xb6445e,_0x4c9ca1){const _0x5441db=_0x33f84e,_0x4af67b={'context':_0x194d1a,'width':_0x194d1a['drawingBufferWidth'],'height':_0x194d1a[_0x5441db(0x16f)],'pixelFormat':Cesium$4[_0x5441db(0x162)]['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x5441db(0x17f)]},_0x4d0eb6={'context':_0x194d1a,'width':_0x194d1a['drawingBufferWidth'],'height':_0x194d1a['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x5441db(0x162)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0xb9cfde=_0x4c9ca1['length'],_0xb42a97=new Float32Array(_0xb9cfde*0x3);for(let _0x22bc61=0x0;_0x22bc61<_0xb9cfde;_0x22bc61++){const _0x113515=Cesium$4['Color'][_0x5441db(0x1e4)](_0x4c9ca1[_0x22bc61]);_0xb42a97[0x3*_0x22bc61]=_0x113515['red'],_0xb42a97[0x3*_0x22bc61+0x1]=_0x113515['green'],_0xb42a97[0x3*_0x22bc61+0x2]=_0x113515['blue'];}const _0x21c58a={'context':_0x194d1a,'width':_0xb9cfde,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x5441db(0x1ca)][_0x5441db(0x1ef)],'sampler':new Cesium$4[(_0x5441db(0x13c))]({'minificationFilter':Cesium$4[_0x5441db(0x1da)]['LINEAR'],'magnificationFilter':Cesium$4[_0x5441db(0x181)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x4af67b),'segmentsDepth':Util['createTexture'](_0x4d0eb6),'currentTrailsColor':Util['createTexture'](_0x4af67b),'currentTrailsDepth':Util['createTexture'](_0x4d0eb6),'nextTrailsColor':Util[_0x5441db(0x197)](_0x4af67b),'nextTrailsDepth':Util[_0x5441db(0x197)](_0x4d0eb6),'colorTable':Util['createTexture'](_0x21c58a,_0xb42a97)};}[_0x33f84e(0x1a0)](_0x1c19aa){const _0x49eca3=_0x33f84e;this['framebuffers']={'segments':Util['createFramebuffer'](_0x1c19aa,this['textures'][_0x49eca3(0x11a)],this['textures'][_0x49eca3(0x173)]),'currentTrails':Util['createFramebuffer'](_0x1c19aa,this['textures']['currentTrailsColor'],this['textures'][_0x49eca3(0x1e0)]),'nextTrails':Util['createFramebuffer'](_0x1c19aa,this['textures']['nextTrailsColor'],this[_0x49eca3(0x157)][_0x49eca3(0x12c)])};}[_0x33f84e(0x1a7)](_0x2e63bf){const _0x46f587=_0x33f84e,_0x536e72=0x4;let _0x223b49=[];for(let _0x224f53=0x0;_0x224f53<_0x2e63bf['particlesTextureSize'];_0x224f53++){for(let _0x3ac14b=0x0;_0x3ac14b<_0x2e63bf[_0x46f587(0x1c3)];_0x3ac14b++){for(let _0x57e9e4=0x0;_0x57e9e4<_0x536e72;_0x57e9e4++){_0x223b49['push'](_0x224f53/_0x2e63bf['particlesTextureSize']),_0x223b49[_0x46f587(0x167)](_0x3ac14b/_0x2e63bf['particlesTextureSize']);}}}_0x223b49=new Float32Array(_0x223b49);let _0x18f94b=[];const _0x1848bc=[-0x1,0x1],_0xf80956=[-0x1,0x1];for(let _0x4a1067=0x0;_0x4a1067<_0x2e63bf[_0x46f587(0x164)];_0x4a1067++){for(let _0x21ec3b=0x0;_0x21ec3b<_0x536e72/0x2;_0x21ec3b++){for(let _0x576601=0x0;_0x576601<_0x536e72/0x2;_0x576601++){_0x18f94b['push'](_0x1848bc[_0x21ec3b]),_0x18f94b[_0x46f587(0x167)](_0xf80956[_0x576601]),_0x18f94b['push'](0x0);}}}_0x18f94b=new Float32Array(_0x18f94b);const _0x59ebcb=0x6*_0x2e63bf['maxParticles'],_0x59092f=new Uint32Array(_0x59ebcb);for(let _0x3c05bd=0x0,_0x521601=0x0,_0x55bf7b=0x0;_0x3c05bd<_0x2e63bf[_0x46f587(0x164)];_0x3c05bd++){_0x59092f[_0x521601++]=_0x55bf7b+0x0,_0x59092f[_0x521601++]=_0x55bf7b+0x1,_0x59092f[_0x521601++]=_0x55bf7b+0x2,_0x59092f[_0x521601++]=_0x55bf7b+0x2,_0x59092f[_0x521601++]=_0x55bf7b+0x1,_0x59092f[_0x521601++]=_0x55bf7b+0x3,_0x55bf7b+=0x4;}const _0x52c70d=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x223b49}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x46f587(0x1ef)],'componentsPerAttribute':0x3,'values':_0x18f94b})}),'indices':_0x59092f});return _0x52c70d;}[_0x33f84e(0x126)](_0x1cb870,_0x54f8a6,_0x5f0d9d,_0x3a590c){const _0x10e785=_0x33f84e,_0x5a8200=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0x10e785(0x1ba),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x54f8a6),'primitiveType':Cesium$4[_0x10e785(0x133)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x3a590c['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x5c3e5d=_0x10e785;return _0x3a590c[_0x5c3e5d(0x140)]['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x2d9793=_0x10e785;return _0x3a590c[_0x2d9793(0x140)]['postProcessingSpeed'];},'colorTable':function(){const _0x2e7515=_0x10e785;return _0x5a8200[_0x2e7515(0x157)][_0x2e7515(0x170)];},'aspect':function(){const _0x39192f=_0x10e785;return _0x1cb870[_0x39192f(0x11d)]/_0x1cb870['drawingBufferHeight'];},'pixelSize':function(){return _0x5f0d9d['pixelSize'];},'lineWidth':function(){return _0x54f8a6['lineWidth'];},'particleHeight':function(){return _0x54f8a6['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x10e785(0x1cf))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x10e785(0x179)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x10e785(0x133)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x3eebab=_0x10e785;return _0x5a8200[_0x3eebab(0x157)][_0x3eebab(0x11a)];},'segmentsDepthTexture':function(){return _0x5a8200['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x11c4af=_0x10e785;return _0x5a8200['framebuffers'][_0x11c4af(0x189)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x127778=_0x10e785;return _0x5a8200[_0x127778(0x1ad)]['currentTrails'][_0x127778(0x1b9)];},'fadeOpacity':function(){return _0x54f8a6['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x10e785(0x1e9)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x10e785(0x1cf))]({'defines':[_0x10e785(0x138)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x10e785(0x119)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x519ee2=_0x10e785,_0x27e3ff=_0x5a8200['framebuffers'][_0x519ee2(0x189)];_0x5a8200[_0x519ee2(0x1ad)]['currentTrails']=_0x5a8200[_0x519ee2(0x1ad)]['nextTrails'],_0x5a8200['framebuffers']['nextTrails']=_0x27e3ff,_0x5a8200[_0x519ee2(0x1a6)]['trails']['commandToExecute'][_0x519ee2(0x1ae)]=_0x5a8200['framebuffers']['nextTrails'],_0x5a8200['primitives']['trails'][_0x519ee2(0x15d)]['framebuffer']=_0x5a8200[_0x519ee2(0x1ad)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x10e785(0x1ba),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x4db1a9=_0x10e785;return _0x5a8200['framebuffers'][_0x4db1a9(0x19c)][_0x4db1a9(0x166)](0x0);},'trailsDepthTexture':function(){const _0x544a2d=_0x10e785;return _0x5a8200['framebuffers'][_0x544a2d(0x19c)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';function _0x41cc(_0x1120a0,_0x35dfb6){const _0x44726c=_0x4472();return _0x41cc=function(_0x41cc6c,_0x4a3b4c){_0x41cc6c=_0x41cc6c-0x10a;let _0x2d30a1=_0x44726c[_0x41cc6c];return _0x2d30a1;},_0x41cc(_0x1120a0,_0x35dfb6);}function _0x4472(){const _0x2cd14b=['uniformMap','preExecute','commandList','unbindEvent','1298LgKCwm','attributeLocations','resize','segments','context','colors','geometry','commandToExecute','particleSystem','_onMouseMoveEvent','LayerUtil','1887290ALDmFf','remove','Compute','DepthFunction','segmentsColor','clearFramebuffers','_addedHook','drawingBufferWidth','min','addPrimitives','getOwnPropertyDescriptor','umax','getParticles','redraw','rawRenderState','windData','createRenderingPrimitives','ClearCommand','_onMouseDownEvent','execute','dimensions','EventType','nextTrailsDepth','camera','lon','clear','setOptions','top','vdata','PrimitiveType','create','particlesNumber','_updateIng2','PrimitiveCollection','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','createParticlesTextures','add','bindEvent','Sampler','width','log','xmin','particlesTextures','_pointerEvents','hidden','_speedRate','show','globalAlpha','cols','ymax','windField','lev','nextParticlesSpeed','stroke','style','color','getUVByXY','getColor','mouse_down','_tomap','xmax','_map','_onMouseUpEvent','updatePosition','applyViewerParameters','textures','vertexArray','sqrt','viewRectangleToLonLatRange','80pYzFXR','container','clearCommand','39LBvVFP','off','once','Color','PixelFormat','worker','maxParticles','_onMapWhellEvent','getColorTexture','push','RenderState','fromDegrees','levmin','latRange','CanvasWindField','rgb(206,255,255)','mouse_move','drawingBufferHeight','colorTable','mouseMove','mouseDown','segmentsDepth','wind','addEventListener','setData','defineProperty','Cartesian2','createRawRenderState','windTextures','postProcessingSpeed','viewport','clientHeight','ceil','UNSIGNED_BYTE','3277602BmFAhF','TextureMagnificationFilter','fadeOpacity','canvasContext','VertexArray','mouseUp','viewerParameters','canvasResize','Appearance','currentTrails','_updateIng','__esModule','dropRateBump','destroyParticlesTextures','nextParticlesPosition','positionWC','animateFrame','pointer-events','defined','removeEventListener','_onMap_preRenderEvent','maxAge','strokeStyle','createTexture','_data','update','globalCompositeOperation','BufferUsage','nextTrails','3508288YHCiwH','wheel','getOptions','createRenderingFramebuffers','Math','none','autoClear','blending','rows','primitives','createSegmentsGeometry','max','BaseLayer','#ffffff','data','EllipsoidalOccluder','framebuffers','framebuffer','clientWidth','canvas','_mountedHook','vertexShaderSource','Cesium','destroy','forEach','speedRate','clampToLatitudeRange','refreshTimer','depthTexture','Draw','2128938SdQPPK','lineTo','lat','ymin','particlesComputing','lineWidth','fromCache','shaderProgram','particlesTextureSize','steps','_calcUV','fragmentShaderSource','udata','tlat','source','PixelDatatype','length','options','scene','3473298MmjBhf','ShaderSource','_colorRamp','_showHook','OPAQUE','postProcessingPosition','SceneMode','south','_randomParticle','outputTexture','mouseHidden','arrayBufferView','TextureMinificationFilter','grid','getUVByPoint','speed','pow','random','currentTrailsDepth','particlesRendering','speedFactor','currentParticlesPosition','fromCssColorString','layer','levmax','WindUtil','keys','DISABLE_GL_POSITION_LOG_DEPTH','visibility','319784fvMqtf','wgs84ToWindowCoordinates','ComponentDatatype','5DTcgaI','FLOAT','Cartesian3'];_0x4472=function(){return _0x2cd14b;};return _0x4472();}const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x5625c4,_0x136182,_0x3ec41e,_0x185506){const _0x17d6bf=_0x33f84e;this[_0x17d6bf(0x1ab)]=_0x136182,this['createWindTextures'](_0x5625c4,_0x136182),this['createParticlesTextures'](_0x5625c4,_0x3ec41e,_0x185506),this['createComputingPrimitives'](_0x136182,_0x3ec41e,_0x185506);}['createWindTextures'](_0x4fa13b,_0x5bd67d){const _0x4fe5c7=_0x33f84e,_0x597517={'context':_0x4fa13b,'width':_0x5bd67d['dimensions']['lon'],'height':_0x5bd67d[_0x4fe5c7(0x12a)][_0x4fe5c7(0x1bd)]*(_0x5bd67d['dimensions']['lev']||0x1),'pixelFormat':Cesium$3[_0x4fe5c7(0x162)]['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x4fe5c7(0x1ef)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x597517,_0x5bd67d['U']['array']),'V':Util['createTexture'](_0x597517,_0x5bd67d['V']['array'])};}[_0x33f84e(0x139)](_0x503953,_0x6165ab,_0x259b31){const _0x43eee5=_0x33f84e,_0x50247e={'context':_0x503953,'width':_0x6165ab[_0x43eee5(0x1c3)],'height':_0x6165ab[_0x43eee5(0x1c3)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x43eee5(0x13c))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x4eaab1=this['randomizeParticles'](_0x6165ab['maxParticles'],_0x259b31),_0x4a8796=new Float32Array(0x4*_0x6165ab['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x50247e),'currentParticlesPosition':Util['createTexture'](_0x50247e,_0x4eaab1),'nextParticlesPosition':Util[_0x43eee5(0x197)](_0x50247e,_0x4eaab1),'currentParticlesSpeed':Util['createTexture'](_0x50247e,_0x4a8796),'nextParticlesSpeed':Util['createTexture'](_0x50247e,_0x4a8796),'postProcessingPosition':Util[_0x43eee5(0x197)](_0x50247e,_0x4eaab1),'postProcessingSpeed':Util[_0x43eee5(0x197)](_0x50247e,_0x4a8796)};}['randomizeParticles'](_0x32619a,_0x2fb419){const _0x17b653=_0x33f84e,_0xe3bf7b=new Float32Array(0x4*_0x32619a);for(let _0x1b2dad=0x0;_0x1b2dad<_0x32619a;_0x1b2dad++){_0xe3bf7b[0x4*_0x1b2dad]=Cesium$3['Math']['randomBetween'](_0x2fb419['lonRange']['x'],_0x2fb419['lonRange']['y']),_0xe3bf7b[0x4*_0x1b2dad+0x1]=Cesium$3['Math']['randomBetween'](_0x2fb419[_0x17b653(0x16b)]['x'],_0x2fb419['latRange']['y']),_0xe3bf7b[0x4*_0x1b2dad+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x17b653(0x149)]['min'],this[_0x17b653(0x1ab)]['lev']['max']),_0xe3bf7b[0x4*_0x1b2dad+0x3]=0x0;}return _0xe3bf7b;}['destroyParticlesTextures'](){const _0x324613=_0x33f84e;Object['keys'](this[_0x324613(0x140)])['forEach'](_0x23b4c9=>{const _0x25bb48=_0x324613;this[_0x25bb48(0x140)][_0x23b4c9]['destroy']();});}['createComputingPrimitives'](_0x318d49,_0x1fecb5,_0x5dd687){const _0x2a7fae=_0x33f84e,_0x34cd98=new Cesium$3[(_0x2a7fae(0x1f0))](_0x318d49[_0x2a7fae(0x12a)]['lon'],_0x318d49['dimensions']['lat'],_0x318d49['dimensions']['lev']),_0x33a1a8=new Cesium$3[(_0x2a7fae(0x1f0))](_0x318d49['lon'][_0x2a7fae(0x11e)],_0x318d49[_0x2a7fae(0x1bd)][_0x2a7fae(0x11e)],_0x318d49['lev']['min']),_0x313f98=new Cesium$3['Cartesian3'](_0x318d49['lon']['max'],_0x318d49['lat']['max'],_0x318d49['lev'][_0x2a7fae(0x1a8)]),_0x3a4128=new Cesium$3['Cartesian3']((_0x313f98['x']-_0x33a1a8['x'])/(_0x34cd98['x']-0x1),(_0x313f98['y']-_0x33a1a8['y'])/(_0x34cd98['y']-0x1),_0x34cd98['z']>0x1?(_0x313f98['z']-_0x33a1a8['z'])/(_0x34cd98['z']-0x1):0x1),_0x568807=new Cesium$3['Cartesian2'](_0x318d49['U']['min'],_0x318d49['U'][_0x2a7fae(0x1a8)]),_0x9f6bca=new Cesium$3['Cartesian2'](_0x318d49['V'][_0x2a7fae(0x11e)],_0x318d49['V'][_0x2a7fae(0x1a8)]),_0x48c374=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x2a7fae(0x118),'uniformMap':{'U':function(){return _0x48c374['windTextures']['U'];},'V':function(){return _0x48c374['windTextures']['V'];},'currentParticlesPosition':function(){const _0x5cb238=_0x2a7fae;return _0x48c374[_0x5cb238(0x140)]['currentParticlesPosition'];},'dimension':function(){return _0x34cd98;},'minimum':function(){return _0x33a1a8;},'maximum':function(){return _0x313f98;},'interval':function(){return _0x3a4128;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x2c2bde=_0x2a7fae;_0x48c374['primitives']['getWind'][_0x2c2bde(0x112)]['outputTexture']=_0x48c374[_0x2c2bde(0x140)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x2a7fae(0x118),'uniformMap':{'currentParticlesSpeed':function(){return _0x48c374['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x48c374['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x568807;},'vSpeedRange':function(){return _0x9f6bca;},'pixelSize':function(){return _0x5dd687['pixelSize'];},'speedFactor':function(){return _0x1fecb5['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x3eeb30=_0x2a7fae,_0x540f0f=_0x48c374['particlesTextures']['currentParticlesSpeed'];_0x48c374['particlesTextures']['currentParticlesSpeed']=_0x48c374['particlesTextures']['postProcessingSpeed'],_0x48c374[_0x3eeb30(0x140)]['postProcessingSpeed']=_0x540f0f,_0x48c374['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x48c374['particlesTextures'][_0x3eeb30(0x14a)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x48c374['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x48c374['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x2a7fae(0x1cf))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x2a7fae(0x18e)],'preExecute':function(){const _0x4ae6db=_0x2a7fae,_0x7961fc=_0x48c374['particlesTextures'][_0x4ae6db(0x1e3)];_0x48c374[_0x4ae6db(0x140)]['currentParticlesPosition']=_0x48c374['particlesTextures'][_0x4ae6db(0x1d3)],_0x48c374[_0x4ae6db(0x140)]['postProcessingPosition']=_0x7961fc,_0x48c374[_0x4ae6db(0x1a6)][_0x4ae6db(0x155)]['commandToExecute']['outputTexture']=_0x48c374[_0x4ae6db(0x140)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x4ad61c=_0x2a7fae;return _0x48c374['particlesTextures'][_0x4ad61c(0x18e)];},'nextParticlesSpeed':function(){return _0x48c374['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x5dd687['lonRange'];},'latRange':function(){return _0x5dd687['latRange'];},'randomCoefficient':function(){const _0x4caee3=_0x2a7fae,_0x110bf8=Math[_0x4caee3(0x1df)]();return _0x110bf8;},'dropRate':function(){return _0x1fecb5['dropRate'];},'dropRateBump':function(){const _0x1adbc5=_0x2a7fae;return _0x1fecb5[_0x1adbc5(0x18c)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x2a7fae(0x1d3)],'preExecute':function(){const _0x972c70=_0x2a7fae;_0x48c374[_0x972c70(0x1a6)][_0x972c70(0x1d3)]['commandToExecute']['outputTexture']=_0x48c374[_0x972c70(0x140)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x39a09b=_0x2a7fae;return _0x48c374['particlesTextures'][_0x39a09b(0x1d3)];},'nextParticlesSpeed':function(){return _0x48c374['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x22906b=_0x2a7fae;_0x48c374[_0x22906b(0x1a6)][_0x22906b(0x17b)]['commandToExecute'][_0x22906b(0x1d7)]=_0x48c374[_0x22906b(0x140)][_0x22906b(0x17b)];}})};}}const Cesium$2=mars3d__namespace[_0x33f84e(0x1b3)];class ParticleSystem{constructor(_0x264ecf,_0x472f38,_0x163aeb,_0x5eed5c){const _0x3e591e=_0x33f84e;this['context']=_0x264ecf,_0x472f38={..._0x472f38},_0x472f38['udata']&&_0x472f38['vdata']&&(_0x472f38['dimensions']={},_0x472f38['dimensions']['lon']=_0x472f38['cols'],_0x472f38['dimensions']['lat']=_0x472f38[_0x3e591e(0x1a5)],_0x472f38['dimensions']['lev']=_0x472f38['lev']||0x1,_0x472f38[_0x3e591e(0x12e)]={},_0x472f38['lon']['min']=_0x472f38['xmin'],_0x472f38['lon']['max']=_0x472f38['xmax'],_0x472f38['lat']={},_0x472f38['lat']['min']=_0x472f38['ymin'],_0x472f38['lat'][_0x3e591e(0x1a8)]=_0x472f38['ymax'],_0x472f38[_0x3e591e(0x149)]={},_0x472f38['lev']['min']=_0x472f38[_0x3e591e(0x16a)]??0x1,_0x472f38['lev']['max']=_0x472f38[_0x3e591e(0x1e6)]??0x1,_0x472f38['U']={},_0x472f38['U']['array']=new Float32Array(_0x472f38['udata']),_0x472f38['U'][_0x3e591e(0x11e)]=_0x472f38['umin']??Math['min'](..._0x472f38['udata']),_0x472f38['U'][_0x3e591e(0x1a8)]=_0x472f38[_0x3e591e(0x121)]??Math['max'](..._0x472f38[_0x3e591e(0x1c7)]),_0x472f38['V']={},_0x472f38['V']['array']=new Float32Array(_0x472f38['vdata']),_0x472f38['V']['min']=_0x472f38['vmin']??Math['min'](..._0x472f38['vdata']),_0x472f38['V']['max']=_0x472f38['vmax']??Math['max'](..._0x472f38[_0x3e591e(0x132)])),this['data']=_0x472f38,this['options']=_0x163aeb,this['viewerParameters']=_0x5eed5c,this[_0x3e591e(0x1bf)]=new ParticlesComputing(this['context'],this[_0x3e591e(0x1ab)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0x3e591e(0x1bf)]);}['canvasResize'](_0x1adb3b){const _0x4bccb3=_0x33f84e;this['particlesComputing'][_0x4bccb3(0x18d)](),Object['keys'](this['particlesComputing'][_0x4bccb3(0x17a)])['forEach'](_0x440bdb=>{const _0x5d8bbf=_0x4bccb3;this[_0x5d8bbf(0x1bf)][_0x5d8bbf(0x17a)][_0x440bdb]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x4bccb3(0x1b4)](),Object['keys'](this[_0x4bccb3(0x1e1)]['framebuffers'])['forEach'](_0x624154=>{const _0x1abc65=_0x4bccb3;this[_0x1abc65(0x1e1)]['framebuffers'][_0x624154]['destroy']();}),this['context']=_0x1adb3b,this['particlesComputing']=new ParticlesComputing(this[_0x4bccb3(0x10f)],this[_0x4bccb3(0x1ab)],this['options'],this[_0x4bccb3(0x186)]),this[_0x4bccb3(0x1e1)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x33f84e(0x11b)](){const _0x418661=_0x33f84e,_0x2c8c72=new Cesium$2[(_0x418661(0x127))]({'color':new Cesium$2[(_0x418661(0x161))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x5ef82d=>{const _0x3eb524=_0x418661;_0x2c8c72['framebuffer']=this['particlesRendering']['framebuffers'][_0x5ef82d],_0x2c8c72[_0x3eb524(0x129)](this['context']);});}['refreshParticles'](_0x4404fd){const _0xaa3db9=_0x33f84e;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x4404fd){var _0x5b8166;const _0x4a2d32=this['particlesRendering'][_0xaa3db9(0x1a7)](this['options']);this[_0xaa3db9(0x1e1)]['primitives']['segments']['geometry']=_0x4a2d32;const _0x36c4ae=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0xaa3db9(0x10f)],'geometry':_0x4a2d32,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2[_0xaa3db9(0x19b)]['STATIC_DRAW']});(_0x5b8166=this['particlesRendering']['primitives'])!==null&&_0x5b8166!==void 0x0&&(_0x5b8166=_0x5b8166['segments'])!==null&&_0x5b8166!==void 0x0&&_0x5b8166['commandToExecute']&&(this['particlesRendering'][_0xaa3db9(0x1a6)]['segments']['commandToExecute']['vertexArray']=_0x36c4ae);}}['setOptions'](_0x323a60){const _0x525f0e=_0x33f84e;let _0xc0a4a3=![];this['options']['maxParticles']!==_0x323a60['maxParticles']&&(_0xc0a4a3=!![]),Object['keys'](_0x323a60)[_0x525f0e(0x1b5)](_0x1c38db=>{this['options'][_0x1c38db]=_0x323a60[_0x1c38db];}),this['refreshParticles'](_0xc0a4a3);}['applyViewerParameters'](_0x2db956){const _0x2d56d2=_0x33f84e;Object['keys'](_0x2db956)[_0x2d56d2(0x1b5)](_0x3bf19a=>{this['viewerParameters'][_0x3bf19a]=_0x2db956[_0x3bf19a];}),this['refreshParticles'](![]);}[_0x33f84e(0x1b4)](){const _0x8531df=_0x33f84e;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x8531df(0x18d)](),Object[_0x8531df(0x1e8)](this['particlesComputing'][_0x8531df(0x17a)])['forEach'](_0x3e22ad=>{const _0x23487d=_0x8531df;this[_0x23487d(0x1bf)][_0x23487d(0x17a)][_0x3e22ad]['destroy']();}),this['particlesRendering']['textures'][_0x8531df(0x170)][_0x8531df(0x1b4)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x4d2076=>{const _0x29be83=_0x8531df;this['particlesRendering']['framebuffers'][_0x4d2076][_0x29be83(0x1b4)]();});for(const _0x36b1f9 in this){delete this[_0x36b1f9];}}}const Cesium$1=mars3d__namespace[_0x33f84e(0x1b3)],BaseLayer$1=mars3d__namespace[_0x33f84e(0x1e5)][_0x33f84e(0x1a9)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x33f84e(0x16d)]};class WindLayer extends BaseLayer$1{constructor(_0x214f38={}){_0x214f38={...DEF_OPTIONS,..._0x214f38},super(_0x214f38),this['_setOptionsHook'](_0x214f38);}get['layer'](){const _0x54ec21=_0x33f84e;return this[_0x54ec21(0x1a6)];}get['data'](){return this['_data'];}set[_0x33f84e(0x1ab)](_0x5ee169){const _0x29610f=_0x33f84e;this[_0x29610f(0x176)](_0x5ee169);}get['colors'](){return this['options']['colors'];}set['colors'](_0x368834){const _0x36372b=_0x33f84e;this['options']['colors']=_0x368834,this['particleSystem']&&this[_0x36372b(0x113)][_0x36372b(0x130)]({'colors':_0x368834}),this['resize']();}[_0x33f84e(0x1b1)](){}[_0x33f84e(0x11c)](){const _0x560b6a=_0x33f84e;this[_0x560b6a(0x1cd)]=this['_map']['scene'],this[_0x560b6a(0x12d)]=this[_0x560b6a(0x153)][_0x560b6a(0x12d)],this['primitives']=new Cesium$1[(_0x560b6a(0x137))](),this['_map'][_0x560b6a(0x1cd)][_0x560b6a(0x1a6)][_0x560b6a(0x13a)](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x560b6a(0x178))](),'latRange':new Cesium$1[(_0x560b6a(0x178))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x560b6a(0x175)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x560b6a(0x153)]['on'](mars3d__namespace['EventType']['wheel'],this[_0x560b6a(0x165)],this),this[_0x560b6a(0x153)]['on'](mars3d__namespace['EventType'][_0x560b6a(0x172)],this['_onMouseDownEvent'],this),this[_0x560b6a(0x153)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x560b6a(0x198)]);}['_removedHook'](){const _0x23860f=_0x33f84e;window[_0x23860f(0x193)]('resize',this[_0x23860f(0x10d)]),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x23860f(0x15f)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x23860f(0x12b)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x23860f(0x15f)](mars3d__namespace[_0x23860f(0x12b)][_0x23860f(0x185)],this[_0x23860f(0x154)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x23860f(0x171)],this['_onMouseMoveEvent'],this),this[_0x23860f(0x1a6)]['removeAll'](),this[_0x23860f(0x153)]['scene']['primitives'][_0x23860f(0x117)](this[_0x23860f(0x1a6)]);}['resize'](){const _0x3c43af=_0x33f84e;if(!this[_0x3c43af(0x144)]||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x3c43af(0x1a6)]['removeAll'](),this[_0x3c43af(0x153)][_0x3c43af(0x160)](mars3d__namespace[_0x3c43af(0x12b)]['preRender'],this[_0x3c43af(0x194)],this);}[_0x33f84e(0x194)](_0x472253){const _0x5f4db1=_0x33f84e;this[_0x5f4db1(0x113)][_0x5f4db1(0x187)](this['scene']['context']),this[_0x5f4db1(0x11f)](),this['primitives']['show']=!![];}[_0x33f84e(0x165)](_0x4e62eb){const _0x333d98=_0x33f84e;clearTimeout(this[_0x333d98(0x1b8)]);if(!this['show']||!this[_0x333d98(0x113)])return;this[_0x333d98(0x1a6)]['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x53999d=_0x333d98;if(!this[_0x53999d(0x144)])return;this[_0x53999d(0x123)]();},0xc8);}['_onMouseDownEvent'](_0x4502e7){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x5aa8b6){const _0xac22f1=_0x33f84e;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives'][_0xac22f1(0x144)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x446d8b){const _0x9669fe=_0x33f84e;if(!this[_0x9669fe(0x144)]||!this['particleSystem'])return;this[_0x9669fe(0x150)]&&this[_0x9669fe(0x16e)]&&this[_0x9669fe(0x123)](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x9669fe(0x16e)]=![];}['redraw'](){const _0x133ff0=_0x33f84e;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0x133ff0(0x113)][_0x133ff0(0x156)](this[_0x133ff0(0x186)]),this[_0x133ff0(0x1a6)]['show']=!![];}[_0x33f84e(0x176)](_0x379251){const _0x5b21f6=_0x33f84e;this['_data']=_0x379251,this['particleSystem']&&this[_0x5b21f6(0x113)]['destroy'](),this[_0x5b21f6(0x113)]=new ParticleSystem(this['scene']['context'],_0x379251,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x420fe6,_0x39bd5f){const _0x14d35e=_0x33f84e;if(_0x420fe6)for(const _0x47414e in _0x420fe6){this[_0x47414e]=_0x420fe6[_0x47414e];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x14d35e(0x19f)]());}['getOptions'](){const _0xc67e08=_0x33f84e,_0x4e369c=Math[_0xc67e08(0x17e)](Math[_0xc67e08(0x159)](this[_0xc67e08(0x135)]));return this['particlesNumber']=_0x4e369c*_0x4e369c,{'particlesTextureSize':_0x4e369c,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0xc67e08(0x182)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0xc67e08(0x1e2)],'lineWidth':this[_0xc67e08(0x1c0)],'colors':this['colors']};}['addPrimitives'](){const _0x54ffa6=_0x33f84e;this['primitives']['add'](this['particleSystem'][_0x54ffa6(0x1bf)]['primitives']['getWind']),this['primitives'][_0x54ffa6(0x13a)](this['particleSystem']['particlesComputing'][_0x54ffa6(0x1a6)]['updateSpeed']),this['primitives'][_0x54ffa6(0x13a)](this['particleSystem']['particlesComputing']['primitives']['updatePosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives'][_0x54ffa6(0x13a)](this[_0x54ffa6(0x113)][_0x54ffa6(0x1bf)]['primitives']['postProcessingSpeed']),this['primitives']['add'](this[_0x54ffa6(0x113)]['particlesRendering'][_0x54ffa6(0x1a6)][_0x54ffa6(0x10e)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this[_0x54ffa6(0x1a6)]['add'](this['particleSystem']['particlesRendering'][_0x54ffa6(0x1a6)]['screen']);}['updateViewerParameters'](){const _0x2b0aa7=_0x33f84e;let _0xb08032=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0xb08032){const _0x4e50ac=this['_map']['getExtent']();_0xb08032=Cesium$1['Rectangle'][_0x2b0aa7(0x169)](_0x4e50ac['xmin'],_0x4e50ac['ymin'],_0x4e50ac[_0x2b0aa7(0x152)],_0x4e50ac[_0x2b0aa7(0x147)]);}const _0x418bd3=Util[_0x2b0aa7(0x15a)](_0xb08032);this['viewerParameters']['lonRange']['x']=_0x418bd3['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x418bd3['lon']['max'],this[_0x2b0aa7(0x186)]['latRange']['x']=_0x418bd3[_0x2b0aa7(0x1bd)][_0x2b0aa7(0x11e)],this[_0x2b0aa7(0x186)]['latRange']['y']=_0x418bd3['lat'][_0x2b0aa7(0x1a8)];const _0x37bb20=this[_0x2b0aa7(0x12d)]['getPixelSize'](this['globeBoundingSphere'],this[_0x2b0aa7(0x1cd)][_0x2b0aa7(0x11d)],this[_0x2b0aa7(0x1cd)]['drawingBufferHeight']);_0x37bb20>0x0&&(this['viewerParameters']['pixelSize']=_0x37bb20);}}mars3d__namespace['LayerUtil']['register'](_0x33f84e(0x174),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x20dc4f=_0x33f84e;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x20dc4f(0x1c8)]=null,this['age']=null,this[_0x20dc4f(0x1dd)]=null;}['destroy'](){for(const _0x286adb in this){delete this[_0x286adb];}}}class CanvasWindField{constructor(_0x458659){this['setOptions'](_0x458659);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x4e14d2){const _0x3abef5=_0x33f84e;this[_0x3abef5(0x143)]=(0x64-(_0x4e14d2>0x63?0x63:_0x4e14d2))*0x64,this['_calc_speedRate']=[(this['xmax']-this[_0x3abef5(0x13f)])/this['_speedRate'],(this[_0x3abef5(0x147)]-this['ymin'])/this[_0x3abef5(0x143)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x57ce1e){this['_maxAge']=_0x57ce1e;}['setOptions'](_0x321b0b){const _0x397366=_0x33f84e;this['options']=_0x321b0b,this[_0x397366(0x195)]=_0x321b0b['maxAge']||0x78,this[_0x397366(0x1b6)]=_0x321b0b['speedRate']||0x32,this['particles']=[];const _0x33459e=_0x321b0b['particlesNumber']||0x1000;for(let _0x4ae945=0x0;_0x4ae945<_0x33459e;_0x4ae945++){const _0x1619c1=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x1619c1);}}['setDate'](_0x47e20a){const _0x4f4dfe=_0x33f84e;this['rows']=_0x47e20a['rows'],this['cols']=_0x47e20a['cols'],this['xmin']=_0x47e20a['xmin'],this['xmax']=_0x47e20a['xmax'],this['ymin']=_0x47e20a['ymin'],this['ymax']=_0x47e20a['ymax'],this['grid']=[];const _0x303223=_0x47e20a['udata'],_0x93de27=_0x47e20a['vdata'];let _0x2f18ca=![];_0x303223[_0x4f4dfe(0x1cb)]===this['rows']&&_0x303223[0x0]['length']===this['cols']&&(_0x2f18ca=!![]);let _0x56ab8=0x0,_0x59057a=null,_0x296550=null;for(let _0x1cff94=0x0;_0x1cff94<this['rows'];_0x1cff94++){_0x59057a=[];for(let _0x60d574=0x0;_0x60d574<this['cols'];_0x60d574++,_0x56ab8++){_0x2f18ca?_0x296550=this[_0x4f4dfe(0x1c5)](_0x303223[_0x1cff94][_0x60d574],_0x93de27[_0x1cff94][_0x60d574]):_0x296550=this['_calcUV'](_0x303223[_0x56ab8],_0x93de27[_0x56ab8]),_0x59057a['push'](_0x296550);}this['grid']['push'](_0x59057a);}this[_0x4f4dfe(0x1cc)]['reverseY']&&this[_0x4f4dfe(0x1db)]['reverse']();}[_0x33f84e(0x12f)](){const _0xfd37c3=_0x33f84e;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0xfd37c3(0x1be)],delete this[_0xfd37c3(0x147)],delete this['grid'],delete this['particles'];}['toGridXY'](_0xfe9b3a,_0x202653){const _0x36f3bd=_0x33f84e,_0x54037a=(_0xfe9b3a-this['xmin'])/(this['xmax']-this['xmin'])*(this[_0x36f3bd(0x146)]-0x1),_0x187743=(this['ymax']-_0x202653)/(this[_0x36f3bd(0x147)]-this['ymin'])*(this[_0x36f3bd(0x1a5)]-0x1);return[_0x54037a,_0x187743];}['getUVByXY'](_0x4ff175,_0x362e91){const _0x30c65a=_0x33f84e;if(_0x4ff175<0x0||_0x4ff175>=this['cols']||_0x362e91>=this['rows'])return[0x0,0x0,0x0];const _0x9db171=Math['floor'](_0x4ff175),_0x1b89f4=Math['floor'](_0x362e91);if(_0x9db171===_0x4ff175&&_0x1b89f4===_0x362e91)return this[_0x30c65a(0x1db)][_0x362e91][_0x4ff175];const _0x37ecc1=_0x9db171+0x1,_0x71b2d2=_0x1b89f4+0x1,_0x5ab33f=this['getUVByXY'](_0x9db171,_0x1b89f4),_0x490e7f=this['getUVByXY'](_0x37ecc1,_0x1b89f4),_0xbf356c=this[_0x30c65a(0x14e)](_0x9db171,_0x71b2d2),_0x3c725e=this[_0x30c65a(0x14e)](_0x37ecc1,_0x71b2d2);let _0x3afb92=null;try{_0x3afb92=this['_bilinearInterpolation'](_0x4ff175-_0x9db171,_0x362e91-_0x1b89f4,_0x5ab33f,_0x490e7f,_0xbf356c,_0x3c725e);}catch(_0x5418d7){console[_0x30c65a(0x13e)](_0x4ff175,_0x362e91);}return _0x3afb92;}['_bilinearInterpolation'](_0x4d00d0,_0x123933,_0x5a9973,_0x287d60,_0x229e3c,_0x1fc229){const _0x2889be=0x1-_0x4d00d0,_0x455d9b=0x1-_0x123933,_0x5660b6=_0x2889be*_0x455d9b,_0x4f2e08=_0x4d00d0*_0x455d9b,_0x339466=_0x2889be*_0x123933,_0x9c856b=_0x4d00d0*_0x123933,_0x2aff21=_0x5a9973[0x0]*_0x5660b6+_0x287d60[0x0]*_0x4f2e08+_0x229e3c[0x0]*_0x339466+_0x1fc229[0x0]*_0x9c856b,_0xad3fa4=_0x5a9973[0x1]*_0x5660b6+_0x287d60[0x1]*_0x4f2e08+_0x229e3c[0x1]*_0x339466+_0x1fc229[0x1]*_0x9c856b;return this['_calcUV'](_0x2aff21,_0xad3fa4);}[_0x33f84e(0x1c5)](_0xdcc778,_0x1f2498){return[+_0xdcc778,+_0x1f2498,Math['sqrt'](_0xdcc778*_0xdcc778+_0x1f2498*_0x1f2498)];}[_0x33f84e(0x1dc)](_0x4ad6e,_0x297c8b){const _0x3e5f83=_0x33f84e;if(!this['isInExtent'](_0x4ad6e,_0x297c8b))return null;const _0x21f27c=this['toGridXY'](_0x4ad6e,_0x297c8b),_0x11f997=this[_0x3e5f83(0x14e)](_0x21f27c[0x0],_0x21f27c[0x1]);return _0x11f997;}['isInExtent'](_0x2b44da,_0x53f6bd){const _0xfa8637=_0x33f84e;return _0x2b44da>=this['xmin']&&_0x2b44da<=this[_0xfa8637(0x152)]&&_0x53f6bd>=this['ymin']&&_0x53f6bd<=this[_0xfa8637(0x147)]?!![]:![];}['getRandomLatLng'](){const _0x324aff=_0x33f84e,_0x343aa9=fRandomByfloat(this[_0x324aff(0x13f)],this[_0x324aff(0x152)]),_0x49569d=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x49569d,'lng':_0x343aa9};}['getParticles'](){const _0x226431=_0x33f84e;let _0x4d2fbf,_0x25397f,_0x587c38;for(let _0x5e1134=0x0,_0x9619de=this['particles'][_0x226431(0x1cb)];_0x5e1134<_0x9619de;_0x5e1134++){let _0x521de2=this['particles'][_0x5e1134];_0x521de2['age']<=0x0&&(_0x521de2=this['_randomParticle'](_0x521de2));if(_0x521de2['age']>0x0){const _0x20e982=_0x521de2['tlng'],_0x1da7b0=_0x521de2['tlat'];_0x587c38=this[_0x226431(0x1dc)](_0x20e982,_0x1da7b0),_0x587c38?(_0x4d2fbf=_0x20e982+this['_calc_speedRate'][0x0]*_0x587c38[0x0],_0x25397f=_0x1da7b0+this['_calc_speedRate'][0x1]*_0x587c38[0x1],_0x521de2['lng']=_0x20e982,_0x521de2['lat']=_0x1da7b0,_0x521de2['tlng']=_0x4d2fbf,_0x521de2['tlat']=_0x25397f,_0x521de2[_0x226431(0x1dd)]=_0x587c38[0x2],_0x521de2['age']--):_0x521de2['age']=0x0;}}return this['particles'];}[_0x33f84e(0x1d6)](_0x43d230){const _0x1034a5=_0x33f84e;let _0x1fe180,_0x27fd84;for(let _0x1d46ce=0x0;_0x1d46ce<0x1e;_0x1d46ce++){_0x1fe180=this['getRandomLatLng'](),_0x27fd84=this['getUVByPoint'](_0x1fe180['lng'],_0x1fe180[_0x1034a5(0x1bd)]);if(_0x27fd84&&_0x27fd84[0x2]>0x0)break;}if(!_0x27fd84)return _0x43d230;const _0x4c1a63=_0x1fe180['lng']+this['_calc_speedRate'][0x0]*_0x27fd84[0x0],_0x52bffa=_0x1fe180['lat']+this['_calc_speedRate'][0x1]*_0x27fd84[0x1];return _0x43d230['lng']=_0x1fe180['lng'],_0x43d230['lat']=_0x1fe180['lat'],_0x43d230['tlng']=_0x4c1a63,_0x43d230[_0x1034a5(0x1c8)]=_0x52bffa,_0x43d230['age']=Math['round'](Math['random']()*this[_0x1034a5(0x195)]),_0x43d230[_0x1034a5(0x1dd)]=_0x27fd84[0x2],_0x43d230;}[_0x33f84e(0x1b4)](){for(const _0x3289e3 in this){delete this[_0x3289e3];}}}function fRandomByfloat(_0x2d9ea8,_0x40eb99){return _0x2d9ea8+Math['random']()*(_0x40eb99-_0x2d9ea8);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x33f84e(0x1a9)];class CanvasWindLayer extends BaseLayer{constructor(_0x3716c7={}){const _0x109728=_0x33f84e;super(_0x3716c7),this['_setOptionsHook'](_0x3716c7),this['canvas']=null,_0x3716c7[_0x109728(0x110)]&&_0x3716c7[_0x109728(0x1c4)]&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x3716c7));}['_setOptionsHook'](_0x37d47e,_0x4882c7){const _0x138641=_0x33f84e;this['frameTime']=0x3e8/(_0x37d47e['frameRate']||0xa),this['_pointerEvents']=this[_0x138641(0x1cc)]['pointerEvents']??![],this[_0x138641(0x14d)]=_0x37d47e[_0x138641(0x14d)]||_0x138641(0x1aa),this['lineWidth']=_0x37d47e[_0x138641(0x1c0)]||0x1,this['fixedHeight']=_0x37d47e['fixedHeight']??0x0,this['reverseY']=_0x37d47e['reverseY']??![],this['windField']&&this[_0x138641(0x148)]['setOptions'](_0x37d47e);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x1083a2=_0x33f84e;return this['_map'][_0x1083a2(0x1cd)][_0x1083a2(0x1b0)]['clientWidth'];}get['canvasHeight'](){const _0x4c5011=_0x33f84e;return this[_0x4c5011(0x153)]['scene']['canvas']['clientHeight'];}get['pointerEvents'](){const _0x6dfbcf=_0x33f84e;return this[_0x6dfbcf(0x141)];}set['pointerEvents'](_0x55dcd0){const _0x449b9b=_0x33f84e;this['_pointerEvents']=_0x55dcd0;if(!this['canvas'])return;_0x55dcd0?this[_0x449b9b(0x1b0)]['style'][_0x449b9b(0x191)]='all':this['canvas']['style'][_0x449b9b(0x191)]='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x4e71fd){const _0x286781=_0x33f84e;this['options'][_0x286781(0x135)]=_0x4e71fd,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x33f84e(0x1b6)](){const _0x4d69fb=_0x33f84e;return this[_0x4d69fb(0x1cc)][_0x4d69fb(0x1b6)];}set[_0x33f84e(0x1b6)](_0x26548a){this['options']['speedRate']=_0x26548a,this['windField']&&(this['windField']['speedRate']=_0x26548a);}get['maxAge'](){const _0x268285=_0x33f84e;return this[_0x268285(0x1cc)][_0x268285(0x195)];}set[_0x33f84e(0x195)](_0x3f4cfc){const _0x3f3cf0=_0x33f84e;this[_0x3f3cf0(0x1cc)]['maxAge']=_0x3f4cfc,this['windField']&&(this['windField'][_0x3f3cf0(0x195)]=_0x3f4cfc);}get[_0x33f84e(0x1ab)](){const _0x486f00=_0x33f84e;return this[_0x486f00(0x125)];}set['data'](_0x38fc8c){this['setData'](_0x38fc8c);}[_0x33f84e(0x1d1)](_0x6ef1f0){const _0x578c95=_0x33f84e;_0x6ef1f0?this['_addedHook']():(this[_0x578c95(0x125)]&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x300953=_0x33f84e;this['options'][_0x300953(0x163)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x33f84e(0x11c)](){const _0x3ad97d=_0x33f84e;this['canvas']=this['_createCanvas'](),this[_0x3ad97d(0x183)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x3ad97d(0x13b)](),this['options']['data']&&this['setData'](this[_0x3ad97d(0x1cc)]['data']);}['_removedHook'](){const _0x2d6937=_0x33f84e;this['clear'](),this['unbindEvent'](),this[_0x2d6937(0x1b0)]&&(this['_map'][_0x2d6937(0x15c)]['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x5f4cbc=_0x33f84e,_0x5b82b5=mars3d__namespace['DomUtil']['create'](_0x5f4cbc(0x1b0),'mars3d-canvasWind',this[_0x5f4cbc(0x153)]['container']);return _0x5b82b5['style']['position']='absolute',_0x5b82b5[_0x5f4cbc(0x14c)][_0x5f4cbc(0x131)]='0px',_0x5b82b5[_0x5f4cbc(0x14c)]['left']='0px',_0x5b82b5['style']['width']=this['_map']['scene']['canvas'][_0x5f4cbc(0x1af)]+'px',_0x5b82b5[_0x5f4cbc(0x14c)]['height']=this['_map'][_0x5f4cbc(0x1cd)]['canvas'][_0x5f4cbc(0x17d)]+'px',_0x5b82b5[_0x5f4cbc(0x14c)]['pointerEvents']=this['_pointerEvents']?'auto':_0x5f4cbc(0x1a2),_0x5b82b5[_0x5f4cbc(0x14c)]['zIndex']=this['options']['zIndex']??0x9,_0x5b82b5['width']=this[_0x5f4cbc(0x153)][_0x5f4cbc(0x1cd)]['canvas'][_0x5f4cbc(0x1af)],_0x5b82b5['height']=this['_map']['scene']['canvas'][_0x5f4cbc(0x17d)],_0x5b82b5;}['resize'](){const _0x347f9d=_0x33f84e;this[_0x347f9d(0x1b0)]&&(this['canvas']['style']['width']=this['_map']['scene'][_0x347f9d(0x1b0)][_0x347f9d(0x1af)]+'px',this['canvas']['style']['height']=this[_0x347f9d(0x153)]['scene']['canvas']['clientHeight']+'px',this['canvas'][_0x347f9d(0x13d)]=this['_map']['scene'][_0x347f9d(0x1b0)]['clientWidth'],this['canvas']['height']=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x47a9f8=_0x33f84e,_0x123e2e=this;let _0x1bc951=Date['now']();(function _0xef427f(){_0x123e2e['animateFrame']=window['requestAnimationFrame'](_0xef427f);if(_0x123e2e['show']&&_0x123e2e['windField']){const _0x4741fa=Date['now'](),_0x50f4ce=_0x4741fa-_0x1bc951;_0x50f4ce>_0x123e2e['frameTime']&&(_0x1bc951=_0x4741fa-_0x50f4ce%_0x123e2e['frameTime'],_0x123e2e['update']());}}(),window['addEventListener'](_0x47a9f8(0x10d),this[_0x47a9f8(0x10d)]['bind'](this),![]),this[_0x47a9f8(0x150)]=![],this['mouse_move']=![],this['options'][_0x47a9f8(0x1d8)]&&(this['_map']['on'](mars3d__namespace['EventType'][_0x47a9f8(0x19e)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x47a9f8(0x12b)][_0x47a9f8(0x185)],this['_onMouseUpEvent'],this)));}[_0x33f84e(0x10a)](){const _0x444d2c=_0x33f84e;window['cancelAnimationFrame'](this[_0x444d2c(0x190)]),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this[_0x444d2c(0x153)][_0x444d2c(0x15f)](mars3d__namespace['EventType'][_0x444d2c(0x19e)],this['_onMapWhellEvent'],this),this[_0x444d2c(0x153)]['off'](mars3d__namespace[_0x444d2c(0x12b)]['mouseDown'],this[_0x444d2c(0x128)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x444d2c(0x114)],this));}['_onMapWhellEvent'](_0x3bc9f2){const _0xded574=_0x33f84e;clearTimeout(this['refreshTimer']);if(!this[_0xded574(0x144)]||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x474cb9=_0xded574;if(!this['show'])return;this['redraw'](),this['canvas'][_0x474cb9(0x14c)]['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x447700){const _0x2e4961=_0x33f84e;this[_0x2e4961(0x150)]=!![],this['_map'][_0x2e4961(0x15f)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x2e4961(0x153)]['on'](mars3d__namespace[_0x2e4961(0x12b)]['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x33da7f){const _0x5ca5e8=_0x33f84e;if(!this['show']||!this[_0x5ca5e8(0x1b0)])return;this['mouse_down']&&(this[_0x5ca5e8(0x1b0)]['style'][_0x5ca5e8(0x1ea)]=_0x5ca5e8(0x142),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x1b097f){const _0x5c59fa=_0x33f84e;if(!this['show']||!this[_0x5c59fa(0x1b0)])return;this[_0x5c59fa(0x153)]['off'](mars3d__namespace[_0x5c59fa(0x12b)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x5c59fa(0x150)]&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this[_0x5c59fa(0x150)]=![],this[_0x5c59fa(0x16e)]=![];}['setData'](_0xcfc894){const _0x46dd33=_0x33f84e;this[_0x46dd33(0x12f)](),this['windData']=_0xcfc894,this['windField']['setDate'](_0xcfc894),this[_0x46dd33(0x123)]();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}[_0x33f84e(0x199)](){const _0x47e746=_0x33f84e;if(this['_updateIng'])return;this[_0x47e746(0x18a)]=!![];if(this['worker'])this[_0x47e746(0x148)]['update']();else{const _0x4520e8=this[_0x47e746(0x148)][_0x47e746(0x122)]();this['_drawLines'](_0x4520e8);}this['_updateIng']=![];}['_drawLines'](_0x3f4af3){const _0x489a35=_0x33f84e;this[_0x489a35(0x183)][_0x489a35(0x19a)]='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext'][_0x489a35(0x145)]=0.9;const _0x401a78=this[_0x489a35(0x153)]['scene']['mode']!==Cesium[_0x489a35(0x1d4)]['SCENE3D'],_0x11aac2=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x404c16=0x0,_0xed1234=_0x3f4af3['length'];_0x404c16<_0xed1234;_0x404c16++){const _0xc7469=_0x3f4af3[_0x404c16],_0x1e8085=this['_tomap'](_0xc7469['lng'],_0xc7469['lat'],_0xc7469),_0x408117=this[_0x489a35(0x151)](_0xc7469['tlng'],_0xc7469[_0x489a35(0x1c8)],_0xc7469);if(!_0x1e8085||!_0x408117)continue;if(_0x401a78&&Math['abs'](_0x1e8085[0x0]-_0x408117[0x0])>=_0x11aac2)continue;this['canvasContext']['beginPath'](),this['canvasContext'][_0x489a35(0x1c0)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x489a35(0x1d0)][_0x489a35(0x14f)](_0xc7469['speed']),this['canvasContext']['moveTo'](_0x1e8085[0x0],_0x1e8085[0x1]),this['canvasContext'][_0x489a35(0x1bc)](_0x408117[0x0],_0x408117[0x1]),this['canvasContext'][_0x489a35(0x14b)]();}else{this[_0x489a35(0x183)]['beginPath'](),this['canvasContext'][_0x489a35(0x1c0)]=this['lineWidth'],this[_0x489a35(0x183)][_0x489a35(0x196)]=this['color'];for(let _0x2ce3cb=0x0,_0x4dddfd=_0x3f4af3['length'];_0x2ce3cb<_0x4dddfd;_0x2ce3cb++){const _0x3e51af=_0x3f4af3[_0x2ce3cb],_0x2409d9=this['_tomap'](_0x3e51af['lng'],_0x3e51af[_0x489a35(0x1bd)],_0x3e51af),_0x3dfabe=this[_0x489a35(0x151)](_0x3e51af['tlng'],_0x3e51af['tlat'],_0x3e51af);if(!_0x2409d9||!_0x3dfabe)continue;if(_0x401a78&&Math['abs'](_0x2409d9[0x0]-_0x3dfabe[0x0])>=_0x11aac2)continue;this[_0x489a35(0x183)]['moveTo'](_0x2409d9[0x0],_0x2409d9[0x1]),this[_0x489a35(0x183)][_0x489a35(0x1bc)](_0x3dfabe[0x0],_0x3dfabe[0x1]);}this[_0x489a35(0x183)][_0x489a35(0x14b)]();}}['_tomap'](_0xe246ba,_0x551459,_0x366ccb){const _0x3a8251=_0x33f84e,_0xfd7a14=Cesium['Cartesian3']['fromDegrees'](_0xe246ba,_0x551459,this['fixedHeight']),_0x246f9d=this['_map']['scene'];if(_0x246f9d['mode']===Cesium[_0x3a8251(0x1d4)]['SCENE3D']){const _0x184547=new Cesium[(_0x3a8251(0x1ac))](_0x246f9d['globe']['ellipsoid'],_0x246f9d[_0x3a8251(0x12d)][_0x3a8251(0x18f)]),_0xd45b08=_0x184547['isPointVisible'](_0xfd7a14);if(!_0xd45b08)return _0x366ccb['age']=0x0,null;}const _0x3e0e30=Cesium['SceneTransforms'][_0x3a8251(0x1ec)](this[_0x3a8251(0x153)]['scene'],_0xfd7a14);return _0x3e0e30?[_0x3e0e30['x'],_0x3e0e30['y']]:null;}[_0x33f84e(0x12f)](){const _0x27b9f1=_0x33f84e;this['windField']['clear'](),delete this[_0x27b9f1(0x125)];}['initWorker'](){const _0x538602=_0x33f84e;this['worker']=new Worker(this['options'][_0x538602(0x163)]),this[_0x538602(0x163)]['onmessage']=_0x22c524=>{const _0xdd8311=_0x538602;this['_drawLines'](_0x22c524['data']['particles']),this[_0xdd8311(0x136)]=![];},this['windField']={'init':_0x5ba208=>{this['worker']['postMessage']({'type':'init','options':_0x5ba208});},'setOptions':_0x16e817=>{this['worker']['postMessage']({'type':'setOptions','options':_0x16e817});},'setDate':_0x36f897=>{this['worker']['postMessage']({'type':'setDate','data':_0x36f897});},'update':()=>{const _0x56ae3a=_0x538602;if(this['_updateIng2'])return;this[_0x56ae3a(0x136)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this[_0x538602(0x148)]['init'](this['options']);}}mars3d__namespace[_0x33f84e(0x115)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x33f84e(0x1e5)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x33f84e(0x16c)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x33f84e(0x1e7)]=WindUtil,Object[_0x33f84e(0x177)](exports,_0x33f84e(0x18b),{'value':!![]});
}));
