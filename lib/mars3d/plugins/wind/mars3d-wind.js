/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.3
 * 编译日期：2023-04-18 09:45:48
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';var _0x17f290=_0x126e;(function(_0xa428d8,_0x1ef676){var _0x32c98c=_0x126e,_0x1eec8c=_0xa428d8();while(!![]){try{var _0x29a209=-parseInt(_0x32c98c(0x162))/0x1+-parseInt(_0x32c98c(0x112))/0x2*(parseInt(_0x32c98c(0x169))/0x3)+-parseInt(_0x32c98c(0x189))/0x4+parseInt(_0x32c98c(0x135))/0x5+-parseInt(_0x32c98c(0x194))/0x6+parseInt(_0x32c98c(0x1a1))/0x7*(parseInt(_0x32c98c(0xd3))/0x8)+parseInt(_0x32c98c(0x10f))/0x9;if(_0x29a209===_0x1ef676)break;else _0x1eec8c['push'](_0x1eec8c['shift']());}catch(_0x122c89){_0x1eec8c['push'](_0x1eec8c['shift']());}}}(_0x2b35,0x2a8ef));function _0x126e(_0x1982ff,_0x30ebf1){var _0x2b3520=_0x2b35();return _0x126e=function(_0x126eb2,_0x3bc307){_0x126eb2=_0x126eb2-0xa6;var _0x4c30d2=_0x2b3520[_0x126eb2];return _0x4c30d2;},_0x126e(_0x1982ff,_0x30ebf1);}function _interopNamespace(_0x4c9ce8){var _0x30c53a=_0x126e;if(_0x4c9ce8&&_0x4c9ce8[_0x30c53a(0xd6)])return _0x4c9ce8;var _0x20c7d6=Object[_0x30c53a(0xdd)](null);return _0x4c9ce8&&Object['keys'](_0x4c9ce8)['forEach'](function(_0xc23244){var _0x5370d4=_0x30c53a;if(_0xc23244!=='default'){var _0x5b17be=Object['getOwnPropertyDescriptor'](_0x4c9ce8,_0xc23244);Object['defineProperty'](_0x20c7d6,_0xc23244,_0x5b17be[_0x5370d4(0x130)]?_0x5b17be:{'enumerable':!![],'get':function(){return _0x4c9ce8[_0xc23244];}});}}),_0x20c7d6['default']=_0x4c9ce8,_0x20c7d6;}var mars3d__namespace=_interopNamespace(mars3d),Cesium$7=mars3d__namespace['Cesium'];function getU(_0x2e66aa,_0x42da79){var _0x3d3005=_0x126e,_0x160f55=_0x2e66aa*Math[_0x3d3005(0x123)](Cesium$7['Math']['toRadians'](_0x42da79));return _0x160f55;}function getV(_0x502fdb,_0x3ab233){var _0x50ad73=_0x126e,_0x139de3=_0x502fdb*Math[_0x50ad73(0x199)](Cesium$7['Math']['toRadians'](_0x3ab233));return _0x139de3;}function getSpeed(_0x365cab,_0x2719d3){var _0x27330c=_0x126e,_0x2cd544=Math[_0x27330c(0xc7)](Math['pow'](_0x365cab,0x2)+Math['pow'](_0x2719d3,0x2));return _0x2cd544;}function getDirection(_0x3ae1f0,_0x1fb4cf){var _0x120db8=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x1fb4cf,_0x3ae1f0));return _0x120db8+=_0x120db8<0x0?0x168:0x0,_0x120db8;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};function ownKeys(_0x306a3d,_0x83e6ba){var _0x3b3d47=Object['keys'](_0x306a3d);if(Object['getOwnPropertySymbols']){var _0x4f602c=Object['getOwnPropertySymbols'](_0x306a3d);_0x83e6ba&&(_0x4f602c=_0x4f602c['filter'](function(_0x13e193){return Object['getOwnPropertyDescriptor'](_0x306a3d,_0x13e193)['enumerable'];})),_0x3b3d47['push']['apply'](_0x3b3d47,_0x4f602c);}return _0x3b3d47;}function _objectSpread2(_0x3e37db){for(var _0x667888=0x1;_0x667888<arguments['length'];_0x667888++){var _0x489d6c=null!=arguments[_0x667888]?arguments[_0x667888]:{};_0x667888%0x2?ownKeys(Object(_0x489d6c),!0x0)['forEach'](function(_0x355933){_defineProperty(_0x3e37db,_0x355933,_0x489d6c[_0x355933]);}):Object['getOwnPropertyDescriptors']?Object['defineProperties'](_0x3e37db,Object['getOwnPropertyDescriptors'](_0x489d6c)):ownKeys(Object(_0x489d6c))['forEach'](function(_0x57f2fa){var _0x47c53e=_0x126e;Object['defineProperty'](_0x3e37db,_0x57f2fa,Object[_0x47c53e(0x19d)](_0x489d6c,_0x57f2fa));});}return _0x3e37db;}function _classCallCheck(_0xf62bca,_0x7c1391){if(!(_0xf62bca instanceof _0x7c1391))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0xb550e1,_0x8655bd){var _0x12a1a9=_0x126e;for(var _0x23bd77=0x0;_0x23bd77<_0x8655bd['length'];_0x23bd77++){var _0x5dd5cf=_0x8655bd[_0x23bd77];_0x5dd5cf['enumerable']=_0x5dd5cf[_0x12a1a9(0xf6)]||![],_0x5dd5cf['configurable']=!![];if('value'in _0x5dd5cf)_0x5dd5cf['writable']=!![];Object['defineProperty'](_0xb550e1,_0x5dd5cf['key'],_0x5dd5cf);}}function _0x2b35(){var _0x729458=['min','destroy','_tomap','viewerParameters','_map','enumerable','destroyParticlesTextures','randomBetween','getFullscreenQuad','name','LayerUtil','tlat','commandType','constructor','grid','_updateIng2','RGB','viewRectangleToLonLatRange','autoClear','uniformMap','reverseY','isPointVisible','createRawRenderState','isDestroyed','toDegrees','execute','Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function','createCommand','setGeometry','clearCommand','6136929bmaVuP','depthMask','scene','2pMzYoW','particlesTextureSize','TWO_PI','abs','resize','Pass','_drawLines','getDefaultRenderState','all','dropRateBump','lng','createTexture','canvasWindy','createWindTextures','pointerEvents','Draw','createParticlesTextures','cos','RenderState','_calc_speedRate','vdata','ShaderSource','@@iterator','_onMouseDownEvent','createComputingPrimitives','nextTrails','UNSIGNED_BYTE','Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined','commandList','primitives','get','container','speedRate','EventType','mouseUp','1580705OOWvxQ','windData','particleSystem','_mountedHook','animateFrame','depthTest','arrayBufferView','PI_OVER_THREE','fromCssColorString','clear','STATIC_DRAW','mouseHidden','OPAQUE','_canrefresh','vertexArray','zIndex','postProcessingSpeed','updatePosition','keys','ymin','maxAge','addEventListener','off','particlesNumber','createRenderingFramebuffers','particlesTextures','attributeLocations','updateViewerParameters','canvas','FLOAT','visible','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','GeometryAttribute','_setOptionsHook','_onMouseUpEvent','lev','PixelFormat','lonRange','windTextures','rows','Set','getPrototypeOf','setOptions','currentTrails','ellipsoid','316866OAGFcU','Math','_removedHook','mouse_down','getUVByPoint','vmax','construct','998670VbGBoV','BaseLayer','tlng','fragmentShaderSource','Framebuffer','ceil','layer','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','options','beginPath','now','addPrimitives','function','postProcessingPosition','update','particlesRendering','_randomParticle','forEach','style','getOptions','ComputeCommand','Matrix4','camera','EllipsoidalOccluder','nextParticlesPosition','wheel','fadeOpacity','PixelDatatype','_createCanvas','TextureMagnificationFilter','_onMouseMoveEvent','getUVByXY','158148fQkZpP','redraw','lat','_bilinearInterpolation','xmin','__proto__','speedFactor','getContext','mouse_move','getParticles','length','981342wmzTjz','colors','iterator','canvasContext','windField','sin','createRenderingTextures','isInExtent','globeBoundingSphere','getOwnPropertyDescriptor','trails','random','refreshTimer','7osELQn','Sampler','particleHeight','width','max','Color','this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called','PI_OVER_TWO','applyViewerParameters','worker','commandToExecute','none','currentTrailsColor','drawingBufferWidth','destroyObject','height','apply','computeViewRectangle','framebuffers','_pointerEvents','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','context','prototype','test','canvasWidth','call','textures','nextParticlesSpeed','postMessage','removeAll','fixedHeight','getWind','LINEAR','currentParticlesSpeed','_calcUV','particles','mode','Cartesian2','sqrt','push','ymax','color','segmentsColor','object','TextureMinificationFilter','refreshParticles','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','preExecute','rgb(206,255,255)','particlesWind','233176yHdbWr','top','_data','__esModule','_speedRate','outputTexture','particlesComputing','init','clampToLatitudeRange','add','create','pixelSize','show','dimensions','defineProperty','data','BufferUsage','LUMINANCE','udata','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','frameRate','Cesium','blue','xmax','mouseDown','cols','Compute','segmentsDepth','Cartesian3','lon'];_0x2b35=function(){return _0x729458;};return _0x2b35();}function _createClass(_0x1d576b,_0x233e04,_0xc74aef){var _0x1f79e0=_0x126e;if(_0x233e04)_defineProperties(_0x1d576b[_0x1f79e0(0xb7)],_0x233e04);if(_0xc74aef)_defineProperties(_0x1d576b,_0xc74aef);return Object['defineProperty'](_0x1d576b,'prototype',{'writable':![]}),_0x1d576b;}function _defineProperty(_0x20b4aa,_0x1adcc1,_0x24eb8a){return _0x1adcc1 in _0x20b4aa?Object['defineProperty'](_0x20b4aa,_0x1adcc1,{'value':_0x24eb8a,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x20b4aa[_0x1adcc1]=_0x24eb8a,_0x20b4aa;}function _inherits(_0x7e9678,_0x345f22){var _0x3f1e60=_0x126e;if(typeof _0x345f22!==_0x3f1e60(0x175)&&_0x345f22!==null)throw new TypeError(_0x3f1e60(0x10b));_0x7e9678['prototype']=Object['create'](_0x345f22&&_0x345f22[_0x3f1e60(0xb7)],{'constructor':{'value':_0x7e9678,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x7e9678,'prototype',{'writable':![]});if(_0x345f22)_setPrototypeOf(_0x7e9678,_0x345f22);}function _getPrototypeOf(_0x51f46f){return _getPrototypeOf=Object['setPrototypeOf']?Object['getPrototypeOf']:function _0x463ef5(_0x4dc08b){var _0x5c9b54=_0x126e;return _0x4dc08b[_0x5c9b54(0x18e)]||Object[_0x5c9b54(0x15e)](_0x4dc08b);},_getPrototypeOf(_0x51f46f);}function _setPrototypeOf(_0x49c1aa,_0xb392e3){return _setPrototypeOf=Object['setPrototypeOf']||function _0x5ce6be(_0x283a41,_0x494a4c){return _0x283a41['__proto__']=_0x494a4c,_0x283a41;},_setPrototypeOf(_0x49c1aa,_0xb392e3);}function _isNativeReflectConstruct(){var _0x5581de=_0x126e;if(typeof Reflect==='undefined'||!Reflect['construct'])return![];if(Reflect[_0x5581de(0x168)]['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype']['valueOf']['call'](Reflect[_0x5581de(0x168)](Boolean,[],function(){})),!![];}catch(_0x1ffb9e){return![];}}function _assertThisInitialized(_0x44ee46){var _0x1fcadd=_0x126e;if(_0x44ee46===void 0x0)throw new ReferenceError(_0x1fcadd(0xa7));return _0x44ee46;}function _possibleConstructorReturn(_0xdc66dc,_0x4758c0){var _0x58f453=_0x126e;if(_0x4758c0&&(typeof _0x4758c0===_0x58f453(0xcc)||typeof _0x4758c0==='function'))return _0x4758c0;else{if(_0x4758c0!==void 0x0)throw new TypeError(_0x58f453(0x12d));}return _assertThisInitialized(_0xdc66dc);}function _createSuper(_0x3d4e0b){var _0x28a4b6=_isNativeReflectConstruct();return function _0x549b3b(){var _0x224719=_0x126e,_0x40d3e7=_getPrototypeOf(_0x3d4e0b),_0x590640;if(_0x28a4b6){var _0x1f35cf=_getPrototypeOf(this)['constructor'];_0x590640=Reflect[_0x224719(0x168)](_0x40d3e7,arguments,_0x1f35cf);}else _0x590640=_0x40d3e7['apply'](this,arguments);return _possibleConstructorReturn(this,_0x590640);};}function _toConsumableArray(_0x3ff874){return _arrayWithoutHoles(_0x3ff874)||_iterableToArray(_0x3ff874)||_unsupportedIterableToArray(_0x3ff874)||_nonIterableSpread();}function _arrayWithoutHoles(_0x21eeee){if(Array['isArray'](_0x21eeee))return _arrayLikeToArray(_0x21eeee);}function _iterableToArray(_0x5aec5d){var _0x5e99d8=_0x126e;if(typeof Symbol!=='undefined'&&_0x5aec5d[Symbol[_0x5e99d8(0x196)]]!=null||_0x5aec5d[_0x5e99d8(0x128)]!=null)return Array['from'](_0x5aec5d);}function _unsupportedIterableToArray(_0x28ac82,_0x4fbc9b){var _0x4306b2=_0x126e;if(!_0x28ac82)return;if(typeof _0x28ac82==='string')return _arrayLikeToArray(_0x28ac82,_0x4fbc9b);var _0x4c146e=Object['prototype']['toString'][_0x4306b2(0xba)](_0x28ac82)['slice'](0x8,-0x1);if(_0x4c146e==='Object'&&_0x28ac82[_0x4306b2(0xfe)])_0x4c146e=_0x28ac82['constructor'][_0x4306b2(0xfa)];if(_0x4c146e==='Map'||_0x4c146e===_0x4306b2(0x15d))return Array['from'](_0x28ac82);if(_0x4c146e==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/[_0x4306b2(0xb8)](_0x4c146e))return _arrayLikeToArray(_0x28ac82,_0x4fbc9b);}function _arrayLikeToArray(_0x8835d6,_0x407719){var _0x5e0b53=_0x126e;if(_0x407719==null||_0x407719>_0x8835d6[_0x5e0b53(0x193)])_0x407719=_0x8835d6['length'];for(var _0x19e5f1=0x0,_0x14b7ef=new Array(_0x407719);_0x19e5f1<_0x407719;_0x19e5f1++)_0x14b7ef[_0x19e5f1]=_0x8835d6[_0x19e5f1];return _0x14b7ef;}function _nonIterableSpread(){throw new TypeError('Invalid\x20attempt\x20to\x20spread\x20non-iterable\x20instance.\x0aIn\x20order\x20to\x20be\x20iterable,\x20non-array\x20objects\x20must\x20have\x20a\x20[Symbol.iterator]()\x20method.');}var Cesium$6=mars3d__namespace['Cesium'],CustomPrimitive=(function(){var _0x18b466=_0x126e;function _0x51b02e(_0x251693){var _0x1694b3=_0x126e,_0x21570f;_classCallCheck(this,_0x51b02e),this['commandType']=_0x251693[_0x1694b3(0xfd)],this['geometry']=_0x251693['geometry'],this['attributeLocations']=_0x251693[_0x1694b3(0x14f)],this['primitiveType']=_0x251693['primitiveType'],this['uniformMap']=_0x251693['uniformMap'],this['vertexShaderSource']=_0x251693['vertexShaderSource'],this[_0x1694b3(0x16c)]=_0x251693['fragmentShaderSource'],this['rawRenderState']=_0x251693['rawRenderState'],this['framebuffer']=_0x251693['framebuffer'],this['outputTexture']=_0x251693['outputTexture'],this[_0x1694b3(0x103)]=(_0x21570f=_0x251693['autoClear'])!==null&&_0x21570f!==void 0x0?_0x21570f:![],this['preExecute']=_0x251693['preExecute'],this[_0x1694b3(0xdf)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x1694b3(0x141)]}));}return _createClass(_0x51b02e,[{'key':_0x18b466(0x10c),'value':function _0x384b28(_0x376ee3){var _0x21a7fb=_0x18b466;switch(this['commandType']){case _0x21a7fb(0x121):{var _0x573940=Cesium$6['VertexArray']['fromGeometry']({'context':_0x376ee3,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x21a7fb(0xe3)][_0x21a7fb(0x13f)]}),_0x3d9deb=Cesium$6['ShaderProgram']['fromCache']({'context':_0x376ee3,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x17ed69=Cesium$6[_0x21a7fb(0x124)]['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x3d9deb,'vertexArray':_0x573940,'modelMatrix':Cesium$6[_0x21a7fb(0x17e)]['IDENTITY'],'renderState':_0x17ed69,'uniformMap':this[_0x21a7fb(0x104)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x21a7fb(0x117)][_0x21a7fb(0x141)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x21a7fb(0x17d))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}},{'key':_0x18b466(0x10d),'value':function _0x14d408(_0x6cd807,_0x1a3a32){var _0x2638fb=_0x18b466;this['geometry']=_0x1a3a32;var _0x1cb039=Cesium$6['VertexArray']['fromGeometry']({'context':_0x6cd807,'geometry':this['geometry'],'attributeLocations':this[_0x2638fb(0x14f)],'bufferUsage':Cesium$6['BufferUsage'][_0x2638fb(0x13f)]});this['commandToExecute'][_0x2638fb(0x143)]=_0x1cb039;}},{'key':_0x18b466(0x177),'value':function _0x4b7d8c(_0x1c5a61){var _0x1e7ebf=_0x18b466;if(!this['show'])return;if(_0x1c5a61['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x1e7ebf(0xab)]=this['createCommand'](_0x1c5a61['context'])),Cesium$6['defined'](this[_0x1e7ebf(0xd0)])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x1c5a61[_0x1e7ebf(0x12e)][_0x1e7ebf(0xc8)](this['clearCommand']),_0x1c5a61['commandList']['push'](this[_0x1e7ebf(0xab)]);}},{'key':_0x18b466(0x108),'value':function _0x4e4b19(){return![];}},{'key':'destroy','value':function _0x193722(){var _0x3ceb16=_0x18b466;if(this[_0x3ceb16(0x10e)]){var _0xa183c4,_0x5d2d1e;(_0xa183c4=this[_0x3ceb16(0x10e)])!==null&&_0xa183c4!==void 0x0&&_0xa183c4['vertexArray']&&this[_0x3ceb16(0x10e)]['vertexArray'][_0x3ceb16(0xf2)](),(_0x5d2d1e=this['clearCommand'])!==null&&_0x5d2d1e!==void 0x0&&_0x5d2d1e['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this[_0x3ceb16(0x10e)];}return this[_0x3ceb16(0xab)]&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram'][_0x3ceb16(0xf2)](),delete this['commandToExecute']),Cesium$6[_0x3ceb16(0xaf)](this);}}]),_0x51b02e;}()),Cesium$5=mars3d__namespace['Cesium'],Util=(function(){var _0x2cdf90=function _0x5d3d39(){var _0x6f2b73=_0x126e,_0x1a45c7=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x6f2b73(0x155))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x6f2b73(0x155))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x1a45c7;},_0x2113d9=function _0xf01a0(_0x270182,_0x528c2c){var _0x5c2e2f=_0x126e;if(Cesium$5['defined'](_0x528c2c)){var _0x34a084={};_0x34a084[_0x5c2e2f(0x13b)]=_0x528c2c,_0x270182['source']=_0x34a084;}var _0x4ef560=new Cesium$5['Texture'](_0x270182);return _0x4ef560;},_0x94dc0c=function _0x498e6d(_0x5dd4f1,_0x3af5b4,_0x424ce5){var _0x3083f8=_0x126e,_0x332bbc=new Cesium$5[(_0x3083f8(0x16d))]({'context':_0x5dd4f1,'colorTextures':[_0x3af5b4],'depthTexture':_0x424ce5});return _0x332bbc;},_0x540755=function _0xe42eb3(_0x4e50c4){var _0x2b4c8a=_0x126e,_0x3391b7=!![],_0x57b13c=![],_0x18e9e9={'viewport':_0x4e50c4['viewport'],'depthTest':_0x4e50c4[_0x2b4c8a(0x13a)],'depthMask':_0x4e50c4[_0x2b4c8a(0x110)],'blending':_0x4e50c4['blending']},_0x167899=Cesium$5['Appearance'][_0x2b4c8a(0x119)](_0x3391b7,_0x57b13c,_0x18e9e9);return _0x167899;},_0x3a696a=function _0x54f29c(_0x20e595){var _0x3eaa3a=_0x126e,_0x563525={},_0x2aea17=Cesium$5[_0x3eaa3a(0x163)]['mod'](_0x20e595['west'],Cesium$5['Math'][_0x3eaa3a(0x114)]),_0x4d3c25=Cesium$5['Math']['mod'](_0x20e595['east'],Cesium$5['Math']['TWO_PI']),_0x12e7f2=_0x20e595['width'],_0x4edbeb,_0x156142;_0x12e7f2>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x4edbeb=0x0,_0x156142=Cesium$5[_0x3eaa3a(0x163)]['TWO_PI']):_0x4d3c25-_0x2aea17<_0x12e7f2?(_0x4edbeb=_0x2aea17,_0x156142=_0x2aea17+_0x12e7f2):(_0x4edbeb=_0x2aea17,_0x156142=_0x4d3c25);_0x563525['lon']={'min':Cesium$5['Math'][_0x3eaa3a(0x109)](_0x4edbeb),'max':Cesium$5['Math']['toDegrees'](_0x156142)};var _0x3ca572=_0x20e595['south'],_0x17cb7f=_0x20e595['north'],_0x5f0885=_0x20e595['height'],_0x38adad=_0x5f0885>Cesium$5['Math']['PI']/0xc?_0x5f0885/0x2:0x0,_0x2cd3dc=Cesium$5['Math'][_0x3eaa3a(0xdb)](_0x3ca572-_0x38adad),_0x3326d2=Cesium$5[_0x3eaa3a(0x163)]['clampToLatitudeRange'](_0x17cb7f+_0x38adad);return _0x2cd3dc<-Cesium$5['Math'][_0x3eaa3a(0x13c)]&&(_0x2cd3dc=-Cesium$5['Math'][_0x3eaa3a(0xa8)]),_0x3326d2>Cesium$5['Math'][_0x3eaa3a(0x13c)]&&(_0x3326d2=Cesium$5[_0x3eaa3a(0x163)]['PI_OVER_TWO']),_0x563525['lat']={'min':Cesium$5[_0x3eaa3a(0x163)]['toDegrees'](_0x2cd3dc),'max':Cesium$5['Math']['toDegrees'](_0x3326d2)},_0x563525;};return{'getFullscreenQuad':_0x2cdf90,'createTexture':_0x2113d9,'createFramebuffer':_0x94dc0c,'createRawRenderState':_0x540755,'viewRectangleToLonLatRange':_0x3a696a};}()),segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x17f290(0x154),screenDraw_frag=_0x17f290(0xb5),Cesium$4=mars3d__namespace[_0x17f290(0xe8)],ParticlesRendering=(function(){var _0x439e26=_0x17f290;function _0xa652c0(_0x4a7f3b,_0x2e7092,_0x5080c9,_0x57ce0c,_0xea8bfd){var _0x392c88=_0x126e;_classCallCheck(this,_0xa652c0),this[_0x392c88(0x19a)](_0x4a7f3b,_0x2e7092,_0x5080c9[_0x392c88(0x195)]),this['createRenderingFramebuffers'](_0x4a7f3b),this['createRenderingPrimitives'](_0x4a7f3b,_0x5080c9,_0x57ce0c,_0xea8bfd);}return _createClass(_0xa652c0,[{'key':'createRenderingTextures','value':function _0x16af4a(_0x2fff9c,_0x4a281c,_0x5c474b){var _0x4db51e=_0x126e,_0x5a636e={'context':_0x2fff9c,'width':_0x2fff9c['drawingBufferWidth'],'height':_0x2fff9c['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x4db51e(0x184)][_0x4db51e(0x12c)]},_0xde47b4={'context':_0x2fff9c,'width':_0x2fff9c['drawingBufferWidth'],'height':_0x2fff9c['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x4db51e(0x159)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x15a31a=_0x5c474b['length'],_0x5c7ba4=new Float32Array(_0x15a31a*0x3);for(var _0x5700df=0x0;_0x5700df<_0x15a31a;_0x5700df++){var _0x11b9a2=Cesium$4['Color'][_0x4db51e(0x13d)](_0x5c474b[_0x5700df]);_0x5c7ba4[0x3*_0x5700df]=_0x11b9a2['red'],_0x5c7ba4[0x3*_0x5700df+0x1]=_0x11b9a2['green'],_0x5c7ba4[0x3*_0x5700df+0x2]=_0x11b9a2[_0x4db51e(0xe9)];}var _0x3206a7={'context':_0x2fff9c,'width':_0x15a31a,'height':0x1,'pixelFormat':Cesium$4[_0x4db51e(0x159)][_0x4db51e(0x101)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x4db51e(0x1a2))]({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x4db51e(0xc1)],'magnificationFilter':Cesium$4[_0x4db51e(0x186)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x5a636e),'segmentsDepth':Util[_0x4db51e(0x11d)](_0xde47b4),'currentTrailsColor':Util['createTexture'](_0x5a636e),'currentTrailsDepth':Util['createTexture'](_0xde47b4),'nextTrailsColor':Util[_0x4db51e(0x11d)](_0x5a636e),'nextTrailsDepth':Util[_0x4db51e(0x11d)](_0xde47b4),'colorTable':Util['createTexture'](_0x3206a7,_0x5c7ba4)};}},{'key':_0x439e26(0x14d),'value':function _0x117ea0(_0x998dab){var _0x4f8c9d=_0x439e26;this['framebuffers']={'segments':Util['createFramebuffer'](_0x998dab,this[_0x4f8c9d(0xbb)][_0x4f8c9d(0xcb)],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x998dab,this['textures'][_0x4f8c9d(0xad)],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x998dab,this['textures']['nextTrailsColor'],this[_0x4f8c9d(0xbb)]['nextTrailsDepth'])};}},{'key':'createSegmentsGeometry','value':function _0x421246(_0x26a2e7){var _0x320a40=_0x439e26,_0x594795=0x4,_0x169c04=[];for(var _0x5a07a7=0x0;_0x5a07a7<_0x26a2e7['particlesTextureSize'];_0x5a07a7++){for(var _0x236c49=0x0;_0x236c49<_0x26a2e7['particlesTextureSize'];_0x236c49++){for(var _0x3f9585=0x0;_0x3f9585<_0x594795;_0x3f9585++){_0x169c04['push'](_0x5a07a7/_0x26a2e7['particlesTextureSize']),_0x169c04[_0x320a40(0xc8)](_0x236c49/_0x26a2e7[_0x320a40(0x113)]);}}}_0x169c04=new Float32Array(_0x169c04);var _0x28e901=[],_0x28447a=[-0x1,0x1],_0x237019=[-0x1,0x1];for(var _0x1a5dfe=0x0;_0x1a5dfe<_0x26a2e7['maxParticles'];_0x1a5dfe++){for(var _0x5e55a7=0x0;_0x5e55a7<_0x594795/0x2;_0x5e55a7++){for(var _0xe9dbfe=0x0;_0xe9dbfe<_0x594795/0x2;_0xe9dbfe++){_0x28e901['push'](_0x28447a[_0x5e55a7]),_0x28e901['push'](_0x237019[_0xe9dbfe]),_0x28e901[_0x320a40(0xc8)](0x0);}}}_0x28e901=new Float32Array(_0x28e901);var _0x33f596=0x6*_0x26a2e7['maxParticles'],_0xc50696=new Uint32Array(_0x33f596);for(var _0x58179c=0x0,_0x10efc7=0x0,_0xa200e1=0x0;_0x58179c<_0x26a2e7['maxParticles'];_0x58179c++){_0xc50696[_0x10efc7++]=_0xa200e1+0x0,_0xc50696[_0x10efc7++]=_0xa200e1+0x1,_0xc50696[_0x10efc7++]=_0xa200e1+0x2,_0xc50696[_0x10efc7++]=_0xa200e1+0x2,_0xc50696[_0x10efc7++]=_0xa200e1+0x1,_0xc50696[_0x10efc7++]=_0xa200e1+0x3,_0xa200e1+=0x4;}var _0x5b12a8=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x320a40(0x152)],'componentsPerAttribute':0x2,'values':_0x169c04}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x28e901})}),'indices':_0xc50696});return _0x5b12a8;}},{'key':'createRenderingPrimitives','value':function _0x2edd1a(_0x553dc2,_0x4813ff,_0x303860,_0x4d14ae){var _0x3348f0=_0x439e26,_0x34642a=this;this[_0x3348f0(0x12f)]={'segments':new CustomPrimitive({'commandType':_0x3348f0(0x121),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x4813ff),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function _0x4eac69(){var _0x3dbda6=_0x3348f0;return _0x4d14ae[_0x3dbda6(0x14e)]['currentParticlesPosition'];},'postProcessingPosition':function _0x3e78dc(){var _0x37bf29=_0x3348f0;return _0x4d14ae[_0x37bf29(0x14e)]['postProcessingPosition'];},'postProcessingSpeed':function _0x382530(){return _0x4d14ae['particlesTextures']['postProcessingSpeed'];},'colorTable':function _0x1a5559(){var _0x4e98ad=_0x3348f0;return _0x34642a[_0x4e98ad(0xbb)]['colorTable'];},'aspect':function _0x1f5d02(){return _0x553dc2['drawingBufferWidth']/_0x553dc2['drawingBufferHeight'];},'pixelSize':function _0x34df9e(){var _0xeaab6c=_0x3348f0;return _0x303860[_0xeaab6c(0xde)];},'lineWidth':function _0x2637d9(){return _0x4813ff['lineWidth'];},'particleHeight':function _0x162f77(){var _0x71cba0=_0x3348f0;return _0x4813ff[_0x71cba0(0x1a3)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x3348f0(0x107)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x3348f0(0xf9)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function _0xf023fa(){return _0x34642a['textures']['segmentsColor'];},'segmentsDepthTexture':function _0x3de178(){var _0x119e4b=_0x3348f0;return _0x34642a[_0x119e4b(0xbb)][_0x119e4b(0xee)];},'currentTrailsColor':function _0x494ac7(){var _0xd7052=_0x3348f0;return _0x34642a[_0xd7052(0xb3)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function _0x2bfb00(){var _0x127016=_0x3348f0;return _0x34642a['framebuffers'][_0x127016(0x160)]['depthTexture'];},'fadeOpacity':function _0x8b9ac1(){return _0x4813ff['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function _0x22d74c(){var _0x7faeb7=_0x3348f0,_0x45d1f6=_0x34642a[_0x7faeb7(0xb3)][_0x7faeb7(0x160)];_0x34642a['framebuffers']['currentTrails']=_0x34642a['framebuffers']['nextTrails'],_0x34642a[_0x7faeb7(0xb3)]['nextTrails']=_0x45d1f6,_0x34642a['primitives']['trails'][_0x7faeb7(0xab)]['framebuffer']=_0x34642a['framebuffers']['nextTrails'],_0x34642a['primitives'][_0x7faeb7(0x19e)]['clearCommand']['framebuffer']=_0x34642a[_0x7faeb7(0xb3)][_0x7faeb7(0x12b)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function _0x5e955d(){var _0x2e5e58=_0x3348f0;return _0x34642a[_0x2e5e58(0xb3)][_0x2e5e58(0x12b)]['getColorTexture'](0x0);},'trailsDepthTexture':function _0x3b92a3(){return _0x34642a['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}]),_0xa652c0;}()),getWind_frag=_0x17f290(0xcf),updateSpeed_frag=_0x17f290(0xe6),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x17f290(0x170),Cesium$3=mars3d__namespace[_0x17f290(0xe8)],ParticlesComputing=(function(){var _0x1dd005=_0x17f290;function _0x5a4219(_0x40d9c6,_0x3898da,_0x5dcdca,_0x370a1e){var _0x29f378=_0x126e;_classCallCheck(this,_0x5a4219),this['data']=_0x3898da,this['createWindTextures'](_0x40d9c6,_0x3898da),this['createParticlesTextures'](_0x40d9c6,_0x5dcdca,_0x370a1e),this[_0x29f378(0x12a)](_0x3898da,_0x5dcdca,_0x370a1e);}return _createClass(_0x5a4219,[{'key':_0x1dd005(0x11f),'value':function _0xcc3160(_0x125b38,_0x5df7cc){var _0x5ca4f7=_0x1dd005,_0x3397a2={'context':_0x125b38,'width':_0x5df7cc['dimensions'][_0x5ca4f7(0xf0)],'height':_0x5df7cc['dimensions'][_0x5ca4f7(0x18b)]*(_0x5df7cc['dimensions'][_0x5ca4f7(0x158)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x5ca4f7(0xe4)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x3397a2,_0x5df7cc['U']['array']),'V':Util['createTexture'](_0x3397a2,_0x5df7cc['V']['array'])};}},{'key':'createParticlesTextures','value':function _0x3bd1e7(_0x2067b8,_0xab1381,_0x2f0362){var _0xb63835=_0x1dd005,_0x5f44f7={'context':_0x2067b8,'width':_0xab1381[_0xb63835(0x113)],'height':_0xab1381[_0xb63835(0x113)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0xb63835(0x1a2))]({'minificationFilter':Cesium$3[_0xb63835(0xcd)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x383b14=this['randomizeParticles'](_0xab1381['maxParticles'],_0x2f0362),_0x9791be=new Float32Array(0x4*_0xab1381['maxParticles'])['fill'](0x0);this[_0xb63835(0x14e)]={'particlesWind':Util['createTexture'](_0x5f44f7),'currentParticlesPosition':Util['createTexture'](_0x5f44f7,_0x383b14),'nextParticlesPosition':Util['createTexture'](_0x5f44f7,_0x383b14),'currentParticlesSpeed':Util['createTexture'](_0x5f44f7,_0x9791be),'nextParticlesSpeed':Util['createTexture'](_0x5f44f7,_0x9791be),'postProcessingPosition':Util['createTexture'](_0x5f44f7,_0x383b14),'postProcessingSpeed':Util[_0xb63835(0x11d)](_0x5f44f7,_0x9791be)};}},{'key':'randomizeParticles','value':function _0x3bc296(_0x5373fe,_0xfd173e){var _0x3a9784=_0x1dd005,_0x12e5dd=new Float32Array(0x4*_0x5373fe);for(var _0x292ee9=0x0;_0x292ee9<_0x5373fe;_0x292ee9++){_0x12e5dd[0x4*_0x292ee9]=Cesium$3['Math']['randomBetween'](_0xfd173e['lonRange']['x'],_0xfd173e['lonRange']['y']),_0x12e5dd[0x4*_0x292ee9+0x1]=Cesium$3['Math']['randomBetween'](_0xfd173e['latRange']['x'],_0xfd173e['latRange']['y']),_0x12e5dd[0x4*_0x292ee9+0x2]=Cesium$3[_0x3a9784(0x163)][_0x3a9784(0xf8)](this['data'][_0x3a9784(0x158)]['min'],this['data']['lev']['max']),_0x12e5dd[0x4*_0x292ee9+0x3]=0x0;}return _0x12e5dd;}},{'key':_0x1dd005(0xf7),'value':function _0x8808fe(){var _0x2bfdb2=_0x1dd005,_0x2eb4ff=this;Object[_0x2bfdb2(0x147)](this[_0x2bfdb2(0x14e)])['forEach'](function(_0x2f47b0){_0x2eb4ff['particlesTextures'][_0x2f47b0]['destroy']();});}},{'key':'createComputingPrimitives','value':function _0x364be8(_0x12fc46,_0x3a5df4,_0x1348ee){var _0x524b6f=_0x1dd005,_0x1f5551=new Cesium$3['Cartesian3'](_0x12fc46[_0x524b6f(0xe0)][_0x524b6f(0xf0)],_0x12fc46['dimensions']['lat'],_0x12fc46['dimensions'][_0x524b6f(0x158)]),_0x44cfdb=new Cesium$3['Cartesian3'](_0x12fc46['lon']['min'],_0x12fc46['lat']['min'],_0x12fc46['lev']['min']),_0x4845a0=new Cesium$3[(_0x524b6f(0xef))](_0x12fc46[_0x524b6f(0xf0)]['max'],_0x12fc46['lat']['max'],_0x12fc46['lev']['max']),_0x4ce650=new Cesium$3['Cartesian3']((_0x4845a0['x']-_0x44cfdb['x'])/(_0x1f5551['x']-0x1),(_0x4845a0['y']-_0x44cfdb['y'])/(_0x1f5551['y']-0x1),_0x1f5551['z']>0x1?(_0x4845a0['z']-_0x44cfdb['z'])/(_0x1f5551['z']-0x1):0x1),_0x41b724=new Cesium$3['Cartesian2'](_0x12fc46['U'][_0x524b6f(0xf1)],_0x12fc46['U']['max']),_0x59d393=new Cesium$3[(_0x524b6f(0xc6))](_0x12fc46['V']['min'],_0x12fc46['V']['max']),_0x4d777e=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function _0x518d38(){return _0x4d777e['windTextures']['U'];},'V':function _0x2e5fa6(){var _0x572ef4=_0x524b6f;return _0x4d777e[_0x572ef4(0x15b)]['V'];},'currentParticlesPosition':function _0x1177ac(){return _0x4d777e['particlesTextures']['currentParticlesPosition'];},'dimension':function _0x89b140(){return _0x1f5551;},'minimum':function _0x187835(){return _0x44cfdb;},'maximum':function _0x2ff5cb(){return _0x4845a0;},'interval':function _0x526526(){return _0x4ce650;}},'fragmentShaderSource':new Cesium$3[(_0x524b6f(0x127))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x524b6f(0xd2)],'preExecute':function _0x4bdb37(){var _0x4e27d6=_0x524b6f;_0x4d777e[_0x4e27d6(0x12f)][_0x4e27d6(0xc0)]['commandToExecute']['outputTexture']=_0x4d777e[_0x4e27d6(0x14e)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function _0x355352(){return _0x4d777e['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function _0x4c9c12(){return _0x4d777e['particlesTextures']['particlesWind'];},'uSpeedRange':function _0x56bd3b(){return _0x41b724;},'vSpeedRange':function _0x5524a6(){return _0x59d393;},'pixelSize':function _0x304fa9(){return _0x1348ee['pixelSize'];},'speedFactor':function _0x171fd8(){var _0x51b92a=_0x524b6f;return _0x3a5df4[_0x51b92a(0x18f)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x524b6f(0x14e)]['nextParticlesSpeed'],'preExecute':function _0xed1ba4(){var _0x203d30=_0x524b6f,_0x77f819=_0x4d777e['particlesTextures'][_0x203d30(0xc2)];_0x4d777e[_0x203d30(0x14e)]['currentParticlesSpeed']=_0x4d777e['particlesTextures']['postProcessingSpeed'],_0x4d777e['particlesTextures'][_0x203d30(0x145)]=_0x77f819,_0x4d777e['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x4d777e[_0x203d30(0x14e)][_0x203d30(0xbc)];}}),'updatePosition':new CustomPrimitive({'commandType':_0x524b6f(0xed),'uniformMap':{'currentParticlesPosition':function _0x11afa0(){return _0x4d777e['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function _0x432364(){var _0x1f808e=_0x524b6f;return _0x4d777e[_0x1f808e(0x14e)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x524b6f(0x14e)]['nextParticlesPosition'],'preExecute':function _0x5f29c4(){var _0x53fd76=_0x524b6f,_0x201d87=_0x4d777e['particlesTextures']['currentParticlesPosition'];_0x4d777e[_0x53fd76(0x14e)]['currentParticlesPosition']=_0x4d777e['particlesTextures']['postProcessingPosition'],_0x4d777e[_0x53fd76(0x14e)]['postProcessingPosition']=_0x201d87,_0x4d777e['primitives']['updatePosition'][_0x53fd76(0xab)]['outputTexture']=_0x4d777e['particlesTextures'][_0x53fd76(0x181)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function _0x3df9c8(){var _0x465c8a=_0x524b6f;return _0x4d777e[_0x465c8a(0x14e)]['nextParticlesPosition'];},'nextParticlesSpeed':function _0x1a15a3(){var _0x719658=_0x524b6f;return _0x4d777e[_0x719658(0x14e)]['nextParticlesSpeed'];},'lonRange':function _0x3e31c9(){return _0x1348ee['lonRange'];},'latRange':function _0x53da50(){return _0x1348ee['latRange'];},'randomCoefficient':function _0x4903a1(){var _0x4e6d4c=Math['random']();return _0x4e6d4c;},'dropRate':function _0x10b741(){return _0x3a5df4['dropRate'];},'dropRateBump':function _0x2b4c10(){var _0x57126c=_0x524b6f;return _0x3a5df4[_0x57126c(0x11b)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function _0x3d268d(){var _0x586568=_0x524b6f;_0x4d777e[_0x586568(0x12f)]['postProcessingPosition']['commandToExecute'][_0x586568(0xd8)]=_0x4d777e['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function _0x9cf76a(){var _0x107dc8=_0x524b6f;return _0x4d777e['particlesTextures'][_0x107dc8(0x176)];},'nextParticlesSpeed':function _0x85d501(){return _0x4d777e['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x524b6f(0x127))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function _0x1ac804(){var _0x4eb9ad=_0x524b6f;_0x4d777e[_0x4eb9ad(0x12f)]['postProcessingSpeed'][_0x4eb9ad(0xab)]['outputTexture']=_0x4d777e['particlesTextures']['postProcessingSpeed'];}})};}}]),_0x5a4219;}()),Cesium$2=mars3d__namespace['Cesium'],ParticleSystem=(function(){var _0x455c05=_0x17f290;function _0x2966c1(_0x5e511c,_0x3a1373,_0x6e919e,_0x35eeb8){var _0x1f6e31=_0x126e;_classCallCheck(this,_0x2966c1),this[_0x1f6e31(0xb6)]=_0x5e511c,_0x3a1373=_objectSpread2({},_0x3a1373);if(_0x3a1373['udata']&&_0x3a1373[_0x1f6e31(0x126)]){var _0x67b60,_0x2f3d35,_0x334f1c,_0xc6f79a,_0x4de3d9,_0x36206b;_0x3a1373[_0x1f6e31(0xe0)]={},_0x3a1373['dimensions']['lon']=_0x3a1373['cols'],_0x3a1373['dimensions']['lat']=_0x3a1373['rows'],_0x3a1373[_0x1f6e31(0xe0)][_0x1f6e31(0x158)]=_0x3a1373[_0x1f6e31(0x158)]||0x1,_0x3a1373[_0x1f6e31(0xf0)]={},_0x3a1373['lon']['min']=_0x3a1373['xmin'],_0x3a1373['lon']['max']=_0x3a1373['xmax'],_0x3a1373[_0x1f6e31(0x18b)]={},_0x3a1373['lat']['min']=_0x3a1373[_0x1f6e31(0x148)],_0x3a1373[_0x1f6e31(0x18b)][_0x1f6e31(0x1a5)]=_0x3a1373['ymax'],_0x3a1373[_0x1f6e31(0x158)]={},_0x3a1373['lev']['min']=(_0x67b60=_0x3a1373['levmin'])!==null&&_0x67b60!==void 0x0?_0x67b60:0x1,_0x3a1373[_0x1f6e31(0x158)]['max']=(_0x2f3d35=_0x3a1373['levmax'])!==null&&_0x2f3d35!==void 0x0?_0x2f3d35:0x1,_0x3a1373['U']={},_0x3a1373['U']['array']=new Float32Array(_0x3a1373[_0x1f6e31(0xe5)]),_0x3a1373['U']['min']=(_0x334f1c=_0x3a1373['umin'])!==null&&_0x334f1c!==void 0x0?_0x334f1c:Math['min']['apply'](Math,_toConsumableArray(_0x3a1373['udata'])),_0x3a1373['U'][_0x1f6e31(0x1a5)]=(_0xc6f79a=_0x3a1373['umax'])!==null&&_0xc6f79a!==void 0x0?_0xc6f79a:Math['max'][_0x1f6e31(0xb1)](Math,_toConsumableArray(_0x3a1373['udata'])),_0x3a1373['V']={},_0x3a1373['V']['array']=new Float32Array(_0x3a1373[_0x1f6e31(0x126)]),_0x3a1373['V']['min']=(_0x4de3d9=_0x3a1373['vmin'])!==null&&_0x4de3d9!==void 0x0?_0x4de3d9:Math['min']['apply'](Math,_toConsumableArray(_0x3a1373['vdata'])),_0x3a1373['V'][_0x1f6e31(0x1a5)]=(_0x36206b=_0x3a1373[_0x1f6e31(0x167)])!==null&&_0x36206b!==void 0x0?_0x36206b:Math[_0x1f6e31(0x1a5)]['apply'](Math,_toConsumableArray(_0x3a1373['vdata']));}this[_0x1f6e31(0xe2)]=_0x3a1373,this['options']=_0x6e919e,this[_0x1f6e31(0xf4)]=_0x35eeb8,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x1f6e31(0xf4)]),this[_0x1f6e31(0x178)]=new ParticlesRendering(this['context'],this['data'],this[_0x1f6e31(0x171)],this[_0x1f6e31(0xf4)],this['particlesComputing']);}return _createClass(_0x2966c1,[{'key':'canvasResize','value':function _0x517969(_0x391251){var _0x56bf09=_0x126e,_0xab9094=this;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x56bf09(0xd9)]['windTextures'])['forEach'](function(_0xee5097){var _0x441bde=_0x56bf09;_0xab9094['particlesComputing'][_0x441bde(0x15b)][_0xee5097]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this[_0x56bf09(0x178)][_0x56bf09(0xb3)])[_0x56bf09(0x17a)](function(_0x1bbead){var _0x4cc546=_0x56bf09;_0xab9094['particlesRendering']['framebuffers'][_0x1bbead][_0x4cc546(0xf2)]();}),this['context']=_0x391251,this[_0x56bf09(0xd9)]=new ParticlesComputing(this[_0x56bf09(0xb6)],this[_0x56bf09(0xe2)],this['options'],this[_0x56bf09(0xf4)]),this['particlesRendering']=new ParticlesRendering(this[_0x56bf09(0xb6)],this[_0x56bf09(0xe2)],this[_0x56bf09(0x171)],this['viewerParameters'],this['particlesComputing']);}},{'key':'clearFramebuffers','value':function _0x2ebc59(){var _0x4ad845=_0x126e,_0x4127c1=this,_0x1a8936=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x4ad845(0xa6))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x4ad845(0x147)](this['particlesRendering']['framebuffers'])['forEach'](function(_0x567f08){var _0x4dfbfd=_0x4ad845;_0x1a8936['framebuffer']=_0x4127c1['particlesRendering'][_0x4dfbfd(0xb3)][_0x567f08],_0x1a8936[_0x4dfbfd(0x10a)](_0x4127c1['context']);});}},{'key':_0x455c05(0xce),'value':function _0x53e2d6(_0x49c085){var _0x4c7794=_0x455c05;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x4c7794(0xd9)][_0x4c7794(0x122)](this['context'],this['options'],this[_0x4c7794(0xf4)]);if(_0x49c085){var _0x406349=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x406349;var _0x1719d4=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x406349,'attributeLocations':this[_0x4c7794(0x178)][_0x4c7794(0x12f)]['segments'][_0x4c7794(0x14f)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this['particlesRendering'][_0x4c7794(0x12f)]['segments'][_0x4c7794(0xab)]['vertexArray']=_0x1719d4;}}},{'key':'setOptions','value':function _0x135622(_0x503cb7){var _0x371cf8=this,_0x5bc9da=![];this['options']['maxParticles']!==_0x503cb7['maxParticles']&&(_0x5bc9da=!![]),Object['keys'](_0x503cb7)['forEach'](function(_0x952121){_0x371cf8['options'][_0x952121]=_0x503cb7[_0x952121];}),this['refreshParticles'](_0x5bc9da);}},{'key':_0x455c05(0xa9),'value':function _0x2a953d(_0x3b1357){var _0x3d1586=_0x455c05,_0x5cae20=this;Object[_0x3d1586(0x147)](_0x3b1357)['forEach'](function(_0x1ba945){_0x5cae20['viewerParameters'][_0x1ba945]=_0x3b1357[_0x1ba945];}),this['refreshParticles'](![]);}},{'key':_0x455c05(0xf2),'value':function _0x5a725c(){var _0x2f9dc0=_0x455c05,_0x42d1d4=this;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x2f9dc0(0xf7)](),Object['keys'](this['particlesComputing'][_0x2f9dc0(0x15b)])['forEach'](function(_0x455f5e){_0x42d1d4['particlesComputing']['windTextures'][_0x455f5e]['destroy']();}),this[_0x2f9dc0(0x178)]['textures']['colorTable']['destroy'](),Object[_0x2f9dc0(0x147)](this[_0x2f9dc0(0x178)]['framebuffers'])['forEach'](function(_0xf1c499){var _0x59da06=_0x2f9dc0;_0x42d1d4[_0x59da06(0x178)][_0x59da06(0xb3)][_0xf1c499][_0x59da06(0xf2)]();});for(var _0x513962 in this){delete this[_0x513962];}}}]),_0x2966c1;}()),Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x17f290(0xd1)]},WindLayer=function(_0x37048b){var _0x4f0420=_0x17f290;_inherits(_0x34eed1,_0x37048b);var _0x581452=_createSuper(_0x34eed1);function _0x34eed1(){var _0x594e19=_0x126e,_0x19eb7e,_0x434bc5=arguments[_0x594e19(0x193)]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x34eed1),_0x434bc5=_objectSpread2(_objectSpread2({},DEF_OPTIONS),_0x434bc5),_0x19eb7e=_0x581452[_0x594e19(0xba)](this,_0x434bc5),_0x19eb7e['_setOptionsHook'](_0x434bc5),_0x19eb7e;}return _createClass(_0x34eed1,[{'key':'layer','get':function _0x33bd20(){return this['primitives'];}},{'key':_0x4f0420(0xe2),'get':function _0x42df77(){var _0xc2f758=_0x4f0420;return this[_0xc2f758(0xd5)];},'set':function _0x569177(_0x96ae0){this['setData'](_0x96ae0);}},{'key':'colors','get':function _0xc16d55(){var _0x3fa25e=_0x4f0420;return this[_0x3fa25e(0x171)]['colors'];},'set':function _0x51d786(_0x1d6ab0){var _0x12da59=_0x4f0420;this[_0x12da59(0x171)]['colors']=_0x1d6ab0,this['particleSystem']&&this['particleSystem'][_0x12da59(0x15f)]({'colors':_0x1d6ab0}),this['resize']();}},{'key':_0x4f0420(0x138),'value':function _0x80545a(){}},{'key':'_addedHook','value':function _0x466b7a(){var _0x44f773=_0x4f0420;this[_0x44f773(0x111)]=this[_0x44f773(0xf5)][_0x44f773(0x111)],this['camera']=this[_0x44f773(0xf5)][_0x44f773(0x17f)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x44f773(0xc6))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x44f773(0x19c)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x44f773(0x150)](),window['addEventListener'](_0x44f773(0x116),this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x44f773(0x191)]=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x44f773(0xeb)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x44f773(0x134)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace[_0x44f773(0x133)]['mouseMove'],this[_0x44f773(0x187)],this),this['_data']&&this['setData'](this[_0x44f773(0xd5)]);}},{'key':_0x4f0420(0x164),'value':function _0x91b3b6(){var _0x58ffa4=_0x4f0420;window['removeEventListener']('resize',this['resize']),this[_0x58ffa4(0xf5)]['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x58ffa4(0x182)],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x58ffa4(0x133)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x58ffa4(0x14b)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this[_0x58ffa4(0x12f)]);}},{'key':'resize','value':function _0x12965a(){var _0x503d14=_0x4f0420;if(!this[_0x503d14(0xdf)]||!this[_0x503d14(0x137)])return;this['primitives']['show']=![],this[_0x503d14(0x12f)][_0x503d14(0xbe)](),this['_map']['once'](mars3d__namespace[_0x503d14(0x133)]['preRender'],this['_onMap_preRenderEvent'],this);}},{'key':'_onMap_preRenderEvent','value':function _0x2d024d(_0x30bc07){var _0x1e01b5=_0x4f0420;this['particleSystem']['canvasResize'](this['scene'][_0x1e01b5(0xb6)]),this['addPrimitives'](),this[_0x1e01b5(0x12f)]['show']=!![];}},{'key':'_onMapWhellEvent','value':function _0x475eed(_0xdc9439){var _0x29d654=_0x4f0420,_0x5fc420=this;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x29d654(0x1a0)]=setTimeout(function(){var _0x12a938=_0x29d654;if(!_0x5fc420[_0x12a938(0xdf)])return;_0x5fc420[_0x12a938(0x18a)]();},0xc8);}},{'key':'_onMouseDownEvent','value':function _0x554c3a(_0x3cacbc){this['mouse_down']=!![];}},{'key':'_onMouseMoveEvent','value':function _0x5009d2(_0x3bfaeb){var _0x1eaa07=_0x4f0420;if(!this['show']||!this[_0x1eaa07(0x137)])return;this['mouse_down']&&(this[_0x1eaa07(0x12f)]['show']=![],this['mouse_move']=!![]);}},{'key':'_onMouseUpEvent','value':function _0x26295c(_0x54426d){var _0x31c5d8=_0x4f0420;if(!this[_0x31c5d8(0xdf)]||!this[_0x31c5d8(0x137)])return;this[_0x31c5d8(0x165)]&&this['mouse_move']&&this[_0x31c5d8(0x18a)](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x31c5d8(0x191)]=![];}},{'key':'redraw','value':function _0x388669(){var _0x3a00cf=_0x4f0420;if(!this['_map']||!this[_0x3a00cf(0xdf)])return;this['updateViewerParameters'](),this[_0x3a00cf(0x137)][_0x3a00cf(0xa9)](this['viewerParameters']),this['primitives']['show']=!![];}},{'key':'setData','value':function _0x5f4860(_0xc04c71){var _0x29ba59=_0x4f0420;this['_data']=_0xc04c71,this['particleSystem']&&this[_0x29ba59(0x137)][_0x29ba59(0xf2)](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0xc04c71,this['getOptions'](),this[_0x29ba59(0xf4)]),this['addPrimitives']();}},{'key':_0x4f0420(0x156),'value':function _0x3677d0(_0x5474e9,_0x96300d){if(_0x5474e9)for(var _0x549918 in _0x5474e9){this[_0x549918]=_0x5474e9[_0x549918];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}},{'key':_0x4f0420(0x17c),'value':function _0x4cf46c(){var _0x1faff8=_0x4f0420,_0x183435=Math[_0x1faff8(0x16e)](Math[_0x1faff8(0xc7)](this[_0x1faff8(0x14c)]));return this['particlesNumber']=_0x183435*_0x183435,{'particlesTextureSize':_0x183435,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x1faff8(0x183)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}},{'key':_0x4f0420(0x174),'value':function _0x13bb6e(){var _0x30d6f8=_0x4f0420;this['primitives'][_0x30d6f8(0xdc)](this['particleSystem']['particlesComputing']['primitives']['getWind']),this[_0x30d6f8(0x12f)]['add'](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this[_0x30d6f8(0x12f)]['add'](this['particleSystem'][_0x30d6f8(0xd9)]['primitives'][_0x30d6f8(0x146)]),this[_0x30d6f8(0x12f)]['add'](this['particleSystem']['particlesComputing'][_0x30d6f8(0x12f)][_0x30d6f8(0x176)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x30d6f8(0x145)]),this[_0x30d6f8(0x12f)]['add'](this['particleSystem']['particlesRendering'][_0x30d6f8(0x12f)]['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives']['add'](this['particleSystem'][_0x30d6f8(0x178)]['primitives']['screen']);}},{'key':_0x4f0420(0x150),'value':function _0x297708(){var _0x3ba283=_0x4f0420,_0x1e5493=this[_0x3ba283(0x17f)][_0x3ba283(0xb2)](this['scene']['globe'][_0x3ba283(0x161)]);if(!_0x1e5493){var _0x83d8df=this['_map']['getExtent']();_0x1e5493=Cesium$1['Rectangle']['fromDegrees'](_0x83d8df['xmin'],_0x83d8df['ymin'],_0x83d8df['xmax'],_0x83d8df['ymax']);}var _0x374a21=Util[_0x3ba283(0x102)](_0x1e5493);this[_0x3ba283(0xf4)][_0x3ba283(0x15a)]['x']=_0x374a21[_0x3ba283(0xf0)][_0x3ba283(0xf1)],this['viewerParameters'][_0x3ba283(0x15a)]['y']=_0x374a21['lon']['max'],this[_0x3ba283(0xf4)]['latRange']['x']=_0x374a21[_0x3ba283(0x18b)]['min'],this['viewerParameters']['latRange']['y']=_0x374a21['lat']['max'];var _0x37edf3=this[_0x3ba283(0x17f)]['getPixelSize'](this['globeBoundingSphere'],this['scene'][_0x3ba283(0xae)],this['scene']['drawingBufferHeight']);_0x37edf3>0x0&&(this['viewerParameters']['pixelSize']=_0x37edf3);}}]),_0x34eed1;}(BaseLayer$1);mars3d__namespace[_0x17f290(0xfb)]['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;var CanvasParticle=(function(){var _0x566d1d=_0x17f290;function _0x2fac7c(){var _0x1c99e2=_0x126e;_classCallCheck(this,_0x2fac7c),this['lng']=null,this['lat']=null,this[_0x1c99e2(0x16b)]=null,this['tlat']=null,this['age']=null;}return _createClass(_0x2fac7c,[{'key':_0x566d1d(0xf2),'value':function _0x552d61(){for(var _0x15941e in this){delete this[_0x15941e];}}}]),_0x2fac7c;}()),CanvasWindField=(function(){var _0xa09316=_0x17f290;function _0x2a256d(_0x2606aa){_classCallCheck(this,_0x2a256d),this['setOptions'](_0x2606aa);}return _createClass(_0x2a256d,[{'key':'speedRate','get':function _0x35326c(){var _0x29e109=_0x126e;return this[_0x29e109(0xd7)];},'set':function _0x57124b(_0x425c75){var _0x125821=_0x126e;this['_speedRate']=(0x64-(_0x425c75>0x63?0x63:_0x425c75))*0x64,this[_0x125821(0x125)]=[(this['xmax']-this[_0x125821(0x18d)])/this[_0x125821(0xd7)],(this['ymax']-this[_0x125821(0x148)])/this['_speedRate']];}},{'key':'maxAge','get':function _0x348bbc(){return this['_maxAge'];},'set':function _0x363e27(_0xfd158c){this['_maxAge']=_0xfd158c;}},{'key':_0xa09316(0x15f),'value':function _0x27e53e(_0x167dc1){var _0x21663f=_0xa09316;this['options']=_0x167dc1,this['maxAge']=_0x167dc1['maxAge']||0x78,this['speedRate']=_0x167dc1['speedRate']||0x32,this['particles']=[];var _0x25464e=_0x167dc1['particlesNumber']||0x1000;for(var _0x495c31=0x0;_0x495c31<_0x25464e;_0x495c31++){var _0x4d5c88=this['_randomParticle'](new CanvasParticle());this[_0x21663f(0xc4)][_0x21663f(0xc8)](_0x4d5c88);}}},{'key':'setDate','value':function _0x633164(_0x230ca4){var _0x499c9a=_0xa09316;this['rows']=_0x230ca4['rows'],this['cols']=_0x230ca4['cols'],this['xmin']=_0x230ca4['xmin'],this[_0x499c9a(0xea)]=_0x230ca4['xmax'],this['ymin']=_0x230ca4['ymin'],this['ymax']=_0x230ca4['ymax'],this['grid']=[];var _0x50b349=_0x230ca4[_0x499c9a(0xe5)],_0x49fd1d=_0x230ca4[_0x499c9a(0x126)],_0x1d4d80=![];_0x50b349['length']===this[_0x499c9a(0x15c)]&&_0x50b349[0x0]['length']===this['cols']&&(_0x1d4d80=!![]);var _0x13e892=0x0,_0x43c5fc=null,_0x52d84f=null;for(var _0x2f4276=0x0;_0x2f4276<this['rows'];_0x2f4276++){_0x43c5fc=[];for(var _0x131e2b=0x0;_0x131e2b<this['cols'];_0x131e2b++,_0x13e892++){_0x1d4d80?_0x52d84f=this['_calcUV'](_0x50b349[_0x2f4276][_0x131e2b],_0x49fd1d[_0x2f4276][_0x131e2b]):_0x52d84f=this['_calcUV'](_0x50b349[_0x13e892],_0x49fd1d[_0x13e892]),_0x43c5fc['push'](_0x52d84f);}this[_0x499c9a(0xff)][_0x499c9a(0xc8)](_0x43c5fc);}this[_0x499c9a(0x171)][_0x499c9a(0x105)]&&this[_0x499c9a(0xff)]['reverse']();}},{'key':_0xa09316(0x13e),'value':function _0x3e2ef0(){var _0x4f1080=_0xa09316;delete this[_0x4f1080(0x15c)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x4f1080(0x148)],delete this[_0x4f1080(0xc9)],delete this[_0x4f1080(0xff)],delete this['particles'];}},{'key':'toGridXY','value':function _0x5dd30d(_0x535f03,_0x2a1bab){var _0x315eda=_0xa09316,_0x2a2a6f=(_0x535f03-this[_0x315eda(0x18d)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x2958f1=(this['ymax']-_0x2a1bab)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x2a2a6f,_0x2958f1];}},{'key':'getUVByXY','value':function _0x2a9e9c(_0x353d3a,_0x4d800b){var _0x5c619a=_0xa09316;if(_0x353d3a<0x0||_0x353d3a>=this[_0x5c619a(0xec)]||_0x4d800b>=this['rows'])return[0x0,0x0,0x0];var _0x4453dc=Math['floor'](_0x353d3a),_0x364606=Math['floor'](_0x4d800b);if(_0x4453dc===_0x353d3a&&_0x364606===_0x4d800b)return this[_0x5c619a(0xff)][_0x4d800b][_0x353d3a];var _0x5955d9=_0x4453dc+0x1,_0x37fa1e=_0x364606+0x1,_0x2a4cae=this[_0x5c619a(0x188)](_0x4453dc,_0x364606),_0x530ad3=this['getUVByXY'](_0x5955d9,_0x364606),_0x2ed0f4=this['getUVByXY'](_0x4453dc,_0x37fa1e),_0x353648=this['getUVByXY'](_0x5955d9,_0x37fa1e),_0x5b5b12=null;try{_0x5b5b12=this['_bilinearInterpolation'](_0x353d3a-_0x4453dc,_0x4d800b-_0x364606,_0x2a4cae,_0x530ad3,_0x2ed0f4,_0x353648);}catch(_0x4498eb){console['log'](_0x353d3a,_0x4d800b);}return _0x5b5b12;}},{'key':_0xa09316(0x18c),'value':function _0x52c321(_0x410903,_0x4004a7,_0x524a20,_0x19f528,_0x6e1c81,_0x352bfb){var _0x2741dd=_0xa09316,_0x385544=0x1-_0x410903,_0x108148=0x1-_0x4004a7,_0x2f083d=_0x385544*_0x108148,_0x18501f=_0x410903*_0x108148,_0xa17213=_0x385544*_0x4004a7,_0x4a20f4=_0x410903*_0x4004a7,_0x3c8488=_0x524a20[0x0]*_0x2f083d+_0x19f528[0x0]*_0x18501f+_0x6e1c81[0x0]*_0xa17213+_0x352bfb[0x0]*_0x4a20f4,_0x4ee130=_0x524a20[0x1]*_0x2f083d+_0x19f528[0x1]*_0x18501f+_0x6e1c81[0x1]*_0xa17213+_0x352bfb[0x1]*_0x4a20f4;return this[_0x2741dd(0xc3)](_0x3c8488,_0x4ee130);}},{'key':'_calcUV','value':function _0x5ae313(_0x56cfb5,_0x1972a3){return[+_0x56cfb5,+_0x1972a3,Math['sqrt'](_0x56cfb5*_0x56cfb5+_0x1972a3*_0x1972a3)];}},{'key':'getUVByPoint','value':function _0x55823b(_0x45d080,_0x6d6559){if(!this['isInExtent'](_0x45d080,_0x6d6559))return null;var _0x2435d2=this['toGridXY'](_0x45d080,_0x6d6559),_0x17de5e=this['getUVByXY'](_0x2435d2[0x0],_0x2435d2[0x1]);return _0x17de5e;}},{'key':_0xa09316(0x19b),'value':function _0x40acbc(_0xb8013e,_0x1e55a5){var _0x561a0e=_0xa09316;return _0xb8013e>=this[_0x561a0e(0x18d)]&&_0xb8013e<=this[_0x561a0e(0xea)]&&_0x1e55a5>=this['ymin']&&_0x1e55a5<=this[_0x561a0e(0xc9)]?!![]:![];}},{'key':'getRandomLatLng','value':function _0x5a1853(){var _0x629837=_0xa09316,_0x1ab131=fRandomByfloat(this['xmin'],this['xmax']),_0x77fb59=fRandomByfloat(this['ymin'],this[_0x629837(0xc9)]);return{'lat':_0x77fb59,'lng':_0x1ab131};}},{'key':_0xa09316(0x192),'value':function _0x232936(){var _0x78bbc0=_0xa09316,_0x42d4e3,_0x5ec56f,_0x13d70c;for(var _0xc70ae9=0x0,_0x5ddccf=this[_0x78bbc0(0xc4)][_0x78bbc0(0x193)];_0xc70ae9<_0x5ddccf;_0xc70ae9++){var _0x54674a=this[_0x78bbc0(0xc4)][_0xc70ae9];_0x54674a['age']<=0x0&&(_0x54674a=this[_0x78bbc0(0x179)](_0x54674a));if(_0x54674a['age']>0x0){var _0x26fecf=_0x54674a['tlng'],_0x1db13f=_0x54674a['tlat'];_0x13d70c=this[_0x78bbc0(0x166)](_0x26fecf,_0x1db13f),_0x13d70c?(_0x42d4e3=_0x26fecf+this['_calc_speedRate'][0x0]*_0x13d70c[0x0],_0x5ec56f=_0x1db13f+this['_calc_speedRate'][0x1]*_0x13d70c[0x1],_0x54674a['lng']=_0x26fecf,_0x54674a['lat']=_0x1db13f,_0x54674a[_0x78bbc0(0x16b)]=_0x42d4e3,_0x54674a[_0x78bbc0(0xfc)]=_0x5ec56f,_0x54674a['age']--):_0x54674a['age']=0x0;}}return this['particles'];}},{'key':'_randomParticle','value':function _0x32c1f4(_0x11e04d){var _0x27738c=_0xa09316,_0x214711,_0x1f4ccb;for(var _0x5dc9b3=0x0;_0x5dc9b3<0x1e;_0x5dc9b3++){_0x214711=this['getRandomLatLng'](),_0x1f4ccb=this['getUVByPoint'](_0x214711['lng'],_0x214711['lat']);if(_0x1f4ccb&&_0x1f4ccb[0x2]>0x0)break;}if(!_0x1f4ccb)return _0x11e04d;var _0x23e608=_0x214711['lng']+this[_0x27738c(0x125)][0x0]*_0x1f4ccb[0x0],_0x5e7e58=_0x214711['lat']+this[_0x27738c(0x125)][0x1]*_0x1f4ccb[0x1];return _0x11e04d['lng']=_0x214711[_0x27738c(0x11c)],_0x11e04d['lat']=_0x214711['lat'],_0x11e04d['tlng']=_0x23e608,_0x11e04d['tlat']=_0x5e7e58,_0x11e04d['age']=Math['round'](Math[_0x27738c(0x19f)]()*this['maxAge']),_0x11e04d;}},{'key':'destroy','value':function _0x36d900(){for(var _0x449421 in this){delete this[_0x449421];}}}]),_0x2a256d;}());function fRandomByfloat(_0x2f34ee,_0x34662e){var _0x2be134=_0x17f290;return _0x2f34ee+Math[_0x2be134(0x19f)]()*(_0x34662e-_0x2f34ee);}var Cesium=mars3d__namespace[_0x17f290(0xe8)],BaseLayer=mars3d__namespace['layer'][_0x17f290(0x16a)],CanvasWindLayer=function(_0x50954e){var _0x5c46f6=_0x17f290;_inherits(_0x2d13a7,_0x50954e);var _0xb561eb=_createSuper(_0x2d13a7);function _0x2d13a7(){var _0x5a6a2e=_0x126e,_0x5b72f3,_0xb251f6=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x2d13a7),_0x5b72f3=_0xb561eb[_0x5a6a2e(0xba)](this,_0xb251f6),_0x5b72f3['_setOptionsHook'](_0xb251f6),_0x5b72f3['canvas']=null,_0x5b72f3;}return _createClass(_0x2d13a7,[{'key':'_setOptionsHook','value':function _0x1c435a(_0x331402,_0x524e31){var _0xf6c2b4=_0x126e,_0x23ece0,_0x30a5c6,_0x37cc81;this['frameTime']=0x3e8/(_0x331402[_0xf6c2b4(0xe7)]||0xa),this[_0xf6c2b4(0xb4)]=(_0x23ece0=this[_0xf6c2b4(0x171)]['pointerEvents'])!==null&&_0x23ece0!==void 0x0?_0x23ece0:![],this['color']=_0x331402[_0xf6c2b4(0xca)]||'#ffffff',this['lineWidth']=_0x331402['lineWidth']||0x1,this['fixedHeight']=(_0x30a5c6=_0x331402['fixedHeight'])!==null&&_0x30a5c6!==void 0x0?_0x30a5c6:0x0,this[_0xf6c2b4(0x105)]=(_0x37cc81=_0x331402['reverseY'])!==null&&_0x37cc81!==void 0x0?_0x37cc81:![],this['windField']&&this[_0xf6c2b4(0x198)]['setOptions'](_0x331402);}},{'key':_0x5c46f6(0x16f),'get':function _0x5370a3(){var _0x11b9e4=_0x5c46f6;return this[_0x11b9e4(0x151)];}},{'key':'canvasWidth','get':function _0xb704b3(){var _0x372a1d=_0x5c46f6;return this[_0x372a1d(0xf5)][_0x372a1d(0x111)][_0x372a1d(0x151)]['clientWidth'];}},{'key':'canvasHeight','get':function _0x31a2c9(){var _0x11d21b=_0x5c46f6;return this[_0x11d21b(0xf5)]['scene'][_0x11d21b(0x151)]['clientHeight'];}},{'key':_0x5c46f6(0x120),'get':function _0x1952d6(){var _0x536380=_0x5c46f6;return this[_0x536380(0xb4)];},'set':function _0x16532e(_0x8a100c){var _0x1d6962=_0x5c46f6;this['_pointerEvents']=_0x8a100c;if(!this[_0x1d6962(0x151)])return;_0x8a100c?this['canvas'][_0x1d6962(0x17b)]['pointer-events']=_0x1d6962(0x11a):this[_0x1d6962(0x151)]['style']['pointer-events']='none';}},{'key':_0x5c46f6(0x14c),'get':function _0x349e95(){var _0x294682=_0x5c46f6;return this[_0x294682(0x171)]['particlesNumber'];},'set':function _0x5b1a56(_0xb43d28){var _0x4efd06=_0x5c46f6,_0x2d60f7=this;this['options']['particlesNumber']=_0xb43d28,clearTimeout(this[_0x4efd06(0x142)]),this[_0x4efd06(0x142)]=setTimeout(function(){_0x2d60f7['redraw']();},0x1f4);}},{'key':'speedRate','get':function _0x3dc97a(){var _0x5629b7=_0x5c46f6;return this['options'][_0x5629b7(0x132)];},'set':function _0x4719b0(_0x549312){var _0x3ab482=_0x5c46f6;this['options'][_0x3ab482(0x132)]=_0x549312,this[_0x3ab482(0x198)]&&(this['windField'][_0x3ab482(0x132)]=_0x549312);}},{'key':'maxAge','get':function _0x4da52e(){return this['options']['maxAge'];},'set':function _0x4e32f2(_0x5a60cc){var _0x2af16d=_0x5c46f6;this['options'][_0x2af16d(0x149)]=_0x5a60cc,this['windField']&&(this['windField']['maxAge']=_0x5a60cc);}},{'key':'data','get':function _0x340111(){return this['windData'];},'set':function _0x3cffb3(_0x1a333c){this['setData'](_0x1a333c);}},{'key':'_showHook','value':function _0x568ed8(_0x3be325){var _0x1c9cb8=_0x5c46f6;_0x3be325?this['_addedHook']():(this[_0x1c9cb8(0x136)]&&(this[_0x1c9cb8(0x171)][_0x1c9cb8(0xe2)]=this[_0x1c9cb8(0x136)]),this[_0x1c9cb8(0x164)]());}},{'key':_0x5c46f6(0x138),'value':function _0x383ae2(){var _0x5bc690=_0x5c46f6;this['options']['worker']?this['initWorker']():this[_0x5bc690(0x198)]=new CanvasWindField(this['options']);}},{'key':'_addedHook','value':function _0x4d3ff9(){var _0x40219f=_0x5c46f6;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas'][_0x40219f(0x190)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x40219f(0xe2)]&&this['setData'](this[_0x40219f(0x171)]['data']);}},{'key':_0x5c46f6(0x164),'value':function _0x3e0684(){var _0x22fcc7=_0x5c46f6;this['clear'](),this['unbindEvent'](),this[_0x22fcc7(0x151)]&&(this['_map'][_0x22fcc7(0x131)]['removeChild'](this['canvas']),delete this['canvas']);}},{'key':_0x5c46f6(0x185),'value':function _0x203774(){var _0x5118bc=_0x5c46f6,_0xef57b6=document['createElement']('canvas');_0xef57b6[_0x5118bc(0x17b)]['position']='absolute',_0xef57b6['style'][_0x5118bc(0xd4)]='0px',_0xef57b6['style']['left']='0px',_0xef57b6[_0x5118bc(0x17b)][_0x5118bc(0x1a4)]='100%',_0xef57b6['style']['height']='100%',_0xef57b6['style']['pointerEvents']=this['_pointerEvents']?'auto':_0x5118bc(0xac),_0xef57b6['style'][_0x5118bc(0x144)]=0xa,_0xef57b6['setAttribute']('id',_0x5118bc(0x11e)),_0xef57b6['setAttribute']('class','canvasWindy'),this['_map']['container']['appendChild'](_0xef57b6);var _0x30ea20=this[_0x5118bc(0xf5)]['scene'];return _0xef57b6['width']=_0x30ea20['canvas']['clientWidth'],_0xef57b6['height']=_0x30ea20['canvas']['clientHeight'],_0xef57b6;}},{'key':'resize','value':function _0x26d8c3(){var _0x3fd54c=_0x5c46f6;this['canvas']&&(this[_0x3fd54c(0x151)][_0x3fd54c(0x1a4)]=this['canvasWidth'],this['canvas'][_0x3fd54c(0xb0)]=this['canvasHeight']);}},{'key':'bindEvent','value':function _0x36da81(){var _0x11e519=_0x5c46f6,_0x371ff6=this,_0x5542da=Date[_0x11e519(0x173)]();(function _0xfab2ef(){_0x371ff6['animateFrame']=window['requestAnimationFrame'](_0xfab2ef);if(_0x371ff6['show']&&_0x371ff6['windField']){var _0x5a3744=Date['now'](),_0x266762=_0x5a3744-_0x5542da;_0x266762>_0x371ff6['frameTime']&&(_0x5542da=_0x5a3744-_0x266762%_0x371ff6['frameTime'],_0x371ff6['update']());}}(),window[_0x11e519(0x14a)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options'][_0x11e519(0x140)]&&(this[_0x11e519(0xf5)]['on'](mars3d__namespace['EventType'][_0x11e519(0x182)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x11e519(0x129)],this),this['_map']['on'](mars3d__namespace[_0x11e519(0x133)]['mouseUp'],this['_onMouseUpEvent'],this)));}},{'key':'unbindEvent','value':function _0x1132bc(){var _0x4bb8bf=_0x5c46f6;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x4bb8bf(0x139)],window['removeEventListener']('resize',this[_0x4bb8bf(0x116)]),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x4bb8bf(0x157)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}},{'key':'_onMapWhellEvent','value':function _0x27d28c(_0x45b2b6){var _0x3a8e5c=_0x5c46f6,_0x1e9371=this;clearTimeout(this[_0x3a8e5c(0x1a0)]);if(!this['show']||!this[_0x3a8e5c(0x151)])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(function(){var _0x26bcd6=_0x3a8e5c;if(!_0x1e9371[_0x26bcd6(0xdf)])return;_0x1e9371['redraw'](),_0x1e9371['canvas']['style']['visibility']='visible';},0xc8);}},{'key':'_onMouseDownEvent','value':function _0x10cbe1(_0xfe5a62){var _0x19af58=_0x5c46f6;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x19af58(0x187)],this);}},{'key':'_onMouseMoveEvent','value':function _0x22c440(_0x1c21ce){var _0x7fb61=_0x5c46f6;if(!this['show']||!this['canvas'])return;this[_0x7fb61(0x165)]&&(this['canvas']['style']['visibility']='hidden',this[_0x7fb61(0x191)]=!![]);}},{'key':'_onMouseUpEvent','value':function _0x36721c(_0x50f917){var _0x1bf6d4=_0x5c46f6;if(!this['show']||!this[_0x1bf6d4(0x151)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x1bf6d4(0x151)]['style']['visibility']=_0x1bf6d4(0x153),this['mouse_down']=![],this[_0x1bf6d4(0x191)]=![];}},{'key':'setData','value':function _0x5b19bb(_0x1082bd){var _0x3df48a=_0x5c46f6;this[_0x3df48a(0x13e)](),this[_0x3df48a(0x136)]=_0x1082bd,this['windField']['setDate'](_0x1082bd),this['redraw']();}},{'key':'redraw','value':function _0x50594b(){var _0x464567=_0x5c46f6;if(!this[_0x464567(0xdf)])return;this['windField'][_0x464567(0x15f)](this['options']),this[_0x464567(0x177)]();}},{'key':_0x5c46f6(0x177),'value':function _0x507e82(){var _0xc63e11=_0x5c46f6;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0xc63e11(0xaa)])this[_0xc63e11(0x198)]['update']();else{var _0xa635a9=this[_0xc63e11(0x198)]['getParticles']();this['_drawLines'](_0xa635a9);}this['_updateIng']=![];}},{'key':_0x5c46f6(0x118),'value':function _0x4842ec(_0x5dbc8f){var _0x209d41=_0x5c46f6;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this[_0x209d41(0xb9)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9,this[_0x209d41(0x197)][_0x209d41(0x172)](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x209d41(0x197)]['strokeStyle']=this['color'];var _0x33a6c3=this[_0x209d41(0xf5)][_0x209d41(0x111)][_0x209d41(0xc5)]!==Cesium['SceneMode']['SCENE3D'];for(var _0xca0180=0x0,_0x382f4a=_0x5dbc8f['length'];_0xca0180<_0x382f4a;_0xca0180++){var _0x55830a=_0x5dbc8f[_0xca0180],_0x5f05a3=this['_tomap'](_0x55830a['lng'],_0x55830a['lat'],_0x55830a),_0x153d1a=this['_tomap'](_0x55830a['tlng'],_0x55830a['tlat'],_0x55830a);if(!_0x5f05a3||!_0x153d1a)continue;if(_0x33a6c3&&Math[_0x209d41(0x115)](_0x5f05a3[0x0]-_0x153d1a[0x0])>=this['canvasWidth'])continue;this['canvasContext']['moveTo'](_0x5f05a3[0x0],_0x5f05a3[0x1]),this['canvasContext']['lineTo'](_0x153d1a[0x0],_0x153d1a[0x1]);}this['canvasContext']['stroke']();}},{'key':_0x5c46f6(0xf3),'value':function _0x2309d7(_0x51f504,_0x40e67d,_0x3a469d){var _0x49cff9=_0x5c46f6,_0x3e0cbe=Cesium['Cartesian3']['fromDegrees'](_0x51f504,_0x40e67d,this[_0x49cff9(0xbf)]),_0x2acf0d=this[_0x49cff9(0xf5)]['scene'];if(_0x2acf0d['mode']===Cesium['SceneMode']['SCENE3D']){var _0x15bbc8=new Cesium[(_0x49cff9(0x180))](_0x2acf0d['globe']['ellipsoid'],_0x2acf0d['camera']['positionWC']),_0x37288d=_0x15bbc8[_0x49cff9(0x106)](_0x3e0cbe);if(!_0x37288d)return _0x3a469d['age']=0x0,null;}var _0x2e9fe6=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x3e0cbe);return _0x2e9fe6?[_0x2e9fe6['x'],_0x2e9fe6['y']]:null;}},{'key':'clear','value':function _0x5541c2(){var _0x368ab7=_0x5c46f6;this[_0x368ab7(0x198)]['clear'](),delete this[_0x368ab7(0x136)];}},{'key':'initWorker','value':function _0x5d53ec(){var _0x86edab=_0x5c46f6,_0x27317c=this;this['worker']=new Worker(this['options']['worker']),this[_0x86edab(0xaa)]['onmessage']=function(_0x54ca84){var _0x14c218=_0x86edab;_0x27317c['_drawLines'](_0x54ca84['data']['particles']),_0x27317c[_0x14c218(0x100)]=![];},this['windField']={'init':function _0x4a090f(_0x3769e9){var _0x5b796b=_0x86edab;_0x27317c['worker'][_0x5b796b(0xbd)]({'type':_0x5b796b(0xda),'options':_0x3769e9});},'setOptions':function _0x33a79c(_0x4a3de7){var _0x109b35=_0x86edab;_0x27317c['worker'][_0x109b35(0xbd)]({'type':'setOptions','options':_0x4a3de7});},'setDate':function _0x1fd62d(_0x38fe76){_0x27317c['worker']['postMessage']({'type':'setDate','data':_0x38fe76});},'update':function _0x2e9cd6(){var _0x4418c1=_0x86edab;if(_0x27317c[_0x4418c1(0x100)])return;_0x27317c['_updateIng2']=!![],_0x27317c['worker'][_0x4418c1(0xbd)]({'type':'update'});},'clear':function _0x436db1(){_0x27317c['worker']['postMessage']({'type':'clear'});}},this['windField'][_0x86edab(0xda)](this['options']);}}]),_0x2d13a7;}(BaseLayer);mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x17f290(0x16f)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x17f290(0xe1)](exports,'__esModule',{'value':!![]});
}));
