/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.1
 * 编译日期：2023-08-14 21:33:17
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x25d301=_0x291b;(function(_0x29255f,_0x10494e){const _0x5703e3=_0x291b,_0x46b936=_0x29255f();while(!![]){try{const _0x3a0143=parseInt(_0x5703e3(0x1f5))/0x1+parseInt(_0x5703e3(0x227))/0x2*(parseInt(_0x5703e3(0x204))/0x3)+parseInt(_0x5703e3(0x23f))/0x4*(parseInt(_0x5703e3(0x218))/0x5)+parseInt(_0x5703e3(0x188))/0x6+parseInt(_0x5703e3(0x193))/0x7*(-parseInt(_0x5703e3(0x1e9))/0x8)+-parseInt(_0x5703e3(0x232))/0x9+parseInt(_0x5703e3(0x1bb))/0xa*(-parseInt(_0x5703e3(0x181))/0xb);if(_0x3a0143===_0x10494e)break;else _0x46b936['push'](_0x46b936['shift']());}catch(_0x426d0b){_0x46b936['push'](_0x46b936['shift']());}}}(_0x2359,0xe8568));function _interopNamespace(_0x372aaf){const _0x309bbe=_0x291b;if(_0x372aaf&&_0x372aaf['__esModule'])return _0x372aaf;var _0x4c3d65=Object['create'](null);return _0x372aaf&&Object['keys'](_0x372aaf)[_0x309bbe(0x198)](function(_0x42d54b){if(_0x42d54b!=='default'){var _0x1ca1ff=Object['getOwnPropertyDescriptor'](_0x372aaf,_0x42d54b);Object['defineProperty'](_0x4c3d65,_0x42d54b,_0x1ca1ff['get']?_0x1ca1ff:{'enumerable':!![],'get':function(){return _0x372aaf[_0x42d54b];}});}}),_0x4c3d65[_0x309bbe(0x19c)]=_0x372aaf,_0x4c3d65;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x3494aa,_0x30810c){const _0x1d72b1=_0x3494aa*Math['cos'](Cesium$7['Math']['toRadians'](_0x30810c));return _0x1d72b1;}function getV(_0x2132a0,_0x3028e5){const _0x589eaa=_0x2132a0*Math['sin'](Cesium$7['Math']['toRadians'](_0x3028e5));return _0x589eaa;}function getSpeed(_0x1893af,_0x29069a){const _0x9ff704=Math['sqrt'](Math['pow'](_0x1893af,0x2)+Math['pow'](_0x29069a,0x2));return _0x9ff704;}function getDirection(_0x52f871,_0x574659){let _0x268748=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x574659,_0x52f871));return _0x268748+=_0x268748<0x0?0x168:0x0,_0x268748;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x493c14){const _0x48aebf=_0x291b;this['commandType']=_0x493c14['commandType'],this['geometry']=_0x493c14[_0x48aebf(0x240)],this['attributeLocations']=_0x493c14['attributeLocations'],this[_0x48aebf(0x1ee)]=_0x493c14['primitiveType'],this['uniformMap']=_0x493c14['uniformMap'],this['vertexShaderSource']=_0x493c14['vertexShaderSource'],this['fragmentShaderSource']=_0x493c14[_0x48aebf(0x1e6)],this[_0x48aebf(0x1a4)]=_0x493c14['rawRenderState'],this['framebuffer']=_0x493c14[_0x48aebf(0x1aa)],this['outputTexture']=_0x493c14['outputTexture'],this['autoClear']=_0x493c14['autoClear']??![],this['preExecute']=_0x493c14['preExecute'],this[_0x48aebf(0x221)]=!![],this[_0x48aebf(0x1f1)]=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6[(_0x48aebf(0x1c6))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x2a2be4){const _0x307b40=_0x291b;switch(this['commandType']){case'Draw':{const _0x22a03f=Cesium$6[_0x307b40(0x1bc)]['fromGeometry']({'context':_0x2a2be4,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x1f8411=Cesium$6[_0x307b40(0x219)]['fromCache']({'context':_0x2a2be4,'attributeLocations':this[_0x307b40(0x1d7)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x239539=Cesium$6['RenderState'][_0x307b40(0x1c4)](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x1f8411,'vertexArray':_0x22a03f,'modelMatrix':Cesium$6['Matrix4'][_0x307b40(0x16e)],'renderState':_0x239539,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x307b40(0x1fa)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x4202b1,_0x51aebb){const _0x4b9f13=_0x291b;this[_0x4b9f13(0x240)]=_0x51aebb;const _0x5ebc0d=Cesium$6[_0x4b9f13(0x1bc)]['fromGeometry']({'context':_0x4202b1,'geometry':this[_0x4b9f13(0x240)],'attributeLocations':this[_0x4b9f13(0x1d7)],'bufferUsage':Cesium$6[_0x4b9f13(0x211)][_0x4b9f13(0x1a3)]});this['commandToExecute']['vertexArray']=_0x5ebc0d;}['update'](_0x312437){const _0x48385a=_0x291b;if(!this['show'])return;if(_0x312437['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x312437['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this[_0x48385a(0x1b1)])&&_0x312437['commandList']['push'](this['clearCommand']),_0x312437[_0x48385a(0x1c0)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}[_0x25d301(0x187)](){const _0xc57f20=_0x25d301;if(this['clearCommand']){var _0x1dcea6,_0x30b8c5;(_0x1dcea6=this['clearCommand'])!==null&&_0x1dcea6!==void 0x0&&_0x1dcea6[_0xc57f20(0x214)]&&this['clearCommand']['vertexArray'][_0xc57f20(0x187)](),(_0x30b8c5=this[_0xc57f20(0x1b1)])!==null&&_0x30b8c5!==void 0x0&&_0x30b8c5[_0xc57f20(0x1a0)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this[_0xc57f20(0x1f1)]['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6[_0xc57f20(0x1fb)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x3fefbc=function(){const _0x5f0767=_0x291b,_0x128238=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x5f0767(0x205))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x5f0767(0x1a7)][_0x5f0767(0x1cc)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x128238;},_0x18d8b1=function(_0x1a4e8a,_0x34ddc8){const _0x1286d0=_0x291b;if(Cesium$5[_0x1286d0(0x238)](_0x34ddc8)){const _0x48c574={};_0x48c574['arrayBufferView']=_0x34ddc8,_0x1a4e8a[_0x1286d0(0x1d8)]=_0x48c574;}const _0x126c42=new Cesium$5[(_0x1286d0(0x1ff))](_0x1a4e8a);return _0x126c42;},_0x1c1f91=function(_0xb23616,_0x1a06fc,_0x31b162){const _0x51ef3a=new Cesium$5['Framebuffer']({'context':_0xb23616,'colorTextures':[_0x1a06fc],'depthTexture':_0x31b162});return _0x51ef3a;},_0x404238=function(_0x44c862){const _0x5bdaee=_0x291b,_0x2b4e1c=!![],_0x2784bc=![],_0x3b97b8={'viewport':_0x44c862['viewport'],'depthTest':_0x44c862['depthTest'],'depthMask':_0x44c862[_0x5bdaee(0x20e)],'blending':_0x44c862[_0x5bdaee(0x169)]},_0x5c49fe=Cesium$5['Appearance']['getDefaultRenderState'](_0x2b4e1c,_0x2784bc,_0x3b97b8);return _0x5c49fe;},_0x167146=function(_0x46133e){const _0x418fd8=_0x291b,_0x52ad0e={},_0x3ba520=Cesium$5['Math']['mod'](_0x46133e['west'],Cesium$5['Math']['TWO_PI']),_0x3bb85a=Cesium$5[_0x418fd8(0x1d2)]['mod'](_0x46133e['east'],Cesium$5[_0x418fd8(0x1d2)]['TWO_PI']),_0x2e4e04=_0x46133e[_0x418fd8(0x1bd)];let _0x33a304,_0x3085b2;_0x2e4e04>Cesium$5['Math'][_0x418fd8(0x241)]?(_0x33a304=0x0,_0x3085b2=Cesium$5[_0x418fd8(0x1d2)]['TWO_PI']):_0x3bb85a-_0x3ba520<_0x2e4e04?(_0x33a304=_0x3ba520,_0x3085b2=_0x3ba520+_0x2e4e04):(_0x33a304=_0x3ba520,_0x3085b2=_0x3bb85a);_0x52ad0e['lon']={'min':Cesium$5[_0x418fd8(0x1d2)]['toDegrees'](_0x33a304),'max':Cesium$5['Math'][_0x418fd8(0x185)](_0x3085b2)};const _0x3d4a49=_0x46133e['south'],_0x100959=_0x46133e['north'],_0x31f6ac=_0x46133e['height'],_0x5deea1=_0x31f6ac>Cesium$5['Math']['PI']/0xc?_0x31f6ac/0x2:0x0;let _0x2d3b36=Cesium$5['Math']['clampToLatitudeRange'](_0x3d4a49-_0x5deea1),_0x31f2dc=Cesium$5['Math'][_0x418fd8(0x180)](_0x100959+_0x5deea1);return _0x2d3b36<-Cesium$5['Math'][_0x418fd8(0x1a9)]&&(_0x2d3b36=-Cesium$5[_0x418fd8(0x1d2)]['PI_OVER_TWO']),_0x31f2dc>Cesium$5['Math'][_0x418fd8(0x1a9)]&&(_0x31f2dc=Cesium$5['Math']['PI_OVER_TWO']),_0x52ad0e[_0x418fd8(0x1ce)]={'min':Cesium$5['Math']['toDegrees'](_0x2d3b36),'max':Cesium$5['Math']['toDegrees'](_0x31f2dc)},_0x52ad0e;};return{'getFullscreenQuad':_0x3fefbc,'createTexture':_0x18d8b1,'createFramebuffer':_0x1c1f91,'createRawRenderState':_0x404238,'viewRectangleToLonLatRange':_0x167146};}());var segmentDraw_vert=_0x25d301(0x17d),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];function _0x2359(){const _0x1e1871=['particlesTextures','69784ObQdsz','_map','round','createComputingPrimitives','TextureMinificationFilter','primitiveType','TRIANGLES','context','commandToExecute','mouseUp','_speedRate','particlesTextureSize','1766743AvCIOx','TextureMagnificationFilter','removeAll','EventType','_onMap_preRenderEvent','Pass','destroyObject','NEAREST','lev','segmentsColor','Texture','clear','none','options','umin','3585bCBZgJ','GeometryAttributes','0px','clientHeight','currentTrails','PixelDatatype','windField','create','worker','globeBoundingSphere','depthMask','getRandomLatLng','createTexture','BufferUsage','_pointerEvents','PixelFormat','vertexArray','Cartesian2','PrimitiveType','_calcUV','3144025qffJWI','ShaderProgram','particles','updateViewerParameters','xmax','setDate','framebuffers','_data','requestAnimationFrame','show','nextParticlesSpeed','refreshParticles','cols','postMessage','colors','324cbajXc','lonRange','array','Compute','setData','outputTexture','nextParticlesPosition','stroke','camera','_onMouseUpEvent','removeEventListener','13011597ovMMiT','dimensions','particlesComputing','nextTrails','OPAQUE','textures','defined','applyViewerParameters','speedRate','data','lineWidth','ymax','Sampler','4SBGVCS','geometry','THREE_PI_OVER_TWO','colorTable','postProcessingSpeed','currentParticlesPosition','viewerParameters','add','reverseY','fillRect','_showHook','blending','canvasWidth','drawingBufferWidth','SceneTransforms','fromDegrees','IDENTITY','cancelAnimationFrame','updateSpeed','off','ZERO','DISABLE_GL_POSITION_LOG_DEPTH','_canrefresh','Rectangle','canvas','currentParticlesSpeed','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','createFramebuffer','Cesium','LUMINANCE','lng','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','particleSystem','maxParticles','clampToLatitudeRange','4090207zHYygR','particlesNumber','windData','canvasContext','toDegrees','_tomap','destroy','7479078XckiBa','postProcessingPosition','redraw','_onMouseMoveEvent','getUVByPoint','_maxAge','speedFactor','grid','lighter','globalCompositeOperation','computeViewRectangle','259cWEjeD','setOptions','WindLayer','update','layer','forEach','_calc_speedRate','windTextures','_onMapWhellEvent','default','_onMouseDownEvent','CanvasWindLayer','ymin','shaderProgram','createWindTextures','top','STATIC_DRAW','rawRenderState','getWind','mouse_down','ComponentDatatype','_setOptionsHook','PI_OVER_THREE','framebuffer','ceil','speed','resize','maxAge','tlat','toGridXY','clearCommand','BaseLayer','segments','particlesRendering','frameTime','push','udata','Draw','auto','mouse_move','30IImeBj','VertexArray','width','scene','Cartesian3','commandList','addEventListener','xmin','latRange','fromCache','trails','ClearCommand','primitives','visibility','abs','mouseMove','Color','FLOAT','beginPath','lat','length','rows','style','Math','tlng','max','createSegmentsGeometry','bind','attributeLocations','source','min','lon','currentTrailsDepth','_addedHook','vdata','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','_drawLines','ShaderSource','dropRate','keys','age','_randomParticle','init','fragmentShaderSource','getUVByXY'];_0x2359=function(){return _0x1e1871;};return _0x2359();}class ParticlesRendering{constructor(_0x17cb41,_0x2b66d5,_0x49d34b,_0x3d81d5,_0x428cba){this['createRenderingTextures'](_0x17cb41,_0x2b66d5,_0x49d34b['colors']),this['createRenderingFramebuffers'](_0x17cb41),this['createRenderingPrimitives'](_0x17cb41,_0x49d34b,_0x3d81d5,_0x428cba);}['createRenderingTextures'](_0x38e34f,_0x1f6f64,_0x7fcc4c){const _0x2bd901=_0x25d301,_0x341b4e={'context':_0x38e34f,'width':_0x38e34f[_0x2bd901(0x16b)],'height':_0x38e34f['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x1a4039={'context':_0x38e34f,'width':_0x38e34f['drawingBufferWidth'],'height':_0x38e34f['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0xe64fa=_0x7fcc4c['length'],_0x9b8381=new Float32Array(_0xe64fa*0x3);for(let _0x33d0e4=0x0;_0x33d0e4<_0xe64fa;_0x33d0e4++){const _0x69477c=Cesium$4['Color']['fromCssColorString'](_0x7fcc4c[_0x33d0e4]);_0x9b8381[0x3*_0x33d0e4]=_0x69477c['red'],_0x9b8381[0x3*_0x33d0e4+0x1]=_0x69477c['green'],_0x9b8381[0x3*_0x33d0e4+0x2]=_0x69477c['blue'];}const _0x6d8f8={'context':_0x38e34f,'width':_0xe64fa,'height':0x1,'pixelFormat':Cesium$4[_0x2bd901(0x213)]['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x2bd901(0x23e))]({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x341b4e),'segmentsDepth':Util[_0x2bd901(0x210)](_0x1a4039),'currentTrailsColor':Util[_0x2bd901(0x210)](_0x341b4e),'currentTrailsDepth':Util['createTexture'](_0x1a4039),'nextTrailsColor':Util[_0x2bd901(0x210)](_0x341b4e),'nextTrailsDepth':Util['createTexture'](_0x1a4039),'colorTable':Util[_0x2bd901(0x210)](_0x6d8f8,_0x9b8381)};}['createRenderingFramebuffers'](_0x1aec50){const _0x1d973d=_0x25d301;this['framebuffers']={'segments':Util[_0x1d973d(0x179)](_0x1aec50,this['textures'][_0x1d973d(0x1fe)],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x1aec50,this['textures']['currentTrailsColor'],this['textures'][_0x1d973d(0x1db)]),'nextTrails':Util['createFramebuffer'](_0x1aec50,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}[_0x25d301(0x1d5)](_0x152c52){const _0x17c0f3=_0x25d301,_0x1ca3be=0x4;let _0x3a4393=[];for(let _0x5cc1bd=0x0;_0x5cc1bd<_0x152c52['particlesTextureSize'];_0x5cc1bd++){for(let _0x2913b0=0x0;_0x2913b0<_0x152c52[_0x17c0f3(0x1f4)];_0x2913b0++){for(let _0x1cccc8=0x0;_0x1cccc8<_0x1ca3be;_0x1cccc8++){_0x3a4393[_0x17c0f3(0x1b6)](_0x5cc1bd/_0x152c52['particlesTextureSize']),_0x3a4393['push'](_0x2913b0/_0x152c52['particlesTextureSize']);}}}_0x3a4393=new Float32Array(_0x3a4393);let _0x1e45a5=[];const _0x313db1=[-0x1,0x1],_0x53b16f=[-0x1,0x1];for(let _0xfb2c74=0x0;_0xfb2c74<_0x152c52['maxParticles'];_0xfb2c74++){for(let _0x1e2056=0x0;_0x1e2056<_0x1ca3be/0x2;_0x1e2056++){for(let _0x22efd3=0x0;_0x22efd3<_0x1ca3be/0x2;_0x22efd3++){_0x1e45a5[_0x17c0f3(0x1b6)](_0x313db1[_0x1e2056]),_0x1e45a5['push'](_0x53b16f[_0x22efd3]),_0x1e45a5[_0x17c0f3(0x1b6)](0x0);}}}_0x1e45a5=new Float32Array(_0x1e45a5);const _0x3aa149=0x6*_0x152c52[_0x17c0f3(0x17f)],_0x1b7a63=new Uint32Array(_0x3aa149);for(let _0x238839=0x0,_0x2e63c3=0x0,_0x12920b=0x0;_0x238839<_0x152c52['maxParticles'];_0x238839++){_0x1b7a63[_0x2e63c3++]=_0x12920b+0x0,_0x1b7a63[_0x2e63c3++]=_0x12920b+0x1,_0x1b7a63[_0x2e63c3++]=_0x12920b+0x2,_0x1b7a63[_0x2e63c3++]=_0x12920b+0x2,_0x1b7a63[_0x2e63c3++]=_0x12920b+0x1,_0x1b7a63[_0x2e63c3++]=_0x12920b+0x3,_0x12920b+=0x4;}const _0x11270f=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x17c0f3(0x1cc)],'componentsPerAttribute':0x2,'values':_0x3a4393}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x1e45a5})}),'indices':_0x1b7a63});return _0x11270f;}['createRenderingPrimitives'](_0x4fc0cb,_0x3562e5,_0x36d77f,_0x66bed8){const _0x69729=_0x25d301,_0x2fe4f7=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0x69729(0x1b8),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x3562e5),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x702a6=_0x69729;return _0x66bed8['particlesTextures'][_0x702a6(0x244)];},'postProcessingPosition':function(){return _0x66bed8['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x4b57d8=_0x69729;return _0x66bed8[_0x4b57d8(0x1e8)][_0x4b57d8(0x243)];},'colorTable':function(){const _0x29202=_0x69729;return _0x2fe4f7['textures'][_0x29202(0x242)];},'aspect':function(){return _0x4fc0cb['drawingBufferWidth']/_0x4fc0cb['drawingBufferHeight'];},'pixelSize':function(){return _0x36d77f['pixelSize'];},'lineWidth':function(){return _0x3562e5['lineWidth'];},'particleHeight':function(){return _0x3562e5['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x69729(0x1e0))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x69729(0x21e)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x69729(0x1ef)],'uniformMap':{'segmentsColorTexture':function(){const _0x14b6cc=_0x69729;return _0x2fe4f7['textures'][_0x14b6cc(0x1fe)];},'segmentsDepthTexture':function(){return _0x2fe4f7['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x115c29=_0x69729;return _0x2fe4f7[_0x115c29(0x21e)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0xd2c70=_0x69729;return _0x2fe4f7['framebuffers'][_0xd2c70(0x208)]['depthTexture'];},'fadeOpacity':function(){return _0x3562e5['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x69729(0x173)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x69729(0x178)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x69729(0x21e)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x5ecc28=_0x69729,_0x39fd46=_0x2fe4f7['framebuffers']['currentTrails'];_0x2fe4f7['framebuffers']['currentTrails']=_0x2fe4f7[_0x5ecc28(0x21e)][_0x5ecc28(0x235)],_0x2fe4f7['framebuffers']['nextTrails']=_0x39fd46,_0x2fe4f7['primitives']['trails']['commandToExecute']['framebuffer']=_0x2fe4f7['framebuffers']['nextTrails'],_0x2fe4f7['primitives']['trails'][_0x5ecc28(0x1b1)]['framebuffer']=_0x2fe4f7[_0x5ecc28(0x21e)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x69729(0x216)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){return _0x2fe4f7['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0xf5df5=_0x69729;return _0x2fe4f7[_0xf5df5(0x21e)][_0xf5df5(0x235)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x25d301(0x1de),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';function _0x291b(_0x4eb3e3,_0x5a5fd0){const _0x235942=_0x2359();return _0x291b=function(_0x291b1c,_0x41cca9){_0x291b1c=_0x291b1c-0x169;let _0x1703f9=_0x235942[_0x291b1c];return _0x1703f9;},_0x291b(_0x4eb3e3,_0x5a5fd0);}const Cesium$3=mars3d__namespace[_0x25d301(0x17a)];class ParticlesComputing{constructor(_0x53e562,_0x3cc0ac,_0x241c57,_0x1d1b9a){const _0x5e54ec=_0x25d301;this[_0x5e54ec(0x23b)]=_0x3cc0ac,this[_0x5e54ec(0x1a1)](_0x53e562,_0x3cc0ac),this['createParticlesTextures'](_0x53e562,_0x241c57,_0x1d1b9a),this[_0x5e54ec(0x1ec)](_0x3cc0ac,_0x241c57,_0x1d1b9a);}['createWindTextures'](_0x4909af,_0x53ab26){const _0x1ebd61=_0x25d301,_0x50afe9={'context':_0x4909af,'width':_0x53ab26['dimensions']['lon'],'height':_0x53ab26['dimensions']['lat']*(_0x53ab26[_0x1ebd61(0x233)][_0x1ebd61(0x1fd)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x1ebd61(0x17b)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x1ebd61(0x1ed)][_0x1ebd61(0x1fc)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util[_0x1ebd61(0x210)](_0x50afe9,_0x53ab26['U']['array']),'V':Util['createTexture'](_0x50afe9,_0x53ab26['V'][_0x1ebd61(0x229)])};}['createParticlesTextures'](_0x5441c3,_0x482738,_0x887b33){const _0x66290d=_0x25d301,_0x3e76cb={'context':_0x5441c3,'width':_0x482738[_0x66290d(0x1f4)],'height':_0x482738['particlesTextureSize'],'pixelFormat':Cesium$3[_0x66290d(0x213)]['RGBA'],'pixelDatatype':Cesium$3[_0x66290d(0x209)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x66290d(0x23e))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x66290d(0x1f6)][_0x66290d(0x1fc)]})},_0x1d051c=this['randomizeParticles'](_0x482738['maxParticles'],_0x887b33),_0x3b5a9b=new Float32Array(0x4*_0x482738[_0x66290d(0x17f)])['fill'](0x0);this[_0x66290d(0x1e8)]={'particlesWind':Util['createTexture'](_0x3e76cb),'currentParticlesPosition':Util['createTexture'](_0x3e76cb,_0x1d051c),'nextParticlesPosition':Util[_0x66290d(0x210)](_0x3e76cb,_0x1d051c),'currentParticlesSpeed':Util['createTexture'](_0x3e76cb,_0x3b5a9b),'nextParticlesSpeed':Util['createTexture'](_0x3e76cb,_0x3b5a9b),'postProcessingPosition':Util[_0x66290d(0x210)](_0x3e76cb,_0x1d051c),'postProcessingSpeed':Util['createTexture'](_0x3e76cb,_0x3b5a9b)};}['randomizeParticles'](_0x922db,_0xf39826){const _0x5dfdaf=_0x25d301,_0x5edddb=new Float32Array(0x4*_0x922db);for(let _0x2b57c3=0x0;_0x2b57c3<_0x922db;_0x2b57c3++){_0x5edddb[0x4*_0x2b57c3]=Cesium$3['Math']['randomBetween'](_0xf39826['lonRange']['x'],_0xf39826[_0x5dfdaf(0x228)]['y']),_0x5edddb[0x4*_0x2b57c3+0x1]=Cesium$3['Math']['randomBetween'](_0xf39826['latRange']['x'],_0xf39826['latRange']['y']),_0x5edddb[0x4*_0x2b57c3+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x5dfdaf(0x1fd)]['min'],this['data'][_0x5dfdaf(0x1fd)]['max']),_0x5edddb[0x4*_0x2b57c3+0x3]=0x0;}return _0x5edddb;}['destroyParticlesTextures'](){const _0x1d1cb9=_0x25d301;Object[_0x1d1cb9(0x1e2)](this['particlesTextures'])['forEach'](_0x958f3=>{const _0x1a30a0=_0x1d1cb9;this[_0x1a30a0(0x1e8)][_0x958f3][_0x1a30a0(0x187)]();});}['createComputingPrimitives'](_0x4a72fa,_0x2a5383,_0x499803){const _0x52447f=_0x25d301,_0x47fe55=new Cesium$3['Cartesian3'](_0x4a72fa['dimensions']['lon'],_0x4a72fa[_0x52447f(0x233)][_0x52447f(0x1ce)],_0x4a72fa[_0x52447f(0x233)][_0x52447f(0x1fd)]),_0x4de96c=new Cesium$3['Cartesian3'](_0x4a72fa['lon'][_0x52447f(0x1d9)],_0x4a72fa['lat']['min'],_0x4a72fa['lev']['min']),_0x436884=new Cesium$3['Cartesian3'](_0x4a72fa['lon']['max'],_0x4a72fa['lat'][_0x52447f(0x1d4)],_0x4a72fa['lev']['max']),_0x361941=new Cesium$3[(_0x52447f(0x1bf))]((_0x436884['x']-_0x4de96c['x'])/(_0x47fe55['x']-0x1),(_0x436884['y']-_0x4de96c['y'])/(_0x47fe55['y']-0x1),_0x47fe55['z']>0x1?(_0x436884['z']-_0x4de96c['z'])/(_0x47fe55['z']-0x1):0x1),_0x5630a9=new Cesium$3['Cartesian2'](_0x4a72fa['U']['min'],_0x4a72fa['U']['max']),_0x1c7112=new Cesium$3[(_0x52447f(0x215))](_0x4a72fa['V'][_0x52447f(0x1d9)],_0x4a72fa['V'][_0x52447f(0x1d4)]),_0x139a37=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x8ec23b=_0x52447f;return _0x139a37[_0x8ec23b(0x19a)]['U'];},'V':function(){const _0x3feb98=_0x52447f;return _0x139a37[_0x3feb98(0x19a)]['V'];},'currentParticlesPosition':function(){const _0x155fd2=_0x52447f;return _0x139a37[_0x155fd2(0x1e8)]['currentParticlesPosition'];},'dimension':function(){return _0x47fe55;},'minimum':function(){return _0x4de96c;},'maximum':function(){return _0x436884;},'interval':function(){return _0x361941;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x4c39a7=_0x52447f;_0x139a37['primitives'][_0x4c39a7(0x1a5)]['commandToExecute']['outputTexture']=_0x139a37['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x52447f(0x22a),'uniformMap':{'currentParticlesSpeed':function(){const _0x56e3ce=_0x52447f;return _0x139a37[_0x56e3ce(0x1e8)][_0x56e3ce(0x177)];},'particlesWind':function(){return _0x139a37['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x5630a9;},'vSpeedRange':function(){return _0x1c7112;},'pixelSize':function(){return _0x499803['pixelSize'];},'speedFactor':function(){return _0x2a5383['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x52447f(0x1e0))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x49a577=_0x52447f,_0x1bf59f=_0x139a37['particlesTextures']['currentParticlesSpeed'];_0x139a37['particlesTextures'][_0x49a577(0x177)]=_0x139a37[_0x49a577(0x1e8)]['postProcessingSpeed'],_0x139a37['particlesTextures'][_0x49a577(0x243)]=_0x1bf59f,_0x139a37[_0x49a577(0x1c7)][_0x49a577(0x170)]['commandToExecute'][_0x49a577(0x22c)]=_0x139a37[_0x49a577(0x1e8)][_0x49a577(0x222)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x49b056=_0x52447f;return _0x139a37[_0x49b056(0x1e8)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x139a37['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x52447f(0x1e8)]['nextParticlesPosition'],'preExecute':function(){const _0x1dcca8=_0x52447f,_0x27a5c8=_0x139a37['particlesTextures'][_0x1dcca8(0x244)];_0x139a37[_0x1dcca8(0x1e8)]['currentParticlesPosition']=_0x139a37['particlesTextures']['postProcessingPosition'],_0x139a37[_0x1dcca8(0x1e8)][_0x1dcca8(0x189)]=_0x27a5c8,_0x139a37[_0x1dcca8(0x1c7)]['updatePosition'][_0x1dcca8(0x1f1)]['outputTexture']=_0x139a37['particlesTextures'][_0x1dcca8(0x22d)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x139a37['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x56a56c=_0x52447f;return _0x139a37['particlesTextures'][_0x56a56c(0x222)];},'lonRange':function(){return _0x499803['lonRange'];},'latRange':function(){return _0x499803['latRange'];},'randomCoefficient':function(){const _0xa017fb=Math['random']();return _0xa017fb;},'dropRate':function(){return _0x2a5383['dropRate'];},'dropRateBump':function(){return _0x2a5383['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x52447f(0x189)],'preExecute':function(){const _0x191e46=_0x52447f;_0x139a37['primitives']['postProcessingPosition'][_0x191e46(0x1f1)][_0x191e46(0x22c)]=_0x139a37['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x139a37['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x44653a=_0x52447f;return _0x139a37['particlesTextures'][_0x44653a(0x222)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x612c90=_0x52447f;_0x139a37['primitives'][_0x612c90(0x243)]['commandToExecute'][_0x612c90(0x22c)]=_0x139a37[_0x612c90(0x1e8)][_0x612c90(0x243)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x2d86ae,_0x8738a1,_0x4bcdf0,_0x21cb45){const _0xb188c7=_0x25d301;this['context']=_0x2d86ae,_0x8738a1={..._0x8738a1},_0x8738a1['udata']&&_0x8738a1['vdata']&&(_0x8738a1['dimensions']={},_0x8738a1[_0xb188c7(0x233)]['lon']=_0x8738a1['cols'],_0x8738a1[_0xb188c7(0x233)]['lat']=_0x8738a1['rows'],_0x8738a1['dimensions']['lev']=_0x8738a1[_0xb188c7(0x1fd)]||0x1,_0x8738a1['lon']={},_0x8738a1['lon'][_0xb188c7(0x1d9)]=_0x8738a1[_0xb188c7(0x1c2)],_0x8738a1['lon']['max']=_0x8738a1['xmax'],_0x8738a1[_0xb188c7(0x1ce)]={},_0x8738a1['lat']['min']=_0x8738a1['ymin'],_0x8738a1[_0xb188c7(0x1ce)]['max']=_0x8738a1['ymax'],_0x8738a1[_0xb188c7(0x1fd)]={},_0x8738a1['lev']['min']=_0x8738a1['levmin']??0x1,_0x8738a1['lev']['max']=_0x8738a1['levmax']??0x1,_0x8738a1['U']={},_0x8738a1['U']['array']=new Float32Array(_0x8738a1['udata']),_0x8738a1['U']['min']=_0x8738a1[_0xb188c7(0x203)]??Math[_0xb188c7(0x1d9)](..._0x8738a1[_0xb188c7(0x1b7)]),_0x8738a1['U']['max']=_0x8738a1['umax']??Math['max'](..._0x8738a1[_0xb188c7(0x1b7)]),_0x8738a1['V']={},_0x8738a1['V'][_0xb188c7(0x229)]=new Float32Array(_0x8738a1['vdata']),_0x8738a1['V'][_0xb188c7(0x1d9)]=_0x8738a1['vmin']??Math['min'](..._0x8738a1['vdata']),_0x8738a1['V']['max']=_0x8738a1['vmax']??Math[_0xb188c7(0x1d4)](..._0x8738a1[_0xb188c7(0x1dd)])),this[_0xb188c7(0x23b)]=_0x8738a1,this['options']=_0x4bcdf0,this['viewerParameters']=_0x21cb45,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0xb188c7(0x202)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0xb188c7(0x1f0)],this['data'],this['options'],this[_0xb188c7(0x245)],this[_0xb188c7(0x234)]);}['canvasResize'](_0x2f71dc){const _0x44c579=_0x25d301;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x44c579(0x198)](_0x3284dc=>{const _0x4d68cf=_0x44c579;this['particlesComputing']['windTextures'][_0x3284dc][_0x4d68cf(0x187)]();}),this['particlesRendering']['textures'][_0x44c579(0x242)][_0x44c579(0x187)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x4f6b4f=>{this['particlesRendering']['framebuffers'][_0x4f6b4f]['destroy']();}),this['context']=_0x2f71dc,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x44c579(0x23b)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x44c579(0x202)],this[_0x44c579(0x245)],this['particlesComputing']);}['clearFramebuffers'](){const _0x18ada0=_0x25d301,_0x4e9141=new Cesium$2[(_0x18ada0(0x1c6))]({'color':new Cesium$2[(_0x18ada0(0x1cb))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x18ada0(0x236)]});Object[_0x18ada0(0x1e2)](this[_0x18ada0(0x1b4)][_0x18ada0(0x21e)])['forEach'](_0x257355=>{const _0x6e4dca=_0x18ada0;_0x4e9141['framebuffer']=this['particlesRendering'][_0x6e4dca(0x21e)][_0x257355],_0x4e9141['execute'](this['context']);});}['refreshParticles'](_0x314758){const _0x26e513=_0x25d301;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this[_0x26e513(0x1f0)],this['options'],this['viewerParameters']);if(_0x314758){var _0x1cf821,_0x492573;const _0x6579e4=this[_0x26e513(0x1b4)][_0x26e513(0x1d5)](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x6579e4;const _0xa33ea6=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x26e513(0x1f0)],'geometry':_0x6579e4,'attributeLocations':this['particlesRendering']['primitives'][_0x26e513(0x1b3)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x1cf821=this['particlesRendering']['primitives'])!==null&&_0x1cf821!==void 0x0&&(_0x492573=_0x1cf821['segments'])!==null&&_0x492573!==void 0x0&&_0x492573[_0x26e513(0x1f1)]&&(this[_0x26e513(0x1b4)][_0x26e513(0x1c7)]['segments']['commandToExecute'][_0x26e513(0x214)]=_0xa33ea6);}}['setOptions'](_0x30bea7){const _0x32a86f=_0x25d301;let _0x277dba=![];this['options']['maxParticles']!==_0x30bea7['maxParticles']&&(_0x277dba=!![]),Object['keys'](_0x30bea7)[_0x32a86f(0x198)](_0x3e5794=>{this['options'][_0x3e5794]=_0x30bea7[_0x3e5794];}),this[_0x32a86f(0x223)](_0x277dba);}['applyViewerParameters'](_0x1de1b1){const _0x52ba08=_0x25d301;Object[_0x52ba08(0x1e2)](_0x1de1b1)[_0x52ba08(0x198)](_0x171de7=>{this['viewerParameters'][_0x171de7]=_0x1de1b1[_0x171de7];}),this[_0x52ba08(0x223)](![]);}[_0x25d301(0x187)](){const _0x1cdbbb=_0x25d301;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object[_0x1cdbbb(0x1e2)](this[_0x1cdbbb(0x234)][_0x1cdbbb(0x19a)])['forEach'](_0x5cd43c=>{const _0x501faf=_0x1cdbbb;this[_0x501faf(0x234)]['windTextures'][_0x5cd43c]['destroy']();}),this[_0x1cdbbb(0x1b4)][_0x1cdbbb(0x237)]['colorTable'][_0x1cdbbb(0x187)](),Object[_0x1cdbbb(0x1e2)](this['particlesRendering']['framebuffers'])['forEach'](_0x54c1db=>{this['particlesRendering']['framebuffers'][_0x54c1db]['destroy']();});for(const _0x1bfb97 in this){delete this[_0x1bfb97];}}}const Cesium$1=mars3d__namespace[_0x25d301(0x17a)],BaseLayer$1=mars3d__namespace[_0x25d301(0x197)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x3a0a31={}){const _0x4ae84a=_0x25d301;_0x3a0a31={...DEF_OPTIONS,..._0x3a0a31},super(_0x3a0a31),this[_0x4ae84a(0x1a8)](_0x3a0a31);}get[_0x25d301(0x197)](){const _0x12453a=_0x25d301;return this[_0x12453a(0x1c7)];}get['data'](){const _0x414e3b=_0x25d301;return this[_0x414e3b(0x21f)];}set['data'](_0x47e65a){this['setData'](_0x47e65a);}get[_0x25d301(0x226)](){const _0x30b63a=_0x25d301;return this[_0x30b63a(0x202)][_0x30b63a(0x226)];}set[_0x25d301(0x226)](_0x4db4fb){const _0x16cd8e=_0x25d301;this['options']['colors']=_0x4db4fb,this['particleSystem']&&this['particleSystem'][_0x16cd8e(0x194)]({'colors':_0x4db4fb}),this[_0x16cd8e(0x1ad)]();}['_mountedHook'](){}['_addedHook'](){const _0x28025b=_0x25d301;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this[_0x28025b(0x1c7)]=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x28025b(0x1be)][_0x28025b(0x1c7)][_0x28025b(0x246)](this[_0x28025b(0x1c7)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1[_0x28025b(0x1bf)][_0x28025b(0x172)],0.99*0x615299),this[_0x28025b(0x21b)](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this[_0x28025b(0x1a6)]=![],this['mouse_move']=![],this[_0x28025b(0x1ea)]['on'](mars3d__namespace[_0x28025b(0x1f8)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x28025b(0x1ea)]['on'](mars3d__namespace['EventType'][_0x28025b(0x1ca)],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x28025b(0x22b)](this['_data']);}['_removedHook'](){const _0x55fc2=_0x25d301;window[_0x55fc2(0x231)]('resize',this['resize']),this['_map'][_0x55fc2(0x171)](mars3d__namespace[_0x55fc2(0x1f8)]['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x55fc2(0x19b)],this),this[_0x55fc2(0x1ea)]['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x55fc2(0x19d)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives'][_0x55fc2(0x1f7)](),this['_map']['scene'][_0x55fc2(0x1c7)]['remove'](this[_0x55fc2(0x1c7)]);}[_0x25d301(0x1ad)](){const _0x850612=_0x25d301;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this[_0x850612(0x1f9)],this);}['_onMap_preRenderEvent'](_0x38409d){const _0x4eb922=_0x25d301;this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this[_0x4eb922(0x1c7)]['show']=!![];}['_onMapWhellEvent'](_0x41abe1){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x1cc9c2){const _0x289896=_0x25d301;this[_0x289896(0x1a6)]=!![];}['_onMouseMoveEvent'](_0x470cea){const _0x2541a2=_0x25d301;if(!this[_0x2541a2(0x221)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x2541a2(0x1ba)]=!![]);}[_0x25d301(0x230)](_0x304086){const _0x59f33c=_0x25d301;if(!this[_0x59f33c(0x221)]||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x59f33c(0x1c7)]['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x1c4b6a=_0x25d301;if(!this['_map']||!this['show'])return;this[_0x1c4b6a(0x21b)](),this['particleSystem'][_0x1c4b6a(0x239)](this[_0x1c4b6a(0x245)]),this[_0x1c4b6a(0x1c7)][_0x1c4b6a(0x221)]=!![];}['setData'](_0x5aedc9){const _0x6fdaeb=_0x25d301;this[_0x6fdaeb(0x21f)]=_0x5aedc9,this[_0x6fdaeb(0x17e)]&&this[_0x6fdaeb(0x17e)][_0x6fdaeb(0x187)](),this[_0x6fdaeb(0x17e)]=new ParticleSystem(this['scene'][_0x6fdaeb(0x1f0)],_0x5aedc9,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}[_0x25d301(0x1a8)](_0x8de4f9,_0x3d229b){const _0x4634e4=_0x25d301;if(_0x8de4f9)for(const _0x162652 in _0x8de4f9){this[_0x162652]=_0x8de4f9[_0x162652];}this['particleSystem']&&this[_0x4634e4(0x17e)]['setOptions'](this['getOptions']());}['getOptions'](){const _0xe0628f=_0x25d301,_0x256304=Math[_0xe0628f(0x1ab)](Math['sqrt'](this['particlesNumber']));return this[_0xe0628f(0x182)]=_0x256304*_0x256304,{'particlesTextureSize':_0x256304,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0xe0628f(0x1e1)],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0xe0628f(0x18e)],'lineWidth':this['lineWidth'],'colors':this[_0xe0628f(0x226)]};}['addPrimitives'](){const _0x959dd0=_0x25d301;this[_0x959dd0(0x1c7)]['add'](this[_0x959dd0(0x17e)]['particlesComputing']['primitives'][_0x959dd0(0x1a5)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x959dd0(0x170)]),this['primitives']['add'](this['particleSystem'][_0x959dd0(0x234)]['primitives']['updatePosition']),this[_0x959dd0(0x1c7)][_0x959dd0(0x246)](this[_0x959dd0(0x17e)]['particlesComputing'][_0x959dd0(0x1c7)][_0x959dd0(0x189)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x959dd0(0x243)]),this['primitives'][_0x959dd0(0x246)](this['particleSystem']['particlesRendering'][_0x959dd0(0x1c7)]['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x959dd0(0x1c7)][_0x959dd0(0x1c5)]),this['primitives'][_0x959dd0(0x246)](this['particleSystem']['particlesRendering'][_0x959dd0(0x1c7)]['screen']);}['updateViewerParameters'](){const _0x1db9c2=_0x25d301;let _0x3f5661=this['camera'][_0x1db9c2(0x192)](this[_0x1db9c2(0x1be)]['globe']['ellipsoid']);if(!_0x3f5661){const _0x33cead=this[_0x1db9c2(0x1ea)]['getExtent']();_0x3f5661=Cesium$1[_0x1db9c2(0x175)]['fromDegrees'](_0x33cead['xmin'],_0x33cead['ymin'],_0x33cead['xmax'],_0x33cead['ymax']);}const _0x5e4685=Util['viewRectangleToLonLatRange'](_0x3f5661);this['viewerParameters']['lonRange']['x']=_0x5e4685['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x5e4685[_0x1db9c2(0x1da)]['max'],this['viewerParameters'][_0x1db9c2(0x1c3)]['x']=_0x5e4685['lat'][_0x1db9c2(0x1d9)],this['viewerParameters']['latRange']['y']=_0x5e4685['lat'][_0x1db9c2(0x1d4)];const _0x2d0cf1=this[_0x1db9c2(0x22f)]['getPixelSize'](this[_0x1db9c2(0x20d)],this['scene'][_0x1db9c2(0x16b)],this[_0x1db9c2(0x1be)]['drawingBufferHeight']);_0x2d0cf1>0x0&&(this[_0x1db9c2(0x245)]['pixelSize']=_0x2d0cf1);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer'][_0x25d301(0x195)]=WindLayer;class CanvasParticle{constructor(){const _0x17dcc7=_0x25d301;this['lng']=null,this[_0x17dcc7(0x1ce)]=null,this['tlng']=null,this['tlat']=null,this[_0x17dcc7(0x1e3)]=null,this['speed']=null;}[_0x25d301(0x187)](){for(const _0x25235c in this){delete this[_0x25235c];}}}class CanvasWindField{constructor(_0x2ec2c0){const _0x435ba3=_0x25d301;this[_0x435ba3(0x194)](_0x2ec2c0);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x33dd85){const _0x26d4eb=_0x25d301;this['_speedRate']=(0x64-(_0x33dd85>0x63?0x63:_0x33dd85))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this[_0x26d4eb(0x1f3)],(this[_0x26d4eb(0x23d)]-this['ymin'])/this['_speedRate']];}get[_0x25d301(0x1ae)](){return this['_maxAge'];}set['maxAge'](_0x375ee6){const _0x1668bb=_0x25d301;this[_0x1668bb(0x18d)]=_0x375ee6;}['setOptions'](_0x112160){const _0x5cf6ad=_0x25d301;this[_0x5cf6ad(0x202)]=_0x112160,this['maxAge']=_0x112160['maxAge']||0x78,this['speedRate']=_0x112160[_0x5cf6ad(0x23a)]||0x32,this['particles']=[];const _0x58a1d7=_0x112160[_0x5cf6ad(0x182)]||0x1000;for(let _0x3dad5a=0x0;_0x3dad5a<_0x58a1d7;_0x3dad5a++){const _0x132497=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x132497);}}['setDate'](_0x266062){const _0x42f35f=_0x25d301;this['rows']=_0x266062['rows'],this['cols']=_0x266062['cols'],this['xmin']=_0x266062['xmin'],this['xmax']=_0x266062['xmax'],this['ymin']=_0x266062[_0x42f35f(0x19f)],this['ymax']=_0x266062['ymax'],this['grid']=[];const _0x47c01a=_0x266062['udata'],_0x244b7c=_0x266062['vdata'];let _0x56fdb1=![];_0x47c01a['length']===this['rows']&&_0x47c01a[0x0]['length']===this['cols']&&(_0x56fdb1=!![]);let _0x25ce37=0x0,_0x4ee0be=null,_0x8a790b=null;for(let _0x44a579=0x0;_0x44a579<this[_0x42f35f(0x1d0)];_0x44a579++){_0x4ee0be=[];for(let _0x132d32=0x0;_0x132d32<this['cols'];_0x132d32++,_0x25ce37++){_0x56fdb1?_0x8a790b=this[_0x42f35f(0x217)](_0x47c01a[_0x44a579][_0x132d32],_0x244b7c[_0x44a579][_0x132d32]):_0x8a790b=this[_0x42f35f(0x217)](_0x47c01a[_0x25ce37],_0x244b7c[_0x25ce37]),_0x4ee0be[_0x42f35f(0x1b6)](_0x8a790b);}this[_0x42f35f(0x18f)][_0x42f35f(0x1b6)](_0x4ee0be);}this['options']['reverseY']&&this[_0x42f35f(0x18f)]['reverse']();}['clear'](){const _0x13683c=_0x25d301;delete this['rows'],delete this[_0x13683c(0x224)],delete this['xmin'],delete this[_0x13683c(0x21c)],delete this[_0x13683c(0x19f)],delete this[_0x13683c(0x23d)],delete this[_0x13683c(0x18f)],delete this['particles'];}['toGridXY'](_0x5ab6dc,_0x4f5784){const _0x1129df=_0x25d301,_0x472d30=(_0x5ab6dc-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0xa2a809=(this['ymax']-_0x4f5784)/(this['ymax']-this['ymin'])*(this[_0x1129df(0x1d0)]-0x1);return[_0x472d30,_0xa2a809];}['getUVByXY'](_0x661980,_0xa68789){const _0x70f51f=_0x25d301;if(_0x661980<0x0||_0x661980>=this[_0x70f51f(0x224)]||_0xa68789>=this['rows'])return[0x0,0x0,0x0];const _0x4729ea=Math['floor'](_0x661980),_0x305912=Math['floor'](_0xa68789);if(_0x4729ea===_0x661980&&_0x305912===_0xa68789)return this['grid'][_0xa68789][_0x661980];const _0x4dc768=_0x4729ea+0x1,_0x85663=_0x305912+0x1,_0x2fb5c5=this['getUVByXY'](_0x4729ea,_0x305912),_0x27a52a=this[_0x70f51f(0x1e7)](_0x4dc768,_0x305912),_0x50b6a1=this['getUVByXY'](_0x4729ea,_0x85663),_0xa52734=this['getUVByXY'](_0x4dc768,_0x85663);let _0x1ae81d=null;try{_0x1ae81d=this['_bilinearInterpolation'](_0x661980-_0x4729ea,_0xa68789-_0x305912,_0x2fb5c5,_0x27a52a,_0x50b6a1,_0xa52734);}catch(_0x2accbc){console['log'](_0x661980,_0xa68789);}return _0x1ae81d;}['_bilinearInterpolation'](_0x41d545,_0x4fcd2c,_0xc359d5,_0x192ccc,_0x2fdfa8,_0x2345ef){const _0x3a77a3=0x1-_0x41d545,_0x1398f9=0x1-_0x4fcd2c,_0x1a6f62=_0x3a77a3*_0x1398f9,_0x17253a=_0x41d545*_0x1398f9,_0x2b7eeb=_0x3a77a3*_0x4fcd2c,_0x11a952=_0x41d545*_0x4fcd2c,_0x5dbace=_0xc359d5[0x0]*_0x1a6f62+_0x192ccc[0x0]*_0x17253a+_0x2fdfa8[0x0]*_0x2b7eeb+_0x2345ef[0x0]*_0x11a952,_0x414b4c=_0xc359d5[0x1]*_0x1a6f62+_0x192ccc[0x1]*_0x17253a+_0x2fdfa8[0x1]*_0x2b7eeb+_0x2345ef[0x1]*_0x11a952;return this['_calcUV'](_0x5dbace,_0x414b4c);}[_0x25d301(0x217)](_0x552114,_0x469d0d){return[+_0x552114,+_0x469d0d,Math['sqrt'](_0x552114*_0x552114+_0x469d0d*_0x469d0d)];}['getUVByPoint'](_0x4ff076,_0x5f5b5d){const _0xc7abdf=_0x25d301;if(!this['isInExtent'](_0x4ff076,_0x5f5b5d))return null;const _0x3693b0=this[_0xc7abdf(0x1b0)](_0x4ff076,_0x5f5b5d),_0x2e728b=this['getUVByXY'](_0x3693b0[0x0],_0x3693b0[0x1]);return _0x2e728b;}['isInExtent'](_0x15d9e0,_0x2ae1){const _0x49f9df=_0x25d301;return _0x15d9e0>=this[_0x49f9df(0x1c2)]&&_0x15d9e0<=this['xmax']&&_0x2ae1>=this['ymin']&&_0x2ae1<=this[_0x49f9df(0x23d)]?!![]:![];}['getRandomLatLng'](){const _0x3241fb=_0x25d301,_0x38c757=fRandomByfloat(this[_0x3241fb(0x1c2)],this['xmax']),_0xf73848=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0xf73848,'lng':_0x38c757};}['getParticles'](){const _0x53524e=_0x25d301;let _0x489d00,_0x3e9ac8,_0x27bbe5;for(let _0x4ff596=0x0,_0x12db1f=this['particles']['length'];_0x4ff596<_0x12db1f;_0x4ff596++){let _0x18afa5=this['particles'][_0x4ff596];_0x18afa5['age']<=0x0&&(_0x18afa5=this['_randomParticle'](_0x18afa5));if(_0x18afa5['age']>0x0){const _0x11e929=_0x18afa5['tlng'],_0x1f7410=_0x18afa5[_0x53524e(0x1af)];_0x27bbe5=this['getUVByPoint'](_0x11e929,_0x1f7410),_0x27bbe5?(_0x489d00=_0x11e929+this[_0x53524e(0x199)][0x0]*_0x27bbe5[0x0],_0x3e9ac8=_0x1f7410+this['_calc_speedRate'][0x1]*_0x27bbe5[0x1],_0x18afa5[_0x53524e(0x17c)]=_0x11e929,_0x18afa5['lat']=_0x1f7410,_0x18afa5[_0x53524e(0x1d3)]=_0x489d00,_0x18afa5['tlat']=_0x3e9ac8,_0x18afa5[_0x53524e(0x1ac)]=_0x27bbe5[0x2],_0x18afa5[_0x53524e(0x1e3)]--):_0x18afa5['age']=0x0;}}return this['particles'];}[_0x25d301(0x1e4)](_0x924b5){const _0x18c4a7=_0x25d301;let _0x345e50,_0x54f59d;for(let _0x47c2e3=0x0;_0x47c2e3<0x1e;_0x47c2e3++){_0x345e50=this[_0x18c4a7(0x20f)](),_0x54f59d=this[_0x18c4a7(0x18c)](_0x345e50['lng'],_0x345e50['lat']);if(_0x54f59d&&_0x54f59d[0x2]>0x0)break;}if(!_0x54f59d)return _0x924b5;const _0x2aa38c=_0x345e50['lng']+this['_calc_speedRate'][0x0]*_0x54f59d[0x0],_0xfa0971=_0x345e50['lat']+this[_0x18c4a7(0x199)][0x1]*_0x54f59d[0x1];return _0x924b5['lng']=_0x345e50['lng'],_0x924b5['lat']=_0x345e50[_0x18c4a7(0x1ce)],_0x924b5['tlng']=_0x2aa38c,_0x924b5['tlat']=_0xfa0971,_0x924b5['age']=Math[_0x18c4a7(0x1eb)](Math['random']()*this['maxAge']),_0x924b5['speed']=_0x54f59d[0x2],_0x924b5;}[_0x25d301(0x187)](){for(const _0x7b5380 in this){delete this[_0x7b5380];}}}function fRandomByfloat(_0xfcb3d3,_0x521f88){return _0xfcb3d3+Math['random']()*(_0x521f88-_0xfcb3d3);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x25d301(0x197)][_0x25d301(0x1b2)];class CanvasWindLayer extends BaseLayer{constructor(_0x15e3fc={}){const _0x486a4e=_0x25d301;super(_0x15e3fc),this['_setOptionsHook'](_0x15e3fc),this[_0x486a4e(0x176)]=null,_0x15e3fc['colors']&&_0x15e3fc['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x15e3fc));}[_0x25d301(0x1a8)](_0x588306,_0x42e543){const _0x429681=_0x25d301;this['frameTime']=0x3e8/(_0x588306['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x588306['color']||'#ffffff',this['lineWidth']=_0x588306[_0x429681(0x23c)]||0x1,this['fixedHeight']=_0x588306['fixedHeight']??0x0,this['reverseY']=_0x588306[_0x429681(0x247)]??![],this[_0x429681(0x20a)]&&this[_0x429681(0x20a)]['setOptions'](_0x588306);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x2fb5bc=_0x25d301;return this['_map'][_0x2fb5bc(0x1be)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0xe990ea=_0x25d301;return this[_0xe990ea(0x1ea)]['scene']['canvas']['clientHeight'];}get['pointerEvents'](){const _0x57e2ea=_0x25d301;return this[_0x57e2ea(0x212)];}set['pointerEvents'](_0xf42c74){const _0x4784f7=_0x25d301;this['_pointerEvents']=_0xf42c74;if(!this['canvas'])return;_0xf42c74?this[_0x4784f7(0x176)][_0x4784f7(0x1d1)]['pointer-events']='all':this['canvas']['style']['pointer-events']=_0x4784f7(0x201);}get[_0x25d301(0x182)](){const _0x257996=_0x25d301;return this[_0x257996(0x202)]['particlesNumber'];}set['particlesNumber'](_0x5ee7fd){const _0x11e795=_0x25d301;this['options']['particlesNumber']=_0x5ee7fd,clearTimeout(this[_0x11e795(0x174)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x2b46a1){const _0x465272=_0x25d301;this[_0x465272(0x202)]['speedRate']=_0x2b46a1,this[_0x465272(0x20a)]&&(this[_0x465272(0x20a)]['speedRate']=_0x2b46a1);}get[_0x25d301(0x1ae)](){const _0x397198=_0x25d301;return this['options'][_0x397198(0x1ae)];}set[_0x25d301(0x1ae)](_0x32d950){const _0x4be5cc=_0x25d301;this['options'][_0x4be5cc(0x1ae)]=_0x32d950,this['windField']&&(this[_0x4be5cc(0x20a)]['maxAge']=_0x32d950);}get['data'](){const _0x16e921=_0x25d301;return this[_0x16e921(0x183)];}set[_0x25d301(0x23b)](_0x4b1471){this['setData'](_0x4b1471);}[_0x25d301(0x249)](_0x1df098){const _0x171b21=_0x25d301;_0x1df098?this['_addedHook']():(this[_0x171b21(0x183)]&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x25d301(0x1dc)](){this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x557fd3=_0x25d301;this[_0x557fd3(0x200)](),this['unbindEvent'](),this[_0x557fd3(0x176)]&&(this['_map']['container']['removeChild'](this['canvas']),delete this[_0x557fd3(0x176)]);}['_createCanvas'](){const _0x5ed7aa=_0x25d301,_0x2c8204=mars3d__namespace['DomUtil'][_0x5ed7aa(0x20b)]('canvas','mars3d-canvasWind',this['_map']['container']);return _0x2c8204[_0x5ed7aa(0x1d1)]['position']='absolute',_0x2c8204[_0x5ed7aa(0x1d1)][_0x5ed7aa(0x1a2)]='0px',_0x2c8204[_0x5ed7aa(0x1d1)]['left']=_0x5ed7aa(0x206),_0x2c8204['style']['width']=this[_0x5ed7aa(0x1ea)]['scene']['canvas']['clientWidth']+'px',_0x2c8204['style']['height']=this['_map']['scene']['canvas'][_0x5ed7aa(0x207)]+'px',_0x2c8204['style']['pointerEvents']=this[_0x5ed7aa(0x212)]?_0x5ed7aa(0x1b9):'none',_0x2c8204[_0x5ed7aa(0x1d1)]['zIndex']=this['options']['zIndex']??0x9,_0x2c8204['width']=this[_0x5ed7aa(0x1ea)][_0x5ed7aa(0x1be)][_0x5ed7aa(0x176)]['clientWidth'],_0x2c8204['height']=this['_map']['scene'][_0x5ed7aa(0x176)]['clientHeight'],_0x2c8204;}['resize'](){const _0x45ee15=_0x25d301;this[_0x45ee15(0x176)]&&(this['canvas'][_0x45ee15(0x1d1)]['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this[_0x45ee15(0x176)]['style']['height']=this['_map']['scene'][_0x45ee15(0x176)]['clientHeight']+'px',this['canvas']['width']=this['_map']['scene'][_0x45ee15(0x176)]['clientWidth'],this['canvas']['height']=this[_0x45ee15(0x1ea)]['scene'][_0x45ee15(0x176)]['clientHeight']);}['bindEvent'](){const _0x1bfcef=_0x25d301,_0x216b5f=this;let _0x513913=Date['now']();(function _0x69fcd9(){const _0x58439f=_0x291b;_0x216b5f['animateFrame']=window[_0x58439f(0x220)](_0x69fcd9);if(_0x216b5f[_0x58439f(0x221)]&&_0x216b5f['windField']){const _0x6111b9=Date['now'](),_0x3d15a2=_0x6111b9-_0x513913;_0x3d15a2>_0x216b5f['frameTime']&&(_0x513913=_0x6111b9-_0x3d15a2%_0x216b5f[_0x58439f(0x1b5)],_0x216b5f['update']());}}(),window[_0x1bfcef(0x1c1)]('resize',this['resize'][_0x1bfcef(0x1d6)](this),![]),this[_0x1bfcef(0x1a6)]=![],this['mouse_move']=![],this[_0x1bfcef(0x202)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x1bfcef(0x19b)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x1bfcef(0x1f2)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x4a6074=_0x25d301;window[_0x4a6074(0x16f)](this['animateFrame']),delete this['animateFrame'],window[_0x4a6074(0x231)](_0x4a6074(0x1ad),this['resize']),this[_0x4a6074(0x202)]['mouseHidden']&&(this[_0x4a6074(0x1ea)]['off'](mars3d__namespace['EventType']['wheel'],this[_0x4a6074(0x19b)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x4a6074(0x230)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x4eb129){const _0x2541dc=_0x25d301;clearTimeout(this['refreshTimer']);if(!this[_0x2541dc(0x221)]||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0x25d301(0x19d)](_0x1d53b2){const _0x3a8fc5=_0x25d301;this[_0x3a8fc5(0x1a6)]=!![],this['_map']['off'](mars3d__namespace[_0x3a8fc5(0x1f8)]['mouseMove'],this[_0x3a8fc5(0x18b)],this),this[_0x3a8fc5(0x1ea)]['on'](mars3d__namespace['EventType'][_0x3a8fc5(0x1ca)],this[_0x3a8fc5(0x18b)],this);}[_0x25d301(0x18b)](_0x501e85){const _0x1ee3f8=_0x25d301;if(!this['show']||!this[_0x1ee3f8(0x176)])return;this['mouse_down']&&(this['canvas']['style'][_0x1ee3f8(0x1c8)]='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x30be4d){const _0x2eea7e=_0x25d301;if(!this['show']||!this[_0x2eea7e(0x176)])return;this[_0x2eea7e(0x1ea)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x2eea7e(0x176)]['style']['visibility']='visible',this[_0x2eea7e(0x1a6)]=![],this['mouse_move']=![];}['setData'](_0x1be2b3){const _0x11d440=_0x25d301;this[_0x11d440(0x200)](),this[_0x11d440(0x183)]=_0x1be2b3,this['windField'][_0x11d440(0x21d)](_0x1be2b3),this[_0x11d440(0x18a)]();}[_0x25d301(0x18a)](){const _0x9e20f=_0x25d301;if(!this['show'])return;this['windField']['setOptions'](this['options']),this[_0x9e20f(0x196)]();}[_0x25d301(0x196)](){if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0x15e72b=this['windField']['getParticles']();this['_drawLines'](_0x15e72b);}this['_updateIng']=![];}[_0x25d301(0x1df)](_0x16020c){const _0x5da3db=_0x25d301;this[_0x5da3db(0x184)][_0x5da3db(0x191)]='destination-in',this[_0x5da3db(0x184)][_0x5da3db(0x248)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']=_0x5da3db(0x190),this['canvasContext']['globalAlpha']=0.9;const _0x3bd824=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x53a008=this[_0x5da3db(0x16a)]*0.25;if(this['_colorRamp'])for(let _0x4264dc=0x0,_0x3e48ac=_0x16020c[_0x5da3db(0x1cf)];_0x4264dc<_0x3e48ac;_0x4264dc++){const _0x388720=_0x16020c[_0x4264dc],_0xfa1e3f=this['_tomap'](_0x388720['lng'],_0x388720['lat'],_0x388720),_0x4c426c=this['_tomap'](_0x388720['tlng'],_0x388720['tlat'],_0x388720);if(!_0xfa1e3f||!_0x4c426c)continue;if(_0x3bd824&&Math[_0x5da3db(0x1c9)](_0xfa1e3f[0x0]-_0x4c426c[0x0])>=_0x53a008)continue;this[_0x5da3db(0x184)][_0x5da3db(0x1cd)](),this['canvasContext'][_0x5da3db(0x23c)]=this['lineWidth'],this[_0x5da3db(0x184)]['strokeStyle']=this['_colorRamp']['getColor'](_0x388720['speed']),this[_0x5da3db(0x184)]['moveTo'](_0xfa1e3f[0x0],_0xfa1e3f[0x1]),this['canvasContext']['lineTo'](_0x4c426c[0x0],_0x4c426c[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['color'];for(let _0x5c85e5=0x0,_0x518984=_0x16020c['length'];_0x5c85e5<_0x518984;_0x5c85e5++){const _0x524406=_0x16020c[_0x5c85e5],_0x395530=this['_tomap'](_0x524406['lng'],_0x524406[_0x5da3db(0x1ce)],_0x524406),_0x19e67b=this[_0x5da3db(0x186)](_0x524406['tlng'],_0x524406['tlat'],_0x524406);if(!_0x395530||!_0x19e67b)continue;if(_0x3bd824&&Math['abs'](_0x395530[0x0]-_0x19e67b[0x0])>=_0x53a008)continue;this['canvasContext']['moveTo'](_0x395530[0x0],_0x395530[0x1]),this[_0x5da3db(0x184)]['lineTo'](_0x19e67b[0x0],_0x19e67b[0x1]);}this['canvasContext'][_0x5da3db(0x22e)]();}}['_tomap'](_0x506a60,_0x32003d,_0x1c77bd){const _0x3f63e9=_0x25d301,_0x3a70be=Cesium['Cartesian3'][_0x3f63e9(0x16d)](_0x506a60,_0x32003d,this['fixedHeight']),_0x4266d8=this['_map'][_0x3f63e9(0x1be)];if(_0x4266d8['mode']===Cesium['SceneMode']['SCENE3D']){const _0x543300=new Cesium['EllipsoidalOccluder'](_0x4266d8['globe']['ellipsoid'],_0x4266d8['camera']['positionWC']),_0x51ffd7=_0x543300['isPointVisible'](_0x3a70be);if(!_0x51ffd7)return _0x1c77bd['age']=0x0,null;}const _0x37e892=Cesium[_0x3f63e9(0x16c)]['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x3a70be);return _0x37e892?[_0x37e892['x'],_0x37e892['y']]:null;}[_0x25d301(0x200)](){const _0x3620ee=_0x25d301;this[_0x3620ee(0x20a)][_0x3620ee(0x200)](),delete this[_0x3620ee(0x183)];}['initWorker'](){const _0x34d1e8=_0x25d301;this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=_0xc86491=>{const _0x3a1b89=_0x291b;this['_drawLines'](_0xc86491['data'][_0x3a1b89(0x21a)]),this['_updateIng2']=![];},this[_0x34d1e8(0x20a)]={'init':_0x515939=>{const _0x525e17=_0x34d1e8;this['worker']['postMessage']({'type':_0x525e17(0x1e5),'options':_0x515939});},'setOptions':_0xb19cc6=>{const _0x1ffff7=_0x34d1e8;this['worker'][_0x1ffff7(0x225)]({'type':_0x1ffff7(0x194),'options':_0xb19cc6});},'setDate':_0x227c14=>{const _0x217fb9=_0x34d1e8;this[_0x217fb9(0x20c)]['postMessage']({'type':'setDate','data':_0x227c14});},'update':()=>{if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x3511af=_0x34d1e8;this['worker'][_0x3511af(0x225)]({'type':'clear'});}},this['windField'][_0x34d1e8(0x1e5)](this[_0x34d1e8(0x202)]);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x25d301(0x197)][_0x25d301(0x19e)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x25d301(0x19e)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
