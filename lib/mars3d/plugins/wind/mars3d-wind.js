/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.15
 * 编译日期：2023-07-10 19:16:12
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x32be77=_0x4a16;(function(_0x7419f9,_0x34693e){const _0x3e0d17=_0x4a16,_0x1210d0=_0x7419f9();while(!![]){try{const _0x3984a2=parseInt(_0x3e0d17(0x1d4))/0x1*(-parseInt(_0x3e0d17(0x25a))/0x2)+-parseInt(_0x3e0d17(0x22c))/0x3*(parseInt(_0x3e0d17(0x214))/0x4)+parseInt(_0x3e0d17(0x25e))/0x5*(parseInt(_0x3e0d17(0x1ca))/0x6)+parseInt(_0x3e0d17(0x284))/0x7*(parseInt(_0x3e0d17(0x1af))/0x8)+parseInt(_0x3e0d17(0x1bf))/0x9*(-parseInt(_0x3e0d17(0x1c8))/0xa)+-parseInt(_0x3e0d17(0x28a))/0xb+-parseInt(_0x3e0d17(0x255))/0xc*(-parseInt(_0x3e0d17(0x24f))/0xd);if(_0x3984a2===_0x34693e)break;else _0x1210d0['push'](_0x1210d0['shift']());}catch(_0x163e2e){_0x1210d0['push'](_0x1210d0['shift']());}}}(_0x2827,0x585c6));function _0x2827(){const _0x99570c=['forEach','_canrefresh','grid','TextureMagnificationFilter','floor','_speedRate','vmax','createParticlesTextures','fromDegrees','applyViewerParameters','outputTexture','lon','createCommand','FLOAT','mode','SCENE3D','bindEvent','clear','abs','push','onmessage','getRandomLatLng','drawingBufferHeight','removeAll','canvas','attributeLocations','randomBetween','resize','canvasContext','isDestroyed','_pointerEvents','worker','_updateIng2','Cartesian3','particles','age','createFramebuffer','maxParticles','mouse_down','createTexture','_calc_speedRate','defined','toDegrees','getWind','ymin','lat','_map','frameTime','colors','vertexArray','LayerUtil','ComponentDatatype','update','BaseLayer','blue','ShaderSource','postMessage','geometry','76tnhbSs','array','GeometryAttributes','lng','windData','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','Compute','Texture','umax','PixelDatatype','framebuffers','trails','red','primitives','createSegmentsGeometry','lev','commandToExecute','SceneMode','mouse_move','fromCssColorString','auto','BoundingSphere','drawingBufferWidth','createRawRenderState','54879tizGxI','lonRange','canvasWind','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','commandType','requestAnimationFrame','getParticles','rgb(206,255,255)','particlesNumber','setData','lineWidth','addEventListener','TRIANGLES','currentParticlesSpeed','shaderProgram','DEPTH_COMPONENT','visible','redraw','ComputeCommand','_mountedHook','TWO_PI','autoClear','context','mouseMove','canvasResize','EventType','setDate','_updateIng','udata','min','fill','particlesRendering','particlesTextures','updatePosition','setOptions','12389xxwGDo','particleSystem','bind','fromGeometry','create','Color','15324PnjLFS','vertexShaderSource','tlat','pow','currentTrails','370XSJjnn','fragmentShaderSource','viewRectangleToLonLatRange','_onMapWhellEvent','5YjspiB','viewerParameters','_onMouseUpEvent','THREE_PI_OVER_TWO','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','Pass','Appearance','textures','Rectangle','_maxAge','PixelFormat','ALWAYS','clientHeight','reverse','windField','_onMouseMoveEvent','_tomap','Cesium','stroke','wheel','height','width','color','depthMask','PrimitiveType','TextureMinificationFilter','segmentsColor','_onMouseDownEvent','nextTrailsDepth','nextParticlesSpeed','postProcessingSpeed','globalCompositeOperation','dimensions','globeBoundingSphere','xmax','#ffffff','register','_setOptionsHook','88354tgDESn','scene','nextTrails','_addedHook','none','fixedHeight','814275VnjjPO','speedFactor','add','options','uniformMap','currentParticlesPosition','_removedHook','currentTrailsColor','fromCache','depthTexture','Draw','GeometryAttribute','max','speedRate','rows','_onMap_preRenderEvent','removeEventListener','levmax','56HvbkRR','WindLayer','xmin','pointer-events','off','show','once','getUVByXY','RGBA','mars3d-canvasWind','log','clientWidth','LINEAR','data','destroy','hidden','369261snvkOf','framebuffer','particlesComputing','vdata','LUMINANCE','initWorker','postProcessingPosition','keys','reverseY','110oSJiRk','cols','1309722lsfyeH','_data','particlesTextureSize','Sampler','_calcUV','clearCommand','frameRate','cancelAnimationFrame','length','maxAge','1561YEHHco','NEAREST','container','fillRect','Math','canvasWidth'];_0x2827=function(){return _0x99570c;};return _0x2827();}function _interopNamespace(_0x2be39e){const _0x130eef=_0x4a16;if(_0x2be39e&&_0x2be39e['__esModule'])return _0x2be39e;var _0x141b9a=Object[_0x130eef(0x253)](null);return _0x2be39e&&Object['keys'](_0x2be39e)[_0x130eef(0x1da)](function(_0x201ebb){if(_0x201ebb!=='default'){var _0x2a5821=Object['getOwnPropertyDescriptor'](_0x2be39e,_0x201ebb);Object['defineProperty'](_0x141b9a,_0x201ebb,_0x2a5821['get']?_0x2a5821:{'enumerable':!![],'get':function(){return _0x2be39e[_0x201ebb];}});}}),_0x141b9a['default']=_0x2be39e,_0x141b9a;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x32be77(0x26f)];function getU(_0x317520,_0x1303ef){const _0xb5274f=_0x32be77,_0x1de732=_0x317520*Math['cos'](Cesium$7[_0xb5274f(0x1d8)]['toRadians'](_0x1303ef));return _0x1de732;}function getV(_0x45a88b,_0x573493){const _0x2e6a84=_0x45a88b*Math['sin'](Cesium$7['Math']['toRadians'](_0x573493));return _0x2e6a84;}function getSpeed(_0x3d9930,_0x1710e8){const _0x287cdc=_0x32be77,_0x513092=Math['sqrt'](Math[_0x287cdc(0x258)](_0x3d9930,0x2)+Math['pow'](_0x1710e8,0x2));return _0x513092;}function getDirection(_0xacb8d3,_0x9607e3){const _0x423a40=_0x32be77;let _0x231da2=Cesium$7[_0x423a40(0x1d8)]['toDegrees'](Math['atan2'](_0x9607e3,_0xacb8d3));return _0x231da2+=_0x231da2<0x0?0x168:0x0,_0x231da2;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};function _0x4a16(_0x19fb02,_0x49d863){const _0x2827a7=_0x2827();return _0x4a16=function(_0x4a163b,_0x247ca9){_0x4a163b=_0x4a163b-0x1a7;let _0x3e4d99=_0x2827a7[_0x4a163b];return _0x3e4d99;},_0x4a16(_0x19fb02,_0x49d863);}const Cesium$6=mars3d__namespace[_0x32be77(0x26f)];class CustomPrimitive{constructor(_0x12f5c6){const _0x2eaed8=_0x32be77;this['commandType']=_0x12f5c6[_0x2eaed8(0x230)],this['geometry']=_0x12f5c6[_0x2eaed8(0x213)],this['attributeLocations']=_0x12f5c6['attributeLocations'],this['primitiveType']=_0x12f5c6['primitiveType'],this[_0x2eaed8(0x28e)]=_0x12f5c6['uniformMap'],this[_0x2eaed8(0x256)]=_0x12f5c6[_0x2eaed8(0x256)],this[_0x2eaed8(0x25b)]=_0x12f5c6[_0x2eaed8(0x25b)],this['rawRenderState']=_0x12f5c6['rawRenderState'],this['framebuffer']=_0x12f5c6['framebuffer'],this[_0x2eaed8(0x1e4)]=_0x12f5c6[_0x2eaed8(0x1e4)],this['autoClear']=_0x12f5c6['autoClear']??![],this['preExecute']=_0x12f5c6['preExecute'],this['show']=!![],this[_0x2eaed8(0x224)]=undefined,this['clearCommand']=undefined,this[_0x2eaed8(0x241)]&&(this[_0x2eaed8(0x1cf)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x32be77(0x1e6)](_0x33497f){const _0x3f97e1=_0x32be77;switch(this['commandType']){case _0x3f97e1(0x1a7):{const _0x4d02b6=Cesium$6['VertexArray']['fromGeometry']({'context':_0x33497f,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x568a0f=Cesium$6['ShaderProgram']['fromCache']({'context':_0x33497f,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x3f97e1(0x25b)]}),_0xc26394=Cesium$6['RenderState'][_0x3f97e1(0x292)](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x568a0f,'vertexArray':_0x4d02b6,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0xc26394,'uniformMap':this[_0x3f97e1(0x28e)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x3f97e1(0x23e))]({'owner':this,'fragmentShaderSource':this[_0x3f97e1(0x25b)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0xb3fdb9,_0x383c79){const _0x51914c=_0x32be77;this[_0x51914c(0x213)]=_0x383c79;const _0x5a3843=Cesium$6['VertexArray'][_0x51914c(0x252)]({'context':_0xb3fdb9,'geometry':this[_0x51914c(0x213)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x51914c(0x224)]['vertexArray']=_0x5a3843;}['update'](_0x34a2f0){const _0xd95cae=_0x32be77;if(!this['show'])return;if(_0x34a2f0['mode']!==Cesium$6['SceneMode'][_0xd95cae(0x1e9)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this[_0xd95cae(0x1e6)](_0x34a2f0['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0xd95cae(0x203)](this['clearCommand'])&&_0x34a2f0['commandList']['push'](this['clearCommand']),_0x34a2f0['commandList']['push'](this['commandToExecute']);}[_0x32be77(0x1f7)](){return![];}['destroy'](){const _0x4ccd9e=_0x32be77;if(this[_0x4ccd9e(0x1cf)]){var _0x4ad87b,_0x1eae63;(_0x4ad87b=this['clearCommand'])!==null&&_0x4ad87b!==void 0x0&&_0x4ad87b['vertexArray']&&this[_0x4ccd9e(0x1cf)]['vertexArray']['destroy'](),(_0x1eae63=this[_0x4ccd9e(0x1cf)])!==null&&_0x1eae63!==void 0x0&&_0x1eae63['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this[_0x4ccd9e(0x224)]&&(this[_0x4ccd9e(0x224)]['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute'][_0x4ccd9e(0x23a)]&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x4ccd9e(0x224)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x4c11a5=function(){const _0x1812da=_0x4a16,_0x4458ba=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x1812da(0x216))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x1812da(0x20d)][_0x1812da(0x1e7)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x4458ba;},_0x2c394a=function(_0x2792df,_0x202ea2){const _0x4b5387=_0x4a16;if(Cesium$5['defined'](_0x202ea2)){const _0x2edbac={};_0x2edbac['arrayBufferView']=_0x202ea2,_0x2792df['source']=_0x2edbac;}const _0x3d37fd=new Cesium$5[(_0x4b5387(0x21b))](_0x2792df);return _0x3d37fd;},_0x471b54=function(_0x2ed993,_0x1fb403,_0x5b7eeb){const _0xd590ef=new Cesium$5['Framebuffer']({'context':_0x2ed993,'colorTextures':[_0x1fb403],'depthTexture':_0x5b7eeb});return _0xd590ef;},_0x5827ee=function(_0x4a9140){const _0x8881d8=_0x4a16,_0x1ce9bf=!![],_0x50ac15=![],_0x5a8c64={'viewport':_0x4a9140['viewport'],'depthTest':_0x4a9140['depthTest'],'depthMask':_0x4a9140[_0x8881d8(0x275)],'blending':_0x4a9140['blending']},_0xab6059=Cesium$5[_0x8881d8(0x264)]['getDefaultRenderState'](_0x1ce9bf,_0x50ac15,_0x5a8c64);return _0xab6059;},_0x10b212=function(_0x33b201){const _0x46555=_0x4a16,_0x53810d={},_0x10fd22=Cesium$5['Math']['mod'](_0x33b201['west'],Cesium$5[_0x46555(0x1d8)][_0x46555(0x240)]),_0x40339f=Cesium$5['Math']['mod'](_0x33b201['east'],Cesium$5['Math']['TWO_PI']),_0x2478b1=_0x33b201[_0x46555(0x273)];let _0x6344eb,_0x4f1d8f;_0x2478b1>Cesium$5['Math'][_0x46555(0x261)]?(_0x6344eb=0x0,_0x4f1d8f=Cesium$5['Math']['TWO_PI']):_0x40339f-_0x10fd22<_0x2478b1?(_0x6344eb=_0x10fd22,_0x4f1d8f=_0x10fd22+_0x2478b1):(_0x6344eb=_0x10fd22,_0x4f1d8f=_0x40339f);_0x53810d[_0x46555(0x1e5)]={'min':Cesium$5['Math'][_0x46555(0x204)](_0x6344eb),'max':Cesium$5['Math']['toDegrees'](_0x4f1d8f)};const _0x3b5a49=_0x33b201['south'],_0x120672=_0x33b201['north'],_0x4879fb=_0x33b201[_0x46555(0x272)],_0x2f640e=_0x4879fb>Cesium$5[_0x46555(0x1d8)]['PI']/0xc?_0x4879fb/0x2:0x0;let _0x196488=Cesium$5[_0x46555(0x1d8)]['clampToLatitudeRange'](_0x3b5a49-_0x2f640e),_0x58e4ab=Cesium$5[_0x46555(0x1d8)]['clampToLatitudeRange'](_0x120672+_0x2f640e);return _0x196488<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x196488=-Cesium$5['Math']['PI_OVER_TWO']),_0x58e4ab>Cesium$5['Math']['PI_OVER_THREE']&&(_0x58e4ab=Cesium$5['Math']['PI_OVER_TWO']),_0x53810d['lat']={'min':Cesium$5[_0x46555(0x1d8)]['toDegrees'](_0x196488),'max':Cesium$5['Math']['toDegrees'](_0x58e4ab)},_0x53810d;};return{'getFullscreenQuad':_0x4c11a5,'createTexture':_0x2c394a,'createFramebuffer':_0x471b54,'createRawRenderState':_0x5827ee,'viewRectangleToLonLatRange':_0x10b212};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x343fd0,_0x4df928,_0x3c1e89,_0x114be2,_0x5ca92a){this['createRenderingTextures'](_0x343fd0,_0x4df928,_0x3c1e89['colors']),this['createRenderingFramebuffers'](_0x343fd0),this['createRenderingPrimitives'](_0x343fd0,_0x3c1e89,_0x114be2,_0x5ca92a);}['createRenderingTextures'](_0x3d576e,_0x3fa845,_0x3a88a6){const _0x4b6b5f=_0x32be77,_0x48c031={'context':_0x3d576e,'width':_0x3d576e['drawingBufferWidth'],'height':_0x3d576e['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x4b6b5f(0x1b7)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0xa2decf={'context':_0x3d576e,'width':_0x3d576e[_0x4b6b5f(0x22a)],'height':_0x3d576e['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x4b6b5f(0x268)][_0x4b6b5f(0x23b)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x107e78=_0x3a88a6['length'],_0x71feee=new Float32Array(_0x107e78*0x3);for(let _0x2aa419=0x0;_0x2aa419<_0x107e78;_0x2aa419++){const _0xb00fff=Cesium$4['Color'][_0x4b6b5f(0x227)](_0x3a88a6[_0x2aa419]);_0x71feee[0x3*_0x2aa419]=_0xb00fff[_0x4b6b5f(0x220)],_0x71feee[0x3*_0x2aa419+0x1]=_0xb00fff['green'],_0x71feee[0x3*_0x2aa419+0x2]=_0xb00fff[_0x4b6b5f(0x210)];}const _0x2f1982={'context':_0x3d576e,'width':_0x107e78,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x4b6b5f(0x21d)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x4b6b5f(0x1bb)],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util[_0x4b6b5f(0x201)](_0x48c031),'segmentsDepth':Util['createTexture'](_0xa2decf),'currentTrailsColor':Util['createTexture'](_0x48c031),'currentTrailsDepth':Util[_0x4b6b5f(0x201)](_0xa2decf),'nextTrailsColor':Util[_0x4b6b5f(0x201)](_0x48c031),'nextTrailsDepth':Util[_0x4b6b5f(0x201)](_0xa2decf),'colorTable':Util[_0x4b6b5f(0x201)](_0x2f1982,_0x71feee)};}['createRenderingFramebuffers'](_0x3e6f0a){const _0x3db2f2=_0x32be77;this[_0x3db2f2(0x21e)]={'segments':Util['createFramebuffer'](_0x3e6f0a,this[_0x3db2f2(0x265)][_0x3db2f2(0x278)],this[_0x3db2f2(0x265)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x3e6f0a,this['textures'][_0x3db2f2(0x291)],this['textures']['currentTrailsDepth']),'nextTrails':Util[_0x3db2f2(0x1fe)](_0x3e6f0a,this['textures']['nextTrailsColor'],this[_0x3db2f2(0x265)][_0x3db2f2(0x27a)])};}['createSegmentsGeometry'](_0x527a1e){const _0x142050=_0x32be77,_0xcea837=0x4;let _0x1680d8=[];for(let _0x1d7fb5=0x0;_0x1d7fb5<_0x527a1e[_0x142050(0x1cc)];_0x1d7fb5++){for(let _0x5b7627=0x0;_0x5b7627<_0x527a1e['particlesTextureSize'];_0x5b7627++){for(let _0x1b014c=0x0;_0x1b014c<_0xcea837;_0x1b014c++){_0x1680d8['push'](_0x1d7fb5/_0x527a1e['particlesTextureSize']),_0x1680d8['push'](_0x5b7627/_0x527a1e['particlesTextureSize']);}}}_0x1680d8=new Float32Array(_0x1680d8);let _0x4323d8=[];const _0x276223=[-0x1,0x1],_0x2980de=[-0x1,0x1];for(let _0x58b31e=0x0;_0x58b31e<_0x527a1e[_0x142050(0x1ff)];_0x58b31e++){for(let _0x4c71f5=0x0;_0x4c71f5<_0xcea837/0x2;_0x4c71f5++){for(let _0xc53efd=0x0;_0xc53efd<_0xcea837/0x2;_0xc53efd++){_0x4323d8[_0x142050(0x1ed)](_0x276223[_0x4c71f5]),_0x4323d8['push'](_0x2980de[_0xc53efd]),_0x4323d8[_0x142050(0x1ed)](0x0);}}}_0x4323d8=new Float32Array(_0x4323d8);const _0x105f3a=0x6*_0x527a1e['maxParticles'],_0x48c3b7=new Uint32Array(_0x105f3a);for(let _0x950116=0x0,_0xabae44=0x0,_0x551809=0x0;_0x950116<_0x527a1e['maxParticles'];_0x950116++){_0x48c3b7[_0xabae44++]=_0x551809+0x0,_0x48c3b7[_0xabae44++]=_0x551809+0x1,_0x48c3b7[_0xabae44++]=_0x551809+0x2,_0x48c3b7[_0xabae44++]=_0x551809+0x2,_0x48c3b7[_0xabae44++]=_0x551809+0x1,_0x48c3b7[_0xabae44++]=_0x551809+0x3,_0x551809+=0x4;}const _0x12db12=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x142050(0x1a8))]({'componentDatatype':Cesium$4[_0x142050(0x20d)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x1680d8}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x4323d8})}),'indices':_0x48c3b7});return _0x12db12;}['createRenderingPrimitives'](_0x32daa1,_0x1cbda8,_0x3ac20e,_0x5a6444){const _0x23e4c9=_0x32be77,_0x2c514e=this;this[_0x23e4c9(0x221)]={'segments':new CustomPrimitive({'commandType':_0x23e4c9(0x1a7),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x23e4c9(0x222)](_0x1cbda8),'primitiveType':Cesium$4[_0x23e4c9(0x276)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x1048a6=_0x23e4c9;return _0x5a6444[_0x1048a6(0x24c)]['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x4eec21=_0x23e4c9;return _0x5a6444['particlesTextures'][_0x4eec21(0x1c5)];},'postProcessingSpeed':function(){return _0x5a6444['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x535830=_0x23e4c9;return _0x2c514e[_0x535830(0x265)]['colorTable'];},'aspect':function(){const _0x5dab6d=_0x23e4c9;return _0x32daa1[_0x5dab6d(0x22a)]/_0x32daa1[_0x5dab6d(0x1f0)];},'pixelSize':function(){return _0x3ac20e['pixelSize'];},'lineWidth':function(){return _0x1cbda8['lineWidth'];},'particleHeight':function(){return _0x1cbda8['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x23e4c9(0x211))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x23e4c9(0x22b)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x23e4c9(0x276)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x2c514e['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x2c514e['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x2c514e['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x3866b2=_0x23e4c9;return _0x2c514e['framebuffers']['currentTrails'][_0x3866b2(0x293)];},'fadeOpacity':function(){return _0x1cbda8['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0x23e4c9(0x269)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x3069e9=_0x23e4c9,_0x25882c=_0x2c514e[_0x3069e9(0x21e)][_0x3069e9(0x259)];_0x2c514e['framebuffers'][_0x3069e9(0x259)]=_0x2c514e['framebuffers'][_0x3069e9(0x286)],_0x2c514e[_0x3069e9(0x21e)]['nextTrails']=_0x25882c,_0x2c514e['primitives'][_0x3069e9(0x21f)]['commandToExecute'][_0x3069e9(0x1c0)]=_0x2c514e[_0x3069e9(0x21e)]['nextTrails'],_0x2c514e['primitives'][_0x3069e9(0x21f)][_0x3069e9(0x1cf)][_0x3069e9(0x1c0)]=_0x2c514e[_0x3069e9(0x21e)][_0x3069e9(0x286)];}}),'screen':new CustomPrimitive({'commandType':_0x23e4c9(0x1a7),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x23e4c9(0x238)],'uniformMap':{'trailsColorTexture':function(){const _0x2d5e08=_0x23e4c9;return _0x2c514e['framebuffers'][_0x2d5e08(0x286)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x1a4a4f=_0x23e4c9;return _0x2c514e['framebuffers']['nextTrails'][_0x1a4a4f(0x293)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x23e4c9(0x22f)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x32be77(0x219),updatePosition_frag=_0x32be77(0x262),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x504fe4,_0x166d2d,_0x54e980,_0x3b30cf){this['data']=_0x166d2d,this['createWindTextures'](_0x504fe4,_0x166d2d),this['createParticlesTextures'](_0x504fe4,_0x54e980,_0x3b30cf),this['createComputingPrimitives'](_0x166d2d,_0x54e980,_0x3b30cf);}['createWindTextures'](_0x3ac103,_0x54dc18){const _0x529798=_0x32be77,_0x2a5e36={'context':_0x3ac103,'width':_0x54dc18['dimensions']['lon'],'height':_0x54dc18['dimensions'][_0x529798(0x207)]*(_0x54dc18[_0x529798(0x27e)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x529798(0x1c3)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x529798(0x1cd))]({'minificationFilter':Cesium$3[_0x529798(0x277)]['NEAREST'],'magnificationFilter':Cesium$3[_0x529798(0x1dd)]['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x2a5e36,_0x54dc18['U'][_0x529798(0x215)]),'V':Util[_0x529798(0x201)](_0x2a5e36,_0x54dc18['V']['array'])};}[_0x32be77(0x1e1)](_0x51b581,_0x20f02a,_0x441672){const _0x5af31e=_0x32be77,_0x5f4e58={'context':_0x51b581,'width':_0x20f02a['particlesTextureSize'],'height':_0x20f02a[_0x5af31e(0x1cc)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3[_0x5af31e(0x21d)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x5af31e(0x1cd))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x5af31e(0x1d5)]})},_0x1f09ac=this['randomizeParticles'](_0x20f02a[_0x5af31e(0x1ff)],_0x441672),_0x29ab9e=new Float32Array(0x4*_0x20f02a['maxParticles'])[_0x5af31e(0x24a)](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x5f4e58),'currentParticlesPosition':Util['createTexture'](_0x5f4e58,_0x1f09ac),'nextParticlesPosition':Util['createTexture'](_0x5f4e58,_0x1f09ac),'currentParticlesSpeed':Util['createTexture'](_0x5f4e58,_0x29ab9e),'nextParticlesSpeed':Util[_0x5af31e(0x201)](_0x5f4e58,_0x29ab9e),'postProcessingPosition':Util[_0x5af31e(0x201)](_0x5f4e58,_0x1f09ac),'postProcessingSpeed':Util[_0x5af31e(0x201)](_0x5f4e58,_0x29ab9e)};}['randomizeParticles'](_0x14dc0b,_0x398b00){const _0x20241a=_0x32be77,_0x595a5c=new Float32Array(0x4*_0x14dc0b);for(let _0x4e2d13=0x0;_0x4e2d13<_0x14dc0b;_0x4e2d13++){_0x595a5c[0x4*_0x4e2d13]=Cesium$3['Math'][_0x20241a(0x1f4)](_0x398b00[_0x20241a(0x22d)]['x'],_0x398b00[_0x20241a(0x22d)]['y']),_0x595a5c[0x4*_0x4e2d13+0x1]=Cesium$3['Math']['randomBetween'](_0x398b00['latRange']['x'],_0x398b00['latRange']['y']),_0x595a5c[0x4*_0x4e2d13+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this['data']['lev'][_0x20241a(0x1a9)]),_0x595a5c[0x4*_0x4e2d13+0x3]=0x0;}return _0x595a5c;}['destroyParticlesTextures'](){const _0x3fae88=_0x32be77;Object['keys'](this[_0x3fae88(0x24c)])['forEach'](_0x4543f9=>{const _0x4cdfc9=_0x3fae88;this[_0x4cdfc9(0x24c)][_0x4543f9]['destroy']();});}['createComputingPrimitives'](_0x1e1f95,_0x3fe311,_0x39e364){const _0xeb5a94=_0x32be77,_0x3322f7=new Cesium$3[(_0xeb5a94(0x1fb))](_0x1e1f95['dimensions'][_0xeb5a94(0x1e5)],_0x1e1f95[_0xeb5a94(0x27e)]['lat'],_0x1e1f95['dimensions']['lev']),_0x4a7fdd=new Cesium$3['Cartesian3'](_0x1e1f95['lon'][_0xeb5a94(0x249)],_0x1e1f95['lat']['min'],_0x1e1f95['lev']['min']),_0x12d6fa=new Cesium$3['Cartesian3'](_0x1e1f95['lon'][_0xeb5a94(0x1a9)],_0x1e1f95['lat'][_0xeb5a94(0x1a9)],_0x1e1f95['lev']['max']),_0x18c870=new Cesium$3[(_0xeb5a94(0x1fb))]((_0x12d6fa['x']-_0x4a7fdd['x'])/(_0x3322f7['x']-0x1),(_0x12d6fa['y']-_0x4a7fdd['y'])/(_0x3322f7['y']-0x1),_0x3322f7['z']>0x1?(_0x12d6fa['z']-_0x4a7fdd['z'])/(_0x3322f7['z']-0x1):0x1),_0x53c353=new Cesium$3['Cartesian2'](_0x1e1f95['U'][_0xeb5a94(0x249)],_0x1e1f95['U'][_0xeb5a94(0x1a9)]),_0xee12=new Cesium$3['Cartesian2'](_0x1e1f95['V']['min'],_0x1e1f95['V'][_0xeb5a94(0x1a9)]),_0x116d9d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x116d9d['windTextures']['U'];},'V':function(){return _0x116d9d['windTextures']['V'];},'currentParticlesPosition':function(){return _0x116d9d['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x3322f7;},'minimum':function(){return _0x4a7fdd;},'maximum':function(){return _0x12d6fa;},'interval':function(){return _0x18c870;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x44c469=_0xeb5a94;_0x116d9d['primitives'][_0x44c469(0x205)]['commandToExecute']['outputTexture']=_0x116d9d['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x116d9d['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x23d5d7=_0xeb5a94;return _0x116d9d[_0x23d5d7(0x24c)]['particlesWind'];},'uSpeedRange':function(){return _0x53c353;},'vSpeedRange':function(){return _0xee12;},'pixelSize':function(){return _0x39e364['pixelSize'];},'speedFactor':function(){return _0x3fe311['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0xeb5a94(0x24c)][_0xeb5a94(0x27b)],'preExecute':function(){const _0x4a95cb=_0xeb5a94,_0x47991b=_0x116d9d['particlesTextures'][_0x4a95cb(0x239)];_0x116d9d['particlesTextures']['currentParticlesSpeed']=_0x116d9d[_0x4a95cb(0x24c)]['postProcessingSpeed'],_0x116d9d['particlesTextures']['postProcessingSpeed']=_0x47991b,_0x116d9d['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x116d9d[_0x4a95cb(0x24c)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x1cade5=_0xeb5a94;return _0x116d9d[_0x1cade5(0x24c)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x116d9d['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x57c7ef=_0xeb5a94,_0x3ad368=_0x116d9d['particlesTextures'][_0x57c7ef(0x28f)];_0x116d9d['particlesTextures']['currentParticlesPosition']=_0x116d9d['particlesTextures']['postProcessingPosition'],_0x116d9d['particlesTextures']['postProcessingPosition']=_0x3ad368,_0x116d9d['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x116d9d['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0xeb5a94(0x21a),'uniformMap':{'nextParticlesPosition':function(){const _0x38f944=_0xeb5a94;return _0x116d9d[_0x38f944(0x24c)]['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x18416a=_0xeb5a94;return _0x116d9d[_0x18416a(0x24c)]['nextParticlesSpeed'];},'lonRange':function(){return _0x39e364['lonRange'];},'latRange':function(){return _0x39e364['latRange'];},'randomCoefficient':function(){const _0x6bdc03=Math['random']();return _0x6bdc03;},'dropRate':function(){return _0x3fe311['dropRate'];},'dropRateBump':function(){return _0x3fe311['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0xeb5a94(0x1c5)],'preExecute':function(){const _0xbd00f4=_0xeb5a94;_0x116d9d['primitives'][_0xbd00f4(0x1c5)][_0xbd00f4(0x224)]['outputTexture']=_0x116d9d['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0xeb5a94(0x21a),'uniformMap':{'postProcessingPosition':function(){return _0x116d9d['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x15f5c3=_0xeb5a94;return _0x116d9d[_0x15f5c3(0x24c)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0xeb5a94(0x211))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0xeb5a94(0x24c)]['postProcessingSpeed'],'preExecute':function(){const _0x668432=_0xeb5a94;_0x116d9d[_0x668432(0x221)][_0x668432(0x27c)]['commandToExecute']['outputTexture']=_0x116d9d[_0x668432(0x24c)][_0x668432(0x27c)];}})};}}const Cesium$2=mars3d__namespace[_0x32be77(0x26f)];class ParticleSystem{constructor(_0x3c7763,_0x3ffbbc,_0x274cac,_0x30e808){const _0x1eb17d=_0x32be77;this[_0x1eb17d(0x242)]=_0x3c7763,_0x3ffbbc={..._0x3ffbbc},_0x3ffbbc[_0x1eb17d(0x248)]&&_0x3ffbbc['vdata']&&(_0x3ffbbc['dimensions']={},_0x3ffbbc[_0x1eb17d(0x27e)]['lon']=_0x3ffbbc['cols'],_0x3ffbbc['dimensions'][_0x1eb17d(0x207)]=_0x3ffbbc[_0x1eb17d(0x1ab)],_0x3ffbbc['dimensions'][_0x1eb17d(0x223)]=_0x3ffbbc['lev']||0x1,_0x3ffbbc['lon']={},_0x3ffbbc['lon']['min']=_0x3ffbbc[_0x1eb17d(0x1b1)],_0x3ffbbc['lon'][_0x1eb17d(0x1a9)]=_0x3ffbbc['xmax'],_0x3ffbbc['lat']={},_0x3ffbbc['lat']['min']=_0x3ffbbc[_0x1eb17d(0x206)],_0x3ffbbc['lat']['max']=_0x3ffbbc['ymax'],_0x3ffbbc['lev']={},_0x3ffbbc[_0x1eb17d(0x223)]['min']=_0x3ffbbc['levmin']??0x1,_0x3ffbbc[_0x1eb17d(0x223)]['max']=_0x3ffbbc[_0x1eb17d(0x1ae)]??0x1,_0x3ffbbc['U']={},_0x3ffbbc['U'][_0x1eb17d(0x215)]=new Float32Array(_0x3ffbbc['udata']),_0x3ffbbc['U']['min']=_0x3ffbbc['umin']??Math['min'](..._0x3ffbbc['udata']),_0x3ffbbc['U']['max']=_0x3ffbbc[_0x1eb17d(0x21c)]??Math['max'](..._0x3ffbbc[_0x1eb17d(0x248)]),_0x3ffbbc['V']={},_0x3ffbbc['V']['array']=new Float32Array(_0x3ffbbc[_0x1eb17d(0x1c2)]),_0x3ffbbc['V'][_0x1eb17d(0x249)]=_0x3ffbbc['vmin']??Math['min'](..._0x3ffbbc['vdata']),_0x3ffbbc['V']['max']=_0x3ffbbc[_0x1eb17d(0x1e0)]??Math['max'](..._0x3ffbbc['vdata'])),this[_0x1eb17d(0x1bc)]=_0x3ffbbc,this[_0x1eb17d(0x28d)]=_0x274cac,this[_0x1eb17d(0x25f)]=_0x30e808,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x1eb17d(0x1bc)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x1eb17d(0x1bc)],this['options'],this[_0x1eb17d(0x25f)],this['particlesComputing']);}['canvasResize'](_0x26ba47){const _0x3005ee=_0x32be77;this[_0x3005ee(0x1c1)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x3005ee(0x1da)](_0x20b68b=>{const _0x2d10c6=_0x3005ee;this[_0x2d10c6(0x1c1)]['windTextures'][_0x20b68b]['destroy']();}),this[_0x3005ee(0x24b)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x3005ee(0x1da)](_0x3f701f=>{const _0x266ebd=_0x3005ee;this['particlesRendering']['framebuffers'][_0x3f701f][_0x266ebd(0x1bd)]();}),this['context']=_0x26ba47,this[_0x3005ee(0x1c1)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this[_0x3005ee(0x24b)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x12e3bc=_0x32be77,_0x3a9ab4=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x12e3bc(0x254))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x12e3bc(0x263)]['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x653dba=>{_0x3a9ab4['framebuffer']=this['particlesRendering']['framebuffers'][_0x653dba],_0x3a9ab4['execute'](this['context']);});}['refreshParticles'](_0x54fef2){const _0x12eedd=_0x32be77;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x12eedd(0x1e1)](this['context'],this[_0x12eedd(0x28d)],this[_0x12eedd(0x25f)]);if(_0x54fef2){const _0xb1b3ef=this['particlesRendering']['createSegmentsGeometry'](this[_0x12eedd(0x28d)]);this['particlesRendering']['primitives']['segments']['geometry']=_0xb1b3ef;const _0x11e0d1=Cesium$2['VertexArray'][_0x12eedd(0x252)]({'context':this['context'],'geometry':_0xb1b3ef,'attributeLocations':this['particlesRendering']['primitives']['segments'][_0x12eedd(0x1f3)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this['particlesRendering']['primitives']['segments']['commandToExecute'][_0x12eedd(0x20b)]=_0x11e0d1;}}['setOptions'](_0x130513){const _0x2ee93c=_0x32be77;let _0x12e6cc=![];this[_0x2ee93c(0x28d)]['maxParticles']!==_0x130513['maxParticles']&&(_0x12e6cc=!![]),Object['keys'](_0x130513)[_0x2ee93c(0x1da)](_0x44a1c5=>{this['options'][_0x44a1c5]=_0x130513[_0x44a1c5];}),this['refreshParticles'](_0x12e6cc);}['applyViewerParameters'](_0x470c5e){const _0x199f3=_0x32be77;Object[_0x199f3(0x1c6)](_0x470c5e)['forEach'](_0x5e4d16=>{this['viewerParameters'][_0x5e4d16]=_0x470c5e[_0x5e4d16];}),this['refreshParticles'](![]);}['destroy'](){const _0x35f4f3=_0x32be77;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x7d802d=>{this['particlesComputing']['windTextures'][_0x7d802d]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x35f4f3(0x1bd)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x5edef5=>{const _0x4a00b7=_0x35f4f3;this['particlesRendering']['framebuffers'][_0x5edef5][_0x4a00b7(0x1bd)]();});for(const _0x3a6b95 in this){delete this[_0x3a6b95];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x32be77(0x20f)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x32be77(0x233)]};class WindLayer extends BaseLayer$1{constructor(_0xcc938e={}){const _0x31fc64=_0x32be77;_0xcc938e={...DEF_OPTIONS,..._0xcc938e},super(_0xcc938e),this[_0x31fc64(0x283)](_0xcc938e);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set[_0x32be77(0x1bc)](_0x1fc368){this['setData'](_0x1fc368);}get['colors'](){const _0x1bcff9=_0x32be77;return this['options'][_0x1bcff9(0x20a)];}set[_0x32be77(0x20a)](_0x3fc635){const _0x2b4c93=_0x32be77;this['options'][_0x2b4c93(0x20a)]=_0x3fc635,this[_0x2b4c93(0x250)]&&this[_0x2b4c93(0x250)][_0x2b4c93(0x24e)]({'colors':_0x3fc635}),this['resize']();}[_0x32be77(0x23f)](){}['_addedHook'](){const _0x7ddca0=_0x32be77;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this[_0x7ddca0(0x221)]=new Cesium$1['PrimitiveCollection'](),this[_0x7ddca0(0x208)]['scene']['primitives'][_0x7ddca0(0x28c)](this[_0x7ddca0(0x221)]),this[_0x7ddca0(0x25f)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x7ddca0(0x229))](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x7ddca0(0x237)]('resize',this['resize'][_0x7ddca0(0x251)](this),![]),this['mouse_down']=![],this[_0x7ddca0(0x226)]=![],this['_map']['on'](mars3d__namespace[_0x7ddca0(0x245)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x7ddca0(0x208)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x7ddca0(0x1cb)]);}['_removedHook'](){const _0x4cadfd=_0x32be77;window[_0x4cadfd(0x1ad)]('resize',this['resize']),this['_map']['off'](mars3d__namespace[_0x4cadfd(0x245)]['preRender'],this[_0x4cadfd(0x1ac)],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x4cadfd(0x25d)],this),this['_map'][_0x4cadfd(0x1b3)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x4cadfd(0x245)]['mouseUp'],this['_onMouseUpEvent'],this),this[_0x4cadfd(0x208)][_0x4cadfd(0x1b3)](mars3d__namespace[_0x4cadfd(0x245)]['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives'][_0x4cadfd(0x1f1)](),this[_0x4cadfd(0x208)]['scene'][_0x4cadfd(0x221)]['remove'](this[_0x4cadfd(0x221)]);}['resize'](){const _0x5ca20b=_0x32be77;if(!this['show']||!this[_0x5ca20b(0x250)])return;this[_0x5ca20b(0x221)]['show']=![],this['primitives'][_0x5ca20b(0x1f1)](),this['_map'][_0x5ca20b(0x1b5)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x51ab8d){const _0x27afb9=_0x32be77;this[_0x27afb9(0x250)][_0x27afb9(0x244)](this['scene']['context']),this['addPrimitives'](),this['primitives'][_0x27afb9(0x1b4)]=!![];}[_0x32be77(0x25d)](_0x21dbe8){const _0x2420a4=_0x32be77;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x2420a4(0x1b4)]=![],this['refreshTimer']=setTimeout(()=>{const _0x414d78=_0x2420a4;if(!this[_0x414d78(0x1b4)])return;this['redraw']();},0xc8);}[_0x32be77(0x279)](_0x1e6497){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x57799d){const _0x4dd641=_0x32be77;if(!this['show']||!this['particleSystem'])return;this[_0x4dd641(0x200)]&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x28fffe){const _0x5202af=_0x32be77;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this[_0x5202af(0x200)]=![],this['mouse_move']=![];}[_0x32be77(0x23d)](){const _0x27f97a=_0x32be77;if(!this[_0x27f97a(0x208)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem'][_0x27f97a(0x1e3)](this['viewerParameters']),this['primitives']['show']=!![];}[_0x32be77(0x235)](_0x254574){const _0x55d7f9=_0x32be77;this['_data']=_0x254574,this['particleSystem']&&this['particleSystem']['destroy'](),this[_0x55d7f9(0x250)]=new ParticleSystem(this['scene']['context'],_0x254574,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x49b63b,_0x36a180){const _0x2e4bc1=_0x32be77;if(_0x49b63b)for(const _0x487b66 in _0x49b63b){this[_0x487b66]=_0x49b63b[_0x487b66];}this['particleSystem']&&this['particleSystem'][_0x2e4bc1(0x24e)](this['getOptions']());}['getOptions'](){const _0x4a8441=_0x32be77,_0x1217f7=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x1217f7*_0x1217f7,{'particlesTextureSize':_0x1217f7,'maxParticles':this[_0x4a8441(0x234)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x4a8441(0x28b)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x347fe4=_0x32be77;this['primitives']['add'](this['particleSystem'][_0x347fe4(0x1c1)][_0x347fe4(0x221)]['getWind']),this['primitives'][_0x347fe4(0x28c)](this['particleSystem'][_0x347fe4(0x1c1)]['primitives']['updateSpeed']),this['primitives']['add'](this[_0x347fe4(0x250)]['particlesComputing']['primitives'][_0x347fe4(0x24d)]),this['primitives']['add'](this[_0x347fe4(0x250)]['particlesComputing']['primitives']['postProcessingPosition']),this['primitives'][_0x347fe4(0x28c)](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x347fe4(0x221)]['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives'][_0x347fe4(0x21f)]),this[_0x347fe4(0x221)]['add'](this['particleSystem'][_0x347fe4(0x24b)]['primitives']['screen']);}['updateViewerParameters'](){const _0x14be9=_0x32be77;let _0x597811=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x597811){const _0x55fa31=this['_map']['getExtent']();_0x597811=Cesium$1[_0x14be9(0x266)][_0x14be9(0x1e2)](_0x55fa31['xmin'],_0x55fa31['ymin'],_0x55fa31['xmax'],_0x55fa31['ymax']);}const _0x327d83=Util[_0x14be9(0x25c)](_0x597811);this['viewerParameters']['lonRange']['x']=_0x327d83['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x327d83[_0x14be9(0x1e5)][_0x14be9(0x1a9)],this[_0x14be9(0x25f)]['latRange']['x']=_0x327d83['lat'][_0x14be9(0x249)],this['viewerParameters']['latRange']['y']=_0x327d83['lat']['max'];const _0x4f7018=this['camera']['getPixelSize'](this[_0x14be9(0x27f)],this['scene']['drawingBufferWidth'],this['scene'][_0x14be9(0x1f0)]);_0x4f7018>0x0&&(this['viewerParameters']['pixelSize']=_0x4f7018);}}mars3d__namespace[_0x32be77(0x20c)]['register']('wind',WindLayer),mars3d__namespace['layer'][_0x32be77(0x1b0)]=WindLayer;class CanvasParticle{constructor(){const _0x213ccd=_0x32be77;this[_0x213ccd(0x217)]=null,this['lat']=null,this['tlng']=null,this[_0x213ccd(0x257)]=null,this['age']=null;}['destroy'](){for(const _0x149d3f in this){delete this[_0x149d3f];}}}class CanvasWindField{constructor(_0x45d1c1){const _0x5168b5=_0x32be77;this[_0x5168b5(0x24e)](_0x45d1c1);}get['speedRate'](){const _0x5662ec=_0x32be77;return this[_0x5662ec(0x1df)];}set['speedRate'](_0x1498b0){const _0x769f7e=_0x32be77;this['_speedRate']=(0x64-(_0x1498b0>0x63?0x63:_0x1498b0))*0x64,this[_0x769f7e(0x202)]=[(this[_0x769f7e(0x280)]-this[_0x769f7e(0x1b1)])/this[_0x769f7e(0x1df)],(this['ymax']-this[_0x769f7e(0x206)])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set[_0x32be77(0x1d3)](_0x13916e){const _0x3c7add=_0x32be77;this[_0x3c7add(0x267)]=_0x13916e;}[_0x32be77(0x24e)](_0x25f1f5){const _0x2c05aa=_0x32be77;this['options']=_0x25f1f5,this['maxAge']=_0x25f1f5['maxAge']||0x78,this[_0x2c05aa(0x1aa)]=_0x25f1f5['speedRate']||0x32,this[_0x2c05aa(0x1fc)]=[];const _0x4930e9=_0x25f1f5[_0x2c05aa(0x234)]||0x1000;for(let _0x5767f9=0x0;_0x5767f9<_0x4930e9;_0x5767f9++){const _0x4b54f0=this['_randomParticle'](new CanvasParticle());this[_0x2c05aa(0x1fc)]['push'](_0x4b54f0);}}['setDate'](_0x3904ca){const _0x3147e6=_0x32be77;this['rows']=_0x3904ca['rows'],this['cols']=_0x3904ca['cols'],this[_0x3147e6(0x1b1)]=_0x3904ca[_0x3147e6(0x1b1)],this['xmax']=_0x3904ca['xmax'],this['ymin']=_0x3904ca['ymin'],this['ymax']=_0x3904ca['ymax'],this[_0x3147e6(0x1dc)]=[];const _0x505b0d=_0x3904ca['udata'],_0xbe79a9=_0x3904ca['vdata'];let _0x49885c=![];_0x505b0d['length']===this['rows']&&_0x505b0d[0x0][_0x3147e6(0x1d2)]===this[_0x3147e6(0x1c9)]&&(_0x49885c=!![]);let _0x13eef0=0x0,_0x25c50b=null,_0x312bd7=null;for(let _0x2d664f=0x0;_0x2d664f<this['rows'];_0x2d664f++){_0x25c50b=[];for(let _0x553ac7=0x0;_0x553ac7<this['cols'];_0x553ac7++,_0x13eef0++){_0x49885c?_0x312bd7=this['_calcUV'](_0x505b0d[_0x2d664f][_0x553ac7],_0xbe79a9[_0x2d664f][_0x553ac7]):_0x312bd7=this[_0x3147e6(0x1ce)](_0x505b0d[_0x13eef0],_0xbe79a9[_0x13eef0]),_0x25c50b['push'](_0x312bd7);}this[_0x3147e6(0x1dc)]['push'](_0x25c50b);}this['options'][_0x3147e6(0x1c7)]&&this['grid'][_0x3147e6(0x26b)]();}['clear'](){const _0x1cd00e=_0x32be77;delete this['rows'],delete this[_0x1cd00e(0x1c9)],delete this['xmin'],delete this['xmax'],delete this[_0x1cd00e(0x206)],delete this['ymax'],delete this['grid'],delete this['particles'];}['toGridXY'](_0x5e1c44,_0x14f384){const _0x2dfbcf=_0x32be77,_0xab0772=(_0x5e1c44-this['xmin'])/(this['xmax']-this['xmin'])*(this[_0x2dfbcf(0x1c9)]-0x1),_0x2633ce=(this['ymax']-_0x14f384)/(this['ymax']-this['ymin'])*(this[_0x2dfbcf(0x1ab)]-0x1);return[_0xab0772,_0x2633ce];}['getUVByXY'](_0x3698da,_0x44dd4d){const _0x31979a=_0x32be77;if(_0x3698da<0x0||_0x3698da>=this['cols']||_0x44dd4d>=this[_0x31979a(0x1ab)])return[0x0,0x0,0x0];const _0x2ca5fa=Math[_0x31979a(0x1de)](_0x3698da),_0x334265=Math[_0x31979a(0x1de)](_0x44dd4d);if(_0x2ca5fa===_0x3698da&&_0x334265===_0x44dd4d)return this['grid'][_0x44dd4d][_0x3698da];const _0x4eda1a=_0x2ca5fa+0x1,_0x381223=_0x334265+0x1,_0x246a54=this[_0x31979a(0x1b6)](_0x2ca5fa,_0x334265),_0x2febfa=this[_0x31979a(0x1b6)](_0x4eda1a,_0x334265),_0x325667=this['getUVByXY'](_0x2ca5fa,_0x381223),_0x32f39a=this[_0x31979a(0x1b6)](_0x4eda1a,_0x381223);let _0x201b44=null;try{_0x201b44=this['_bilinearInterpolation'](_0x3698da-_0x2ca5fa,_0x44dd4d-_0x334265,_0x246a54,_0x2febfa,_0x325667,_0x32f39a);}catch(_0x32f643){console[_0x31979a(0x1b9)](_0x3698da,_0x44dd4d);}return _0x201b44;}['_bilinearInterpolation'](_0x2094a9,_0x2097ea,_0x315dbc,_0x5a721b,_0x3bbe2a,_0x12aec3){const _0x58e97a=0x1-_0x2094a9,_0xf3945f=0x1-_0x2097ea,_0x5ae667=_0x58e97a*_0xf3945f,_0x1b19b1=_0x2094a9*_0xf3945f,_0x2b4acf=_0x58e97a*_0x2097ea,_0x1a8624=_0x2094a9*_0x2097ea,_0x2fd7e8=_0x315dbc[0x0]*_0x5ae667+_0x5a721b[0x0]*_0x1b19b1+_0x3bbe2a[0x0]*_0x2b4acf+_0x12aec3[0x0]*_0x1a8624,_0x48d52a=_0x315dbc[0x1]*_0x5ae667+_0x5a721b[0x1]*_0x1b19b1+_0x3bbe2a[0x1]*_0x2b4acf+_0x12aec3[0x1]*_0x1a8624;return this['_calcUV'](_0x2fd7e8,_0x48d52a);}[_0x32be77(0x1ce)](_0x38b776,_0x465bbf){return[+_0x38b776,+_0x465bbf,Math['sqrt'](_0x38b776*_0x38b776+_0x465bbf*_0x465bbf)];}['getUVByPoint'](_0x35c2a2,_0x41e6d5){if(!this['isInExtent'](_0x35c2a2,_0x41e6d5))return null;const _0x161eeb=this['toGridXY'](_0x35c2a2,_0x41e6d5),_0x4d7fd8=this['getUVByXY'](_0x161eeb[0x0],_0x161eeb[0x1]);return _0x4d7fd8;}['isInExtent'](_0x343af5,_0x22b8f5){const _0x40803b=_0x32be77;return _0x343af5>=this[_0x40803b(0x1b1)]&&_0x343af5<=this['xmax']&&_0x22b8f5>=this['ymin']&&_0x22b8f5<=this['ymax']?!![]:![];}[_0x32be77(0x1ef)](){const _0x272dc1=_0x32be77,_0x40696b=fRandomByfloat(this[_0x272dc1(0x1b1)],this['xmax']),_0x52eae5=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x52eae5,'lng':_0x40696b};}[_0x32be77(0x232)](){const _0x13af97=_0x32be77;let _0x460e0c,_0x30a974,_0x54d79c;for(let _0x38ff03=0x0,_0x381912=this['particles'][_0x13af97(0x1d2)];_0x38ff03<_0x381912;_0x38ff03++){let _0x1b96b8=this['particles'][_0x38ff03];_0x1b96b8['age']<=0x0&&(_0x1b96b8=this['_randomParticle'](_0x1b96b8));if(_0x1b96b8['age']>0x0){const _0x3adb9e=_0x1b96b8['tlng'],_0x2cfd58=_0x1b96b8[_0x13af97(0x257)];_0x54d79c=this['getUVByPoint'](_0x3adb9e,_0x2cfd58),_0x54d79c?(_0x460e0c=_0x3adb9e+this['_calc_speedRate'][0x0]*_0x54d79c[0x0],_0x30a974=_0x2cfd58+this['_calc_speedRate'][0x1]*_0x54d79c[0x1],_0x1b96b8['lng']=_0x3adb9e,_0x1b96b8[_0x13af97(0x207)]=_0x2cfd58,_0x1b96b8['tlng']=_0x460e0c,_0x1b96b8['tlat']=_0x30a974,_0x1b96b8['age']--):_0x1b96b8['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x5e76cb){const _0x9f48ee=_0x32be77;let _0x2f2630,_0x12275c;for(let _0x1fe5d7=0x0;_0x1fe5d7<0x1e;_0x1fe5d7++){_0x2f2630=this['getRandomLatLng'](),_0x12275c=this['getUVByPoint'](_0x2f2630['lng'],_0x2f2630[_0x9f48ee(0x207)]);if(_0x12275c&&_0x12275c[0x2]>0x0)break;}if(!_0x12275c)return _0x5e76cb;const _0x57cb28=_0x2f2630['lng']+this['_calc_speedRate'][0x0]*_0x12275c[0x0],_0x56a139=_0x2f2630['lat']+this['_calc_speedRate'][0x1]*_0x12275c[0x1];return _0x5e76cb['lng']=_0x2f2630['lng'],_0x5e76cb[_0x9f48ee(0x207)]=_0x2f2630['lat'],_0x5e76cb['tlng']=_0x57cb28,_0x5e76cb[_0x9f48ee(0x257)]=_0x56a139,_0x5e76cb['age']=Math['round'](Math['random']()*this['maxAge']),_0x5e76cb;}['destroy'](){for(const _0xa82170 in this){delete this[_0xa82170];}}}function fRandomByfloat(_0x5d6908,_0x8d407c){return _0x5d6908+Math['random']()*(_0x8d407c-_0x5d6908);}const Cesium=mars3d__namespace[_0x32be77(0x26f)],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x2a90d1={}){super(_0x2a90d1),this['_setOptionsHook'](_0x2a90d1),this['canvas']=null;}['_setOptionsHook'](_0x567675,_0x4ad1d9){const _0x5472b1=_0x32be77;this['frameTime']=0x3e8/(_0x567675[_0x5472b1(0x1d0)]||0xa),this[_0x5472b1(0x1f8)]=this['options']['pointerEvents']??![],this['color']=_0x567675[_0x5472b1(0x274)]||_0x5472b1(0x281),this['lineWidth']=_0x567675['lineWidth']||0x1,this['fixedHeight']=_0x567675[_0x5472b1(0x289)]??0x0,this['reverseY']=_0x567675[_0x5472b1(0x1c7)]??![],this['windField']&&this[_0x5472b1(0x26c)]['setOptions'](_0x567675);}get['layer'](){const _0x3a7dfc=_0x32be77;return this[_0x3a7dfc(0x1f2)];}get['canvasWidth'](){const _0x1af89b=_0x32be77;return this[_0x1af89b(0x208)][_0x1af89b(0x285)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0x58266e=_0x32be77;return this['_map']['scene'][_0x58266e(0x1f2)][_0x58266e(0x26a)];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x492350){const _0x34dd79=_0x32be77;this['_pointerEvents']=_0x492350;if(!this[_0x34dd79(0x1f2)])return;_0x492350?this['canvas']['style'][_0x34dd79(0x1b2)]='all':this['canvas']['style'][_0x34dd79(0x1b2)]=_0x34dd79(0x288);}get[_0x32be77(0x234)](){const _0xe24569=_0x32be77;return this[_0xe24569(0x28d)]['particlesNumber'];}set['particlesNumber'](_0x52511b){const _0x3ee25d=_0x32be77;this[_0x3ee25d(0x28d)]['particlesNumber']=_0x52511b,clearTimeout(this[_0x3ee25d(0x1db)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x5b5b34=_0x32be77;return this['options'][_0x5b5b34(0x1aa)];}set[_0x32be77(0x1aa)](_0x434194){const _0x102ad8=_0x32be77;this['options']['speedRate']=_0x434194,this['windField']&&(this['windField'][_0x102ad8(0x1aa)]=_0x434194);}get['maxAge'](){const _0x4c6275=_0x32be77;return this[_0x4c6275(0x28d)]['maxAge'];}set[_0x32be77(0x1d3)](_0x11e01e){this['options']['maxAge']=_0x11e01e,this['windField']&&(this['windField']['maxAge']=_0x11e01e);}get['data'](){return this['windData'];}set['data'](_0x3497a1){this['setData'](_0x3497a1);}['_showHook'](_0x465efa){const _0x2948da=_0x32be77;_0x465efa?this['_addedHook']():(this[_0x2948da(0x218)]&&(this['options']['data']=this[_0x2948da(0x218)]),this[_0x2948da(0x290)]());}['_mountedHook'](){const _0x230510=_0x32be77;this['options'][_0x230510(0x1f9)]?this[_0x230510(0x1c4)]():this['windField']=new CanvasWindField(this['options']);}[_0x32be77(0x287)](){const _0xcdbf7=_0x32be77;this['canvas']=this['_createCanvas'](),this[_0xcdbf7(0x1f6)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0xcdbf7(0x1ea)](),this['options']['data']&&this[_0xcdbf7(0x235)](this['options'][_0xcdbf7(0x1bc)]);}[_0x32be77(0x290)](){const _0x2114d3=_0x32be77;this['clear'](),this['unbindEvent'](),this[_0x2114d3(0x1f2)]&&(this['_map']['container']['removeChild'](this[_0x2114d3(0x1f2)]),delete this[_0x2114d3(0x1f2)]);}['_createCanvas'](){const _0x27ba2d=_0x32be77,_0x175073=mars3d__namespace['DomUtil']['create']('canvas',_0x27ba2d(0x1b8),this['_map'][_0x27ba2d(0x1d6)]);return _0x175073['style']['position']='absolute',_0x175073['style']['top']='0px',_0x175073['style']['left']='0px',_0x175073['style']['width']=this[_0x27ba2d(0x208)]['scene'][_0x27ba2d(0x1f2)]['clientWidth']+'px',_0x175073['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x175073['style']['pointerEvents']=this[_0x27ba2d(0x1f8)]?_0x27ba2d(0x228):_0x27ba2d(0x288),_0x175073['style']['zIndex']=this['options']['zIndex']??0x9,_0x175073['width']=this['_map']['scene'][_0x27ba2d(0x1f2)]['clientWidth'],_0x175073['height']=this[_0x27ba2d(0x208)]['scene'][_0x27ba2d(0x1f2)]['clientHeight'],_0x175073;}[_0x32be77(0x1f5)](){const _0x1049e6=_0x32be77;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas'][_0x1049e6(0x1ba)]+'px',this[_0x1049e6(0x1f2)]['style']['height']=this['_map'][_0x1049e6(0x285)]['canvas']['clientHeight']+'px',this['canvas']['width']=this[_0x1049e6(0x208)][_0x1049e6(0x285)]['canvas'][_0x1049e6(0x1ba)],this['canvas']['height']=this['_map']['scene'][_0x1049e6(0x1f2)][_0x1049e6(0x26a)]);}['bindEvent'](){const _0x350416=_0x32be77,_0x4dd359=this;let _0x3d062d=Date['now']();(function _0x596cf7(){const _0x484818=_0x4a16;_0x4dd359['animateFrame']=window[_0x484818(0x231)](_0x596cf7);if(_0x4dd359['show']&&_0x4dd359['windField']){const _0x12309e=Date['now'](),_0x321b88=_0x12309e-_0x3d062d;_0x321b88>_0x4dd359['frameTime']&&(_0x3d062d=_0x12309e-_0x321b88%_0x4dd359[_0x484818(0x209)],_0x4dd359[_0x484818(0x20e)]());}}(),window['addEventListener'](_0x350416(0x1f5),this[_0x350416(0x1f5)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x350416(0x28d)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace[_0x350416(0x245)][_0x350416(0x271)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x350416(0x245)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x350416(0x260)],this)));}['unbindEvent'](){const _0x430fb6=_0x32be77;window[_0x430fb6(0x1d1)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace[_0x430fb6(0x245)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x430fb6(0x208)]['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x430fb6(0x260)],this),this['_map']['off'](mars3d__namespace[_0x430fb6(0x245)][_0x430fb6(0x243)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x6e9277){clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x5eb9ef=_0x4a16;if(!this['show'])return;this['redraw'](),this[_0x5eb9ef(0x1f2)]['style']['visibility']=_0x5eb9ef(0x23c);},0xc8);}['_onMouseDownEvent'](_0x49b9fc){const _0x30e34f=_0x32be77;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x30e34f(0x245)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x32be77(0x26d)](_0x55b4de){const _0x36445a=_0x32be77;if(!this['show']||!this[_0x36445a(0x1f2)])return;this['mouse_down']&&(this['canvas']['style']['visibility']=_0x36445a(0x1be),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x49be6b){const _0x545537=_0x32be77;if(!this['show']||!this[_0x545537(0x1f2)])return;this[_0x545537(0x208)]['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x545537(0x26d)],this),this['mouse_down']&&this[_0x545537(0x226)]&&this['redraw'](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x16c3b0){const _0x33732c=_0x32be77;this['clear'](),this[_0x33732c(0x218)]=_0x16c3b0,this['windField']['setDate'](_0x16c3b0),this[_0x33732c(0x23d)]();}[_0x32be77(0x23d)](){const _0x2f932a=_0x32be77;if(!this['show'])return;this[_0x2f932a(0x26c)]['setOptions'](this['options']),this['update']();}[_0x32be77(0x20e)](){const _0x31bc5c=_0x32be77;if(this['_updateIng'])return;this[_0x31bc5c(0x247)]=!![];if(this['worker'])this['windField']['update']();else{const _0x3ee0d8=this[_0x31bc5c(0x26c)][_0x31bc5c(0x232)]();this['_drawLines'](_0x3ee0d8);}this['_updateIng']=![];}['_drawLines'](_0xbf83f3){const _0x8af3fd=_0x32be77;this[_0x8af3fd(0x1f6)]['globalCompositeOperation']='destination-in',this['canvasContext'][_0x8af3fd(0x1d7)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this[_0x8af3fd(0x1f6)][_0x8af3fd(0x27d)]='lighter',this[_0x8af3fd(0x1f6)]['globalAlpha']=0.9,this['canvasContext']['beginPath'](),this['canvasContext'][_0x8af3fd(0x236)]=this['lineWidth'],this[_0x8af3fd(0x1f6)]['strokeStyle']=this['color'];const _0x35dabe=this['_map']['scene']['mode']!==Cesium[_0x8af3fd(0x225)]['SCENE3D'],_0x2a4d05=this[_0x8af3fd(0x1d9)]*0.25;for(let _0x6bc978=0x0,_0x147e0e=_0xbf83f3['length'];_0x6bc978<_0x147e0e;_0x6bc978++){const _0x4d2536=_0xbf83f3[_0x6bc978],_0x4e1bc6=this[_0x8af3fd(0x26e)](_0x4d2536['lng'],_0x4d2536['lat'],_0x4d2536),_0x4f1d93=this[_0x8af3fd(0x26e)](_0x4d2536['tlng'],_0x4d2536['tlat'],_0x4d2536);if(!_0x4e1bc6||!_0x4f1d93)continue;if(_0x35dabe&&Math[_0x8af3fd(0x1ec)](_0x4e1bc6[0x0]-_0x4f1d93[0x0])>=_0x2a4d05)continue;this[_0x8af3fd(0x1f6)]['moveTo'](_0x4e1bc6[0x0],_0x4e1bc6[0x1]),this[_0x8af3fd(0x1f6)]['lineTo'](_0x4f1d93[0x0],_0x4f1d93[0x1]);}this[_0x8af3fd(0x1f6)][_0x8af3fd(0x270)]();}['_tomap'](_0x281952,_0x3f3649,_0x90a94c){const _0x446c9f=_0x32be77,_0x153b43=Cesium['Cartesian3']['fromDegrees'](_0x281952,_0x3f3649,this[_0x446c9f(0x289)]),_0xc5eb3a=this[_0x446c9f(0x208)]['scene'];if(_0xc5eb3a[_0x446c9f(0x1e8)]===Cesium['SceneMode']['SCENE3D']){const _0x1d1f10=new Cesium['EllipsoidalOccluder'](_0xc5eb3a['globe']['ellipsoid'],_0xc5eb3a['camera']['positionWC']),_0x1a25f9=_0x1d1f10['isPointVisible'](_0x153b43);if(!_0x1a25f9)return _0x90a94c[_0x446c9f(0x1fd)]=0x0,null;}const _0x3bfbc6=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x153b43);return _0x3bfbc6?[_0x3bfbc6['x'],_0x3bfbc6['y']]:null;}[_0x32be77(0x1eb)](){const _0x52ad89=_0x32be77;this['windField'][_0x52ad89(0x1eb)](),delete this['windData'];}[_0x32be77(0x1c4)](){const _0x53c592=_0x32be77;this['worker']=new Worker(this['options']['worker']),this['worker'][_0x53c592(0x1ee)]=_0x560d9c=>{const _0x47f644=_0x53c592;this['_drawLines'](_0x560d9c['data'][_0x47f644(0x1fc)]),this[_0x47f644(0x1fa)]=![];},this[_0x53c592(0x26c)]={'init':_0x1b5d15=>{this['worker']['postMessage']({'type':'init','options':_0x1b5d15});},'setOptions':_0x6217b=>{const _0xbbc2eb=_0x53c592;this['worker']['postMessage']({'type':_0xbbc2eb(0x24e),'options':_0x6217b});},'setDate':_0xc043b=>{const _0x593de3=_0x53c592;this[_0x593de3(0x1f9)]['postMessage']({'type':_0x593de3(0x246),'data':_0xc043b});},'update':()=>{const _0x319338=_0x53c592;if(this[_0x319338(0x1fa)])return;this[_0x319338(0x1fa)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x236792=_0x53c592;this['worker'][_0x236792(0x212)]({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x32be77(0x20c)][_0x32be77(0x282)](_0x32be77(0x22e),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
