/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.0
 * 编译日期：2023-08-04 12:47:41
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x40c690=_0x5986;(function(_0x4d1ecb,_0x419d6a){const _0x584b37=_0x5986,_0x272cc0=_0x4d1ecb();while(!![]){try{const _0x3d9e45=parseInt(_0x584b37(0x163))/0x1+-parseInt(_0x584b37(0x168))/0x2+parseInt(_0x584b37(0x157))/0x3+parseInt(_0x584b37(0x1f3))/0x4*(-parseInt(_0x584b37(0x1f6))/0x5)+parseInt(_0x584b37(0x1b9))/0x6*(parseInt(_0x584b37(0x175))/0x7)+parseInt(_0x584b37(0x1f2))/0x8+parseInt(_0x584b37(0x1da))/0x9*(-parseInt(_0x584b37(0x1c3))/0xa);if(_0x3d9e45===_0x419d6a)break;else _0x272cc0['push'](_0x272cc0['shift']());}catch(_0x14265a){_0x272cc0['push'](_0x272cc0['shift']());}}}(_0x48e8,0xcb46f));function _interopNamespace(_0x2cd287){const _0x5e676f=_0x5986;if(_0x2cd287&&_0x2cd287['__esModule'])return _0x2cd287;var _0x295c75=Object['create'](null);return _0x2cd287&&Object['keys'](_0x2cd287)['forEach'](function(_0x3f9522){const _0x4dac94=_0x5986;if(_0x3f9522!=='default'){var _0x490d07=Object['getOwnPropertyDescriptor'](_0x2cd287,_0x3f9522);Object['defineProperty'](_0x295c75,_0x3f9522,_0x490d07[_0x4dac94(0x203)]?_0x490d07:{'enumerable':!![],'get':function(){return _0x2cd287[_0x3f9522];}});}}),_0x295c75[_0x5e676f(0x1f4)]=_0x2cd287,_0x295c75;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x40c690(0x1e3)];function getU(_0x555630,_0x4a9173){const _0x12d08a=_0x40c690,_0xb53e6d=_0x555630*Math[_0x12d08a(0x1df)](Cesium$7['Math']['toRadians'](_0x4a9173));return _0xb53e6d;}function getV(_0x4f3b5a,_0x4dffd0){const _0x466f7a=_0x40c690,_0x547fd5=_0x4f3b5a*Math['sin'](Cesium$7[_0x466f7a(0x173)][_0x466f7a(0x206)](_0x4dffd0));return _0x547fd5;}function getSpeed(_0x4465fd,_0x16cbea){const _0x459418=_0x40c690,_0x634952=Math[_0x459418(0x1ce)](Math['pow'](_0x4465fd,0x2)+Math['pow'](_0x16cbea,0x2));return _0x634952;}function getDirection(_0x4cc870,_0x477934){const _0x41e7b3=_0x40c690;let _0x58421b=Cesium$7[_0x41e7b3(0x173)]['toDegrees'](Math['atan2'](_0x477934,_0x4cc870));return _0x58421b+=_0x58421b<0x0?0x168:0x0,_0x58421b;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x40c690(0x1e3)];class CustomPrimitive{constructor(_0xf6fa1d){const _0x29cd5d=_0x40c690;this[_0x29cd5d(0x15e)]=_0xf6fa1d['commandType'],this['geometry']=_0xf6fa1d['geometry'],this['attributeLocations']=_0xf6fa1d[_0x29cd5d(0x1d6)],this[_0x29cd5d(0x19b)]=_0xf6fa1d['primitiveType'],this['uniformMap']=_0xf6fa1d[_0x29cd5d(0x190)],this['vertexShaderSource']=_0xf6fa1d['vertexShaderSource'],this['fragmentShaderSource']=_0xf6fa1d[_0x29cd5d(0x158)],this['rawRenderState']=_0xf6fa1d['rawRenderState'],this[_0x29cd5d(0x1a9)]=_0xf6fa1d['framebuffer'],this['outputTexture']=_0xf6fa1d['outputTexture'],this['autoClear']=_0xf6fa1d['autoClear']??![],this[_0x29cd5d(0x1d2)]=_0xf6fa1d['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x29cd5d(0x1e2)]=new Cesium$6[(_0x29cd5d(0x208))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x29cd5d(0x1a6)]}));}[_0x40c690(0x1f5)](_0x116c03){const _0xedb447=_0x40c690;switch(this['commandType']){case _0xedb447(0x1e6):{const _0x1aa69d=Cesium$6['VertexArray']['fromGeometry']({'context':_0x116c03,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0xd09ec9=Cesium$6['ShaderProgram']['fromCache']({'context':_0x116c03,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0xedb447(0x229)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x48f3ac=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0xedb447(0x19b)],'shaderProgram':_0xd09ec9,'vertexArray':_0x1aa69d,'modelMatrix':Cesium$6['Matrix4'][_0xedb447(0x1e4)],'renderState':_0x48f3ac,'uniformMap':this[_0xedb447(0x190)],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0xedb447(0x1a9)],'pass':Cesium$6[_0xedb447(0x1f8)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0x40c690(0x1ab)](_0x455208,_0x34fff1){const _0x5eaa5c=_0x40c690;this['geometry']=_0x34fff1;const _0x3a65f0=Cesium$6['VertexArray']['fromGeometry']({'context':_0x455208,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x5eaa5c(0x16b)]['STATIC_DRAW']});this['commandToExecute'][_0x5eaa5c(0x162)]=_0x3a65f0;}['update'](_0x429607){const _0x4592dc=_0x40c690;if(!this['show'])return;if(_0x429607[_0x4592dc(0x1b4)]!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x4592dc(0x1d0)]=this[_0x4592dc(0x1f5)](_0x429607['context'])),Cesium$6['defined'](this['preExecute'])&&this[_0x4592dc(0x1d2)](),Cesium$6['defined'](this['clearCommand'])&&_0x429607['commandList'][_0x4592dc(0x164)](this['clearCommand']),_0x429607['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x2de86a=_0x40c690;if(this[_0x2de86a(0x1e2)]){var _0x58f733,_0x1b7050;(_0x58f733=this['clearCommand'])!==null&&_0x58f733!==void 0x0&&_0x58f733['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x1b7050=this['clearCommand'])!==null&&_0x1b7050!==void 0x0&&_0x1b7050['shaderProgram']&&this['clearCommand'][_0x2de86a(0x212)]['destroy'](),delete this[_0x2de86a(0x1e2)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute'][_0x2de86a(0x162)][_0x2de86a(0x1dd)](),this['commandToExecute']['shaderProgram']&&this[_0x2de86a(0x1d0)][_0x2de86a(0x212)]['destroy'](),delete this['commandToExecute']),Cesium$6[_0x2de86a(0x1cd)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x11a65c=function(){const _0xc25e5b=_0x5986,_0x3b79ef=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0xc25e5b(0x1a7))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0xc25e5b(0x174))]({'componentDatatype':Cesium$5[_0xc25e5b(0x20c)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x3b79ef;},_0x2c1642=function(_0x6b4fe3,_0xadf798){const _0x40de63=_0x5986;if(Cesium$5['defined'](_0xadf798)){const _0x1ab3cd={};_0x1ab3cd[_0x40de63(0x1dc)]=_0xadf798,_0x6b4fe3[_0x40de63(0x1e0)]=_0x1ab3cd;}const _0x46ee4d=new Cesium$5['Texture'](_0x6b4fe3);return _0x46ee4d;},_0x3e25b0=function(_0x33d4ed,_0x2ac54c,_0x5b3948){const _0x5edbb6=new Cesium$5['Framebuffer']({'context':_0x33d4ed,'colorTextures':[_0x2ac54c],'depthTexture':_0x5b3948});return _0x5edbb6;},_0x8d2f5f=function(_0x4429c1){const _0x4288c4=_0x5986,_0x360c9a=!![],_0x147637=![],_0x183bbf={'viewport':_0x4429c1[_0x4288c4(0x179)],'depthTest':_0x4429c1[_0x4288c4(0x14f)],'depthMask':_0x4429c1['depthMask'],'blending':_0x4429c1['blending']},_0x379304=Cesium$5['Appearance'][_0x4288c4(0x18d)](_0x360c9a,_0x147637,_0x183bbf);return _0x379304;},_0x4bcd31=function(_0x4d4e8f){const _0x331c5b=_0x5986,_0x2e8714={},_0x38521e=Cesium$5[_0x331c5b(0x173)]['mod'](_0x4d4e8f[_0x331c5b(0x221)],Cesium$5['Math']['TWO_PI']),_0x522422=Cesium$5['Math'][_0x331c5b(0x13e)](_0x4d4e8f[_0x331c5b(0x143)],Cesium$5['Math']['TWO_PI']),_0x1dd5c3=_0x4d4e8f['width'];let _0x3c2c49,_0x11c0c2;_0x1dd5c3>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x3c2c49=0x0,_0x11c0c2=Cesium$5['Math'][_0x331c5b(0x150)]):_0x522422-_0x38521e<_0x1dd5c3?(_0x3c2c49=_0x38521e,_0x11c0c2=_0x38521e+_0x1dd5c3):(_0x3c2c49=_0x38521e,_0x11c0c2=_0x522422);_0x2e8714['lon']={'min':Cesium$5['Math']['toDegrees'](_0x3c2c49),'max':Cesium$5['Math'][_0x331c5b(0x1d3)](_0x11c0c2)};const _0x4b4aba=_0x4d4e8f['south'],_0x4ae1cb=_0x4d4e8f[_0x331c5b(0x15d)],_0x3e9f88=_0x4d4e8f['height'],_0x283e6c=_0x3e9f88>Cesium$5['Math']['PI']/0xc?_0x3e9f88/0x2:0x0;let _0x2af9d1=Cesium$5[_0x331c5b(0x173)]['clampToLatitudeRange'](_0x4b4aba-_0x283e6c),_0x2237d3=Cesium$5['Math']['clampToLatitudeRange'](_0x4ae1cb+_0x283e6c);return _0x2af9d1<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x2af9d1=-Cesium$5[_0x331c5b(0x173)]['PI_OVER_TWO']),_0x2237d3>Cesium$5['Math']['PI_OVER_THREE']&&(_0x2237d3=Cesium$5['Math']['PI_OVER_TWO']),_0x2e8714[_0x331c5b(0x141)]={'min':Cesium$5['Math']['toDegrees'](_0x2af9d1),'max':Cesium$5[_0x331c5b(0x173)]['toDegrees'](_0x2237d3)},_0x2e8714;};return{'getFullscreenQuad':_0x11a65c,'createTexture':_0x2c1642,'createFramebuffer':_0x3e25b0,'createRawRenderState':_0x8d2f5f,'viewRectangleToLonLatRange':_0x4bcd31};}());var segmentDraw_vert=_0x40c690(0x1c8),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x40c690(0x148),screenDraw_frag=_0x40c690(0x14e);function _0x5986(_0x118bf4,_0x2b628e){const _0x48e801=_0x48e8();return _0x5986=function(_0x598672,_0x55bfd0){_0x598672=_0x598672-0x13c;let _0x230694=_0x48e801[_0x598672];return _0x230694;},_0x5986(_0x118bf4,_0x2b628e);}const Cesium$4=mars3d__namespace[_0x40c690(0x1e3)];class ParticlesRendering{constructor(_0x112e58,_0x31f787,_0x1ce126,_0x4e6d84,_0x3c604c){this['createRenderingTextures'](_0x112e58,_0x31f787,_0x1ce126['colors']),this['createRenderingFramebuffers'](_0x112e58),this['createRenderingPrimitives'](_0x112e58,_0x1ce126,_0x4e6d84,_0x3c604c);}[_0x40c690(0x219)](_0x4381eb,_0xb1559a,_0x219e20){const _0x3924d8=_0x40c690,_0x3decdb={'context':_0x4381eb,'width':_0x4381eb['drawingBufferWidth'],'height':_0x4381eb['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x3924d8(0x216)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x3924d8(0x13c)]},_0x56fedf={'context':_0x4381eb,'width':_0x4381eb[_0x3924d8(0x1d9)],'height':_0x4381eb['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x3924d8(0x149)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x52e3ef=_0x219e20[_0x3924d8(0x176)],_0x574575=new Float32Array(_0x52e3ef*0x3);for(let _0x3b2294=0x0;_0x3b2294<_0x52e3ef;_0x3b2294++){const _0x356f1f=Cesium$4['Color']['fromCssColorString'](_0x219e20[_0x3b2294]);_0x574575[0x3*_0x3b2294]=_0x356f1f['red'],_0x574575[0x3*_0x3b2294+0x1]=_0x356f1f['green'],_0x574575[0x3*_0x3b2294+0x2]=_0x356f1f[_0x3924d8(0x199)];}const _0x4adc8c={'context':_0x4381eb,'width':_0x52e3ef,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x3924d8(0x18a)],'pixelDatatype':Cesium$4[_0x3924d8(0x1a1)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x3924d8(0x16d)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x3decdb),'segmentsDepth':Util[_0x3924d8(0x202)](_0x56fedf),'currentTrailsColor':Util['createTexture'](_0x3decdb),'currentTrailsDepth':Util['createTexture'](_0x56fedf),'nextTrailsColor':Util['createTexture'](_0x3decdb),'nextTrailsDepth':Util['createTexture'](_0x56fedf),'colorTable':Util['createTexture'](_0x4adc8c,_0x574575)};}['createRenderingFramebuffers'](_0x1f0edf){const _0x507ce3=_0x40c690;this['framebuffers']={'segments':Util[_0x507ce3(0x21a)](_0x1f0edf,this['textures']['segmentsColor'],this['textures'][_0x507ce3(0x215)]),'currentTrails':Util['createFramebuffer'](_0x1f0edf,this['textures'][_0x507ce3(0x222)],this['textures']['currentTrailsDepth']),'nextTrails':Util[_0x507ce3(0x21a)](_0x1f0edf,this['textures'][_0x507ce3(0x1e1)],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x3ba7e0){const _0x4856c0=_0x40c690,_0x3fdddb=0x4;let _0x4dd7df=[];for(let _0x34c962=0x0;_0x34c962<_0x3ba7e0['particlesTextureSize'];_0x34c962++){for(let _0x3ba411=0x0;_0x3ba411<_0x3ba7e0['particlesTextureSize'];_0x3ba411++){for(let _0x280f56=0x0;_0x280f56<_0x3fdddb;_0x280f56++){_0x4dd7df[_0x4856c0(0x164)](_0x34c962/_0x3ba7e0['particlesTextureSize']),_0x4dd7df[_0x4856c0(0x164)](_0x3ba411/_0x3ba7e0['particlesTextureSize']);}}}_0x4dd7df=new Float32Array(_0x4dd7df);let _0x3f51fc=[];const _0x140738=[-0x1,0x1],_0x20858e=[-0x1,0x1];for(let _0x419e38=0x0;_0x419e38<_0x3ba7e0['maxParticles'];_0x419e38++){for(let _0x2f4131=0x0;_0x2f4131<_0x3fdddb/0x2;_0x2f4131++){for(let _0x46230b=0x0;_0x46230b<_0x3fdddb/0x2;_0x46230b++){_0x3f51fc['push'](_0x140738[_0x2f4131]),_0x3f51fc['push'](_0x20858e[_0x46230b]),_0x3f51fc[_0x4856c0(0x164)](0x0);}}}_0x3f51fc=new Float32Array(_0x3f51fc);const _0xd1e4e1=0x6*_0x3ba7e0[_0x4856c0(0x1ec)],_0x496de=new Uint32Array(_0xd1e4e1);for(let _0x391777=0x0,_0x5ba32d=0x0,_0x4af98f=0x0;_0x391777<_0x3ba7e0['maxParticles'];_0x391777++){_0x496de[_0x5ba32d++]=_0x4af98f+0x0,_0x496de[_0x5ba32d++]=_0x4af98f+0x1,_0x496de[_0x5ba32d++]=_0x4af98f+0x2,_0x496de[_0x5ba32d++]=_0x4af98f+0x2,_0x496de[_0x5ba32d++]=_0x4af98f+0x1,_0x496de[_0x5ba32d++]=_0x4af98f+0x3,_0x4af98f+=0x4;}const _0x5d2cfa=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x4856c0(0x174))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x4dd7df}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x3f51fc})}),'indices':_0x496de});return _0x5d2cfa;}[_0x40c690(0x224)](_0x1ae0b0,_0x3b9543,_0x32660e,_0x388a4b){const _0x1d4c83=_0x40c690,_0x22713f=this;this[_0x1d4c83(0x1f7)]={'segments':new CustomPrimitive({'commandType':_0x1d4c83(0x1e6),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x3b9543),'primitiveType':Cesium$4[_0x1d4c83(0x1d4)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x388a4b['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x388a4b['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x388a4b['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x22713f['textures']['colorTable'];},'aspect':function(){const _0x366b52=_0x1d4c83;return _0x1ae0b0[_0x366b52(0x1d9)]/_0x1ae0b0['drawingBufferHeight'];},'pixelSize':function(){return _0x32660e['pixelSize'];},'lineWidth':function(){const _0x20e5f9=_0x1d4c83;return _0x3b9543[_0x20e5f9(0x1b1)];},'particleHeight':function(){return _0x3b9543['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x1d4c83(0x19f)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x1d4c83(0x16f)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x22713f['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x5c8b21=_0x1d4c83;return _0x22713f[_0x5c8b21(0x225)]['segmentsDepth'];},'currentTrailsColor':function(){const _0xd2013f=_0x1d4c83;return _0x22713f[_0xd2013f(0x185)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x690b9=_0x1d4c83;return _0x22713f[_0x690b9(0x185)]['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x3b9543['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x1d4c83(0x1cb)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x1d4c83(0x1fc))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x1a3ad7=_0x1d4c83,_0x199450=_0x22713f['framebuffers']['currentTrails'];_0x22713f['framebuffers'][_0x1a3ad7(0x1cf)]=_0x22713f['framebuffers']['nextTrails'],_0x22713f['framebuffers']['nextTrails']=_0x199450,_0x22713f[_0x1a3ad7(0x1f7)][_0x1a3ad7(0x152)]['commandToExecute'][_0x1a3ad7(0x1a9)]=_0x22713f['framebuffers']['nextTrails'],_0x22713f['primitives']['trails']['clearCommand']['framebuffer']=_0x22713f['framebuffers'][_0x1a3ad7(0x205)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x1d4c83(0x1d4)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x8ee660=_0x1d4c83;return _0x22713f[_0x8ee660(0x185)][_0x8ee660(0x205)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x47ea78=_0x1d4c83;return _0x22713f[_0x47ea78(0x185)][_0x47ea78(0x205)][_0x47ea78(0x228)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x40c690(0x17c),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x246b32,_0x158ebd,_0x51ee23,_0x13f258){this['data']=_0x158ebd,this['createWindTextures'](_0x246b32,_0x158ebd),this['createParticlesTextures'](_0x246b32,_0x51ee23,_0x13f258),this['createComputingPrimitives'](_0x158ebd,_0x51ee23,_0x13f258);}['createWindTextures'](_0x439c2b,_0x574dbf){const _0x59cf86=_0x40c690,_0x3b38b1={'context':_0x439c2b,'width':_0x574dbf['dimensions']['lon'],'height':_0x574dbf['dimensions']['lat']*(_0x574dbf['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x59cf86(0x160)],'pixelDatatype':Cesium$3[_0x59cf86(0x1a1)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x59cf86(0x13f))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x59cf86(0x165)]['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x3b38b1,_0x574dbf['U']['array']),'V':Util[_0x59cf86(0x202)](_0x3b38b1,_0x574dbf['V']['array'])};}['createParticlesTextures'](_0x493ff3,_0x392cb0,_0x52f48c){const _0x1b0623=_0x40c690,_0x2d09d0={'context':_0x493ff3,'width':_0x392cb0['particlesTextureSize'],'height':_0x392cb0['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x1b0623(0x16d)][_0x1b0623(0x197)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x3833dd=this[_0x1b0623(0x171)](_0x392cb0[_0x1b0623(0x1ec)],_0x52f48c),_0x26338a=new Float32Array(0x4*_0x392cb0['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x2d09d0),'currentParticlesPosition':Util[_0x1b0623(0x202)](_0x2d09d0,_0x3833dd),'nextParticlesPosition':Util['createTexture'](_0x2d09d0,_0x3833dd),'currentParticlesSpeed':Util['createTexture'](_0x2d09d0,_0x26338a),'nextParticlesSpeed':Util[_0x1b0623(0x202)](_0x2d09d0,_0x26338a),'postProcessingPosition':Util['createTexture'](_0x2d09d0,_0x3833dd),'postProcessingSpeed':Util[_0x1b0623(0x202)](_0x2d09d0,_0x26338a)};}['randomizeParticles'](_0x97ebee,_0x20a961){const _0x232af7=_0x40c690,_0x37a394=new Float32Array(0x4*_0x97ebee);for(let _0x1f5a5f=0x0;_0x1f5a5f<_0x97ebee;_0x1f5a5f++){_0x37a394[0x4*_0x1f5a5f]=Cesium$3[_0x232af7(0x173)]['randomBetween'](_0x20a961[_0x232af7(0x210)]['x'],_0x20a961['lonRange']['y']),_0x37a394[0x4*_0x1f5a5f+0x1]=Cesium$3['Math'][_0x232af7(0x194)](_0x20a961[_0x232af7(0x21b)]['x'],_0x20a961['latRange']['y']),_0x37a394[0x4*_0x1f5a5f+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this['data'][_0x232af7(0x192)]['max']),_0x37a394[0x4*_0x1f5a5f+0x3]=0x0;}return _0x37a394;}[_0x40c690(0x211)](){const _0x54028e=_0x40c690;Object['keys'](this[_0x54028e(0x17f)])['forEach'](_0x559453=>{this['particlesTextures'][_0x559453]['destroy']();});}['createComputingPrimitives'](_0x10168f,_0x139e04,_0x12d8ce){const _0x4cc33e=_0x40c690,_0x4c8bbd=new Cesium$3[(_0x4cc33e(0x1ef))](_0x10168f['dimensions']['lon'],_0x10168f[_0x4cc33e(0x1d7)]['lat'],_0x10168f[_0x4cc33e(0x1d7)][_0x4cc33e(0x192)]),_0x302f2e=new Cesium$3['Cartesian3'](_0x10168f['lon']['min'],_0x10168f['lat']['min'],_0x10168f[_0x4cc33e(0x192)]['min']),_0x44a345=new Cesium$3['Cartesian3'](_0x10168f['lon'][_0x4cc33e(0x217)],_0x10168f[_0x4cc33e(0x141)]['max'],_0x10168f[_0x4cc33e(0x192)]['max']),_0x4b6f53=new Cesium$3['Cartesian3']((_0x44a345['x']-_0x302f2e['x'])/(_0x4c8bbd['x']-0x1),(_0x44a345['y']-_0x302f2e['y'])/(_0x4c8bbd['y']-0x1),_0x4c8bbd['z']>0x1?(_0x44a345['z']-_0x302f2e['z'])/(_0x4c8bbd['z']-0x1):0x1),_0x444e7d=new Cesium$3['Cartesian2'](_0x10168f['U']['min'],_0x10168f['U']['max']),_0x5e066c=new Cesium$3['Cartesian2'](_0x10168f['V']['min'],_0x10168f['V']['max']),_0x5f463b=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x4cc33e(0x184),'uniformMap':{'U':function(){return _0x5f463b['windTextures']['U'];},'V':function(){const _0x2e7922=_0x4cc33e;return _0x5f463b[_0x2e7922(0x154)]['V'];},'currentParticlesPosition':function(){const _0x1665be=_0x4cc33e;return _0x5f463b['particlesTextures'][_0x1665be(0x20d)];},'dimension':function(){return _0x4c8bbd;},'minimum':function(){return _0x302f2e;},'maximum':function(){return _0x44a345;},'interval':function(){return _0x4b6f53;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0xb8fe9f=_0x4cc33e;_0x5f463b[_0xb8fe9f(0x1f7)][_0xb8fe9f(0x1a4)][_0xb8fe9f(0x1d0)][_0xb8fe9f(0x187)]=_0x5f463b['particlesTextures'][_0xb8fe9f(0x177)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x5f463b['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x5f463b['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x444e7d;},'vSpeedRange':function(){return _0x5e066c;},'pixelSize':function(){const _0x128eaf=_0x4cc33e;return _0x12d8ce[_0x128eaf(0x15c)];},'speedFactor':function(){return _0x139e04['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x24e0ed=_0x4cc33e,_0x56b133=_0x5f463b['particlesTextures'][_0x24e0ed(0x1af)];_0x5f463b['particlesTextures'][_0x24e0ed(0x1af)]=_0x5f463b['particlesTextures']['postProcessingSpeed'],_0x5f463b['particlesTextures']['postProcessingSpeed']=_0x56b133,_0x5f463b['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x5f463b['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x5f463b['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x5f463b['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x4e2a1d=_0x4cc33e,_0x11a0f6=_0x5f463b['particlesTextures']['currentParticlesPosition'];_0x5f463b['particlesTextures']['currentParticlesPosition']=_0x5f463b['particlesTextures']['postProcessingPosition'],_0x5f463b['particlesTextures'][_0x4e2a1d(0x151)]=_0x11a0f6,_0x5f463b[_0x4e2a1d(0x1f7)]['updatePosition']['commandToExecute']['outputTexture']=_0x5f463b['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x1b2317=_0x4cc33e;return _0x5f463b['particlesTextures'][_0x1b2317(0x1ca)];},'nextParticlesSpeed':function(){const _0x4926b4=_0x4cc33e;return _0x5f463b['particlesTextures'][_0x4926b4(0x1be)];},'lonRange':function(){const _0x26227a=_0x4cc33e;return _0x12d8ce[_0x26227a(0x210)];},'latRange':function(){const _0x513d97=_0x4cc33e;return _0x12d8ce[_0x513d97(0x21b)];},'randomCoefficient':function(){const _0x3e0359=_0x4cc33e,_0x4036e5=Math[_0x3e0359(0x227)]();return _0x4036e5;},'dropRate':function(){return _0x139e04['dropRate'];},'dropRateBump':function(){return _0x139e04['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x4cc33e(0x1fc))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x239dba=_0x4cc33e;_0x5f463b['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x5f463b[_0x239dba(0x17f)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x51c72c=_0x4cc33e;return _0x5f463b['particlesTextures'][_0x51c72c(0x151)];},'nextParticlesSpeed':function(){const _0x581c7a=_0x4cc33e;return _0x5f463b['particlesTextures'][_0x581c7a(0x1be)];}},'fragmentShaderSource':new Cesium$3[(_0x4cc33e(0x1fc))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x4cc33e(0x1b5)],'preExecute':function(){const _0x1aba76=_0x4cc33e;_0x5f463b[_0x1aba76(0x1f7)]['postProcessingSpeed']['commandToExecute'][_0x1aba76(0x187)]=_0x5f463b[_0x1aba76(0x17f)]['postProcessingSpeed'];}})};}}function _0x48e8(){const _0x28cd65=['UNSIGNED_BYTE','_drawLines','mod','Sampler','bind','lat','getUVByXY','east','show','computeViewRectangle','canvasContext','_onMouseMoveEvent','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','PixelFormat','colorTable','layer','position','frameTime','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','depthTest','TWO_PI','postProcessingPosition','trails','toGridXY','windTextures','EllipsoidalOccluder','vdata','2519238XPQINR','fragmentShaderSource','off','lon','_onMapWhellEvent','pixelSize','north','commandType','_randomParticle','LUMINANCE','createParticlesTextures','vertexArray','510692HNJJRl','push','TextureMagnificationFilter','keys','clear','1267488HgPlGK','clearFramebuffers','applyViewerParameters','BufferUsage','floor','TextureMinificationFilter','addEventListener','getFullscreenQuad','_map','randomizeParticles','_setOptionsHook','Math','GeometryAttribute','8135239MJhWVB','length','particlesWind','udata','viewport','visible','min','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','age','particlesNumber','particlesTextures','setData','globe','getOptions','mouseUp','Compute','framebuffers','mouseMove','outputTexture','tlat','EventType','RGB','postMessage','Color','getDefaultRenderState','0px','refreshTimer','uniformMap','viewerParameters','lev','lineTo','randomBetween','visibility','tlng','NEAREST','xmin','blue','removeChild','primitiveType','resize','defineProperty','setDate','segments','xmax','PixelDatatype','zIndex','updateSpeed','getWind','color','OPAQUE','GeometryAttributes','windField','framebuffer','colors','setGeometry','grid','scene','_canrefresh','currentParticlesSpeed','lng','lineWidth','canvasHeight','_bilinearInterpolation','mode','postProcessingSpeed','_onMouseDownEvent','windData','clientWidth','6dBwfBo','canvasWidth','update','data','isInExtent','nextParticlesSpeed','_speedRate','unbindEvent','worker','cols','5169110MVNsSe','mouseDown','style','beginPath','CanvasWindField','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','fadeOpacity','nextParticlesPosition','DISABLE_GL_POSITION_LOG_DEPTH','speedRate','destroyObject','sqrt','currentTrails','commandToExecute','_onMap_preRenderEvent','preExecute','toDegrees','PrimitiveType','_data','attributeLocations','dimensions','animateFrame','drawingBufferWidth','9htBJHF','LayerUtil','arrayBufferView','destroy','ZERO','cos','source','nextTrailsColor','clearCommand','Cesium','IDENTITY','SCENE3D','Draw','_maxAge','_calcUV','width','PrimitiveCollection','pointerEvents','maxParticles','options','Cartesian2','Cartesian3','clientHeight','particleSystem','257352rByvEy','44NRmvvW','default','createCommand','255230paLmpx','primitives','Pass','canvasWind','add','rows','ShaderSource','particlesRendering','forEach','particlesComputing','frameRate','canvas','createTexture','get','execute','nextTrails','toRadians','init','ClearCommand','particles','context','removeEventListener','ComponentDatatype','currentParticlesPosition','_calc_speedRate','maxAge','lonRange','destroyParticlesTextures','shaderProgram','_tomap','_onMouseUpEvent','segmentsDepth','RGBA','max','globeBoundingSphere','createRenderingTextures','createFramebuffer','latRange','ymax','_removedHook','log','once','_updateIng','west','currentTrailsColor','mouse_down','createRenderingPrimitives','textures','canrefresh','random','depthTexture','vertexShaderSource'];_0x48e8=function(){return _0x28cd65;};return _0x48e8();}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x4f36c9,_0x2798ba,_0x175494,_0x2046d2){const _0x57b719=_0x40c690;this['context']=_0x4f36c9,_0x2798ba={..._0x2798ba},_0x2798ba['udata']&&_0x2798ba[_0x57b719(0x156)]&&(_0x2798ba['dimensions']={},_0x2798ba['dimensions']['lon']=_0x2798ba['cols'],_0x2798ba['dimensions']['lat']=_0x2798ba['rows'],_0x2798ba['dimensions']['lev']=_0x2798ba[_0x57b719(0x192)]||0x1,_0x2798ba[_0x57b719(0x15a)]={},_0x2798ba['lon'][_0x57b719(0x17b)]=_0x2798ba['xmin'],_0x2798ba['lon']['max']=_0x2798ba['xmax'],_0x2798ba['lat']={},_0x2798ba['lat']['min']=_0x2798ba['ymin'],_0x2798ba['lat']['max']=_0x2798ba[_0x57b719(0x21c)],_0x2798ba['lev']={},_0x2798ba['lev'][_0x57b719(0x17b)]=_0x2798ba['levmin']??0x1,_0x2798ba['lev'][_0x57b719(0x217)]=_0x2798ba['levmax']??0x1,_0x2798ba['U']={},_0x2798ba['U']['array']=new Float32Array(_0x2798ba['udata']),_0x2798ba['U'][_0x57b719(0x17b)]=_0x2798ba['umin']??Math[_0x57b719(0x17b)](..._0x2798ba['udata']),_0x2798ba['U'][_0x57b719(0x217)]=_0x2798ba['umax']??Math['max'](..._0x2798ba[_0x57b719(0x178)]),_0x2798ba['V']={},_0x2798ba['V']['array']=new Float32Array(_0x2798ba['vdata']),_0x2798ba['V'][_0x57b719(0x17b)]=_0x2798ba['vmin']??Math['min'](..._0x2798ba[_0x57b719(0x156)]),_0x2798ba['V']['max']=_0x2798ba['vmax']??Math['max'](..._0x2798ba['vdata'])),this[_0x57b719(0x1bc)]=_0x2798ba,this['options']=_0x175494,this['viewerParameters']=_0x2046d2,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x57b719(0x191)]),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x57b719(0x1bc)],this['options'],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x4be0b8){const _0x151f70=_0x40c690;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x151f70(0x1fe)](_0x4047b7=>{this['particlesComputing']['windTextures'][_0x4047b7]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x151f70(0x1fe)](_0x260f29=>{const _0x2add4c=_0x151f70;this['particlesRendering'][_0x2add4c(0x185)][_0x260f29][_0x2add4c(0x1dd)]();}),this['context']=_0x4be0b8,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x151f70(0x1bc)],this[_0x151f70(0x1ed)],this['viewerParameters'],this[_0x151f70(0x1ff)]);}['clearFramebuffers'](){const _0x32aed3=_0x40c690,_0x17a7fb=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x32aed3(0x18c))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x32aed3(0x166)](this['particlesRendering']['framebuffers'])[_0x32aed3(0x1fe)](_0x454a2a=>{const _0x1d1524=_0x32aed3;_0x17a7fb[_0x1d1524(0x1a9)]=this[_0x1d1524(0x1fd)]['framebuffers'][_0x454a2a],_0x17a7fb[_0x1d1524(0x204)](this['context']);});}['refreshParticles'](_0x203742){const _0x12affe=_0x40c690;this[_0x12affe(0x169)](),this['particlesComputing'][_0x12affe(0x211)](),this['particlesComputing'][_0x12affe(0x161)](this['context'],this['options'],this['viewerParameters']);if(_0x203742){const _0x29e4aa=this['particlesRendering']['createSegmentsGeometry'](this['options']);this[_0x12affe(0x1fd)]['primitives']['segments']['geometry']=_0x29e4aa;const _0x35c219=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x12affe(0x20a)],'geometry':_0x29e4aa,'attributeLocations':this['particlesRendering']['primitives'][_0x12affe(0x19f)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this['particlesRendering']['primitives'][_0x12affe(0x19f)]['commandToExecute']['vertexArray']=_0x35c219;}}['setOptions'](_0x35a8a3){const _0x51886a=_0x40c690;let _0x291f81=![];this['options'][_0x51886a(0x1ec)]!==_0x35a8a3['maxParticles']&&(_0x291f81=!![]),Object['keys'](_0x35a8a3)['forEach'](_0x18dfd7=>{this['options'][_0x18dfd7]=_0x35a8a3[_0x18dfd7];}),this['refreshParticles'](_0x291f81);}['applyViewerParameters'](_0x81ef9b){const _0xb37be4=_0x40c690;Object['keys'](_0x81ef9b)[_0xb37be4(0x1fe)](_0x3f08fd=>{this['viewerParameters'][_0x3f08fd]=_0x81ef9b[_0x3f08fd];}),this['refreshParticles'](![]);}[_0x40c690(0x1dd)](){const _0x20c3d3=_0x40c690;clearTimeout(this[_0x20c3d3(0x226)]),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x20c3d3(0x1fe)](_0x266f07=>{this['particlesComputing']['windTextures'][_0x266f07]['destroy']();}),this[_0x20c3d3(0x1fd)]['textures'][_0x20c3d3(0x14a)]['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x40fa8e=>{const _0x264868=_0x20c3d3;this[_0x264868(0x1fd)]['framebuffers'][_0x40fa8e]['destroy']();});for(const _0x46d66a in this){delete this[_0x46d66a];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x4ce9b3={}){const _0x5e055d=_0x40c690;_0x4ce9b3={...DEF_OPTIONS,..._0x4ce9b3},super(_0x4ce9b3),this[_0x5e055d(0x172)](_0x4ce9b3);}get[_0x40c690(0x14b)](){return this['primitives'];}get['data'](){return this['_data'];}set[_0x40c690(0x1bc)](_0x1af3dd){this['setData'](_0x1af3dd);}get[_0x40c690(0x1aa)](){return this['options']['colors'];}set[_0x40c690(0x1aa)](_0x53cf7f){this['options']['colors']=_0x53cf7f,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x53cf7f}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x19501c=_0x40c690;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1[(_0x19501c(0x1ea))](),this['_map'][_0x19501c(0x1ad)]['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x19501c(0x1ee))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x19501c(0x1de)],0.99*0x615299),this['updateViewerParameters'](),window[_0x19501c(0x16e)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x19501c(0x170)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x19501c(0x170)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x19501c(0x1b6)],this),this['_map']['on'](mars3d__namespace[_0x19501c(0x189)][_0x19501c(0x183)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x19501c(0x186)],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x19501c(0x180)](this['_data']);}[_0x40c690(0x21d)](){const _0x23c7bd=_0x40c690;window['removeEventListener'](_0x23c7bd(0x19c),this['resize']),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x23c7bd(0x189)]['mouseUp'],this['_onMouseUpEvent'],this),this[_0x23c7bd(0x170)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x23c7bd(0x170)]['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0xc4f04c=_0x40c690;if(!this['show']||!this['particleSystem'])return;this['primitives'][_0xc4f04c(0x144)]=![],this['primitives']['removeAll'](),this['_map'][_0xc4f04c(0x21f)](mars3d__namespace['EventType']['preRender'],this[_0xc4f04c(0x1d1)],this);}['_onMap_preRenderEvent'](_0x4d6c1c){const _0x578e3b=_0x40c690;this[_0x578e3b(0x1f1)]['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x40c690(0x15b)](_0x2d3fd0){const _0x269dba=_0x40c690;clearTimeout(this['refreshTimer']);if(!this[_0x269dba(0x144)]||!this['particleSystem'])return;this[_0x269dba(0x1f7)]['show']=![],this[_0x269dba(0x18f)]=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x34b30a){this['mouse_down']=!![];}[_0x40c690(0x147)](_0x495155){const _0x1b3317=_0x40c690;if(!this[_0x1b3317(0x144)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0xfd469e){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x3b58ee=_0x40c690;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem'][_0x3b58ee(0x16a)](this[_0x3b58ee(0x191)]),this[_0x3b58ee(0x1f7)][_0x3b58ee(0x144)]=!![];}['setData'](_0x40c8fa){const _0xc4104a=_0x40c690;this[_0xc4104a(0x1d5)]=_0x40c8fa,this[_0xc4104a(0x1f1)]&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x40c8fa,this[_0xc4104a(0x182)](),this[_0xc4104a(0x191)]),this['addPrimitives']();}['_setOptionsHook'](_0x11aac3,_0x26ed59){const _0x4a994e=_0x40c690;if(_0x11aac3)for(const _0x43fbf7 in _0x11aac3){this[_0x43fbf7]=_0x11aac3[_0x43fbf7];}this[_0x4a994e(0x1f1)]&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x1a90db=_0x40c690,_0x8088a2=Math['ceil'](Math[_0x1a90db(0x1ce)](this['particlesNumber']));return this[_0x1a90db(0x17e)]=_0x8088a2*_0x8088a2,{'particlesTextureSize':_0x8088a2,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x1a90db(0x1c9)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x1a90db(0x1aa)]};}['addPrimitives'](){const _0x53cf89=_0x40c690;this['primitives']['add'](this[_0x53cf89(0x1f1)][_0x53cf89(0x1ff)]['primitives'][_0x53cf89(0x1a4)]),this['primitives'][_0x53cf89(0x1fa)](this['particleSystem']['particlesComputing'][_0x53cf89(0x1f7)][_0x53cf89(0x1a3)]),this['primitives'][_0x53cf89(0x1fa)](this[_0x53cf89(0x1f1)]['particlesComputing'][_0x53cf89(0x1f7)]['updatePosition']),this['primitives']['add'](this[_0x53cf89(0x1f1)][_0x53cf89(0x1ff)][_0x53cf89(0x1f7)][_0x53cf89(0x151)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem'][_0x53cf89(0x1fd)][_0x53cf89(0x1f7)][_0x53cf89(0x19f)]),this['primitives'][_0x53cf89(0x1fa)](this['particleSystem']['particlesRendering']['primitives'][_0x53cf89(0x152)]),this['primitives']['add'](this[_0x53cf89(0x1f1)]['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x204691=_0x40c690;let _0x454eda=this['camera'][_0x204691(0x145)](this['scene'][_0x204691(0x181)]['ellipsoid']);if(!_0x454eda){const _0x6a557a=this['_map']['getExtent']();_0x454eda=Cesium$1['Rectangle']['fromDegrees'](_0x6a557a['xmin'],_0x6a557a['ymin'],_0x6a557a[_0x204691(0x1a0)],_0x6a557a['ymax']);}const _0x502247=Util['viewRectangleToLonLatRange'](_0x454eda);this['viewerParameters']['lonRange']['x']=_0x502247['lon'][_0x204691(0x17b)],this['viewerParameters']['lonRange']['y']=_0x502247[_0x204691(0x15a)]['max'],this['viewerParameters']['latRange']['x']=_0x502247['lat']['min'],this[_0x204691(0x191)]['latRange']['y']=_0x502247['lat'][_0x204691(0x217)];const _0x248320=this['camera']['getPixelSize'](this[_0x204691(0x218)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x248320>0x0&&(this['viewerParameters'][_0x204691(0x15c)]=_0x248320);}}mars3d__namespace[_0x40c690(0x1db)]['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null;}['destroy'](){for(const _0x3895b7 in this){delete this[_0x3895b7];}}}class CanvasWindField{constructor(_0x2fc4d3){this['setOptions'](_0x2fc4d3);}get[_0x40c690(0x1cc)](){return this['_speedRate'];}set['speedRate'](_0x5ab581){const _0x30265b=_0x40c690;this[_0x30265b(0x1bf)]=(0x64-(_0x5ab581>0x63?0x63:_0x5ab581))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this[_0x30265b(0x1bf)],(this[_0x30265b(0x21c)]-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x22225c){const _0x2f2524=_0x40c690;this[_0x2f2524(0x1e7)]=_0x22225c;}['setOptions'](_0x1e484a){const _0x2f7bc6=_0x40c690;this['options']=_0x1e484a,this['maxAge']=_0x1e484a['maxAge']||0x78,this['speedRate']=_0x1e484a[_0x2f7bc6(0x1cc)]||0x32,this['particles']=[];const _0x56c064=_0x1e484a[_0x2f7bc6(0x17e)]||0x1000;for(let _0xb63715=0x0;_0xb63715<_0x56c064;_0xb63715++){const _0x1131d0=this['_randomParticle'](new CanvasParticle());this[_0x2f7bc6(0x209)]['push'](_0x1131d0);}}['setDate'](_0x5c8ee4){const _0x51e009=_0x40c690;this[_0x51e009(0x1fb)]=_0x5c8ee4[_0x51e009(0x1fb)],this['cols']=_0x5c8ee4['cols'],this[_0x51e009(0x198)]=_0x5c8ee4['xmin'],this[_0x51e009(0x1a0)]=_0x5c8ee4[_0x51e009(0x1a0)],this['ymin']=_0x5c8ee4['ymin'],this['ymax']=_0x5c8ee4['ymax'],this[_0x51e009(0x1ac)]=[];const _0x38d503=_0x5c8ee4['udata'],_0x3bea70=_0x5c8ee4[_0x51e009(0x156)];let _0x5ccc14=![];_0x38d503['length']===this['rows']&&_0x38d503[0x0]['length']===this[_0x51e009(0x1c2)]&&(_0x5ccc14=!![]);let _0x380b56=0x0,_0x12bb3a=null,_0x1fbe66=null;for(let _0x55b906=0x0;_0x55b906<this[_0x51e009(0x1fb)];_0x55b906++){_0x12bb3a=[];for(let _0x23c2ec=0x0;_0x23c2ec<this['cols'];_0x23c2ec++,_0x380b56++){_0x5ccc14?_0x1fbe66=this[_0x51e009(0x1e8)](_0x38d503[_0x55b906][_0x23c2ec],_0x3bea70[_0x55b906][_0x23c2ec]):_0x1fbe66=this[_0x51e009(0x1e8)](_0x38d503[_0x380b56],_0x3bea70[_0x380b56]),_0x12bb3a[_0x51e009(0x164)](_0x1fbe66);}this[_0x51e009(0x1ac)]['push'](_0x12bb3a);}this['options']['reverseY']&&this[_0x51e009(0x1ac)]['reverse']();}[_0x40c690(0x167)](){delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this['particles'];}[_0x40c690(0x153)](_0x2c6d29,_0x25af1e){const _0x27a866=_0x40c690,_0x3e1149=(_0x2c6d29-this['xmin'])/(this[_0x27a866(0x1a0)]-this['xmin'])*(this[_0x27a866(0x1c2)]-0x1),_0x278078=(this['ymax']-_0x25af1e)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x3e1149,_0x278078];}['getUVByXY'](_0x5f55e5,_0x3df9b6){const _0x15d16a=_0x40c690;if(_0x5f55e5<0x0||_0x5f55e5>=this[_0x15d16a(0x1c2)]||_0x3df9b6>=this[_0x15d16a(0x1fb)])return[0x0,0x0,0x0];const _0x37148b=Math['floor'](_0x5f55e5),_0x5840cf=Math[_0x15d16a(0x16c)](_0x3df9b6);if(_0x37148b===_0x5f55e5&&_0x5840cf===_0x3df9b6)return this[_0x15d16a(0x1ac)][_0x3df9b6][_0x5f55e5];const _0x1bb58f=_0x37148b+0x1,_0x19d4aa=_0x5840cf+0x1,_0x395a17=this['getUVByXY'](_0x37148b,_0x5840cf),_0x1be940=this[_0x15d16a(0x142)](_0x1bb58f,_0x5840cf),_0x3d3368=this['getUVByXY'](_0x37148b,_0x19d4aa),_0x2303b7=this[_0x15d16a(0x142)](_0x1bb58f,_0x19d4aa);let _0x50863d=null;try{_0x50863d=this[_0x15d16a(0x1b3)](_0x5f55e5-_0x37148b,_0x3df9b6-_0x5840cf,_0x395a17,_0x1be940,_0x3d3368,_0x2303b7);}catch(_0x26f338){console[_0x15d16a(0x21e)](_0x5f55e5,_0x3df9b6);}return _0x50863d;}['_bilinearInterpolation'](_0x1b18b6,_0x3aab23,_0x4887cd,_0x39c62d,_0x3a7537,_0x45480d){const _0x4e8039=_0x40c690,_0x45f15f=0x1-_0x1b18b6,_0x4be3d1=0x1-_0x3aab23,_0xd9e176=_0x45f15f*_0x4be3d1,_0x3c1bf0=_0x1b18b6*_0x4be3d1,_0x4e011b=_0x45f15f*_0x3aab23,_0x1416be=_0x1b18b6*_0x3aab23,_0x599d61=_0x4887cd[0x0]*_0xd9e176+_0x39c62d[0x0]*_0x3c1bf0+_0x3a7537[0x0]*_0x4e011b+_0x45480d[0x0]*_0x1416be,_0x56c3b6=_0x4887cd[0x1]*_0xd9e176+_0x39c62d[0x1]*_0x3c1bf0+_0x3a7537[0x1]*_0x4e011b+_0x45480d[0x1]*_0x1416be;return this[_0x4e8039(0x1e8)](_0x599d61,_0x56c3b6);}['_calcUV'](_0x5ae714,_0x2115a6){return[+_0x5ae714,+_0x2115a6,Math['sqrt'](_0x5ae714*_0x5ae714+_0x2115a6*_0x2115a6)];}['getUVByPoint'](_0x34a2b6,_0x464466){const _0x198a6c=_0x40c690;if(!this[_0x198a6c(0x1bd)](_0x34a2b6,_0x464466))return null;const _0x53745c=this['toGridXY'](_0x34a2b6,_0x464466),_0x5318b9=this['getUVByXY'](_0x53745c[0x0],_0x53745c[0x1]);return _0x5318b9;}[_0x40c690(0x1bd)](_0x5b9b29,_0x5dbe73){const _0x5f3550=_0x40c690;return _0x5b9b29>=this['xmin']&&_0x5b9b29<=this['xmax']&&_0x5dbe73>=this['ymin']&&_0x5dbe73<=this[_0x5f3550(0x21c)]?!![]:![];}['getRandomLatLng'](){const _0x6c1647=_0x40c690,_0x559bff=fRandomByfloat(this['xmin'],this['xmax']),_0x1d8f31=fRandomByfloat(this['ymin'],this[_0x6c1647(0x21c)]);return{'lat':_0x1d8f31,'lng':_0x559bff};}['getParticles'](){const _0x2855fd=_0x40c690;let _0x28c4ea,_0x1daee3,_0x12ff84;for(let _0x51a8c7=0x0,_0x3b7455=this[_0x2855fd(0x209)]['length'];_0x51a8c7<_0x3b7455;_0x51a8c7++){let _0x11de68=this['particles'][_0x51a8c7];_0x11de68[_0x2855fd(0x17d)]<=0x0&&(_0x11de68=this[_0x2855fd(0x15f)](_0x11de68));if(_0x11de68['age']>0x0){const _0x1777b7=_0x11de68['tlng'],_0x543981=_0x11de68[_0x2855fd(0x188)];_0x12ff84=this['getUVByPoint'](_0x1777b7,_0x543981),_0x12ff84?(_0x28c4ea=_0x1777b7+this['_calc_speedRate'][0x0]*_0x12ff84[0x0],_0x1daee3=_0x543981+this['_calc_speedRate'][0x1]*_0x12ff84[0x1],_0x11de68[_0x2855fd(0x1b0)]=_0x1777b7,_0x11de68['lat']=_0x543981,_0x11de68[_0x2855fd(0x196)]=_0x28c4ea,_0x11de68['tlat']=_0x1daee3,_0x11de68['age']--):_0x11de68[_0x2855fd(0x17d)]=0x0;}}return this['particles'];}['_randomParticle'](_0x35aaa7){const _0x338f68=_0x40c690;let _0x12147b,_0x20c42e;for(let _0x888c93=0x0;_0x888c93<0x1e;_0x888c93++){_0x12147b=this['getRandomLatLng'](),_0x20c42e=this['getUVByPoint'](_0x12147b['lng'],_0x12147b['lat']);if(_0x20c42e&&_0x20c42e[0x2]>0x0)break;}if(!_0x20c42e)return _0x35aaa7;const _0x2fedcf=_0x12147b['lng']+this['_calc_speedRate'][0x0]*_0x20c42e[0x0],_0x3db30a=_0x12147b['lat']+this[_0x338f68(0x20e)][0x1]*_0x20c42e[0x1];return _0x35aaa7[_0x338f68(0x1b0)]=_0x12147b[_0x338f68(0x1b0)],_0x35aaa7['lat']=_0x12147b['lat'],_0x35aaa7['tlng']=_0x2fedcf,_0x35aaa7['tlat']=_0x3db30a,_0x35aaa7['age']=Math['round'](Math['random']()*this[_0x338f68(0x20f)]),_0x35aaa7;}['destroy'](){for(const _0x44b708 in this){delete this[_0x44b708];}}}function fRandomByfloat(_0x1340ee,_0x3e6b22){return _0x1340ee+Math['random']()*(_0x3e6b22-_0x1340ee);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x40c690(0x14b)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x249465={}){super(_0x249465),this['_setOptionsHook'](_0x249465),this['canvas']=null;}[_0x40c690(0x172)](_0x132256,_0x1560ab){const _0xe030ad=_0x40c690;this[_0xe030ad(0x14d)]=0x3e8/(_0x132256[_0xe030ad(0x200)]||0xa),this['_pointerEvents']=this['options'][_0xe030ad(0x1eb)]??![],this['color']=_0x132256[_0xe030ad(0x1a5)]||'#ffffff',this['lineWidth']=_0x132256['lineWidth']||0x1,this['fixedHeight']=_0x132256['fixedHeight']??0x0,this['reverseY']=_0x132256['reverseY']??![],this['windField']&&this[_0xe030ad(0x1a8)]['setOptions'](_0x132256);}get[_0x40c690(0x14b)](){return this['canvas'];}get[_0x40c690(0x1ba)](){const _0x1b6222=_0x40c690;return this['_map']['scene']['canvas'][_0x1b6222(0x1b8)];}get['canvasHeight'](){const _0x3d32e8=_0x40c690;return this['_map']['scene'][_0x3d32e8(0x201)]['clientHeight'];}get[_0x40c690(0x1eb)](){return this['_pointerEvents'];}set['pointerEvents'](_0x54b186){const _0xc134af=_0x40c690;this['_pointerEvents']=_0x54b186;if(!this['canvas'])return;_0x54b186?this['canvas'][_0xc134af(0x1c5)]['pointer-events']='all':this['canvas'][_0xc134af(0x1c5)]['pointer-events']='none';}get[_0x40c690(0x17e)](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x4898fb){const _0x657d7a=_0x40c690;this['options']['particlesNumber']=_0x4898fb,clearTimeout(this[_0x657d7a(0x1ae)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x529960){const _0x3ecc22=_0x40c690;this['options'][_0x3ecc22(0x1cc)]=_0x529960,this[_0x3ecc22(0x1a8)]&&(this['windField'][_0x3ecc22(0x1cc)]=_0x529960);}get[_0x40c690(0x20f)](){return this['options']['maxAge'];}set[_0x40c690(0x20f)](_0x56508a){const _0x3a25c5=_0x40c690;this['options']['maxAge']=_0x56508a,this['windField']&&(this['windField'][_0x3a25c5(0x20f)]=_0x56508a);}get['data'](){return this['windData'];}set['data'](_0x30d8fc){const _0x243f15=_0x40c690;this[_0x243f15(0x180)](_0x30d8fc);}['_showHook'](_0x5150f1){const _0x10ca7f=_0x40c690;_0x5150f1?this['_addedHook']():(this['windData']&&(this['options']['data']=this[_0x10ca7f(0x1b7)]),this[_0x10ca7f(0x21d)]());}['_mountedHook'](){const _0x5ed1f6=_0x40c690;this['options']['worker']?this['initWorker']():this[_0x5ed1f6(0x1a8)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x2137b6=_0x40c690;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x2137b6(0x180)](this['options']['data']);}[_0x40c690(0x21d)](){const _0x22a805=_0x40c690;this[_0x22a805(0x167)](),this[_0x22a805(0x1c0)](),this['canvas']&&(this['_map']['container'][_0x22a805(0x19a)](this[_0x22a805(0x201)]),delete this[_0x22a805(0x201)]);}['_createCanvas'](){const _0x6392d4=_0x40c690,_0x45d419=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map']['container']);return _0x45d419[_0x6392d4(0x1c5)][_0x6392d4(0x14c)]='absolute',_0x45d419['style']['top']='0px',_0x45d419['style']['left']=_0x6392d4(0x18e),_0x45d419['style'][_0x6392d4(0x1e9)]=this['_map'][_0x6392d4(0x1ad)]['canvas']['clientWidth']+'px',_0x45d419['style']['height']=this['_map']['scene'][_0x6392d4(0x201)]['clientHeight']+'px',_0x45d419['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x45d419['style']['zIndex']=this['options'][_0x6392d4(0x1a2)]??0x9,_0x45d419[_0x6392d4(0x1e9)]=this[_0x6392d4(0x170)]['scene'][_0x6392d4(0x201)]['clientWidth'],_0x45d419['height']=this[_0x6392d4(0x170)]['scene']['canvas']['clientHeight'],_0x45d419;}['resize'](){const _0x559f90=_0x40c690;this['canvas']&&(this['canvas'][_0x559f90(0x1c5)]['width']=this['_map']['scene']['canvas'][_0x559f90(0x1b8)]+'px',this['canvas']['style']['height']=this[_0x559f90(0x170)]['scene']['canvas'][_0x559f90(0x1f0)]+'px',this[_0x559f90(0x201)]['width']=this['_map'][_0x559f90(0x1ad)]['canvas'][_0x559f90(0x1b8)],this[_0x559f90(0x201)]['height']=this['_map']['scene'][_0x559f90(0x201)][_0x559f90(0x1f0)]);}['bindEvent'](){const _0x16ca1a=_0x40c690,_0x175d1e=this;let _0x2567d3=Date['now']();(function _0x24859b(){_0x175d1e['animateFrame']=window['requestAnimationFrame'](_0x24859b);if(_0x175d1e['show']&&_0x175d1e['windField']){const _0x2aa6b8=Date['now'](),_0x585928=_0x2aa6b8-_0x2567d3;_0x585928>_0x175d1e['frameTime']&&(_0x2567d3=_0x2aa6b8-_0x585928%_0x175d1e['frameTime'],_0x175d1e['update']());}}(),window['addEventListener'](_0x16ca1a(0x19c),this[_0x16ca1a(0x19c)][_0x16ca1a(0x140)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this[_0x16ca1a(0x170)]['on'](mars3d__namespace['EventType']['wheel'],this[_0x16ca1a(0x15b)],this),this[_0x16ca1a(0x170)]['on'](mars3d__namespace['EventType'][_0x16ca1a(0x1c4)],this['_onMouseDownEvent'],this),this[_0x16ca1a(0x170)]['on'](mars3d__namespace[_0x16ca1a(0x189)][_0x16ca1a(0x183)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x129373=_0x40c690;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x129373(0x1d8)],window[_0x129373(0x20b)]('resize',this['resize']),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x129373(0x15b)],this),this[_0x129373(0x170)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x129373(0x214)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x129373(0x186)],this[_0x129373(0x147)],this));}['_onMapWhellEvent'](_0x178017){const _0x1da1c9=_0x40c690;clearTimeout(this[_0x1da1c9(0x18f)]);if(!this['show']||!this['canvas'])return;this['canvas'][_0x1da1c9(0x1c5)][_0x1da1c9(0x195)]='hidden',this['refreshTimer']=setTimeout(()=>{const _0x189515=_0x1da1c9;if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']=_0x189515(0x17a);},0xc8);}[_0x40c690(0x1b6)](_0x507cf3){const _0x13e3e3=_0x40c690;this['mouse_down']=!![],this[_0x13e3e3(0x170)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x13e3e3(0x147)],this);}['_onMouseMoveEvent'](_0x3bb54b){const _0x247303=_0x40c690;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this[_0x247303(0x201)]['style']['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x9404b8){const _0x30f308=_0x40c690;if(!this['show']||!this['canvas'])return;this['_map'][_0x30f308(0x159)](mars3d__namespace[_0x30f308(0x189)][_0x30f308(0x186)],this[_0x30f308(0x147)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x30f308(0x195)]=_0x30f308(0x17a),this[_0x30f308(0x223)]=![],this['mouse_move']=![];}['setData'](_0x301b6d){const _0x525d4d=_0x40c690;this[_0x525d4d(0x167)](),this['windData']=_0x301b6d,this['windField'][_0x525d4d(0x19e)](_0x301b6d),this['redraw']();}['redraw'](){const _0x43a7ed=_0x40c690;if(!this[_0x43a7ed(0x144)])return;this[_0x43a7ed(0x1a8)]['setOptions'](this['options']),this[_0x43a7ed(0x1bb)]();}[_0x40c690(0x1bb)](){const _0x25bd3c=_0x40c690;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0x5c6a92=this['windField']['getParticles']();this[_0x25bd3c(0x13d)](_0x5c6a92);}this[_0x25bd3c(0x220)]=![];}[_0x40c690(0x13d)](_0x12b204){const _0x525903=_0x40c690;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this[_0x525903(0x1ba)],this[_0x525903(0x1b2)]),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9,this[_0x525903(0x146)][_0x525903(0x1c6)](),this[_0x525903(0x146)]['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x525903(0x1a5)];const _0x26387a=this['_map']['scene']['mode']!==Cesium['SceneMode'][_0x525903(0x1e5)],_0x5eb033=this['canvasWidth']*0.25;for(let _0x3bb429=0x0,_0xdf1505=_0x12b204['length'];_0x3bb429<_0xdf1505;_0x3bb429++){const _0x2e2a16=_0x12b204[_0x3bb429],_0x156f59=this[_0x525903(0x213)](_0x2e2a16['lng'],_0x2e2a16[_0x525903(0x141)],_0x2e2a16),_0x474db9=this['_tomap'](_0x2e2a16[_0x525903(0x196)],_0x2e2a16['tlat'],_0x2e2a16);if(!_0x156f59||!_0x474db9)continue;if(_0x26387a&&Math['abs'](_0x156f59[0x0]-_0x474db9[0x0])>=_0x5eb033)continue;this['canvasContext']['moveTo'](_0x156f59[0x0],_0x156f59[0x1]),this['canvasContext'][_0x525903(0x193)](_0x474db9[0x0],_0x474db9[0x1]);}this['canvasContext']['stroke']();}[_0x40c690(0x213)](_0x448317,_0x5582db,_0x2f1373){const _0x57a238=_0x40c690,_0x9c51d4=Cesium['Cartesian3']['fromDegrees'](_0x448317,_0x5582db,this['fixedHeight']),_0x5cc0b8=this['_map']['scene'];if(_0x5cc0b8[_0x57a238(0x1b4)]===Cesium['SceneMode']['SCENE3D']){const _0x5b3cc0=new Cesium[(_0x57a238(0x155))](_0x5cc0b8[_0x57a238(0x181)]['ellipsoid'],_0x5cc0b8['camera']['positionWC']),_0x1ef729=_0x5b3cc0['isPointVisible'](_0x9c51d4);if(!_0x1ef729)return _0x2f1373['age']=0x0,null;}const _0x205f01=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x9c51d4);return _0x205f01?[_0x205f01['x'],_0x205f01['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x52901b=_0x40c690;this['worker']=new Worker(this[_0x52901b(0x1ed)]['worker']),this['worker']['onmessage']=_0x501dbf=>{const _0x3471b2=_0x52901b;this['_drawLines'](_0x501dbf[_0x3471b2(0x1bc)]['particles']),this['_updateIng2']=![];},this[_0x52901b(0x1a8)]={'init':_0x28206e=>{const _0x310044=_0x52901b;this[_0x310044(0x1c1)][_0x310044(0x18b)]({'type':'init','options':_0x28206e});},'setOptions':_0x4777e0=>{const _0x682453=_0x52901b;this['worker'][_0x682453(0x18b)]({'type':'setOptions','options':_0x4777e0});},'setDate':_0x2de756=>{const _0x427b77=_0x52901b;this[_0x427b77(0x1c1)]['postMessage']({'type':_0x427b77(0x19e),'data':_0x2de756});},'update':()=>{const _0x29944b=_0x52901b;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x29944b(0x1c1)]['postMessage']({'type':_0x29944b(0x1bb)});},'clear':()=>{const _0x4ac25b=_0x52901b;this['worker']['postMessage']({'type':_0x4ac25b(0x167)});}},this['windField'][_0x52901b(0x207)](this['options']);}}mars3d__namespace[_0x40c690(0x1db)]['register'](_0x40c690(0x1f9),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x40c690(0x1c7)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x40c690(0x19d)](exports,'__esModule',{'value':!![]});
}));
